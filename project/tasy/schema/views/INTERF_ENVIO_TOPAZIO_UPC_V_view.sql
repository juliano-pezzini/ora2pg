-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW interf_envio_topazio_upc_v (nr_seq_protocolo, cd_convenio, tp_registro, ie_disquete, cd_tipo_registro, cd_federacao, nr_lote, cd_prestador, nr_seq_conta, nm_singular, ie_prestador, cd_cgc_hospital, nm_prestador, dt_remessa, nr_remessa, ds_espaco, nr_registro, nm_paciente, ie_sexo, dt_nascimento, nr_prontuario, cd_plano, cd_usuario, nm_convenio, qt_zeros, ie_tipo_nota, nr_nota, nr_conta_ambulat, nr_autorizacao, tp_conta_origem, nr_conta_origem, cd_natureza, dt_competencia, ie_tipo_paciente, cd_tipo_atendimento, cd_classe_atend, cd_tipo_acomodacao, dt_entrada, hr_entrada, dt_saida, hr_saida, cd_motivo_alta, cd_cid, nr_crm, ds_uf_crm, nm_medico_resp, nr_crm_req, ds_uf_req, nm_medico_req, cd_medico_req, dt_req_assinada, cd_tipo_nasc, qt_eventos_nasc, qt_eventos_obito, nr_seq_autorizacao, cd_proc_autorizado, ds_proc_autorizado, cd_acomod_autorizado, qt_proc_autorizado, nr_guia, dt_guia, ds_senha, nm_autorizador, nr_seq_item_conta, cd_prest_exec, dt_procedimento, hr_procedimento, cd_funcao_executor, nr_porte_anestesico, ds_item, nr_crm_req_exa, nr_guia_exame, cd_prest_cobranca, cd_item, cd_unidade_medida, qt_item, qt_ch, vl_ch, vl_unitario, vl_total_item, ds_local_uso, cd_proc_referencia, cd_via_acesso, ie_tipo_item, qt_diarias_normais, qt_diarias_uti, qt_participantes, vl_honorarios, vl_diarias_normais, vl_diarias_uti, vl_tot_servicos, vl_tot_medicamentos, vl_tot_materiais, vl_sadt, vl_filmes, vl_tot_conta, nr_fatura, qt_conta_lote, vl_total_lote, qt_conta_remessa, vl_total_remessa, nr_interno_conta, dt_validade_carteira, nr_cns, qt_nasc_prematuro, qt_obito_nasc_precoce, qt_obito_nasc_tardio, ie_motivo_obito_mulher, ie_regime_internacao, tp_internacao, ie_motivo_saida_internacao, id_int_obstetricia_1, id_int_obstetricia_2, id_int_obstetricia_3, id_int_obstetricia_4, id_int_obstetricia_5, id_int_obstetricia_6, id_int_obstetricia_7, id_int_obstetricia_8, id_int_obstetricia_9, tp_doenca, tempo_doenca, ie_periodo_doenca, indicacao_acidente, cd_cid_diagnostico_2, cd_cid_diagnostico_3, cd_cid_diagnostico_4, tp_consulta, tp_saida_consulta_sadt, cd_cid_obito, nr_declaracao_obito, hr_fim_realiz_proc, fator_participacao, vl_total_gases_med, tp_faturamento, cd_proc_principal, hr_proc, nr_declaracao_vivos) AS select
/* 	header remessa		*/
 
	a.nr_seq_protocolo				NR_SEQ_PROTOCOLO, 
	a.cd_convenio					CD_CONVENIO, 
	0 						tp_registro, 
	'FATOU' 					ie_disquete, 
	0 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	/*Retirado a linha abaixo e subst. pela linha seguinte OS50518 Fabrício em 11/05/07 */
 
	/*substr(a.nm_convenio,1,40) 			nm_singular, */
 
	substr(obter_dados_pf_pj(null,a.cd_cgc_convenio,'N'),1,40) nm_singular, 
	'J' 						ie_prestador, 
	a.cd_cgc_hospital 				cd_cgc_hospital, 
	substr(a.nm_hospital,1,40) 			nm_prestador, 
	a.dt_remessa 					dt_remessa, 
	a.nr_remessa 					nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	0 						nr_nota, 
	0 						nr_conta_ambulat, 
    0                        nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	0 						nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' '						NR_DECLARACAO_VIVOS 
FROM	w_interf_conta_header 	a 

union all
 
select 
/* 	cabeçalho da conta 1		*/
 
	a.nr_seq_protocolo				NR_SEQ_PROTOCOLO, 
	a.cd_convenio					CD_CONVENIO, 
	1 						tp_registro, 
	'FATOU' 					ie_disquete, 
	1 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	substr(b.nm_paciente,1,40) 			nm_paciente, 
	b.ie_sexo					ie_sexo, 
	b.dt_nascimento					dt_nascimento, 
	somente_numero(substr(b.nr_prontuario,1,7)) 	nr_prontuario, 
	substr(b.cd_categoria_convenio,1,2) 		cd_plano, 
	substr(b.cd_usuario_convenio,1,16) 		cd_usuario, 
	substr(c.ds_convenio,1,35) 			nm_convenio, 
	0 						qt_zeros, 
	substr(OBTER_TIPO_GUIA_CONTA(b.nr_interno_conta),1,1)	ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	b.nr_interno_conta 				nr_interno_conta, 
	b.dt_validade_carteira 				dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' '						NR_DECLARACAO_VIVOS 
from	convenio 		c, 
	w_interf_conta_header 	a, 
	w_interf_conta_cab	b 
where	a.nr_seq_protocolo 	= b.nr_seq_protocolo 
and	b.cd_convenio		= c.cd_convenio 
and 	Obter_qtde_reg_tipo_4(b.nr_seq_protocolo, b.nr_interno_conta) > 0 

union all
 
select 
/* 	cabeçalho da conta 2		*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	2 						tp_registro, 
	'FATOU' 					ie_disquete, 
	2 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	c.dt_mesano_referencia 				dt_competencia, 
    --nvl(OBTER_CONVERSAO_EXTERNA('41781949000153', 'INTERF_ENVIO_TOPAZIO_V', 'IE_TIPO_PACIENTE', substr(OBTER_TIPO_GUIA_CONTA(b.nr_interno_conta),1,1)),'E') ie_tipo_paciente, 
    substr(OBTER_TIPO_GUIA_CONTA(b.nr_interno_conta),1,1) ie_tipo_paciente, 
	ie_clinica 					cd_tipo_atendimento, 
	substr(ie_carater_inter,1,1) 			cd_classe_atend, 
	substr(cd_tipo_acomodacao,1,1) 			cd_tipo_acomodacao, 
	b.dt_periodo_inicial 				dt_entrada, 
	b.dt_periodo_inicial				hr_entrada, 
	b.dt_periodo_final 				dt_saida, 
	b.dt_periodo_final				hr_saida, 
	coalesce(to_char(b.cd_motivo_alta),' ') 		cd_motivo_alta, 
	coalesce(substr(b.cd_cid_principal,1,6),'   ') 	cd_cid, 
	somente_numero(coalesce(b.nr_crm_medico_resp,'0')) 	nr_crm, 
	coalesce(b.uf_crm_medico_resp,' ') 			ds_uf_crm, 
	substr(b.nm_medico_resp,1,40) 			nm_medico_resp, 
	coalesce(somente_numero(substr(obter_medico_convenio(c.cd_estabelecimento,coalesce(b.nr_crm_medico_resp,'0'),c.cd_convenio,null, null, null, null, null, null, null, null), 
		length(obter_medico_convenio(c.cd_estabelecimento,coalesce(b.nr_crm_medico_resp,'0'),c.cd_convenio, null, null,null, null, null, null, null, null))-5,6)),0) 
							nr_crm_req, 
	coalesce(b.uf_crm_medico_resp,' ') 			ds_uf_req, 
	substr(b.nm_medico_resp,1,40) 			nm_medico_req, 
	substr(b.cd_conv_medico_resp,1,12) 		cd_medico_req, 
	b.dt_entrada 					dt_req_assinada, 
	coalesce(somente_numero(b.ie_tipo_nascimento),0) 	cd_tipo_nasc, 
	CASE WHEN b.ie_tipo_nascimento=4 THEN 1  ELSE 0 END  		qt_eventos_nasc, 
	CASE WHEN b.ie_tipo_nascimento=7 THEN 1 WHEN b.ie_tipo_nascimento=8 THEN 1 WHEN b.ie_tipo_nascimento=5 THEN 1  ELSE 0 END 	qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	b.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	CASE WHEN b.ie_tipo_nascimento=3 THEN 1  ELSE 0 END 		qt_nasc_prematuro, 
	CASE WHEN b.ie_tipo_nascimento=8 THEN 1  ELSE 0 END 		qt_obito_nasc_precoce, 
	CASE WHEN b.ie_tipo_nascimento=7 THEN 1  ELSE 0 END 		qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	1 						ie_regime_internacao, 
	b.ie_clinica 					tp_internacao, 
	CASE WHEN b.ie_tipo_atendimento=1 THEN b.cd_motivo_alta  ELSE 0 END  ie_motivo_saida_internacao, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'1'),1,1) ID_INT_OBSTETRICIA_1, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'2'),1,1) ID_INT_OBSTETRICIA_2, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'3'),1,1) ID_INT_OBSTETRICIA_3, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'4'),1,1) ID_INT_OBSTETRICIA_4, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'5'),1,1) ID_INT_OBSTETRICIA_5, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'6'),1,1) ID_INT_OBSTETRICIA_6, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'7'),1,1) ID_INT_OBSTETRICIA_7, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'8'),1,1) ID_INT_OBSTETRICIA_8, 
	substr(obter_dados_int_obstetrica(b.nr_atendimento,'9'),1,1) ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' '						NR_DECLARACAO_VIVOS 
from	protocolo_convenio 	c, 
	w_interf_conta_header 	a, 
	w_interf_conta_cab b 
where	a.nr_seq_protocolo	= c.nr_seq_protocolo 
and	a.nr_seq_protocolo	= b.nr_seq_protocolo 
and 	Obter_qtde_reg_tipo_4(b.nr_seq_protocolo, b.nr_interno_conta) > 0 

union all
 
select 
/* 	autorizações 		*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	3 						tp_registro, 
	'FATOU' 					ie_disquete, 
	3 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	max((substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric ) nr_nota, 
	0 						nr_conta_ambulat, 
    max((substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric ) nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' '						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	coalesce(max(substr(OBTER_GUIA_CONTA(b.nr_interno_conta),1,15)),' ') 
							nr_guia, 
	max(b.dt_autorizacao) 				dt_guia, 
	max(substr(b.cd_senha,1,10)) 			ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	b.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	1 						tp_consulta, 
	CASE WHEN obter_tipo_atendimento(b.nr_atendimento)=1 THEN 0  ELSE OBTER_ALTA_TISS_ATEND(b.nr_atendimento) END  
	 						tp_saida_consulta_sadt, 
	substr(Obter_cid_obito(b.nr_atendimento),1,5)	cd_cid_obito, 
	somente_numero(OBTER_DECLARACAO_OBITO(b.nr_atendimento)) nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	substr(OBTER_DNV_NASCIMENTO(b.nr_atendimento),1,15) NR_DECLARACAO_VIVOS 
from	w_interf_conta_header 	a, 
	w_interf_conta_autor 	b 
where	a.nr_seq_protocolo = b.nr_seq_protocolo 
and 	Obter_qtde_reg_tipo_4(b.nr_seq_protocolo, b.nr_interno_conta) > 0 
group by b.nr_interno_conta, 
	a.nr_seq_protocolo, 
	a.cd_convenio, 
	somente_numero(a.cd_regional), 
	substr(a.cd_interno,1,12), 
	substr(Obter_cid_obito(b.nr_atendimento),1,5), 
	somente_numero(OBTER_DECLARACAO_OBITO(b.nr_atendimento)), 
	substr(OBTER_DNV_NASCIMENTO(b.nr_atendimento),1,15), 
	CASE WHEN obter_tipo_atendimento(b.nr_atendimento)=1 THEN 0  ELSE OBTER_ALTA_TISS_ATEND(b.nr_atendimento) END  

union all
 
select 
/* 	ítem da conta Proc medico */
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	4 						tp_registro, 
	'FATOU' 					ie_disquete, 
	4 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	max(b.nr_seq_item)				nr_seq_item_conta, 
	/*substr(decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)), 
			'H', trim(SUBSTR(b.cd_medico_exec_conv,1,12)), SUBSTR(a.cd_interno,1,12)),1,20)*/
 
	substr(CASE WHEN b.ie_responsavel_credito='T' THEN trim(both SUBSTR(OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null),1,12)) WHEN b.ie_responsavel_credito='H' THEN  trim(both SUBSTR(b.cd_medico_exec_conv,1,12))  ELSE SUBSTR(a.cd_interno,1,12) END ,1,20) 
				 			cd_prest_exec, 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd') dt_procedimento, 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd') hr_procedimento, 
	CASE WHEN b.ie_tipo_item=2 THEN ' '  ELSE to_char(b.cd_funcao_executor) END  
							cd_funcao_executor, 
	coalesce(b.nr_porte_anestesico,0) 			nr_porte_anestesico, 
	substr(b.ds_item,1,70) 				ds_item, 
	coalesce(somente_numero(substr(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio,null, null, null, null, null, null, null, null), 
		length(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null, null,null, null, null, null, null, null))-5,6)),0) 
							nr_crm_req_exa, 
	CASE WHEN b.ie_responsavel_credito='T' THEN  somente_numero(CASE WHEN obter_guia_prescricao(coalesce(b.nr_prescricao,0))='0' THEN coalesce(b.nr_prescricao,0)  ELSE obter_guia_prescricao(coalesce(b.nr_prescricao,0)) END )  ELSE 0 END  nr_guia_exame, 
	/*decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)),' ') 
							cd_prest_cobranca,*/
 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12) 
							cd_prest_cobranca, 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0) 
							cd_item, 
	substr(b.cd_unidade_medida,1,3) 		cd_unidade_medida, 
	SUM(b.qt_item) 					qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	/*decode(sum(b.qt_item),0,0,(sum(nvl(b.vl_honorario,0) 
		+ nvl(b.vl_custo_oper,0)) / sum(b.qt_item))) 
							vl_unitario,*/
 
	0						vl_unitario, 
	/*sum(nvl(b.vl_honorario,0) + nvl(b.vl_custo_oper,0)) 
							vl_total_item,*/
 
	0						vl_total_item, 
	substr(b.cd_setor_atendimento,1,5)		ds_local_uso, 
	coalesce(b.cd_procedimento_ref,0) 			cd_proc_referencia, 
	coalesce(b.ie_via_acesso_inf,'0') 			cd_via_acesso, 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END  
							ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	c.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	100						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	max(CASE WHEN coalesce((substr(obter_proc_principal(b.nr_atendimento, b.cd_convenio, c.ie_tipo_atendimento, 				b.nr_interno_conta, 'C'),1,8))::numeric ,0)=b.cd_item THEN b.cd_item  ELSE 0 END ) cd_proc_principal, 
	MAX(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ) hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.ie_tipo_item		 = 1 and b.qt_item		 <> 0 AND somente_numero(b.IE_EMITE_CONTA) <> 71 AND (b.ie_total_interf <> 4 OR coalesce(b.IE_TOTAL_INTERF,0) = 0) --and 	nvl(b.cd_especialidade_proc,0) not in (16000005, 28000005) 
--and 	nvl(b.cd_especialidade_proc,0) <> 28000005 
  and b.cd_item in (select 	x.cd_procedimento 
		   from 	estrutura_procedimento_v x 
		   where 	x.cd_area_procedimento in (1,4,11,13)) group by 
	a.nr_seq_protocolo, 
	a.cd_convenio, 
	coalesce(b.pr_faturado,100), 
	somente_numero(a.cd_regional), 
	substr(a.cd_interno,1,12), 
	/*decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)), 
			'H', trim(SUBSTR(b.cd_medico_exec_conv,1,12)), SUBSTR(a.cd_interno,1,12)),*/
 
	substr(CASE WHEN b.ie_responsavel_credito='T' THEN trim(both SUBSTR(OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null),1,12)) WHEN b.ie_responsavel_credito='H' THEN  trim(both SUBSTR(b.cd_medico_exec_conv,1,12))  ELSE SUBSTR(a.cd_interno,1,12) END ,1,20), 
	/*decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)),' '),*/
 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12), 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd'), 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd'), 
	CASE WHEN b.ie_tipo_item=2 THEN ' '  ELSE to_char(b.cd_funcao_executor) END , 
	coalesce(b.nr_porte_anestesico,0), 
	substr(b.ds_item,1,70), 
	coalesce(somente_numero(substr(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null,null, null, null, null, null,null,null), 
		length(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null, null, null,null, null, null,null,null))-5,6)),0), 
	CASE WHEN b.ie_responsavel_credito='T' THEN  somente_numero(CASE WHEN obter_guia_prescricao(coalesce(b.nr_prescricao,0))='0' THEN coalesce(b.nr_prescricao,0)  ELSE obter_guia_prescricao(coalesce(b.nr_prescricao,0)) END )  ELSE 0 END , 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric , 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0), 
	substr(b.cd_unidade_medida,1,3), 
	b.vl_unitario_item, 
	coalesce(b.cd_procedimento_ref,0), 
	coalesce(b.ie_via_acesso_inf,'0'), 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END , 
	c.nr_interno_conta, 
	substr(b.cd_setor_atendimento,1,5) 
	/*b.nr_seq_item*/
 
having sum(b.qt_item) <> 0 

union all
 
select 
/* 	ítem da conta exames,servicos*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	4 						tp_registro, 
	'FATOU' 					ie_disquete, 
	4 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  
							nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	max(b.nr_seq_item)				nr_seq_item_conta, 
	/*substr(decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)), 
				'H', trim(SUBSTR(b.cd_medico_exec_conv,1,12)), SUBSTR(a.cd_interno,1,12)),1,20)*/
 
	substr(CASE WHEN b.ie_responsavel_credito='T' THEN trim(both SUBSTR(OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null),1,12)) WHEN b.ie_responsavel_credito='H' THEN  trim(both SUBSTR(b.cd_medico_exec_conv,1,12))  ELSE SUBSTR(a.cd_interno,1,12) END ,1,20) 
							cd_prest_exec, 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd') dt_procedimento, 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd') hr_procedimento, 
	CASE WHEN b.ie_tipo_item=2 THEN ' '  ELSE to_char(b.cd_funcao_executor) END  
							cd_funcao_executor, 
	coalesce(b.nr_porte_anestesico,0) 			nr_porte_anestesico, 
	substr(b.ds_item,1,70) 				ds_item, 
	coalesce(somente_numero(substr(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null, null,null, null, null, null,null,null), 
		length(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null, null, null, null,null, null,null,null))-5,6)),0) 
							nr_crm_req_exa, 
	CASE WHEN b.ie_responsavel_credito='T' THEN  somente_numero(CASE WHEN obter_guia_prescricao(coalesce(b.nr_prescricao,0))='0' THEN coalesce(b.nr_prescricao,0)  ELSE obter_guia_prescricao(coalesce(b.nr_prescricao,0)) END )  ELSE 0 END  nr_guia_exame, 
/*	decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)),' ') 
							cd_prest_cobranca,*/
 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12) 
							cd_prest_cobranca, 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0) 
							cd_item, 
	substr(b.cd_unidade_medida,1,3) 		cd_unidade_medida, 
	SUM(b.qt_item) 					qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	/*decode(sum(b.qt_item),0,0,(sum(b.vl_total_item) / sum(b.qt_item))) 
							vl_unitario,*/
 
	0						vl_unitario, 
	/*sum(b.vl_total_item) 				vl_total_item,*/
 
	0						vl_total_item, 
	substr(b.cd_setor_atendimento,1,5) 		ds_local_uso, 
	coalesce(b.cd_procedimento_ref,0) 			cd_proc_referencia, 
	coalesce(b.ie_via_acesso_inf,'0') 			cd_via_acesso, 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END  
							ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	c.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	100						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	max(CASE WHEN coalesce((substr(obter_proc_principal(b.nr_atendimento, b.cd_convenio, c.ie_tipo_atendimento, 				b.nr_interno_conta, 'C'),1,8))::numeric ,0)=b.cd_item THEN b.cd_item  ELSE 0 END ) cd_proc_principal, 
	MAX(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ) hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.qt_item			<> 0 --AND 	nvl(b.cd_especialidade_proc,0) not in (16000005, 28000005) 
--AND 	nvl(b.cd_especialidade_proc,0) <> 28000005 
  AND coalesce(b.ie_tipo_item,0) <> 2 AND somente_numero(b.IE_EMITE_CONTA) <> 71 AND (b.ie_total_interf <> 4 OR coalesce(b.IE_TOTAL_INTERF,0) = 0) and b.cd_item not in (select x.cd_procedimento 
		     from 	estrutura_procedimento_v x 
		     where 	x.cd_area_procedimento in (1,4,11,13) 
			 AND 	b.cd_item NOT IN (SELECT x.cd_procedimento 
 				    	   	 FROM estrutura_procedimento_v x 
 					   	 WHERE x.cd_grupo_proc IN (7,4))) group by 
	a.nr_seq_protocolo, 
	a.cd_convenio, 
	somente_numero(a.cd_regional), 
	substr(a.cd_interno,1,12), 
	/*decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)), 
				'H', trim(SUBSTR(b.cd_medico_exec_conv,1,12)), SUBSTR(a.cd_interno,1,12)),*/
 
	substr(CASE WHEN b.ie_responsavel_credito='T' THEN trim(both SUBSTR(OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null),1,12)) WHEN b.ie_responsavel_credito='H' THEN  trim(both SUBSTR(b.cd_medico_exec_conv,1,12))  ELSE SUBSTR(a.cd_interno,1,12) END ,1,20), 
	CASE WHEN b.ie_responsavel_credito='T' THEN  somente_numero(CASE WHEN obter_guia_prescricao(coalesce(b.nr_prescricao,0))='0' THEN coalesce(b.nr_prescricao,0)  ELSE obter_guia_prescricao(coalesce(b.nr_prescricao,0)) END )  ELSE 0 END , 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd'), 
	trunc(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ,'dd'), 
	CASE WHEN b.ie_tipo_item=2 THEN ' '  ELSE to_char(b.cd_funcao_executor) END , 
	coalesce(b.nr_porte_anestesico,0), 
	substr(b.ds_item,1,70), 
	coalesce(somente_numero(substr(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null,null, null, null, null, null,null,null), 
		length(obter_medico_convenio(Obter_estab_atend(b.nr_atendimento),coalesce(b.cd_medico_req,b.cd_medico_executor),c.cd_convenio, null, null,null, null, null, null,null,null))-5,6)),0), 
	coalesce(somente_numero(b.nr_doc_convenio),0), 
	/*decode(b.ie_responsavel_credito,'T',trim(SUBSTR(b.cd_medico_exec_conv,1,12)),' '),*/
 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12), 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric , 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0), 
	substr(b.cd_unidade_medida,1,3), 
	b.vl_unitario_item, 
	coalesce(b.cd_procedimento_ref,0), 
	coalesce(b.ie_via_acesso_inf,'0'), 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END , 
	coalesce(b.pr_faturado,100), 
	c.nr_interno_conta, 
	substr(b.cd_setor_atendimento,1,5) 
	/*b.nr_seq_item*/
 
having 	sum(b.qt_item) <> 0 

union all
 
SELECT 
	/*Materiais e Medicamentos */
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	4 						tp_registro, 
	'FATOU' 					ie_disquete, 
	4 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  
							nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	SUBSTR(a.cd_interno,1,12) 			cd_prest_exec, 
	max(b.dt_item) 					dt_procedimento, 
	max(b.dt_item)					hr_procedimento, 
	' '						cd_funcao_executor, 
	coalesce(b.nr_porte_anestesico,0) 			nr_porte_anestesico, 
	substr(b.ds_item,1,70) 				ds_item, 
	0						nr_crm_req_exa, 
	coalesce(somente_numero(b.nr_doc_convenio),0) 	nr_guia_exame, 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12) 
							cd_prest_cobranca, 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0) 
							cd_item, 
	substr(b.cd_unidade_medida,1,3) 		cd_unidade_medida, 
	SUM(b.qt_item) 					qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	CASE WHEN sum(b.qt_item)=0 THEN 0  ELSE (sum(b.vl_total_item) / sum(b.qt_item)) END  
							vl_unitario, 
	sum(b.vl_total_item) 				vl_total_item, 
	substr(b.cd_setor_atendimento,1,5) 		ds_local_uso, 
	coalesce(b.cd_procedimento_ref,0) 			cd_proc_referencia, 
	coalesce(b.ie_via_acesso_inf,'0') 			cd_via_acesso, 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END  
							ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	c.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	100						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	MAX(CASE WHEN b.ie_tipo_item=2 THEN c.dt_entrada  ELSE b.dt_item END ) hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
FROM w_interf_conta_cab c, w_interf_conta_header a, w_interf_conta_item b
LEFT OUTER JOIN regra_honorario z ON (b.ie_responsavel_credito = z.cd_regra)
WHERE b.nr_seq_protocolo	= a.nr_seq_protocolo and b.nr_seq_protocolo	= c.nr_seq_protocolo and b.nr_interno_conta	= c.nr_interno_conta and coalesce(b.nr_seq_proc_pacote,b.nr_seq_item) = b.nr_seq_item  and coalesce(z.ie_entra_conta,'S') = 'S' and b.qt_item			<> 0 AND somente_numero(b.IE_EMITE_CONTA) <> 71 AND (b.ie_total_interf <> 4 OR coalesce(b.IE_TOTAL_INTERF,0) = 0) and (coalesce(b.ie_tipo_item,0) = 2) /* Retirado linha abaixo OS 50518 - Fabrício 29/05 */
 
/* and	((NVL(b.ie_tipo_item,0) = 2) or b.cd_item not in(select x.cd_procedimento 
		     from 	estrutura_procedimento_v x 
		     where 	x.cd_area_procedimento in(1,4,11,13) 
			 AND 	b.cd_item NOT IN(SELECT x.cd_procedimento 
 				    	   	 FROM estrutura_procedimento_v x 
 					   	 WHERE x.cd_grupo_proc IN(7,4)))) */
 group by 
	a.nr_seq_protocolo, 
	a.cd_convenio, 
	somente_numero(a.cd_regional), 
	coalesce(b.pr_faturado,100), 
	substr(a.cd_interno,1,12), 
	coalesce(b.nr_porte_anestesico,0), 
	substr(b.ds_item,1,70), 
	coalesce(somente_numero(b.nr_doc_convenio),0), 
	/*nvl(somente_numero(c.nr_doc_convenio),0),*/
 
	(substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric , 
	coalesce(somente_numero(coalesce(b.cd_item_convenio,b.cd_item)),0), 
	substr(b.cd_unidade_medida,1,3), 
	coalesce(b.cd_procedimento_ref,0), 
	coalesce(b.ie_via_acesso_inf,'0'), 
	CASE WHEN b.cd_tipo_item_interf=1 THEN 1 WHEN b.cd_tipo_item_interf=2 THEN 2 WHEN b.cd_tipo_item_interf=3 THEN 2 WHEN b.cd_tipo_item_interf=4 THEN 4 WHEN b.cd_tipo_item_interf=5 THEN 3  ELSE 0 END , 
	c.nr_interno_conta, 
	substr(b.cd_setor_atendimento,1,5), 
	substr(CASE WHEN b.CD_CGC_PRESTADOR=b.CD_CGC_HOSPITAL THEN ' '  ELSE OBTER_PRESTADOR_CONVENIO(b.CD_CGC_PRESTADOR,b.CD_CONVENIO,null) END ,1,12) 
having(sum(b.qt_item) <> 0) and (sum(b.vl_total_item) <> 0) 

union all
 
select 
/* 	total da conta		*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	5 						tp_registro, 
	'FATOU' 					ie_disquete, 
	5 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	substr(a.cd_interno,1,12) 			cd_prestador, 
	0 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	(substr(coalesce(OBTER_GUIA_CONTA(d.nr_interno_conta),'0'),1,11))::numeric  
							nr_nota, 
	0 						nr_conta_ambulat, 
    (substr(coalesce(OBTER_GUIA_CONTA(b.nr_interno_conta),'0'),1,11))::numeric  nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	obter_resumo_diaria(1,1,b.nr_interno_conta)	qt_diarias_normais, 
	obter_resumo_diaria(2,1,b.nr_interno_conta)	qt_diarias_uti, 
	coalesce(somente_numero(substr(b.qt_participantes,1,1)),0) 
							qt_participantes, 
	0 						vl_honorarios, 
	/*obter_resumo_diaria(1,2,b.nr_interno_conta)	vl_diarias_normais,*/
 
	0						vl_diarias_normais, 
	/*obter_resumo_diaria(2,2,b.nr_interno_conta)	vl_diarias_uti,*/
 
	0						vl_diarias_uti, 
	/*(b.vl_taxas + b.vl_servico) 			vl_tot_servicos,*/
 
	0						vl_tot_servicos, 
	b.vl_medicamentos 				vl_tot_medicamentos, 
	b.vl_materiais 					vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	/*b.vl_total_conta 				vl_tot_conta, */
 
	(b.vl_materiais + b.vl_medicamentos)		vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	b.nr_interno_conta 				nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	CASE WHEN substr(obter_dados_atendimento(d.nr_atendimento,'DA'),1,20) IS NULL THEN 'P'  ELSE 'T' END  tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
from	w_interf_conta_header 	a, 
	w_interf_conta_total 	b, 
	conta_paciente		d 
where	b.nr_seq_protocolo		= a.nr_seq_protocolo 
and  	b.nr_interno_conta 		= d.nr_interno_conta 
and 	Obter_qtde_reg_tipo_4(b.nr_seq_protocolo, b.nr_interno_conta) > 0 

union all
 
SELECT 	"NR_SEQ_PROTOCOLO", 
	"CD_CONVENIO", 
	"TP_REGISTRO", 
	"IE_DISQUETE", 
	"CD_TIPO_REGISTRO", 
	"CD_FEDERACAO", 
	"NR_LOTE", 
	"CD_PRESTADOR", 
	"NR_SEQ_CONTA", 
	"NM_SINGULAR", 
	"IE_PRESTADOR", 
	"CD_CGC_HOSPITAL", 
	"NM_PRESTADOR", 
	"DT_REMESSA", 
	"NR_REMESSA", 
	"DS_ESPACO", 
	"NR_REGISTRO", 
	"NM_PACIENTE", 
	"IE_SEXO", 
	"DT_NASCIMENTO", 
	"NR_PRONTUARIO", 
	"CD_PLANO", 
	"CD_USUARIO", 
	"NM_CONVENIO", 
	"QT_ZEROS", 
	"IE_TIPO_NOTA", 
	"NR_NOTA", 
	"NR_CONTA_AMBULAT", 
    "NR_AUTORIZACAO", 
	"TP_CONTA_ORIGEM", 
	"NR_CONTA_ORIGEM", 
	"CD_NATUREZA", 
	"DT_COMPETENCIA", 
	"IE_TIPO_PACIENTE", 
	"CD_TIPO_ATENDIMENTO", 
	"CD_CLASSE_ATEND", 
	"CD_TIPO_ACOMODACAO", 
	"DT_ENTRADA", 
	"HR_ENTRADA", 
	"DT_SAIDA", 
	"HR_SAIDA", 
	"CD_MOTIVO_ALTA", 
	"CD_CID", 
	"NR_CRM", 
	"DS_UF_CRM", 
	"NM_MEDICO_RESP", 
	"NR_CRM_REQ", 
	"DS_UF_REQ", 
	"NM_MEDICO_REQ", 
	"CD_MEDICO_REQ", 
	"DT_REQ_ASSINADA", 
	"CD_TIPO_NASC", 
	"QT_EVENTOS_NASC", 
	"QT_EVENTOS_OBITO", 
	"NR_SEQ_AUTORIZACAO", 
	"CD_PROC_AUTORIZADO", 
	"DS_PROC_AUTORIZADO", 
	"CD_ACOMOD_AUTORIZADO", 
	"QT_PROC_AUTORIZADO", 
	"NR_GUIA", 
	"DT_GUIA", 
	"DS_SENHA", 
	"NM_AUTORIZADOR", 
	"NR_SEQ_ITEM_CONTA", 
	"CD_PREST_EXEC", 
	"DT_PROCEDIMENTO", 
	"HR_PROCEDIMENTO", 
	"CD_FUNCAO_EXECUTOR", 
	"NR_PORTE_ANESTESICO", 
	"DS_ITEM", 
	"NR_CRM_REQ_EXA", 
	"NR_GUIA_EXAME", 
	"CD_PREST_COBRANCA", 
	"CD_ITEM", 
	"CD_UNIDADE_MEDIDA", 
	"QT_ITEM", 
	"QT_CH", 
	"VL_CH", 
	"VL_UNITARIO", 
	"VL_TOTAL_ITEM", 
	"DS_LOCAL_USO", 
	"CD_PROC_REFERENCIA", 
	"CD_VIA_ACESSO", 
	"IE_TIPO_ITEM", 
	"QT_DIARIAS_NORMAIS", 
	"QT_DIARIAS_UTI", 
	"QT_PARTICIPANTES", 
	"VL_HONORARIOS", 
	"VL_DIARIAS_NORMAIS", 
	"VL_DIARIAS_UTI", 
	"VL_TOT_SERVICOS", 
	"VL_TOT_MEDICAMENTOS", 
	"VL_TOT_MATERIAIS", 
	"VL_SADT","VL_FILMES", 
	"VL_TOT_CONTA", 
	"NR_FATURA", 
	"QT_CONTA_LOTE", 
	"VL_TOTAL_LOTE", 
	"QT_CONTA_REMESSA", 
	"VL_TOTAL_REMESSA", 
	"NR_INTERNO_CONTA", 
	"DT_VALIDADE_CARTEIRA", 
	"NR_CNS", 
	"QT_NASC_PREMATURO", 
	"QT_OBITO_NASC_PRECOCE", 
	"QT_OBITO_NASC_TARDIO", 
	"IE_MOTIVO_OBITO_MULHER", 
	"IE_REGIME_INTERNACAO", 
	"TP_INTERNACAO", 
	"IE_MOTIVO_SAIDA_INTERNACAO", 
	"ID_INT_OBSTETRICIA_1", 
	"ID_INT_OBSTETRICIA_2", 
	"ID_INT_OBSTETRICIA_3", 
	"ID_INT_OBSTETRICIA_4", 
	"ID_INT_OBSTETRICIA_5", 
	"ID_INT_OBSTETRICIA_6", 
	"ID_INT_OBSTETRICIA_7", 
	"ID_INT_OBSTETRICIA_8", 
	"ID_INT_OBSTETRICIA_9", 
	"TP_DOENCA", 
	"TEMPO_DOENCA", 
	"IE_PERIODO_DOENCA", 
	"INDICACAO_ACIDENTE", 
	"CD_CID_DIAGNOSTICO_2", 
	"CD_CID_DIAGNOSTICO_3", 
	"CD_CID_DIAGNOSTICO_4", 
	"TP_CONSULTA", 
	"TP_SAIDA_CONSULTA_SADT", 
	"CD_CID_OBITO", 
	"NR_DECLARACAO_OBITO", 
	"HR_FIM_REALIZ_PROC", 
	"FATOR_PARTICIPACAO", 
	"VL_TOTAL_GASES_MED", 
	"TP_FATURAMENTO", 
	"CD_PROC_PRINCIPAL", 
	"HR_PROC", 
	"NR_DECLARACAO_VIVOS" 
FROM 	INTERF_TOPAZIO_PROCED_UPC_V 

union all
 
select 
/* 	fim de lote 	*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	6 						tp_registro, 
	'FATOU' 					ie_disquete, 
	6 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	0 						nr_lote, 
	'999999999999' 					cd_prestador, 
	99999 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	0 						nr_nota, 
	0 						nr_conta_ambulat, 
    0                        nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	to_char(b.nr_seq_protocolo) 			nr_fatura, 
	count(b.qt_total_conta) 			qt_conta_lote, 
	/*b.vl_total_conta 				vl_total_lote,	*/
 
	sum(c.vl_materiais + c.vl_medicamentos)		vl_total_lote, 
	0 						qt_conta_remessa, 
	0 						vl_total_remessa, 
	999999999 					nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
from	w_interf_conta_header 		a, 
	w_interf_conta_trailler 	b, 
	w_interf_conta_total		c 
where 	a.nr_seq_protocolo = b.nr_seq_protocolo 
and 	b.nr_seq_protocolo = c.nr_seq_protocolo 
group by a.cd_convenio, 
	a.nr_seq_protocolo, 
	to_char(b.nr_seq_protocolo), 
	somente_numero(a.cd_regional) 

union all
 
select 
/* 	trailler 	*/
 
	a.nr_seq_protocolo				nr_seq_protocolo, 
	a.cd_convenio					cd_convenio, 
	9 						tp_registro, 
	'FATOU' 					ie_disquete, 
	9 						cd_tipo_registro, 
	somente_numero(a.cd_regional) 			cd_federacao, 
	9999 						nr_lote, 
	'999999999999' 					cd_prestador, 
	99999 						nr_seq_conta, 
	' ' 						nm_singular, 
	' ' 						ie_prestador, 
	' ' 						cd_cgc_hospital, 
	' ' 						nm_prestador, 
	LOCALTIMESTAMP 					dt_remessa, 
	0 						nr_remessa, 
	' ' 						ds_espaco, 
	0 						nr_registro, 
	' ' 						nm_paciente, 
	' ' 						ie_sexo, 
	LOCALTIMESTAMP 					dt_nascimento, 
	0 						nr_prontuario, 
	' ' 						cd_plano, 
	' ' 						cd_usuario, 
	' ' 						nm_convenio, 
	0 						qt_zeros, 
	'0' 						ie_tipo_nota, 
	0 						nr_nota, 
	0 						nr_conta_ambulat, 
    0                        nr_autorizacao, 
	' ' 						tp_conta_origem, 
	0 						nr_conta_origem, 
	0 						cd_natureza, 
	LOCALTIMESTAMP 					dt_competencia, 
	' ' 						ie_tipo_paciente, 
	0 						cd_tipo_atendimento, 
	' ' 						cd_classe_atend, 
	' ' 						cd_tipo_acomodacao, 
	LOCALTIMESTAMP 					dt_entrada, 
	LOCALTIMESTAMP 					hr_entrada, 
	LOCALTIMESTAMP 					dt_saida, 
	LOCALTIMESTAMP 					hr_saida, 
	' ' 						cd_motivo_alta, 
	' ' 						cd_cid, 
	0 						nr_crm, 
	' ' 						ds_uf_crm, 
	' ' 						nm_medico_resp, 
	0 						nr_crm_req, 
	' ' 						ds_uf_req, 
	' ' 						nm_medico_req, 
	' ' 						cd_medico_req, 
	LOCALTIMESTAMP 					dt_req_assinada, 
	0 						cd_tipo_nasc, 
	0 						qt_eventos_nasc, 
	0 						qt_eventos_obito, 
	0 						nr_seq_autorizacao, 
	0 						cd_proc_autorizado, 
	' ' 						ds_proc_autorizado, 
	' ' 						cd_acomod_autorizado, 
	0 						qt_proc_autorizado, 
	' ' 						nr_guia, 
	LOCALTIMESTAMP 					dt_guia, 
	' ' 						ds_senha, 
	' ' 						nm_autorizador, 
	0 						nr_seq_item_conta, 
	' ' 						cd_prest_exec, 
	LOCALTIMESTAMP 					dt_procedimento, 
	LOCALTIMESTAMP 					hr_procedimento, 
	' ' 						cd_funcao_executor, 
	0 						nr_porte_anestesico, 
	' ' 						ds_item, 
	0 						nr_crm_req_exa, 
	0 						nr_guia_exame, 
	' ' 						cd_prest_cobranca, 
	0 						cd_item, 
	' ' 						cd_unidade_medida, 
	0 						qt_item, 
	0 						qt_ch, 
	0 						vl_ch, 
	0 						vl_unitario, 
	0 						vl_total_item, 
	' ' 						ds_local_uso, 
	0 						cd_proc_referencia, 
	' ' 						cd_via_acesso, 
	0 						ie_tipo_item, 
	0 						qt_diarias_normais, 
	0 						qt_diarias_uti, 
	0 						qt_participantes, 
	0 						vl_honorarios, 
	0 						vl_diarias_normais, 
	0 						vl_diarias_uti, 
	0 						vl_tot_servicos, 
	0 						vl_tot_medicamentos, 
	0 						vl_tot_materiais, 
	0 						vl_sadt, 
	0 						vl_filmes, 
	0 						vl_tot_conta, 
	' ' 						nr_fatura, 
	0 						qt_conta_lote, 
	0 						vl_total_lote, 
	count(b.qt_total_conta) 			qt_conta_remessa, 
	/*b.vl_total_conta 				vl_total_remessa,*/
 
	sum(c.vl_materiais + c.vl_medicamentos)		vl_total_remessa, 
	9999999999 					nr_interno_conta, 
	LOCALTIMESTAMP 					dt_validade_carteira, 
	0 						nr_cns, 
	0 						qt_nasc_prematuro, 
	0 						qt_obito_nasc_precoce, 
	0 						qt_obito_nasc_tardio, 
	0 						ie_motivo_obito_mulher, 
	0 						ie_regime_internacao, 
	0 						tp_internacao, 
	0 						ie_motivo_saida_internacao, 
	' ' 						ID_INT_OBSTETRICIA_1, 
	' ' 						ID_INT_OBSTETRICIA_2, 
	' ' 						ID_INT_OBSTETRICIA_3, 
	' ' 						ID_INT_OBSTETRICIA_4, 
	' ' 						ID_INT_OBSTETRICIA_5, 
	' ' 						ID_INT_OBSTETRICIA_6, 
	' ' 						ID_INT_OBSTETRICIA_7, 
	' ' 						ID_INT_OBSTETRICIA_8, 
	' ' 						ID_INT_OBSTETRICIA_9, 
	' ' 						tp_doenca, 
	0 						tempo_doenca, 
	' ' 						ie_periodo_doenca, 
	0 						indicacao_acidente, 
	' ' 						cd_cid_diagnostico_2, 
	' ' 						cd_cid_diagnostico_3, 
	' ' 						cd_cid_diagnostico_4, 
	0 						tp_consulta, 
	0 						tp_saida_consulta_sadt, 
	' ' 						cd_cid_obito, 
	0 						nr_declaracao_obito, 
	LOCALTIMESTAMP 					HR_FIM_REALIZ_PROC, 
	0 						FATOR_PARTICIPACAO, 
	0 						vl_total_gases_med, 
	' ' 						tp_faturamento, 
	0						cd_proc_principal, 
	LOCALTIMESTAMP						hr_proc, 
	' ' 						NR_DECLARACAO_VIVOS 
from	w_interf_conta_header 		a, 
	w_interf_conta_trailler 	b, 
	w_interf_conta_total		c 
where	a.nr_seq_protocolo = b.nr_seq_protocolo 
and 	b.nr_seq_protocolo	=	c.nr_seq_protocolo 
group by a.cd_convenio, 
	a.nr_seq_protocolo, 
	somente_numero(a.cd_regional);

