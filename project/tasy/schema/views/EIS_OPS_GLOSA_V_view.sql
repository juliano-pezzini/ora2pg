-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_ops_glosa_v (nr_seq_conta, nr_seq_protocolo, nr_seq_prestador, nm_prestador, ds_tipo_relacao, ds_tipo_prestador, dt_mes_competencia, dt_mes_competencia_param, cd_estabelecimento, vl_glosa, vl_acatado, vl_apresentado) AS select	b.nr_sequencia nr_seq_conta,
	b.nr_seq_protocolo nr_seq_protocolo,
	to_char(b.nr_seq_prestador_exec) nr_seq_prestador,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'N'),1,255) nm_prestador,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'TR'),1,255) DS_TIPO_RELACAO,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'TP'),1,255) DS_TIPO_PRESTADOR,
	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0) dt_mes_competencia,
	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0) dt_mes_competencia_param,
	b.cd_estabelecimento,
	b.vl_glosa,
	0 vl_acatado,
	b.vl_cobrado vl_apresentado
FROM	pls_conta b,
	pls_protocolo_conta a
where	a.nr_sequencia = b.nr_seq_protocolo
and	b.vl_glosa <> 0

union all

select	b.nr_sequencia nr_seq_conta,
	a.nr_sequencia nr_seq_protocolo,
	to_char(b.nr_seq_prestador_exec) nr_seq_prestador,	
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'N'),1,255) nm_prestador,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'TR'),1,255) ds_tipo_relacao,
	substr(pls_obter_dados_prestador(b.nr_seq_prestador_exec,'TP'),1,255) ds_tipo_prestador,
	pkg_date_utils.start_of(g.dt_liberacao_pag, 'MONTH', 0) dt_mes_competencia,
	pkg_date_utils.start_of(a.dt_mes_competencia, 'MONTH', 0)  dt_mes_competencia_param,
	b.cd_estabelecimento,
	0 vl_glosa,
	f.vl_total_acatado,
	0 vl_apresentado
from	pls_protocolo_conta		a,
	pls_conta			b,
	pls_rec_glosa_conta 		f,
	pls_rec_glosa_protocolo		g
where	a.nr_sequencia			= b.nr_seq_protocolo
and	b.nr_sequencia			= f.nr_seq_conta
and	g.nr_sequencia			= f.nr_seq_protocolo
and	f.vl_total_acatado <> 0;

