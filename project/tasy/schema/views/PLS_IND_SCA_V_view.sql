-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_ind_sca_v (ds_estipulante, nm_estipulante, nr_seq_plano, ds_tipo_plano, nr_seq_vendedor_canal, nm_canal_venda, nr_seq_vendedor_pf, nm_vendedor, cd_pessoa_fisica, ds_municipio, dt_rescisao_benef, dt_adesao_benef, dt_inicio_vigencia, ie_mov_nova_venda) AS select	CASE WHEN a.cd_pf_estipulante IS NULL THEN 'PESSOA JURÍDICA'  ELSE 'PESSOA FÍSICA' END  ds_estipulante,
	substr(obter_nome_pf_pj(a.cd_pf_estipulante, a.cd_cgc_estipulante),1,200) nm_estipulante,	 
	d.nr_seq_plano, 
	substr(pls_obter_dados_produto(d.nr_seq_plano,'N'),1,255) ds_tipo_plano, 
	d.nr_seq_vendedor_canal, 
	substr(pls_obter_nomes_contrato(d.nr_seq_vendedor_canal,'VC'),1,255) nm_canal_venda, 
	d.nr_seq_vendedor_pf, 
	substr(pls_obter_nomes_contrato(d.nr_seq_vendedor_pf,'V'),1,255) nm_vendedor,	 
	c.cd_pessoa_fisica, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'DSM'),1,255) ds_municipio, 
	c.dt_rescisao dt_rescisao_benef, 
	c.dt_contratacao dt_adesao_benef, 
	d.dt_inicio_vigencia dt_inicio_vigencia, 
	'1' ie_mov_nova_venda -- Novas vendas 
FROM	pls_contrato		a, 
	pls_segurado		c, 
	pls_sca_vinculo		d 
where	a.nr_sequencia = c.nr_seq_contrato 
and	c.nr_sequencia = d.nr_seq_segurado 
and	c.dt_liberacao is not null 
and	c.ie_acao_contrato in ('A','S') 

union all
 
select	CASE WHEN a.cd_pf_estipulante IS NULL THEN 'PESSOA JURÍDICA'  ELSE 'PESSOA FÍSICA' END  ds_estipulante, 
	substr(obter_nome_pf_pj(a.cd_pf_estipulante, a.cd_cgc_estipulante),1,200) nm_estipulante,	 
	d.nr_seq_plano, 
	substr(pls_obter_dados_produto(d.nr_seq_plano,'N'),1,255) ds_tipo_plano, 
	d.nr_seq_vendedor_canal, 
	substr(pls_obter_nomes_contrato(d.nr_seq_vendedor_canal,'VC'),1,255) nm_canal_venda, 
	d.nr_seq_vendedor_pf, 
	substr(pls_obter_nomes_contrato(d.nr_seq_vendedor_pf,'V'),1,255) nm_vendedor,	 
	c.cd_pessoa_fisica, 
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1,'DSM'),1,255) ds_municipio, 
	c.dt_rescisao dt_rescisao_benef, 
	c.dt_contratacao dt_adesao_benef, 
	d.dt_inicio_vigencia dt_inicio_vigencia, 
	'2' ie_mov_nova_venda -- Movimentações 
from	pls_contrato		a, 
	pls_segurado		c, 
	pls_sca_vinculo		d 
where	a.nr_sequencia = c.nr_seq_contrato 
and	c.nr_sequencia = d.nr_seq_segurado 
and	c.dt_liberacao is not null 
and	c.ie_acao_contrato in ('M','L','D');

