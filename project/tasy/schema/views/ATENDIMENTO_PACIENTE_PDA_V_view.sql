-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW atendimento_paciente_pda_v (nr_atendimento, nr_atend_original, dt_entrada, cd_setor_atendimento, cd_pessoa_fisica, cd_unidade, ds_setor_atendimento, nm_unidade, ds_convenio, dt_nascimento, ds_idade) AS SELECT a.nr_atendimento,
	a.nr_atend_original, 
	a.dt_entrada, 
	b.cd_setor_atendimento, 
	a.cd_pessoa_fisica, 
	b.cd_unidade_basica || ' ' ||b.cd_unidade_compl cd_unidade, 
	s.ds_setor_atendimento, 
	s.nm_unidade_basica || ' ' ||s.nm_unidade_compl nm_unidade, 
	v.ds_convenio, 
	p.dt_nascimento, 
	CASE WHEN Trunc((LOCALTIMESTAMP - p.dt_nascimento)/365.25)=0 THEN  	Trunc((LOCALTIMESTAMP - p.dt_nascimento)/30) || ' Meses'  ELSE Trunc((LOCALTIMESTAMP - p.dt_nascimento)/365.25) || ' Anos' END  ds_idade 
FROM convenio v, categoria_convenio t, setor_atendimento s, pessoa_fisica p, pessoa_fisica m, atend_paciente_unidade b, atend_categoria_convenio c
LEFT OUTER JOIN convenio_origem_usuario k ON (c.nr_seq_origem = k.nr_sequencia)
, atendimento_paciente a
LEFT OUTER JOIN motivo_alta d ON (a.cd_motivo_alta = d.cd_motivo_alta)
LEFT OUTER JOIN medico n ON (a.cd_medico_resp = n.cd_pessoa_fisica)
WHERE (a.nr_atendimento 		= b.nr_atendimento) AND (b.nr_seq_interno 		= obter_atepacu_paciente(a.nr_atendimento, 'A')) AND (a.nr_atendimento 		= c.nr_atendimento) AND (c.nr_seq_interno 		= obter_atecaco_atendimento(a.nr_atendimento))  AND (b.cd_setor_atendimento	= s.cd_setor_atendimento) AND (c.cd_convenio		= v.cd_convenio) AND (a.cd_medico_resp		= m.cd_pessoa_fisica)  AND (a.cd_pessoa_fisica		= p.cd_pessoa_fisica)  AND (c.cd_convenio		= t.cd_convenio) AND (c.cd_categoria		= t.cd_categoria);

