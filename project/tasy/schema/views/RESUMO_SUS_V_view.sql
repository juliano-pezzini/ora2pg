-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW resumo_sus_v (ie_classif_sus, cd_grupo_sus, ie_tipo_atendimento, cd_convenio_parametro, dt_mesano_conta, nr_interno_conta, nr_atendimento, nr_seq_protocolo, cd_convenio, dt_mesano_referencia, nr_sequencia, cd_setor_receita, cd_setor_atendimento, ie_tipo_ato_sus, ie_tipo_servico_sus, cd_procedimento, cd_cgc_prestador, ds_procedimento, vl_materiais, vl_sh_rateado, vl_diaria, vl_taxas, vl_medico, vl_anestesista, vl_medico_sus, qt_ato_medico, qt_ato_anestesista, vl_sadt, vl_sadt_pc, vl_sadt_rx, vl_contraste, vl_gesso, vl_tph, vl_filme_rx, vl_filme_ressonancia, vl_anestesia, vl_ato_anestesista, vl_outros, vl_quimioterapia, vl_dialise, vl_matmed, vl_custo_operacional, vl_ponto_sadt, qt_procedimento, cd_tecnico, ie_cancelamento, ie_origem_proced, ie_doc_executor, vl_participante, ds_doc_executor, cd_grupo_sus_unif, ds_grupo_sus_unif) AS select CASE WHEN b.cd_grupo_sus=3 THEN 3 WHEN b.cd_grupo_sus=6 THEN 4 WHEN b.cd_grupo_sus=4 THEN 3 WHEN b.cd_grupo_sus=5 THEN 3 WHEN b.cd_grupo_sus=1 THEN 5 WHEN b.cd_grupo_sus=7 THEN 5 WHEN b.cd_grupo_sus=11 THEN 5 WHEN b.cd_grupo_sus=8 THEN 4 WHEN b.cd_grupo_sus=9 THEN 4 WHEN b.cd_grupo_sus=12 THEN 4 END  ie_classif_sus,
		b.cd_grupo_sus,
		d.ie_tipo_atendimento,
		c.cd_convenio_parametro,
		c.dt_mesano_referencia dt_mesano_conta,
            c.nr_interno_conta,
            c.nr_atendimento,
		e.nr_seq_protocolo,
		e.cd_convenio,
		e.dt_mesano_referencia,
		a.nr_sequencia,
		a.cd_setor_receita,
            a.cd_setor_atendimento,
		CASE WHEN b.cd_grupo_sus='7' THEN 999 WHEN b.cd_grupo_sus='11' THEN 998  ELSE a.ie_tipo_ato_sus END  ie_tipo_ato_sus,
		a.ie_tipo_servico_sus,
		a.cd_procedimento,
		a.cd_cgc_prestador,
		b.ds_procedimento,
		a.vl_materiais,
		coalesce(k.vl_sadt_rateado,a.vl_materiais) vl_sh_rateado,
		k.vl_diaria,
		k.vl_taxas,
		a.vl_medico,
		a.vl_anestesista,
		k.vl_medico vl_medico_sus,
		k.qt_ato_medico,
		k.qt_ato_anestesista,
		k.vl_sadt,
		k.vl_sadt_pc,
		k.vl_sadt_rx,
		k.vl_contraste,
		k.vl_gesso,
		k.vl_tph,
		k.vl_filme_rx,
		k.vl_filme_ressonancia,
		k.vl_anestesia,
		k.vl_ato_anestesista,
		k.vl_outros,
		k.vl_quimioterapia,
		k.vl_dialise,
            k.vl_matmed,
		a.vl_custo_operacional,
		k.vl_ponto_sadt,
		a.qt_procedimento,
		a.cd_pessoa_fisica cd_tecnico,
		c.ie_cancelamento,
		b.ie_origem_proced,
		coalesce(a.ie_doc_executor,5) ie_doc_executor,
		Obter_Valor_Participante(a.nr_sequencia) vl_participante,
		substr(obter_valor_dominio(2044,coalesce(a.ie_doc_executor,5)),1,30) ds_doc_executor,
		somente_numero(Sus_Obter_Estrut_Proc(a.cd_procedimento,a.ie_origem_proced,'C','G')) cd_grupo_sus_unif,
		substr(Sus_Obter_Estrut_Proc(a.cd_procedimento,a.ie_origem_proced,'D','G'),1,200) ds_grupo_sus_unif
FROM 	procedimento b,
 	atendimento_paciente d,
 	sus_valor_proc_paciente k,
	procedimento_paciente a,
 	conta_paciente c,
	protocolo_convenio e
where a.nr_interno_conta = c.nr_interno_conta
   and c.nr_atendimento = d.nr_atendimento
   and b.cd_procedimento = a.cd_procedimento
   and b.ie_origem_proced = a.ie_origem_proced
   and k.nr_sequencia = a.nr_sequencia
   and a.cd_motivo_exc_conta is null
   and c.nr_seq_protocolo = e.nr_seq_protocolo;

