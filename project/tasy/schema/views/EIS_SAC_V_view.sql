-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_sac_v (nr_ocorrencia, nr_seq_responsavel, nr_seq_classif, nr_seq_gravidade, nr_seq_tipo, ie_status, ie_tipo_atendimento, dt_mensal, dt_anual, ie_origem, ds_responsavel, ds_classif, ds_gravidade, ds_tipo_ocorrencia, ds_responsavel_tipo, ds_status, ds_mensal, ds_anual, ds_origem, dt_ocorrencia, ds_valor, cd_empresa, ds_setor_resposta, ds_tipo_atendimento, cd_setor_resposta, nr_seq_forma_reg, ds_forma_registro, ie_forma_envio, ds_forma_envio, nr_seq_tipo_ocor, ds_tipo_ocor_ind, cd_estabelecimento) AS select 1 nr_ocorrencia,
	b.nr_seq_responsavel,
	b.nr_seq_classif,
	b.nr_seq_gravidade,
	b.nr_seq_tipo,
	b.ie_status,
	b.ie_tipo_atendimento,
	trunc(a.dt_ocorrencia, 'month') dt_mensal,
	trunc(a.dt_ocorrencia, 'year') dt_anual,
	a.ie_origem,
	substr(obter_descricao_padrao('SAC_RESPONSAVEL','DS_RESPONSAVEL',b.nr_seq_responsavel),1,200) ds_responsavel,
	substr(obter_descricao_padrao('SAC_CLASSIF_OCORRENCIA','DS_CLASSIFICACAO',b.nr_seq_classif),1,200) ds_classif,
	substr(obter_descricao_padrao('SAC_GRAVIDADE','DS_GRAVIDADE',b.nr_seq_gravidade),1,100) ds_gravidade,
	CASE WHEN initcap(substr(obter_descricao_padrao('SAC_TIPO_OCORRENCIA',		'DS_TIPO_OCORRENCIA',b.nr_seq_tipo),1,100))='' THEN 		substr(obter_sac_responsavel(coalesce(b.nr_seq_tipo,0)),1,100)  ELSE initcap(substr(obter_descricao_padrao('SAC_TIPO_OCORRENCIA',		'DS_TIPO_OCORRENCIA',b.nr_seq_tipo),1,100)) || ' - ' ||		substr(obter_sac_responsavel(coalesce(b.nr_seq_tipo,0)),1,100) END  ds_tipo_ocorrencia,
	substr(obter_sac_responsavel(coalesce(b.nr_seq_tipo,0)),1,100) ds_responsavel_tipo,
	substr(obter_valor_dominio(1079, b.ie_status),1, 50) ds_status,
	substr(obter_data_extenso(a.dt_ocorrencia, 1),1, 50) ds_mensal,
	substr(obter_data_extenso(a.dt_ocorrencia, 2),1, 50) ds_anual,
	substr(obter_valor_dominio(1071, a.ie_origem),1, 50) ds_origem,
	a.dt_ocorrencia,
	(obter_min_entre_datas_fer(1,a.dt_ocorrencia, coalesce(b.dt_resposta, b.dt_atualizacao),1) / 60) ds_valor,
	substr(obter_empresa_estab(a.cd_estabelecimento),1,255) cd_empresa,
	substr(obter_nome_setor(b.cd_setor_resposta),1,254) ds_setor_resposta,
	substr(obter_valor_dominio(12, b.ie_tipo_atendimento),1, 255) ds_tipo_atendimento,
	b.cd_setor_resposta,
	a.nr_seq_forma_reg,
	substr(Sac_obter_desc_forma_reg(a.nr_seq_forma_reg),1,255) ds_forma_registro,
	a.ie_forma_envio,
	substr(obter_valor_dominio(1907,a.ie_forma_envio),1,255) ds_forma_envio,
	b.nr_seq_tipo_ocor,
	substr(obter_descricao_padrao('SAC_TIPO_OCOR','DS_TIPO_OCORRENCIA',b.nr_seq_tipo_ocor),1,200) DS_TIPO_OCOR_IND,
	a.cd_estabelecimento
 FROM   sac_resp_bol_ocor b,
        sac_boletim_ocorrencia a
 where  a.nr_sequencia         = b.nr_seq_bo;

