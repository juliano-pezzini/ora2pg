-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW estrutura_material_v (cd_grupo_material, ds_grupo_material, cd_subgrupo_material, ds_subgrupo_material, cd_classe_material, ds_classe_material, nr_seq_familia, ds_familia, cd_material, ds_material, ie_consignado, ie_situacao, ie_material_estoque, ie_tipo_classe, nr_seq_ficha_tecnica, cd_material_estoque, ie_tipo_material, ie_via_aplicacao, cd_yj_code) AS select	d.cd_grupo_material,
	d.ds_grupo_material,
	c.cd_subgrupo_material,
	c.ds_subgrupo_material,
	b.cd_classe_material,
	b.ds_classe_material,
	e.nr_sequencia nr_seq_familia,
	e.ds_familia,
	a.cd_material,
	a.ds_material,
	a.ie_consignado,
	a.ie_situacao,
	(select coalesce(max(f.ie_material_estoque),a.ie_material_estoque)
      FROM material_estab f
      where f.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento
      and f.cd_material = a.cd_material) ie_material_estoque,
	b.ie_tipo_classe,
	a.NR_SEQ_FICHA_TECNICA,
	a.cd_material_estoque,
	a.ie_tipo_material,
	a.ie_via_aplicacao,
	a.cd_yj_code
FROM grupo_material d, subgrupo_material c, classe_material b, material a
LEFT OUTER JOIN material_familia e ON (a.nr_seq_familia = e.nr_sequencia)
WHERE a.cd_classe_material	= b.cd_classe_material and b.cd_subgrupo_material	= c.cd_subgrupo_material and c.cd_grupo_material	= d.cd_grupo_material;

