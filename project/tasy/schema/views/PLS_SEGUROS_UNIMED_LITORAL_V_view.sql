-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_seguros_unimed_litoral_v (ie_tipo_registro, nr_seq_lote, nm_estipulante, cd_grupo, dt_competencia, cd_subgrupo, cd_matricula, nm_segurado, dt_nascimento, ds_sexo, nr_cpf, vl_capital_vg, vl_capital_ap, vl_capital_serit, vl_salario, ds_endereco, ds_municipio, sg_uf, cd_cep, ds_bairro, ds_cargo) AS select	1 						IE_TIPO_REGISTRO,
	nr_sequencia					NR_SEQ_LOTE,
	'UNIMED LITORAL COOP. DE TRAB. MEDICO LTDA'	NM_ESTIPULANTE,
	22857						CD_GRUPO,
	to_char(dt_mesano_referencia, 'mm/yy')		DT_COMPETENCIA,
	null						CD_SUBGRUPO,
	null						CD_MATRICULA,
	null						NM_SEGURADO,
	null						DT_NASCIMENTO,
	null						DS_SEXO,
	null						NR_CPF,
	null						VL_CAPITAL_VG,
	null						VL_CAPITAL_AP,
	null						VL_CAPITAL_SERIT,
	null						VL_SALARIO,
	null						DS_ENDERECO,
	null						DS_MUNICIPIO,
	null						SG_UF,
	null						CD_CEP,
	null						DS_BAIRRO,
	null						DS_CARGO
FROM	ptu_mov_produto_lote

union all

select	2 						IE_TIPO_REGISTRO,
	e.nr_sequencia					NR_SEQ_LOTE,
	null						NM_ESTIPULANTE,
	null						CD_GRUPO,
	null						DT_COMPETENCIA,
	11						CD_SUBGRUPO,
	f.cd_familia					CD_MATRICULA,
	a.nm_pessoa_fisica				NM_SEGURADO,
	a.dt_nascimento				 	DT_NASCIMENTO,
	a.ie_sexo					DS_SEXO,
	a.nr_CPF					NR_CPF,
	8000						VL_CAPITAL_VG,
	10000						VL_CAPITAL_AP,
	0				 		VL_CAPITAL_SERIT,
	0						VL_SALARIO,
	b.ds_endereco 	||' NÂº '|| b.nr_endereco
			|| '  ' || b.ds_complemento	DS_ENDERECO,
	b.ds_municipio					DS_MUNICIPIO,
	b.sg_estado					SG_UF,
	b.cd_cep					CD_CEP,
	b.ds_bairro					DS_BAIRRO,
	0						DS_CARGO
from	pessoa_fisica			a,
	compl_pessoa_fisica		b,
	ptu_mov_produto_empresa		c,
	ptu_movimentacao_produto	d,
	ptu_mov_produto_lote		e,
	ptu_mov_produto_benef		f,
	pls_segurado			g
where	a.cd_pessoa_fisica		= g.cd_pessoa_fisica
and	a.cd_pessoa_fisica		= b.cd_pessoa_fisica
and	c.nr_seq_mov_produto		= d.nr_sequencia
and	d.nr_seq_lote			= e.nr_sequencia
and	f.nr_seq_empresa		= c.nr_sequencia
and	f.nr_seq_segurado		= g.nr_sequencia
and	((b.ie_tipo_complemento = 1) or (b.ie_tipo_complemento = 2 and not exists (	select	1
											from	compl_pessoa_fisica
											where	cd_pessoa_fisica = a.cd_pessoa_fisica
											and	ie_tipo_complemento = 1)));

