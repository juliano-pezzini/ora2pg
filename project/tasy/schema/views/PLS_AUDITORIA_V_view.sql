-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_auditoria_v (nr_sequencia, dt_auditoria, ie_tipo_auditoria, ie_status, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_guia, nr_seq_requisicao, nr_seq_regra, cd_guia, nr_seq_prestador, nr_seq_segurado, ie_tipo_guia, dt_solicitacao, cd_medico_solicitante, dt_liberacao, cd_estabelecimento, nr_seq_auditoria_ant, nr_telef_secretaria, nm_secretaria, nr_telef_beneficiario, nr_telef_celular_benef, nr_seq_execucao, ds_observacao, ie_auditoria_estipulante, dt_conferencia_intercambio, ie_visualizada_estip, nr_seq_proc_interno, ds_indicacao_clinica, ds_email_beneficiario, ie_permite_just_prestadores, ie_prioridade, nr_seq_prioridade_analise, qt_dias_vencidos, ie_anexo_guia, ie_anexo_opme, ie_anexo_quimioterapia, ie_anexo_radioterapia, ie_permite_compl_opme, qt_dias_vencer, dt_vencimento, nm_recem_nascido, dt_nasc_recem_nascido, ie_recem_nascido, ie_retorno_justific, ie_tipo_processo, ds_tipo_guia, ds_tipo_processo, nr_carteirinha, nm_segurado, qt_idade_benef, ie_sexo_benef, nm_medico_solicitante, nm_prestador, ds_tempo_liberacao, cd_unimed_exec, ds_unimed_exec, cd_unimed_orig, ds_unimed_orig, cd_guia_manual, dt_atendimento_origem, ie_prestador_alto_custo, ds_carater_atendimento, qt_auditoria_grupo, dt_tempo_liberacao, ie_usuario_auditor_grupo, ie_exige_senha_ext, nr_crm, ie_auditoria_intercambio, ie_tipo_referencia, ds_especiallidades_medica, nr_seq_tran_origem, nr_seq_tran_execucao, nm_prestador_exec, nr_seq_plano_f, ds_plano_f, nr_seq_contrato_f, ds_contrato_f, ds_tipo_atendimento, cd_guia_principal, ds_matricula_estipulante) AS select  a.NR_SEQUENCIA,a.DT_AUDITORIA,a.IE_TIPO_AUDITORIA,a.IE_STATUS,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_SEQ_GUIA,a.NR_SEQ_REQUISICAO,a.NR_SEQ_REGRA,a.CD_GUIA,a.NR_SEQ_PRESTADOR,a.NR_SEQ_SEGURADO,a.IE_TIPO_GUIA,a.DT_SOLICITACAO,a.CD_MEDICO_SOLICITANTE,a.DT_LIBERACAO,a.CD_ESTABELECIMENTO,a.NR_SEQ_AUDITORIA_ANT,a.NR_TELEF_SECRETARIA,a.NM_SECRETARIA,a.NR_TELEF_BENEFICIARIO,a.NR_TELEF_CELULAR_BENEF,a.NR_SEQ_EXECUCAO,a.DS_OBSERVACAO,a.IE_AUDITORIA_ESTIPULANTE,a.DT_CONFERENCIA_INTERCAMBIO,a.IE_VISUALIZADA_ESTIP,a.NR_SEQ_PROC_INTERNO,a.DS_INDICACAO_CLINICA,a.DS_EMAIL_BENEFICIARIO,a.IE_PERMITE_JUST_PRESTADORES,a.IE_PRIORIDADE,a.NR_SEQ_PRIORIDADE_ANALISE,a.QT_DIAS_VENCIDOS,a.IE_ANEXO_GUIA,a.IE_ANEXO_OPME,a.IE_ANEXO_QUIMIOTERAPIA,a.IE_ANEXO_RADIOTERAPIA,a.IE_PERMITE_COMPL_OPME,a.QT_DIAS_VENCER,a.DT_VENCIMENTO,a.NM_RECEM_NASCIDO,a.DT_NASC_RECEM_NASCIDO,a.IE_RECEM_NASCIDO,a.IE_RETORNO_JUSTIFIC,a.IE_TIPO_PROCESSO,
	substr(obter_valor_dominio(1746,IE_TIPO_GUIA),1,255) DS_TIPO_GUIA,
	substr(obter_valor_dominio(2627,ie_tipo_processo),1,255) DS_TIPO_PROCESSO,
	substr(pls_obter_carteira_segurado(nr_seq_segurado),1,255) NR_CARTEIRINHA,
	substr(pls_obter_nome_beneficiario(nr_seq_segurado),1,255) NM_SEGURADO,
	substr(pls_obter_tempo_vida_benef(nr_seq_segurado,'A'),1,255) QT_IDADE_BENEF,
	substr(pls_obter_dados_segurado(nr_seq_segurado, 'SXS'),1,2) IE_SEXO_BENEF,
	substr(obter_nome_pf(cd_medico_solicitante),1,80) NM_MEDICO_SOLICITANTE,
	substr(pls_obter_dados_prestador(nr_seq_prestador, 'N'),1,255) NM_PRESTADOR,
	substr(obter_horas_minutos_segundos((coalesce(dt_liberacao, LOCALTIMESTAMP) - dt_atualizacao_nrec) * 86400),1,10) DS_TEMPO_LIBERACAO,
	substr(pls_obter_dados_analise_aut(nr_sequencia,'OE'),1,255) CD_UNIMED_EXEC,
	substr(pls_obter_desc_cooperativa(pls_obter_dados_analise_aut(nr_sequencia,'OE')),1,255) DS_UNIMED_EXEC,
	substr(pls_obter_dados_analise_aut(nr_sequencia,'OO'),1,255) CD_UNIMED_ORIG,
	substr(pls_obter_desc_cooperativa(pls_obter_dados_analise_aut(nr_sequencia,'OO')),1,255) DS_UNIMED_ORIG,
	substr(pls_obter_cd_guia_manual(nr_seq_guia,'M'),1,20) CD_GUIA_MANUAL,
	substr(pls_obter_dados_pedido_aut_scs(null, nr_seq_requisicao, null, 1),1,255) DT_ATENDIMENTO_ORIGEM,
	substr(coalesce(pls_obter_dados_prestador(pls_obter_dados_requisicao(nr_seq_requisicao,'PE'),'AC') ,
	pls_obter_dados_pedido_aut_scs(null,nr_seq_requisicao,null,2)),1,255) IE_PRESTADOR_ALTO_CUSTO,
	substr(pls_obter_carater_atend_analis(nr_seq_guia, nr_seq_requisicao, nr_seq_execucao),1,255) DS_CARATER_ATENDIMENTO,
	substr(pls_obter_qtd_auditoria_grupo(nr_sequencia),1,10) QT_AUDITORIA_GRUPO,
	round((coalesce(dt_liberacao, LOCALTIMESTAMP) - dt_atualizacao_nrec) * 24,2) DT_TEMPO_LIBERACAO,
	substr(obter_usuario_auditoria_grupo(nr_sequencia),1,10) IE_USUARIO_AUDITOR_GRUPO,
	substr(pls_obter_se_exige_senha_ext(nr_seq_guia, nr_seq_requisicao),1,80) IE_EXIGE_SENHA_EXT,
	substr(obter_crm_medico(cd_medico_solicitante),1,255) NR_CRM,
	substr(pls_obter_se_auditoria_interc(nr_seq_guia,nr_seq_requisicao),1,4) IE_AUDITORIA_INTERCAMBIO,
	substr(pls_obter_se_req_vinculadas(nr_seq_requisicao),1,4) IE_TIPO_REFERENCIA,
	substr(obter_especialidades_medico(cd_medico_solicitante),1,255) DS_ESPECIALLIDADES_MEDICA,
	substr(pls_obter_transacao_scs(nr_sequencia, 'TOO'), 1, 255) NR_SEQ_TRAN_ORIGEM,
	substr(pls_obter_transacao_scs(nr_sequencia, 'TOE'), 1, 255) NR_SEQ_TRAN_EXECUCAO,
	coalesce(substr(pls_obter_dados_requisicao(nr_seq_requisicao, 'NPE'),1,255),(substr(pls_obter_dados_execucao(nr_seq_execucao, 'NP'),1,255))) NM_PRESTADOR_EXEC,
	substr(PLS_OBTER_PRODUTO_BENEF(NR_SEQ_SEGURADO, LOCALTIMESTAMP),1,255) NR_SEQ_PLANO_F,
	substr(pls_obter_dados_segurado(nr_seq_segurado, 'P'),1,255) DS_PLANO_F,
	coalesce((pls_obter_dados_segurado(nr_seq_segurado,'NC'))::numeric ,(pls_obter_dados_segurado(nr_seq_segurado,'NRCI'))::numeric )NR_SEQ_CONTRATO_F,
	substr(pls_obter_dados_segurado(nr_seq_segurado, 'ES'),1,255) DS_CONTRATO_F,
	substr(coalesce(pls_obter_dados_guia_plano(nr_seq_guia,null,'DTA'),pls_obter_dados_requisicao(nr_seq_requisicao,'DTA')),1,255) DS_TIPO_ATENDIMENTO,
	substr(pls_obter_guia_principal(nr_seq_guia, nr_seq_requisicao, nr_seq_execucao),1,255) CD_GUIA_PRINCIPAL,
	substr(pls_obter_dados_segurado(nr_seq_segurado,'CME'),1,255) DS_MATRICULA_ESTIPULANTE
 FROM PLS_AUDITORIA a;

