-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_sinistro_milliman_v (cd_associado, cd_regiao, dt_ocorrencia, dt_aviso, cd_eventos, cd_especialidade, vl_sinistro, vl_reembolso, vl_pagamento, nr_diarias, nr_cti_uti, vl_coparticipacao, ie_tipo_atendimento, ie_tipo_acomodacao, cd_amb, dt_pagamento, cd_guia_internacao, tp_registro, cd_guia_ambulatorial, qt_procedimento, cd_classificacao_sip, cd_classificacao_sip_sub, ie_tipo_contratacao, ie_regime_internacao, cd_versao_sip, nr_seq_lote, cd_cpf_cnpj_prestador, cd_procedimento_proprio, cd_procedimento_tuss) AS select	cd_usuario_plano		cd_associado,
	sg_ocorrencia			cd_regiao, 
	dt_ocorrencia			dt_ocorrencia, 
	dt_aviso			dt_aviso, 
	cd_evento			cd_eventos, 
	cd_especialidade		cd_especialidade, 
	vl_sinistro			vl_sinistro, 
	vl_reembolso			vl_reembolso, 
	vl_pagamento			vl_pagamento, 
	qt_diaria_uti			nr_diarias, 
	qt_diaria_cti_uti		nr_cti_uti, 
	vl_coparticipacao		vl_coparticipacao, 
	ie_tipo_atendimento		ie_tipo_atendimento, 
	ie_tipo_acomodacao		ie_tipo_acomodacao, 
	cd_procedimento			cd_amb, 
	dt_pagamento			dt_pagamento, 
	cd_guia_internacao		cd_guia_internacao, 
	''				tp_registro, 
	cd_guia_ambulatorial		cd_guia_ambulatorial, 
	qt_procedimento			qt_procedimento, 
	ds_item_despesa_sip		cd_classificacao_sip, 
	ds_subitem_despesa_sip		cd_classificacao_sip_sub, 
	ie_tipo_contratacao		ie_tipo_contratacao, 
	ie_regime_internacao		ie_regime_internacao, 
	ds_versao_sip			cd_versao_sip, 
	nr_seq_lote			nr_seq_lote, 
	substr(CASE WHEN pls_obter_dados_prestador(nr_seq_prestador,'CPF')='' THEN pls_obter_dados_prestador(nr_seq_prestador,'CGC')  ELSE pls_obter_dados_prestador(nr_seq_prestador,'CPF') END ,1,14)  cd_cpf_cnpj_prestador, 
	CASE WHEN ie_origem_proced=4 THEN cd_procedimento END  cd_procedimento_proprio, 
	CASE WHEN ie_origem_proced=5 THEN cd_procedimento END  cd_procedimento_tuss 
FROM	pls_milliman_sinistro;

