-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_segurado_preco_v (ie_plano_sca, nr_seq_segurado, nm_pessoa_fisica, dt_reajuste, qt_idade, cd_motivo_reajuste, ds_motivo_reajuste, nr_contrato, nr_seq_intercambio, ie_tipo_contrato, vl_preco_ant, vl_preco_atual, vl_reajuste, dt_rescisao) AS SELECT	'P' ie_plano_sca,
	b.nr_sequencia nr_seq_segurado,
	c.nm_pessoa_fisica,
	a.dt_reajuste,
	a.qt_idade,
	a.cd_motivo_reajuste,
	SUBSTR(obter_valor_dominio(1728,a.cd_motivo_reajuste),1,255) ds_motivo_reajuste,
	d.nr_contrato,
	NULL nr_seq_intercambio,
	CASE WHEN d.cd_pf_estipulante IS NULL THEN 'PJ'  ELSE 'PF' END  ie_tipo_contrato,
	a.vl_preco_ant,
	a.vl_preco_atual,
	(a.vl_preco_atual - a.vl_preco_ant) vl_reajuste,
	b.dt_rescisao
	FROM pls_segurado_preco a,
	pls_segurado b,
	pessoa_fisica c,
	pls_contrato d
WHERE	a.nr_seq_segurado   = b.nr_sequencia
AND	b.cd_pessoa_fisica  = c.cd_pessoa_fisica
AND	b.nr_seq_contrato   = d.nr_sequencia
AND	a.dt_liberacao     IS NOT NULL

UNION ALL

SELECT	'P' ie_plano_sca,
	b.nr_sequencia nr_seq_segurado,
	c.nm_pessoa_fisica,
	a.dt_reajuste,
	a.qt_idade,
	a.cd_motivo_reajuste,
	SUBSTR(obter_valor_dominio(1728,a.cd_motivo_reajuste),1,255) ds_motivo_reajuste,
	NULL nr_contrato,
	d.nr_sequencia nr_seq_intercambio,
	CASE WHEN d.cd_pessoa_fisica IS NULL THEN 'PJ'  ELSE 'PF' END  ie_tipo_contrato,
	a.vl_preco_ant,
	a.vl_preco_atual,
	(a.vl_preco_atual - a.vl_preco_ant) vl_reajuste,
	b.dt_rescisao
FROM	pls_segurado_preco a,
	pls_segurado b,
	pessoa_fisica c,
	pls_intercambio d
WHERE	a.nr_seq_segurado    = b.nr_sequencia
AND	b.cd_pessoa_fisica   = c.cd_pessoa_fisica
AND	b.nr_seq_intercambio = d.nr_sequencia
AND	a.dt_liberacao      IS NOT NULL

UNION ALL

/* SCA */

SELECT	'S' ie_plano_sca,
	b.nr_sequencia nr_seq_segurado,
	c.nm_pessoa_fisica,
	a.dt_reajuste,
	a.qt_idade,
	a.cd_motivo_reajuste,
	SUBSTR(obter_valor_dominio(1728,a.cd_motivo_reajuste),1,255) ds_motivo_reajuste,
	d.nr_contrato,
	NULL nr_seq_intercambio,
	CASE WHEN d.cd_pf_estipulante IS NULL THEN 'PJ'  ELSE 'PF' END  ie_tipo_contrato,
	a.vl_preco_ant,
	a.vl_preco_atual,
	(a.vl_preco_atual - a.vl_preco_ant) vl_reajuste,
	b.dt_rescisao
FROM	pls_segurado_preco_origem a,
	pls_segurado b,
	pessoa_fisica c,
	pls_contrato d
WHERE	a.nr_seq_segurado   = b.nr_sequencia
AND	b.cd_pessoa_fisica  = c.cd_pessoa_fisica
AND	b.nr_seq_contrato   = d.nr_sequencia
AND	a.dt_liberacao     IS NOT NULL

UNION ALL

SELECT 'S' ie_plano_sca,
	b.nr_sequencia nr_seq_segurado,
	c.nm_pessoa_fisica,
	a.dt_reajuste,
	a.qt_idade,
	a.cd_motivo_reajuste,
	SUBSTR(obter_valor_dominio(1728,a.cd_motivo_reajuste),1,255) ds_motivo_reajuste,
	NULL nr_contrato,
	d.nr_sequencia nr_seq_intercambio,
	CASE WHEN d.cd_pessoa_fisica IS NULL THEN 'PJ'  ELSE 'PF' END  ie_tipo_contrato,
	a.vl_preco_ant,
	a.vl_preco_atual,
	(a.vl_preco_atual - a.vl_preco_ant) vl_reajuste,
	b.dt_rescisao
FROM	pls_segurado_preco_origem a,
	pls_segurado b,
	pessoa_fisica c,
	pls_intercambio d
WHERE	a.nr_seq_segurado    = b.nr_sequencia
AND	b.cd_pessoa_fisica   = c.cd_pessoa_fisica
AND	b.nr_seq_intercambio = d.nr_sequencia
AND	a.dt_liberacao      IS NOT NULL;

