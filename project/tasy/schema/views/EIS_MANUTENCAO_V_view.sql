-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_manutencao_v (dt_execucao, cd_setor_atendimento, nr_grupo_planej, nr_grupo_trabalho, nr_seq_tipo_equip, ie_prioridade, ie_parado, ie_tipo_ordem, qt_dia_exec, qt_dia_atraso, ie_informacao, qt_manutencao, nm_usuario_ativ, nr_seq_funcao, nr_seq_tipo_solucao, ie_prim_atend, ie_grau_satisfacao, ie_classificacao, ie_status_ordem, nr_seq_causa_dano, vl_cobranca, nr_seq_localizacao, cd_pessoa_solicitante, nm_usuario_inicio_exec, nm_usuario_exec, cd_funcao, ie_forma_receb, nr_seq_equipamento, nr_seq_classif, nr_seq_estagio, cd_centro_custo, nr_seq_cs, nr_seq_tipo_cs, nr_seq_categoria, nr_seq_tipo_ordem, cd_estabelecimento, ds_usuario_exec, ds_usuario_inicio_exec, nm_usuario_nrec, ds_usuario_nrec, nr_seq_complex, ie_sla, qt_encerrada, qt_hora, qt_equipamento, qt_total, vl_total_os_ativ, qt_hora_estagio, qt_back_log, dt_referencia, ds_setor_atendimento, ds_tipo_equipamento, ds_grupo_trabalho, ds_grupo_planejamento, ds_solucao, ds_prioridade, ds_parado, ds_classificacao, ds_tipo_ordem, ds_funcao, ds_status_ordem, ds_grau_satisfacao, ds_forma_receb, ds_causa_dano, ds_localizacao, nm_solicitante, ds_dia_semana, ds_funcao_tasy, nr_seq_modulo, ds_modulo, ie_area, ds_area, ds_equipamento, ds_imob_equipamento, ds_fabricante, ds_classif_cliente, ds_estagio, ds_centro_custo, cd_imobilizado, ds_servico_catalogo, ds_tipo_servico_catalogo, ds_categoria_equip, ds_tipo_os_cliente, nr_seq_familia_equip, ds_familia_equip, cd_centro_cus_solic, ds_centro_cus_solic, ds_complexidade, nr_seq_andar_local, ds_andar_local, nr_seq_marca, nr_seq_modelo, ds_marca_equip, ds_modelo_equip, ds_sla, nr_seq_motivo_cancel, ds_motivo_cancel) AS SELECT	a.DT_EXECUCAO,a.CD_SETOR_ATENDIMENTO,a.NR_GRUPO_PLANEJ,a.NR_GRUPO_TRABALHO,a.NR_SEQ_TIPO_EQUIP,a.IE_PRIORIDADE,a.IE_PARADO,a.IE_TIPO_ORDEM,a.QT_DIA_EXEC,a.QT_DIA_ATRASO,a.IE_INFORMACAO,a.QT_MANUTENCAO,a.NM_USUARIO_ATIV,a.NR_SEQ_FUNCAO,a.NR_SEQ_TIPO_SOLUCAO,a.IE_PRIM_ATEND,a.IE_GRAU_SATISFACAO,a.IE_CLASSIFICACAO,a.IE_STATUS_ORDEM,a.NR_SEQ_CAUSA_DANO,a.VL_COBRANCA,a.NR_SEQ_LOCALIZACAO,a.CD_PESSOA_SOLICITANTE,a.NM_USUARIO_INICIO_EXEC,a.NM_USUARIO_EXEC,a.CD_FUNCAO,a.IE_FORMA_RECEB,a.NR_SEQ_EQUIPAMENTO,a.NR_SEQ_CLASSIF,a.NR_SEQ_ESTAGIO,a.CD_CENTRO_CUSTO,a.NR_SEQ_CS,a.NR_SEQ_TIPO_CS,a.NR_SEQ_CATEGORIA,a.NR_SEQ_TIPO_ORDEM,a.CD_ESTABELECIMENTO,a.DS_USUARIO_EXEC,a.DS_USUARIO_INICIO_EXEC,a.NM_USUARIO_NREC,a.DS_USUARIO_NREC,a.NR_SEQ_COMPLEX,a.IE_SLA,
	CASE WHEN a.ie_informacao=0 THEN a.qt_manutencao  ELSE 0 END  qt_encerrada,
	CASE WHEN a.ie_informacao=1 THEN a.qt_manutencao  ELSE 0 END  qt_hora,
	CASE WHEN a.ie_informacao=2 THEN a.qt_manutencao  ELSE 0 END  qt_equipamento,
	CASE WHEN a.ie_informacao=3 THEN a.qt_manutencao  ELSE 0 END  qt_total,
	CASE WHEN a.ie_informacao=4 THEN a.qt_manutencao  ELSE 0 END  vl_total_os_ativ,
	CASE WHEN a.ie_informacao=5 THEN a.qt_manutencao  ELSE 0 END  qt_hora_estagio,
	CASE WHEN a.ie_informacao=6 THEN a.qt_manutencao  ELSE 0 END  qt_back_log,
	TRUNC(a.dt_execucao,'mm') dt_referencia,
	s.ds_setor_atendimento,
	t.ds_tipo_equip ds_tipo_equipamento,
	SUBSTR(obter_desc_expressao(g.cd_exp_grupo_trabalho,g.ds_grupo_trabalho),1,255) ds_grupo_trabalho,
	p.ds_grupo_planej ds_grupo_planejamento,
	o.ds_solucao,
	obter_valor_dominio(1046, a.ie_prioridade) ds_prioridade,
	CASE WHEN a.ie_parado='S' THEN  wheb_mensagem_pck.get_Texto(798785) WHEN a.ie_parado='N' THEN wheb_mensagem_pck.get_Texto(798786) WHEN a.ie_parado='P' THEN wheb_mensagem_pck.get_Texto(1046122) END  ds_parado,
	obter_valor_dominio(1149, a.ie_classificacao) ds_classificacao,
	obter_valor_dominio(1091, a.ie_tipo_ordem) ds_tipo_ordem,
	f.ds_funcao,
	obter_valor_dominio(1279, a.ie_status_ordem) ds_status_ordem,
	obter_valor_dominio(1197, a.ie_grau_satisfacao) ds_grau_satisfacao,
	obter_valor_dominio(1260, a.ie_forma_receb) ds_forma_receb,
	u.ds_causa ds_causa_dano,
	l.ds_localizacao,
	SUBSTR(obter_nome_pf(a.cd_pessoa_solicitante),1,60) nm_solicitante,
	SUBSTR(obter_dia_semana(a.dt_execucao),1,20) ds_dia_semana,
	substr(obter_desc_expressao(n.cd_exp_funcao,n.ds_funcao),1,255) ds_funcao_tasy,
	n.nr_seq_mod_impl nr_seq_modulo,
	m.nm_modulo ds_modulo,
	m.ie_area_tasy ie_area,
	SUBSTR(obter_valor_dominio(1867,m.ie_area_tasy),1,255) ds_area,
	e.ds_equipamento,
	e.ds_equipamento || ' - ' || e.cd_imobilizado ds_imob_equipamento,
	SUBSTR(man_obter_dados_equipamento(a.nr_seq_equipamento, 'F'),1,80) ds_fabricante,
	i.ds_classificacao ds_classif_cliente,
	SUBSTR(obter_desc_expressao(r.cd_exp_estagio,r.ds_estagio),1,40) ds_estagio,
	SUBSTR(obter_desc_centro_custo(a.cd_centro_custo),1,255) ds_centro_custo,
	e.cd_imobilizado,
	SUBSTR(man_obter_dados_catal_servico(a.nr_seq_cs, 'D'),1,255) ds_servico_catalogo,
	SUBSTR(man_obter_dados_catal_servico(a.nr_seq_cs, 'DT'),1,255) ds_tipo_servico_catalogo,
	SUBSTR(man_obter_dados_equipamento(a.nr_seq_equipamento,'CE'),1,50) ds_categoria_equip,
	SUBSTR(obter_desc_expressao(v.cd_exp_tipo,v.ds_tipo),1,255) ds_tipo_os_cliente,
	e.nr_seq_familia nr_seq_familia_equip,
	SUBSTR(man_obter_desc_familia_equip(e.nr_seq_familia),1,255) ds_familia_equip,
	SUBSTR(man_obter_dados_solicitante(a.cd_pessoa_solicitante,'CC'),1,255) cd_centro_cus_solic,
	SUBSTR(man_obter_dados_solicitante(a.cd_pessoa_solicitante,'DCC'),1,255) ds_centro_cus_solic,
	SUBSTR(man_obter_complexidade(a.nr_seq_complex),1,60) ds_complexidade,
	l.nr_seq_andar nr_seq_andar_local,
	z.ds_andar ds_andar_local,
	e.nr_seq_marca,
	e.nr_seq_modelo,
	SUBSTR(man_obter_desc_marca_equip(e.nr_seq_marca),1,255) ds_marca_equip,
	SUBSTR(man_obter_desc_modelo_equip(e.nr_seq_modelo),1,255) ds_modelo_equip,
	CASE WHEN a.ie_sla='S' THEN wheb_mensagem_pck.get_Texto(798785)  ELSE wheb_mensagem_pck.get_Texto(798786) END  ds_sla,
	a.nr_seq_motivo_cancel,
	substr(Obter_Descricao_Padrao('MAN_MOTIVO_CANCEL_OS','DS_MOTIVO_CANCEL',a.nr_seq_motivo_cancel),1,255) ds_motivo_cancel
FROM eis_manutencao a
LEFT OUTER JOIN setor_atendimento s ON (a.cd_setor_atendimento = s.cd_setor_atendimento)
LEFT OUTER JOIN man_tipo_equipamento t ON (a.nr_seq_tipo_equip = t.nr_sequencia)
LEFT OUTER JOIN man_grupo_trabalho g ON (a.nr_grupo_trabalho = g.nr_sequencia)
LEFT OUTER JOIN man_grupo_planejamento p ON (a.nr_grupo_planej = p.nr_sequencia)
LEFT OUTER JOIN man_tipo_solucao o ON (a.nr_seq_tipo_solucao = o.nr_sequencia)
LEFT OUTER JOIN man_tipo_funcao f ON (a.nr_seq_funcao = f.nr_sequencia)
LEFT OUTER JOIN man_causa_dano u ON (a.nr_seq_causa_dano = u.nr_sequencia)
LEFT OUTER JOIN man_localizacao l ON (a.nr_seq_localizacao = l.nr_sequencia)
LEFT OUTER JOIN man_equipamento e ON (a.nr_seq_equipamento = e.nr_sequencia)
LEFT OUTER JOIN funcao n ON (a.cd_funcao = n.cd_funcao)
LEFT OUTER JOIN man_classificacao i ON (a.nr_seq_classif = i.nr_sequencia)
LEFT OUTER JOIN man_tipo_ordem_servico v ON (a.nr_seq_tipo_ordem = v.nr_sequencia)
LEFT OUTER JOIN man_estagio_processo r ON (a.nr_seq_estagio = r.nr_sequencia)
LEFT OUTER JOIN andar_setor z ON (l.nr_seq_andar = z.nr_sequencia)
LEFT OUTER JOIN modulo_implantacao m ON (n.nr_seq_mod_impl = m.nr_sequencia);

