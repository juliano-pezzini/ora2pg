-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_cart_definit_unimed_sjc_v (tp_registro, nr_cartao, nm_benef, dt_nasc, dt_validade, ie_tp_plano, nm_contrante, nr_via, ie_contrato, carencia_1, carencia_2, carencia_3, carencia_4, carencia_5, carencia_6, carencia_7, carencia_8, carencia_9, carencia_10, carencia_11, ds_magnetic_1, ds_magnetic_2, ds_magnetic_3, mens_front_1, ds_agrangencia, ds_rede, cd_unimed_des, nm_plano, dt_cpt, ds_area_acao, ds_reg_ans, cd_funcao, ds_forma_pgto, ds_reg_coop_prod, ds_reg_coop_ans, ie_fim, nr_seq_lote, nr_seq_segurado) AS select	1															tp_registro,
	' '															nr_cartao, 
	' '															nm_benef, 
	null															dt_nasc, 
	null															dt_validade, 
	' '															ie_tp_plano, 
	' '															nm_contrante, 
	null															nr_via, 
	' '															ie_contrato, 
	' '															carencia_1, 
	' '															carencia_2, 
	' '															carencia_3, 
	' '															carencia_4, 
	' '															carencia_5, 
	' '															carencia_6, 
	' '															carencia_7, 
	' '															carencia_8, 
	' '															carencia_9, 
	' '															carencia_10, 
	' '															carencia_11, 
	' '															ds_magnetic_1, 
	' '															ds_magnetic_2, 
	' '															ds_magnetic_3, 
	' '															mens_front_1, 
	' '															ds_agrangencia, 
	' '															ds_rede, 
	' '															cd_unimed_des, 
	' '															nm_plano, 
	' '															dt_cpt, 
	' '															ds_area_acao, 
	' '															ds_reg_ans, 
	' '															cd_funcao, 
	' '															ds_forma_pgto, 
	' '															ds_reg_coop_prod, 
	' '															ds_reg_coop_ans, 
	' '															ie_fim, 
	a.nr_sequencia														nr_seq_lote, 
	null															nr_seq_segurado 
FROM	pls_lote_carteira	a 
where	a.ie_tipo_lote		= 'E' 

union
 
select	2															tp_registro, 
	substr(c.cd_usuario_plano,1,1) ||' ' || substr(c.cd_usuario_plano,2,3) ||' '|| substr(c.cd_usuario_plano,5,12) || ' '|| substr(c.cd_usuario_plano,17,1) nr_cartao, 
	upper(substr(pls_gerar_nome_abreviado(f.nm_pessoa_fisica),1,35)) 							nm_benef, 
	to_char(f.dt_nascimento,'dd/mm/yyyy')											dt_nasc, 
	c.dt_validade_carteira													dt_validade, 
	substr(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'DASJ',0),1,255)			 		ie_tp_plano, 
	upper(substr(CASE WHEN e.cd_pf_estipulante='' THEN obter_nome_fantasia_pj(e.cd_cgc_estipulante)  ELSE obter_nome_pf(e.cd_pf_estipulante) END ,1,255)) nm_contrante, 
	c.nr_via_solicitacao													nr_via, 
	upper(CASE WHEN g.ie_tipo_contratacao='I' THEN '2-Física' WHEN g.ie_tipo_contratacao='CA' THEN '4-Adesão' WHEN g.ie_tipo_contratacao='CE' THEN '3-Empresarial' END )					ie_contrato, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',1))						carencia_1, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',2))						carencia_2, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',3))						carencia_3, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',4))						carencia_4, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',5))						carencia_5, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',6)) 						carencia_6, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',7))						carencia_7, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',8))						carencia_8, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',9))						carencia_9, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',10))						carencia_10, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',11))						carencia_11, 
	substr(replace(replace(c.ds_trilha1,'%',''),'?',''),1,25)								ds_magnetic_1, 
	replace(replace(c.ds_trilha2,';',''),'?','')										ds_magnetic_2, 
	c.ds_trilha3														ds_magnetic_3, 
	CASE WHEN g.ie_regulamentacao='P' THEN 'Produto Regulamentado' WHEN g.ie_regulamentacao='R' THEN 'Produto Não Regulamentado' WHEN g.ie_regulamentacao='A' THEN 'Produto Adpatado' END 		mens_front_1, 
	upper(Obter_Valor_Dominio(1667,g.ie_abrangencia))									ds_abrangencia, 
	substr(pls_obter_rede_ref_produto(g.nr_sequencia,g.cd_estabelecimento,'D'),1,255) 					ds_rede, 
	'0004'															cd_unimed_des, 
	upper(g.ds_carteira_acomodacao)												nm_plano, 
	pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'DCPT',6)							dt_fim_cpt, 
	upper(CASE WHEN g.ie_abrangencia='GM' THEN CASE WHEN coalesce(g.ie_rede_exclusiva,'N')='S' THEN 'REDE REFERENCIADA' WHEN coalesce(g.ie_rede_exclusiva,'N')='N' THEN  					  substr(pls_obter_dados_cart_unimed(d.nr_sequencia,d.nr_seq_plano,'DRSJC',1),1,300) END  END )	ds_area_acao, 
	g.nr_protocolo_ans													ds_reg_ans, 
	d.cd_matricula_estipulante												cd_funcao, 
	CASE WHEN g.ie_preco='1' THEN 'PRE' WHEN g.ie_preco='3' THEN 'CO' WHEN g.ie_preco='4' THEN 'MI' END 										ds_forma_pgto, 
	''															ds_reg_coop_prod, 
	''															ds_reg_coop_ans, 
	' '															ie_fim, 
	a.nr_sequencia														nr_seq_lote, 
	d.nr_sequencia														nr_seq_segurado 
from	pls_lote_carteira			a, 
	pls_carteira_emissao			b, 
	pls_segurado_carteira			c, 
	pls_segurado				d, 
	pls_contrato				e, 
	pessoa_fisica				f, 
	pls_plano				g 
where	b.nr_seq_lote				= a.nr_sequencia 
and	b.nr_seq_seg_carteira			= c.nr_sequencia 
and	c.nr_seq_segurado			= d.nr_sequencia 
and	d.nr_seq_contrato			= e.nr_sequencia 
and	d.cd_pessoa_fisica			= f.cd_pessoa_fisica 
and	d.nr_seq_plano				= g.nr_sequencia 

union all
 
select	2															tp_registro, 
	substr(c.cd_usuario_plano,1,1) ||' ' || substr(c.cd_usuario_plano,2,3) ||' '|| substr(c.cd_usuario_plano,5,12) || ' '|| substr(c.cd_usuario_plano,17,1) nr_cartao, 
	upper(substr(pls_gerar_nome_abreviado(f.nm_pessoa_fisica),1,35))							nm_benef, 
	to_char(f.dt_nascimento,'dd/mm/yyyy')											dt_nasc, 
	c.dt_validade_carteira													dt_validade, 
	substr(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'DASJ',0),1,255)			 		ie_tp_plano, 
	upper(substr(CASE WHEN e.cd_pessoa_fisica='' THEN obter_nome_fantasia_pj(e.cd_cgc)  ELSE obter_nome_pf(e.cd_pessoa_fisica) END ,1,255))	nm_contrante, 
	c.nr_via_solicitacao													nr_via, 
	CASE WHEN g.ie_tipo_contratacao='I' THEN '2-Física' WHEN g.ie_tipo_contratacao='CA' THEN '4-Adesão' WHEN g.ie_tipo_contratacao='CE' THEN '3-Empresarial' END 					ie_contrato, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',1))						carencia_1, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',2))						carencia_2, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',3))						carencia_3, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',4))						carencia_4, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',5))						carencia_5, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',6)) 						carencia_6, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',7))						carencia_7, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',8))						carencia_8, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',9))						carencia_9, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',10))						carencia_10, 
	upper(pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'CAS',11))						carencia_11, 
	substr(replace(replace(c.ds_trilha1,'%',''),'?',''),1,25)								ds_magnetic_1, 
	replace(replace(c.ds_trilha2,';',''),'?','')										ds_magnetic_2, 
	c.ds_trilha3														ds_magnetic_3, 
	upper(CASE WHEN g.ie_regulamentacao='P' THEN 'Produto Regulamentado' WHEN g.ie_regulamentacao='R' THEN 'Produto Não Regulamentado' WHEN g.ie_regulamentacao='A' THEN 'Produto Adpatado' END )	mens_front_1, 
	upper(Obter_Valor_Dominio(1667,g.ie_abrangencia))									ds_abrangencia, 
	substr(pls_obter_rede_ref_produto(g.nr_sequencia,g.cd_estabelecimento,'D'),1,255) 					ds_rede, 
	'0004'															cd_unimed_des, 
	upper(g.ds_carteira_acomodacao)												nm_plano, 
	pls_obter_dados_cart_unimed(d.nr_sequencia, g.nr_sequencia,'DCPT',6)							dt_fim_cpt, 
	upper(CASE WHEN g.ie_abrangencia='GM' THEN CASE WHEN coalesce(g.ie_rede_exclusiva,'N')='S' THEN 'REDE REFERENCIADA' WHEN coalesce(g.ie_rede_exclusiva,'N')='N' THEN  					  substr(pls_obter_dados_cart_unimed(d.nr_sequencia,d.nr_seq_plano,'DRSJC',1),1,300) END  END )	ds_area_acao, 
	' '															ds_reg_ans, 
	d.cd_matricula_estipulante												cd_funcao, 
	CASE WHEN g.ie_preco='1' THEN 'PRE' WHEN g.ie_preco='3' THEN 'CO' WHEN g.ie_preco='4' THEN 'MI' END 										ds_forma_pgto, 
	'"'||g.nr_protocolo_ans||'"'												ds_reg_coop_prod, 
	'"'||h.cd_ans||'"'													ds_reg_coop_ans, 
	' '															ie_fim, 
	a.nr_sequencia														nr_seq_lote, 
	d.nr_sequencia														nr_seq_segurado 
FROM pls_congenere h, pls_plano g, pessoa_fisica f, pls_intercambio e, pls_segurado d, pls_carteira_emissao b
LEFT OUTER JOIN pls_lote_carteira a ON (b.nr_seq_lote = a.nr_sequencia)
, pls_segurado_carteira c
LEFT OUTER JOIN pls_carteira_emissao b ON (c.nr_sequencia = b.nr_seq_seg_carteira)
WHERE c.nr_seq_segurado			= d.nr_sequencia and d.nr_seq_intercambio			= e.nr_sequencia and d.cd_pessoa_fisica			= f.cd_pessoa_fisica and e.nr_seq_congenere			= h.nr_sequencia and d.nr_seq_plano				= g.nr_sequencia;

