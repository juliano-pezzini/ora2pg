-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_censo_diario_v (ds_convenio, cd_estabelecimento, ie_periodo, ds_tipo_acomodacao, ds_setor_atendimento, ds_clinica, nr_pacientes, nr_admissoes, nr_altas, nr_obitos, nr_transf_entrada, nr_transf_saida, dt_referencia, cd_setor_atendimento, cd_convenio, ie_clinica, cd_tipo_acomodacao, cd_medico, ie_situacao, cd_procedencia, ds_procedencia, ie_tipo_atendimento, ds_tipo_atendimento, nm_medico, hr_alta, cd_especialidade, ds_especialidade, ds_clinica_alta, ds_tipo_convenio, ie_tipo_convenio) AS SELECT	C.DS_CONVENIO,
	A.cd_estabelecimento,
	IE_PERIODO,
	T.DS_TIPO_ACOMODACAO,
	S.DS_SETOR_ATENDIMENTO,
	substr(obter_valor_dominio(17, A.ie_clinica),1,200) ds_clinica,
	SUM(NR_PACIENTES) NR_PACIENTES,
	SUM(NR_ADMISSOES) NR_ADMISSOES,
	SUM(NR_ALTAS) NR_ALTAS,
	SUM(NR_OBITOS) NR_OBITOS,
	SUM(NR_TRANSF_ENTRADA) NR_TRANSF_ENTRADA,
	SUM(NR_TRANSF_SAIDA) NR_TRANSF_SAIDA,
	A.DT_REFERENCIA,
	A.CD_SETOR_ATENDIMENTO,
	A.CD_CONVENIO,
	A.IE_CLINICA,
	A.CD_TIPO_ACOMODACAO,
	coalesce(A.CD_MEDICO,'0') cd_medico,
	A.IE_SITUACAO,
	X.CD_PROCEDENCIA,
	X.DS_PROCEDENCIA,
	A.ie_TIPO_ATENDIMENTO,
	substr(obter_valor_dominio(12, A.ie_tipo_atendimento),1,200) DS_TIPO_ATENDIMENTO,
	coalesce(M.NM_PESSOA_FISICA, obter_texto_tasy(1098949,null)) NM_MEDICO,
	A.hr_alta,
	substr(obter_especialidade_medico(coalesce(A.CD_MEDICO,'0'),'C'),1,254) cd_especialidade,
	substr(obter_especialidade_medico(coalesce(A.CD_MEDICO,'0'),'D'),1,254) ds_especialidade,
	substr(obter_valor_dominio(1166, A.ie_clinica_alta),1,200) ds_clinica_alta,
	substr(obter_desc_tipo_convenio(C.cd_convenio),1,200) ds_tipo_convenio,
	C.ie_tipo_convenio
FROM setor_atendimento s, eis_ocupacao_hospitalar a
LEFT OUTER JOIN tipo_acomodacao t ON (A.CD_TIPO_ACOMODACAO = T.CD_TIPO_ACOMODACAO)
LEFT OUTER JOIN convenio c ON (A.CD_CONVENIO = C.CD_CONVENIO)
LEFT OUTER JOIN procedencia x ON (A.CD_PROCEDENCIA = X.CD_PROCEDENCIA)
LEFT OUTER JOIN pessoa_fisica m ON (A.CD_MEDICO = M.CD_PESSOA_FISICA
GROUP 	BY C.DS_CONVENIO,
	A.cd_estabelecimento,
	IE_PERIODO,
	T.DS_TIPO_ACOMODACAO,
	S.DS_SETOR_ATENDIMENTO,
	substr(obter_valor_dominio(17, A.ie_clinica),1,200),
	A.DT_REFERENCIA,
	A.CD_SETOR_ATENDIMENTO,
	A.CD_CONVENIO,
	A.IE_CLINICA,
	A.CD_TIPO_ACOMODACAO,
	coalesce(A.CD_MEDICO,'0'),
	A.IE_SITUACAO,
	X.CD_PROCEDENCIA,
	X.DS_PROCEDENCIA,
	A.ie_TIPO_ATENDIMENTO,
	substr(obter_valor_dominio(12, A.ie_tipo_atendimento),1,200),
	coalesce(M.NM_PESSOA_FISICA, obter_texto_tasy(1098949,null)),
	A.hr_alta,
	substr(obter_especialidade_medico(coalesce(A.CD_MEDICO,'0'),'C'),1,254),
	substr(obter_especialidade_medico(coalesce(A.CD_MEDICO,'0'),'D'),1,254),
	substr(obter_valor_dominio(1166, A.ie_clinica_alta),1,200),
	substr(obter_desc_tipo_convenio(C.cd_convenio),1,200),
	C.ie_tipo_convenio)
WHERE A.CD_SETOR_ATENDIMENTO	= S.CD_SETOR_ATENDIMENTO;

