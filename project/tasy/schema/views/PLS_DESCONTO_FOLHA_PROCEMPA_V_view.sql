-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_desconto_folha_procempa_v (tp_registro, cd_matricula_7, nr_vinculo_pmpa, id_empresa, vl_pago, nr_seq_cobranca, dt_referencia, nr_seq_empresa, nr_seq_pagador, especie, ie_empresa) AS select	1				TP_REGISTRO,
	substr(d.cd_matricula,1,7)	CD_MATRICULA_7,
	g.ds_vinculo			NR_VINCULO_PMPA,
	CASE WHEN d.nr_seq_empresa='50' THEN '1' WHEN d.nr_seq_empresa='55' THEN '2' WHEN d.nr_seq_empresa='51' THEN '3' WHEN d.nr_seq_empresa='52' THEN '4'  ELSE d.nr_seq_empresa END 		ID_EMPRESA,
	obter_Valor_sem_virgula(a.vl_cobranca) VL_PAGO,
	a.nr_seq_cobranca		NR_SEQ_COBRANCA,
	e.dt_remessa_retorno		DT_REFERENCIA,
	f.nr_sequencia			NR_SEQ_EMPRESA,
	d.nr_seq_pagador		NR_SEQ_PAGADOR,
	' '	ESPECIE,
	f.ie_empresa			IE_EMPRESA
FROM titulo_receber h, pls_desc_empresa f, cobranca_escritural e, pls_contrato_pagador c, pls_mensalidade b, titulo_receber_cobr a, pls_contrato_pagador_fin d
LEFT OUTER JOIN pls_empresa_vinculo g ON (d.nr_seq_vinculo_empresa = g.nr_sequencia)
WHERE h.nr_seq_mensalidade	= b.nr_sequencia and h.nr_titulo		= a.nr_titulo and b.nr_seq_pagador	= c.nr_sequencia and d.nr_seq_pagador	= c.nr_sequencia and LOCALTIMESTAMP	between coalesce(d.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(d.dt_fim_vigencia,LOCALTIMESTAMP) and a.nr_seq_cobranca	= e.nr_sequencia  and e.nr_seq_empresa	= f.nr_sequencia and a.nr_seq_mensalidade	= b.nr_sequencia and e.ie_remessa_retorno	= 'R' group by	a.nr_seq_cobranca,
		d.cd_matricula,
		a.vl_cobranca,
		g.ds_vinculo,
		d.nr_seq_empresa,
		e.dt_remessa_retorno,
		f.nr_sequencia,
		d.nr_seq_pagador,
		f.ie_empresa
order by	tp_registro,
		f.ie_empresa desc,
		nr_vinculo_pmpa,
		(cd_matricula_7)::numeric;

