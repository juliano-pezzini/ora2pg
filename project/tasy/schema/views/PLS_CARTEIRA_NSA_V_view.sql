-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_carteira_nsa_v (imagem, nm_pessoa_fisica, nm_titular, ds_parentesco, cd_usuario_plano, dt_validade_carteira, ds_plano, ds_tipo_acomodacao, lb_nome, lb_titular, lb_parent, lb_codigo, lb_plano, lb_validade, lb_acomodacao, lb_linha, lb_carencia, lb_dt_carencia, cobertura_1, cobertura_2, cobertura_3, cobertura_4, cobertura_5, cobertura_6, cobertura_7, cobertura_8, cobertura_9, cobertura_10, cobertura_11, dt_cobertura_1, dt_cobertura_2, dt_cobertura_3, dt_cobertura_4, dt_cobertura_5, dt_cobertura_6, dt_cobertura_7, dt_cobertura_8, dt_cobertura_9, dt_cobertura_10, dt_cobertura_11, nr_seq_lote, nr_seq_segurado, ordem) AS select	imagem,
	nm_pessoa_fisica, 
	nm_titular, 
	ds_parentesco, 
	cd_usuario_plano, 
	dt_validade_carteira, 
	ds_plano, 
	ds_tipo_acomodacao, 
	lb_nome, 
	lb_titular, 
	lb_parent, 
	lb_codigo, 
	lb_plano, 
	lb_validade, 
	lb_acomodacao, 
	lb_linha, 
	lb_carencia, 
	lb_dt_carencia, 
	cobertura_1, 
	cobertura_2, 
	cobertura_3, 
	cobertura_4, 
	cobertura_5, 
	cobertura_6, 
	cobertura_7, 
	cobertura_8, 
	cobertura_9, 
	cobertura_10, 
	cobertura_11, 
	dt_cobertura_1, 
	dt_cobertura_2, 
	dt_cobertura_3, 
	dt_cobertura_4, 
	dt_cobertura_5, 
	dt_cobertura_6, 
	dt_cobertura_7, 
	dt_cobertura_8, 
	dt_cobertura_9, 
	dt_cobertura_10, 
	dt_cobertura_11, 
	nr_seq_lote, 
	nr_seq_segurado, 
	ordem 
FROM	( 
select	1 ordem, 
	upper(e.nm_pessoa_fisica) nm_pessoa_fisica, 
	CASE WHEN b.nr_seq_titular IS NULL THEN  upper(e.nm_pessoa_fisica)  ELSE (	select	upper(x.nm_pessoa_fisica) 							from	pls_segurado	y, 								pessoa_fisica	x 							where	x.cd_pessoa_fisica = 									y.cd_pessoa_fisica 							and	y.nr_sequencia = 										b.nr_seq_titular) END  nm_titular, 
	CASE WHEN nr_seq_titular IS NULL THEN  'TITULAR'  ELSE upper(f.ds_parentesco) END  ds_parentesco, 
	c.cd_usuario_plano, 
	c.dt_validade_carteira, 
	upper(g.ds_plano) ds_plano, 
	(select	upper(x.ds_tipo_acomodacao) 
	 from	pls_tipo_acomodacao	x 
	 where	nr_sequencia = h.nr_seq_tipo_acomodacao) ds_tipo_acomodacao, 
	'Nome  :' lb_nome, 
	'Titular :' lb_titular, 
	'Parent. :' lb_parent, 
	'Código :' lb_codigo, 
	'Plano  :' lb_plano, 
	'Validade: ' lb_validade, 
	'Acomodação :' lb_acomodacao, 
	'____________________________________________________________________________' lb_linha, 
	null lb_carencia, 
	null lb_dt_carencia, 
	b.nr_sequencia nr_seq_segurado, 
	null cobertura_1, 
	null cobertura_2, 
	null cobertura_3, 
	null cobertura_4, 
	null cobertura_5, 
	null cobertura_6, 
	null cobertura_7, 
	null cobertura_8, 
	null cobertura_9, 
	null cobertura_10, 
	null cobertura_11, 
	null dt_cobertura_1, 
	null dt_cobertura_2, 
	null dt_cobertura_3, 
	null dt_cobertura_4, 
	null dt_cobertura_5, 
	null dt_cobertura_6, 
	null dt_cobertura_7, 
	null dt_cobertura_8, 
	null dt_cobertura_9, 
	null dt_cobertura_10, 
	null dt_cobertura_11, 
	d.nr_seq_lote, 
	'\carteira_planoaux_frente.jpg' imagem 
FROM pessoa_fisica e, pls_carteira_emissao d, pls_segurado_carteira c, pls_segurado b
LEFT OUTER JOIN grau_parentesco f ON (b.nr_seq_parentesco = f.nr_sequencia)
, pls_plano g
LEFT OUTER JOIN pls_plano_acomodacao h ON (g.nr_sequencia = h.nr_seq_plano AND 'S' = h.ie_acomod_padrao)
WHERE b.cd_pessoa_fisica	= e.cd_pessoa_fisica and d.nr_seq_seg_carteira	= c.nr_sequencia and c.nr_seq_segurado	= b.nr_sequencia  and g.nr_sequencia 		= b.nr_seq_plano   
union all
 
select	2, 
	null nm_pessoa_fisica, 
	null nm_titular, 
	null ds_parentesco, 
	null cd_usuario_plano, 
	null dt_validade_carteira, 
	null ds_plano, 
	null ds_tipo_acomodacao, 
	null lb_nome, 
	null lb_titular, 
	null lb_parent, 
	null lb_codigo, 
	null lb_plano, 
	null lb_validade, 
	null lb_acomodacao, 
	null lb_linha, 
	'CARÊNCIAS' lb_carencia, 
	'DATA' lb_dt_carencia, 
	b.nr_sequencia nr_seq_segurado, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',1),'') cobertura_1, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',2),'') cobertura_2, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',3),'') cobertura_3, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',4),'') cobertura_4, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',5),'') cobertura_5, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',6),'') cobertura_6, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',7),'') cobertura_7, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',8),'') cobertura_8, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',9),'') cobertura_9, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',10),'') cobertura_10, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',11),'') cobertura_11, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',1),'') dt_cobertura_1, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',2),'') dt_cobertura_2, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',3),'') dt_cobertura_3, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',4),'') dt_cobertura_4, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',5),'') dt_cobertura_5, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',6),'') dt_cobertura_6, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',7),'') dt_cobertura_7, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',8),'') dt_cobertura_8, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',9),'') dt_cobertura_9, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',10),'') dt_cobertura_10, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',11),'') dt_cobertura_11, 
	d.nr_seq_lote, 
	'\carteira_planoaux_atras.jpg' imagem 
from	pls_carteira_emissao	d, 
	pls_segurado_carteira	c, 
	pls_segurado		b 
where	d.nr_seq_seg_carteira	= c.nr_sequencia 
and	c.nr_seq_segurado	= b.nr_sequencia 
) alias52;

