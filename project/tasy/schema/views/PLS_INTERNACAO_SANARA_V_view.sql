-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_internacao_sanara_v (tp_registro, vl_lancamento_lote, qt_internacao_lote, cd_prontuario_funcionario, dt_competencia, dt_base, vl_gastos_internacao, qt_internacao, reservado3, reservado5) AS select	1				tp_registro,
	sum(coalesce(d.vl_total,0))		vl_lancamento_lote,
	1				qt_internacao_lote,
	null				cd_prontuario_funcionario,
	trunc(a.dt_mes_competencia,'month')	dt_competencia,
	null				dt_base,
	null				vl_gastos_internacao,
	null				qt_internacao,
	0				reservado3,
	0				reservado5
FROM	pls_conta		d,
	pls_segurado		c,
	pls_contrato		b,
	pls_protocolo_conta	a
where	b.nr_sequencia		= c.nr_seq_contrato
and	d.nr_seq_segurado	= c.nr_sequencia
and	d.nr_seq_protocolo	= a.nr_sequencia
and	((d.ie_tipo_guia	=	4 AND d.nr_seq_tipo_atendimento	= 7) or (d.ie_tipo_guia	=	5))
and	a.ie_tipo_protocolo	= 'C'
group by trunc(a.dt_mes_competencia,'month')

union

select	2				tp_registro,
	null				vl_lancamento_lote,
	null				qt_internacao_lote,
	c.cd_matricula_estipulante	cd_prontuario_funcionario,
	a.dt_mes_competencia		dt_competencia,
	a.dt_mes_competencia		dt_base,
	sum(d.vl_total)			vl_gastos_internacao,
	1				qt_internacao,
	0				reservado3,
	0				reservado5
from	pls_conta		d,
	pls_segurado		c,
	pls_contrato		b,
	pls_protocolo_conta	a
where	b.nr_sequencia		= c.nr_seq_contrato
and	d.nr_seq_segurado	= c.nr_sequencia
and	d.nr_seq_protocolo	= a.nr_sequencia
and	((d.ie_tipo_guia	=	4 AND d.nr_seq_tipo_atendimento	= 7) or (d.ie_tipo_guia	=	5))
and	a.ie_tipo_protocolo	= 'C'
group by	c.cd_matricula_estipulante,
		a.dt_mes_competencia

union all

select	9				tp_registro,
	null				vl_lancamento_lote,
	null				qt_internacao_lote,
	null				cd_prontuario_funcionario,
	trunc(a.dt_mes_competencia,'month') dt_competencia,
	null				dt_base,
	null				vl_gastos_internacao,
	null				qt_internacao,
	0				reservado3,
	0				reservado5
from	pls_conta		d,
	pls_segurado		c,
	pls_contrato		b,
	pls_protocolo_conta	a
where	b.nr_sequencia		= c.nr_seq_contrato
and	d.nr_seq_segurado	= c.nr_sequencia
and	d.nr_seq_protocolo	= a.nr_sequencia
and	((d.ie_tipo_guia	=	4 AND d.nr_seq_tipo_atendimento	= 7) or (d.ie_tipo_guia	=	5))
and	a.ie_tipo_protocolo	= 'C'
group by trunc(a.dt_mes_competencia,'month');

