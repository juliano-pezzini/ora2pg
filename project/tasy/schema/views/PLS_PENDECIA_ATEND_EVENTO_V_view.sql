-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_pendecia_atend_evento_v (ie_pendencia, ds_pendencia, cd_pessoa_fisica, cd_cgc, nr_sequencia, dt_solicitacao, ds_ocorrencia, nr_seq_evento) AS select	1 ie_pendencia,
	'Autorização' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
FROM (select	b.cd_pessoa_fisica,
		a.nr_sequencia,
		a.dt_solicitacao,
		substr(obter_valor_dominio(1746, a.ie_tipo_guia),1,255) ds_ocorrencia,
		a.nr_seq_evento_atend nr_seq_evento
	from 	pls_segurado	b,
		pls_guia_plano	a
	where 	a.nr_seq_segurado	= b.nr_sequencia
	and	a.ie_status 	= '2'
	order by a.cd_guia) a

union

select	2 ie_pendencia,
	'Boletim de ocorrência' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	a.cd_pessoa_fisica,
		a.cd_cgc,
		a.nr_sequencia,
		a.dt_ocorrencia dt_solicitacao,
		substr(a.ds_ocorrencia,1,255) ds_ocorrencia,
		a.nr_seq_evento_atend nr_seq_evento
	from	sac_resp_bol_ocor	b,
		sac_boletim_ocorrencia	a,
		sac_responsavel		c
	where	a.nr_sequencia 		= b.nr_seq_bo
	and	b.nr_seq_responsavel	= c.nr_sequencia
	and 	a.dt_cancelamento is null
	and	b.ie_status not in ('E','S')) a
where	a.cd_pessoa_fisica is not null
and	a.cd_cgc is null

union

select	2 ie_pendencia,
	'Boletim de ocorrência' ds_pendencia,
	'' cd_pessoa_fisica,
	a.cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	a.cd_pessoa_fisica,
		a.cd_cgc,
		a.nr_sequencia,
		a.dt_ocorrencia dt_solicitacao,
		substr(a.ds_ocorrencia,1,255) ds_ocorrencia,
		a.nr_seq_evento_atend nr_seq_evento
	from	sac_resp_bol_ocor	b,
		sac_boletim_ocorrencia	a,
		sac_responsavel		c
	where	a.nr_sequencia 		= b.nr_seq_bo
	and	b.nr_seq_responsavel	= c.nr_sequencia
	and 	a.dt_cancelamento is null
	and	b.ie_status not in ('E','S')) a
where	a.cd_cgc is not null
and	a.cd_pessoa_fisica is null

union

select	2 ie_pendencia,
	'Boletim de ocorrência' ds_pendencia,
	a.cd_pessoa_fisica,
	a.cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	a.cd_cgc,
		a.cd_pessoa_fisica,
		a.nr_sequencia,
		a.dt_ocorrencia dt_solicitacao,
		substr(a.ds_ocorrencia,1,255) ds_ocorrencia,
		a.nr_seq_evento_atend nr_seq_evento
	from	sac_resp_bol_ocor b,
		sac_boletim_ocorrencia a,
		sac_responsavel	c
	where	a.nr_sequencia = b.nr_seq_bo
	and	b.nr_seq_responsavel = c.nr_sequencia
	and 	a.dt_cancelamento is null
	and	b.ie_status not in ('E','S')) a
where	a.cd_cgc is not null
and	a.cd_pessoa_fisica is not null

union

select	3 ie_pendencia,
	'Ordem de serviço' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	substr(a.ds_ocorrencia,1,255),
	a.nr_seq_evento
from (select	cd_pessoa_solicitante cd_pessoa_fisica,
		nr_sequencia,
		dt_ordem_Servico dt_solicitacao,
		substr(ds_dano_breve,1,255)ds_ocorrencia,
		nr_seq_evento_atend nr_seq_evento
	from 	man_ordem_servico
	where	ie_status_ordem <> 3) a
where	a.cd_pessoa_fisica is not null

union

select	10 ie_pendencia,
	'Pendencia de resposta' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	a.cd_pessoa_fisica cd_pessoa_fisica,
		c.nr_sequencia,
		c.dt_atualizacao dt_solicitacao,
		substr(c.ds_motivo_pendencia, 1, 255) ds_ocorrencia,
		b.nr_sequencia nr_seq_evento
	from	pls_atendimento a,
		pls_atendimento_evento b,
		pls_atend_evt_pend_resp c
	where	a.nr_sequencia = b.nr_seq_atendimento
	and	b.nr_sequencia = c.nr_seq_atend_evento) a

union

select	11 ie_pendencia,
	'Agendamento externo' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	a.cd_pessoa_fisica cd_pessoa_fisica,
		b.nr_sequencia,
		b.dt_atualizacao dt_solicitacao,
		substr(b.ds_observacao, 1, 255) ds_ocorrencia,
		b.nr_sequencia nr_seq_evento
	from	pls_atendimento a,
		pls_atendimento_evento b,
		pls_atend_evt_agenda_ext c
	where	a.nr_sequencia = b.nr_seq_atendimento
	and	b.nr_sequencia = c.nr_seq_atend_evento
	and	b.ie_status <> 'C') a

union

select	1 ie_pendencia,
	'Requisição' ds_pendencia,
	a.cd_pessoa_fisica,
	'' cd_cgc,
	a.nr_sequencia,
	a.dt_solicitacao,
	a.ds_ocorrencia,
	a.nr_seq_evento
from (select	b.cd_pessoa_fisica,
		a.nr_sequencia,
		a.dt_requisicao dt_solicitacao,
		substr(obter_valor_dominio(1746, a.ie_tipo_guia),1,255) ds_ocorrencia,
		a.nr_seq_evento_atend nr_seq_evento
	from 	pls_segurado	b,
		pls_requisicao	a
	where 	a.nr_seq_segurado	= b.nr_sequencia
	and	a.ie_estagio in (1,4,5,8,10)
	order by a.nr_sequencia) a;

