-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW obter_order_type_cpoe_info_v (nr_seq_cpoe, nr_seq_cpoe_order_unit, nr_seq_cpoe_tipo_pedido, ie_tipo_item, nr_atendimento, cd_pessoa_fisica, cd_medico) AS SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                 cp.nr_seq_cpoe_order_unit,
                 cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                 cpoe_obter_tipo_item('CPOE_DIETA',cp.nr_sequencia,cp.ie_tipo_dieta,null,null) IE_TIPO_ITEM,
                 cp.nr_atendimento,
                 cp.cd_pessoa_fisica,
                 cp.cd_medico
FROM CPOE_DIETA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL

UNION ALL

/* Medicine */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_MATERIAL',cp.nr_sequencia,null,cp.ie_controle_tempo,cp.ie_material) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
JOIN CPOE_RP rp ON cp.nr_seq_cpoe_rp = rp.nr_sequencia
WHERE coalesce(cp.ie_material,'N') = 'N'
and cp.dt_liberacao IS NOT NULL

UNION ALL

/* Materials */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_MATERIAL',cp.nr_sequencia,null,cp.ie_controle_tempo,cp.ie_material) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_MATERIAL cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE coalesce(ie_material,'N') = 'S'
and cp.dt_liberacao IS NOT NULL

UNION ALL

/* Procedure */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_PROCEDIMENTO',cp.nr_sequencia,null,null,null) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_PROCEDIMENTO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL

UNION ALL

/* Gastherapy */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_GASOTERAPIA',cp.nr_sequencia,null,null,null) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_GASOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL

UNION ALL

/* Interventions and Recommendations */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_RECOMENDACAO',cp.nr_sequencia,null,null,null) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_RECOMENDACAO cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL

UNION ALL

/* Blood and Blood Products */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_HEMOTERAPIA',cp.nr_sequencia,null,null,null) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_HEMOTERAPIA cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL

UNION ALL

/* Dialisys */

SELECT DISTINCT cp.nr_sequencia NR_SEQ_CPOE,
                cp.nr_seq_cpoe_order_unit,
                cou.NR_SEQ_CPOE_TIPO_PEDIDO,
                cpoe_obter_tipo_item('CPOE_DIALISE',cp.nr_sequencia,null,null,null) IE_TIPO_ITEM,
                cp.nr_atendimento,
                cp.cd_pessoa_fisica,
                cp.cd_medico
FROM CPOE_DIALISE cp
JOIN CPOE_ORDER_UNIT cou ON cp.nr_seq_cpoe_order_unit = cou.nr_sequencia
WHERE cp.dt_liberacao IS NOT NULL;

