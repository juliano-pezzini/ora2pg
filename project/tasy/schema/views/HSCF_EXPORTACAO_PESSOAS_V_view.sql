-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hscf_exportacao_pessoas_v (tp_registro, nr_sequencia, nr_atendimento, nm_paciente, ds_endereco, ds_bairro, cd_municipio_ibge, cd_cep, nm_pai, nm_mae, nr_documento, ie_sexo, dt_entrada, hr_internacao, cd_unidade_basica, cd_unidade_compl, dt_nascimento, ie_clinica, nm_responsavel, ds_endereco_resp, nr_telefone_resp, dt_alta, ds_estabelecimento) AS select 1 tp_registro,
	0 nr_sequencia, 
	a.nr_atendimento, 
	substr(p.nm_pessoa_fisica,1,50) nm_paciente, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 1, 'E'),1,40) ds_endereco, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 1, 'B'),1,15) ds_bairro, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 1, 'CDM'),1,15) cd_municipio_ibge, 
	substr(elimina_caracteres_especiais(obter_compl_pf(p.cd_pessoa_fisica, 1, 'CEP')),1,8) cd_cep, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 4, 'N'),1,40) nm_pai, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 5, 'N'),1,40) nm_mae, 
	coalesce(p.nr_identidade, coalesce(p.nr_cpf, p.nr_prontuario)) nr_documento, 
	p.ie_sexo, 
	a.dt_entrada, 
	substr(replace(to_char(a.dt_entrada,'hh24:mi'),':',''),1,4) hr_internacao, 
	substr(b.cd_unidade_basica,1,5) cd_unidade_basica, 
	substr(b.cd_unidade_compl,1,5) cd_unidade_compl, 
	p.dt_nascimento, 
	a.ie_clinica, 
	substr(obter_nome_responsavel(a.nr_atendimento),1,40) nm_responsavel, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 3, 'E'),1,50) ds_endereco_resp, 
	substr(obter_compl_pf(p.cd_pessoa_fisica, 3, 'T'),1,30) nr_telefone_resp, 
	a.dt_alta, 
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,40) ds_estabelecimento 
FROM	pessoa_fisica p, 
	atend_paciente_unidade b, 
	atendimento_paciente a 
where (a.nr_atendimento	= b.nr_atendimento) 
and (b.nr_seq_interno	= obter_atepacu_paciente(a.nr_atendimento, 'A')) 
and (a.cd_pessoa_fisica	= p.cd_pessoa_fisica);

