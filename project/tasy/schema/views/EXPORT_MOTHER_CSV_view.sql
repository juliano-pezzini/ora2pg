-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW export_mother_csv (campo_1, campo_2, campo_3, campo_4, campo_5, campo_6, campo_7, campo_8, campo_9, campo_10, campo_11, campo_12, campo_13, campo_14, campo_15, campo_16, campo_17, campo_18, campo_19, campo_20, campo_21, campo_22, campo_23, campo_24, campo_25, campo_26, campo_27, campo_28, campo_29, campo_30, campo_31, campo_32, campo_33, campo_34, campo_35, campo_36, campo_37, campo_38, campo_39, campo_40, campo_41, campo_42, campo_43, campo_44, campo_45, campo_46, campo_47, campo_48, campo_49, campo_50, campo_51, campo_52, campo_53, campo_54, campo_55, campo_56, campo_57, campo_58, campo_59, campo_60, campo_61, campo_62, campo_63, campo_64, campo_65, campo_66, campo_67, campo_68, campo_69, campo_70, campo_71, campo_72, campo_73, campo_74, campo_75, campo_76, campo_77, campo_78, campo_79, campo_80, campo_81, campo_82, campo_83, campo_84, campo_85, campo_86, campo_87, campo_88, campo_89, campo_90, campo_91, campo_92, campo_93, campo_94, campo_95, campo_96, campo_97, campo_98, campo_99, campo_100, campo_101, campo_102, campo_103, campo_104, campo_105, campo_106, campo_107, campo_108, campo_109, campo_110, campo_111, campo_112, campo_113, campo_114, campo_115, dt_parto, nr_atendimento) AS SELECT
		obter_estab_atendimento(c.nr_atendimento) CAMPO_1,
		( SELECT lpad(n.nr_birth_number, 4, '0')
                || '/'
                || EXTRACT(YEAR FROM dt_nascimento)
            FROM nascimento n
            WHERE n.nr_atendimento = c.nr_atendimento
             LIMIT 1) CAMPO_2,
		'16/1' CAMPO_3,
		to_char(LOCALTIMESTAMP, 'DD.MM.YYYY') CAMPO_4,
		( SELECT n.nr_birth_number
            FROM nascimento n
            WHERE n.nr_atendimento = c.nr_atendimento 
             LIMIT 1) CAMPO_5,
		c.QT_FETO CAMPO_6,
		CASE
			WHEN c.IE_LOCAL_NASCIMENTO IN ('03','99') THEN '1'
			ELSE '0'
		END  CAMPO_7,
		CASE
			WHEN c.IE_LOCAL_NASCIMENTO IN ('04') THEN '1'
			ELSE '0'
		END  CAMPO_8,
		obter_idade(h.dt_nascimento, LOCALTIMESTAMP, 'A') CAMPO_9,
		to_char(obter_entrada_paciente(c.nr_atendimento), 'DD.MM.YYYY') CAMPO_10,
		CASE
            WHEN UPPER(OBTER_DESC_NACIONALIDADE(obter_nacionalidade_pf(h.CD_PESSOA_FISICA))) = 'AUSTRIA'
			THEN 'A'
			ELSE TO_CHAR(OBTER_CODIGO_PAIS(obter_nacionalidade_pf(h.CD_PESSOA_FISICA)))
		END CAMPO_11,
		h.nr_cep_cidade_nasc CAMPO_12,
		to_char(coalesce(c.qt_gestacoes, 0)) CAMPO_13,
		to_char(coalesce(c.qt_filhos_vivos, 0)) CAMPO_14,
		to_char(coalesce(c.qt_natimortos, 0)) CAMPO_15,
		to_char(coalesce(c.qt_parto_cesario, 0)) CAMPO_16,
		c.ds_prev_surg_vag_del campo_17,
		to_char(c.dt_provavel_parto, 'DD.MM.YYYY') CAMPO_18,
		CASE WHEN c.ie_edd_unknown='Y' THEN  1  ELSE 0 END  CAMPO_19,
		(SELECT n.qt_sem_ig_total || '+'  || n.QT_DIA_IG_TOTAL
			FROM nascimento n
			WHERE n.nr_atendimento = c.NR_ATENDIMENTO
			AND n.dt_inativacao IS NULL  LIMIT 1) CAMPO_20,
		CASE WHEN c.ie_tabagismo='S' THEN  '1'  ELSE '0' END  CAMPO_21,
		coalesce(obter_valor_pre_natal('MED_PAC_PRE_NATAL.QT_PESO_PRE_GESTACAO', c.nr_atendimento), '0') CAMPO_22,
		coalesce(get_pre_parto_value('QT_PESO_MAE', c.nr_atendimento), 0) CAMPO_23,
		coalesce(get_pre_parto_value('QT_ALTURA_CM', c.nr_atendimento), 0) CAMPO_24,
		c.IE_RISCO_GESTACAO CAMPO_25,
		CASE WHEN c.ie_growth_ret='Y' THEN  '1'  ELSE '0' END  CAMPO_26,
		CASE WHEN c.ie_fetal_weight='Y' THEN  1  ELSE 0 END  CAMPO_27,
		CASE WHEN c.ie_malformacao IS NULL THEN  0  ELSE 1 END  CAMPO_28,
		CASE WHEN c.QT_FETO > 1 THEN '1' ELSE '0' END CAMPO_29,
		CASE WHEN c.ie_tipo_gemelaridade='3' THEN  '1'  ELSE '0' END  CAMPO_30,
		CASE WHEN c.ie_tipo_gemelaridade='2' THEN  '1'  ELSE '0' END  CAMPO_31,
		CASE WHEN c.ie_tipo_gemelaridade='1' THEN  '1'  ELSE '0' END  CAMPO_32,
		CASE WHEN c.QT_FETO > 2 THEN '1' ELSE '0' END CAMPO_33,
		CASE WHEN c.ie_blood_group_ak='Y' THEN  '1'  ELSE '0' END  CAMPO_34,
		CASE WHEN c.ie_zn_conditon_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_35,
		CASE WHEN c.ie_conization_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_36,
		CASE WHEN c.ie_myometrium_risk='Y' THEN  '1'  ELSE '0' END   CAMPO_37,
		CASE WHEN c.ie_abdominal_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_38,
		CASE WHEN c.ie_thoracic_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_39,
		CASE WHEN c.ie_head_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_40,
		CASE WHEN c.ie_skeleton_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_41,
		CASE WHEN c.ie_iddm_endo_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_42,
		CASE WHEN c.ie_bleeding_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_43,
		CASE WHEN c.ie_thrombotic_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_44,
		CASE WHEN c.ie_subst_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_45,
		CASE WHEN c.ie_nephrology_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_46,
		CASE WHEN c.ie_mate_malig_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_47,
		CASE WHEN c.ie_diab_gdm_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_48,
		CASE WHEN c.ie_diab_metf_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_49,
		CASE WHEN c.ie_ogtt_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_50,
		CASE WHEN c.ie_after_week='Y' THEN  '1'  ELSE '0' END  CAMPO_51,
		CASE WHEN c.ie_bp_pretenuria='Y' THEN  '1'  ELSE '0' END  CAMPO_52,
		CASE WHEN c.ie_hellp_bp_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_53,
		CASE WHEN c.ie_eclampsia='Y' THEN  '1'  ELSE '0' END  CAMPO_54,
		CASE WHEN c.ie_placenta_pervia='Y' THEN  '1'  ELSE '0' END  CAMPO_55,
		CASE WHEN c.ie_vasa_previa='Y' THEN  '1'  ELSE '0' END  CAMPO_56,
		CASE WHEN c.ie_placenta_uterine_scar='Y' THEN  '1'  ELSE '0' END  CAMPO_57,
		CASE WHEN c.ie_morbidly_placenta='Y' THEN  '1'  ELSE '0' END  CAMPO_58,
		CASE WHEN c.ie_cervix_risk='Y' THEN  '1'  ELSE '0' END  CAMPO_59,
		CASE WHEN c.ie_amniotic='Y' THEN  '1'  ELSE '0' END  CAMPO_60,
		CASE WHEN c.ie_cerclag='Y' THEN  '1'  ELSE '0' END   CAMPO_61,
		CASE WHEN c.ie_strep_b_pos='Y' THEN  '1'  ELSE '0' END   CAMPO_62,
		CASE WHEN c.ie_hiv='Y' THEN  '1'  ELSE '0' END  CAMPO_63,
		CASE WHEN c.ie_toxoplasmosis='Y' THEN  '1'  ELSE '0' END  CAMPO_64,
		CASE WHEN c.ie_rubella='Y' THEN  '1'  ELSE '0' END  CAMPO_65,
		CASE WHEN c.ie_varicella='Y' THEN  '1'  ELSE '0' END  CAMPO_66,
		CASE WHEN c.ie_cmv='Y' THEN  '1'  ELSE '0' END  CAMPO_67,
		CASE WHEN c.ie_chlamydia='Y' THEN  '1'  ELSE '0' END  CAMPO_68,
		CASE WHEN c.ie_no_motch_pass='Y' THEN  '1'  ELSE '0' END  CAMPO_69,
		CASE WHEN c.ie_pulm_treatm='Y' THEN  '1'  ELSE '0' END  CAMPO_70,
		c.dt_pulmonary campo_71,
		c.dt_maneuver_out campo_72,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_REPROD_ASSIST', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_73,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_HORMO_TERAPIA', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_74,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_INSEMINACAO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_75,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_IVF', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_76,
		obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_EMBRIAO_IMPL', c.nr_atendimento) CAMPO_77,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_DOACAO_SEMEN', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_78,
		CASE WHEN obter_valor_pre_natal('MED_PAC_PRE_NATAL.IE_DOACAO_OVULOS', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_79,
		CASE WHEN c.ie_birth_induce='Y' THEN  '1'  ELSE '0' END  CAMPO_80,
		CASE WHEN c.ie_oligohydramnion='Y' THEN  '1'  ELSE '0' END  CAMPO_81,
		CASE WHEN c.ie_sih_preeclampsia='Y' THEN  '1'  ELSE '0' END   CAMPO_82,
		CASE WHEN c.ie_iugr='Y' THEN  '1'  ELSE '0' END  CAMPO_83,
		CASE WHEN c.ie_gdm='Y' THEN  '1'  ELSE '0' END  CAMPO_84,
		CASE WHEN c.ie_oxy_sub_partu='Y' THEN  '1'  ELSE '0' END  CAMPO_85,
		CASE WHEN c.ie_toco_sub_partu='Y' THEN  '1'  ELSE '0' END  CAMPO_86,
		c.cd_episiotomy campo_87,
		CASE WHEN c.ie_placenta_dis='Y' THEN  '1'  ELSE '0' END  CAMPO_88,
		CASE WHEN c.ie_utero_postpa='Y' THEN  '1'  ELSE '0' END  CAMPO_89,
		CASE WHEN c.ie_perineal='0' THEN  '0'  ELSE '1' END  CAMPO_90,
		CASE WHEN get_post_natal_obstertrics('IE_RUPTURE_OPEN', c.nr_atendimento)='N' THEN  '0'  ELSE '1' END  CAMPO_91,
		CASE WHEN get_post_natal_obstertrics('IE_RUPTURE_CLOSED', c.nr_atendimento)='N' THEN  '0'  ELSE '1' END  CAMPO_92,
		CASE WHEN c.ie_hellp='S' THEN  '1'  ELSE '0' END  CAMPO_93,
		CASE WHEN get_post_natal_obstertrics('IE_SEPSE', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_94,
		CASE WHEN get_post_natal_obstertrics('IE_HISTERECTOMIA', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_95,
		CASE WHEN get_post_natal_obstertrics('IE_CIRURGIA_CONSERVACAO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_96,
		CASE WHEN get_post_natal_obstertrics('IE_EMBOLIA_FLUIDO_AMNIO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_97,
		CASE WHEN get_post_natal_obstertrics('IE_EMBOLIA_PULMONAR', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END      CAMPO_98,
		CASE WHEN get_post_natal_obstertrics('IE_REOPERACAO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_99,
		CASE WHEN get_post_natal_obstertrics('IE_REOPERACAO_PERINEO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_100,
		CASE WHEN get_post_natal_obstertrics('ie_reoperacao_secao', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_101,
		CASE WHEN get_post_natal_obstertrics('IE_REOPERACAO_HEMORRAGIA', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_102,
		CASE WHEN get_post_natal_obstertrics('IE_REOPERACAO_INFECCAO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_103,
		CASE WHEN get_post_natal_obstertrics('IE_SANGRAMENTO_INDUZIDO', c.nr_atendimento)='S' THEN  '1'  ELSE '0' END  CAMPO_104,
		to_char(obter_data_alta_atendimento(c.nr_atendimento), 'DD.MM.YYYY') CAMPO_105,
		obter_setor_atendimento(c.nr_atendimento) CAMPO_106,
		(SELECT ds_location FROM estab_trans_lst WHERE nr_sequencia = c.IE_TRANSFERRED_TO) CAMPO_107,
		CASE WHEN c.ie_intensive_care='N' THEN  0  ELSE 1 END  CAMPO_108,
		CASE WHEN c.ie_radio_interv='N' THEN  0  ELSE 1 END  CAMPO_109,
		CASE WHEN c.ie_mother_later='N' THEN  0  ELSE 1 END  CAMPO_110,
		CASE WHEN c.ie_ext_surg_treat='N' THEN  0  ELSE 1 END  CAMPO_111,
		CASE WHEN c.ie_hemosta_reasons='N' THEN  0  ELSE 1 END  CAMPO_112,
		CASE WHEN c.ie_other_trans='N' THEN  0  ELSE 1 END  CAMPO_113,
		(SELECT CASE WHEN COUNT(*)=0 THEN  0  ELSE 1 END  FROM declaracao_obito d WHERE d.nr_atendimento = c.nr_atendimento AND dt_inativacao IS NULL) CAMPO_114,
		(SELECT to_char(DT_OBITO,'DD.MM.YYYY') FROM declaracao_obito d WHERE d.nr_atendimento = c.nr_atendimento AND dt_inativacao IS NULL  LIMIT 1) CAMPO_115,
		c.dt_inicio_parto DT_PARTO,
		c.nr_atendimento
	FROM parto c
	INNER JOIN atendimento_paciente ap ON ap.nr_atendimento = c.nr_atendimento
	INNER JOIN pessoa_fisica h ON h.cd_pessoa_fisica = ap.cd_pessoa_fisica
	WHERE
		EXISTS (
			SELECT 1
			FROM classif_especial_paciente ce
			WHERE
				ce.nr_sequencia = ap.nr_seq_classif_esp
				AND lower(ce.ds_classificacao) LIKE( 'e%' )
		);

