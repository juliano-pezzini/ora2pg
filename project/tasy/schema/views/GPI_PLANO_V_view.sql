-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW gpi_plano_v (nivel, ds_conta_apres, nr_sequencia, cd_empresa, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, ds_conta, ie_tipo, ie_situacao, nr_seq_superior, nr_seq_apres, ie_material, cd_conta_contabil, ie_operacao) AS WITH RECURSIVE cte AS (
select	1 nivel,(lpad(' ', 3* (1-1)) || ds_conta) ds_conta_apres,a.NR_SEQUENCIA,a.CD_EMPRESA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.DS_CONTA,a.IE_TIPO,a.IE_SITUACAO,a.NR_SEQ_SUPERIOR,a.NR_SEQ_APRES,a.IE_MATERIAL,a.CD_CONTA_CONTABIL,a.IE_OPERACAO
FROM	gpi_plano a WHERE a.nr_seq_superior is null
  UNION ALL
select	(c.level+1) nivel,(lpad(' ', 3* ((c.level+1)-1)) || ds_conta) ds_conta_apres,a.NR_SEQUENCIA,a.CD_EMPRESA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.DS_CONTA,a.IE_TIPO,a.IE_SITUACAO,a.NR_SEQ_SUPERIOR,a.NR_SEQ_APRES,a.IE_MATERIAL,a.CD_CONTA_CONTABIL,a.IE_OPERACAO
FROM	gpi_plano a JOIN cte c ON (c.prior nr_sequencia = a.nr_seq_superior)

) SELECT * FROM cte;


