-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW matrix_paciente_ws_v7_v (identificacao_paciente, cd_pessoa_fisica_externo, nome, sexo, data_nascimento, ds_endereco, nr_endereco, ds_complemento, ds_bairro, ds_cidade, sg_estado, cd_cep, nr_telefone, nr_telefone_celular, nr_telefone_comercial, ds_fax, ds_email, nr_identidade, ds_orgao_emissor_ci, dt_emissao_ci, nr_cpf, nome_mae, cartao_nacional_sus, cor, nm_contato, parentesco, cpf_responsavel, rg_responsavel, ie_metodo) AS SELECT  substr(a.cd_pessoa_fisica,1,20) identificacao_paciente,
        substr(pce.CD_PESSOA_FISICA_EXTERNO,1,20) CD_PESSOA_FISICA_EXTERNO,
        substr(a.nm_pessoa_fisica,1,50) nome,
        substr(a.ie_sexo,1,1) sexo,
        to_char(a.dt_nascimento,'dd/mm/yyyy hh24:mi:ss') data_nascimento,
        SUBSTR(cpf.ds_endereco,1,50) ds_endereco,
        SUBSTR(cpf.nr_endereco,1,6) nr_endereco,
        SUBSTR(cpf.ds_complemento,1,25) ds_complemento,
        SUBSTR(cpf.ds_bairro,1,45) ds_bairro,
        SUBSTR(cpf.ds_municipio,1,45) ds_cidade,
        SUBSTR(cpf.sg_estado,1,2) sg_estado,
        SUBSTR(cpf.cd_cep,1,8) cd_cep,
        SUBSTR(cpf.nr_telefone,1,20) nr_telefone,
        SUBSTR(a.nr_telefone_celular,1,20) nr_telefone_celular,
        SUBSTR(obter_compl_pf(a.cd_pessoa_fisica, 2, 'T'),1,20) nr_telefone_comercial,
        SUBSTR(obter_compl_pf(a.cd_pessoa_fisica, 2, 'FAX'),1,20) ds_fax,
        SUBSTR(cpf.ds_email,1,20) ds_email,
        SUBSTR(a.nr_identidade,1,20) nr_identidade,
        SUBSTR(a.ds_orgao_emissor_ci,1,10) ds_orgao_emissor_ci,
        coalesce(to_char(a.dt_emissao_ci,'dd/mm/yyyy hh24:mi:ss'), '01/01/1900 00:00:00') dt_emissao_ci,
        a.nr_cpf nr_cpf,
        SUBSTR(obter_nome_mae_pf(a.cd_pessoa_fisica),1,30) nome_mae,
        SUBSTR(a.nr_cartao_nac_sus,1,15) cartao_nacional_sus,
        substr(Matrix_Obter_Cor_Pele(a.nr_seq_cor_pele),1,1) cor,
        cpf.nm_contato,
        obter_desc_parentesco(cpf.NR_SEQ_PARENTESCO) parentesco,
        cpf.nr_cpf cpf_responsavel,
        cpf.NR_IDENTIDADE rg_responsavel,
        'RecebePaciente' ie_metodo
FROM compl_pessoa_fisica cpf, pessoa_fisica a
LEFT OUTER JOIN pf_codigo_externo pce ON (a.cd_pessoa_fisica = pce.cd_pessoa_fisica AND 'MX' = pce.ie_tipo_codigo_externo)
WHERE cpf.cd_pessoa_fisica = a.cd_pessoa_fisica;

