-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tax_dmed_dados_gerais_v (cd_beneficiario, vl_pago, cd_pessoa_titular, nr_seq_lote, nm_beneficiario, ds_titularidade, nr_contrato, cd_responsavel_pagamento, ie_tipo_titulo, dt_referencia, nr_documento, vl_reembolso) AS select	a.cd_beneficiario,
		CASE WHEN c.nr_titulo_rec IS NULL THEN  CASE WHEN(	select	max(x.ie_origem_titulo)							FROM	titulo_pagar x							where	x.nr_titulo = c.nr_titulo_pag)='6' THEN  0  ELSE abs(a.vl_pago) * -1 END   ELSE a.vl_pago END  vl_pago,
		c.cd_pessoa_titular,
		b.nr_seq_lote,
		substr(obter_nome_pf(a.cd_beneficiario),1,255) nm_beneficiario,
		substr(CASE WHEN c.cd_pessoa_titular=a.cd_beneficiario THEN obter_desc_expressao(943605)  ELSE obter_desc_expressao(287413) END ,1,255) ds_titularidade,
		c.nr_contrato,
		a.cd_responsavel_pagamento,
		CASE WHEN c.nr_titulo_rec IS NULL THEN  CASE WHEN(	select	max(x.ie_origem_titulo)							from	titulo_pagar x							where	x.nr_titulo = c.nr_titulo_pag)='6' THEN  'Reembolso'  ELSE 'Pagar' END   ELSE 'Receber' END  ie_tipo_titulo,
		to_date(b.dt_referencia , 'dd/mm/rrrr') dt_referencia,
		a.nr_documento,
		CASE WHEN(select	max(x.ie_origem_titulo)			from	titulo_pagar x			where	x.nr_titulo = c.nr_titulo_pag)='6' THEN  a.vl_pago  ELSE 0 END  vl_reembolso
	from	tax_dmed_dados_gerais a,
		tax_dmed_lote_mensal b,
		fis_dados_dmed c
	where	b.nr_sequencia	= a.nr_seq_lote_mensal
	and	c.nr_sequencia	= a.nr_seq_dados_dmed
	and	a.vl_pago is not null;

