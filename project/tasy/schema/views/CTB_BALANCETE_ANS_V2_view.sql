-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ctb_balancete_ans_v2 (ie_normal_encerramento, cd_empresa, cd_estabelecimento, cd_plano, nr_seq_mes_ref, cd_classificacao, ds_conta, ds_conta_apres, cd_grupo, ie_tipo, vl_debito, vl_credito, vl_saldo, vl_movimento, vl_saldo_ant, ie_nivel, ie_classif_superior, ie_tipo_conta) AS select	'N' ie_normal_encerramento,
	b.cd_empresa,
	a.cd_estabelecimento,
	b.cd_plano,
	a.nr_seq_mes_ref,
	b.cd_classificacao,
	b.ds_conta,
	substr(ctb_obter_conta_apres_ans(b.cd_plano),1,255) ds_conta_apres,
	c.cd_grupo,
	b.ie_tipo,
	a.vl_debito,
	a.vl_credito,
	a.vl_saldo,
	(a.vl_debito - a.vl_credito) vl_movimento,
	a.vl_saldo - (a.vl_debito - a.vl_credito) vl_saldo_ant,
	ctb_obter_nivel_classif_conta(b.cd_classificacao) ie_nivel,
	substr(obter_classif_ctb(b.cd_classificacao, 'SUPERIOR'),1,255) ie_classif_superior,
	c.ie_tipo ie_tipo_conta
FROM ctb_mes_ref d, ctb_plano_ans b, ctb_saldo_ans a
LEFT OUTER JOIN ctb_grupo_conta c ON (a.cd_grupo = c.cd_grupo)
WHERE a.cd_conta_ans		= b.cd_plano and a.cd_empresa		= b.cd_empresa and a.ie_versao_ans		= b.ie_versao and a.nr_seq_mes_ref		= d.nr_sequencia
union all

select	'E' ie_normal_encerramento,
	b.cd_empresa,
	a.cd_estabelecimento,
	b.cd_plano,
	a.nr_seq_mes_ref,
	b.cd_classificacao,
	b.ds_conta,
	substr(ctb_obter_conta_apres_ans(b.cd_plano),1,255) ds_conta_apres,
	c.cd_grupo,
	b.ie_tipo,
	a.vl_debito,
	a.vl_credito,
	a.vl_saldo - vl_encerramento,
	((a.vl_debito - a.vl_credito) - a.vl_encerramento) vl_movimento,
	a.vl_saldo - (a.vl_debito - a.vl_credito) vl_saldo_ant,
	ctb_obter_nivel_classif_conta(b.cd_classificacao) ie_nivel,
	substr(obter_classif_ctb(b.cd_classificacao, 'SUPERIOR'),1,255) ie_classif_superior,
	c.ie_tipo ie_tipo_conta
FROM ctb_mes_ref d, ctb_plano_ans b, ctb_saldo_ans a
LEFT OUTER JOIN ctb_grupo_conta c ON (a.cd_grupo = c.cd_grupo)
WHERE a.cd_conta_ans		= b.cd_plano and a.cd_empresa		= b.cd_empresa and a.ie_versao_ans		= b.ie_versao and a.nr_seq_mes_ref		= d.nr_sequencia;

