-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ecd_balancete_diario_v (tp_registro, ds_identificador, cd_estabelecimento, dt_inicial, cd_conta_contabil, cd_centro_custo, vl_debito, vl_credito) AS select	distinct
	1 tp_registro,
	'|I300' ds_identificador,
	a.cd_estabelecimento,
	trunc(a.dt_movimento,'dd')	dt_inicial,
	null			cd_conta_contabil,
	null			cd_centro_custo,
	null			vl_debito,
	null			vl_credito
FROM	ctb_movimento_v a

union all

select	2 tp_registro,
	'|I310' ds_identificador,
	a.cd_estabelecimento,
	trunc(a.dt_movimento,'dd') 	dt_inicial,
	a.cd_classificacao cd_conta_contabil,
	b.cd_centro_custo,
	sum(coalesce(b.vl_movimento,a.vl_debito)) vl_debito,
	sum(coalesce(b.vl_movimento,a.vl_credito)) vl_credito
FROM ctb_movimento_v a
LEFT OUTER JOIN ctb_movto_centro_custo b ON (a.nr_sequencia = b.nr_seq_movimento) group BY a.cd_estabelecimento,
	 trunc(a.dt_movimento,'dd'),
	 a.cd_classificacao,
	 a.cd_conta_contabil,
	 b.cd_centro_custo
order by dt_inicial, tp_registro;

