-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_solic_compra_v (cd_estabelecimento, nr_solic_compra, ie_urgente, ds_urgente, dt_solicitacao_compra, dt_liberacao, dt_autorizacao, dt_baixa, cd_pessoa_solicitante, nm_pessoa_solicitante, cd_local_estoque, ds_local_estoque, cd_centro_custo, ds_centro_custo, cd_setor_atendimento, ds_setor_atendimento, cd_material, ds_material, cd_conta_contabil, ds_conta_contabil, cd_grupo_material, ds_grupo_material, cd_subgrupo_material, ds_subgrupo_material, cd_classe_material, ds_classe_material, cd_comprador_resp, nm_comprador_resp, nr_seq_motivo_urgente, ds_motivo_urgente, vl_unit_previsto, qt_material) AS select	b.cd_estabelecimento,
	b.nr_solic_compra, 
	b.ie_urgente, 
	CASE WHEN b.ie_urgente='S' THEN 'Sim'  ELSE 'NÃ£o' END  ds_urgente, 
	trunc(b.dt_solicitacao_compra,'dd') dt_solicitacao_compra, 
	trunc(b.dt_liberacao,'dd') dt_liberacao, 
	trunc(b.dt_autorizacao,'dd') dt_autorizacao, 
	trunc(b.dt_baixa,'dd') dt_baixa, 
	b.cd_pessoa_solicitante, 
	substr(obter_nome_pf_pj(b.cd_pessoa_solicitante, null),1,80) nm_pessoa_solicitante, 
	b.cd_local_estoque, 
	substr(obter_desc_local_estoque(b.cd_local_estoque),1,80) ds_local_estoque, 
	b.cd_centro_custo, 
	substr(obter_desc_centro_custo(b.cd_centro_custo),1,80) ds_centro_custo, 
	b.cd_setor_atendimento, 
	substr(obter_nome_setor(b.cd_setor_atendimento),1,80) ds_setor_atendimento, 
	a.cd_material, 
	substr(obter_desc_material(a.cd_material),1,80) ds_material, 
	a.cd_conta_contabil, 
	substr(obter_desc_conta_contabil(a.cd_conta_contabil),1,80) ds_conta_contabil, 
	c.cd_grupo_material, 
	c.ds_grupo_material, 
	c.cd_subgrupo_material, 
	c.ds_subgrupo_material, 
	c.cd_classe_material, 
	c.ds_classe_material, 
	b.cd_comprador_resp, 
	substr(sup_obter_nome_comprador(b.cd_estabelecimento, b.cd_comprador_resp),1,80) nm_comprador_resp, 
	b.nr_seq_motivo_urgente, 
	substr(OBTER_DESC_MOTIVO_URGENCIA(b.NR_SEQ_MOTIVO_URGENTE),1,100) ds_motivo_urgente, 
	coalesce(a.vl_unit_previsto,0) vl_unit_previsto, 
	a.qt_material 
FROM	estrutura_material_v c, 
	solic_compra_item a, 
	solic_compra b 
where	a.nr_solic_compra = b.nr_solic_compra 
and	a.cd_material = c.cd_material 
and	b.dt_autorizacao is not null 
and	a.dt_autorizacao is not null 
and	b.nr_seq_motivo_cancel is null 
order by b.nr_solic_compra;

