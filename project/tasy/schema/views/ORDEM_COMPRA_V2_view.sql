-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ordem_compra_v2 (cd_estabelecimento, nr_ordem_compra, dt_ordem_compra, cd_comprador, dt_aprovacao, dt_baixa, nm_comprador, nr_fone_transportador, nm_fornecedor, nm_solicitante, nm_transportador, nr_seq_motivo_cancel, cd_pessoa_solicitante) AS select	o.cd_estabelecimento,
	o.nr_ordem_compra, 
	o.dt_ordem_compra, 
	o.cd_comprador, 
	o.dt_aprovacao, 
	o.dt_baixa, 
	c.nm_guerra nm_comprador, 
	substr(obter_dados_pf_pj(null, o.cd_cgc_transportador, 'T'),1,80) nr_fone_transportador, 
	substr(obter_nome_pf_pj(o.cd_pessoa_fisica, o.cd_cgc_fornecedor),1,80) nm_fornecedor, 
	p.nm_pessoa_fisica nm_solicitante, 
	substr(obter_nome_pf_pj(null, o.cd_cgc_transportador),1,80) nm_transportador, 
	o.nr_seq_motivo_cancel, 
	o.cd_pessoa_solicitante 
FROM	comprador c, 
	pessoa_fisica p, 
	ordem_compra o 
where	o.cd_comprador     = c.cd_pessoa_fisica 
and	o.cd_pessoa_solicitante = p.cd_pessoa_fisica;

