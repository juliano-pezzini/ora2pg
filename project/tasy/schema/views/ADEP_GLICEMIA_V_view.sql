-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_glicemia_v (nr_seq_apresent, ie_tipo_glic, ds_tipo_glic, nr_atendimento, nr_prescricao, nr_seq_procedimento, nr_seq_prot_glic, cd_prescritor, nm_prescritor, nr_seq_glicemia, ie_status_glic, dt_inicio_glic, cd_pf_inic_glic, dt_termino_glic, cd_pf_term_glic, nr_seq_medicao, nr_medicao, dt_medicao, dt_prox_medicao, cd_executor, nm_executor, qt_glicemia, qt_var_glic, qt_var_glic_ref, qt_min_interv, qt_bolus_calc, qt_bolus_adm, qt_veloc_calc, qt_veloc_adm, qt_glicose_calc, qt_glicose_adm, qt_ui_insulina_calc, qt_ui_insulina_adm, ds_sugestao, cd_material, ds_material, qt_material, nr_seq_horario, ie_dose_especial, ie_medico_de, cd_prescritor_de, nm_prescritor_de) AS select	1 nr_seq_apresent,
	'CIG' ie_tipo_glic,
	'Controle intensivo da glicemia' ds_tipo_glic,
	a.nr_atendimento,
	a.nr_prescricao,
	a.nr_seq_procedimento,
	a.nr_seq_prot_glic,
	substr(obter_dados_prescricao(a.nr_prescricao,'CP'),1,10) cd_prescritor,
	substr(obter_nome_pf(substr(obter_dados_prescricao(a.nr_prescricao,'CP'),1,10)),1,60) nm_prescritor,
	a.nr_sequencia nr_seq_glicemia,
	a.ie_status_glic,
	a.dt_inicio_glic,
	a.cd_pf_inic_glic,
	a.dt_termino_glic,
	a.cd_pf_term_glic,
	b.nr_sequencia nr_seq_medicao,
	b.nr_cig nr_medicao,
	b.dt_controle dt_medicao,
	b.dt_proximo_controle dt_prox_medicao,
	substr(obter_dados_usuario_opcao(b.nm_usuario_nrec,'C'),1,10) cd_executor,
	substr(obter_nome_pf(substr(obter_dados_usuario_opcao(b.nm_usuario_nrec,'C'),1,10)),1,60) nm_executor,
	b.qt_hgt qt_glicemia,
	b.qt_variacao_hgt qt_var_glic,
	b.qt_var_hgt_ref qt_var_glic_ref,
	b.qt_min_var qt_min_interv,
	b.qt_bolus_calc,
	b.qt_bolus_adm,
	b.qt_veloc_calc,
	b.qt_veloc_adm,
	b.qt_glicose_calc,
	b.qt_glicose_adm,
	null qt_ui_insulina_calc,
	null qt_ui_insulina_adm,
	b.ds_sugestao,
	b.cd_material,
	substr(obter_desc_material(b.cd_material),1,100) ds_material,
	b.qt_material,
	b.nr_seq_horario,
	substr(obter_se_hor_dose_esp('P',b.nr_seq_horario),1,1) ie_dose_especial,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'M'),1,1) ie_medico_de,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'C'),1,10) cd_prescritor_de,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'N'),1,60) nm_prescritor_de
FROM	atendimento_cig b,
	atend_glicemia a
where	b.nr_seq_glicemia = a.nr_sequencia
and	coalesce(b.ie_status_cig, 'P') <> 'V'

union

select	2 nr_seq_apresent,
	'CCG' ie_tipo_glic,
	'Controle convencional da glicemia' ds_tipo_glic,
	a.nr_atendimento,
	a.nr_prescricao,
	a.nr_seq_procedimento,
	a.nr_seq_prot_glic,
	substr(obter_dados_prescricao(a.nr_prescricao,'CP'),1,10) cd_prescritor,
	substr(obter_nome_pf(substr(obter_dados_prescricao(a.nr_prescricao,'CP'),1,10)),1,60) nm_prescritor,
	a.nr_sequencia nr_seq_glicemia,
	a.ie_status_glic,
	a.dt_inicio_glic,
	a.cd_pf_inic_glic,
	a.dt_termino_glic,
	a.cd_pf_term_glic,
	b.nr_sequencia nr_seq_medicao,
	b.nr_glicemia nr_medicao,
	b.dt_controle dt_medicao,
	b.dt_proximo_controle dt_prox_medicao,
	substr(obter_dados_usuario_opcao(b.nm_usuario_nrec,'C'),1,10) cd_executor,
	substr(obter_nome_pf(substr(obter_dados_usuario_opcao(b.nm_usuario_nrec,'C'),1,10)),1,60) nm_executor,
	b.qt_glicemia qt_glicemia,
	b.qt_var_glicemia qt_var_glic,
	null qt_var_glic_ref,
	b.qt_min_var qt_min_interv,
	null qt_bolus_calc,
	null qt_bolus_adm,
	null qt_veloc_calc,
	null qt_veloc_adm,
	b.qt_glicose qt_glicose_calc,
	b.qt_glicose_adm qt_glicose_adm,
	b.qt_ui_insulina_calc,
	b.qt_ui_insulina_adm,
	b.ds_sugestao,
	b.cd_material,
	substr(obter_desc_material(b.cd_material),1,100) ds_material,
	b.qt_material,
	b.nr_seq_horario,
	substr(obter_se_hor_dose_esp('P',b.nr_seq_horario),1,1) ie_dose_especial,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'M'),1,1) ie_medico_de,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'C'),1,10) cd_prescritor_de,
	substr(obter_prescritor_hor_glic('P',b.nr_seq_horario,'N'),1,60) nm_prescritor_de
from	atendimento_glicemia b,
	atend_glicemia a
where	b.nr_seq_glicemia = a.nr_sequencia
and	coalesce(b.ie_status_glicemia, 'P') <> 'V';

