-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_interf_apac_uopeccan_v (cd_cns, nr_cpf, nm_paciente, ie_sexo, dt_nascimento, nm_mae, ds_logradouro, nr_logradouro, ds_complemento, cd_cep, cd_municipio, nm_responsavel, cd_cor, nr_prontuario, dt_laudo, cd_cid10, cd_procedimento_solic, cd_precedimento_autor, cd_estab_solic, cd_estab_exec, ie_carater_atend, nr_cpf_solic, nr_apac, cd_orgao_emissor, dt_autorizacao, nr_cpf_autorizador, dt_inicio_validade, dt_fim_validade, dt_inicio_trat, nm_medico_autoriz, nm_profissional_solic, nr_laudo_sus) AS select	null cd_cns,
	null nr_cpf,
	null nm_paciente,
	null ie_sexo,
	null dt_nascimento,
	null nm_mae,
	null ds_logradouro,
	null nr_logradouro,
	null ds_complemento,
	null cd_cep,
	null cd_municipio,
	null nm_responsavel,
	null cd_cor,
	null nr_prontuario,
	null dt_laudo,
	null cd_cid10,
	null cd_procedimento_solic,
	null cd_precedimento_autor,
	c.cd_cnes_hospital cd_estab_solic,
	c.cd_cnes_hospital cd_estab_exec,
	null ie_carater_atend,
	null nr_cpf_solic,
	null nr_apac,
	c.cd_orgao_emissor_apac cd_orgao_emissor,
	null dt_autorizacao,
	null nr_cpf_autorizador,
	null dt_inicio_validade,
	null dt_fim_validade,
	null dt_inicio_trat,
	null nm_medico_autoriz,
	null nm_profissional_solic,
	null nr_laudo_sus	
FROM	sus_parametros_apac	c,
	estabelecimento	b,
	sus_lote_autor	a
where	a.cd_estabelecimento	= b.cd_estabelecimento
and	b.cd_estabelecimento	= c.cd_estabelecimento

union

select	substr(to_char(d.nr_cartao_nac_sus),1,15) cd_cns,
	substr(to_char(d.nr_cpf),1,11) nr_cpf,
	substr(d.nm_pessoa_fisica,1,30) nm_paciente,
	d.ie_sexo,
	to_char(d.dt_nascimento,'yyyy/mm/dd') dt_nascimento,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 5, 'N'),1,30) nm_mae,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1, 'EN'),1,30) ds_logradouro,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1, 'NR'),1,5) nr_logradouro,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1, 'CO'),1,10) ds_complemento,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1, 'CEP'),1,8) cd_cep,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 1, 'CDM'),1,7) cd_municipio,
	substr(obter_compl_pf(c.cd_pessoa_fisica, 3, 'N'),1,30) nm_responsavel,
	coalesce(nr_seq_cor_pele,00) cd_cor,
	substr(to_char(d.nr_prontuario),1,10) nr_prontuario,
	b.dt_emissao dt_laudo,
	substr(b.cd_cid_principal,1,4) cd_cid10,
	lpad(b.cd_procedimento_solic,10,0) cd_procedimento_solic,
	null cd_precedimento_autor,
	null cd_estab_solic,
	null cd_estab_exec,
	c.ie_carater_inter_sus ie_carater_atend,
	substr(obter_cpf_pessoa_fisica(coalesce(b.cd_medico_requisitante,b.cd_profis_requisitante)),1,11) nr_cpf_solic,
	b.nr_apac,
	null cd_orgao_emissor,
	b.dt_retorno_secr dt_atualizacao,
	null nr_cpf_autorizador,
	b.dt_inicio_val_apac dt_inicio_validade,
	b.dt_fim_val_apac dt_fim_validade,
	b.dt_inicio_trat_solic dt_inicio_trat,
	null nm_medico_autoriz,
	substr(obter_nome_pf(coalesce(b.cd_medico_requisitante,b.cd_profis_requisitante)),1,30) nm_profissional_solic,
	b.nr_laudo_sus
from	pessoa_fisica		d,
	atendimento_paciente	c,
	sus_laudo_paciente	b,
	sus_lote_autor		a
where	a.nr_sequencia		= b.nr_seq_lote
and	b.nr_atendimento	= c.nr_atendimento
and	c.cd_pessoa_fisica	= d.cd_pessoa_fisica;

