-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_falhas_valorizacao_v (cd_guia, cd_proc_mat, ie_tipo_contrato, ie_status, nr_seq_tipo_atendimento, nr_seq_clinica, ie_tipo_internacao, ds_grupo_pendente, ie_origem_analise, cd_codigo, nm_prestador, cd_ocorrencia, dt_mes_competencia, ds_ocorrencia, nr_seq_prestador, ie_origem_valorizacao, ds_tipo_atendimento, ds_tipo_internacao) AS select		a.cd_guia_ok cd_guia,
		b.cd_procedimento cd_proc_mat, 
		c.ie_preco ie_tipo_contrato, 
		d.ie_status ie_status, 
		a.nr_seq_tipo_atendimento, 
		a.nr_seq_clinica, 
		case when a.IE_TIPO_GUIA = 5 then 
			a.IE_CARATER_INTERNACAO else null end ie_tipo_internacao, 
		(select z.nm_grupo_auditor 
		FROM 	pls_grupo_auditor z 
		where z.nr_sequencia = (select min(x.nr_seq_grupo) 
					from 	pls_auditoria_conta_grupo x 
					where 	x.nr_seq_analise = d.nr_sequencia 
					and x.dt_final_analise is null 
					) 
		) ds_grupo_pendente, 
		d.ie_origem_analise, 
		pls_obter_carteira_mascara(a.nr_seq_segurado) cd_codigo, 
		pls_obter_dados_prestador(e.nr_seq_prestador,'N') nm_prestador, 
		g.cd_ocorrencia cd_ocorrencia, 
		e.dt_mes_competencia dt_mes_competencia, 
		g.ds_ocorrencia ds_ocorrencia, 
		d.nr_seq_prestador nr_seq_prestador, 
		'M' ie_origem_valorizacao, 
		substr(pls_obter_desc_tipo_atend(a.nr_seq_tipo_atendimento),1,30) ds_tipo_atendimento, 
		substr(pls_obter_desc_tipo_internacao(a.nr_seq_clinica),1,30) ds_tipo_internacao	 
from		pls_conta a, 
		pls_conta_proc b, 
		pls_plano c, 
		pls_analise_conta d, 
		pls_protocolo_conta e, 
		pls_ocorrencia_benef f, 
		pls_ocorrencia g 
where 		1=1 
and		a.ie_status = 'C' 
and		b.nr_seq_conta = a.nr_sequencia 
and		c.nr_sequencia = a.nr_seq_plano 
and		d.nr_sequencia = a.nr_seq_analise 
and		e.nr_sequencia = a.nr_seq_protocolo 
and		f.nr_seq_conta = a.nr_sequencia 
and 		g.nr_sequencia = f.nr_seq_ocorrencia 
and		b.vl_procedimento = 0 

UNION ALL
 
select		a.cd_guia_ok cd_guia, 
		b.cd_material cd_proc_mat, 
		c.ie_preco ie_tipo_contrato, 
		d.ie_status, 
		a.nr_seq_tipo_atendimento, 
		a.nr_seq_clinica, 
		case when a.IE_TIPO_GUIA = 5 then a.IE_CARATER_INTERNACAO else null end ie_tipo_internacao, 
		(select z.nm_grupo_auditor 
		from 	pls_grupo_auditor z 
		where z.nr_sequencia = (select min(x.nr_seq_grupo) 
					from 	pls_auditoria_conta_grupo x 
					where 	x.nr_seq_analise = d.nr_sequencia 
					and x.dt_final_analise is null 
					) 
		) ds_grupo_pendente, 
		d.ie_origem_analise, 
		pls_obter_carteira_mascara(a.nr_seq_segurado) cd_codigo, 
		pls_obter_dados_prestador(e.nr_seq_prestador,'N') nm_prestador, 
		g.cd_ocorrencia cd_ocorrencia, 
		e.dt_mes_competencia dt_mes_competencia, 
		g.ds_ocorrencia ds_ocorrencia, 
		d.nr_seq_prestador nr_seq_prestador, 
		'M' ie_origem_valorizacao, 
		substr(pls_obter_desc_tipo_atend(a.nr_seq_tipo_atendimento),1,30) ds_tipo_atendimento, 
		substr(pls_obter_desc_tipo_internacao(a.nr_seq_clinica),1,30) ds_tipo_internacao	 
from		pls_conta a, 
		pls_conta_mat b, 
		pls_plano c, 
		pls_analise_conta d, 
		pls_protocolo_conta e, 
		pls_ocorrencia_benef f, 
		pls_ocorrencia g 
where 		1=1 
and		a.ie_status = 'C' 
and		b.nr_seq_conta = a.nr_sequencia 
and		c.nr_sequencia = a.nr_seq_plano 
and		d.nr_sequencia = a.nr_seq_analise 
and		e.nr_sequencia = a.nr_seq_protocolo 
and		f.nr_seq_conta = a.nr_sequencia 
and 		g.nr_sequencia = f.nr_seq_ocorrencia 
and		b.vl_material = 0 

UNION ALL
 
select		a.cd_guia_ok cd_guia, 
		case 
			when b.nr_seq_conta_proc is not null then (select cd_procedimento from pls_conta_proc where nr_sequencia = b.nr_seq_conta_proc) 
			when b.nr_seq_conta_mat is not null then (select cd_material from pls_conta_mat where nr_sequencia = b.nr_seq_conta_mat) 
		end cd_proc_mat,	 
		c.ie_preco ie_tipo_contrato, 
		d.ie_status, 
		a.nr_seq_tipo_atendimento, 
		a.nr_seq_clinica, 
		case when a.IE_TIPO_GUIA = 5 then a.IE_CARATER_INTERNACAO else null end ie_tipo_internacao, 
		(select z.nm_grupo_auditor 
		from 	pls_grupo_auditor z 
		where z.nr_sequencia = (select min(x.nr_seq_grupo) 
					from 	pls_auditoria_conta_grupo x 
					where 	x.nr_seq_analise = d.nr_sequencia 
					and x.dt_final_analise is null 
					) 
		) ds_grupo_pendente, 
		d.ie_origem_analise, 
		pls_obter_carteira_mascara(a.nr_seq_segurado) cd_codigo, 
		pls_obter_dados_prestador(e.nr_seq_prestador,'N') nm_prestador, 
		g.cd_ocorrencia cd_ocorrencia, 
		e.dt_mes_competencia dt_mes_competencia, 
		g.ds_ocorrencia ds_ocorrencia, 
		d.nr_seq_prestador nr_seq_prestador, 
		'C' ie_origem_valorizacao, 
		substr(pls_obter_desc_tipo_atend(a.nr_seq_tipo_atendimento),1,30) ds_tipo_atendimento, 
		substr(pls_obter_desc_tipo_internacao(a.nr_seq_clinica),1,30) ds_tipo_internacao	 
from		pls_conta a, 
		pls_conta_coparticipacao b, 
		pls_plano c, 
		pls_analise_conta d, 
		pls_protocolo_conta e, 
		pls_ocorrencia_benef f, 
		pls_ocorrencia g 
where 		1=1 
and		a.ie_status = 'C' 
and		b.nr_seq_conta = a.nr_sequencia 
and		c.nr_sequencia = a.nr_seq_plano 
and		d.nr_sequencia = a.nr_seq_analise 
and		e.nr_sequencia = a.nr_seq_protocolo 
and		f.nr_seq_conta = a.nr_sequencia 
and 		g.nr_sequencia = f.nr_seq_ocorrencia 
and		b.vl_coparticipacao = 0 

union all
 
select		a.cd_guia_ok cd_guia, 
		case 
			when b.nr_seq_conta_proc is not null then (select cd_procedimento from pls_conta_proc where nr_sequencia = b.nr_seq_conta_proc) 
			when b.nr_seq_conta_mat is not null then (select cd_material from pls_conta_mat where nr_sequencia = b.nr_seq_conta_mat) 
		end cd_proc_mat,	 
		c.ie_preco ie_tipo_contrato, 
		d.ie_status, 
		a.nr_seq_tipo_atendimento, 
		a.nr_seq_clinica, 
		case when a.IE_TIPO_GUIA = 5 then a.IE_CARATER_INTERNACAO else null end ie_tipo_internacao, 
		(select z.nm_grupo_auditor 
		from 	pls_grupo_auditor z 
		where z.nr_sequencia = (select min(x.nr_seq_grupo) 
					from 	pls_auditoria_conta_grupo x 
					where 	x.nr_seq_analise = d.nr_sequencia 
					and x.dt_final_analise is null 
					) 
		) ds_grupo_pendente, 
		d.ie_origem_analise, 
		pls_obter_carteira_mascara(a.nr_seq_segurado) cd_codigo, 
		pls_obter_dados_prestador(e.nr_seq_prestador,'N') nm_prestador, 
		g.cd_ocorrencia cd_ocorrencia, 
		e.dt_mes_competencia dt_mes_competencia, 
		g.ds_ocorrencia ds_ocorrencia, 
		d.nr_seq_prestador nr_seq_prestador, 
		'P' ie_origem_valorizacao, 
		substr(pls_obter_desc_tipo_atend(a.nr_seq_tipo_atendimento),1,30) ds_tipo_atendimento, 
		substr(pls_obter_desc_tipo_internacao(a.nr_seq_clinica),1,30) ds_tipo_internacao	 
from		pls_conta a, 
		pls_conta_pos_estabelecido b, 
		pls_plano c, 
		pls_analise_conta d, 
		pls_protocolo_conta e, 
		pls_ocorrencia_benef f, 
		pls_ocorrencia g 
where 		1=1 
and		a.ie_status = 'C' 
and		b.nr_seq_conta = a.nr_sequencia 
and		c.nr_sequencia = a.nr_seq_plano 
and		d.nr_sequencia = a.nr_seq_analise 
and		e.nr_sequencia = a.nr_seq_protocolo 
and		f.nr_seq_conta = a.nr_sequencia 
and 		g.nr_sequencia = f.nr_seq_ocorrencia 
and		b.vl_calculado = 0;

