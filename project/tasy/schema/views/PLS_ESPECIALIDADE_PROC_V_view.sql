-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_especialidade_proc_v (nr_sequencia, cd_espec_medica, ie_origem_proced, cd_procedimento, ie_liberado, nr_prioridade) AS select	grupo.nr_sequencia,
	grupo.cd_espec_medica,
	proc.ie_origem_proced,
	proc.cd_procedimento,
	regra.ie_liberado,
	5 nr_prioridade
FROM	pls_oc_proc_especialidade	grupo,
	pls_oc_proc_espec_regra		regra,
	procedimento 			proc
where	grupo.nr_sequencia		= regra.nr_seq_regra
and	grupo.ie_situacao 		= 'A'
and	regra.ie_situacao		= 'A'
and	proc.ie_origem_proced		= regra.ie_origem_proced
and	proc.cd_procedimento		= regra.cd_procedimento

union all

select	grupo.nr_sequencia,
	grupo.cd_espec_medica,
	proc.ie_origem_proced,
	proc.cd_procedimento,
	regra.ie_liberado,
	4 nr_prioridade
from	pls_oc_proc_especialidade 	grupo,
	pls_oc_proc_espec_regra		regra,
	procedimento			proc
where	grupo.nr_sequencia		= regra.nr_seq_regra
and	grupo.ie_situacao 		= 'A'
and	regra.ie_situacao		= 'A'
and	proc.cd_grupo_proc		= regra.cd_grupo_proc

union all

select	grupo.nr_sequencia,
	grupo.cd_espec_medica,
	proc.ie_origem_proced,
	proc.cd_procedimento,
	regra.ie_liberado,
	3 nr_prioridade
from	pls_oc_proc_especialidade 	grupo,
	pls_oc_proc_espec_regra		regra,
	grupo_proc			gp,
	procedimento			proc
where	grupo.nr_sequencia		= regra.nr_seq_regra
and	grupo.ie_situacao 		= 'A'
and	regra.ie_situacao		= 'A'
and	gp.cd_especialidade		= regra.cd_especialidade
and	proc.cd_grupo_proc		= gp.cd_grupo_proc

union all

select  grupo.nr_sequencia,
	grupo.cd_espec_medica,
	proc.ie_origem_proced,
	proc.cd_procedimento,
	regra.ie_liberado,
	2 nr_prioridade
from    pls_oc_proc_especialidade	grupo,
	pls_oc_proc_espec_regra    	regra,
	especialidade_proc         	ep,
	grupo_proc              	gp,
	procedimento     		proc
where	grupo.nr_sequencia		= regra.nr_seq_regra
and   	grupo.ie_situacao    	  	= 'A'
and	regra.ie_situacao		= 'A'
and	ep.cd_area_procedimento    	= regra.cd_area_procedimento
and	gp.cd_especialidade        	= ep.cd_especialidade
and	proc.cd_grupo_proc          	= gp.cd_grupo_proc

union all

/* Para os casos onde a regra Ã© vazia, tem que ligar com todos os procedimentos */

select	grupo.nr_sequencia,
	grupo.cd_espec_medica,
	proc.ie_origem_proced,
	proc.cd_procedimento,
	regra.ie_liberado,
	1 nr_prioridade
from	pls_oc_proc_especialidade 	grupo,
	procedimento 			proc,
	pls_oc_proc_espec_regra		regra
where	grupo.nr_sequencia		= regra.nr_seq_regra
and	grupo.ie_situacao 		= 'A'
and	regra.ie_situacao		= 'A'
and	regra.cd_procedimento is null
and	regra.cd_especialidade is null
and	regra.cd_area_procedimento is null
and	regra.cd_grupo_proc is null;

