-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_itens_protocolo_v (ds_sigla, ds_indice, ds_item, cd_item, cd_protocolo, nr_seq_protocolo, ie_tipo_dieta, nr_seq_apresentacao, ie_calculadora, cd_unidade_medida, qt_dose, cd_intervalo, cd_material, ie_via_aplicacao, ie_selecionado, nr_seq_guia_inf, ds_link, nr_seq_proc_interno, ie_disp_mercado, ie_altera_disp, ie_aprenta_exame_sexo, ie_sexo) AS select	distinct 'N' ds_sigla, /*Dieta Suplementar*/

			1 ds_indice,
			coalesce(a.ds_rotina,substr(b.ds_material,1,80)) ds_item,
			a.nr_seq_material cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'S' ie_tipo_dieta,
			a.nr_seq_apresentacao nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo,
      null ie_sexo
	FROM material_estab c, material b, protocolo_medic_material a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_seq_interno = d.nr_seq_material)
WHERE a.cd_material = b.cd_material and b.cd_material = c.cd_material  and c.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento and a.nr_seq_diluicao is null and a.ie_agrupador = 12 and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DS') = 'S' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(c.ie_prescricao,'S') = 'S'
	 
union

	select	distinct 'N' ds_sigla, /*Dieta Enteral*/

			2 ds_indice,
			coalesce(a.ds_rotina,substr(b.ds_material,1,80)) ds_item,
			a.nr_seq_material cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'E' ie_tipo_dieta,
			a.nr_seq_apresentacao nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
	FROM material_estab c, material b, protocolo_medic_material a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_seq_interno = d.nr_seq_material)
WHERE a.cd_material = b.cd_material and b.cd_material = c.cd_material  and a.nr_seq_diluicao is null and a.ie_agrupador = 8 and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DE') = 'S' and coalesce(b.ie_situacao, 'A') = 'A' and c.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento and coalesce(c.ie_prescricao, 'S') = 'S'
	 
union

	select	distinct'N' ds_sigla, /*Dietas Jejum*/

			3 ds_indice,
			obter_desc_tipo_jejum(nr_seq_tipo) ds_item,
			a.nr_seq_jejum cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'J' ie_tipo_dieta,
			1 nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
	FROM protocolo_medic_jejum a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_jejum = d.nr_seq_jejum)
WHERE cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DJ') = 'S'    
union

	select	distinct'N' ds_sigla, /*Dietas Orais*/

			4 ds_indice,
			substr(obter_nome_dieta(cd_dieta),1,80) ds_item,
			a.nr_seq_dieta cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'O' ie_tipo_dieta,
			1 nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
	FROM protocolo_medic_dieta a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_dieta = d.nr_seq_dieta)
WHERE cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DO') = 'S'    
union

	select	distinct 'N' ds_sigla, /*Dietas Leites*/

			5 ds_indice,
			obter_desc_material(b.cd_material) ds_item,
			b.cd_material cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_seq_protocolo,
			'L' ie_tipo_dieta,
			1 nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
	FROM protocolo_medic_produto b, protocolo_medic_leite a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_sequencia = d.nr_seq_leite)
WHERE a.nr_sequencia = b.nr_seq_prot_leite  and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DL') = 'S'
	 
union

	select	distinct 'S' ds_sigla, /*Solucoes*/

			6 ds_indice,
			coalesce(coalesce(a.ds_rotina,a.ds_solucao),cpoe_obter_prim_comp_sol(a.cd_protocolo, a.nr_sequencia, a.nr_seq_solucao)) ds_item,
			a.nr_seq_solucao cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apresentacao nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			e.nr_sequencia nr_seq_guia_inf,
			e.ds_link,
			null nr_seq_proc_interno,
			obter_se_item_disp_mercado('S', a.cd_protocolo, a.nr_sequencia, a.nr_seq_solucao) ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
	FROM material_estab d, material c, protocolo_medic_material b, protocolo_medic_solucao a
LEFT OUTER JOIN protocolo_guia_inf e ON (a.cd_protocolo = e.nr_seq_protocolo AND a.nr_sequencia = e.nr_seq_protocolo_medic AND a.nr_seq_solucao = e.nr_seq_solucao)
WHERE a.cd_protocolo = b.cd_protocolo and a.nr_sequencia = b.nr_sequencia and a.nr_seq_solucao = b.nr_seq_solucao and b.cd_material = c.cd_material and c.cd_material = d.cd_material    and coalesce(a.ie_situacao,'A') = 'A' and coalesce(a.ie_hemodialise,'N') = 'N' and coalesce(a.ie_solucao_npt,'N') = 'N' and b.ie_agrupador = 4 and coalesce(c.ie_situacao, 'A') = 'A' and coalesce(c.ie_prescricao,'S') = 'S' and coalesce(d.ie_prescricao,'S') = 'S' and d.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'S') = 'S' and cpoe_regra_se_permite_presc(b.cd_material, null, wheb_usuario_pck.get_nm_usuario) = 'S'  
	 
union

	select	distinct 'M' ds_sigla, /*Medicamentos*/

			7 ds_indice,
			substr(coalesce(a.ds_rotina, cpoe_obter_comp_med_prot(a.cd_protocolo,a.nr_sequencia,a.nr_seq_material,a.nr_agrupamento)) || CASE WHEN a.qt_dose IS NULL THEN '  '  ELSE ',  ' || coalesce(a.qt_dose, 0) || a.cd_unidade_medida END  || CASE WHEN cd_intervalo IS NULL THEN ''  ELSE ', ' || SUBSTR(OBTER_DESC_INTERVALO_PRESCR(cd_intervalo),1,100) END  || CASE WHEN ie_se_necessario='S' THEN ' - ' || obter_desc_expressao(746576)  ELSE CASE WHEN ie_acm='S' THEN ' - ' || obter_desc_expressao(283158)  ELSE ' ' END  END ,1,255) ds_item,
			a.nr_seq_material cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apresentacao nr_seq_apresentacao,
			coalesce(a.ie_calculadora, 'N') ie_calculadora,
			a.cd_unidade_medida cd_unidade_medida,
			coalesce(a.qt_dose, 0) qt_dose,
			a.cd_intervalo cd_intervalo,
			a.cd_material cd_material,
			a.ie_via_aplicacao ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			obter_se_item_disp_mercado('M', a.cd_protocolo, a.nr_sequencia, a.nr_seq_material) ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM material_estab c, material b, protocolo_medic_material a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_sequencia = d.nr_seq_protocolo_medic AND a.cd_protocolo = d.nr_seq_protocolo ))
, (a
LEFT OUTER JOIN protocolo_guia_inf d ON ((a.nr_seq_material = d.nr_seq_material)
WHERE a.cd_material = b.cd_material and b.cd_material = c.cd_material    and a.nr_seq_diluicao is null and a.ie_agrupador = 1 and coalesce(b.ie_situacao, 'A') = 'A' and coalesce(c.ie_prescricao, 'S') = 'S' and c.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'M') = 'S' and a.nr_seq_material =	(select min(nr_seq_material)
					from protocolo_medic_material b
					where	b.cd_protocolo	= a.cd_protocolo
					and	b.nr_sequencia	= a.nr_sequencia
					and	b.nr_agrupamento	= a.nr_agrupamento
					and	b.ie_agrupador	= 1) and cpoe_regra_se_permite_presc(a.cd_material, null, wheb_usuario_pck.get_nm_usuario) = 'S'          
	 
union

	select	distinct 'P' ds_sigla, /*Procedimentos*/

			8 ds_indice,
			coalesce(a.ds_prescricao,substr(b.ds_proc_exame,1,255)) ds_item,
			a.nr_seq_proc cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apres nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			a.nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      b.ie_aprenta_exame_sexo, 
      b.ie_sexo
  FROM procedimento p, proc_interno b, protocolo_medic_proc a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_proc = d.nr_seq_procedimento)
WHERE a.nr_seq_proc_interno = b.nr_sequencia and b.cd_procedimento = p.cd_procedimento and b.ie_origem_proced = p.ie_origem_proced    and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'P') = 'S' and obter_se_proc_int_lib_estab(b.nr_sequencia, wheb_usuario_pck.get_cd_estabelecimento) = 'S' and coalesce(a.ie_anatomia,'N') = 'N' and a.nr_seq_solic_bs is null and b.ie_tipo in ('O' , 'PTR') and coalesce(b.ie_situacao,'A') = 'A'
	 
union

	select	distinct 'G' ds_sigla, /*Gasoterapia*/

			9 ds_indice,
			coalesce(nm_rotina,substr(obter_descricao_padrao('GAS', 'DS_GAS', a.nr_seq_gas),1,254)) ds_item,
			a.nr_sequencia cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apres nr_seq_apresentacao,
			'N' ie_calculadora,
			null cd_unidade_medida,
			null qt_dose,
			null cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			coalesce(a.ie_altera_disp,'N'),
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM protocolo_medic_gas a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_sequencia = d.nr_seq_gas)
WHERE cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'G') = 'S'  
union

	select	distinct 'R' ds_sigla, /*Recomendacao*/

			10 ds_indice,
			substr(obter_rec_presc_prot(a.nr_sequencia,a.nr_seq_rec,a.cd_protocolo),1,250) ds_item,
			a.nr_seq_rec cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apres nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM protocolo_medic_rec a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_rec = d.nr_seq_recomendacao)
WHERE cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'R') = 'S'    and a.cd_recomendacao is not null
	 
union

	select	distinct 'DI' ds_sigla, /*Dialise*/

			11 ds_indice,
			substr(obter_valor_dominio(1934,a.ie_tipo_hemodialise),1,255) ds_item,
			a.nr_sequencia cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_seq_protocolo,
			'' ie_tipo_dieta,
			1 nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			e.nr_sequencia nr_seq_guia_inf,
			e.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM material d, protocolo_medic_material c, protocolo_medic_solucao b, protocolo_hd_prescricao a
LEFT OUTER JOIN protocolo_guia_inf e ON (a.nr_sequencia = e.nr_seq_hd)
WHERE a.cd_protocolo = b.cd_protocolo and a.nr_seq_protocolo = b.nr_sequencia  and b.cd_protocolo = c.cd_protocolo and b.nr_sequencia = c.nr_sequencia and b.nr_seq_solucao = c.nr_seq_solucao and c.cd_material = d.cd_material and coalesce(a.ie_tipo_dialise,'H') = 'H' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(b.ie_solucao_npt,'N') = 'N' and coalesce(b.ie_esquema_alternado,'N') = 'N' and coalesce(b.ie_hemodialise,'N') = 'S' and c.ie_agrupador = 13 and coalesce(d.ie_situacao, 'A') = 'A' and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DI') = 'S'
	 
union

	select	distinct 'DI' ds_sigla, /*Dialise Peritoneal*/

			11 ds_indice,
			substr(obter_valor_dominio(2154,a.ie_tipo_peritoneal),1,255) || ' - ' ||
        obter_select_concatenado_bv('select obter_desc_prot_npt(:nr_seq_prot) from dual',
                                     'nr_seq_prot=' || b.nr_seq_protocolo,
                                      ', ') as ds_item, 
			a.nr_sequencia cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_seq_protocolo,
			'' ie_tipo_dieta,
			1 nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			e.nr_sequencia nr_seq_guia_inf,
			e.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM material d, protocolo_medic_material c, protocolo_medic_solucao b, protocolo_hd_prescricao a
LEFT OUTER JOIN protocolo_guia_inf e ON (a.nr_sequencia = e.nr_seq_hd)
WHERE a.cd_protocolo = b.cd_protocolo and a.nr_seq_protocolo = b.nr_sequencia  and b.cd_protocolo = c.cd_protocolo and b.nr_sequencia = c.nr_sequencia and b.nr_seq_solucao = c.nr_seq_solucao and c.cd_material = d.cd_material and coalesce(a.ie_tipo_dialise,'H') = 'P' and coalesce(b.ie_situacao,'A') = 'A' and coalesce(b.ie_solucao_npt,'N') = 'N' and coalesce(b.ie_esquema_alternado,'N') = 'N' and coalesce(b.ie_hemodialise,'N') = 'P' and c.ie_agrupador = 13 and coalesce(d.ie_situacao, 'A') = 'A' and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DI') = 'S'
	 
union

	select	distinct 'MA' ds_sigla, /*Material*/

			12 ds_indice,
			coalesce(a.ds_rotina, substr(b.ds_material,1,80)) ds_item,
			a.nr_seq_material cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apresentacao nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM material_estab c, material b, protocolo_medic_material a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_material = d.nr_seq_material)
WHERE a.cd_material = b.cd_material    and b.cd_material = c.cd_material and a.nr_seq_diluicao is null and a.ie_agrupador = 2 and coalesce(b.ie_situacao, 'A') = 'A' and coalesce(c.ie_prescricao, 'S') = 'S' and c.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'MA') = 'S' and cpoe_regra_se_permite_presc(a.cd_material, null, wheb_usuario_pck.get_nm_usuario) = 'S'
	 
union

	select	distinct 'H' ds_sigla,  /*Hemoterapia*/

			13 ds_indice,
			coalesce(a.ds_prescricao, substr(cpoe_obtain_desc_hemo_protocol( a.cd_protocolo, a.nr_seq_protocolo, a.nr_sequencia),1,255)) ds_item,
			a.nr_sequencia cd_item,
			a.cd_protocolo,
			a.nr_seq_protocolo,
			''ie_tipo_dieta,
			b.nr_seq_apres nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      null ie_aprenta_exame_sexo, 
      null ie_sexo
  FROM san_derivado c, protocolo_medic_proc b, prot_solic_bco_sangue a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.nr_sequencia = d.nr_seq_sangue)
WHERE a.cd_protocolo = b.cd_protocolo and a.nr_seq_protocolo = b.nr_sequencia and a.nr_sequencia = b.nr_seq_solic_bs  and b.nr_seq_derivado = c.nr_sequencia and coalesce(c.ie_mostra_prescricao,'S') = 'S' and coalesce(c.ie_situacao,'A') = 'A' and cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'H') = 'S'
 
union

	SELECT	DISTINCT 'AP' ds_sigla, /*Anatomia*/

			14 ds_indice,
			coalesce(a.ds_prescricao,SUBSTR(b.ds_proc_exame,1,255)) ds_item,
			a.nr_seq_proc cd_item,
			a.cd_protocolo cd_protocolo,
			a.nr_sequencia nr_seq_protocolo,
			'' ie_tipo_dieta,
			a.nr_seq_apres nr_seq_apresentacao,
			'N' ie_calculadora,
			'N' cd_unidade_medida,
			0 qt_dose,
			'N' cd_intervalo,
			0 cd_material,
			null ie_via_aplicacao,
			a.ie_selecionado,
			d.nr_sequencia nr_seq_guia_inf,
			d.ds_link,
			null nr_seq_proc_interno,
			null ie_disp_mercado,
			null ie_altera_disp,
      b.ie_aprenta_exame_sexo, 
      b.ie_sexo
  FROM procedimento p, proc_interno b, protocolo_medic_proc a
LEFT OUTER JOIN protocolo_guia_inf d ON (a.cd_protocolo = d.nr_seq_protocolo AND a.nr_sequencia = d.nr_seq_protocolo_medic AND a.nr_seq_proc = d.nr_seq_procedimento)
WHERE a.nr_seq_proc_interno = b.nr_sequencia    AND b.cd_procedimento = p.cd_procedimento AND b.ie_origem_proced = p.ie_origem_proced AND cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'P') = 'S' AND obter_se_proc_int_lib_estab(b.nr_sequencia, wheb_usuario_pck.get_cd_estabelecimento) = 'S' AND coalesce(a.ie_anatomia,'N') = 'S' AND a.nr_seq_solic_bs IS NULL AND coalesce(b.ie_situacao,'A') = 'A' AND coalesce(p.ie_situacao,'A') = 'A';

