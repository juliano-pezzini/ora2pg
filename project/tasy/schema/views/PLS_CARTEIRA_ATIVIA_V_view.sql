-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_carteira_ativia_v (nr_seq_segurado, ordem, nr_seq_lote, lb_codigo_cli, cd_usuario_plano, lb_validade, dt_validade_carteira, lb_linha_1, lb_nome, nm_pessoa_fisica, lb_nascimento, dt_nascimento, lb_linha_2, lb_plano, ds_plano, lb_adesao, dt_contratacao, ds_segment_acomod, lb_carencia, lb_ate, carencia_1, carencia_2, carencia_3, carencia_4, carencia_5, carencia_6, carencia_7, carencia_8, carencia_9, dt_carencia_1, dt_carencia_2, dt_carencia_3, dt_carencia_4, dt_carencia_5, dt_carencia_6, dt_carencia_7, dt_carencia_8, dt_carencia_9) AS select	b.nr_sequencia nr_seq_segurado,
	1 ordem, 
	d.nr_seq_lote, 
	'Código do Cliente' lb_codigo_cli, 
	c.cd_usuario_plano, 
	'Validade' lb_validade, 
	c.dt_validade_carteira, 
	'____________________________________________________________________________' lb_linha_1, 
	'Nome do Cliente:' lb_nome, 
	upper(a.nm_pessoa_fisica) nm_pessoa_fisica, 
	'Data de Nascimento' lb_nascimento, 
	a.dt_nascimento, 
	'____________________________________________________________________________' lb_linha_2, 
	'Plano' lb_plano, 
	upper(e.ds_plano) ds_plano, 
	'Adesão' lb_adesao, 
	b.dt_contratacao, 
	upper(CASE WHEN e.ie_segmentacao='1' THEN  'AMBULATORIAL' WHEN e.ie_segmentacao='2' THEN  'HOSP C/ OBSTE' WHEN e.ie_segmentacao='3' THEN  'HOSP S/ OBSTE' WHEN e.ie_segmentacao='4' THEN  'ODONTOLÓGICO' WHEN e.ie_segmentacao='5' THEN  'REFERÊNCIA' WHEN e.ie_segmentacao='6' THEN  'AMBUL + HOSP C/ OBSTE' WHEN e.ie_segmentacao='7' THEN  'AMBUL + HOSP S/ OBSTE' WHEN e.ie_segmentacao='8' THEN  'AMBUL + ODONT' WHEN e.ie_segmentacao='9' THEN  'HOSP C/ OBSTE + ODONT' WHEN e.ie_segmentacao='10' THEN  'HOSP S/ OBSTE + ODONT' WHEN e.ie_segmentacao='11' THEN  'AMBUL + HOSP C/ OBSTE + ODONT' WHEN e.ie_segmentacao='12' THEN  'AMBUL + HOSP S/ OBSTE + ODONT' END ) || ' - ' || upper(substr(pls_obter_desc_tipo_acom_plano(e.nr_sequencia),1,100)) ds_segment_acomod, 
	'Carência' lb_carencia, 
	'Até' lb_ate, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',1),'') carencia_1, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',2),'') carencia_2, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',3),'') carencia_3, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',4),'') carencia_4, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',5),'') carencia_5, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',6),'') carencia_6, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',7),'') carencia_7, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',8),'') carencia_8, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'CSCF',9),'') carencia_9, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',1),'') dt_carencia_1, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',2),'') dt_carencia_2, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',3),'') dt_carencia_3, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',4),'') dt_carencia_4, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',5),'') dt_carencia_5, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',6),'') dt_carencia_6, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',7),'') dt_carencia_7, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',8),'') dt_carencia_8, 
	coalesce(pls_obter_dados_cart_unimed(b.nr_sequencia, b.nr_seq_plano,'DTNSA',9),'') dt_carencia_9 
FROM	pls_plano		e, 
	pls_carteira_emissao	d, 
	pls_segurado_carteira	c, 
	pls_segurado		b, 
	pessoa_fisica		a 
where	a.cd_pessoa_fisica	= b.cd_pessoa_fisica	 
and	b.nr_sequencia		= c.nr_seq_segurado 
and	c.nr_sequencia		= d.nr_seq_seg_carteira 
and	b.nr_seq_plano		= e.nr_sequencia;

