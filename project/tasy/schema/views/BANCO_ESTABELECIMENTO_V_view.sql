-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW banco_estabelecimento_v (nr_sequencia, cd_banco, cd_estabelecimento, ie_tipo_relacao, dt_atualizacao, nm_usuario, cd_agencia_bancaria, cd_conta, ie_digito_conta, cd_conta_contabil, cd_interno, ie_situacao, nr_seq_tipo_conta, ie_fluxo_caixa, ie_tipo_cobranca_bloqueto, cd_conta_bloqueto, dt_atualizacao_nrec, nm_usuario_nrec, nr_ultimo_cheque, ds_interno, ie_emite_cheque, vl_limite, cd_carteira, ie_cheque_bordero, cd_integracao_externa, ie_dia_posterior_liq, nr_seq_camara, cd_convenio_banco, ds_remessa_cobr, cd_empresa, nr_seq_relatorio_boleto, nr_seq_rel_boleto_neg, ie_cod_barras_nosso_num, cd_transmissao, nr_contrato, cd_conta_financ_inf, cd_flash, ie_deposito_ident, nr_seq_classif, ie_cobr_juro_multa_calc, cd_conv_banco_deb, ie_valor_desp_cobr, cd_cedente, cd_conta_extrato, nr_cheque_ini, nr_cheque_fim, nr_seq_fonte_recur, ie_saldo_aberto, ie_bloqueto, ie_cobranca_diretiva, ie_data_pagamento, cd_tipo_cobranca, ie_baixa_pagto_escrit, cd_cgc_cedente, cd_moeda_unica, cd_moeda, nr_seq_tipo_aplic, ds_iban, ds_bic, cd_posto, ds_remessa_pagto, nr_remessa_cobr, ds_caminho_rem_cobr, ds_caminho_rem_pagto, ds_ext_retorno_baixa_aut, ds_ext_extrato_baixa_aut, ds_banco, ds_agencia_bancaria, ds_conta, ie_imp_extrato_dup, cd_empresa_estab, nm_contato, ie_digito_agencia, ds_moeda, ie_situacao_banco, ie_situacao_agencia) AS Select	a.NR_SEQUENCIA,a.CD_BANCO,a.CD_ESTABELECIMENTO,a.IE_TIPO_RELACAO,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_AGENCIA_BANCARIA,a.CD_CONTA,a.IE_DIGITO_CONTA,a.CD_CONTA_CONTABIL,a.CD_INTERNO,a.IE_SITUACAO,a.NR_SEQ_TIPO_CONTA,a.IE_FLUXO_CAIXA,a.IE_TIPO_COBRANCA_BLOQUETO,a.CD_CONTA_BLOQUETO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NR_ULTIMO_CHEQUE,a.DS_INTERNO,a.IE_EMITE_CHEQUE,a.VL_LIMITE,a.CD_CARTEIRA,a.IE_CHEQUE_BORDERO,a.CD_INTEGRACAO_EXTERNA,a.IE_DIA_POSTERIOR_LIQ,a.NR_SEQ_CAMARA,a.CD_CONVENIO_BANCO,a.DS_REMESSA_COBR,a.CD_EMPRESA,a.NR_SEQ_RELATORIO_BOLETO,a.NR_SEQ_REL_BOLETO_NEG,a.IE_COD_BARRAS_NOSSO_NUM,a.CD_TRANSMISSAO,a.NR_CONTRATO,a.CD_CONTA_FINANC_INF,a.CD_FLASH,a.IE_DEPOSITO_IDENT,a.NR_SEQ_CLASSIF,a.IE_COBR_JURO_MULTA_CALC,a.CD_CONV_BANCO_DEB,a.IE_VALOR_DESP_COBR,a.CD_CEDENTE,a.CD_CONTA_EXTRATO,a.NR_CHEQUE_INI,a.NR_CHEQUE_FIM,a.NR_SEQ_FONTE_RECUR,a.IE_SALDO_ABERTO,a.IE_BLOQUETO,a.IE_COBRANCA_DIRETIVA,a.IE_DATA_PAGAMENTO,a.CD_TIPO_COBRANCA,a.IE_BAIXA_PAGTO_ESCRIT,a.CD_CGC_CEDENTE,a.CD_MOEDA_UNICA,a.CD_MOEDA,a.NR_SEQ_TIPO_APLIC,a.DS_IBAN,a.DS_BIC,a.CD_POSTO,a.DS_REMESSA_PAGTO,a.NR_REMESSA_COBR,a.DS_CAMINHO_REM_COBR,a.DS_CAMINHO_REM_PAGTO,a.DS_EXT_RETORNO_BAIXA_AUT,a.DS_EXT_EXTRATO_BAIXA_AUT,
	b.ds_banco,
	c.ds_agencia_bancaria,
	coalesce(a.ds_interno,substr(CASE WHEN a.cd_interno IS NULL THEN ''  ELSE a.cd_interno || ' - ' END  ||
	b.ds_banco || ' - ' || c.ds_agencia_bancaria || ' - ' || a.cd_conta || ' - ' ||
	substr(v.ds_expressao, 1, length(trim(both v.ds_expressao))) || CASE WHEN t.ds_tipo_conta='' THEN ''  ELSE ' - ' || t.ds_tipo_conta END ,1,254)) ds_conta,
	b.ie_imp_extrato_dup,
	coalesce(d.cd_empresa,a.cd_empresa) cd_empresa_estab,
	c.nm_contato,
	c.ie_digito ie_digito_agencia,
	substr(obter_desc_moeda(a.cd_moeda),1,254) ds_moeda,
	coalesce(b.ie_situacao,'A') ie_situacao_banco,
	coalesce(c.ie_situacao,'A')  ie_situacao_agencia
FROM valor_dominio_v v, banco b, banco_estabelecimento a
LEFT OUTER JOIN agencia_bancaria c ON (a.cd_banco = c.cd_banco AND a.cd_agencia_bancaria = c.cd_agencia_bancaria)
LEFT OUTER JOIN estabelecimento d ON (a.cd_estabelecimento = d.cd_estabelecimento)
LEFT OUTER JOIN conta_banco_tipo t ON (a.nr_seq_tipo_conta = t.nr_sequencia)
WHERE a.cd_banco		= b.cd_banco   and v.cd_dominio		= 504   and v.vl_dominio		= a.ie_tipo_relacao;

