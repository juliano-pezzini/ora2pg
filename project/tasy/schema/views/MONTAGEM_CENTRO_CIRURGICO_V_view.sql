-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW montagem_centro_cirurgico_v (nr_sequencia, dt_agenda, hr_inicio, nm_paciente, ds_procedimento, ds_idade, ds_proced_adic, nm_cirurgiao, ds_observacao, ds_lista_equip, ds_lista_cme, ds_lista_pedido, cd_estabelecimento, ds_agenda, ds_informacoes_internacao, ie_aprov_equip, ie_aprov_cme, ie_aprov_kit, ie_aprov_fax, ds_cor_linha, ds_cor_equip, ds_cor_cme, ds_cor_kit, ds_cor_fax, ds_proc_painel, qt_idade_paciente, nr_minuto_duracao, cd_agenda, ds_convenio, ds_tipo_nec_esp) AS select	a.nr_sequencia,
	a.dt_agenda,
	a.hr_inicio,
	substr(CASE WHEN a.cd_pessoa_fisica IS NULL THEN a.nm_paciente  ELSE obter_nome_pf(a.cd_pessoa_fisica) END ,1,255) nm_paciente,
	substr(obter_exame_agenda(cd_procedimento, ie_origem_proced, nr_seq_proc_interno),1,255) ds_procedimento,
	substr(CASE WHEN a.dt_nascimento_pac IS NULL THEN obter_idade_pf(a.cd_pessoa_fisica,LOCALTIMESTAMP,'S')  ELSE obter_idade(a.dt_nascimento_pac,LOCALTIMESTAMP,'S') END ,1,255) ds_idade,
	substr(obter_lista_proced_adic_agenda(a.nr_sequencia),1,255) ds_proced_adic,
	substr(obter_nome_pf(a.cd_medico),1,255) nm_cirurgiao,
	substr(a.ds_observacao,1,255) ds_observacao,
	substr(obter_lista_equip_monta(a.nr_sequencia),1,255) ds_lista_equip,
	substr(obter_lista_cme_monta(a.nr_sequencia),1,255) ds_lista_cme,
	substr(obter_lista_pedido_kit_monta(a.nr_sequencia),1,255) ds_lista_pedido,
	b.cd_estabelecimento,
	substr(b.ds_agenda,1,255) ds_agenda,
	substr(obter_dados_inf_adic_agenda(a.nr_sequencia,'II'),1,255) ds_informacoes_internacao,
	obter_data_aprovacao_montagem(a.nr_sequencia,'E') ie_aprov_equip,
	obter_data_aprovacao_montagem(a.nr_sequencia,'C') ie_aprov_cme,
	obter_data_aprovacao_montagem(a.nr_sequencia,'K') ie_aprov_kit,
	obter_data_aprovacao_montagem(a.nr_sequencia,'F') ie_aprov_fax,
	obter_cor_grid_montagem(a.nr_sequencia,'L',null) ds_cor_linha,
	obter_cor_grid_montagem(a.nr_sequencia,'C','E') ds_cor_equip,
	obter_cor_grid_montagem(a.nr_sequencia,'C','C') ds_cor_cme,
	obter_cor_grid_montagem(a.nr_sequencia,'C','K') ds_cor_kit,
	obter_cor_grid_montagem(a.nr_sequencia,'C','F') ds_cor_fax,
	SUBSTR(obter_desc_proc_painel(a.nr_sequencia,3),1,255) ds_proc_painel,
	a.qt_idade_paciente,
	a.nr_minuto_duracao,
	b.cd_agenda,
	substr(obter_nome_convenio(a.cd_convenio),1,40) ds_convenio,
    substr(obter_desc_tipo_nec_espe(a.nr_seq_tipo_nec_esp),1,100) ds_tipo_nec_esp
FROM	agenda_paciente a,
	agenda b
WHERE	a.cd_agenda 	 	= b.cd_agenda
AND	a.ie_status_agenda	not in ('L','C')
and	b.cd_tipo_agenda	= 1
AND 	coalesce(b.ie_situacao,'A') 	= 'A';

