-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW usuario_nivel_des_v (nr_sequencia, nm_usuario_des, nr_seq_nivel, dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec, dt_referencia, ds_nivel, qt_media_nivel, qt_media_menor, qt_media_maior) AS select a.NR_SEQUENCIA,a.NM_USUARIO_DES,a.NR_SEQ_NIVEL,a.DT_ATUALIZACAO,a.NM_USUARIO,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.DT_REFERENCIA, b.ds_nivel, b.qt_media_nivel, (b.qt_media_nivel - (b.qt_media_nivel * 0.10)) qt_media_menor,
(b.qt_media_nivel + (b.qt_media_nivel * 0.10)) qt_media_maior
FROM nivel_grupo_des b, usuario_nivel_des a
where a.nr_seq_nivel   = b.nr_sequencia
and a.dt_referencia =
        (select max(x.dt_referencia)
        from    usuario_nivel_des x
        where   x.nm_usuario_des = a.nm_usuario_des);

