-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW cpoe_material_rel_2_v (nm_medicamento, ds_com_medicamento, dt_suspensao, ie_baixado_por_alta, ds_alto_risco, ds_do_paciente, ds_componente, dt_inicio, ds_fim, nr_sequencia_p, ds_tempo_adm, dt_liberacao, nm_usuario, dt_fim, ie_administracao, ie_duracao, nm_usuario_susp, dt_lib_suspensao, cd_material, ie_controle_tempo, ie_tipo_solucao, ie_via_aplicacao, nr_atendimento, qt_dose_terapeutica, cd_unid_medic_terap, nm_medicamento_1, nm_medicamento_2, nm_medicamento_3, nm_medicamento_4, nm_medicamento_5, nm_medicamento_6, nm_reconstituicao, nm_diluicao, nm_rediluicao, ds_justificativa, ds_observacao, ds_horarios, dt_liberacao_enf) AS select	substr(a.nm_medicamento||
		CASE WHEN a.ds_com_medicamento IS NULL THEN  null  ELSE ' '||a.ds_com_medicamento END ||
		CASE WHEN a.ds_alto_risco IS NULL THEN  null  ELSE ' <b>'||a.ds_alto_risco||'</b>' END ||
		CASE WHEN a.ds_do_paciente IS NULL THEN  null  ELSE ' <b>'||a.ds_do_paciente||'</b>' END ||
		CASE WHEN a.ds_tempo_adm IS NULL THEN  null  ELSE ' '||a.ds_tempo_adm END ,1,2000) nm_medicamento,
		a.ds_com_medicamento,
		a.dt_suspensao,
		a.ie_baixado_por_alta,
		a.ds_alto_risco,
		a.ds_do_paciente,
		a.ds_componente,
		a.dt_inicio,
		a.ds_fim,
		a.nr_sequencia_p,
		a.ds_tempo_adm,
		a.dt_liberacao,
		a.nm_usuario,
		a.dt_fim,
		a.ie_administracao,
		a.ie_duracao,
		a.nm_usuario_susp,
		a.dt_lib_suspensao,
		a.cd_material,
		a.ie_controle_tempo,
		a.ie_tipo_solucao,
		a.ie_via_aplicacao,
		a.nr_atendimento,
		qt_dose_terapeutica,
		cd_unid_medic_terap,
		CASE WHEN a.cd_mat_comp1 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp1),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp1, a.cd_unid_med_dose_comp1,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp1) END nm_medicamento_1,
		CASE WHEN a.cd_mat_comp2 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp2),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp2, a.cd_unid_med_dose_comp2,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp2) END nm_medicamento_2,
		CASE WHEN a.cd_mat_comp3 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp3),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp3, a.cd_unid_med_dose_comp3,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp3) END  nm_medicamento_3,
		CASE WHEN a.cd_mat_comp4 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp4),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp4, a.cd_unid_med_dose_comp4,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp4) END  nm_medicamento_4,
		CASE WHEN a.cd_mat_comp5 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp5),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp5, a.cd_unid_med_dose_comp5,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp5) END  nm_medicamento_5,
		CASE WHEN a.cd_mat_comp6 IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_comp6),1,255) ||' '|| cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_comp6, a.cd_unid_med_dose_comp6,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_comp6) END  nm_medicamento_6,
		CASE WHEN a.cd_mat_recons IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_recons),1,255) ||' '||	cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_recons, a.cd_unid_med_dose_recons,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_rec) END  nm_reconstituicao,
		CASE WHEN a.cd_mat_dil IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_dil),1,255) ||' '||	cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_dil, a.cd_unid_med_dose_dil,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_dil, null, null, null,a.nr_sequencia_p) END  nm_diluicao,
		CASE WHEN a.cd_mat_red IS NULL THEN  null  ELSE substr(obter_desc_material(a.cd_mat_red),1,255) ||' '||	cpoe_obter_comp_mat_rel('SI', null, a.qt_dose_red, a.cd_unid_med_dose_red,null, null, null,null, null, null, null,null,null,null,null,null,a.ds_dose_diferenciada_red) END   nm_rediluicao,
		CASE WHEN ds_justificativa IS NULL THEN null  ELSE substr(substr(obter_desc_expressao(341044, ''),1,70) || ' ' ||  substr(ds_justificativa,1,3900),1,4000) END  ds_justificativa,
		CASE WHEN ds_observacao IS NULL THEN null  ELSE substr(obter_desc_expressao(329252, ''),1,255) || ' ' || substr(ds_observacao,1,3500) END  ds_observacao,
		CASE WHEN a.ds_horarios IS NULL THEN  null  ELSE obter_desc_expressao(291449, '') ||': '|| a.ds_horarios END  ds_horarios,
		a.dt_liberacao_enf
FROM 	cpoe_material_rel_v a
where 	a.ie_controle_tempo = 'N';

