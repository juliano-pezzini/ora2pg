-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_titulo_convenio_v (ds_convenio, vl_vencimento, dt_referencia, cd_estabelecimento, vl_meta, pr_meta, cd_empresa) AS select	coalesce(substr(a.DS_CONVENIO,1,255), 'Não Informado') ds_convenio,
	sum(coalesce(a.VL_VENCIMENTO,0)) vl_vencimento,
	trunc(a.DT_REFERENCIA,'month') dt_referencia,  /* Alterado para trunc 'month' OS 135801 Painél valores à receber */
	b.cd_estabelecimento,
	b.vl_meta,
	(dividir_sem_round(sum(coalesce(a.VL_VENCIMENTO,0)),b.vl_meta) * 100) pr_meta,
	substr(obter_empresa_estab(b.cd_estabelecimento),1,255) cd_empresa
FROM	eis_meta_titulo_convenio b,
	eis_titulo_vencimento a
where	a.DS_CONVENIO 			is not null
and	a.cd_convenio			= b.cd_convenio
and	a.cd_estabelecimento		= b.cd_estabelecimento
and	trunc(a.dt_referencia, 'month')	= trunc(b.dt_referencia, 'month')
group	by coalesce(substr(a.DS_CONVENIO,1,255), 'Não Informado'),
	trunc(a.DT_REFERENCIA,'month'),
	b.cd_estabelecimento,
	substr(obter_empresa_estab(b.cd_estabelecimento),1,255),
	b.vl_meta;

