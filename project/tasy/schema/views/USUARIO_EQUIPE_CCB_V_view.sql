-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW usuario_equipe_ccb_v (nr_seq_equipe, ds_equipe, ie_regra_composicao_equipe, ie_situacao_equipe, nr_seq_tipo_executor_grupo, cd_cargo_usuario, cd_pessoa_fisica_usuario, nm_usuario, dt_inicio, dt_fim, ie_vigente) AS select	e.nr_sequencia nr_seq_equipe,
		e.ds_equipe ds_equipe,
		e.ie_regra_composicao ie_regra_composicao_equipe,
		e.ie_situacao ie_situacao_equipe,
		e.nr_seq_tipo_executor nr_seq_tipo_executor_grupo,
		r.cd_cargo cd_cargo_usuario,
		r.cd_pessoa_fisica cd_pessoa_fisica_usuario,
		obter_nm_usuario_cf(r.cd_pessoa_fisica) nm_usuario,
		r.dt_inicio dt_inicio,
		r.dt_fim dt_fim,
		(
			case
				when LOCALTIMESTAMP between r.dt_inicio and r.dt_fim
					then 'S'
				when r.dt_fim is null and r.dt_inicio < LOCALTIMESTAMP
					then 'S'
				else 'N'
			end
		) ie_vigente
FROM	ccb_equipe e,
		ccb_equipe_regra r
where	r.nr_seq_equipe = e.nr_sequencia
and		e.ie_regra_composicao <> 'C'

union

select	e.nr_sequencia nr_seq_equipe,
		e.ds_equipe ds_equipe,
		e.ie_regra_composicao ie_regra_composicao_equipe,
		e.ie_situacao ie_situacao_equipe,
		e.nr_seq_tipo_executor nr_seq_tipo_executor_grupo,
		r.cd_cargo cd_cargo_usuario,
		r.cd_pessoa_fisica cd_pessoa_fisica_usuario,
		obter_nm_usuario_cf(p.cd_pessoa_fisica) nm_usuario,
		r.dt_inicio dt_inicio,
		r.dt_fim dt_fim,
		(
			case
				when LOCALTIMESTAMP between r.dt_inicio and r.dt_fim
					then 'S'
				when r.dt_fim is null and r.dt_inicio < LOCALTIMESTAMP
					then 'S'
				else 'N'
			end
		) ie_vigente
from	ccb_equipe e,
		ccb_equipe_regra r,
		pessoa_fisica p
where	r.nr_seq_equipe = e.nr_sequencia
and		e.ie_regra_composicao = 'C'
and		r.cd_cargo = p.cd_cargo;

