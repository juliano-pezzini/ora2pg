-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW surgery_item_mipres_material_v (nr_cirurgia, nr_prescricao, nr_seq_item_presc, ie_tipo_item_presc, nr_atendimento) AS SELECT  B.NR_CIRURGIA,
            A.NR_PRESCRICAO,
            A.NR_SEQUENCIA NR_SEQ_ITEM_PRESC,
            'MAT' IE_TIPO_ITEM_PRESC,
            B.NR_ATENDIMENTO
    FROM    PRESCR_MATERIAL A,
            CIRURGIA B
    WHERE   coalesce(A.CD_MOTIVO_BAIXA, 0) > 0
    AND     IS_MATERIAL_NO_PBS(A.CD_MATERIAL) = 'S'
    AND     B.NR_PRESCRICAO = A.NR_PRESCRICAO

UNION ALL

    SELECT  B.NR_CIRURGIA,
            B.NR_PRESCRICAO,
            B.NR_SEQUENCIA_PRESCRICAO NR_SEQ_ITEM_PRESC,
            'MAT' IE_TIPO_ITEM_PRESC,
            B.NR_ATENDIMENTO
    FROM    MATERIAL_ATEND_PACIENTE B
    WHERE   B.CD_MOTIVO_EXC_CONTA IS NULL
    AND     B.QT_MATERIAL > 0
    AND     IS_MATERIAL_NO_PBS(B.CD_MATERIAL) = 'S';

