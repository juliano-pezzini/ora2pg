-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW adep_sol_prescr_v (ie_tipo_solucao, nr_atendimento, nr_prescricao, dt_susp_prescr, dt_prescricao, dt_liberacao, dt_inicio_prescr, dt_validade_prescr, nr_seq_solucao, ie_suspenso, ds_solucao, ds_orientacao, qt_veloc_atual, qt_veloc_orig, ie_tipo_dosagem, ie_acm, qt_vol_solucao, qt_volume_suspenso, qt_vol_inf_atual, qt_vol_desp_atual, qt_vol_restante, qt_tempo_solucao, nr_etapas, nr_etapas_suspensa, qt_tempo_etapa, hr_prim_horario, ie_di, ie_status_solucao, dt_status, dt_prev_prox_etapa, ie_adep, cd_item, nr_seq_dialise) AS select	1 ie_tipo_solucao,
		a.nr_atendimento,
		b.nr_prescricao nr_prescricao,
		a.dt_suspensao dt_susp_prescr,
		a.dt_prescricao,
		a.dt_liberacao,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.nr_seq_solucao nr_seq_solucao,
		coalesce(b.ie_suspenso,'N') ie_suspenso,
		--b.ds_solucao,
		substr(coalesce(b.ds_solucao,obter_prim_comp_sol(b.nr_prescricao, b.nr_seq_solucao)),1,240) ds_solucao,
		b.ds_orientacao,
		coalesce(obter_dados_solucao(1,b.nr_prescricao,b.nr_seq_solucao,'VA'),b.qt_dosagem) qt_veloc_atual,
		b.qt_dosagem qt_veloc_orig,
		b.ie_tipo_dosagem,
		b.ie_acm,
		coalesce(b.qt_solucao_total,b.qt_volume_adep) qt_vol_solucao,
		coalesce(b.qt_volume_suspenso,0) qt_volume_suspenso,
		obter_dados_solucao(1,b.nr_prescricao,b.nr_seq_solucao,'VI') qt_vol_inf_atual,
		obter_dados_solucao(1,b.nr_prescricao,b.nr_seq_solucao,'VD') qt_vol_desp_atual,
		obter_dados_solucao(1,b.nr_prescricao,b.nr_seq_solucao,'VR') qt_vol_restante,
		b.qt_tempo_aplicacao qt_tempo_solucao,
		b.nr_etapas nr_etapas,
		b.nr_etapas_suspensa nr_etapas_suspensa,
		b.qt_hora_fase qt_tempo_etapa,
		b.hr_prim_horario hr_prim_horario,
		b.ie_bomba_infusao ie_di,
		substr(obter_status_solucao_prescr(1,a.nr_prescricao,b.nr_seq_solucao),1,3) ie_status_solucao,
		b.dt_status dt_status,
		b.dt_prev_prox_etapa,
		a.ie_adep,
		null cd_item,
		b.nr_seq_dialise nr_seq_dialise
FROM	prescr_solucao b,
		prescr_medica a
where	b.nr_prescricao = a.nr_prescricao
and	obter_se_exibe_sol_consist(b.nr_seq_dialise, b.nr_seq_solucao, a.nr_prescricao) = 'S'
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'

union

select	2 ie_tipo_solucao,
		a.nr_atendimento,
		b.nr_prescricao nr_prescricao,
		a.dt_suspensao dt_susp_prescr,
		a.dt_prescricao,
		a.dt_liberacao,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.nr_sequencia nr_seq_solucao,
		coalesce(b.ie_suspenso,'N') ie_suspenso,
		substr(obter_desc_material(b.cd_material),1,100) ds_solucao,
		'' ds_orientacao,
		coalesce(obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_vel_infusao) qt_veloc_atual,
		b.qt_vel_infusao qt_veloc_orig,
		b.cd_unidade_medida_dose ie_tipo_dosagem,
		b.ie_acm,
		b.qt_dose qt_vol_solucao,
		0 qt_volume_suspenso,
		obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VI') qt_vol_inf_atual,
		obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VD') qt_vol_desp_atual,
		obter_dados_solucao(2,b.nr_prescricao,b.nr_sequencia,'VR') qt_vol_restante,
		null qt_tempo_solucao,
		null nr_etapas,
		null nr_etapas_suspensa,
		null qt_tempo_etapa,
		b.hr_prim_horario hr_prim_horario,
		b.ie_bomba_infusao ie_di,
		b.ie_status ie_status_solucao,
		b.dt_status dt_status,
		null dt_prev_prox_etapa,
		a.ie_adep,
		b.cd_material cd_item,
		null nr_seq_dialise
from	prescr_material b,
		prescr_medica a
where	b.ie_agrupador = 8
and		b.nr_prescricao = a.nr_prescricao
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'

union

select	3 ie_tipo_solucao,
		a.nr_atendimento,
		b.nr_prescricao nr_prescricao,
		a.dt_suspensao dt_susp_prescr,
		a.dt_prescricao,
		a.dt_liberacao,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.nr_sequencia nr_seq_solucao,
		coalesce(b.ie_suspenso,'N') ie_suspenso,
		substr(obter_desc_san_derivado(b.nr_seq_derivado),1,50) ds_solucao,
		'' ds_orientacao,
		coalesce(obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_veloc_inf_hemo) qt_veloc_atual,
		b.qt_veloc_inf_hemo qt_veloc_orig,
		b.cd_unid_med_sangue ie_tipo_dosagem,
		b.ie_acm ie_acm,
		b.qt_vol_hemocomp qt_vol_solucao,
		coalesce(b.qt_volume_suspenso,0) qt_volume_suspenso,
		obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VI') qt_vol_inf_atual,
		obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VD') qt_vol_desp_atual,
		obter_dados_solucao(3,b.nr_prescricao,b.nr_sequencia,'VR') qt_vol_restante,
		null qt_tempo_solucao,
		b.qt_procedimento nr_etapas,
		b.nr_etapas_suspensa nr_etapas_suspensa,
		null qt_tempo_etapa,
		to_char(b.dt_prev_execucao,'hh24:mi') hr_prim_horario,
		'' ie_di,
		b.ie_status ie_status_solucao,
		b.dt_status dt_status,
		null dt_prev_prox_etapa,
		a.ie_adep,
		b.cd_procedimento cd_item,
		null nr_seq_dialise
from	prescr_procedimento b,
		prescr_medica a
where	b.nr_seq_solic_sangue is not null
and		b.nr_seq_derivado is not null
and		b.nr_prescricao = a.nr_prescricao
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'

union

select	4 ie_tipo_solucao,
		a.nr_atendimento,
		b.nr_prescricao nr_prescricao,
		a.dt_suspensao dt_susp_prescr,
		a.dt_prescricao,
		a.dt_liberacao,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.nr_sequencia nr_seq_solucao,
		coalesce(b.ie_suspenso,'N') ie_suspenso,
		'NPT Adulta' ds_solucao,
		'' ds_orientacao,
		coalesce(obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_gotejamento_npt) qt_veloc_atual,
		b.qt_gotejamento_npt qt_veloc_orig,
		'ml/h' ie_tipo_dosagem,
		'N' ie_acm,
		obter_volume_nut_pac(b.nr_sequencia) qt_vol_solucao,
		0 qt_volume_suspenso,
		obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VI') qt_vol_inf_atual,
		obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VD') qt_vol_desp_atual,
		obter_dados_solucao(4,b.nr_prescricao,b.nr_sequencia,'VR') qt_vol_restante,
		null qt_tempo_solucao,
		b.qt_fase_npt nr_etapas,
		null nr_etapas_suspensa,
		null qt_tempo_etapa,
		null hr_prim_horario,
		b.ie_bomba_infusao ie_di,
		b.ie_status ie_status_solucao,
		b.dt_status dt_status,
		null dt_prev_prox_etapa,
		a.ie_adep,
		null cd_item,
		null nr_seq_dialise
from	nut_paciente b,
		prescr_medica a
where	b.nr_prescricao = a.nr_prescricao
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days'

union

select	5 ie_tipo_solucao,
		a.nr_atendimento,
		b.nr_prescricao nr_prescricao,
		a.dt_suspensao dt_susp_prescr,
		a.dt_prescricao,
		a.dt_liberacao,
		a.dt_inicio_prescr,
		a.dt_validade_prescr,
		b.nr_sequencia nr_seq_solucao,
		coalesce(b.ie_suspenso,'N') ie_suspenso,
		'NPT Neonatal' ds_solucao,
		'' ds_orientacao,
		coalesce(obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VA'),b.qt_gotejo_npt) qt_veloc_atual,
		b.qt_gotejo_npt qt_veloc_orig,
		'ml/h' ie_tipo_dosagem,
		'N' ie_acm,
		obter_volume_nut_pac(b.nr_sequencia) qt_vol_solucao,
		0 qt_volume_suspenso,
		obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VI') qt_vol_inf_atual,
		obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VD') qt_vol_desp_atual,
		obter_dados_solucao(5,b.nr_prescricao,b.nr_sequencia,'VR') qt_vol_restante,
		null qt_tempo_solucao,
		b.qt_fase_npt nr_etapas,
		null nr_etapas_suspensa,
		null qt_tempo_etapa,
		null hr_prim_horario,
		b.ie_bomba_infusao ie_di,
		b.ie_status ie_status_solucao,
		b.dt_status dt_status,
		null dt_prev_prox_etapa,
		a.ie_adep,
		null cd_item,
		null nr_seq_dialise
from	nut_pac b,
		prescr_medica a
where	b.nr_prescricao = a.nr_prescricao
and		a.dt_prescricao > LOCALTIMESTAMP - interval '500 days';

