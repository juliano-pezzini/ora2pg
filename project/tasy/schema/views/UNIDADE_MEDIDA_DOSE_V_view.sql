-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW unidade_medida_dose_v (ie_prioridade, cd_unidade_medida, qt_conversao, ds_unidade_medida, cd_material, ie_unidade_adm, ie_permite_prescr) AS SELECT A.IE_PRIORIDADE,
       A.CD_UNIDADE_MEDIDA,
       A.QT_CONVERSAO,
       B.DS_UNIDADE_MEDIDA,
       A.CD_MATERIAL,
	   coalesce(B.IE_UNIDADE_ADM,'N') IE_UNIDADE_ADM,
	   coalesce(A.IE_PERMITE_PRESCR,'S') IE_PERMITE_PRESCR
FROM MATERIAL_CONVERSAO_UNIDADE A, UNIDADE_MEDIDA B
WHERE A.CD_UNIDADE_MEDIDA = B.CD_UNIDADE_MEDIDA
AND	  B.IE_SITUACAO = 'A'

union

SELECT 0,
       A.CD_UNIDADE_MEDIDA_CONSUMO,
       1,
       B.DS_UNIDADE_MEDIDA,
	   A.CD_MATERIAL,
	   coalesce(B.IE_UNIDADE_ADM,'N') IE_UNIDADE_ADM,
	   coalesce((SELECT MAX(IE_PERMITE_PRESCR) FROM  MATERIAL_CONVERSAO_UNIDADE C WHERE C.CD_UNIDADE_MEDIDA = B.CD_UNIDADE_MEDIDA AND A.CD_MATERIAL = C.CD_MATERIAL), 'S') IE_PERMITE_PRESCR
FROM MATERIAL A, UNIDADE_MEDIDA B
WHERE A.CD_UNIDADE_MEDIDA_CONSUMO = B.CD_UNIDADE_MEDIDA
AND	  B.IE_SITUACAO = 'A'

union

SELECT 8,
       A.CD_UNIDADE_MEDIDA_CONSUMO,
       1,
       B.DS_UNIDADE_MEDIDA,
	   A.CD_MATERIAL,
	   coalesce(B.IE_UNIDADE_ADM,'N') IE_UNIDADE_ADM,
	   coalesce((SELECT MAX(IE_PERMITE_PRESCR) FROM  MATERIAL_CONVERSAO_UNIDADE C WHERE C.CD_UNIDADE_MEDIDA = B.CD_UNIDADE_MEDIDA AND A.CD_MATERIAL = C.CD_MATERIAL), 'S') IE_PERMITE_PRESCR
FROM MATERIAL A, UNIDADE_MEDIDA B
WHERE A.CD_UNIDADE_MEDIDA_CONSUMO = B.CD_UNIDADE_MED_PRINC
AND	  B.IE_SITUACAO = 'A'

union

SELECT 9,
       B.CD_UNIDADE_MEDIDA,
       A.QT_CONVERSAO,
       B.DS_UNIDADE_MEDIDA,
	   A.CD_MATERIAL	,
	   coalesce(B.IE_UNIDADE_ADM,'N') IE_UNIDADE_ADM,
	   coalesce(A.IE_PERMITE_PRESCR,'S') IE_PERMITE_PRESCR
FROM MATERIAL_CONVERSAO_UNIDADE A, UNIDADE_MEDIDA B
WHERE A.CD_UNIDADE_MEDIDA = B.CD_UNIDADE_MED_PRINC
AND	  B.IE_SITUACAO = 'A';

