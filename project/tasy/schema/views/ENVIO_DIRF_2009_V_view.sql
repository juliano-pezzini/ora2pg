-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW envio_dirf_2009_v (nr_seq_lote, nr_seq_registro, ie_tipo_registro, nr_cpf_cnpj, nm_arquivo, dt_ano, ie_tipo_declaracao, ie_situacao_declaracao, ie_tipo_declarante, ie_natureza_declarante, ie_tipo_rendimento, ie_indicador_depositario, nm_declarante, cd_cpf, dt_evento, nr_recibo, cd_cpf_responsavel, nm_responsavel, nr_ddd_resp, nr_telefone_resp, nr_ramal_resp, nr_fax_resp, ds_email_resp, ie_uso_declarante, cd_retencao, ie_tipo_beneficiario, nr_beneficiario, nm_beneficiario, vl_rend_jan, vl_deducoes_jan, vl_ir_jan, vl_rend_fev, vl_deducoes_fev, vl_ir_fev, vl_rend_mar, vl_deducoes_mar, vl_ir_mar, vl_rend_abr, vl_deducoes_abr, vl_ir_abr, vl_rend_mai, vl_deducoes_mai, vl_ir_mai, vl_rend_jun, vl_deducoes_jun, vl_ir_jun, vl_rend_jul, vl_deducoes_jul, vl_ir_jul, vl_rend_ago, vl_deducoes_ago, vl_ir_ago, vl_rend_set, vl_deducoes_set, vl_ir_set, vl_rend_out, vl_deducoes_out, vl_ir_out, vl_rend_nov, vl_deducoes_nov, vl_ir_nov, vl_rend_dez, vl_deducoes_dez, vl_ir_dez, vl_rend_13_salario, vl_deducoes_13_salario, vl_ir_13_salario, ie_situacao, vl_total_registros, vl_tot_rend_jan, vl_tot_deducoes_jan, vl_tot_ir_jan, vl_tot_rend_fev, vl_tot_deducoes_fev, vl_tot_ir_fev, vl_tot_rend_mar, vl_tot_deducoes_mar, vl_tot_ir_mar, vl_tot_rend_abr, vl_tot_deducoes_abr, vl_tot_ir_abr, vl_tot_rend_mai, vl_tot_deducoes_mai, vl_tot_ir_mai, vl_tot_rend_jun, vl_tot_deducoes_jun, vl_tot_ir_jun, vl_tot_rend_jul, vl_tot_deducoes_jul, vl_tot_ir_jul, vl_tot_rend_ago, vl_tot_deducoes_ago, vl_tot_ir_ago, vl_tot_rend_set, vl_tot_deducoes_set, vl_tot_ir_set, vl_tot_rend_out, vl_tot_deducoes_out, vl_tot_ir_out, vl_tot_rend_nov, vl_tot_deducoes_nov, vl_tot_ir_nov, vl_tot_rend_dez, vl_tot_deducoes_dez, vl_tot_ir_dez, vl_tot_rend_13_salario, vl_tot_deducoes_13_salario, vl_tot_ir_13_salario) AS SELECT	a.nr_sequencia nr_seq_lote,
	'00000001'						nr_seq_registro, 
	1							ie_tipo_registro, 
	b.cd_cgc					 	nr_cpf_cnpj, 
	'DIRF'							nm_arquivo, 
	to_char(a.dt_lote,'yyyy')				dt_ano, 
	a.ie_retificadora					ie_tipo_declaracao, 
	a.ie_situacao_declaracao				ie_situacao_declaracao, 
	'2'							ie_tipo_declarante, 
	a.ie_natureza_declarante				ie_natureza_declarante, 
	a.ie_tipo_rendimento					ie_tipo_rendimento, 
	a.ie_declarante_depositario				ie_indicador_depositario, 
	substr(obter_nome_empresa(b.cd_empresa),1,255) 	nm_declarante, 
	substr(obter_dados_pf(c.cd_contabilista,'CPF'),1,11)	cd_cpf, 
	CASE WHEN a.ie_situacao_declaracao=2 THEN LOCALTIMESTAMP  ELSE to_date(null) END  dt_evento, 
	a.nr_recibo_retificada					nr_recibo, 
	substr(obter_dados_pf(c.cd_contabilista,'CPF'),1,11)	cd_cpf_responsavel, 
	substr(obter_nome_pf_pj(c.cd_contabilista,null),1,60)	nm_responsavel, 
	lpad(obter_compl_pf(c.cd_contabilista,1,'FAX'),2,0)	nr_ddd_resp,		 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'T'),(LENGTH(obter_dados_pf_pj(c.cd_contabilista,null,'T'))-7), (LENGTH(obter_dados_pf_pj(c.cd_contabilista,null,'T'))))	nr_telefone_resp, 
	substr(obter_compl_pf(c.cd_contabilista,1,'RAM'),1,5)	nr_ramal_resp, 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'FAX'), (LENGTH(obter_dados_pf_pj(c.cd_contabilista,null,'FAX'))-7), (LENGTH(obter_dados_pf_pj(c.cd_contabilista,null,'FAX'))))	nr_fax_resp, 
	substr(obter_dados_pf_pj(c.cd_contabilista,null,'M'),1,40)	ds_email_resp, 
	9							ie_uso_declarante, 
	'0000'	cd_retencao, 
	''	ie_tipo_beneficiario, 
	''	nr_beneficiario, 
	''	nm_beneficiario, 
	0	vl_rend_jan, 
	0	vl_deducoes_jan, 
	0	vl_ir_jan, 
	0	Vl_rend_fev, 
	0	vl_deducoes_fev, 
	0	vl_ir_fev, 
	0	vl_rend_mar, 
	0	vl_deducoes_mar, 
	0	vl_ir_mar, 
	0	vl_rend_abr, 
	0	vl_deducoes_abr, 
	0	vl_ir_abr, 
	0	vl_rend_mai, 
	0	vl_deducoes_mai, 
	0	vl_ir_mai, 
	0	vl_rend_jun, 
	0	vl_deducoes_jun, 
	0	vl_ir_jun, 
	0	vl_rend_jul, 
	0	vl_deducoes_jul, 
	0	vl_ir_jul, 
	0	vl_rend_ago, 
	0	vl_deducoes_ago, 
	0	vl_ir_ago, 
	0	vl_rend_set, 
	0	vl_deducoes_set, 
	0	vl_ir_set, 
	0	vl_rend_out, 
	0	vl_deducoes_out, 
	0	vl_ir_out, 
	0	vl_rend_nov, 
	0	vl_deducoes_nov, 
	0	vl_ir_nov, 
	0	vl_rend_dez, 
	0	vl_deducoes_dez, 
	0	vl_ir_dez, 
	0	vl_rend_13_salario, 
	0	vl_deducoes_13_salario, 
	0	vl_ir_13_salario, 
	0	ie_situacao, 
	0	vl_total_registros, 
	0	vl_tot_rend_jan, 
	0	vl_tot_deducoes_jan, 
	0	vl_tot_ir_jan, 
	0	vl_tot_rend_fev,	 
	0	vl_tot_deducoes_fev, 
	0	vl_tot_ir_fev, 
	0	vl_tot_rend_mar, 
	0	vl_tot_deducoes_mar, 
	0	vl_tot_ir_mar, 
	0	vl_tot_rend_abr, 
	0	vl_tot_deducoes_abr, 
	0	vl_tot_ir_abr, 
	0	vl_tot_rend_mai, 
	0	vl_tot_deducoes_mai, 
	0	vl_tot_ir_mai, 
	0	vl_tot_rend_jun, 
	0	vl_tot_deducoes_jun, 
	0	vl_tot_ir_jun, 
	0	vl_tot_rend_jul, 
	0	vl_tot_deducoes_jul, 
	0	vl_tot_ir_jul, 
	0	vl_tot_rend_ago, 
	0	vl_tot_deducoes_ago, 
	0	vl_tot_ir_ago, 
	0	vl_tot_rend_set, 
	0	vl_tot_deducoes_set, 
	0	vl_tot_ir_set, 
	0	vl_tot_rend_out, 
	0	vl_tot_deducoes_out, 
	0	vl_tot_ir_out, 
	0	vl_tot_rend_nov, 
	0	vl_tot_deducoes_nov, 
	0	vl_tot_ir_nov, 
	0	vl_tot_rend_dez, 
	0	vl_tot_deducoes_dez, 
	0	vl_tot_ir_dez, 
	0	vl_tot_rend_13_salario, 
	0	vl_tot_deducoes_13_salario, 
	0	vl_tot_ir_13_salario 
FROM	dirf_lote a, 
	estabelecimento b, 
	empresa c 
WHERE	a.cd_estabelecimento	= b.cd_estabelecimento 
and	b.cd_empresa		= c.cd_empresa 

UNION ALL
 
/* Registro Tipo 2 */
 
select	nr_seq_lote, 
	'00000002' nr_seq_registro, 
	2							ie_tipo_registro, 
								nr_cpf_cnpj, 
	''	nm_arquivo, 
	''	dt_ano, 
	''	ie_tipo_declaracao, 
	''	ie_situacao_declaracao, 
	''	ie_tipo_declarante, 
	''	ie_natureza_declarante, 
	''	ie_tipo_rendimento, 
	''	ie_indicador_depositario, 
	''	nm_declarante, 
	''	cd_cpf, 
	LOCALTIMESTAMP	dt_evento, 
	''	nr_recibo, 
	''	cd_cpf_responsavel, 
	''	nm_responsavel, 
	''	nr_ddd_resp, 
	''	nr_telefone_resp, 
	''	nr_ramal_resp, 
	''	nr_fax_resp, 
	''	ds_email_resp, 
	9							ie_uso_declarante, 
								cd_retencao, 
								ie_tipo_beneficiario, 
								nr_beneficiario, 
								nm_beneficiario, 
	sum(vl_rend_jan)		 			vl_rend_jan, 
	sum(vl_deducoes_jan) 					vl_deducoes_jan, 
	sum(vl_ir_jan) 						vl_ir_jan, 
	sum(vl_rend_fev) 					vl_rend_fev, 
	sum(vl_deducoes_fev) 					vl_deducoes_fev, 
	sum(vl_ir_fev) 						vl_ir_fev, 
	sum(vl_rend_mar) 					vl_rend_mar, 
	sum(vl_deducoes_mar)					vl_deducoes_mar, 
	sum(vl_ir_mar) 						vl_ir_mar, 
	sum(vl_rend_abr) 					vl_rend_abr, 
	sum(vl_deducoes_abr) 					vl_deducoes_abr, 
	sum(vl_ir_abr) 						vl_ir_abr, 
	sum(vl_rend_mai) 					vl_rend_mai, 
	sum(vl_deducoes_mai) 					vl_deducoes_mai, 
	sum(vl_ir_mai) 						vl_ir_mai, 
	sum(vl_rend_jun) 					vl_rend_jun, 
	sum(vl_deducoes_jun) 					vl_deducoes_jun, 
	sum(vl_ir_jun) 						vl_ir_jun, 
	sum(vl_rend_jul) 					vl_rend_jul, 
	sum(vl_deducoes_jul) 					vl_deducoes_jul, 
	sum(vl_ir_jul) 						vl_ir_jul, 
	sum(vl_rend_ago) 					vl_rend_ago, 
	sum(vl_deducoes_ago) 					vl_deducoes_ago, 
	sum(vl_ir_ago) 						vl_ir_ago, 
	sum(vl_rend_set) 					vl_rend_set, 
	sum(vl_deducoes_set) 					vl_deducoes_set, 
	sum(vl_ir_set) 						vl_ir_set, 
	sum(vl_rend_out) 					vl_rend_out, 
	sum(vl_deducoes_out) 					vl_deducoes_out, 
	sum(vl_ir_out) 						vl_ir_out, 
	sum(vl_rend_nov) 					vl_rend_nov, 
	sum(vl_deducoes_nov) 					vl_deducoes_nov, 
	sum(vl_ir_nov) 						vl_ir_nov, 
	sum(vl_rend_dez) 					vl_rend_dez, 
	sum(vl_deducoes_dez) 					vl_deducoes_dez, 
	sum(vl_ir_dez)						vl_ir_dez, 
	sum(vl_rend_13_salario)					vl_rend_13_salario, 
	sum(vl_deducoes_13_salario)				vl_deducoes_13_salario, 
	sum(vl_ir_13_salario)					vl_ir_13_salario, 
	0							ie_situacao, 
	0	vl_total_registros, 
	0	vl_tot_rend_jan, 
	0	vl_tot_deducoes_jan, 
	0	vl_tot_ir_jan, 
	0	vl_tot_rend_fev,	 
	0	vl_tot_deducoes_fev, 
	0	vl_tot_ir_fev, 
	0	vl_tot_rend_mar, 
	0	vl_tot_deducoes_mar, 
	0	vl_tot_ir_mar, 
	0	vl_tot_rend_abr, 
	0	vl_tot_deducoes_abr, 
	0	vl_tot_ir_abr, 
	0	vl_tot_rend_mai, 
	0	vl_tot_deducoes_mai, 
	0	vl_tot_ir_mai, 
	0	vl_tot_rend_jun, 
	0	vl_tot_deducoes_jun, 
	0	vl_tot_ir_jun, 
	0	vl_tot_rend_jul, 
	0	vl_tot_deducoes_jul, 
	0	vl_tot_ir_jul, 
	0	vl_tot_rend_ago, 
	0	vl_tot_deducoes_ago, 
	0	vl_tot_ir_ago, 
	0	vl_tot_rend_set, 
	0	vl_tot_deducoes_set, 
	0	vl_tot_ir_set, 
	0	vl_tot_rend_out, 
	0	vl_tot_deducoes_out, 
	0	vl_tot_ir_out, 
	0	vl_tot_rend_nov, 
	0	vl_tot_deducoes_nov, 
	0	vl_tot_ir_nov, 
	0	vl_tot_rend_dez, 
	0	vl_tot_deducoes_dez, 
	0	vl_tot_ir_dez, 
	0	vl_tot_rend_13_salario, 
	0	vl_tot_deducoes_13_salario, 
	0	vl_tot_ir_13_salario 
from (	SELECT	distinct e.nr_titulo, 
	a.nr_sequencia nr_seq_lote, 
	h.cd_cgc						nr_cpf_cnpj, 
	d.cd_darf						cd_retencao, 
	CASE WHEN i.cd_pessoa_fisica IS NULL THEN '2'  ELSE '1' END 			ie_tipo_beneficiario, 
	coalesce(i.cd_cgc,substr(obter_dados_pf(i.cd_pessoa_fisica,'CPF'),1,11)) nr_beneficiario, 
	substr(obter_nome_pf_pj(i.cd_pessoa_fisica,i.cd_cgc),1,255) nm_beneficiario, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN g.vl_imposto  ELSE 0 END  vl_ir_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN g.vl_base_calculo  ELSE 0 END 	vl_rend_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN g.vl_imposto  ELSE 0 END  vl_ir_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN g.vl_base_calculo  ELSE 0 END 	vl_rend_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN g.vl_imposto  ELSE 0 END  vl_ir_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN g.vl_imposto  ELSE 0 END  vl_ir_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN g.vl_imposto  ELSE 0 END  vl_ir_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN g.vl_imposto  ELSE 0 END  vl_ir_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN g.vl_imposto  ELSE 0 END  vl_ir_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN g.vl_imposto  ELSE 0 END  vl_ir_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN g.vl_imposto  ELSE 0 END  vl_ir_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN g.vl_imposto  ELSE 0 END  vl_ir_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN g.vl_imposto  ELSE 0 END  vl_ir_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN g.vl_imposto  ELSE 0 END  vl_ir_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN g.vl_base_calculo  ELSE 0 END  vl_rend_13_salario, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_deducoes_13_salario, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN g.vl_imposto  ELSE 0 END vl_ir_13_salario 
FROM titulo_pagar i, estabelecimento h, darf_titulo_pagar e, darf d, dctf_lote_darf c, dctf_lote b, dirf_lote a, titulo_pagar f
LEFT OUTER JOIN titulo_pagar_imposto g ON (f.nr_seq_tributo = g.nr_sequencia)
WHERE a.nr_sequencia		= b.nr_seq_dirf and b.nr_sequencia		= c.nr_seq_lote and c.nr_seq_darf		= d.nr_sequencia and d.nr_sequencia		= e.nr_seq_darf and e.nr_titulo		= f.nr_titulo  and a.cd_estabelecimento	= h.cd_estabelecimento and f.nr_titulo_original	= i.nr_titulo ) alias167 
group by nr_seq_lote, 
	cd_retencao, 
	nr_cpf_cnpj, 
	ie_tipo_beneficiario, 
	nr_beneficiario, 
	nm_beneficiario 

UNION ALL
 
/* Registro Tipo 3 */
 
SELECT	nr_seq_lote, 
	'00000003' nr_seq_registro, 
	3							ie_tipo_registro, 
								nr_cpf_cnpj, 
	''	nm_arquivo, 
	''	dt_ano, 
	''	ie_tipo_declaracao, 
	''	ie_situacao_declaracao, 
	''	ie_tipo_declarante, 
	''	ie_natureza_declarante, 
	''	ie_tipo_rendimento, 
	''	ie_indicador_depositario, 
	''	nm_declarante, 
	''	cd_cpf, 
	LOCALTIMESTAMP	dt_evento, 
	''	nr_recibo, 
	''	cd_cpf_responsavel, 
	''	nm_responsavel, 
	''	nr_ddd_resp, 
	''	nr_telefone_resp, 
	''	nr_ramal_resp, 
	''	nr_fax_resp, 
	''	ds_email_resp, 
	9							ie_uso_declarante, 
								cd_retencao, 
	''	ie_tipo_beneficiario, 
	''	nr_beneficiario, 
	''	nm_beneficiario, 
	0	vl_rend_jan, 
	0	vl_deducoes_jan, 
	0	vl_ir_jan, 
	0	Vl_rend_fev, 
	0	vl_deducoes_fev, 
	0	vl_ir_fev, 
	0	vl_rend_mar, 
	0	vl_deducoes_mar, 
	0	vl_ir_mar, 
	0	vl_rend_abr, 
	0	vl_deducoes_abr, 
	0	vl_ir_abr, 
	0	vl_rend_mai, 
	0	vl_deducoes_mai, 
	0	vl_ir_mai, 
	0	vl_rend_jun, 
	0	vl_deducoes_jun, 
	0	vl_ir_jun, 
	0	vl_rend_jul, 
	0	vl_deducoes_jul, 
	0	vl_ir_jul, 
	0	vl_rend_ago, 
	0	vl_deducoes_ago, 
	0	vl_ir_ago, 
	0	vl_rend_set, 
	0	vl_deducoes_set, 
	0	vl_ir_set, 
	0	vl_rend_out, 
	0	vl_deducoes_out, 
	0	vl_ir_out, 
	0	vl_rend_nov, 
	0	vl_deducoes_nov, 
	0	vl_ir_nov, 
	0	vl_rend_dez, 
	0	vl_deducoes_dez, 
	0	vl_ir_dez, 
	0	vl_rend_13_salario, 
	0	vl_deducoes_13_salario, 
	0	vl_ir_13_salario, 
	0	ie_situacao, 
	1							vl_total_registros, 
	sum(vl_tot_rend_jan) 					vl_tot_rend_jan, 
	sum(vl_tot_deducoes_jan) 				vl_tot_deducoes_jan, 
	sum(vl_tot_ir_jan) 					vl_tot_ir_jan, 
	sum(vl_tot_rend_fev) 					vl_tot_rend_fev,	 
	sum(vl_tot_deducoes_fev) 				vl_tot_deducoes_fev, 
	sum(vl_tot_ir_fev) 					vl_tot_ir_fev, 
	sum(vl_tot_rend_mar) 					vl_tot_rend_mar, 
	sum(vl_tot_deducoes_mar) 				vl_tot_deducoes_mar, 
	sum(vl_tot_ir_mar) 					vl_tot_ir_mar, 
	sum(vl_tot_rend_abr) 					vl_tot_rend_abr, 
	sum(vl_tot_deducoes_abr) 				vl_tot_deducoes_abr, 
	sum(vl_tot_ir_abr) 					vl_tot_ir_abr, 
	sum(vl_tot_rend_mai) 					vl_tot_rend_mai, 
	sum(vl_tot_deducoes_mai) 				vl_tot_deducoes_mai, 
	sum(vl_tot_ir_mai) 					vl_tot_ir_mai, 
	sum(vl_tot_rend_jun) 					vl_tot_rend_jun, 
	sum(vl_tot_deducoes_jun) 				vl_tot_deducoes_jun, 
	sum(vl_tot_ir_jun) 					vl_tot_ir_jun, 
	sum(vl_tot_rend_jul) 					vl_tot_rend_jul, 
	sum(vl_tot_deducoes_jul) 				vl_tot_deducoes_jul, 
	sum(vl_tot_ir_jul) 					vl_tot_ir_jul, 
	sum(vl_tot_rend_ago) 					vl_tot_rend_ago, 
	sum(vl_tot_deducoes_ago) 				vl_tot_deducoes_ago, 
	sum(vl_tot_ir_ago) 					vl_tot_ir_ago, 
	sum(vl_tot_rend_set) 					vl_tot_rend_set, 
	sum(vl_tot_deducoes_set) 				vl_tot_deducoes_set, 
	sum(vl_tot_ir_set) 					vl_tot_ir_set, 
	sum(vl_tot_rend_out) 					vl_tot_rend_out, 
	sum(vl_tot_deducoes_out) 				vl_tot_deducoes_out, 
	sum(vl_tot_ir_out) 					vl_tot_ir_out, 
	sum(vl_tot_rend_nov) 					vl_tot_rend_nov, 
	sum(vl_tot_deducoes_nov) 				vl_tot_deducoes_nov, 
	sum(vl_tot_ir_nov) 					vl_tot_ir_nov, 
	sum(vl_tot_rend_dez) 					vl_tot_rend_dez, 
	sum(vl_tot_deducoes_dez) 				vl_tot_deducoes_dez, 
	sum(vl_tot_ir_dez) 					vl_tot_ir_dez, 
	sum(vl_tot_rend_13_salario) 				vl_tot_rend_13_salario, 
	sum(vl_tot_deducoes_13_salario) 			vl_tot_deducoes_13_salario, 
	sum(vl_tot_ir_13_salario) 				vl_tot_ir_13_salario 
from (select distinct a.nr_sequencia 			nr_seq_lote, 
	g.nr_titulo, 
	h.cd_cgc						nr_cpf_cnpj, 
	d.cd_darf						cd_retencao, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='01' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_jan, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN g.vl_base_calculo  ELSE 0 END 	vl_tot_rend_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='02' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_fev, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN g.vl_base_calculo  ELSE 0 END 	vl_tot_rend_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='03' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_mar, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='04' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_abr, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='05' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_mai, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='06' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_jun, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='07' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_jul, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='08' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_ago, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='09' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_set, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='10' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_out, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='11' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_nov, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='12' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_dez, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN g.vl_base_calculo  ELSE 0 END  vl_tot_rend_13_salario, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN coalesce(g.vl_reducao,0)  ELSE 0 END  vl_tot_deducoes_13_salario, 
	CASE WHEN substr(to_char(d.dt_apuracao,'dd/mm/yyyy'),4,2)='13' THEN g.vl_imposto  ELSE 0 END  vl_tot_ir_13_salario 
FROM titulo_pagar i, estabelecimento h, darf_titulo_pagar e, darf d, dctf_lote_darf c, dctf_lote b, dirf_lote a, titulo_pagar f
LEFT OUTER JOIN titulo_pagar_imposto g ON (f.nr_seq_tributo = g.nr_sequencia)
WHERE a.nr_sequencia		= b.nr_seq_dirf and b.nr_sequencia		= c.nr_seq_lote and c.nr_seq_darf		= d.nr_sequencia and d.nr_sequencia		= e.nr_seq_darf and e.nr_titulo		= f.nr_titulo  and a.cd_estabelecimento	= h.cd_estabelecimento and f.nr_titulo_original	= i.nr_titulo ) alias298 
group by cd_retencao, 
	nr_seq_lote, 
	nr_cpf_cnpj;

