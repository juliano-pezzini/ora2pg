-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sus_ciha_2011_rel_v (nr_atendimento, cd_estabelecimento, cd_pessoa_fisica, dt_entrada, ie_tipo_atendimento, dt_alta, cd_motivo_alta, ie_tipo_convenio, nm_paciente, nr_prontuario, dt_nascimento, ie_sexo, nm_logradouro, nr_endereco, ds_complemento, sg_estado_paciente, cd_cep, cd_municipio, cd_cgc, sg_estado_cgc, cd_cep_cgc, ds_bairro_cgc, cd_procedimento, ie_origem_proced, cd_cid_primario, cd_cid_secundario, cd_municipio_ibge, cd_cns, cd_ans, ie_fonte_remuneracao, ie_fonte_remuner2, dt_competencia, cd_cnes, ds_procedimento, cd_cnpj, cd_usuario_convenio, nr_declaracao_obito, qt_dias_uti, cd_convenio, dt_inicio_vigencia, cd_categoria, qt_filhos_vivos, doc_nasc1, doc_nasc2, doc_nasc3, doc_nasc4, doc_nasc5, ie_tipo_reg_interface, ds_versao_interface, ie_alta_uti, ie_sexo_sus, cd_internacional, nm_usuario_atend, ie_tipo_atend, qtd_atendimento, cd_modalidade, ie_motivo) AS SELECT	0 NR_ATENDIMENTO, /* Utilizado no relatorio WCIH - 7241*/

	(D.cd_estabelecimento) CD_ESTABELECIMENTO,
	null CD_PESSOA_FISICA,
	LOCALTIMESTAMP DT_ENTRADA,
	0 ie_tipo_atendimento,
	LOCALTIMESTAMP DT_ALTA,
	0 cd_motivo_alta,
	0 IE_TIPO_CONVENIO,
	null NM_PACIENTE,
	0 NR_PRONTUARIO,
	LOCALTIMESTAMP DT_NASCIMENTO,
	null IE_SEXO,
	null NM_LOGRADOURO,
	0 NR_ENDERECO,
	null DS_COMPLEMENTO,
	null SG_ESTADO_PACIENTE,
	null CD_CEP,
	null CD_MUNICIPIO,
	null CD_CGC,
	null SG_ESTADO_CGC,
	null CD_CEP_CGC,
	null DS_BAIRRO_CGC,
	0 CD_PROCEDIMENTO,
	0 IE_ORIGEM_PROCED,
	null CD_CID_PRIMARIO,
	null CD_CID_SECUNDARIO,
	null cd_municipio_ibge,
	null CD_CNS,
	null CD_ANS,
	null IE_FONTE_REMUNERACAO,
	null IE_FONTE_REMUNER2,
	LOCALTIMESTAMP DT_COMPETENCIA,
	(substr(D.cd_cns, 1,8)) CD_CNES,
	null ds_procedimento,
	null cd_cnpj,
	null CD_USUARIO_CONVENIO,
	null nr_declaracao_obito,
	0 QT_DIAS_UTI,
	0 cd_convenio,
	LOCALTIMESTAMP dt_inicio_vigencia,
	null cd_categoria,
	0 qt_filhos_vivos,
	null doc_nasc1,
	null doc_nasc2,
	null doc_nasc3,
	null doc_nasc4,
	null doc_nasc5,
	1 IE_TIPO_REG_INTERFACE,
	'1.0.0.0' DS_VERSAO_INTERFACE,
	null ie_alta_uti,
	null ie_sexo_sus,
	null cd_internacional,
	null nm_usuario_atend,
	null ie_tipo_atend,
	0 qtd_atendimento,
	0 cd_modalidade,
	'' ie_motivo
FROM	ESTABELECIMENTO D
WHERE	D.cd_cns is not null

union all

SELECT	A.NR_ATENDIMENTO,
	A.CD_ESTABELECIMENTO,
	A.CD_PESSOA_FISICA,
       A.DT_ENTRADA,
       A.IE_TIPO_ATENDIMENTO,
       A.DT_ALTA,
	A.CD_MOTIVO_ALTA,
	A.IE_TIPO_CONVENIO,
       B.NM_PESSOA_FISICA NM_PACIENTE,
       coalesce(B.NR_PRONTUARIO,(obter_prontuario_pf(a.cd_estabelecimento,a.cd_pessoa_fisica))::numeric ),
       B.DT_NASCIMENTO,
       B.IE_SEXO,
	C.DS_ENDERECO NM_LOGRADOURO,
	C.NR_ENDERECO,
	C.DS_COMPLEMENTO,
	C.SG_ESTADO SG_ESTADO_PACIENTE,
	REPLACE(C.CD_CEP,'-','') CD_CEP,
	F.CD_MUNICIPIO_SINPAS CD_MUNICIPIO,
	E.CD_CGC,
	E.SG_ESTADO SG_ESTADO_CGC,
	E.CD_CEP CD_CEP_CGC,
	E.DS_BAIRRO DS_BAIRRO_CGC,
	G.CD_PROCEDIMENTO,
	G.IE_ORIGEM_PROCED,
	G.CD_CID_PRIMARIO,
	G.CD_CID_SECUNDARIO,
	C.CD_MUNICIPIO_IBGE,
	' ' CD_CNS,
	lpad(p.CD_ANS ,6,'0') CD_ANS,
	CASE WHEN V.IE_TIPO_CONVENIO=1 THEN 'P'  ELSE 'C' END  IE_FONTE_REMUNERACAO,
	coalesce(v.cd_fonte_remuner_cih, CASE WHEN V.IE_TIPO_CONVENIO=1 THEN '2'  ELSE CASE WHEN V.IE_TIPO_CONVENIO=4 THEN '3' WHEN V.IE_TIPO_CONVENIO=6 THEN '6' WHEN V.IE_TIPO_CONVENIO=9 THEN '9'  ELSE '1' END  END ) IE_FONTE_REMUNER2,
	A.DT_ALTA_INTERNO DT_COMPETENCIA,
	(substr(D.cd_cns,1,8)) CD_CNES,
	substr(Obter_Desc_Proc_CIH(G.CD_PROCEDIMENTO, g.nr_atendimento),1,188) ds_procedimento,
	CASE WHEN V.IE_TIPO_CONVENIO=1 THEN  CASE WHEN coalesce(v.cd_fonte_remuner_cih, 0)=6 THEN  v.cd_cgc WHEN coalesce(v.cd_fonte_remuner_cih, 0)=9 THEN  v.cd_cgc  ELSE '' END   ELSE v.cd_cgc END  cd_cnpj,
	t.CD_USUARIO_CONVENIO CD_USUARIO_CONVENIO,
	lpad(SUBSTR(Obter_Declaracao_Obito(a.nr_atendimento),1,8),8,'0') nr_declaracao_obito,
--	substr(to_char(Obter_Declaracao_Obito(a.nr_atendimento), '00000000'),2,9) nr_declaracao_obito,

	CASE WHEN SUS_Obter_Dias_UTI(a.nr_atendimento)=0 THEN  OBTER_DIAS_INTERNACAO_UTI(a.nr_atendimento)  ELSE SUS_Obter_Dias_UTI(a.nr_atendimento) END  QT_DIAS_UTI,
	t.cd_convenio,
	t.dt_inicio_vigencia,
	t.cd_categoria,
	OBTER_QT_NASCIDOS_CIH(G.CD_PROCEDIMENTO,a.nr_atendimento) qt_filhos_vivos,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,1,a.nr_atendimento),1,11) doc_nasc1,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,2,a.nr_atendimento),1,11) doc_nasc2,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,3,a.nr_atendimento),1,11) doc_nasc3,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,4,a.nr_atendimento),1,11) doc_nasc4,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,5,a.nr_atendimento),1,11) doc_nasc5,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  2  ELSE 4 END  IE_TIPO_REG_INTERFACE,
	'1.0.0.0' DS_VERSAO_INTERFACE,
	substr(OBTER_SE_ALTA_UTI(a.nr_atendimento), 1,1) ie_alta_uti,
	h.ie_sexo_sus ie_sexo_sus,
	p.cd_internacional,
	a.nm_usuario_atend,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  1  ELSE 2 END  ie_tipo_atend,
	1 qtd_atendimento,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  02  ELSE 01 END  cd_modalidade,
CASE WHEN b.dt_nascimento IS NULL THEN  'Dt nasc'  ELSE CASE WHEN g.cd_procedimento IS NULL THEN  'Proc'  ELSE CASE WHEN g.ie_origem_proced=1 THEN  'Proc' WHEN g.ie_origem_proced=2 THEN  'Proc' WHEN g.ie_origem_proced=3 THEN  'Proc' WHEN g.ie_origem_proced=4 THEN  'Proc' WHEN g.ie_origem_proced=5 THEN  'Proc' WHEN g.ie_origem_proced=6 THEN  'Proc'  ELSE CASE WHEN c.cd_municipio_ibge IS NULL THEN  'Mun IBGE'  ELSE CASE WHEN c.ds_endereco IS NULL THEN  'Lograd'  ELSE CASE WHEN substr(b.nm_pessoa_fisica,1,20) IS NULL THEN  'Paciente'  ELSE CASE WHEN c.sg_estado IS NULL THEN  'Sg Est'  ELSE CASE WHEN f.cd_municipio_sinpas IS NULL THEN  'Cod mun'  ELSE CASE WHEN a.nr_atendimento IS NULL THEN  'Nr atend'  ELSE CASE WHEN b.ie_sexo IS NULL THEN  'Sexo'  ELSE CASE WHEN replace(c.cd_cep,'-','')='0' THEN  'Cep'  ELSE CASE WHEN coalesce(B.NR_PRONTUARIO,(obter_prontuario_pf(a.cd_estabelecimento,a.cd_pessoa_fisica))::numeric ) IS NULL THEN  'Nr pront'  ELSE CASE WHEN a.cd_motivo_alta IS NULL THEN  'Motivo'  ELSE CASE WHEN a.dt_entrada IS NULL THEN  'Dt entrada'  ELSE CASE WHEN cih_obter_se_alta_uti(a.dt_entrada,a.dt_alta, cih_obter_dias_internacao_uti(dt_entrada, dt_alta, SUS_Obter_Dias_UTI(a.nr_atendimento)))='S' THEN 'Alta Direto Uti'  ELSE CASE WHEN a.dt_alta IS NULL THEN  'Dt alta'  ELSE CASE WHEN CASE WHEN coalesce(v.cd_fonte_remuner_cih, CASE WHEN V.IE_TIPO_CONVENIO=1 THEN '2'  ELSE CASE WHEN V.IE_TIPO_CONVENIO=4 THEN '3' WHEN V.IE_TIPO_CONVENIO=6 THEN '6' WHEN V.IE_TIPO_CONVENIO=9 THEN '9'  ELSE '1' END  END )=3 THEN 'X'  ELSE t.CD_USUARIO_CONVENIO END  IS NULL THEN  'Usuario'  ELSE CASE WHEN length(REPLACE(C.CD_CEP,'-',''))='1' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='2' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='3' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='4' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='5' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='6' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='Nulo' THENCASE WHEN obter_se_doc_nasc_obrig_ok(a.nr_atendimento)='N' THEN 'Doc. Nasc.' END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  ie_motivo
FROM convenio v, atend_categoria_convenio t, pessoa_juridica p, pessoa_juridica e, estabelecimento d, pessoa_fisica b
LEFT OUTER JOIN compl_pessoa_fisica c ON (B.CD_PESSOA_FISICA = C.CD_PESSOA_FISICA AND 1 = C.IE_TIPO_COMPLEMENTO)
LEFT OUTER JOIN sus_municipio f ON (C.CD_MUNICIPIO_IBGE = F.CD_MUNICIPIO_IBGE)
, procedimento_paciente_cih g
LEFT OUTER JOIN procedimento h ON (g.cd_procedimento = h.cd_procedimento AND g.ie_origem_proced = h.ie_origem_proced)
, atendimento_paciente a
LEFT OUTER JOIN procedimento_paciente_cih g ON (A.NR_ATENDIMENTO = G.NR_ATENDIMENTO)
WHERE A.CD_PESSOA_FISICA 		= B.CD_PESSOA_FISICA      AND coalesce(A.IE_TIPO_CONVENIO,1)	<> 3 AND A.CD_ESTABELECIMENTO		= D.CD_ESTABELECIMENTO AND D.CD_CGC			= E.CD_CGC  and a.nr_atendimento		= t.nr_atendimento and t.cd_convenio			= v.cd_convenio and v.cd_cgc			= p.cd_cgc and a.ie_tipo_atendimento = 1  --Internado
  and obter_atecaco_atendimento(t.nr_atendimento) 	= t.nr_seq_interno and coalesce(C.CD_MUNICIPIO_IBGE,1)		<>  '999999' -- Bruna, OS61446
  and t.dt_inicio_vigencia=
	(select max(dt_inicio_vigencia)
	from atend_categoria_convenio b
	where nr_atendimento 		= a.nr_atendimento)
 
union all

SELECT	A.NR_ATENDIMENTO,
	A.CD_ESTABELECIMENTO,
	A.CD_PESSOA_FISICA,
       A.DT_ENTRADA,
       A.IE_TIPO_ATENDIMENTO,
       A.DT_ALTA,
	A.CD_MOTIVO_ALTA,
	A.IE_TIPO_CONVENIO,
       B.NM_PESSOA_FISICA NM_PACIENTE,
       coalesce(B.NR_PRONTUARIO,(obter_prontuario_pf(a.cd_estabelecimento,a.cd_pessoa_fisica))::numeric ),
       B.DT_NASCIMENTO,
       B.IE_SEXO,
	C.DS_ENDERECO NM_LOGRADOURO,
	C.NR_ENDERECO,
	C.DS_COMPLEMENTO,
	C.SG_ESTADO SG_ESTADO_PACIENTE,
	REPLACE(C.CD_CEP,'-','') CD_CEP,
	F.CD_MUNICIPIO_SINPAS CD_MUNICIPIO,
	E.CD_CGC,
	E.SG_ESTADO SG_ESTADO_CGC,
	E.CD_CEP CD_CEP_CGC,
	E.DS_BAIRRO DS_BAIRRO_CGC,
	G.CD_PROCEDIMENTO,
	G.IE_ORIGEM_PROCED,
	substr(Obter_Cid_Atendimento(a.nr_atendimento,'P'),1,10) CD_CID_PRIMARIO,
	substr(Obter_Cid_Atendimento(a.nr_atendimento,'S'),1,10) CD_CID_SECUNDARIO,
	C.CD_MUNICIPIO_IBGE,
	' ' CD_CNS,
	lpad(p.CD_ANS ,6,'0') CD_ANS,
	CASE WHEN V.IE_TIPO_CONVENIO=1 THEN 'P'  ELSE 'C' END  IE_FONTE_REMUNERACAO,
	coalesce(v.cd_fonte_remuner_cih, CASE WHEN V.IE_TIPO_CONVENIO=1 THEN '2'  ELSE CASE WHEN V.IE_TIPO_CONVENIO=4 THEN '3' WHEN V.IE_TIPO_CONVENIO=6 THEN '6' WHEN V.IE_TIPO_CONVENIO=9 THEN '9'  ELSE '1' END  END ) IE_FONTE_REMUNER2,
	A.DT_ALTA_INTERNO DT_COMPETENCIA,
	(substr(D.cd_cns,1,8)) CD_CNES,
	substr(Obter_Desc_Proc_CIH(G.CD_PROCEDIMENTO, g.nr_atendimento),1,188) ds_procedimento,
	CASE WHEN V.IE_TIPO_CONVENIO=1 THEN  CASE WHEN coalesce(v.cd_fonte_remuner_cih, 0)=6 THEN  v.cd_cgc WHEN coalesce(v.cd_fonte_remuner_cih, 0)=9 THEN  v.cd_cgc  ELSE '' END   ELSE v.cd_cgc END  cd_cnpj,
	t.CD_USUARIO_CONVENIO CD_USUARIO_CONVENIO,
	lpad(SUBSTR(Obter_Declaracao_Obito(a.nr_atendimento),1,8),8,'0') nr_declaracao_obito,
--	substr(to_char(Obter_Declaracao_Obito(a.nr_atendimento), '00000000'),2,9) nr_declaracao_obito,

	CASE WHEN SUS_Obter_Dias_UTI(a.nr_atendimento)=0 THEN  OBTER_DIAS_INTERNACAO_UTI(a.nr_atendimento)  ELSE SUS_Obter_Dias_UTI(a.nr_atendimento) END  QT_DIAS_UTI,
	t.cd_convenio,
	t.dt_inicio_vigencia,
	t.cd_categoria,
	OBTER_QT_NASCIDOS_CIH(G.CD_PROCEDIMENTO,a.nr_atendimento) qt_filhos_vivos,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,1,a.nr_atendimento),1,11) doc_nasc1,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,2,a.nr_atendimento),1,11) doc_nasc2,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,3,a.nr_atendimento),1,11) doc_nasc3,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,4,a.nr_atendimento),1,11) doc_nasc4,
	substr(OBTER_DNV_NASCIDOS_CIH(G.CD_PROCEDIMENTO,5,a.nr_atendimento),1,11) doc_nasc5,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  2  ELSE 4 END  IE_TIPO_REG_INTERFACE,
	'1.0.0.0' DS_VERSAO_INTERFACE,
	substr(OBTER_SE_ALTA_UTI(a.nr_atendimento), 1,1) ie_alta_uti,
	h.ie_sexo_sus ie_sexo_sus,
	p.cd_internacional,
	a.nm_usuario_atend,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  1  ELSE 2 END  ie_tipo_atend,
	1 qtd_atendimento,
	CASE WHEN a.ie_tipo_atendimento=1 THEN  02  ELSE 01 END  cd_modalidade,
CASE WHEN b.dt_nascimento IS NULL THEN  'Dt nasc'  ELSE CASE WHEN g.cd_procedimento IS NULL THEN  'Proc'  ELSE CASE WHEN g.ie_origem_proced=1 THEN  'Proc' WHEN g.ie_origem_proced=2 THEN  'Proc' WHEN g.ie_origem_proced=3 THEN  'Proc' WHEN g.ie_origem_proced=4 THEN  'Proc' WHEN g.ie_origem_proced=5 THEN  'Proc' WHEN g.ie_origem_proced=6 THEN  'Proc'  ELSE CASE WHEN c.cd_municipio_ibge IS NULL THEN  'Mun IBGE'  ELSE CASE WHEN c.ds_endereco IS NULL THEN  'Lograd'  ELSE CASE WHEN substr(b.nm_pessoa_fisica,1,20) IS NULL THEN  'Paciente'  ELSE CASE WHEN c.sg_estado IS NULL THEN  'Sg Est'  ELSE CASE WHEN f.cd_municipio_sinpas IS NULL THEN  'Cod mun'  ELSE CASE WHEN a.nr_atendimento IS NULL THEN  'Nr atend'  ELSE CASE WHEN b.ie_sexo IS NULL THEN  'Sexo'  ELSE CASE WHEN replace(c.cd_cep,'-','')='0' THEN  'Cep'  ELSE CASE WHEN coalesce(B.NR_PRONTUARIO,(obter_prontuario_pf(a.cd_estabelecimento,a.cd_pessoa_fisica))::numeric ) IS NULL THEN  'Nr pront'  ELSE CASE WHEN a.cd_motivo_alta IS NULL THEN  'Motivo'  ELSE CASE WHEN a.dt_entrada IS NULL THEN  'Dt entrada'  ELSE CASE WHEN cih_obter_se_alta_uti(a.dt_entrada,a.dt_alta, cih_obter_dias_internacao_uti(dt_entrada, dt_alta, SUS_Obter_Dias_UTI(a.nr_atendimento)))='S' THEN 'Alta Direto Uti'  ELSE CASE WHEN a.dt_alta IS NULL THEN  'Dt alta'  ELSE CASE WHEN CASE WHEN coalesce(v.cd_fonte_remuner_cih, CASE WHEN V.IE_TIPO_CONVENIO=1 THEN '2'  ELSE CASE WHEN V.IE_TIPO_CONVENIO=4 THEN '3' WHEN V.IE_TIPO_CONVENIO=6 THEN '6' WHEN V.IE_TIPO_CONVENIO=9 THEN '9'  ELSE '1' END  END )=3 THEN 'X'  ELSE t.CD_USUARIO_CONVENIO END  IS NULL THEN  'Usuario'  ELSE CASE WHEN length(REPLACE(C.CD_CEP,'-',''))='1' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='2' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='3' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='4' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='5' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='6' THEN 'Cep' WHEN length(REPLACE(C.CD_CEP,'-',''))='Nulo' THEN CASE WHEN obter_se_doc_nasc_obrig_ok(a.nr_atendimento)='N' THEN 'Doc. Nasc.' END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  END  ie_motivo
FROM convenio v, atend_categoria_convenio t, pessoa_juridica p, pessoa_juridica e, estabelecimento d, pessoa_fisica b
LEFT OUTER JOIN compl_pessoa_fisica c ON (B.CD_PESSOA_FISICA = C.CD_PESSOA_FISICA AND 1 = C.IE_TIPO_COMPLEMENTO)
LEFT OUTER JOIN sus_municipio f ON (C.CD_MUNICIPIO_IBGE = F.CD_MUNICIPIO_IBGE)
, procedimento_paciente g
LEFT OUTER JOIN procedimento h ON (g.cd_procedimento = h.cd_procedimento AND g.ie_origem_proced = h.ie_origem_proced)
, atendimento_paciente a
LEFT OUTER JOIN procedimento_paciente g ON (A.NR_ATENDIMENTO = G.NR_ATENDIMENTO)
WHERE A.CD_PESSOA_FISICA 		= B.CD_PESSOA_FISICA      AND coalesce(A.IE_TIPO_CONVENIO,1)	<> 3 AND A.CD_ESTABELECIMENTO		= D.CD_ESTABELECIMENTO AND D.CD_CGC			= E.CD_CGC  and a.nr_atendimento		= t.nr_atendimento and t.cd_convenio			= v.cd_convenio and v.cd_cgc			= p.cd_cgc and a.ie_tipo_atendimento <> 1  --Ambulatorial
  and obter_atecaco_atendimento(t.nr_atendimento) 	= t.nr_seq_interno and coalesce(C.CD_MUNICIPIO_IBGE,1)		<>  '999999' -- Bruna, OS61446
  and t.dt_inicio_vigencia=
	(select max(dt_inicio_vigencia)
	from atend_categoria_convenio b
	where nr_atendimento 		= a.nr_atendimento);

