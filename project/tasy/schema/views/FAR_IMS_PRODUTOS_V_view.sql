-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW far_ims_produtos_v (tp_registro, fixo_1, cd_ims, ds_razao_social, cd_cgc, dt_inicial, dt_final, dt_arquivo, fixo_2, ds_branco, cd_interno_ims, cd_embalagem, cd_material, cd_barras, ds_flag, ds_material, ds_fabricante, vl_pfb, ie_tipo_material, ie_classificacao, dt_cadastro, qt_registro) AS select	'7' tp_registro,
	'1' fixo_1,
	'????'cd_ims,
	substr(obter_razao_social(obter_cgc_estabelecimento(1)),1,30) ds_razao_social,
	substr(obter_cgc_estabelecimento(1),1,14) cd_cgc,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_inicial,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_final,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_arquivo,
	'1' fixo_2,
	'                                                                                                                      ' ds_branco,
	'imsbrpro7' cd_interno_ims,
	'' cd_embalagem,
	'' cd_material,
	'' cd_barras,
	'' ds_flag,
	'' ds_material,
	'' ds_fabricante,
	'' vl_pfb,
	'' ie_tipo_material,
	''	ie_classificacao,
	'' dt_cadastro,
	''qt_registro


union all

select	'8' tp_registro,
	'0' fixo_1,
	'????'cd_ims,
	'' ds_razao_social,
	'' cd_cgc,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_inicial,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_final,
	to_char(LOCALTIMESTAMP,'ddmmyyyy') dt_arquivo,
	'0' fixo_2,
	'        ' ds_branco,
	'P' cd_interno_ims,
	CASE WHEN coalesce(m.qt_conv_estoque_consumo,0)=0 THEN '0'  ELSE 'X' END  cd_embalagem,
	to_char(lpad(m.cd_material,13,0)) cd_material,
	lpad(substr((	select	max(x.cd_barra_material)
			from	material_cod_barra x
			where	x.cd_material = m.cd_material ),1,13),13,0) cd_barras,
	'1' ds_flag,
	substr(m.ds_material,1,70) ds_material,
	substr(obter_razao_social((	select	max(x.cd_cgc_fabricante)
				from	material_cod_barra x
				where	x.cd_material = m.cd_material )),1,40) ds_fabricante,
	'000000000' vl_pfb,
	'FarmacÃªutica' ie_tipo_material,
	lpad(coalesce((	select	cd_ncm
		from	material_fiscal x,
			lista_ncm y
		where	x.cd_material = m.cd_material
		and	x.nr_seq_ncm = y.nr_sequencia ),0),1,15)	ie_classificacao,
	to_char(m.dt_atualizacao_nrec,'ddmmyyyy') dt_cadastro,
	''qt_registro
from	material m
where exists (	select 1
		from	material_cod_barra x
		where	x.cd_material = m.cd_material
		and	x.cd_barra_material is not null )

union all

select	'9' tp_registro,
	'0' fixo_1,
	'????'cd_ims,
	'' ds_razao_social,
	'' cd_cgc,
	'' dt_inicial,
	'' dt_final,
	'' dt_arquivo,
	'' fixo_2,
	'                                                                                                                                                                                   ' ds_branco,
	'imsbrpro9' cd_interno_ims,
	'' cd_embalagem,
	'' cd_material,
	'' cd_barras,
	'' ds_flag,
	'' ds_material,
	'' ds_fabricante,
	'' vl_pfb,
	'' ie_tipo_material,
	''	ie_classificacao,
	'' dt_cadastro,
	'00000000'qt_registro
;

