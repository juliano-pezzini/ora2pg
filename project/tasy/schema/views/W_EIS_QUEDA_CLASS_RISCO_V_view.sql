-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_queda_class_risco_v (ds_setor_queda, dt_avaliacao, cd_empresa, nr_seq_item, cd_estabelecimento, ds_unidade, nr_sequencia, ie_resultado, ie_sexo, ds_sexo, ie_faixa_etaria, ds_resultado, ds_turno, nr_atendimento) AS select	distinct	
	obter_unidade_atendimento(b.nr_atendimento,'A','S') ds_Setor_Queda,	 
	b.dt_avaliacao, 
	f.cd_empresa, 
	c.nr_seq_item, 
	a.cd_estabelecimento, 
	obter_unidade_atendimento(b.nr_atendimento,'A','U') ds_unidade,	 
	b.nr_sequencia, 
	c.ie_resultado,	 
	obter_sexo_pf(obter_dados_atendimento(b.nr_Atendimento,'CP'),'C') ie_sexo, 
	coalesce(obter_sexo_pf(obter_dados_atendimento(b.nr_Atendimento,'CP'),'D'),'Indeterminado') ds_sexo,	 
	substr(obter_idade(obter_data_nascto_pf(obter_dados_atendimento(b.nr_Atendimento,'CP')),LOCALTIMESTAMP,'E'),1,10) ie_faixa_etaria, 
	substr(obter_resultado_escala_eif(b.nr_sequencia,'D'),1,255) ds_resultado, 
	substr(Obter_Turno_Evento(b.dt_avaliacao,a.cd_estabelecimento,'D','EQ'),1,255) ds_Turno, 
	b.nr_atendimento	 
FROM estabelecimento f, eif_escala d, atendimento_paciente a, escala_eif b
LEFT OUTER JOIN escala_eif_item c ON (b.nr_sequencia = c.nr_seq_escala)
WHERE a.nr_atendimento = b.nr_atendimento and d.nr_sequencia = b.nr_seq_escala and upper(d.ds_escala) like upper('%queda%') and a.cd_estabelecimento = f.cd_estabelecimento and b.dt_inativacao is null;

