-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_interf_mens_unimed_bnu_v (cd_cgc, nr_cpf, vl_mensalidade, vl_mensalidade_mascara, ie_tipo, nm_usuario, dt_mesano_referencia, cd_usuario_plano, cd_operadora_empresa) AS select	'0'|| e.cd_cgc_estipulante		cd_cgc,
	coalesce(c.nr_cpf,'00000000000')	nr_cpf,
	trim(both to_char(coalesce((b.vl_mensalidade - b.vl_coparticipacao),0),'999999999.99'))		vl_mensalidade,
	campo_mascara_virgula(b.vl_mensalidade - b.vl_coparticipacao) vl_mensalidade_mascara,
	0				ie_tipo,
	a.nm_usuario			nm_usuario,
	b.dt_mesano_referencia		dt_mesano_referencia,
	substr(f.cd_usuario_plano,2,15)	cd_usuario_plano,
	d.cd_operadora_empresa		cd_operadora_empresa
FROM	pls_contrato			e,
	pls_segurado			d,
	pessoa_fisica			c,
	pls_segurado_carteira		f,
	pls_mensalidade_segurado	b,
	W_PLS_INTERFACE_MENS		a
where	c.cd_pessoa_fisica		= d.cd_pessoa_fisica
and	b.nr_seq_segurado		= d.nr_sequencia
and	f.nr_seq_segurado		= d.nr_sequencia
and	d.nr_seq_contrato		= e.nr_sequencia
and	a.NR_SEQ_MENSALIDADE_SEG	= b.nr_sequencia

union all

select	'0'|| e.cd_cgc_estipulante		cd_cgc,
	coalesce(c.nr_cpf,'00000000000')	nr_cpf,
	trim(both to_char(coalesce(b.vl_coparticipacao,0),'999999999.99'))		vl_mensalidade,
	campo_mascara_virgula(b.vl_coparticipacao) vl_mensalidade_mascara,
	1				ie_tipo,
	a.nm_usuario			nm_usuario,
	b.dt_mesano_referencia		dt_mesano_referencia,
	substr(f.cd_usuario_plano,2,15)	cd_usuario_plano,
	d.cd_operadora_empresa		cd_operadora_empresa
from	pls_contrato			e,
	pls_segurado			d,
	pessoa_fisica			c,
	pls_segurado_carteira		f,
	pls_mensalidade_segurado	b,
	W_PLS_INTERFACE_MENS		a
where	c.cd_pessoa_fisica		= d.cd_pessoa_fisica
and	b.nr_seq_segurado		= d.nr_sequencia
and	f.nr_seq_segurado		= d.nr_sequencia
and	d.nr_seq_contrato		= e.nr_sequencia
and	a.NR_SEQ_MENSALIDADE_SEG	= b.nr_sequencia
and	coalesce(b.vl_coparticipacao,0)	<> 0;

