-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW laudo_paciente_v (nr_sequencia, nr_seq_pagina, nr_atendimento, dt_entrada_unidade, nr_laudo, nm_usuario, dt_atualizacao, cd_medico_resp, ds_titulo_laudo, dt_laudo, cd_laudo_padrao, ie_normal, dt_exame, nr_prescricao, ds_laudo, dt_aprovacao, nm_usuario_aprovacao, cd_protocolo, cd_projeto, nr_seq_proc, nr_seq_prescricao, dt_liberacao, dt_prev_entrega, dt_real_entrega, qt_imagem, nr_controle, dt_seg_aprovacao, nm_usuario_seg_aprov, nr_seq_motivo_parada, cd_setor_atendimento, nr_exame, cd_medico_aux, dt_envelopado, dt_impressao, dt_fim_digitacao, nm_usuario_digitacao, dt_inicio_digitacao, dt_integracao, nm_medico_solicitante, ie_midia_entregue, cd_tecnico_resp, cd_setor_usuario, nm_usuario_cancel, dt_cancelamento, nm_usuario_liberacao, qt_caracteres, nr_seq_pac_prot_ext, cd_pessoa_fisica, cd_medico, ds_convenio, nm_paciente, nm_social, dt_nascimento, nr_telefone_celular, nm_medico, nm_medico_solic_crm, nm_medico_iniciais, nm_guerra, nm_medico_resp, nm_medico_crm, ds_idade, nm_usuario_atend, ds_tipo_atendimento, ie_sexo, ds_exames, nr_seq_interno_prescr, nr_acesso_dicom, dt_entrada, dt_alta, ds_uf_medico, ds_senha_laudo_medico, nr_crm, ie_status_laudo, nr_seq_superior, ie_recem_nato, nr_seq_grupo_medida, nm_medico_resid, cd_residente, ie_imagem_pacs, ie_formato, ds_arquivo, dt_assinatura, ds_procs_adic, cd_setor_entrega, nr_recem_nato, cd_estabelecimento, ie_nivel_atencao, ie_tumor) AS SELECT 	A.nr_sequencia,
	A.nr_seq_pagina,
	A.nr_atendimento,
	A.dt_entrada_unidade,
	A.nr_laudo,
	A.nm_usuario,
	A.dt_atualizacao,
	A.cd_medico_resp,
	substr(A.ds_titulo_laudo,0,255) as ds_titulo_laudo,
	A.dt_laudo,
	A.cd_laudo_padrao,
	A.ie_normal,
	A.dt_exame,
	A.nr_prescricao,
	A.ds_laudo,
	A.dt_aprovacao,
	A.nm_usuario_aprovacao,
	A.cd_protocolo,
	A.cd_projeto,
	A.nr_seq_proc,
	A.nr_seq_prescricao,
	A.dt_liberacao,
	A.dt_prev_entrega,
	A.dt_real_entrega,
	A.qt_imagem,
	A.nr_controle,
	A.dt_seg_aprovacao,
	A.nm_usuario_seg_aprov,
	A.nr_seq_motivo_parada,
	A.cd_setor_atendimento,
	A.nr_exame,
	A.cd_medico_aux,
	A.dt_envelopado,
	A.dt_impressao,
	A.dt_fim_digitacao,
	A.nm_usuario_digitacao,
	A.dt_inicio_digitacao,
	A.dt_integracao,
	A.nm_medico_solicitante,
	A.ie_midia_entregue,
	A.cd_tecnico_resp,
	A.cd_setor_usuario,
	A.nm_usuario_cancel,
	A.dt_cancelamento,
	A.nm_usuario_liberacao,
	A.qt_caracteres,
	A.nr_seq_pac_prot_ext,
	A.CD_PESSOA_FISICA,
	C.CD_MEDICO,
	B.DS_CONVENIO,
	D.NM_PESSOA_FISICA NM_PACIENTE,
	SUBSTR(OBTER_NOME_SOCIAL_PF(D.cd_pessoa_fisica),1,100) NM_SOCIAL,
	D.DT_NASCIMENTO,
	D.NR_TELEFONE_CELULAR,
	SUBSTR(OBTER_NOME_MEDICO(C.CD_MEDICO,'N'),1,100) NM_MEDICO,
	SUBSTR(OBTER_NOME_MEDICO(C.CD_MEDICO,'C'),1,100) NM_MEDICO_SOLIC_CRM,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'I'),1,100) NM_MEDICO_INICIAIS,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'G'),1,100) NM_GUERRA,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'N') ,1,100) NM_MEDICO_RESP,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'C'),1,100) NM_MEDICO_CRM,
	B.NR_ANOS||' '||obter_desc_expressao(620432,'anos') DS_IDADE,
	B.NM_USUARIO_ATEND,
	B.DS_TIPO_ATENDIMENTO,
	B.IE_SEXO,
	substr(obter_exames_prescricao(C.nr_prescricao,
		coalesce(C.cd_setor_entrega, B.cd_setor_atendimento), 'CQD', 'S'),1,1000) ds_exames,
	obter_seq_interno_prescr(A.nr_prescricao, A.nr_seq_prescricao, A.nr_seq_proc) nr_seq_interno_prescr,
	substr(Obter_nr_acesso_dicom(A.nr_prescricao, A.nr_seq_prescricao, A.nr_seq_proc),1,20) nr_acesso_dicom,
	B.DT_ENTRADA,
	B.DT_ALTA,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'UF'),1,2) DS_UF_MEDICO,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'SL'),1,15) DS_SENHA_LAUDO_MEDICO,
	SUBSTR(OBTER_NOME_MEDICO(A.CD_MEDICO_RESP,'CRM'),1,20) NR_CRM,
	A.IE_STATUS_LAUDO,
	A.nr_seq_superior,
	C.ie_recem_nato,
	A.nr_seq_grupo_medida,
	SUBSTR(OBTER_NOME_MEDICO(A.cd_residente,'N') ,1,100) NM_MEDICO_RESID,
	A.cd_residente,
	substr(Obter_Se_Imagem_Pacs(A.nr_prescricao, A.nr_seq_prescricao),1,1) ie_imagem_pacs,
	coalesce(ie_formato,'1') ie_formato,
	A.ds_arquivo,
	OBTER_DATA_ASSINATURA_DIGITAL(A.nr_seq_assinatura) dt_assinatura,
	substr(Obter_Proceds_Laudo(A.nr_sequencia),1,255) ds_procs_adic,
	C.CD_SETOR_Entrega cd_setor_entrega,
	C.nr_recem_nato,
	B.cd_estabelecimento,
	A.ie_nivel_atencao,
    A.ie_tumor
FROM pessoa_fisica d, atendimento_paciente_v b, laudo_paciente a
LEFT OUTER JOIN prescr_medica c ON (A.NR_PRESCRICAO = C.NR_PRESCRICAO)
WHERE A.NR_ATENDIMENTO	= B.NR_ATENDIMENTO  AND B.CD_PESSOA_FISICA	= D.CD_PESSOA_FISICA;

