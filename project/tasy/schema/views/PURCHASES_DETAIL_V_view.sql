-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW purchases_detail_v (nr_sequencia, ie_tipo, ds_tipo, ds_material, cd_material, vl_unitario, vl_total, cd_unidade_medida_compra, qt_material, nr_seq_aprovacao, nr_seq_proc_aprov) AS select  o.nr_item_solic_compra NR_SEQUENCIA,
		'S' ie_tipo ,
        'Solicitação de compras' ds_tipo ,
        m.ds_material ,
        o.cd_material ,
        coalesce(o.vl_unit_previsto,0) vl_unitario ,
        (o.qt_material * coalesce(o.vl_unit_previsto,0)) vl_total ,
        o.cd_unidade_medida_compra ,
        o.qt_material,
        o.nr_seq_aprovacao ,
        o.NR_SEQ_PROC_APROV
FROM    material m,
        solic_compra p,
        solic_compra_item o
where   m.cd_material   = o.cd_material
and     o.nr_solic_compra = p.nr_solic_compra
--and     p.dt_baixa       is null
union

select   o.NR_ITEM_OCI NR_SEQUENCIA,
	   	 'O' ie_tipo,
         'Ordem de compras' ds_tipo,
         m.ds_material,
         o.cd_material,
         coalesce(o.VL_UNITARIO_MATERIAL,0) vl_unitario ,
         (o.qt_material * coalesce(o.VL_UNITARIO_MATERIAL,0)) vl_total ,
         o.cd_unidade_medida_compra ,
         o.qt_material,
         o.nr_seq_aprovacao ,
         o.NR_SEQ_PROC_APROV
from	   condicao_pagamento c,
         Solic_compra s,
         ordem_compra p,
         ordem_compra_item o,
         material m
where    m.cd_material   = o.cd_material
and	     o.nr_ordem_compra  = p.nr_ordem_compra
and      p.dt_baixa       is null

union

select	o.NR_SEQUENCIA,
		'R' ie_tipo,
         'Requisição de mat/med' ds_tipo,
         m.ds_material,
         o.cd_material,
         coalesce(o.vl_unit_previsto,0) vl_unitario ,
         (o.qt_material_requisitada * coalesce(o.vl_unit_previsto,0)) vl_total ,
         o.cd_unidade_medida,
         o.qt_material_requisitada qt_material,
         o.nr_seq_aprovacao ,
         o.NR_SEQ_PROC_APROV
from	   item_requisicao_material o,
	      requisicao_material p,
	      material m
where	   m.cd_material = o.cd_material
and	    o.nr_requisicao = p.nr_requisicao
and      p.dt_baixa       is null

union

select	o.nr_item_nf NR_SEQUENCIA,
		'N' ie_tipo,
         'Nota fiscal' ds_tipo,
          m.ds_material,
         o.cd_material,
         coalesce(o.vl_unitario_item_nf,0) vl_unitario ,
         (o.qt_item_nf * coalesce(o.vl_unitario_item_nf,0)) vl_total ,
         o.cd_unidade_medida_compra,
         o.qt_item_nf qt_material,
         o.nr_seq_aprovacao ,
         o.NR_SEQ_PROC_APROV
from	   nota_fiscal_item o,
	      nota_fiscal p,
	      material m
where	   m.cd_material = o.cd_material
and	   o.nr_sequencia = p.nr_sequencia

union

select	o.nr_item_cot_compra NR_SEQUENCIA,
		'C' ie_tipo,
         'Cotação de compras' ds_tipo,
          m.ds_material,
         o.cd_material,
         coalesce(r.vl_unitario_material,0) vl_unitario ,
         (o.qt_material * coalesce(r.vl_unitario_material,0)) vl_total ,
         o.cd_unidade_medida_compra,
         r.qt_material qt_material,
         o.nr_seq_aprovacao ,
         o.NR_SEQ_PROC_APROV
from	   cot_compra_item o,
	      cot_compra p,
	      material m,
	      cot_compra_resumo r,
	      cot_compra_forn f,
         cot_compra_forn_item i
where	   m.cd_material = i.cd_material
and	   o.nr_cot_compra = p.nr_cot_compra
and	   o.nr_cot_compra = r.nr_cot_compra
and	   o.nr_item_cot_compra = r.nr_item_cot_compra
and	   p.nr_cot_compra = f.nr_cot_compra
and	   r.nr_seq_cot_forn = f.nr_sequencia
and	   i.nr_sequencia = r.nr_seq_cot_item_forn

union

select	o.nr_seq_licitacao NR_SEQUENCIA,
		'L' ie_tipo,
         'Registro licitação' ds_tipo,
         m.ds_material,
         o.cd_material,
         coalesce(o.vl_maximo_edital,0) vl_unitario ,
         (o.qt_item * coalesce(o.vl_maximo_edital,0)) vl_total ,
         o.cd_unid_medida,
         o.qt_item qt_material,
         o.nr_seq_aprovacao ,
         o.NR_SEQ_PROC_APROV
from	 reg_licitacao p,
      reg_lic_item o,
        material m
where	m.cd_material      = o.cd_material
and	o.nr_seq_licitacao  = p.nr_sequencia
order by vl_total desc;

