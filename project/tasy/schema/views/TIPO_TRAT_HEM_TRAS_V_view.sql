-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW tipo_trat_hem_tras_v (nr_seq_apres, cd_estabelecimento, ds_estabelecimento, ds_unid_dial_estab, nr_seq_unid_dial_atual, ds_unid_dial_atual, nr_seq_unid_dialise, nr_seq_receptor, cd_pessoa_fisica, nm_paciente, qt_cons_anal, qt_dial_cont_anal, qt_dial_aut_anal, qt_dial_interm_anal, qt_hem_anal, qt_pos_trans_anal, qt_pre_trans_anal, qt_trans_anal, qt_cons_transito_anal, qt_dial_cont_transito_anal, qt_dial_aut_transito_anal, qt_dial_interm_transito_anal, qt_hem_transito_anal, qt_pos_trans_transito_anal, qt_pre_trans_transito_anal, qt_trans_transito_anal, qt_total_pac_dialise, qt_total_pac_dial_transito, qt_total_pac_transplante, qt_total_pac_trans_transito, qt_total_pac_total, qt_total_pac_total_transito) AS select	1 nr_seq_apres,
	hd_obter_estab_unidade(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C')) cd_estabelecimento,
	substr(obter_nome_estabelecimento(hd_obter_estab_unidade(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'))),1,80) ds_estabelecimento,
	substr(HD_Obter_Desc_Unid_Dialise(hd_obter_unidade_estab(a.cd_estabelecimento)),1,80) ds_unid_dial_estab,
	hd_obter_unidade_prc(a.cd_pessoa_fisica,'C') nr_seq_unid_dial_atual,
	substr(hd_obter_unidade_prc(a.cd_pessoa_fisica,'D'),1,200) ds_unid_dial_atual,
	a.nr_seq_unid_dialise,
	null nr_seq_receptor,
	a.cd_pessoa_fisica,
	substr(obter_nome_pessoa_fisica(a.cd_pessoa_fisica, null),1,100) nm_paciente,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CO') qt_cons_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CAPD') qt_dial_cont_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','DPA') qt_dial_aut_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CPI') qt_dial_interm_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','HD') qt_hem_anal,
	0 qt_pos_trans_anal,
	0 qt_pre_trans_anal,
	0 qt_trans_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CO') qt_cons_transito_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CAPD') qt_dial_cont_transito_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','DPA') qt_dial_aut_transito_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CPI') qt_dial_interm_transito_anal,
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','HD') qt_hem_transito_anal,
	0 qt_pos_trans_transito_anal,
	0 qt_pre_trans_transito_anal,
	0 qt_trans_transito_anal,
	(hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CO') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CAPD') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','DPA') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','CPI') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'N','HD')) qt_total_pac_dialise,
	(hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CO') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CAPD') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','DPA') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','CPI') +
	hd_obter_qt_tratamento(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'),a.cd_pessoa_fisica,'S','HD')) qt_total_pac_dial_transito,
	0 qt_total_pac_transplante,
	0 qt_total_pac_trans_transito,
	HD_obter_qt_trat_pac(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'), a.cd_pessoa_fisica, 'N') qt_total_pac_total,
	HD_obter_qt_trat_pac(hd_obter_unidade_prc(a.cd_pessoa_fisica,'C'), a.cd_pessoa_fisica, 'S') qt_total_pac_total_transito
FROM	hd_pac_renal_cronico a
where (substr(hd_obter_se_paciente_ativo(a.cd_pessoa_fisica),1,1) = 'S')

union

select	2 nr_seq_apres,
	a.cd_estabelecimento,
	substr(obter_nome_estabelecimento(a.cd_estabelecimento),1,80) ds_estabelecimento,
	null ds_unid_dial_estab,
	substr(hd_obter_unidade_estab(a.cd_estabelecimento),1,10) nr_seq_unid_dial_atual,
	null ds_unid_dial_atual,
	null nr_seq_unid_dialise,
	c.nr_sequencia nr_seq_receptor,
	c.cd_pessoa_fisica,
	substr(obter_nome_pessoa_fisica(c.cd_pessoa_fisica,null),1,100) nm_paciente,
	0 qt_cons_anal,
	0 qt_dial_cont_anal,
	0 qt_dial_aut_anal,
	0 qt_dial_interm_anal,
	0 qt_hem_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'PT') qt_pos_trans_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TX') qt_pre_trans_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TR') qt_trans_anal,
	0 qt_cons_transito_anal,
	0 qt_dial_cont_transito_anal,
	0 qt_dial_aut_transito_anal,
	0 qt_dial_interm_transito_anal,
	0 qt_hem_transito_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'PT') qt_pos_trans_transito_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TX') qt_pre_trans_transito_anal,
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TR') qt_trans_transito_anal,
	0 qt_total_pac_dialise,
	0 qt_total_pac_dial_transito,
	(tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'PT') +
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TX') +
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TR')) qt_total_pac_transplante,
	(tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'PT') +
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TX') +
	tx_obter_qt_tratamento(c.nr_sequencia,c.cd_pessoa_fisica,a.cd_estabelecimento,'TR')) qt_total_pac_trans_transito,
	TX_obter_qt_trat_pac(c.nr_sequencia, c.cd_pessoa_fisica, a.cd_estabelecimento) qt_total_pac_total,
	TX_obter_qt_trat_pac(c.nr_sequencia, c.cd_pessoa_fisica, a.cd_estabelecimento) qt_total_pac_total_transito
from	paciente_tratamento d,
	tx_receptor c,
	tx_registro_snt b,
	tx_central_transpl a
where	a.nr_sequencia		= b.nr_seq_central
and	b.nr_seq_receptor	= c.nr_sequencia
and	c.cd_pessoa_fisica	= d.cd_pessoa_fisica
and	c.nr_sequencia		= d.nr_seq_receptor
and (substr(tx_obter_se_paciente_ativo(c.nr_sequencia),1,1) = 'S');

