-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW totais_contribuinte_v (nr_seq_contribuinte, vl_total, vl_utilizado) AS SELECT A.NR_SEQ_CONTRIBUINTE,
       coalesce(SUM(CASE WHEN B.IE_TIPO_MOVIMENTO='C' THEN  VL_MOVIMENTO END ),0) VL_TOTAL,
       coalesce(SUM(CASE WHEN B.IE_TIPO_MOVIMENTO='U' THEN  VL_MOVIMENTO END ),0) VL_UTILIZADO
FROM CONTRIBUINTE A,
     CONTRIBUINTE_MOVTO B
WHERE A.NR_SEQ_CONTRIBUINTE = B.NR_SEQ_CONTRIBUINTE
GROUP BY A.NR_SEQ_CONTRIBUINTE;

