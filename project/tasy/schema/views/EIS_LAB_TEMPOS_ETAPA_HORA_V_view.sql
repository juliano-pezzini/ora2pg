-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_lab_tempos_etapa_hora_v (cd_setor_atendimento, ie_tipo, nr_seq_grupo, ds_grupo, ds_setor_atendimento, ds_setor_entrega, cd_setor_entrega, nm_exame, nr_seq_exame, nr_atendimento, dt_referencia, min_1, min_2, min_3, min_4, min_5, min_6, min_7, min_8, min_9, min_10, min_11, min_12, qt1, qt2, qt3, qt4, qt5, qt6, qt7, qt8, qt9, qt10, qt11, qt12, ds_tipo_atendimento, ie_tipo_atendimento) AS select 	0 cd_setor_atendimento, /* Mapa traballho */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '15', 'D'),'dd/mm/yyyy hh24:mi:ss')
 	- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,15,1),'dd/mm/yyyy hh24:mi:ss'),b.dt_liberacao)) min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	count(*) qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
FROM   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 15)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta do Material */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,20,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	count(*) qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /* Distribuição do Material */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '25', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,25,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	count(*) qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 25)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Digitação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,30,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	count(*) qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by 	 c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /*  Aprovação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,35,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	count(*) qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /*  Liberação até a Coleta */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	(a.dt_coleta - b.dt_liberacao) min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	count(*) qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	a.dt_coleta is not null
and  	a.nr_seq_exame is not null
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
group by  c.nr_seq_grupo, a.dt_coleta,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Liberação até Digitação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	count(*) qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and  	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Aprovação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	count(*) qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta até aprovação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
			- coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)) min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	count(*) qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.nr_atendimento, a.dt_coleta

union all

select  0 cd_setor_atendimento, /* Data prevista do exame até coleta */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
			- a.dt_prev_execucao) min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	count(*) qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /*  Data prevista do exame até aprovação */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	count(*) qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Liberação do exame */
	1 ie_tipo,
	c.nr_seq_grupo,
	substr(OBTER_DESC_GRUPO_EXAME_LAB(c.nr_seq_grupo),1,60) ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '40', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	count(*) qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 40)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nr_seq_grupo,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select b.cd_setor_atendimento, /* Mapa traballho */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '15', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,15,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	count(*) qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 15)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /* Coleta do Material */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,20,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	count(*) qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento, a.dt_coleta

union all

select 	b.cd_setor_atendimento, /* Distribuição do Material */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '25', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,25,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	count(*) qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 25)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /* Digitação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,30,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	count(*) qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /*  Aprovação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,35,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	count(*) qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /*  Liberação até a Coleta */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	(a.dt_coleta - b.dt_liberacao) min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	count(*) qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	a.dt_coleta is not null
and  	a.nr_seq_exame is not null
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
group by b.cd_setor_atendimento,a.dt_coleta,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /* Liberação até Digitação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	count(*) qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	b.cd_setor_atendimento, /* Liberação até Aprovação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entraga,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	count(*) qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select  b.cd_setor_atendimento, /* Coleta até aprovação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
			- coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)) min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	count(*) qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.nr_atendimento, a.dt_coleta

union all

select  b.cd_setor_atendimento, /* Data prevista do exame até coleta */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
			- a.dt_prev_execucao) min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	count(*) qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento, a.dt_coleta

union all

select b.cd_setor_atendimento, /*  Data prevista do exame até aprovação */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	count(*) qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select b.cd_setor_atendimento, /* Liberação até Liberação do exame */
	2 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	substr(obter_nome_setor(b.cd_setor_atendimento),1,60) ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '40', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	count(*) qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 40)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Mapa traballho */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '15', 'D'),'dd/mm/yyyy hh24:mi:ss')
 	- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,15,1),'dd/mm/yyyy hh24:mi:ss'),b.dt_liberacao)) min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	count(*) qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 15)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta do Material */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,20,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	count(*) qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /* Distribuição do Material */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '25', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,25,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	count(*) qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 25)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Digitação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,30,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	count(*) qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by 	 c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /*  Aprovação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,35,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	count(*) qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /*  Liberação até a Coleta */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	(a.dt_coleta - b.dt_liberacao) min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	count(*) qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	a.dt_coleta is not null
and  	a.nr_seq_exame is not null
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
group by  c.nm_exame,a.dt_coleta,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Liberação até Digitação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	count(*) qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and  	a.nr_seq_exame is not null
group by  c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Aprovação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	count(*) qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by c.nm_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, c.nr_seq_exame, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta até aprovação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
			- coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)) min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	count(*) qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nm_exame, c.nr_seq_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.nr_atendimento, a.dt_coleta

union all

select  0 cd_setor_atendimento, /* Data prevista do exame até coleta */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
			- a.dt_prev_execucao) min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	count(*) qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  c.nm_exame, c.nr_seq_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /*  Data prevista do exame até aprovação */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	count(*) qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nm_exame, c.nr_seq_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Liberação do exame */
	4 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	substr(c.nm_exame,1,30) nm_exame,
	c.nr_seq_exame nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '40', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	count(*) qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 40)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  c.nm_exame, c.nr_seq_exame,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Mapa traballho */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '15', 'D'),'dd/mm/yyyy hh24:mi:ss')
 	- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,15,1),'dd/mm/yyyy hh24:mi:ss'),b.dt_liberacao)) min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	count(*) qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 15)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta do Material */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,20,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	count(*) qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /* Distribuição do Material */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '25', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,25,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	count(*) qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 25)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Digitação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,30,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	count(*) qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by 	 b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /*  Aprovação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,35,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	count(*) qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /*  Liberação até a Coleta */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	(a.dt_coleta - b.dt_liberacao) min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	count(*) qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	a.dt_coleta is not null
and  	a.nr_seq_exame is not null
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
group by  b.cd_setor_entrega,a.dt_coleta,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento, a.dt_coleta

union all

select 	0 cd_setor_atendimento, /* Liberação até Digitação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	count(*) qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and  	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Aprovação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	count(*) qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.cd_setor_entrega, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta até aprovação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
			- coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)) min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	count(*) qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.nr_atendimento, a.dt_coleta

union all

select  0 cd_setor_atendimento, /* Data prevista do exame até coleta */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
			- a.dt_prev_execucao) min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	count(*) qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /*  Data prevista do exame até aprovação */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	count(*) qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Liberação do exame */
	3 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	substr(obter_nome_setor(b.cd_setor_entrega),1,60) ds_setor_entrega,
	b.cd_setor_entrega cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	0 nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '40', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	count(*) qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 40)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.cd_setor_entrega,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Mapa traballho */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '15', 'D'),'dd/mm/yyyy hh24:mi:ss')
 	- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,15,1),'dd/mm/yyyy hh24:mi:ss'),b.dt_liberacao)) min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	count(*) qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 15)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta do Material */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,20,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	count(*) qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /* Distribuição do Material */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '25', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,25,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	count(*) qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 25)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Digitação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,30,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	count(*) qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by 	b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /*  Aprovação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- coalesce(to_date(lab_obter_etapa_ant(a.nr_prescricao,a.nr_sequencia,35,1),'dd/mm/yyyy
hh24:mi:ss'),b.dt_liberacao)) min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	count(*) qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /*  Liberação até a Coleta */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	(a.dt_coleta - b.dt_liberacao) min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	count(*) qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	a.dt_coleta is not null
and  	a.nr_seq_exame is not null
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
group by  b.nr_atendimento, a.dt_coleta,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 	0 cd_setor_atendimento, /* Liberação até Digitação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '30', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	count(*) qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 30)
and  	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Aprovação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				- b.dt_liberacao) min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	count(*) qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.dt_liberacao, b.nr_atendimento

union all

select  0 cd_setor_atendimento, /* Coleta até aprovação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
			- coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)) min_9,
	0 min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	count(*) qt9,
	0 qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, b.nr_atendimento, a.dt_coleta

union all

select  0 cd_setor_atendimento, /* Data prevista do exame até coleta */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	(coalesce(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '20', 'D'),'dd/mm/yyyy hh24:mi:ss'),a.dt_coleta)
			- a.dt_prev_execucao) min_10,
	0 min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	count(*) qt10,
	0 qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and 	((exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 20)) or (a.dt_coleta is not null))
and	b.dt_liberacao is not null
and  	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento, a.dt_coleta

union all

select 0 cd_setor_atendimento, /*  Data prevista do exame até aprovação */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '35', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_11,
	0 min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	count(*) qt11,
	0 qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 35)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento

union all

select 0 cd_setor_atendimento, /* Liberação até Liberação do exame */
	5 ie_tipo,
	0 nr_seq_grupo,
	null ds_grupo,
	null ds_setor_atendimento,
	null ds_setor_entrega,
	0 cd_setor_entrega,
	null nm_exame,
	0 nr_seq_exame,
	b.nr_atendimento nr_atendimento,
	trunc(b.dt_prescricao) dt_referencia,
	0 min_1,
	0 min_2,
	0 min_3,
	0 min_4,
	0 min_5,
	0 min_6,
	0 min_7,
	0 min_8,
	0 min_9,
	0 min_10,
	0 min_11,
	(to_date(obter_lab_execucao_etapa(a.nr_prescricao, a.nr_sequencia, '40', 'D'),'dd/mm/yyyy hh24:mi:ss')
				-  a.dt_prev_execucao) min_12,
	0 qt1,
	0 qt2,
	0 qt3,
	0 qt4,
	0 qt5,
	0 qt6,
	0 qt7,
	0 qt8,
	0 qt9,
	0 qt10,
	0 qt11,
	count(*) qt12,
	obter_valor_dominio(12,obter_tipo_atendimento(b.nr_atendimento)) ds_tipo_atendimento,
	obter_tipo_atendimento(b.nr_atendimento) ie_tipo_atendimento
from   	prescr_medica b,
	exame_laboratorio c,
	prescr_procedimento a
where 	c.nr_seq_exame = a.nr_seq_exame
and  	a.nr_prescricao = b.nr_prescricao
and exists (select 1 from prescr_proc_etapa d
		where d.nr_prescricao = a.nr_prescricao
		and   d.nr_seq_prescricao = a.nr_sequencia
		and   d.ie_etapa = 40)
and	b.dt_liberacao is not null
and	a.nr_seq_exame is not null
group by  b.nr_atendimento,
	 trunc(b.dt_prescricao),a.nr_prescricao, a.nr_sequencia, a.dt_prev_execucao, b.nr_atendimento;

