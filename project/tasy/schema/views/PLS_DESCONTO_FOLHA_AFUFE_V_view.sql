-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_desconto_folha_afufe_v (ie_mensalidade, nr_seq_cobranca, tp_registro, ie_titular_dependente, nr_idade, cd_matricula, nm_pessoa_fisica, dt_nascimento, dt_adesao, vl_item, qt_vazio_um, qt_zero, qt_vazio_oito) AS select	'M' 											ie_mensalidade,
	b.nr_sequencia 										nr_seq_cobranca, 
	1 											tp_registro, 
	CASE WHEN g.nr_seq_titular IS NULL THEN 'T'  ELSE 'D' END  							ie_titular_dependente, 
	substr(pls_obter_idade_segurado(g.nr_sequencia,d.dt_referencia,'A'),1,2) 		nr_idade, 
	lpad(substr(h.cd_usuario_plano,1,15),15,'0')						cd_matricula, 
	substr(obter_nome_pessoa_fisica(g.cd_pessoa_fisica,null),1,25)				nm_pessoa_fisica, 
	to_char(obter_data_nascto_pf(g.cd_pessoa_fisica),'ddmmyyyy')				dt_nascimento, 
	to_char(g.dt_contratacao,'ddmmyyyy')							dt_adesao, 
	lpad(replace(campo_mascara_virgula(sum(f.vl_item)),'.',','),14,'0')			vl_item, 
	' '											qt_vazio_um, 
	'0'											qt_zero, 
	'    '										qt_vazio_oito 
FROM	titulo_receber_cobr 		a, 
	cobranca_escritural 		b, 
	titulo_receber 			c, 
	pls_mensalidade			d, 
	pls_mensalidade_segurado 	e, 
	pls_mensalidade_seg_item	f, 
	pls_segurado			g, 
	pls_segurado_carteira		h 
where 	b.nr_sequencia 		= a.nr_seq_cobranca 
and	a.nr_titulo 		= c.nr_titulo 
and	c.nr_seq_mensalidade 	= d.nr_sequencia 
and	d.nr_sequencia 		= e.nr_seq_mensalidade 
and	e.nr_sequencia 		= f.nr_seq_mensalidade_seg 
and	g.nr_sequencia		= e.nr_seq_segurado 
and	g.nr_sequencia		= h.nr_seq_segurado 
group by 
	b.nr_sequencia, 
	h.cd_usuario_plano, 
	g.nr_seq_titular, 
	g.nr_sequencia, 
	d.dt_referencia, 
	g.cd_pessoa_fisica, 
	g.dt_contratacao;

