-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_atendimento_mat_v (ie_periodo, dt_referencia, dt_atualizacao, nm_usuario, cd_estabelecimento, ie_ocorrencia, ie_origem_inf, ie_urgente, ie_tipo_material, cd_classe_material, cd_grupo_material, cd_subgrupo_material, hr_atendimento, qt_itens, qt_minutos, cd_medico, cd_motivo_baixa, cd_setor_solicitante, cd_centro_custo, cd_local_estoque, cd_local_destino, cd_pessoa_atendente, cd_pessoa_fisica, cd_material, nm_usuario_atend, cd_unidade_medida_estoque, qt_atendido, ie_tipo_operacao, cd_operacao_estoque, ds_setor_solicitante, ds_grupo_material, ds_subgrupo_material, nm_medico, ds_centro_custo, ds_local_estoque, ds_local_destino, ds_tipo_material, ds_origem_informacao, ds_motivo_baixa, ds_ocorrencia, dt_mensal) AS select	a.IE_PERIODO,a.DT_REFERENCIA,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_ESTABELECIMENTO,a.IE_OCORRENCIA,a.IE_ORIGEM_INF,a.IE_URGENTE,a.IE_TIPO_MATERIAL,a.CD_CLASSE_MATERIAL,a.CD_GRUPO_MATERIAL,a.CD_SUBGRUPO_MATERIAL,a.HR_ATENDIMENTO,a.QT_ITENS,a.QT_MINUTOS,a.CD_MEDICO,a.CD_MOTIVO_BAIXA,a.CD_SETOR_SOLICITANTE,a.CD_CENTRO_CUSTO,a.CD_LOCAL_ESTOQUE,a.CD_LOCAL_DESTINO,a.CD_PESSOA_ATENDENTE,a.CD_PESSOA_FISICA,a.CD_MATERIAL,a.NM_USUARIO_ATEND,a.CD_UNIDADE_MEDIDA_ESTOQUE,a.QT_ATENDIDO,a.IE_TIPO_OPERACAO,a.CD_OPERACAO_ESTOQUE,
	obter_nome_setor(a.cd_setor_solicitante) ds_setor_solicitante, 
	obter_desc_estrut_mat(a.cd_grupo_material, null, null, null) ds_grupo_material, 
	obter_desc_estrut_mat(null, a.cd_subgrupo_material, null, null) ds_subgrupo_material, 
	obter_nome_pessoa_fisica(a.cd_medico, null) nm_medico, 
	CASE WHEN a.cd_centro_custo IS NULL THEN  'Não Informado'  ELSE '(' || a.cd_centro_custo || ') ' || obter_desc_centro_custo(a.cd_centro_custo) END  ds_centro_custo, 
	obter_desc_local_estoque(a.cd_local_estoque) ds_local_estoque, 
	obter_desc_local_estoque(a.cd_local_destino) ds_local_destino, 
	obter_valor_dominio(29, a.ie_tipo_material) ds_tipo_material, 
	obter_valor_dominio(33, a.ie_origem_inf) ds_origem_informacao, 
	obter_Eis_Tipo_Baixa_mat(coalesce(a.cd_motivo_baixa,0), a.ie_ocorrencia) ds_motivo_baixa, 
	CASE WHEN a.ie_ocorrencia='P' THEN 'Prescrição'  ELSE 'Requisição' END  ds_ocorrencia, 
	trunc(dt_referencia, 'MONTH') dt_mensal 
FROM	Eis_Atendimento_Mat a;

