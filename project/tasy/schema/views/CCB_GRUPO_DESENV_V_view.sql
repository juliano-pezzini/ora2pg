-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW ccb_grupo_desenv_v (nr_seq_grupo, nm_usuario, nm_pessoa_fisica, ds_email, cd_pessoa_fisica, ds_tipo_usuario) AS select	a.nr_sequencia nr_seq_grupo,
		a.nm_usuario_lider nm_usuario,
		obter_pf_usuario(a.nm_usuario_lider,'') nm_pessoa_fisica,
		obter_email_pf(obter_pf_usuario(a.nm_usuario_lider,'C')) ds_email,
		obter_pf_usuario(a.nm_usuario_lider,'C') cd_pessoa_fisica,
		'Líder' ds_tipo_usuario
FROM	grupo_desenvolvimento	a,
		usuario_grupo_des		b,
		usuario					c,
		pessoa_fisica			d	
where	a.nr_sequencia			= b.nr_seq_grupo
and 	b.nm_usuario_grupo		= c.nm_usuario
and		c.cd_pessoa_fisica 		= d.cd_pessoa_fisica
and		a.nm_usuario_lider is not null

union all

select	a.nr_sequencia nr_seq_grupo,
		b.nm_usuario_grupo nm_usuario,
		obter_pf_usuario(b.nm_usuario_grupo,'') nm_pessoa_fisica,
		OBTER_EMAIL_PF(obter_pf_usuario(b.nm_usuario_grupo,'C')) ds_email,
		obter_pf_usuario(b.nm_usuario_grupo,'C') cd_pessoa_fisica,
		'Analista de Sistemas' ds_tipo_usuario
from	grupo_desenvolvimento	a,
		usuario_grupo_des		b,
		usuario					c,
		pessoa_fisica			d	
where	a.nr_sequencia			= b.nr_seq_grupo
and 	b.nm_usuario_grupo		= c.nm_usuario
and		c.cd_pessoa_fisica 		= d.cd_pessoa_fisica
and 	b.ie_funcao_usuario 	= 'S'

union all

select	a.nr_sequencia nr_seq_grupo,
		b.nm_usuario_delegacao nm_usuario,
		obter_pf_usuario(b.nm_usuario_delegacao,'') nm_pessoa_fisica,
		OBTER_EMAIL_PF(obter_pf_usuario(b.nm_usuario_delegacao,'C')) ds_email,
		obter_pf_usuario(b.nm_usuario_delegacao,'C') cd_pessoa_fisica,
		'Delegação' ds_tipo_usuario
from	grupo_desenvolvimento	a,
		grupo_des_delegacao		b
where	a.nr_sequencia  = b.nr_seq_grupo_des
and		LOCALTIMESTAMP between coalesce(b.dt_inicio_vigencia,LOCALTIMESTAMP) and coalesce(b.dt_fim_vigencia, LOCALTIMESTAMP)

union all

select 	a.nr_sequencia nr_seq_grupo,
		a.nm_usuario_negonio nm_usuario,
		obter_pf_usuario(a.nm_usuario_negonio,'') nm_pessoa_fisica,
		obter_email_pf(obter_pf_usuario(a.nm_usuario_negonio,'C')) ds_email,
		obter_pf_usuario(a.nm_usuario_negonio,'C') cd_pessoa_fisica,
		'Negócio' ds_tipo_usuario
from	grupo_desenvolvimento	a,
		gerencia_wheb			b
where	a.nr_seq_gerencia		= b.nr_sequencia
and		a.nm_usuario_negonio is not null;

