-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_historico_geral_dossie_v (cd_origem_hist_geral, ds_origem_hist_geral, dt_historico, ds_tipo_historico, ds_historico, nm_usuario, nr_sequencia, nr_seq_segurado, cd_pessoa_fisica, nr_boletim, nr_processo) AS select	1 cd_origem_hist_geral,
	'Beneficiario' ds_origem_hist_geral,
	dt_historico,
	substr(obter_valor_dominio(1899,ie_tipo_historico),1,255) ds_tipo_historico,
	ds_historico,
	nm_usuario,
	nr_sequencia,
	nr_seq_segurado,
	'' cd_pessoa_fisica,
	null nr_boletim,
	null nr_processo
FROM	pls_segurado_historico
where	ie_tipo_historico <> '7'

union all

select	1 cd_origem_hist_geral,
	'Beneficiario' ds_origem_hist_geral,
	dt_historico,
	substr(obter_valor_dominio(1899,ie_tipo_historico),1,255) ds_tipo_historico,
	obter_string_rtf(ds_historico) ds_historico,
	nm_usuario,
	nr_sequencia,
	nr_seq_segurado,
	'' cd_pessoa_fisica,
	null nr_boletim,
	null nr_processo
from	pls_segurado_historico
where	ie_tipo_historico = '7'

union

select	2 cd_origem_hist_geral,
	'SAC' ds_origem_hist_geral,
	dt_ocorrencia dt_historico,
	'' ds_tipo_historico,
	substr(ds_ocorrencia,1,255),
	nm_usuario,
	nr_sequencia,
	0 nr_seq_segurado,
	cd_pessoa_fisica,
	nr_sequencia nr_boletim,
	nr_seq_processo nr_processo
from	sac_boletim_ocorrencia

union

select	3 cd_origem_hist_geral,
	'Proposta de Adesão' ds_origem_hist_geral,
	a.dt_historico,
	substr(obter_valor_dominio(4217,a.ie_tipo_historico),1,255) ds_tipo_historico,
	substr(a.ds_historico,1,255),
	a.nm_usuario,
	a.nr_sequencia,
	b.nr_seq_benef_gerado nr_seq_segurado,
	b.cd_beneficiario cd_pessoa_fisica,
	null nr_boletim,
	null nr_processo
from	pls_proposta_benef_hist a,
	pls_proposta_beneficiario b
where	a.nr_seq_benef_proposta = b.nr_sequencia

union

select	4 cd_origem_hist_geral,
	'Solicitação de rescisão '||b.nr_sequencia ds_origem_hist_geral,
	a.dt_liberacao dt_historico,
	coalesce(d.ds_tipo_historico,a.ds_titulo) ds_tipo_historico,
	substr(coalesce(a.ds_historico_texto,a.ds_historico),1,255) ds_historico,
	a.nm_usuario,
	a.nr_sequencia,
	c.nr_seq_segurado,
	'' cd_pessoa_fisica,
	null nr_boletim,
	null nr_processo
FROM pls_solic_rescisao_benef c, pls_solicitacao_rescisao b, pls_solicitacao_resc_hist a
LEFT OUTER JOIN pls_tipo_hist_solic_resc d ON (a.nr_seq_tipo_historico = d.nr_sequencia)
WHERE b.nr_sequencia	= a.nr_seq_solicitacao and b.nr_sequencia	= c.nr_seq_solicitacao  and a.dt_liberacao is not null;

