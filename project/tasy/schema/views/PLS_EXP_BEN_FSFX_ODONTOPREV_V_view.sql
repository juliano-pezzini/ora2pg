-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_exp_ben_fsfx_odontoprev_v (ie_tipo, nr_seq_lote, espaco_1, tipo_usuario, dt_nascimento, nr_telefone, ds_endereco, ds_municipio, sg_estado, cd_cep, nr_telefone_2, nr_identidade, ie_estado_civil, ds_lotacao, tp_benef, ie_tipo_movimentacao, cd_carteira, nr_cpf, ie_sexo, nm_sobrenome_mae, nr_cartao_nac_sus, dia_inclusao_plano, mes_ano_inclusao_plano, cd_matricula, ds_bairro, ds_email, ie_exclusao, ds_orgao_emissor_ci, nm_beneficiario, nr_plano, cd_carteira_seg) AS select	'1' ie_tipo,
	nr_sequencia nr_seq_lote, 
	' ' espaco_1, 
	'Tipo de Usuário' tipo_usuario, 
	'Nascimento' dt_nascimento, 
	'Telefone' nr_telefone, 
	'Endereço' ds_endereco, 
	'Cidade' ds_municipio, 
	'Uf' sg_estado, 
	'Cep' cd_cep, 
	'Telefone 2' nr_telefone_2, 
	'RG' nr_identidade, 
	'Estado Civil' ie_estado_civil, 
	'Lotação'ds_lotacao, 
	'Tipo de Beneficiário'tp_benef, -- perguntar michelle 
	'Tipo de Movimentação' ie_tipo_movimentacao, 
	'Carteira'cd_carteira, 
	'CPF' nr_cpf, 
	'Sexo' ie_sexo, 
	'Mãe' nm_sobrenome_mae, 
	'Cartão Saude' nr_cartao_nac_sus, 
	'Dia Inclusão Plano' dia_inclusao_plano, 
	'Mês/Ano Inclusão Plano' mes_ano_inclusao_plano, 
	'Matrícula' cd_matricula, 
	'Bairro' ds_bairro, 
	'E-Mail' ds_email, 
	'Motivo de Exclusão' ie_exclusao, -- perguntar michelle 
	'Órgão' ds_orgao_emissor_ci, 
	'Nome' nm_beneficiario, 
	'Plano' nr_plano, 
	'Carteira'cd_carteira_seg 
FROM 	pls_lote_mov_benef 

union all
 
select	'2' ie_tipo, 
	a.nr_seq_lote, 
	' ' espaco_1, 
	CASE WHEN a.nr_seq_parentesco='124' THEN 'T'  ELSE 'D' END tipo_usuario, 
	to_char(a.dt_nascimento,'dd/mm/yyyy') dt_nascimento, 
	a.nr_telefone, 
	a.ds_endereco||', '||to_char(a.nr_endereco)||', '||a.ds_complemento ds_endereco, 
	a.ds_municipio, 
	a.sg_estado, 
	a.cd_cep, 
	null nr_telefone_2, 
	lpad(a.nr_identidade,11,'0')nr_identidade, 
	CASE WHEN a.ie_estado_civil='1' THEN 'S' WHEN a.ie_estado_civil='2' THEN 'C' WHEN a.ie_estado_civil='3' THEN 'R' WHEN a.ie_estado_civil='4' THEN 'D' WHEN a.ie_estado_civil='5' THEN 'V' WHEN a.ie_estado_civil='6' THEN 'P' WHEN a.ie_estado_civil='7' THEN 'M' WHEN a.ie_estado_civil='9' THEN 'O' END ie_estado_civil, 
	h.ds_localizacao ds_lotacao, 
	obter_desc_parent_odontoprev(d.nr_sequencia)tp_benef, -- Perguntar Michelle 
	CASE WHEN a.ie_tipo_movimentacao='I' THEN '1' WHEN a.ie_tipo_movimentacao='A' THEN '2' WHEN a.ie_tipo_movimentacao='E' THEN '3' WHEN a.ie_tipo_movimentacao='B' THEN 4 END ie_tipo_movimentacao, 
	pls_obter_dados_segurado(a.NR_SEQ_SEGURADO , 'C') cd_carteira, 
	lpad(a.nr_cpf,11,'0')nr_cpf, 
	a.ie_sexo, 
	c.nm_sobrenome_mae, 
	c.nr_cartao_nac_sus, 
	to_char(d.dt_inclusao_operadora, 'dd')dia_inclusao_plano, 
	to_char(d.dt_inclusao_operadora, 'mm/yyyy')mes_ano_inclusao_plano, 
	CASE WHEN a.ie_tipo_movimentacao='I' THEN to_char(d.cd_matricula_familia)  ELSE '' END  cd_matricula, -- Perguntar Michelle 
	a.ds_bairro, 
	pls_obter_dados_segurado(a.nr_seq_segurado , 'E') ds_email, 
	pls_obter_desc_motivo_cancel(d.nr_seq_motivo_cancelamento) ie_exclusao, -- 
	c.ds_orgao_emissor_ci, 
	a.nm_beneficiario, 
	CASE WHEN d.nr_seq_plano=59 THEN 'BOR' WHEN d.nr_seq_plano=56 THEN 'BEA'  ELSE 'BEA' END  nr_plano, 
	pls_obter_dados_segurado(a.nr_seq_segurado , 'C') cd_carteira_seg 
FROM compl_pessoa_fisica f, pessoa_fisica c, pls_lote_mov_benef b, pls_movimentacao_benef a, pls_segurado d
LEFT OUTER JOIN pls_localizacao_benef h ON (d.nr_seq_localizacao_benef = h.nr_sequencia)
LEFT OUTER JOIN pls_segurado_compl g ON (d.nr_sequencia = g.nr_seq_segurado)
WHERE b.nr_sequencia		= a.nr_seq_lote and a.nr_seq_segurado	= d.nr_sequencia  and d.cd_pessoa_fisica	= c.cd_pessoa_fisica and c.cd_pessoa_fisica	= f.cd_pessoa_fisica  and f.ie_tipo_complemento	= '1';

