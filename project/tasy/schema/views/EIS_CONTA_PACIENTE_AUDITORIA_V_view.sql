-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_conta_paciente_auditoria_v (cd_convenio, ds_convenio, nr_seq_hist_audit, ds_historico, cd_motivo_glosa, ds_motivo_glosa, ie_tipo_atendimento, ds_tipo_atendimento, ie_clinica, ds_clinica, dt_referencia, vl_guia, vl_amenor, vl_naceito, vl_aceito, vl_recebimento, cd_empresa, cd_estabelecimento) AS select	a.cd_convenio,
	b.ds_convenio,
	c.nr_seq_hist_audit,
	d.ds_historico,
	e.cd_motivo_glosa,
	f.ds_motivo_glosa,
	j.ie_tipo_atendimento,
	substr(obter_valor_dominio(12,j.ie_tipo_atendimento),1,255) ds_tipo_atendimento,
	j.ie_clinica,
	substr(obter_valor_dominio(17,j.ie_clinica),1,255) ds_clinica,
	trunc(c.dt_historico) dt_referencia,
	h.vl_guia,
	g.vl_amenor,
	CASE WHEN coalesce(e.ie_acao_glosa,f.ie_acao_glosa)='R' THEN e.vl_glosa  ELSE 0 END  vl_naceito,
	CASE WHEN coalesce(e.ie_acao_glosa,f.ie_acao_glosa)='A' THEN e.vl_glosa  ELSE 0 END  vl_aceito,
	g.vl_pago vl_recebimento,
	obter_empresa_estab(i.cd_estabelecimento) cd_empresa,
	i.cd_estabelecimento
FROM atendimento_paciente j, conta_paciente i, conta_paciente_guia h, convenio_retorno_item g, hist_audit_conta_paciente d, conta_paciente_ret_hist c, convenio b, conta_paciente_retorno a, convenio_retorno_glosa e
LEFT OUTER JOIN motivo_glosa f ON (e.cd_motivo_glosa = f.cd_motivo_glosa)
WHERE i.nr_atendimento	= j.nr_atendimento and h.nr_interno_conta	= i.nr_interno_conta and coalesce(g.cd_autorizacao,'Não Informada')	= coalesce(h.cd_autorizacao,'Não Informada') and g.nr_interno_conta	= h.nr_interno_conta and e.nr_seq_ret_item	= g.nr_sequencia  and c.nr_sequencia		= e.nr_seq_conpaci_ret_hist and c.nr_seq_hist_audit	= d.nr_sequencia and a.nr_sequencia		= c.nr_seq_conpaci_ret and a.cd_convenio		= b.cd_convenio;

