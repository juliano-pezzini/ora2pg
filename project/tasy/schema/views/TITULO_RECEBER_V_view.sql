-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW titulo_receber_v (nr_titulo, cd_estabelecimento, dt_atualizacao, nm_usuario, dt_emissao, dt_vencimento, dt_pagamento_previsto, dt_limite_desconto, vl_titulo, vl_saldo_titulo, vl_saldo_juros, vl_saldo_multa, cd_moeda, cd_portador, cd_tipo_portador, tx_juros, tx_multa, cd_tipo_taxa_juro, cd_tipo_taxa_multa, tx_desc_antecipacao, ie_situacao, ie_tipo_emissao_titulo, ie_origem_titulo, ie_tipo_titulo, ie_tipo_inclusao, cd_pessoa_fisica, nr_interno_conta, cd_cgc, cd_serie, nr_documento, nr_sequencia_doc, cd_banco, cd_agencia_bancaria, nr_bloqueto, dt_liquidacao, nr_lote_contabil, ds_observacao_titulo, nr_atendimento, nr_seq_protocolo, dt_contabil, nr_seq_conta_banco, dt_emissao_bloqueto, nr_seq_classe, nr_guia, nr_nosso_numero, dt_ref_conta, cd_convenio_conta, nr_seq_terc_conta, nr_seq_nf_saida, nr_processo_aih, cd_tipo_recebimento, nr_seq_controle_pessoa, nr_seq_trans_fin_contab, nr_seq_contrato, vl_desc_previsto, nr_seq_carteira_cobr, dt_integracao_externa, cd_estab_financeiro, nr_titulo_externo, nr_seq_mensalidade, nr_seq_mens_segurado, ie_pls, nr_seq_trans_fin_baixa, nr_nota_fiscal, nm_usuario_orig, dt_inclusao, ie_tipo_carteira, nr_seq_empresa, nr_seq_proj_rec, nr_seq_lote_empresa, nr_seq_negociacao_origem, nr_seq_pls_lote_camara, nr_seq_ptu_fatura, dt_ultima_devolucao, nr_seq_lote_enc_contas, ie_liq_inadimplencia, ie_negociado, nr_seq_guia, nr_titulo_dest, nr_seq_pag_conta_evento, vl_outras_despesas, ie_dig_nosso_numero, nr_seq_segurado_mens, nr_seq_eme_fatura, nr_seq_pls_lote_contest, nr_seq_pls_lote_disc, nr_seq_grupo_prod, nr_seq_cob_previa, nr_seq_pagador, nr_guia_doc, dt_entrega_convenio, ie_tipo_pessoa, cd_cgc_cpf, ds_cgc_cpf, nm_pessoa, nm_fantasia, cd_convenio, dt_emissao_dia, dt_liquidacao_dia, dt_vencimento_dia, vl_glosa, vl_rec_maior, vl_baixa, vl_descontos, nm_paciente, dt_protocolo, ds_portador, cd_tipo_pessoa_juridica, ie_tipo_atendimento, vl_juros, vl_multa, ds_convenio, ds_razao_social, qt_prazo_recebimento, dt_liquidacao_mes, nr_conta_titulo, nr_livro, vl_nota_credito) AS Select 	a.NR_TITULO,
	a.CD_ESTABELECIMENTO, 
	a.DT_ATUALIZACAO, 
	a.NM_USUARIO, 
	a.DT_EMISSAO, 
	a.DT_VENCIMENTO, 
	a.DT_PAGAMENTO_PREVISTO, 
	a.dt_limite_desconto, 
	a.VL_TITULO, 
	a.VL_SALDO_TITULO, 
	a.VL_SALDO_JUROS, 
	a.VL_SALDO_MULTA, 
	a.CD_MOEDA, 
	a.CD_PORTADOR, 
	a.CD_TIPO_PORTADOR, 
	a.TX_JUROS, 
	a.TX_MULTA, 
	a.CD_TIPO_TAXA_JURO, 
	a.CD_TIPO_TAXA_MULTA, 
	a.TX_DESC_ANTECIPACAO, 
	a.IE_SITUACAO, 
	a.IE_TIPO_EMISSAO_TITULO, 
	a.IE_ORIGEM_TITULO, 
	a.IE_TIPO_TITULO, 
	a.IE_TIPO_INCLUSAO, 
	a.CD_PESSOA_FISICA, 
	a.NR_INTERNO_CONTA, 
	a.CD_CGC, 
	a.CD_SERIE, 
	a.NR_DOCUMENTO, 
	a.NR_SEQUENCIA_DOC, 
	a.CD_BANCO, 
	a.CD_AGENCIA_BANCARIA, 
	a.NR_BLOQUETO, 
	a.DT_LIQUIDACAO, 
	a.NR_LOTE_CONTABIL, 
	a.DS_OBSERVACAO_TITULO, 
	a.NR_ATENDIMENTO, 
	a.NR_SEQ_PROTOCOLO, 
	a.DT_CONTABIL, 
	a.NR_SEQ_CONTA_BANCO, 
	a.DT_EMISSAO_BLOQUETO, 
	a.NR_SEQ_CLASSE, 
	a.NR_GUIA, 
	a.NR_NOSSO_NUMERO, 
	a.DT_REF_CONTA, 
	a.CD_CONVENIO_CONTA, 
	a.NR_SEQ_TERC_CONTA, 
	a.NR_SEQ_NF_SAIDA, 
	a.NR_PROCESSO_AIH, 
	a.CD_TIPO_RECEBIMENTO, 
	a.NR_SEQ_CONTROLE_PESSOA, 
	a.NR_SEQ_TRANS_FIN_CONTAB, 
	a.NR_SEQ_CONTRATO, 
	a.VL_DESC_PREVISTO, 
	a.NR_SEQ_CARTEIRA_COBR, 
	a.DT_INTEGRACAO_EXTERNA, 
	a.CD_ESTAB_FINANCEIRO, 
	a.NR_TITULO_EXTERNO, 
	a.NR_SEQ_MENSALIDADE, 
	a.NR_SEQ_MENS_SEGURADO, 
	a.IE_PLS, 
	a.NR_SEQ_TRANS_FIN_BAIXA, 
	a.NR_NOTA_FISCAL, 
	a.NM_USUARIO_ORIG, 
	a.DT_INCLUSAO, 
	a.IE_TIPO_CARTEIRA, 
	a.NR_SEQ_EMPRESA, 
	a.NR_SEQ_PROJ_REC, 
	a.NR_SEQ_LOTE_EMPRESA, 
	a.NR_SEQ_NEGOCIACAO_ORIGEM, 
	a.NR_SEQ_PLS_LOTE_CAMARA, 
	a.NR_SEQ_PTU_FATURA, 
	a.DT_ULTIMA_DEVOLUCAO, 
	a.NR_SEQ_LOTE_ENC_CONTAS, 
	a.IE_LIQ_INADIMPLENCIA, 
	a.IE_NEGOCIADO, 
	a.NR_SEQ_GUIA, 
	a.NR_TITULO_DEST, 
	a.NR_SEQ_PAG_CONTA_EVENTO, 
	a.VL_OUTRAS_DESPESAS, 
	a.IE_DIG_NOSSO_NUMERO, 
	a.NR_SEQ_SEGURADO_MENS, 
	a.NR_SEQ_EME_FATURA, 
	a.NR_SEQ_PLS_LOTE_CONTEST, 
	a.NR_SEQ_PLS_LOTE_DISC, 
	a.NR_SEQ_GRUPO_PROD, 
	a.NR_SEQ_COB_PREVIA, 
	a.NR_SEQ_PAGADOR, 
	substr(coalesce(a.nr_guia, a.nr_documento),1,20) nr_guia_doc, 
	y.dt_entrega_convenio, 
	CASE WHEN a.cd_pessoa_fisica IS NULL THEN  2  ELSE 1 END  ie_tipo_pessoa, 
	coalesce(b.nr_cpf, c.cd_cgc) cd_cgc_cpf, 
	obter_cgc_cpf_editado(coalesce(b.nr_cpf, c.cd_cgc)) ds_cgc_cpf, 
	substr(coalesce(obter_nome_pf(a.cd_pessoa_fisica),c.ds_razao_social),1,255) nm_pessoa, 
	coalesce(substr(obter_nome_pf(b.cd_pessoa_fisica),1,255),c.nm_fantasia) nm_fantasia, 
	coalesce(a.cd_convenio_conta, obter_convenio_tit_rec(a.nr_titulo)) cd_convenio, 
	trunc(a.dt_emissao,'dd') dt_emissao_dia, 
	trunc(a.dt_liquidacao,'dd') dt_liquidacao_dia, 
	trunc(a.dt_vencimento,'dd') dt_vencimento_dia,	 
	somar_atrib_titulo_receber_liq(a.nr_titulo, 'vl_glosa', null) vl_glosa, 
	somar_atrib_titulo_receber_liq(a.nr_titulo, 'vl_rec_maior', null) vl_rec_maior, 
	somar_atrib_titulo_receber_liq(a.nr_titulo, 'vl_recebido', null) vl_baixa, 
	somar_atrib_titulo_receber_liq(a.nr_titulo, 'vl_descontos', null) vl_descontos, 
	CASE WHEN x.nr_interno_conta IS NULL THEN  a.ds_observacao_titulo  ELSE substr(obter_pessoa_atendimento(x.nr_atendimento,'N'),1,60) END  nm_paciente, 
	y.dt_mesano_referencia dt_protocolo, 
	a.cd_tipo_portador || ' - ' || d.ds_portador ds_portador, 
	c.cd_tipo_pessoa cd_tipo_pessoa_juridica, 
	OBTER_TIPO_ATENDIMENTO(x.nr_atendimento) ie_tipo_atendimento, 
	(obter_juros_multa_titulo(a.nr_titulo,LOCALTIMESTAMP,'R','J'))::numeric  vl_juros, 
	(obter_juros_multa_titulo(a.nr_titulo,LOCALTIMESTAMP,'R','M'))::numeric  vl_multa, 
	substr(obter_nome_convenio(obter_convenio_tit_rec(a.nr_titulo)),1,255) ds_convenio, 
	substr(obter_nome_pf_pj(null,a.cd_cgc),1,255) ds_razao_social, 
	(obter_dias_entre_datas(a.dt_emissao,a.dt_liquidacao))::numeric  qt_prazo_recebimento, 
	trunc(a.dt_liquidacao,'month') dt_liquidacao_mes, 
	(obter_conpaci_titulo(a.nr_titulo))::numeric  nr_conta_titulo, 
	a.NR_LIVRO, 
	somar_atrib_titulo_receber_liq(a.nr_titulo, 'vl_nota_credito', null) vl_nota_credito 
FROM portador d, titulo_receber a
LEFT OUTER JOIN pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
LEFT OUTER JOIN pessoa_juridica c ON (a.cd_cgc = c.cd_cgc)
LEFT OUTER JOIN conta_paciente x ON (a.nr_interno_conta = x.nr_interno_conta)
LEFT OUTER JOIN protocolo_convenio y ON (a.nr_seq_protocolo = y.nr_seq_protocolo)
WHERE a.cd_tipo_portador	 = d.cd_tipo_portador and a.cd_portador		 = d.cd_portador;

