-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW estabelecimento_v (cd_estabelecimento, dt_fechamento_etq, dt_fechamento_fat, ie_situacao, cd_cgc, dt_atualizacao, nm_usuario, cd_empresa, ie_nome_relatorio, ie_conveniado_sus, ie_contas_pagar, pr_icms_estado, cd_inscricao_estadual, cd_inscricao_municipal, cd_atividade_federal, dt_inicio_atividade, cd_localidade, nr_seq_licenca, ds_arq_logo, cd_resp_farmacia, nr_licenca_farmacia, dt_ref_controle_terc, nr_reg_junta_comercial, ie_ans, cd_ans, cd_cns, dt_atualizacao_nrec, nm_usuario_nrec, nm_fantasia_estab, dt_reg_junta_comercial, ie_regra_medico_pac, ie_serv_leito, cd_estab_financeiro, nr_seq_unid_neg, ie_razao_fantasia, dt_ref_controle_terc_fim, ie_desc_barra_msg, ie_tipo_ctb_estab, nm_sigla_estab, dt_reg_cartorio, nr_reg_cartorio, ds_reg_cartorio, ie_area_estab, cd_unidade_conexa, ie_gerar_sped, ds_sigla_gratuidade, cd_titular, cd_contabilista, nr_crc, cd_interno, cd_pf_auditor, cd_cnpj_auditor, dt_arq_conv_emp, cd_unidade_cross, ie_nome_social, ie_tipo_estab, ds_arq_logo_email, ie_utc, ds_razao_social, ds_fantasia, cd_cnes, ds_razao_fantasia, cnpj, nr_inscricao_municipal) AS select a.CD_ESTABELECIMENTO,a.DT_FECHAMENTO_ETQ,a.DT_FECHAMENTO_FAT,a.IE_SITUACAO,a.CD_CGC,a.DT_ATUALIZACAO,a.NM_USUARIO,a.CD_EMPRESA,a.IE_NOME_RELATORIO,a.IE_CONVENIADO_SUS,a.IE_CONTAS_PAGAR,a.PR_ICMS_ESTADO,a.CD_INSCRICAO_ESTADUAL,a.CD_INSCRICAO_MUNICIPAL,a.CD_ATIVIDADE_FEDERAL,a.DT_INICIO_ATIVIDADE,a.CD_LOCALIDADE,a.NR_SEQ_LICENCA,a.DS_ARQ_LOGO,a.CD_RESP_FARMACIA,a.NR_LICENCA_FARMACIA,a.DT_REF_CONTROLE_TERC,a.NR_REG_JUNTA_COMERCIAL,a.IE_ANS,a.CD_ANS,a.CD_CNS,a.DT_ATUALIZACAO_NREC,a.NM_USUARIO_NREC,a.NM_FANTASIA_ESTAB,a.DT_REG_JUNTA_COMERCIAL,a.IE_REGRA_MEDICO_PAC,a.IE_SERV_LEITO,a.CD_ESTAB_FINANCEIRO,a.NR_SEQ_UNID_NEG,a.IE_RAZAO_FANTASIA,a.DT_REF_CONTROLE_TERC_FIM,a.IE_DESC_BARRA_MSG,a.IE_TIPO_CTB_ESTAB,a.NM_SIGLA_ESTAB,a.DT_REG_CARTORIO,a.NR_REG_CARTORIO,a.DS_REG_CARTORIO,a.IE_AREA_ESTAB,a.CD_UNIDADE_CONEXA,a.IE_GERAR_SPED,a.DS_SIGLA_GRATUIDADE,a.CD_TITULAR,a.CD_CONTABILISTA,a.NR_CRC,a.CD_INTERNO,a.CD_PF_AUDITOR,a.CD_CNPJ_AUDITOR,a.DT_ARQ_CONV_EMP,a.CD_UNIDADE_CROSS,a.IE_NOME_SOCIAL,a.IE_TIPO_ESTAB,a.DS_ARQ_LOGO_EMAIL,a.IE_UTC,
		p.ds_razao_social,
		coalesce(a.nm_fantasia_estab, p.ds_razao_social) ds_fantasia,
		p.cd_cnes,
		SUBSTR(CASE WHEN IE_RAZAO_FANTASIA='R' THEN ds_razao_social WHEN IE_RAZAO_FANTASIA='F' THEN coalesce(nm_fantasia_estab,ds_razao_social) WHEN IE_RAZAO_FANTASIA='E' THEN  nm_fantasia_estab END ,1,80) ds_razao_fantasia,
		p.cd_cgc cnpj,
		p.nr_inscricao_municipal
FROM 	pessoa_juridica p,
		Estabelecimento a
where	a.cd_cgc = p.cd_cgc;

