-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW versoes_tasy_v (cd_versao, dt_versao_gera, dt_versao_libera) AS SELECT cd_versao,
       dt_versao_gera, 
       dt_versao_libera + 18 DT_VERSAO_LIBERA 
FROM (SELECT cd_versao, 
               dt_versao dt_versao_gera, 
               dt_versao dt_versao_libera 
        FROM   aplicacao_tasy_versao 
        WHERE  cd_aplicacao_tasy = 'Tasy' 
               AND ie_versao_oficial = 'S' 
        ORDER  BY 1 ASC) alias0 

UNION
 
SELECT vfull               cd_versao, 
       dt_versao_gera, 
       dt_versao_gera + 18 dt_versao_libera 
FROM (WITH RECURSIVE cte AS (
SELECT Substr(cd_versao, 1, Instr(cd_versao, '.', -1, 1)) 
               || To_char(Substr(cd_versao, Instr(cd_versao, '.', -1, 1) + 1, 
                          Length(cd_versao)) + 1)    vfull,dt_versao + 14 * 1 dt_versao_gera 
        FROM (SELECT Max(cd_versao) cd_versao, 
                       Max(dt_versao) dt_versao 
                FROM   aplicacao_tasy_versao 
                WHERE  cd_aplicacao_tasy = 'Tasy' 
                       AND ie_versao_oficial = 'S') 
        LEVEL <= 200  UNION ALL
SELECT Substr(cd_versao, 1, Instr(cd_versao, '.', -1, 1)) 
               || To_char(Substr(cd_versao, Instr(cd_versao, '.', -1, 1) + 1, 
                          Length(cd_versao)) + (c.level+1))    vfull,dt_versao + 14 * (c.level+1) dt_versao_gera 
        FROM (SELECT Max(cd_versao) cd_versao, 
                       Max(dt_versao) dt_versao 
                FROM   aplicacao_tasy_versao 
                WHERE  cd_aplicacao_tasy = 'Tasy' 
                       AND ie_versao_oficial = 'S') 
        LEVEL <= 200 JOIN cte c ON ()

) SELECT * FROM cte;
) alias10
order by 1 desc;

