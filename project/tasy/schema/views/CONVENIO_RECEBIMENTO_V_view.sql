-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW convenio_recebimento_v (nr_sequencia, cd_convenio, dt_recebimento, vl_recebimento, ie_status, ds_status, nr_seq_conta_banco, nr_seq_trans_fin, nr_lote_contabil, ds_observacao, nr_seq_retorno, vl_vinculacao, ds_convenio, ds_conta, ds_transacao, nr_seq_ret_item, nr_interno_conta, nr_titulo, vl_pago, vl_glosado, vl_adicional, vl_amenor) AS select	a.nr_sequencia,
		a.cd_convenio,
		a.dt_recebimento,
		a.vl_recebimento,
		a.ie_status,
		CASE WHEN a.ie_status='N' THEN 'Não vinculado' WHEN a.ie_status='P' THEN 'Parcial'  ELSE 'Total' END  ds_status,
		a.nr_seq_conta_banco,
		a.nr_seq_trans_fin,
		a.nr_lote_contabil,
		a.ds_observacao,
		b.nr_seq_retorno,
		coalesce(b.vl_vinculacao,0) vl_vinculacao,
		c.ds_convenio,
		d.ds_conta,
		e.ds_transacao,
		f.nr_sequencia nr_seq_ret_item,
		f.nr_interno_conta,
		f.nr_titulo,
		sum(f.vl_pago) vl_pago,
		sum(f.vl_glosado) vl_glosado,
		sum(f.vl_adicional) vl_adicional,
		sum(f.vl_amenor) vl_amenor
FROM convenio c, convenio_receb a
LEFT OUTER JOIN convenio_ret_receb b ON (a.nr_sequencia = b.nr_seq_receb)
LEFT OUTER JOIN banco_estabelecimento_v d ON (a.nr_seq_conta_banco = d.nr_sequencia)
LEFT OUTER JOIN transacao_financeira e ON (a.nr_seq_trans_fin = e.nr_sequencia)
LEFT OUTER JOIN convenio_retorno_item f ON (b.nr_seq_retorno = f.nr_seq_retorno)
WHERE a.cd_convenio = c.cd_convenio    group by	a.nr_sequencia,
		a.cd_convenio,
		a.dt_recebimento,
		a.vl_recebimento,
		a.ie_status,
		CASE WHEN a.ie_status='N' THEN 'Não vinculado' WHEN a.ie_status='P' THEN 'Parcial'  ELSE 'Total' END ,
		a.nr_seq_conta_banco,
		a.nr_seq_trans_fin,
		a.nr_lote_contabil,
		a.ds_observacao,
		b.nr_seq_retorno,
		coalesce(b.vl_vinculacao,0),
		c.ds_convenio,
		d.ds_conta,
		e.ds_transacao,
		f.nr_sequencia,
		f.nr_interno_conta,
		f.nr_titulo;

