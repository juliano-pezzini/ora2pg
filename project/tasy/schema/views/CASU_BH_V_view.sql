-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW casu_bh_v (cd_convenio, nr_seq_protocolo, nr_interno_conta, cd_tipo_registro, cd_cgc_cpf_prestador, dt_mesano_pagto, nm_prestador, nr_guia, cd_usuario_convenio, cd_cgc_cpf_executor, dt_atendimento, ie_dhe, cd_cid, vl_guia, qt_urc, nm_usuario_convenio, nm_medico, cd_procedimento, qt_procedimento, qt_atendimento, vl_total) AS SELECT	cd_convenio,
		nr_seq_protocolo,
		0 nr_interno_conta,
		0 cd_tipo_registro,
		cd_cgc_hospital cd_cgc_cpf_prestador,
		dt_remessa dt_mesano_pagto,
		nm_hospital nm_prestador,
		'0000000' nr_guia,
		'' cd_usuario_convenio,
		'' cd_cgc_cpf_executor,
		LOCALTIMESTAMP dt_atendimento,
		0 ie_dhe,
		'' cd_cid,
		0 vl_guia,
		0 qt_urc,
		'' nm_usuario_convenio,
		'' nm_medico,
		0 cd_procedimento,
		0 qt_procedimento,
		0 qt_atendimento,
		0 vl_total
FROM  	w_interf_conta_header a

union all

SELECT	a.cd_convenio,
		a.nr_seq_protocolo,
		a.nr_interno_conta,
		1 cd_tipo_registro,
		'' cd_cgc_cpf_prestador,
		LOCALTIMESTAMP dt_mesano_pagto,
		'' nm_prestador,
		nr_doc_convenio nr_guia,
		cd_usuario_convenio cd_usuario_convenio,
		coalesce(nr_cpf_medico_resp, a.cd_cgc_hospital) cd_cgc_cpf_executor,
		dt_entrada dt_atendimento,
		0 ie_dhe,
		cd_cid_principal cd_cid,
		vl_total_conta vl_guia,
		qt_item_conta qt_urc,
		nm_paciente nm_usuario_convenio,
		nm_medico_resp nm_medico,
		0 cd_procedimento,
		0 qt_procedimento,
		0 qt_atendimento,
		0 vl_total
from		w_interf_conta_cab a,
		w_interf_conta_total b
where		a.nr_interno_conta	= b.nr_interno_conta

union all

SELECT	cd_convenio,
		nr_seq_protocolo,
		nr_interno_conta,
		2 cd_tipo_registro,
		'' cd_cgc_cpf_prestador,
		LOCALTIMESTAMP dt_mesano_pagto,
		'' nm_prestador,
		nr_doc_convenio nr_guia,
		'' cd_usuario_convenio,
		'' cd_cgc_cpf_executor,
		LOCALTIMESTAMP dt_atendimento,
		0 ie_dhe,
		'' cd_cid,
		0 vl_guia,
		0 qt_urc,
		'' nm_usuario_convenio,
		'' nm_medico,
		cd_item cd_procedimento,
		sum(qt_item) qt_procedimento,
		0 qt_atendimento,
		0 vl_total
from		w_interf_conta_item a
group by 	cd_convenio,
		nr_seq_protocolo,
		nr_interno_conta,
		nr_doc_convenio,
		cd_item

union all

SELECT	a.cd_convenio,
		a.nr_seq_protocolo,
		0,
		9 cd_tipo_registro,
		a.cd_cgc_hospital cd_cgc_cpf_prestador,
		LOCALTIMESTAMP dt_mesano_pagto,
		'' nm_prestador,
		'9999999' nr_guia,
		'' cd_usuario_convenio,
		'' cd_cgc_cpf_executor,
		LOCALTIMESTAMP dt_atendimento,
		0 ie_dhe,
		'' cd_cid,
		0 vl_guia,
		0 qt_urc,
		'' nm_usuario_convenio,
		'' nm_medico,
		0 cd_procedimento,
		0 qt_procedimento,
		count(*) qt_atendimento,
		sum(vl_total_conta) vl_total
from		w_interf_conta_cab a,
		w_interf_conta_total b
where		a.nr_interno_conta	= b.nr_interno_conta
group by 	a.cd_convenio,
		a.nr_seq_protocolo,
		a.cd_cgc_hospital;

