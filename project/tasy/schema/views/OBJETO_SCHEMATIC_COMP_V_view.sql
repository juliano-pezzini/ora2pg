-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW objeto_schematic_comp_v (nr_sequencia, nr_seq_dic_objeto, ds_tabela, nr_seq_funcao_schematic, tree_node, nr_seq_obj_schem_param, cd_funcao, nr_seq_apres, nm_tabela, nr_seq_visao, nr_seq_obj_parent_nav, ie_tipo_componente, nr_seq_obj_sup, ie_popup_handle) AS SELECT 	a.nr_sequencia,
	a.nr_seq_dic_objeto,
	CASE WHEN a.ie_tipo_componente='WF' THEN obter_desc_expressao(315075) WHEN a.ie_tipo_componente='WCP' THEN coalesce(obter_desc_expressao(b.cd_exp_texto),b.NM_OBJETO) END  ds_tabela,
	a.nr_seq_funcao_schematic,
	CASE WHEN a.ie_tipo_componente='WCP' THEN 345988 WHEN a.ie_tipo_componente='WF' THEN 345989 WHEN a.ie_tipo_componente='WPOPUP' THEN 346040  ELSE 346201 END  TREE_NODE,
	0 NR_SEQ_OBJ_SCHEM_PARAM,
	a.cd_funcao,
	a.nr_seq_apres,
	'' nm_tabela,
	0 nr_seq_visao,
	schematic_obter_parent_nav(a.nr_sequencia) nr_seq_obj_parent_nav,
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle
FROM    objeto_schematic a,
	dic_objeto b
where 	a.nr_seq_dic_objeto = b.nr_sequencia
and 	coalesce(SCHEMATIC_SE_PARENT_WDLG(a.nr_sequencia),'N') = 'N'
and	a.ie_tipo_componente in ('WF','WCP')

union

select	max(a.nr_sequencia),
	max(a.nr_sequencia) nr_seq_dic_objeto,
	CASE WHEN ie_tipo_componente='BD' THEN obter_desc_expressao(714162) WHEN ie_tipo_componente='WQ' THEN obter_desc_expressao(290084) END  ds_tabela,
	a.nr_seq_funcao_schematic,
	CASE WHEN ie_tipo_componente='BD' THEN 346040  ELSE 346201 END  TREE_NODE,
	0 NR_SEQ_OBJ_SCHEM_PARAM,
	a.cd_funcao,
	min(a.nr_seq_apres) nr_seq_apres,
	'' nm_tabela,
	0 nr_seq_visao,
	schematic_obter_parent_nav(a.nr_sequencia) nr_seq_obj_parent_nav,
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle
FROM    objeto_schematic a
where 	a.ie_tipo_componente 	in ('BD','WQ')
and	exists (select 	1
		from 	objeto_schematic x
		where	x.nr_seq_obj_sup 	= a.nr_sequencia
		and	x.ie_tipo_componente 	= 'WPOPUP')
group by obter_desc_expressao(714162),
	a.nr_seq_funcao_schematic,
	a.cd_funcao,
	schematic_obter_parent_nav(a.nr_sequencia),
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle

union

select	max(a.nr_sequencia),
	max(a.nr_sequencia) nr_seq_dic_objeto,
	CASE WHEN a.IE_POPUP_HANDLE='S' THEN obter_desc_expressao(725646)  ELSE obter_desc_expressao(725642) END  ds_tabela,
	a.nr_seq_funcao_schematic,
	346040 TREE_NODE,
	0 NR_SEQ_OBJ_SCHEM_PARAM,
	a.cd_funcao,
	min(a.nr_seq_apres) nr_seq_apres,
	'' nm_tabela,
	0 nr_seq_visao,
	schematic_obter_parent_nav(a.nr_sequencia) nr_seq_obj_parent_nav,
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle
FROM    objeto_schematic a
where 	a.nr_seq_dic_objeto IS NOT NULL
and 	exists (select 1 from dic_objeto x where x.nr_sequencia = a.nr_seq_dic_objeto)
and	a.ie_tipo_componente 	= 'WPOPUP'
group by CASE WHEN a.IE_POPUP_HANDLE='S' THEN obter_desc_expressao(725646)  ELSE obter_desc_expressao(725642) END ,
	a.nr_seq_funcao_schematic,
	a.cd_funcao,
	schematic_obter_parent_nav(a.nr_sequencia),
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle

union all

SELECT 	a.nr_sequencia,
	coalesce(a.nr_seq_dic_objeto,schematic_obter_parent_nav(a.nr_sequencia)) nr_seq_dic_objeto,
	coalesce(obter_desc_expressao(283242),obter_desc_expressao(314523)) ds_tabela,
	a.nr_seq_funcao_schematic,
	0 TREE_NODE,
	0 NR_SEQ_OBJ_SCHEM_PARAM,
	a.cd_funcao,
	a.nr_seq_apres,
	'' nm_tabela,
	0 nr_seq_visao,
	schematic_obter_parent_nav(a.nr_sequencia) nr_seq_obj_parent_nav,
	a.ie_tipo_componente,
	a.nr_seq_obj_sup,
	a.ie_popup_handle
FROM    objeto_schematic a
where 	coalesce(SCHEMATIC_SE_PARENT_WDLG(a.nr_sequencia),'N') = 'N'
and	a.ie_tipo_componente = 'WCLD';

