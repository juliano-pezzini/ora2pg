-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW processo_aprov_compra_pend_v (nr_sequencia, nr_seq_proc_aprov, dt_liberacao, ie_aprov_reprov, dt_atualizacao, nm_usuario, ie_urgencia, nm_usuario_parecer, nm_usuario_solic_parecer, dt_solic_parecer, dt_resp_parecer, cd_pessoa_fisica, cd_cargo, dt_definicao, ie_motivo_reprovacao, ds_observacao, cd_cargo_enc, nm_usuario_aprov, ie_automatico, cd_estabelecimento, ie_origem_doc, ie_tipo_documento, ie_origem, nr_documento) AS select	a.nr_sequencia,
	a.nr_seq_proc_aprov,
	a.dt_liberacao,
	a.ie_aprov_reprov,
	a.dt_atualizacao,
	a.nm_usuario,
	coalesce(c.ie_urgente,'N') ie_urgencia,
	a.nm_usuario_parecer,
	a.nm_usuario_solic_parecer,
	a.dt_solic_parecer,
	a.dt_resp_parecer,
	a.cd_pessoa_fisica,
	a.cd_cargo,
	a.dt_definicao,
	a.ie_motivo_reprovacao,
	a.ds_observacao,
	a.cd_cargo_enc,
	a.nm_usuario_aprov,
	a.ie_automatico,
	c.cd_estabelecimento,
	'O' ie_origem_doc,
	'OC' ie_tipo_documento,
	wheb_mensagem_pck.get_Texto(301426) ie_origem, /*'Ordem Compra'*/
	c.nr_ordem_compra nr_documento
FROM	ordem_compra c,
	ordem_compra_item b,
	processo_aprov_compra a
where	a.nr_sequencia = b.nr_seq_aprovacao
and	c.nr_ordem_compra = b.nr_ordem_compra
and	a.ie_aprov_reprov = 'P'

union all

select	a.nr_sequencia,
	a.nr_seq_proc_aprov,
	a.dt_liberacao,
	a.ie_aprov_reprov,
	a.dt_atualizacao,
	a.nm_usuario,
	coalesce(c.ie_urgente,'N') ie_urgencia,
	a.nm_usuario_parecer,
	a.nm_usuario_solic_parecer,
	a.dt_solic_parecer,
	a.dt_resp_parecer,
	a.cd_pessoa_fisica,
	a.cd_cargo,
	a.dt_definicao,
	a.ie_motivo_reprovacao,
	a.ds_observacao,
	a.cd_cargo_enc,
	a.nm_usuario_aprov,
	a.ie_automatico,
	c.cd_estabelecimento,
	'S' ie_origem_doc,
	coalesce(c.ie_tipo_servico,'SC') ie_tipo_documento,
	CASE WHEN c.ie_tipo_servico='CD' THEN wheb_mensagem_pck.get_Texto(301427) WHEN c.ie_tipo_servico=/*'Contratos diretos'*/			'SN' THEN wheb_mensagem_pck.get_Texto(301430) WHEN c.ie_tipo_servico=/*'Serv./Mat. a serem negociados'*/			'SP' THEN wheb_mensagem_pck.get_Texto(301432) WHEN c.ie_tipo_servico=/*'Solicitação pagamento'*/			'SR' THEN wheb_mensagem_pck.get_Texto(301433) WHEN c.ie_tipo_servico=/*'Serv./Mat. já prestados/comprados'*/			'SI' THEN wheb_mensagem_pck.get_Texto(693990)  ELSE /*'Solicitação de investimento'*/			wheb_mensagem_pck.get_Texto(693996) END  ie_origem, /*'Solicitação compra'*/
	c.nr_solic_compra nr_documento
from	solic_compra c,
	solic_compra_item b,
	processo_aprov_compra a
where	a.nr_sequencia = b.nr_seq_aprovacao
and	c.nr_solic_compra = b.nr_solic_compra
and	a.ie_aprov_reprov = 'P'

union all

select	a.nr_sequencia,
	a.nr_seq_proc_aprov,
	a.dt_liberacao,
	a.ie_aprov_reprov,
	a.dt_atualizacao,
	a.nm_usuario,
	'' ie_urgencia,
	a.nm_usuario_parecer,
	a.nm_usuario_solic_parecer,
	a.dt_solic_parecer,
	a.dt_resp_parecer,
	a.cd_pessoa_fisica,
	a.cd_cargo,
	a.dt_definicao,
	a.ie_motivo_reprovacao,
	a.ds_observacao,
	a.cd_cargo_enc,
	a.nm_usuario_aprov,
	a.ie_automatico,
	c.cd_estabelecimento,
	'C' ie_origem_doc,
	'CC' ie_tipo_documento,
	wheb_mensagem_pck.get_Texto(693997) ie_origem, /*'Cotação de Compra'*/
	c.nr_cot_compra nr_documento
from	cot_compra c,
	cot_compra_item b,
	processo_aprov_compra a
where	a.nr_sequencia = b.nr_seq_aprovacao
and	c.nr_cot_compra = b.nr_cot_compra
and	a.ie_aprov_reprov = 'P'

union all

select	a.nr_sequencia,
	a.nr_seq_proc_aprov,
	a.dt_liberacao,
	a.ie_aprov_reprov,
	a.dt_atualizacao,
	a.nm_usuario,
	coalesce(c.ie_urgente,'N') ie_urgencia,
	a.nm_usuario_parecer,
	a.nm_usuario_solic_parecer,
	a.dt_solic_parecer,
	a.dt_resp_parecer,
	a.cd_pessoa_fisica,
	a.cd_cargo,
	a.dt_definicao,
	a.ie_motivo_reprovacao,
	a.ds_observacao,
	a.cd_cargo_enc,
	a.nm_usuario_aprov,
	a.ie_automatico,
	c.cd_estabelecimento,
	'R' ie_origem_doc,
	'RM' ie_tipo_documento,
	wheb_mensagem_pck.get_Texto(301422) ie_origem, /*'Requisição Materiais'*/
	c.nr_requisicao nr_documento
from	requisicao_material c,
	item_requisicao_material b,
	processo_aprov_compra a
where	a.nr_sequencia = b.nr_seq_aprovacao
and	c.nr_requisicao = b.nr_requisicao
and	a.ie_aprov_reprov = 'P'

union all

select	a.nr_sequencia,
	a.nr_seq_proc_aprov,
	a.dt_liberacao,
	a.ie_aprov_reprov,
	a.dt_atualizacao,
	a.nm_usuario,
	'' ie_urgencia,
	a.nm_usuario_parecer,
	a.nm_usuario_solic_parecer,
	a.dt_solic_parecer,
	a.dt_resp_parecer,
	a.cd_pessoa_fisica,
	a.cd_cargo,
	a.dt_definicao,
	a.ie_motivo_reprovacao,
	a.ds_observacao,
	a.cd_cargo_enc,
	a.nm_usuario_aprov,
	a.ie_automatico,
	c.cd_estabelecimento,
	'N' ie_origem_doc,
	'NF' ie_tipo_documento,
	wheb_mensagem_pck.get_Texto(301421) ie_origem, /*'Nota Fiscal' */
	c.nr_sequencia nr_documento
from	nota_fiscal c,
	nota_fiscal_item b,
	processo_aprov_compra a
where	a.nr_sequencia = b.nr_seq_aprovacao
and	c.nr_sequencia = b.nr_sequencia
and	a.ie_aprov_reprov = 'P';

