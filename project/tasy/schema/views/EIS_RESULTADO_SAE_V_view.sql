-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_resultado_sae_v (nr_atendimento, cd_pessoa_fisica, cd_medico_resp, ie_tipo_atendimento, ie_clinica, dt_entrada, dt_alta, cd_motivo_alta, cd_procedencia, ie_tipo_convenio, cd_estabelecimento, cd_convenio, cd_categoria, cd_plano_convenio, ds_convenio, dt_inicio_vigencia, dt_final_vigencia, cd_setor_atendimento, cd_unidade_basica, cd_unidade_compl, ds_setor_atendimento, nr_doc_convenio, cd_usuario_convenio, cd_senha, dt_validade_carteira, nr_doc_conv_principal, nr_seq_queixa, nr_seq_classificacao, ie_tipo_atend_tiss, nr_atend_original, nr_seq_origem, dt_entrada_unidade, dt_saida_unidade, dt_saida_interno, dt_alta_medico, dt_inicio_atendimento, dt_fim_triagem, nr_seq_local_pa, dt_alta_interno, cd_classif_setor, dt_cancelamento, cd_empresa, cd_unidade, nm_usuario_troca, ie_carater_inter_sus, nr_seq_triagem, nr_seq_triagem_prioridade, cd_motivo_alta_medica, nm_usuario_alta_medica, ie_nivel_atencao, dt_prescricao, nm_prescritor, nm_paciente, ds_tipo_atendimento, ds_setor_sae, cd_setor_sae, ds_resultado, nr_seq_result, ds_item, nr_seq_item) AS select 	a.NR_ATENDIMENTO,a.CD_PESSOA_FISICA,a.CD_MEDICO_RESP,a.IE_TIPO_ATENDIMENTO,a.IE_CLINICA,a.DT_ENTRADA,a.DT_ALTA,a.CD_MOTIVO_ALTA,a.CD_PROCEDENCIA,a.IE_TIPO_CONVENIO,a.CD_ESTABELECIMENTO,a.CD_CONVENIO,a.CD_CATEGORIA,a.CD_PLANO_CONVENIO,a.DS_CONVENIO,a.DT_INICIO_VIGENCIA,a.DT_FINAL_VIGENCIA,a.CD_SETOR_ATENDIMENTO,a.CD_UNIDADE_BASICA,a.CD_UNIDADE_COMPL,a.DS_SETOR_ATENDIMENTO,a.NR_DOC_CONVENIO,a.CD_USUARIO_CONVENIO,a.CD_SENHA,a.DT_VALIDADE_CARTEIRA,a.NR_DOC_CONV_PRINCIPAL,a.NR_SEQ_QUEIXA,a.NR_SEQ_CLASSIFICACAO,a.IE_TIPO_ATEND_TISS,a.NR_ATEND_ORIGINAL,a.NR_SEQ_ORIGEM,a.DT_ENTRADA_UNIDADE,a.DT_SAIDA_UNIDADE,a.DT_SAIDA_INTERNO,a.DT_ALTA_MEDICO,a.DT_INICIO_ATENDIMENTO,a.DT_FIM_TRIAGEM,a.NR_SEQ_LOCAL_PA,a.DT_ALTA_INTERNO,a.CD_CLASSIF_SETOR,a.DT_CANCELAMENTO,a.CD_EMPRESA,a.CD_UNIDADE,a.NM_USUARIO_TROCA,a.IE_CARATER_INTER_SUS,a.NR_SEQ_TRIAGEM,a.NR_SEQ_TRIAGEM_PRIORIDADE,a.CD_MOTIVO_ALTA_MEDICA,a.NM_USUARIO_ALTA_MEDICA,a.IE_NIVEL_ATENCAO,
	trunc(b.DT_PRESCRICAO) DT_PRESCRICAO, 
	substr(obter_nome_pf(b.cd_prescritor),1,200) nm_prescritor, 
	substr(obter_nome_pf(a.cd_pessoa_fisica),1,200) nm_paciente, 
	substr(obter_valor_dominio(12,a.ie_tipo_atendimento),1,80) ds_tipo_atendimento, 
	substr(obter_nome_setor(b.cd_setor_atendimento),1,80) ds_setor_sae, 
	b.cd_setor_atendimento cd_setor_sae, 
	e.DS_RESULTADO, 
	c.nr_seq_result, 
	f.ds_item, 
	c.nr_seq_item 
FROM 	resumo_atendimento_paciente_v a, 
	pe_prescricao b, 
	pe_prescr_item_result c, 
	pe_item_resultado e, 
	pe_item_examinar f 
where 	a.nr_atendimento = b.nr_atendimento 
and 	b.nr_sequencia = c.nr_seq_prescr 
and 	c.nr_seq_result = e.nr_sequencia 
and	f.nr_sequencia	= c.nr_seq_item 
and 	b.dt_inativacao is null 
and	e.ie_indicador	= 'S';

