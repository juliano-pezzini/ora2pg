-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_guia_requisicao_v (nr_seq_requisicao, nr_seq_guia, nr_guia_req, cd_guia, nm_segurado, nm_prestador, nm_medico_solic, ds_tipo_guia, ds_estagio, ds_status, dt_autorizacao, dt_cancelamento, dt_solic, dt_requisicao, dt_solicitacao) AS select	distinct a.nr_seq_requisicao,
	1 nr_seq_guia, 
	to_char(b.nr_sequencia) nr_guia_req, 
	'' cd_guia, 
	substr(pls_obter_dados_segurado(b.nr_seq_segurado ,'N'),1,255) nm_segurado, 
	substr(pls_obter_dados_prestador(nr_seq_prestador,'N'),1,255) nm_prestador, 
	substr(obter_nome_medico(cd_medico_solicitante,'N'),1,255) nm_medico_solic, 
	substr(obter_valor_dominio(1746,b.ie_tipo_guia),1,255) ds_tipo_guia, 
	substr(obter_valor_dominio(3431,ie_estagio),1,255) ds_estagio, 
	'' ds_status, 
	'' dt_autorizacao, 
	'' dt_cancelamento,	 
	dt_requisicao dt_solic, 
	dt_requisicao, 
	null dt_solicitacao 
FROM	pls_requisicao		b, 
	pls_execucao_req_item	a 
where	nr_seq_requisicao is not null 
and	b.nr_sequencia = a.nr_seq_requisicao 

union
 
select	distinct a.nr_seq_requisicao, 
	a.nr_seq_guia, 
	'     '||b.cd_guia nr_guia_req, 
	cd_guia,	 
	'' nm_segurado, 
	substr(pls_obter_dados_prestador(nr_seq_prestador,'N'),1,255) nm_prestador, 
	substr(obter_nome_pessoa_fisica(cd_medico_solicitante, null),1,40) nm_medico_solic, 
	substr(obter_valor_dominio( 1746,b.ie_tipo_guia),1,120) ds_tipo_guia, 
	substr(obter_valor_dominio(2055,ie_estagio),1,255) ds_estagio, 
	substr(obter_valor_dominio(1747,ie_status),1,255) ds_status, 
	'' dt_autorizacao, 
	'' dt_cancelamento, 
	trunc(dt_solicitacao) dt_solict, 
	null dt_requisicao, 
	dt_solicitacao 
from	pls_guia_plano		b, 
	pls_execucao_req_item	a 
where	b.nr_sequencia = a.nr_seq_guia 
and	nr_seq_requisicao is not null 

union
 
select	nr_sequencia nr_seq_requisicao, 
	0 nr_seq_guia, 
	to_char(nr_sequencia) nr_guia_req, 
	'' cd_guia, 
	substr(pls_obter_dados_segurado(nr_seq_segurado ,'N'),1,255) nm_segurado, 
	substr(pls_obter_dados_prestador(nr_seq_prestador,'N'),1,255) nm_prestador, 
	substr(obter_nome_medico(cd_medico_solicitante,'N'),1,255) nm_medico_solic, 
	substr(obter_valor_dominio(1746,ie_tipo_guia),1,255) ds_tipo_guia, 
	substr(obter_valor_dominio(3431,ie_estagio),1,255) ds_estagio, 
	'' ds_status, 
	'' dt_autorizacao, 
	'' dt_cancelamento,	 
	dt_requisicao dt_solic, 
	dt_requisicao, 
	null dt_solicitacao 
from	pls_requisicao 
where	nr_sequencia not in ( 	select 	distinct nr_seq_requisicao 
				from	pls_execucao_req_item);

