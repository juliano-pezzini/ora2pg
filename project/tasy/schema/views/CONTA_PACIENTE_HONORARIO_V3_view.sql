-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_honorario_v3 (cd_procedimento, qt_procedimento, vl_medico, nm_medico, nr_crm, ie_responsavel_credito, ds_responsavel_credito, cd_medico, nr_cpf_medico, nr_seq_protocolo, nr_atendimento, cd_convenio, nr_sequencia) AS select	a.cd_procedimento,
	a.qt_procedimento,
	a.vl_medico,
	e.nm_pessoa_fisica nm_medico,
	g.nr_crm,
	a.ie_responsavel_credito,
	x.ds_regra ds_responsavel_credito,
	a.cd_medico_executor cd_medico,
	e.nr_cpf nr_cpf_medico,
	y.nr_seq_protocolo,
	y.nr_atendimento,
	y.cd_convenio_parametro cd_convenio,
    	a.nr_sequencia nr_sequencia
FROM conta_paciente y, pessoa_fisica e, procedimento_paciente a
LEFT OUTER JOIN medico g ON (a.cd_medico_executor = g.cd_pessoa_fisica)
LEFT OUTER JOIN regra_honorario x ON (a.ie_responsavel_credito = x.cd_regra)
WHERE a.cd_medico_executor 	= e.cd_pessoa_fisica   and a.nr_interno_conta		= y.nr_interno_conta and a.cd_motivo_exc_conta	is null

union

select	a.cd_procedimento,
	a.qt_procedimento,
	h.vl_participante,
	e.nm_pessoa_fisica nm_medico,
	g.nr_crm,
	h.ie_responsavel_credito,
	x.ds_regra ds_responsavel_credito,
	h.cd_pessoa_fisica cd_medico,
	e.nr_cpf nr_cpf_medico,
	y.nr_seq_protocolo,
	y.nr_atendimento,
	y.cd_convenio_parametro cd_convenio,
    	a.nr_sequencia nr_sequencia
FROM conta_paciente y, procedimento_paciente a, procedimento_participante h
LEFT OUTER JOIN pessoa_fisica e ON (h.cd_pessoa_fisica = e.cd_pessoa_fisica)
LEFT OUTER JOIN medico g ON (h.cd_pessoa_fisica = g.cd_pessoa_fisica)
LEFT OUTER JOIN regra_honorario x ON (h.ie_responsavel_credito = x.cd_regra)
WHERE a.nr_sequencia 		= h.nr_sequencia  and a.nr_interno_conta		= y.nr_interno_conta and a.cd_motivo_exc_conta	is null;

