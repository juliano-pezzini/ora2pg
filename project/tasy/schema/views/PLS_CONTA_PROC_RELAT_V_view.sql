-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_conta_proc_relat_v (nr_seq_conta, cd_usuario, nm_usuario, cd_guia, dt_atendimento_conta, dt_procedimento, dt_atendimento_pgto, nr_seq_cbo_saude, nr_seq_segurado, cd_procedimento, nr_seq_prestador_exec, ie_tipo_guia, cd_cbo, nr_seq_contrato) AS select	a.nr_seq_conta,
	substr(pls_obter_dados_segurado(a.nr_seq_segurado,'CR'),1,30) cd_usuario, 
	substr(pls_obter_dados_segurado(a.nr_seq_segurado,'N'),1,255) nm_usuario, 
	a.cd_guia, 
	a.dt_atendimento_conta, 
	a.dt_procedimento, 
	(select max(x.dt_competencia_pgto) FROM pls_conta_medica_resumo x where a.nr_seq_conta = x.nr_seq_conta) dt_atendimento_pgto, 
	nr_seq_cbo_saude, 
	nr_seq_segurado, 
	cd_procedimento, 
	nr_seq_prestador_exec, 
	ie_tipo_guia, 
	b.cd_cbo, 
	c.nr_seq_contrato  
FROM cbo_saude b
LEFT OUTER JOIN pls_conta_proc_v a ON (b.nr_sequencia = a.nr_seq_cbo_saude)
LEFT OUTER JOIN pls_segurado c ON (a.nr_seq_segurado = c.nr_sequencia);

