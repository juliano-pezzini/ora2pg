-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW plussoft_vidas_contrato_v (nr_contrato, cd_usuario_plano, cd_pessoa_fisica, nr_seq_parentesco, dt_nascimento, nr_seq_regra_isencao, ie_nascido_plano, nm_beneficiario) AS select a.nr_contrato,
	    c.cd_usuario_plano, 
	    b.cd_pessoa_fisica, 
	    b.nr_seq_parentesco, 
	    pls_obter_dados_segurado(b.nr_sequencia, 'NAS')	dt_nascimento, 
	    (	select	max(f.nr_seq_regra) 
			FROM	pls_carencia			e, 
				pls_regra_carencia_padrao	f, 
				pls_regra_carencia		g 
			where	e.nr_seq_segurado		= b.nr_sequencia 
			and	e.ie_cpt			<> 'S' 
			and	e.ie_origem_carencia_benef	= 'P' 
			and	f.nr_sequencia			= e.nr_seq_regra_padrao 
			and	g.nr_sequencia 			= f.nr_seq_regra	) nr_seq_regra_isencao, 
	    (	select	max(x.ie_nascido_plano) 
			from	pls_proposta_beneficiario x 
			where	x.nr_sequencia = b.nr_seq_benef_prop_adesao		) ie_nascido_plano, 
		obter_nome_pf(b.cd_pessoa_fisica) nm_beneficiario 
	from  pls_contrato a, 
	    pls_segurado b, 
	    pls_segurado_carteira c 
	where a.nr_sequencia = b.nr_seq_contrato 
	and  b.nr_sequencia = c.nr_seq_segurado 
	and (b.dt_rescisao is null 
	or   b.dt_rescisao > LOCALTIMESTAMP) 
	order by 1 asc;

