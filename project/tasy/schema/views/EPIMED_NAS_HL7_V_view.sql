-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW epimed_nas_hl7_v (client_id, last_update_timestamp, nas_date, updatetimestampfilter, unit_code, cd_multi_empresa, hospital_admission_number, delete, monitoring_titration_1, monitoring_titration_2, monitoring_titration_3, laboratory_investigations_1, laboratory_investigations_2, laboratory_investigations_3, medic_not_vasoactive_drugs_1, medic_not_vasoactive_drugs_2, medic_not_vasoactive_drugs_3, hygiene_procedures_1, hygiene_procedures_2, hygiene_procedures_3, care_drains_1, care_drains_2, care_drains_3, mobilization_positioning_1, mobilization_positioning_2, mobilization_positioning_3, supportcare_relative_patient_1, supportcare_relative_patient_2, supportcare_relative_patient_3, administrative_tasks_1, administrative_tasks_2, administrative_tasks_3, respiratory_support_1, respiratory_support_2, respiratory_support_3, care_artificial_airways_1, care_artificial_airways_2, care_artificial_airways_3, treatment_improving_lung_fnc_1, treatment_improving_lung_fnc_2, treatment_improving_lung_fnc_3, vasoactive_medication_1, vasoactive_medication_2, vasoactive_medication_3, iv_replacement_fluid_losses_1, iv_replacement_fluid_losses_2, iv_replacement_fluid_losses_3, monitoring_pac_1, monitoring_pac_2, monitoring_pac_3, cpr_in_past_24h_1, cpr_in_past_24h_2, cpr_in_past_24h_3, rrt_dialysis_techniques_1, rrt_dialysis_techniques_2, rrt_dialysis_techniques_3, urine_output_measurement_1, urine_output_measurement_2, urine_output_measurement_3, measure_intracranial_pressur_1, measure_intracranial_pressur_2, measure_intracranial_pressur_3, treatment_acidosis_alkalosis_1, treatment_acidosis_alkalosis_2, treatment_acidosis_alkalosis_3, parenteral_nutrition_1, parenteral_nutrition_2, parenteral_nutrition_3, enteral_gastric_feedinng_1, enteral_gastric_feedinng_2, enteral_gastric_feedinng_3, interventions_icu_1, interventions_icu_2, interventions_icu_3, interventions_outside_icu_1, interventions_outside_icu_2, interventions_outside_icu_3) AS SELECT a.nr_sequencia client_id,
  CASE WHEN a.IE_SITUACAO='A' THEN to_char(A.DT_ATUALIZACAO_NREC,'YYYY-MM-DD"T"HH24:MI:SS."000"')  ELSE to_char(A.DT_INATIVACAO,'YYYY-MM-DD"T"HH24:MI:SS."000"') END
  last_update_timestamp,  
  TO_CHAR(a.DT_AVALIACAO, 'YYYY-MM-DD') nas_date,
    to_date(a.dt_atualizacao) UPDATETIMESTAMPFILTER,
    OBTER_SETOR_ATENDIMENTO(a.NR_ATENDIMENTO) unit_code,
    OBTER_ESTAB_ATENDIMENTO(a.NR_ATENDIMENTO) CD_MULTI_EMPRESA,
    a.nr_atendimento hospital_admission_number,
    CASE WHEN a.IE_SITUACAO='I' THEN 1  ELSE 0 END  DELETE,
    (
    CASE
      WHEN(SELECT 1
        FROM escala_nas b
        WHERE b.nr_atendimento = a.nr_atendimento
        AND DS_ITEM_1A         = 'N'
        AND DS_ITEM_1B         = 'N'
        AND DS_ITEM_1C         = 'N'
        AND b.nr_sequencia     = a.nr_sequencia) = 1
      THEN 1
      WHEN DS_ITEM_1A = 'S'
      THEN 2
      WHEN DS_ITEM_1B = 'S'
      THEN 3
      WHEN DS_ITEM_1C = 'S'
      THEN 4
    END) MONITORING_TITRATION_1,
    NULL MONITORING_TITRATION_2,
    NULL MONITORING_TITRATION_3,
    (
    CASE
      WHEN DS_ITEM_2 = 'N'
      THEN 5
      ELSE 6
    END) LABORATORY_INVESTIGATIONS_1,
    NULL LABORATORY_INVESTIGATIONS_2,
    NULL LABORATORY_INVESTIGATIONS_3,
    (
    CASE
      WHEN DS_ITEM_3 = 'N'
      THEN 7
      ELSE 8
    END) MEDIC_NOT_VASOACTIVE_DRUGS_1,
    NULL MEDIC_NOT_VASOACTIVE_DRUGS_2,
    NULL MEDIC_NOT_VASOACTIVE_DRUGS_3,
    (
    CASE
      WHEN(SELECT 1
        FROM escala_nas b
        WHERE b.nr_atendimento = a.nr_atendimento
        AND DS_ITEM_4A         = 'N'
        AND DS_ITEM_4B         = 'N'
        AND DS_ITEM_4C         = 'N'
        AND b.nr_sequencia     = a.nr_sequencia) = 1
      THEN 9
      WHEN DS_ITEM_4A = 'S'
      THEN 10
      WHEN DS_ITEM_4B = 'S'
      THEN 11
      WHEN DS_ITEM_4C = 'S'
      THEN 12
    END) HYGIENE_PROCEDURES_1,
    NULL HYGIENE_PROCEDURES_2,
    NULL HYGIENE_PROCEDURES_3,
    (
    CASE
      WHEN DS_ITEM_5 = 'N'
      THEN 13
      ELSE 14
    END) CARE_DRAINS_1,
    NULL CARE_DRAINS_2,
    NULL CARE_DRAINS_3,
    (
    CASE
      WHEN(SELECT 1
        FROM escala_nas b
        WHERE b.nr_atendimento = a.nr_atendimento
        AND DS_ITEM_6A         = 'N'
        AND DS_ITEM_6B         = 'N'
        AND DS_ITEM_6C         = 'N'
        AND b.nr_sequencia     = a.nr_sequencia) = 1
      THEN 15
      WHEN DS_ITEM_6A = 'S'
      THEN 16
      WHEN DS_ITEM_6B = 'S'
      THEN 17
      WHEN DS_ITEM_6C = 'S'
      THEN 18
    END) MOBILIZATION_POSITIONING_1,
    NULL MOBILIZATION_POSITIONING_2,
    NULL MOBILIZATION_POSITIONING_3,
    (
    CASE
      WHEN(SELECT 1
        FROM escala_nas b
        WHERE b.nr_atendimento = a.nr_atendimento
        AND DS_ITEM_7A         = 'N'
        AND DS_ITEM_7B         = 'N'
        AND b.nr_sequencia     = a.nr_sequencia) = 1
      THEN 19
      WHEN DS_ITEM_7A = 'S'
      THEN 20
      WHEN DS_ITEM_7B = 'S'
      THEN 21
    END) SUPPORTCARE_RELATIVE_PATIENT_1,
    NULL SUPPORTCARE_RELATIVE_PATIENT_2,
    NULL SUPPORTCARE_RELATIVE_PATIENT_3,
    (
    CASE
      WHEN(SELECT 1
        FROM escala_nas b
        WHERE b.nr_atendimento = a.nr_atendimento
        AND DS_ITEM_8A         = 'N'
        AND DS_ITEM_8B         = 'N'
        AND DS_ITEM_8C         = 'N'
        AND b.nr_sequencia     = a.nr_sequencia) = 1
      THEN 22
      WHEN DS_ITEM_8A = 'S'
      THEN 23
      WHEN DS_ITEM_8B = 'S'
      THEN 24
      WHEN DS_ITEM_8C = 'S'
      THEN 25
    END) ADMINISTRATIVE_TASKS_1,
    NULL ADMINISTRATIVE_TASKS_2,
    NULL ADMINISTRATIVE_TASKS_3,
    (
    CASE
      WHEN DS_ITEM_9 = 'N'
      THEN 26
      ELSE 27
    END) RESPIRATORY_SUPPORT_1,
    NULL RESPIRATORY_SUPPORT_2,
    NULL RESPIRATORY_SUPPORT_3,
    (
    CASE
      WHEN DS_ITEM_10 = 'N'
      THEN 28
      ELSE 29
    END) CARE_ARTIFICIAL_AIRWAYS_1,
    NULL CARE_ARTIFICIAL_AIRWAYS_2,
    NULL CARE_ARTIFICIAL_AIRWAYS_3,
    (
    CASE
      WHEN DS_ITEM_11 = 'N'
      THEN 30
      ELSE 31
    END) TREATMENT_IMPROVING_LUNG_FNC_1,
    NULL TREATMENT_IMPROVING_LUNG_FNC_2,
    NULL TREATMENT_IMPROVING_LUNG_FNC_3,
    (
    CASE
      WHEN DS_ITEM_12 = 'N'
      THEN 32
      ELSE 33
    END) VASOACTIVE_MEDICATION_1,
    NULL VASOACTIVE_MEDICATION_2,
    NULL VASOACTIVE_MEDICATION_3,
    (
    CASE
      WHEN DS_ITEM_13 = 'N'
      THEN 34
      ELSE 35
    END) IV_REPLACEMENT_FLUID_LOSSES_1,
    NULL IV_REPLACEMENT_FLUID_LOSSES_2,
    NULL IV_REPLACEMENT_FLUID_LOSSES_3,
    (
    CASE
      WHEN DS_ITEM_14 = 'N'
      THEN 36
      ELSE 37
    END) MONITORING_PAC_1,
    NULL MONITORING_PAC_2,
    NULL MONITORING_PAC_3,
    (
    CASE
      WHEN DS_ITEM_15 = 'N'
      THEN 38
      ELSE 39
    END) CPR_IN_PAST_24H_1,
    NULL CPR_IN_PAST_24H_2,
    NULL CPR_IN_PAST_24H_3,
    (
    CASE
      WHEN DS_ITEM_16 = 'N'
      THEN 40
      ELSE 41
    END) RRT_DIALYSIS_TECHNIQUES_1,
    NULL RRT_DIALYSIS_TECHNIQUES_2,
    NULL RRT_DIALYSIS_TECHNIQUES_3,
    (
    CASE
      WHEN DS_ITEM_17 = 'N'
      THEN 42
      ELSE 43
    END) URINE_OUTPUT_MEASUREMENT_1,
    NULL URINE_OUTPUT_MEASUREMENT_2,
    NULL URINE_OUTPUT_MEASUREMENT_3,
    (
    CASE
      WHEN DS_ITEM_18 = 'N'
      THEN 44
      ELSE 45
    END) MEASURE_INTRACRANIAL_PRESSUR_1,
    NULL MEASURE_INTRACRANIAL_PRESSUR_2,
    NULL MEASURE_INTRACRANIAL_PRESSUR_3,
    (
    CASE
      WHEN DS_ITEM_19 = 'N'
      THEN 46
      ELSE 47
    END)TREATMENT_ACIDOSIS_ALKALOSIS_1,
    NULL TREATMENT_ACIDOSIS_ALKALOSIS_2,
    NULL TREATMENT_ACIDOSIS_ALKALOSIS_3,
    (
    CASE
      WHEN DS_ITEM_20 = 'N'
      THEN 48
      ELSE 49
    END)PARENTERAL_NUTRITION_1,
    NULL PARENTERAL_NUTRITION_2,
    NULL PARENTERAL_NUTRITION_3,
    (
    CASE
      WHEN DS_ITEM_21 = 'N'
      THEN 50
      ELSE 51
    END)ENTERAL_GASTRIC_FEEDINNG_1,
    NULL ENTERAL_GASTRIC_FEEDINNG_2,
    NULL ENTERAL_GASTRIC_FEEDINNG_3,
    (
    CASE
      WHEN DS_ITEM_22 = 'N'
      THEN 52
      ELSE 53
    END)INTERVENTIONS_ICU_1,
    NULL INTERVENTIONS_ICU_2,
    NULL INTERVENTIONS_ICU_3,
    (
    CASE
      WHEN DS_ITEM_23 = 'N'
      THEN 54
      ELSE 55
    END)INTERVENTIONS_OUTSIDE_ICU_1,
    NULL INTERVENTIONS_OUTSIDE_ICU_2,
    NULL INTERVENTIONS_OUTSIDE_ICU_3
  FROM escala_nas a
  WHERE A.DT_LIBERACAO IS NOT NULL
  AND obter_setor_atual_paciente(a.NR_ATENDIMENTO) IN (SELECT cd_setor_atendimento
    FROM SETOR_ATENDIMENTO
    WHERE IE_EPIMED = 'S'
    AND ie_situacao = 'A'
    )
  ORDER BY 2 DESC;

