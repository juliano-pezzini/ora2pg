-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW encontro_contas_titulos_v (ie_ordem, ie_receber_pagar, ds_titulo, nr_titulo, nr_documento, dt_emissao, dt_vencimento, vl_titulo, vl_saldo_titulo, nr_sequencia, vl_saldo_juros, vl_saldo_multa, vl_glosa_ap, vl_glosa, vl_desconto, vl_imposto, vl_glosa_tit, nr_seq_pessoa, vl_despesa, vl_total, vl_outros_acrescimos, vl_recebido, vl_receber, vl_baixa_enc_contas, vl_informado) AS select	1 ie_ordem,
	'R' ie_receber_pagar, 
	'A receber' ds_titulo, 
	null nr_titulo, 
	null nr_documento, 
	null dt_emissao, 
	null dt_vencimento, 
	null vl_titulo, 
	null vl_saldo_titulo, 
	null nr_sequencia, 
	null vl_saldo_juros, 
	null vl_saldo_multa, 
	null vl_glosa_ap, 
	null vl_glosa, 
	null vl_desconto, 
	null vl_imposto, 
	null vl_glosa_tit, 
	0 nr_seq_pessoa, 
	null vl_despesa, 
	null vl_total, 
	null vl_outros_acrescimos, 
	null vl_recebido, 
	null vl_receber, 
	0 vl_baixa_enc_contas, 
	null vl_informado 
 

union all
 
select	2 ie_ordem, 
	'R' ie_receber_pagar, 
	'     ' || a.nr_titulo_receber ds_titulo, 
	a.nr_titulo_receber nr_titulo, 
	b.nr_documento, 
	b.dt_emissao, 
	b.dt_pagamento_previsto dt_vencimento, 
	b.vl_titulo, 
	b.vl_saldo_titulo, 
	nr_sequencia, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','J') vl_saldo_juros, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','M') vl_saldo_multa, 
	coalesce(obter_valores_tit_rec(b.nr_titulo,'GP'),0) vl_glosa_ap, 
	coalesce(obter_valores_tit_rec(b.nr_titulo,'GA'),0) vl_glosa, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','DC') vl_desconto, 
	coalesce(obter_valores_tit_rec(b.nr_titulo,'I'),0) vl_imposto, 
	coalesce(obter_valores_tit_rec(b.nr_titulo,'VG'),0) vl_glosa_tit, 
	a.nr_seq_pessoa, 
	0 vl_despesa, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','VT') vl_total, 
	0 vl_outros_acrescimos, 
	coalesce(obter_valores_tit_rec(b.nr_titulo,'R'),0) vl_recebido, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','RP') vl_receber, 
	coalesce(obter_valor_ec_tit_rec(a.nr_seq_pessoa,b.nr_titulo),0) vl_baixa_enc_contas, 
	a.vl_informado 
from	titulo_receber b, 
	encontro_contas_item a 
where	a.nr_titulo_receber	= b.nr_titulo 
group by a.nr_seq_pessoa, 
	a.nr_titulo_receber, 
	b.nr_documento, 
	b.dt_emissao, 
	b.dt_pagamento_previsto, 
	b.vl_titulo, 
	b.vl_saldo_titulo, 
	a.nr_sequencia, 
	b.nr_titulo, 
	a.vl_juros, 
	a.vl_multa, 
	a.vl_informado	 

union all
 
select	3 ie_ordem, 
	'R' ie_receber_pagar, 
	'     Total' ds_titulo, 
	null nr_titulo, 
	null nr_documento, 
	null dt_emissao, 
	null dt_vencimento, 
	sum(b.vl_titulo) vl_titulo, 
	sum(b.vl_saldo_titulo) vl_saldo_titulo, 
	null nr_sequencia, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','J')) vl_saldo_juros, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','M')) vl_saldo_multa, 
	sum(coalesce(obter_valores_tit_rec(b.nr_titulo,'GP'),0)) vl_glosa_ap, 
	sum(coalesce(obter_valores_tit_rec(b.nr_titulo,'GA'),0)) vl_glosa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','DC')) vl_desconto, 
	sum(coalesce(obter_valores_tit_rec(b.nr_titulo,'I'),0)) vl_imposto, 
	sum(coalesce(obter_valores_tit_rec(b.nr_titulo,'VG'),0)) vl_glosa_tit, 
	a.nr_seq_pessoa, 
	0 vl_despesa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','VT')) vl_total, 
	0 vl_outros_acrescimos, 
	sum(coalesce(obter_valores_tit_rec(b.nr_titulo,'R'),0)) vl_recebido, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'R','RP')) vl_receber, 
	sum(coalesce(obter_valor_ec_tit_rec(a.nr_seq_pessoa,b.nr_titulo),0)) vl_baixa_enc_contas, 
	sum(a.vl_informado) 
from	titulo_receber b, 
	encontro_contas_item a 
where	a.nr_titulo_receber	= b.nr_titulo 
group by a.nr_seq_pessoa 
having	sum(b.vl_titulo) > 0 

union all
 
select	4 ie_ordem, 
	'P' ie_receber_pagar, 
	'A pagar' ds_titulo, 
	null nr_titulo, 
	null nr_documento, 
	null dt_emissao, 
	null dt_vencimento, 
	null vl_titulo, 
	null vl_saldo_titulo, 
	null nr_sequencia, 
	null vl_saldo_juros, 
	null vl_saldo_multa, 
	null vl_glosa_ap, 
	null vl_glosa, 
	null vl_desconto, 
	null vl_imposto, 
	null vl_glosa_tit, 
	0 nr_seq_pessoa, 
	null vl_despesa, 
	null vl_total, 
	null vl_outros_acrescimos, 
	null vl_recebido, 
	null vl_receber, 
	0 vl_baixa_enc_contas, 
	null vl_informado 
 

union all
 
select	5 ie_ordem, 
	'P' ie_receber_pagar, 
	'     ' || a.nr_titulo_pagar ds_titulo, 
	a.nr_titulo_pagar nr_titulo, 
	b.nr_documento, 
	b.dt_emissao, 
	b.dt_vencimento_atual dt_vencimento, 
	b.vl_titulo, 
	b.vl_saldo_titulo, 
	nr_sequencia, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','J') vl_saldo_juros, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','M') vl_saldo_multa, 
	coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'GP'),0) vl_glosa_ap, 
	coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'GA'),0) vl_glosa, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','DC') vl_desconto, 
	coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'VT'),0) vl_imposto, 
	coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'VG'),0) vl_glosa_tit, 
	a.nr_seq_pessoa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','DB')) vl_despesa, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','VT') vl_total, 
	b.vl_outros_acrescimos, 
	coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'B'),0) vl_recebido, 
	obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','RP') vl_receber, 
	coalesce(obter_valor_ec_tit_pag(a.nr_seq_pessoa,b.nr_titulo),0) vl_baixa_enc_contas, 
	a.vl_informado 
from	titulo_pagar b, 
	encontro_contas_item a 
where	a.nr_titulo_pagar	= b.nr_titulo 
group by a.nr_seq_pessoa, 
	a.nr_titulo_pagar, 
	b.nr_documento, 
	b.dt_emissao, 
	b.dt_vencimento_atual, 
	b.vl_titulo, 
	b.vl_saldo_titulo, 
	a.nr_sequencia, 
	b.nr_titulo, 
	a.vl_juros, 
	a.vl_multa, 
	b.vl_dia_antecipacao, 
	b.vl_outros_acrescimos, 
	a.vl_informado 

union all
 
select	6 ie_ordem, 
	'P' ie_receber_pagar, 
	'     Total' ds_titulo, 
	null nr_titulo, 
	null nr_documento, 
	null dt_emissao, 
	null dt_vencimento, 
	sum(b.vl_titulo) vl_titulo, 
	sum(b.vl_saldo_titulo) vl_saldo_titulo, 
	null nr_sequencia, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','J')) vl_saldo_juros, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','M')) vl_saldo_multa, 
	sum(coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'GP'),0)) vl_glosa_ap, 
	sum(coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'GA'),0)) vl_glosa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','DC')) vl_desconto, 
	sum(coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'VT'),0)) vl_imposto, 
	sum(coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'VG'),0)) vl_glosa_tit, 
	a.nr_seq_pessoa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','DB')) vl_despesa, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','VT')) vl_total, 
	sum(b.vl_outros_acrescimos) vl_outros_acrescimos, 
	sum(coalesce(obter_valores_tit_pagar(b.nr_titulo,LOCALTIMESTAMP,'B'),0)) vl_recebido, 
	sum(obter_valores_encontro_contas(b.nr_titulo, a.nr_seq_pessoa, LOCALTIMESTAMP,'P','RP')) vl_receber, 
	sum(coalesce(obter_valor_ec_tit_pag(a.nr_seq_pessoa,b.nr_titulo),0)) vl_baixa_enc_contas, 
	sum(a.vl_informado) 
from	titulo_pagar b, 
	encontro_contas_item a 
where	a.nr_titulo_pagar	= b.nr_titulo 
group by a.nr_seq_pessoa 
having	sum(b.vl_titulo) > 0 
order by ie_ordem,nr_titulo;

