-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_demonst_pagamento_glosa_v (nr_documento, dt_emissao, nm_beneficiario, cd_usuario_plano, nr_quantidade, cd_procedimento, ds_descricao, ds_atividade, nr_opm, vl_glosa, nr_seq_evento, nr_seq_protocolo, nr_seq_prestador_pgto, cd_pessoa_fisica, ie_tipo_item, nr_seq_prestador_exec, nr_seq_lote_pgto, nr_seq_pag_item, vl_taxas, vl_apresentado, nr_seq_resumo, nr_seq_conta, qt_procedimento, qt_procedimento_imp, nr_seq_conta_proc) AS select	nr_documento,
	dt_emissao, 
	nm_beneficiario, 
	cd_usuario_plano, 
	nr_quantidade, 
	cd_procedimento, 
	ds_descricao, 
	ds_atividade, 
	nr_opm, 
	vl_glosa, 
	nr_seq_evento, 
	nr_seq_protocolo, 
	nr_seq_prestador_pgto, 
	cd_pessoa_fisica, 
	ie_tipo_item, 
	nr_seq_prestador_exec, 
	nr_seq_lote_pgto, 
	nr_seq_pag_item, 
	vl_taxas, 
	vl_apresentado, 
	nr_sequencia nr_seq_resumo, 
	nr_seq_conta, 
	qt_procedimento, 
	qt_procedimento_imp, 
	nr_seq_conta_proc 
FROM (select	a.cd_guia nr_documento, 
		to_char(a.dt_emissao, 'dd/mm/yyyy') dt_emissao, 
		substr(pls_obter_dados_segurado(a.nr_seq_segurado,'N'),1,50) nm_beneficiario, 
		substr(pls_obter_dados_segurado(a.nr_seq_segurado,'CR'),1,30) cd_usuario_plano, 
		coalesce(b.qt_procedimento_imp,0) - coalesce(b.qt_procedimento,0) nr_quantidade, 
		b.qt_procedimento, 
		b.qt_procedimento_imp, 
		to_char(b.cd_procedimento) cd_procedimento, 
		substr(obter_descricao_procedimento(b.cd_procedimento,b.ie_origem_proced),1,45) ds_descricao, 
		'' ds_atividade, 
		null nr_opm, 
		coalesce(c.vl_glosa,0) vl_glosa, 
		coalesce(c.vl_liberado,0) vl_liberado, 
		c.nr_seq_evento, 
		c.nr_seq_protocolo, 
		c.nr_seq_prestador_pgto, 
		c.cd_pessoa_fisica, 
		c.ie_tipo_item, 
		c.nr_seq_prestador_exec, 
		c.nr_seq_lote_pgto, 
		c.nr_seq_pag_item, 
		coalesce(c.vl_taxa_adm,0) + coalesce(c.vl_taxa_adm_co,0) + coalesce(c.vl_taxa_adm_mat,0) vl_taxas, 
		b.ie_tipo_despesa, 
		c.vl_apresentado, 
		c.nr_sequencia, 
		a.nr_sequencia nr_seq_conta, 
		c.vl_anestesista, 
		c.vl_auxiliares, 
		b.nr_sequencia nr_seq_conta_proc 
	from	pls_conta 		a, 
		pls_conta_proc 		b, 
		pls_conta_medica_resumo c 
	where	a.nr_sequencia		= b.nr_seq_conta 
	and	c.nr_seq_conta  	= a.nr_sequencia 
	and	c.nr_seq_conta_proc	= b.nr_sequencia 
	and	c.nr_seq_pag_item is not null 
	and	c.nr_seq_lote_pgto is not null 
	and	c.nr_seq_prestador_pgto is not null 
	and	c.ie_tipo_item <> 'I' 
	and 	c.vl_glosa > 0 
	
union
 
	select	a.cd_guia nr_documento, 
		to_char(a.dt_emissao, 'dd/mm/yyyy') dt_emissao, 
		substr(pls_obter_dados_segurado(a.nr_seq_segurado,'N'),1,50) nm_beneficiario, 
		substr(pls_obter_dados_segurado(a.nr_seq_segurado,'CR'),1,30) cd_usuario_plano, 
		coalesce(b.qt_material_imp,0) - coalesce(b.qt_material,0) nr_quantidade, 
		b.qt_material, 
		b.qt_material_imp, 
		substr(pls_obter_dados_material(b.nr_seq_material, 'CO'),1,40) cd_procedimento, 
		substr(pls_obter_dados_material(b.nr_seq_material,'DS'),1,45) ds_descricao, 
		'' ds_atividade, 
		b.nr_nota_fiscal nr_opm, 
		coalesce(c.vl_glosa,0) vl_glosa, 
		coalesce(c.vl_liberado, 0) vl_liberado, 
		c.nr_seq_evento, 
		c.nr_seq_protocolo, 
		c.nr_seq_prestador_pgto, 
		c.cd_pessoa_fisica, 
		c.ie_tipo_item, 
		c.nr_seq_prestador_exec, 
		c.nr_seq_lote_pgto, 
		c.nr_seq_pag_item, 
		coalesce(c.vl_taxa_adm_pag, 0) vl_taxas, 
		b.ie_tipo_despesa, 
		c.vl_apresentado, 
		c.nr_sequencia, 
		a.nr_sequencia nr_seq_conta, 
		c.vl_anestesista, 
		c.vl_auxiliares, 
		null nr_seq_conta_proc 
	from	pls_conta	a, 
		pls_conta_mat	b, 
		pls_conta_medica_resumo c 
	where	a.nr_sequencia = b.nr_seq_conta 
	and	c.nr_seq_conta = a.nr_sequencia 
	and	c.nr_seq_conta_mat 	= b.nr_sequencia 
	and	c.nr_seq_pag_item is not null 
	and	c.nr_seq_lote_pgto is not null 
	and	c.nr_seq_prestador_pgto is not null 
	and	c.ie_tipo_item <> 'I' 
	and 	c.vl_glosa > 0) alias29;

