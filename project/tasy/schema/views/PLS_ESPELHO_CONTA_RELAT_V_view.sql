-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_espelho_conta_relat_v (ie_union, cd_guia, cd_usuario_plano, nm_segurado, cd_doenca, nr_seq_lote_fat, nr_seq_segurado, dt_mes_competencia, nr_seq_protocolo, nr_seq_conta, nr_seq_fatura, ie_tipo_despesa, nr_seq_prestador_exec, dt_item, cd_item, ie_origem_proced, ds_item, qt_liberada, vl_material_ptu, vl_unitario, tx_prestador_item, vl_liberado, nr_seq_clinica, nr_seq_tipo_acomodacao, nr_seq_pagador, cd_cooperativa, nr_seq_regra_fat, dt_mesano_referencia, cd_medico_solicitante, tx_item) AS select	'1' ie_union,
	f.cd_guia_ok cd_guia,
	h.cd_usuario_plano,
	substr(i.nm_pessoa_fisica,1,40) nm_segurado,
	k.cd_doenca,
	a.nr_sequencia nr_seq_lote_fat,
	g.nr_sequencia nr_seq_segurado,
	b.dt_mes_competencia,
	b.nr_sequencia nr_seq_protocolo,
	f.nr_sequencia nr_seq_conta,
	c.nr_sequencia  nr_seq_fatura,
	l.ie_tipo_despesa,
	f.nr_seq_prestador_exec,
	l.dt_procedimento dt_item,
	l.cd_procedimento cd_item,
	l.ie_origem_proced,
	substr(m.ds_procedimento, 1, 240) ds_item,
	coalesce(l.qt_procedimento, 0) qt_liberada,
	coalesce(l.vl_material_ptu, 0) vl_material_ptu,
	coalesce(l.vl_unitario, 0) vl_unitario,
	coalesce(l.tx_prestador_item, 0) tx_prestador_item,
	l.vl_liberado,
	f.nr_seq_clinica,
	f.nr_seq_tipo_acomodacao,
	c.nr_seq_pagador,
	n.cd_cooperativa,
	a.nr_seq_regra_fat,
	a.dt_mesano_referencia,
	f.cd_medico_solicitante,
	l.tx_item
FROM procedimento m, pls_conta_proc l, pessoa_fisica i, pls_segurado_carteira h, pls_segurado g, pls_fatura_conta e, pls_fatura_evento d, pls_protocolo_conta b, pls_lote_faturamento a, pls_conta f
LEFT OUTER JOIN pls_diagnostico_conta k ON (f.nr_sequencia = k.nr_seq_conta)
, pls_fatura c
LEFT OUTER JOIN pls_congenere n ON (c.nr_seq_congenere = n.nr_sequencia)
WHERE f.nr_sequencia 		= e.nr_seq_conta and d.nr_sequencia 		= e.nr_seq_fatura_evento and c.nr_sequencia 		= d.nr_seq_fatura and b.nr_sequencia 		= f.nr_seq_protocolo and a.nr_sequencia 		= c.nr_seq_lote and g.nr_sequencia 		= f.nr_seq_segurado and g.nr_sequencia 		= h.nr_seq_segurado and i.cd_pessoa_fisica 	= g.cd_pessoa_fisica  and f.nr_sequencia		= l.nr_seq_conta and l.cd_procedimento	= m.cd_procedimento and l.ie_origem_proced	= m.ie_origem_proced  and f.cd_guia_ok is not null

union all

select	'2' ie_union,
	f.cd_guia_ok cd_guia,
	h.cd_usuario_plano,
	substr(i.nm_pessoa_fisica,1,40) nm_segurado,
	k.cd_doenca,
	a.nr_sequencia nr_seq_lote_fat,
	g.nr_sequencia nr_seq_segurado,
	b.dt_mes_competencia,
	b.nr_sequencia nr_seq_protocolo,
	f.nr_sequencia nr_seq_conta,
	c.nr_sequencia  nr_seq_fatura,
	l.ie_tipo_despesa,
	f.nr_seq_prestador_exec,
	l.dt_atendimento dt_item,
	m.nr_sequencia cd_item,
	null ie_origem_proced,
	substr(m.ds_material, 1, 240) ds_item,
	coalesce(l.qt_material, 0) qt_liberada,
	coalesce(l.vl_material_ptu, 0) vl_material_ptu,
	coalesce(l.vl_unitario, 0) vl_unitario,
	0 tx_prestador_item,
	l.vl_liberado,
	f.nr_seq_clinica,
	f.nr_seq_tipo_acomodacao,
	c.nr_seq_pagador,
	n.cd_cooperativa,
	a.nr_seq_regra_fat,
	a.dt_mesano_referencia,
	f.cd_medico_solicitante,
	null tx_item
FROM pls_material m, pls_conta_mat l, pessoa_fisica i, pls_segurado_carteira h, pls_segurado g, pls_fatura_conta e, pls_fatura_evento d, pls_protocolo_conta b, pls_lote_faturamento a, pls_conta f
LEFT OUTER JOIN pls_diagnostico_conta k ON (f.nr_sequencia = k.nr_seq_conta)
, pls_fatura c
LEFT OUTER JOIN pls_congenere n ON (c.nr_seq_congenere = n.nr_sequencia)
WHERE f.nr_sequencia 		= e.nr_seq_conta and d.nr_sequencia 		= e.nr_seq_fatura_evento and c.nr_sequencia 		= d.nr_seq_fatura and b.nr_sequencia 		= f.nr_seq_protocolo and a.nr_sequencia 		= c.nr_seq_lote and g.nr_sequencia 		= f.nr_seq_segurado and g.nr_sequencia 		= h.nr_seq_segurado and i.cd_pessoa_fisica 	= g.cd_pessoa_fisica  and f.nr_sequencia		= l.nr_seq_conta and m.nr_sequencia		= l.nr_seq_material  and f.cd_guia_ok is not null;

