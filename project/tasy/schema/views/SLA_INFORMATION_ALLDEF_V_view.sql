-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW sla_information_alldef_v (ie_indicador, ds_indicador, so_number, status_sla_response, philips_classification, customer_classification, philips_severity, customer_severity, so_sla, sla_id, qt_target, customer, sla_description, sla_resolution_remaining, sla_response_remaining, actual_stage, sla_detail, develop_management_id, develop_management, extract_date, sla_resolution_breached, sla_response_breached, develop_group, sla_detail_start, sla_detail_finish) AS Select  '1' ie_indicador,
	'OPENED_DEFECTS' ds_indicador,
	nr_seq_ordem so_number,
	sla_dashboard_pck.obter_status_resp(nr_seq_ordem) status_sla_response,
	a.ie_classificacao philips_classification,
	d.ie_classificacao_cliente customer_classification,
	a.ie_prioridade philips_severity,
	d.ie_prioridade_cliente customer_severity,
	'S' so_sla,
	nr_seq_sla sla_id,
	coalesce((100 - e.pr_desvio), 100) qt_target, 
	d.nr_seq_localizacao customer, --customer
	e.ds_titulo sla_description,
	sla_dashboard_pck.obter_min_solucao(d.nr_sequencia) sla_resolution_remaining,
	sla_dashboard_pck.obter_min_primeiro_atend(d.nr_sequencia) sla_response_remaining,
	man_obter_desc_estagio_trad(d.nr_seq_estagio, null, 'D') actual_stage,
	sla_dashboard_pck.obter_detalhe_sla_all_def(coalesce(ie_tipo_sla, 3), coalesce(ie_tipo_sla_termino,3)) sla_detail,--sla_detail,
	obter_gerencia_resp_os(nr_seq_ordem) develop_management_id,
	obter_descricao_gerencia(obter_gerencia_resp_os(nr_seq_ordem)) develop_management,
	d.dt_ordem_servico extract_date,
	qt_desvio sla_resolution_breached,
	qt_desvio_inic sla_response_breached,
	obter_desc_grupo_desenv(nr_seq_grupo_des) develop_group,
	ie_tipo_sla sla_detail_start,
	ie_tipo_sla_termino sla_detail_finish
FROM    man_ordem_serv_sla a,
        man_ordem_servico d,
	man_sla e
where   d.nr_sequencia = a.nr_seq_ordem
and	e.nr_sequencia = a.nr_seq_sla
and   (((coalesce(ie_tipo_sla, 3) = 3) and (coalesce(ie_tipo_sla_termino, 3) = 3)) or (coalesce(ie_tipo_sla,3) = 3 or   coalesce(ie_tipo_sla_termino,3) = 3))
and   obter_gerencia_resp_os(nr_seq_ordem) <> 68 
and	d.dt_ordem_servico > to_date('01/08/2020','dd/mm/yyyy')
and  	d.nr_seq_localizacao <> 6675

union

Select  '2' ie_indicador,
	'RECLASSIFIED_DEFECTS' ds_indicador,
	nr_seq_ordem so_number, 
	sla_dashboard_pck.obter_status_resp(nr_seq_ordem) status_sla_response,
	a.ie_classificacao philips_classification,
	d.ie_classificacao_cliente customer_classification,
	a.ie_prioridade philips_severity,
	d.ie_prioridade_cliente customer_severity,
	'S' so_sla,
	nr_seq_sla sla_id,
	coalesce((100 - e.pr_desvio), 100) qt_target, 
	d.nr_seq_localizacao customer, --customer
	e.ds_titulo sla_description,
	sla_dashboard_pck.obter_min_solucao(d.nr_sequencia) sla_resolution_remaining,
	sla_dashboard_pck.obter_min_primeiro_atend(d.nr_sequencia) sla_response_remaining,
	man_obter_desc_estagio_trad(d.nr_seq_estagio, null, 'D') actual_stage,
	sla_dashboard_pck.obter_detalhe_sla_all_def(coalesce(ie_tipo_sla, 3), coalesce(ie_tipo_sla_termino,3)) sla_detail,--sla_detail,
	obter_gerencia_resp_os(nr_seq_ordem) develop_management_id,
	obter_descricao_gerencia(obter_gerencia_resp_os(nr_seq_ordem)) develop_management,
	d.dt_ordem_servico extract_date,
	qt_desvio sla_resolution_breached,
	qt_desvio_inic sla_response_breached,
	obter_desc_grupo_desenv(nr_seq_grupo_des) develop_group,
	ie_tipo_sla sla_detail_start,
	ie_tipo_sla_termino sla_detail_finish
from    man_ordem_serv_sla a,
        man_ordem_servico d,
	man_sla e
where   d.nr_sequencia = a.nr_seq_ordem
and	e.nr_sequencia = a.nr_seq_sla
and   (((coalesce(ie_tipo_sla, 3) = 3) and (coalesce(ie_tipo_sla_termino, 3) = 3)) or (coalesce(ie_tipo_sla,3) = 3 or   coalesce(ie_tipo_sla_termino,3) = 3))
and   qt_desvio_inic = 1
and	d.ie_classificacao <> d.ie_classificacao_cliente
and   obter_gerencia_resp_os(nr_seq_ordem) <> 68 
and	d.dt_ordem_servico > to_date('01/08/2020','dd/mm/yyyy')
and  	d.nr_seq_localizacao <> 6675

union
 
Select '3' ie_indicador,
	'RESPONSE_BREACHED' ds_indicador,
	nr_seq_ordem so_number, 
	sla_dashboard_pck.obter_status_resp(nr_seq_ordem) status_sla_response,
	a.ie_classificacao philips_classification,
	d.ie_classificacao_cliente customer_classification,
	a.ie_prioridade philips_severity,
	d.ie_prioridade_cliente customer_severity,
	'S' so_sla,
	nr_seq_sla sla_id,
	coalesce((100 - e.pr_desvio), 100) qt_target, 
	d.nr_seq_localizacao customer, --customer
	e.ds_titulo sla_description,
	sla_dashboard_pck.obter_min_solucao(d.nr_sequencia) sla_resolution_remaining,
	sla_dashboard_pck.obter_min_primeiro_atend(d.nr_sequencia) sla_response_remaining,
	man_obter_desc_estagio_trad(d.nr_seq_estagio, null, 'D') actual_stage,
	sla_dashboard_pck.obter_detalhe_sla_all_def(coalesce(ie_tipo_sla, 3), coalesce(ie_tipo_sla_termino,3)) sla_detail,--sla_detail,
	obter_gerencia_resp_os(nr_seq_ordem) develop_management_id,
	obter_descricao_gerencia(obter_gerencia_resp_os(nr_seq_ordem)) develop_management,
	d.dt_ordem_servico extract_date,
	qt_desvio sla_resolution_breached,
	qt_desvio_inic sla_response_breached,
	obter_desc_grupo_desenv(nr_seq_grupo_des) develop_group,
	ie_tipo_sla sla_detail_start,
	ie_tipo_sla_termino sla_detail_finish
from    man_ordem_serv_sla a,
        man_ordem_servico d,
	man_sla e
where   d.nr_sequencia = a.nr_seq_ordem
and	e.nr_sequencia = a.nr_seq_sla
and   coalesce(ie_tipo_sla, 3) = 3
and   qt_desvio_inic = 1
and   obter_gerencia_resp_os(nr_seq_ordem) <> 68
and	not exists (	select	1 
			from	man_ordem_serv_sla_abonada x
			where	a.nr_seq_ordem = x.nr_seq_ordem_servico
			and	x.ie_tipo_abono in ('A','R'))
and  exists (   select 1
		from     man_sla_evento e
		where   e.nr_seq_ordem = d.nr_sequencia
		and     e.ie_tipo_evento = 8
		and     trunc(e.dt_atualizacao, 'mm') = trunc(a.dt_inicio_sla, 'mm'))
and	d.dt_ordem_servico > to_date('01/08/2020','dd/mm/yyyy')
and  	d.nr_seq_localizacao <> 6675

union

Select  '4' ie_indicador,
	'RESOLUTION_BREACHED' ds_indicador,
	nr_seq_ordem so_number, 
	sla_dashboard_pck.obter_status_resp(nr_seq_ordem) status_sla_response,
	a.ie_classificacao philips_classification,
	d.ie_classificacao_cliente customer_classification,
	a.ie_prioridade philips_severity,
	d.ie_prioridade_cliente customer_severity,
	'S' so_sla,
	nr_seq_sla sla_id,
	coalesce((100 - e.pr_desvio), 100) qt_target, 
	d.nr_seq_localizacao customer, --customer
	e.ds_titulo sla_description,
	sla_dashboard_pck.obter_min_solucao(d.nr_sequencia) sla_resolution_remaining,
	sla_dashboard_pck.obter_min_primeiro_atend(d.nr_sequencia) sla_response_remaining,
	man_obter_desc_estagio_trad(d.nr_seq_estagio, null, 'D') actual_stage,
	sla_dashboard_pck.obter_detalhe_sla_all_def(coalesce(ie_tipo_sla, 3), coalesce(ie_tipo_sla_termino,3)) sla_detail,--sla_detail,
	obter_gerencia_resp_os(nr_seq_ordem) develop_management_id,
	obter_descricao_gerencia(obter_gerencia_resp_os(nr_seq_ordem)) develop_management,
	d.dt_ordem_servico extract_date,
	qt_desvio sla_resolution_breached,
	qt_desvio_inic sla_response_breached,
	obter_desc_grupo_desenv(nr_seq_grupo_des) develop_group,
	ie_tipo_sla sla_detail_start,
	ie_tipo_sla_termino sla_detail_finish
from    man_ordem_serv_sla a,
        man_ordem_servico d,
	man_sla e
where   d.nr_sequencia = a.nr_seq_ordem
and	e.nr_sequencia = a.nr_seq_sla
and   coalesce(ie_tipo_sla_termino, 3) = 3
and   qt_desvio = 1
and   obter_gerencia_resp_os(nr_seq_ordem) <> 68
and	not exists (	select	1 
			from	man_ordem_serv_sla_abonada x
			where	a.nr_seq_ordem = x.nr_seq_ordem_servico
			and	x.ie_tipo_abono in ('A','S'))
and  exists (   select 1
		from     man_sla_evento e
		where   e.nr_seq_ordem = d.nr_sequencia
		and     e.ie_tipo_evento = 9
		and     trunc(e.dt_atualizacao, 'mm') = trunc(a.dt_inicio_sla, 'mm'))
and	d.dt_ordem_servico > to_date('01/08/2020','dd/mm/yyyy')
and  	d.nr_seq_localizacao <> 6675
order by	1;

