-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW w_eis_evolucao_esas_v (dt_avaliacao, ate, st, ds_setor_atendimento, se, ds_sexo, fa, dp, ds_pontuacao, cd_estabelecimento, ds_estabelecimento, ti, ds_atendimento) AS select distinct
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Dor' dp,		 
	SUBSTR(('Intensidade '||a.ie_dor),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
FROM	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Cansaço' dp, 
	SUBSTR(('Intensidade '||a.ie_cansaco),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Náusea' dp, 
	SUBSTR(('Intensidade '||a.ie_nausea),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Depressão' dp, 
	SUBSTR(('Intensidade '||a.ie_depressao),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Ansiedade' dp, 
	SUBSTR(('Intensidade '||a.ie_ansiedade),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
		 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Sonolência' dp, 
	SUBSTR(('Intensidade '||a.ie_sonolencia),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
		 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Inapetência' dp, 
	SUBSTR(('Intensidade '||a.ie_bom_apetite),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
		 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Mal-estar' dp, 
	SUBSTR(('Intensidade '||a.ie_sensacao_bem_estar),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2) 

union
		 
select distinct 
	a.dt_avaliacao, 
	a.nr_Atendimento Ate, 
	b.cd_setor_atendimento st, 
	obter_nome_setor(b.cd_setor_atendimento) ds_setor_atendimento, 
	c.ie_sexo se, 
	obter_valor_dominio(4,c.ie_sexo) ds_sexo,	 
	SUBSTR(obter_idade(c.dt_nascimento,coalesce(c.dt_obito,LOCALTIMESTAMP),'E'),1,10) fa, 
	'Falta de ar' dp, 
	SUBSTR(('Intensidade '||a.ie_falta_ar),1,255) ds_pontuacao, 
	b.cd_estabelecimento, 
	obter_nome_estabelecimento(b.cd_estabelecimento) ds_estabelecimento,	 
	b.ie_tipo_atendimento ti, 
	SUBSTR(obter_valor_dominio(12,b.ie_tipo_atendimento),1,255) ds_atendimento 
from	escala_edmonton a, 
	resumo_atendimento_paciente_v b, 
	pessoa_fisica c 
where	a.nr_atendimento = b.nr_atendimento 
and	b.cd_pessoa_fisica = c.cd_pessoa_fisica 
and	a.dt_inativacao is null 
and	((	select	count(*) 
		from	escala_edmonton x, 
			atendimento_paciente y 
		where	x.nr_atendimento = y.nr_atendimento 
		and	x.nr_atendimento = a.nr_atendimento 
		and	trunc(x.dt_avaliacao) = trunc(a.dt_avaliacao)) >= 2);

