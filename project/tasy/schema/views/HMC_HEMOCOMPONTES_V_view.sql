-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW hmc_hemocompontes_v (nr_prescricao, nr_agrupamento, qt_procedimento, ds_hr, ds_lado, ds_observacao, nr_sequencia, cd_intervalo, nr_seq_exame, dt_prev_execucao, ds_material_exame, ds_procedimento, ds_prescricao, ds_formato, nr_atendimento, dt_inicio_prescr, dt_validade_prescr) AS select a.nr_prescricao,a.nr_agrupamento,CASE WHEN a.qt_procedimento=1 THEN  null  ELSE a.qt_procedimento END  qt_procedimento,
substr(HMC_Obter_Horario_Imp_Presc(a.nr_prescricao,a.nr_sequencia,'P') ,1,255) ds_hr,substr(obter_valor_dominio(1372,a.ie_lado),1,10) ds_lado, 
a.ds_observacao,a.nr_sequencia,a.cd_intervalo,a.nr_seq_exame,to_char(a.dt_prev_execucao, 'dd hh24:mi') dt_prev_execucao, 
substr(coalesce(a.ds_material_especial,obter_desc_material_exame_lab(cd_material_exame)),1,60) ds_material_exame, 
substr(Obter_desc_san_derivado(a.nr_seq_derivado),1,50) ds_procedimento, 
i.ds_prescricao,substr(CASE WHEN a.ie_aliquotado='S' THEN 'Aliquotado'  ELSE CASE WHEN a.ie_filtrado='S' THEN 'Filtrado'  ELSE CASE WHEN a.ie_irradiado='S' THEN 'Irradiado'  ELSE CASE WHEN a.ie_lavado='S' THEN 'Lavado'  ELSE '' END  END  END  END ,1,50) ds_formato 
,c.nr_atendimento,c.dt_inicio_prescr,c.dt_validade_prescr 
FROM prescr_medica c, procedimento b, prescr_procedimento a
LEFT OUTER JOIN intervalo_prescricao i ON (a.cd_intervalo = i.cd_intervalo)
WHERE a.cd_procedimento = b.cd_procedimento and a.ie_origem_proced = b.ie_origem_proced  and a.nr_seq_origem is null and a.nr_prescricao	= c.nr_prescricao and Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'BSST') <> 'S' and Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'AT') <> 'S' and Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'BS') <> 'S' and a.nr_seq_prescr_mat is null and a.nr_seq_solic_sangue is not null and a.nr_seq_prescr_sol is null 
 
union
 
select a.nr_prescricao,a.nr_agrupamento,CASE WHEN a.qt_procedimento=1 THEN  null  ELSE a.qt_procedimento END  qt_procedimento, 
substr(HMC_Obter_Horario_Imp_Presc(a.nr_prescricao,a.nr_sequencia,'P') ,1,255) ds_hr,substr(obter_valor_dominio(1372,a.ie_lado),1,10) ds_lado, 
a.ds_observacao,a.nr_sequencia,a.cd_intervalo,a.nr_seq_exame,to_char(a.dt_prev_execucao, 'dd hh24:mi') dt_prev_execucao, 
substr(coalesce(a.ds_material_especial,obter_desc_material_exame_lab(cd_material_exame)),1,60) ds_material_exame, 
substr(Obter_desc_san_exame(a.nr_seq_exame_sangue),1,100) ds_procedimento, 
i.ds_prescricao,substr(CASE WHEN a.ie_aliquotado='S' THEN 'Aliquotado'  ELSE CASE WHEN a.ie_filtrado='S' THEN 'Filtrado'  ELSE CASE WHEN a.ie_irradiado='S' THEN 'Irradiado'  ELSE CASE WHEN a.ie_lavado='S' THEN 'Lavado'  ELSE '' END  END  END  END ,1,50) ds_formato 
,c.nr_atendimento,c.dt_inicio_prescr,c.dt_validade_prescr 
FROM prescr_medica c, procedimento b, prescr_procedimento a
LEFT OUTER JOIN intervalo_prescricao i ON (a.cd_intervalo = i.cd_intervalo)
WHERE a.cd_procedimento = b.cd_procedimento and a.ie_origem_proced = b.ie_origem_proced  and a.nr_prescricao	= c.nr_prescricao and a.nr_seq_solic_sangue is not null and Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'BSST') = 'S' and a.nr_seq_origem is null and a.nr_seq_prescr_mat is null and a.nr_seq_prescr_sol is null 
 
union
 
select a.nr_prescricao,a.nr_agrupamento,CASE WHEN a.qt_procedimento=1 THEN  null  ELSE a.qt_procedimento END  qt_procedimento, 
substr(HMC_Obter_Horario_Imp_Presc(a.nr_prescricao,a.nr_sequencia,'P') ,1,255) ds_hr, 
substr(obter_valor_dominio(1372,a.ie_lado),1,10) ds_lado,a.ds_observacao,a.nr_sequencia,a.cd_intervalo,a.nr_seq_exame, 
to_char(a.dt_prev_execucao, 'dd hh24:mi') dt_prev_execucao,substr(coalesce(a.ds_material_especial,obter_desc_material_exame_lab(cd_material_exame)),1,60) ds_material_exame, 
substr(Obter_Desc_Prescr_Proc(a.cd_procedimento,a.ie_origem_proced,a.nr_seq_proc_interno),1,240) ds_procedimento, 
i.ds_prescricao,substr(CASE WHEN a.ie_aliquotado='S' THEN 'Aliquotado'  ELSE CASE WHEN a.ie_filtrado='S' THEN 'Filtrado'  ELSE CASE WHEN a.ie_irradiado='S' THEN 'Irradiado'  ELSE CASE WHEN a.ie_lavado='S' THEN 'Lavado'  ELSE '' END  END  END  END ,1,50) ds_formato 
,c.nr_atendimento,c.dt_inicio_prescr,c.dt_validade_prescr 
FROM prescr_medica c, procedimento b, prescr_procedimento a
LEFT OUTER JOIN intervalo_prescricao i ON (a.cd_intervalo = i.cd_intervalo)
WHERE a.cd_procedimento = b.cd_procedimento and a.ie_origem_proced = b.ie_origem_proced and a.nr_prescricao	= c.nr_prescricao  and a.nr_seq_solic_sangue is not null and (Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'AT') = 'S' or Obter_se_exibe_proced(a.nr_prescricao,a.nr_sequencia,a.ie_tipo_proced,'BS') = 'S') and a.nr_seq_origem is null and a.nr_seq_prescr_mat is null and a.nr_seq_prescr_sol is null order by	2;

