-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW conta_paciente_valor_v (ie_proc_mat, nr_sequencia, vl_item, vl_medico, vl_anestesista, vl_filme, vl_auxiliares, vl_custo_operacional, nr_interno_conta, tp_item, cd_motivo_exc_conta, nr_seq_proc_pacote, vl_original) AS select 1 ie_proc_mat,
	a.nr_sequencia,
	coalesce(a.vl_procedimento,0)      vl_item,
	coalesce(a.vl_medico,0)            vl_medico,
	coalesce(a.vl_anestesista,0)       vl_anestesista,
	coalesce(a.vl_materiais,0)         vl_filme,
	coalesce(a.vl_auxiliares,0)        vl_auxiliares,
	coalesce(a.vl_custo_operacional,0) vl_custo_operacional,
	a.nr_interno_conta,
	c.ie_classificacao     tp_item          /* 1-amb  2-servicos 3-diarias */
,
	a.cd_motivo_exc_conta,
	a.nr_seq_proc_pacote,
	coalesce(g.vl_procedimento, 0) vl_original
FROM procedimento c, procedimento_paciente a, (a
LEFT OUTER JOIN proc_paciente_valor g ON (a.nr_sequencia = g.nr_seq_procedimento AND 1 = g.ie_tipo_valor)
WHERE (a.cd_procedimento       = c.cd_procedimento) and (a.ie_origem_proced      = c.ie_origem_proced)   and (a.nr_interno_conta	 is not null)

union all

select	2 ie_proc_mat,
	x.nr_sequencia,
	x.vl_material          vl_item,
	0                      vl_medico,
	0                      vl_anestesista,
	0                      vl_filme,
	0                      vl_auxiliares,
	0                      vl_custo_operacional,
	x.nr_interno_conta,
	CASE WHEN w.ie_tipo_material=1 THEN '1' WHEN w.ie_tipo_material=2 THEN '2' WHEN w.ie_tipo_material=3 THEN '2'  ELSE '5' END      tp_item        /* 1-material 2-med.generico 3-med.comerc. */
,
	x.cd_motivo_exc_conta,
	x.nr_seq_proc_pacote,
	coalesce(x.vl_tabela_original, 0)
from	material w,
	material_atend_paciente x
where (x.cd_material           = w.cd_material)
and (x.nr_interno_conta	 is not null);

