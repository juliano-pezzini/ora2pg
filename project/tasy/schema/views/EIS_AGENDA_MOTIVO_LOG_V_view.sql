-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW eis_agenda_motivo_log_v (cd_tipo_agenda, ds_tipo_agenda, dt_referencia, dt_agenda, cd_convenio, ds_convenio, cd_procedimento, ie_origem_proced, ds_tipo_convenio, ds_cod_proced, nr_seq_motivo, qt_total, ds_motivo, nm_usuario) AS select		cd_tipo_agenda,
		obter_valor_dominio(34, cd_tipo_agenda) ds_tipo_agenda, 
		dt_acao dt_referencia, 
		dt_agenda_origem dt_agenda, 
		cd_convenio, 
		obter_nome_convenio(cd_convenio) ds_convenio, 
		cd_procedimento, 
		ie_origem_proced, 
		substr(obter_valor_dominio(11, obter_tipo_convenio(cd_convenio)),1,100) ds_tipo_convenio, 
		cd_procedimento||' - '||substr(obter_descricao_procedimento(cd_procedimento,ie_origem_proced),1,50) ds_cod_proced, 
		nr_seq_motivo, 
		count(*) qt_total, 
		ds_motivo, 
		a.nm_usuario 
FROM		agenda_motivo b, 
		agenda_motivo_log a, 
		agenda c 
where 		a.nr_seq_motivo	= 	b.nr_sequencia 
and		a.cd_agenda	=	c.cd_agenda 
group		by dt_acao, 
		dt_agenda_origem, 
		cd_convenio, 
		obter_nome_convenio(cd_convenio), 
		cd_procedimento, 
		ie_origem_proced, 
		nr_seq_motivo, 
		ds_motivo, 
		cd_tipo_agenda, 
		obter_valor_dominio(34, cd_tipo_agenda), 
		a.nm_usuario;

