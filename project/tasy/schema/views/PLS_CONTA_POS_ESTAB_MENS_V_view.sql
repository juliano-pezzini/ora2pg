-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

CREATE OR REPLACE VIEW pls_conta_pos_estab_mens_v (nr_contrato, dt_contrato, dt_rescisao, ie_tipo_contratacao, ie_segmentacao, ie_preco, ie_regulamentacao, nr_protocolo_ans, dt_inicio_cobertura, dt_fim_cobertura, cd_beneficiario, nm_usuario_principal, cd_cpf_cnpj, nr_titulo, dt_emissao, nr_parcela, dt_vencimento, cd_conta_credito, cd_conta_debito, cd_conta_contabil_ppcng, cd_classif_debito, vl_mensalidade, vl_provisao, dt_mesano_referencia, dt_geracao, dt_cancelamento, nr_seq_segurado, ie_tipo_segurado, vl_titulo, nr_seq_item_mens, ie_cancelamento, cd_estabelecimento, ie_tipo_item, nr_seq_pagador, vl_item, nr_seq_conta, ie_situacao, vl_antecipacao, dt_liquidacao, dt_contratacao, nr_seq_congenere, dt_ref_repasse, dt_mes_competencia) AS select	t.nr_contrato,
	t.dt_contrato,
	t.dt_rescisao_contrato dt_rescisao,
	n.ie_tipo_contratacao,
	n.ie_segmentacao,
	n.ie_preco,
	n.ie_regulamentacao,
	CASE WHEN n.ie_tipo_operacao='A' THEN  'SCA'  ELSE coalesce(n.nr_protocolo_ans, n.cd_scpa) END  nr_protocolo_ans,
	a.dt_inicio_cobertura,
	a.dt_fim_cobertura,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'C'),1,30) cd_beneficiario,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'N'),1,255) nm_usuario_principal,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'CPF'),1,255) cd_cpf_cnpj,
	e.nr_titulo,
	e.dt_emissao,
	substr(pls_obter_parcela_contrato(t.nr_sequencia,l.dt_mesano_referencia),1,10) nr_parcela,
	e.dt_vencimento,
	o.cd_conta_credito,
	o.cd_conta_debito,
	i.cd_conta_contabil_ppcng,
	o.cd_classif_debito,
	m.vl_mensalidade,
	o.vl_provisao,
	l.dt_mesano_referencia,
	l.dt_geracao,
	m.dt_cancelamento,
	s.nr_sequencia nr_seq_segurado,
	c.ie_tipo_segurado,
	e.vl_titulo,
	i.nr_sequencia nr_seq_item_mens,
	m.ie_cancelamento,
	t.cd_estabelecimento,
	i.ie_tipo_item,
	m.nr_seq_pagador,
	d.vl_item,
	c.nr_sequencia nr_seq_conta,
	e.ie_situacao,
	i.vl_antecipacao,
	e.dt_liquidacao,
	s.dt_contratacao,
	x.nr_seq_congenere,
	r.dt_procedimento dt_ref_repasse,
	x.dt_mes_competencia
FROM pls_protocolo_conta x, pls_contrato t, pls_segurado s, pls_conta_proc r, pls_conta_pos_proc o, pls_plano n, pls_lote_mensalidade l, pls_mensalidade_seg_item i, pls_mensalidade_item_conta d, pls_conta c, pls_mensalidade_segurado a, pls_mensalidade m
LEFT OUTER JOIN titulo_receber e ON (m.nr_sequencia = e.nr_seq_mensalidade)
WHERE l.nr_sequencia		= m.nr_seq_lote and m.nr_sequencia		= a.nr_seq_mensalidade and a.nr_sequencia		= i.nr_seq_mensalidade_seg and i.nr_sequencia		= d.nr_seq_item and o.nr_sequencia		= d.nr_seq_pos_proc and x.nr_sequencia		= c.nr_seq_protocolo and c.nr_sequencia		= o.nr_seq_conta and r.nr_sequencia		= o.nr_seq_conta_proc and s.nr_sequencia		= a.nr_seq_segurado and t.nr_sequencia		= s.nr_seq_contrato and n.nr_sequencia		= a.nr_seq_plano
union all

select	t.nr_contrato,
	t.dt_contrato,
	t.dt_rescisao_contrato dt_rescisao,
	n.ie_tipo_contratacao,
	n.ie_segmentacao,
	n.ie_preco,
	n.ie_regulamentacao,
	CASE WHEN n.ie_tipo_operacao='A' THEN  'SCA'  ELSE coalesce(n.nr_protocolo_ans, n.cd_scpa) END  nr_protocolo_ans,
	a.dt_inicio_cobertura,
	a.dt_fim_cobertura,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'C'),1,30) cd_beneficiario,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'N'),1,255) nm_usuario_principal,
	substr(pls_obter_dados_segurado(s.nr_sequencia,'CPF'),1,255) cd_cpf_cnpj,
	e.nr_titulo,
	e.dt_emissao,
	substr(pls_obter_parcela_contrato(t.nr_sequencia,l.dt_mesano_referencia),1,10) nr_parcela,
	e.dt_vencimento,
	o.cd_conta_credito,
	o.cd_conta_debito,
	i.cd_conta_contabil_ppcng,
	o.cd_classif_debito,
	m.vl_mensalidade,
	o.vl_provisao,
	l.dt_mesano_referencia,
	l.dt_geracao,
	m.dt_cancelamento,
	s.nr_sequencia nr_seq_segurado,
	c.ie_tipo_segurado,
	e.vl_titulo,
	i.nr_sequencia nr_seq_item_mens,
	m.ie_cancelamento,
	t.cd_estabelecimento,
	i.ie_tipo_item,
	m.nr_seq_pagador,
	d.vl_item,
	c.nr_sequencia nr_seq_conta,
	e.ie_situacao,
	i.vl_antecipacao,
	e.dt_liquidacao,
	s.dt_contratacao,
	x.nr_seq_congenere,
	r.dt_atendimento dt_ref_repasse,
	x.dt_mes_competencia
FROM pls_protocolo_conta x, pls_contrato t, pls_segurado s, pls_conta_mat r, pls_conta_pos_mat o, pls_plano n, pls_lote_mensalidade l, pls_mensalidade_seg_item i, pls_mensalidade_item_conta d, pls_conta c, pls_mensalidade_segurado a, pls_mensalidade m
LEFT OUTER JOIN titulo_receber e ON (m.nr_sequencia = e.nr_seq_mensalidade)
WHERE l.nr_sequencia		= m.nr_seq_lote and m.nr_sequencia		= a.nr_seq_mensalidade and a.nr_sequencia		= i.nr_seq_mensalidade_seg and i.nr_sequencia		= d.nr_seq_item and o.nr_sequencia		= d.nr_seq_pos_mat and x.nr_sequencia		= c.nr_seq_protocolo and c.nr_sequencia		= o.nr_seq_conta and r.nr_sequencia		= o.nr_seq_conta_mat and s.nr_sequencia		= a.nr_seq_segurado and t.nr_sequencia		= s.nr_seq_contrato and n.nr_sequencia		= a.nr_seq_plano;

