-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE gerar_agreg_nursing_shift_pck.gerar_agreg_nursing_empl_inf () AS $body$
DECLARE


        nr_sequencia_w          bigint;
        dt_atualizacao_w        timestamp;
        nm_usuario_w            varchar(15);
        dt_atualizacao_nrec_w   timestamp;
        nm_usuario_nrec_w       varchar(15);
        cd_job_w                varchar(4);
        cd_pessoa_fisica_w      varchar(15);
        c01 CURSOR FOR
        SELECT
            nr_sequencia,
            dt_atualizacao,
            cd_pessoa_fisica,
            dt_atualizacao_nrec,
            nm_usuario_nrec,
            cd_job
        FROM
            nurse_shift_user;


BEGIN
        --DELETE FROM agreg_nursing_empl_inf;
        OPEN c01;
        LOOP
            FETCH c01 INTO
                nr_sequencia_w,
                dt_atualizacao_w,
                cd_pessoa_fisica_w,
                dt_atualizacao_nrec_w,
                nm_usuario_nrec_w,
                cd_job_w;
            EXIT WHEN NOT FOUND; /* apply on c01 */

            delete from agreg_nrs_empl_shift_daily where nr_seq_nurse_shift = nr_sequencia_w;
            delete from agreg_nursing_empl_inf where nr_sequencia = nr_sequencia_w;

            /*SELECT
                substr(nm_pessoa_fisica, 1, 60)
            INTO nm_usuario_w
            FROM
                TABLE ( search_names_dev(NULL, TO_NUMBER(cd_pessoa_fisica_w), NULL, NULL, NULL, NULL) );*/
            INSERT INTO agreg_nursing_empl_inf(
                nr_sequencia,
                dt_atualizacao,
                nm_usuario,
                dt_atualizacao_nrec,
                nm_usuario_nrec,
                nr_seq_main_daily_rep,
                nr_seq_master_shift,
                nr_seq_nurse_shift,
                ie_main_flag,
                cd_job
            ) VALUES (
                nr_sequencia_w,
                clock_timestamp(),
                nm_usuario_nrec_w,
                clock_timestamp(),
                nm_usuario_nrec_w,
                127,
                3,
                nr_sequencia_w,
                '#',
                coalesce(cd_job_w, 0001)
            );

        END LOOP;

        CLOSE c01;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_agreg_nursing_shift_pck.gerar_agreg_nursing_empl_inf () FROM PUBLIC;
