-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/*Include Day*/

CREATE OR REPLACE PROCEDURE gerar_agreg_nursing_shift_pck.gerar_agreg_nrs_empl_daily () AS $body$
DECLARE


        nr_sequencia_w 			bigint;
        dt_atualizacao_w 		timestamp;
        nm_usuario_w			varchar(15);
        dt_atualizacao_nrec_w	timestamp;
        nm_usuario_nrec_w		varchar(15);
        cd_staff_id_w			varchar(8);
        cd_job_w				varchar(6);
        cd_work_code_w			varchar(6);
        dt_work_w				timestamp;
        dt_month_year_w			timestamp;
        nr_seq_master_shift_w	bigint;
        nr_seq_nurse_shift_w	bigint;
        c01 CURSOR FOR

        SELECT
            nr_sequencia , 
            to_char(to_date(dt_atualizacao), 'DD/MM/YYYY') dt_atualizacao, 
            nm_usuario, 
            to_char(to_date(dt_atualizacao_nrec), 'DD/MM/YYYY') dt_atualizacao_nrec, 
            nm_usuario_nrec, 
            cd_staff_id, 
            cd_job , 
            cd_work_code , 
            to_char(to_date(dt_work), 'DD/MM/YYYY') dt_work, 
            to_char(to_date(dt_month_year), 'DD/MM/YYYY') dt_month_year, 
            nr_seq_master_shift, 
            nr_seq_nurse_shift
        from 
            nurse_shift_user_daily;


BEGIN
        --delete from agreg_nursing_empl_inf;
        open c01;
        loop
            fetch c01 into
                nr_sequencia_w,
                dt_atualizacao_w,
                nm_usuario_w,
                dt_atualizacao_nrec_w,
                nm_usuario_nrec_w,
                cd_staff_id_w,
                cd_job_w,
                cd_work_code_w,
                dt_work_w,
                dt_month_year_w,
                nr_seq_master_shift_w,
                nr_seq_nurse_shift_w;
            EXIT WHEN NOT FOUND; /* apply on c01 */

            /*select
                substr(nm_pessoa_fisica, 1, 60)
            into nm_usuario_w
            from
                table ( search_names_dev(null, to_number(cd_pessoa_fisica_w), null, null, null, null) );*/
            insert into agreg_nrs_empl_shift_daily(
                nr_sequencia,
                dt_atualizacao, 
                nm_usuario, 
                dt_atualizacao_nrec, 
                nm_usuario_nrec, 
                cd_pessoa_fisica, 
                nr_seq_nurse_shift, 
                dt_work_month, 
                dt_work_day, 
                cd_work_code
            ) values (
                nr_sequencia_w, 
                clock_timestamp(), 
                'assantana', 
                clock_timestamp(), 
                'assantana', 
                null, 
                nr_seq_nurse_shift_w, 
                dt_month_year_w, 
                dt_work_w, 
                cd_work_code_w
                );

        end loop;

        close c01;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_agreg_nursing_shift_pck.gerar_agreg_nrs_empl_daily () FROM PUBLIC;
