-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_moeda_pck.obter_cotacao ( cd_estabelecimento_p bigint, cd_moeda_cotacao_p bigint, dt_referencia_p timestamp) RETURNS bigint AS $body$
DECLARE


	dt_referencia_ww	timestamp;

	
BEGIN
	dt_referencia_ww	:=	trunc(dt_referencia_p,'dd');
	if (current_setting('wheb_moeda_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%coalesce(type::text, '') = '') or (cd_estabelecimento_p <> current_setting('wheb_moeda_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) or (current_setting('wheb_moeda_pck.dt_referencia_w')::coalesce(timestamp::text, '') = '') or (dt_referencia_ww <> current_setting('wheb_moeda_pck.dt_referencia_w')::timestamp) or (current_setting('wheb_moeda_pck.cd_moeda_origem_w')::moeda.cd_moeda%coalesce(type::text, '') = '') or (cd_moeda_cotacao_p <> current_setting('wheb_moeda_pck.cd_moeda_origem_w')::moeda.cd_moeda%type) then
		CALL wheb_moeda_pck.set_dados_cambio('O', cd_estabelecimento_p, cd_moeda_cotacao_p, dt_referencia_ww);
	end if;

	return wheb_moeda_pck.get_vl_cotacao_origem();
	end;



$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_moeda_pck.obter_cotacao ( cd_estabelecimento_p bigint, cd_moeda_cotacao_p bigint, dt_referencia_p timestamp) FROM PUBLIC;
