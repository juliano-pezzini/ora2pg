-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_sib_dados_benef_pck.carregar_dados_pessoa_fisica ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN

PERFORM set_config('pls_sib_dados_benef_pck.ie_itens_excluidos_cobertura', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.ie_cpt', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_cnpj', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_cei', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_beneficiario', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_beneficiario_titular', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.dt_contratacao', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_seq_plano', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_plano_ans', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_plano_operadora', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_plano_portabilidade', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_scpa_contrato', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_caepf', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_relacao_dependencia', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_seq_parentesco', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_cco', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.dt_rescisao', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.dt_reativacao', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.cd_motivo_cancelamento', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_seq_motivo_cancel', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.nr_seq_segurado', null, false);
PERFORM set_config('pls_sib_dados_benef_pck.ie_tipo_operacao', null, false);

CALL CALL CALL CALL CALL pls_sib_dados_benef_pck.carregar_parametros(cd_estabelecimento_p);

select	a.nr_cpf,
	a.dt_nascimento,
	coalesce(b.nm_pessoa_fisica,a.nm_pessoa_fisica),
	CASE WHEN a.ie_sexo='M' THEN '1' WHEN a.ie_sexo='F' THEN '3' END ,
	lpad(a.nr_pis_pasep,11,'0'),
	obter_nome_mae_pf(a.cd_pessoa_fisica),
	lpad(a.cd_declaracao_nasc_vivo,11,0),
	substr(a.nr_cartao_nac_sus,1,15)
into STRICT	current_setting('pls_sib_dados_benef_pck.nr_cpf')::varchar(15),
	current_setting('pls_sib_dados_benef_pck.dt_nascimento')::timestamp,
	current_setting('pls_sib_dados_benef_pck.nm_beneficiario')::varchar(255),
	current_setting('pls_sib_dados_benef_pck.ie_sexo')::varchar(1),
	current_setting('pls_sib_dados_benef_pck.cd_pis_pasep')::varchar(11),
	current_setting('pls_sib_dados_benef_pck.nm_mae')::varchar(255),
	current_setting('pls_sib_dados_benef_pck.cd_declaracao_nasc_vivo')::varchar(11),
	current_setting('pls_sib_dados_benef_pck.nr_cartao_nac_sus')::varchar(20)
FROM pessoa_fisica a
LEFT OUTER JOIN pls_pessoa_fisica b ON (a.cd_pessoa_fisica = b.cd_pessoa_fisica)
WHERE a.cd_pessoa_fisica = cd_pessoa_fisica_p;

PERFORM set_config('pls_sib_dados_benef_pck.nm_beneficiario', pls_sib_dados_benef_pck.ajustar_caracteres(current_setting('pls_sib_dados_benef_pck.nm_beneficiario')::varchar(255), 'S'), false);
PERFORM set_config('pls_sib_dados_benef_pck.nm_mae', pls_sib_dados_benef_pck.ajustar_caracteres(current_setting('pls_sib_dados_benef_pck.nm_mae')::varchar(255), 'S'), false);

begin
	SELECT * FROM pls_sib_dados_benef_pck.obter_enderecos_benef(	cd_pessoa_fisica_p, null, null, current_setting('pls_sib_dados_benef_pck.ie_logradouro_sib_w')::pls_parametros.ie_logradouro_sib%type, current_setting('pls_sib_dados_benef_pck.ie_tipo_endereco')::varchar(2), current_setting('pls_sib_dados_benef_pck.ds_logradouro')::varchar(255), current_setting('pls_sib_dados_benef_pck.nr_logradouro')::varchar(5), current_setting('pls_sib_dados_benef_pck.ds_complemento')::varchar(60), current_setting('pls_sib_dados_benef_pck.ds_bairro')::varchar(60), current_setting('pls_sib_dados_benef_pck.cd_municipio_ibge')::varchar(7), current_setting('pls_sib_dados_benef_pck.cd_municipio_ibge_resid')::varchar(6), current_setting('pls_sib_dados_benef_pck.cd_cep')::varchar(8), current_setting('pls_sib_dados_benef_pck.ie_reside_exterior')::smallint) INTO STRICT current_setting('pls_sib_dados_benef_pck.ie_tipo_endereco')::varchar(2), current_setting('pls_sib_dados_benef_pck.ds_logradouro')::varchar(255), current_setting('pls_sib_dados_benef_pck.nr_logradouro')::varchar(5), current_setting('pls_sib_dados_benef_pck.ds_complemento')::varchar(60), current_setting('pls_sib_dados_benef_pck.ds_bairro')::varchar(60), current_setting('pls_sib_dados_benef_pck.cd_municipio_ibge')::varchar(7), current_setting('pls_sib_dados_benef_pck.cd_municipio_ibge_resid')::varchar(6), current_setting('pls_sib_dados_benef_pck.cd_cep')::varchar(8), current_setting('pls_sib_dados_benef_pck.ie_reside_exterior')::smallint;
exception
when others then
	PERFORM set_config('pls_sib_dados_benef_pck.ie_tipo_endereco', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.ds_logradouro', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.nr_logradouro', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.ds_complemento', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.ds_bairro', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.cd_municipio_ibge', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.cd_municipio_ibge_resid', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.cd_cep', null, false);
	PERFORM set_config('pls_sib_dados_benef_pck.ie_reside_exterior', null, false);
end;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sib_dados_benef_pck.carregar_dados_pessoa_fisica ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
