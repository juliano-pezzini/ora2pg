-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_hemofilia_pck.get_data_diagnostico (nr_atendimento_p atendimento_paciente.nr_atendimento%type) RETURNS timestamp AS $body$
DECLARE

    ds_retorno_w  diagnostico_doenca.dt_diagnostico%type;

BEGIN
    select  coalesce(max(d.dt_diagnostico), to_date('1800-01-01', 'YYYY-MM-DD'))
    into STRICT    ds_retorno_w
    from    diagnostico_doenca d
    where   d.nr_atendimento = nr_atendimento_p
    and     alto_custo_pck.is_alto_custo(d.cd_doenca, current_setting('alto_custo_hemofilia_pck.ie_tipo_doenca_w')::regra_alto_custo.ie_tipo_doenca%type) = 'S'
    and     (d.dt_liberacao IS NOT NULL AND d.dt_liberacao::text <> '')
    and     d.ie_situacao = 'A';

    return ds_retorno_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_hemofilia_pck.get_data_diagnostico (nr_atendimento_p atendimento_paciente.nr_atendimento%type) FROM PUBLIC;
