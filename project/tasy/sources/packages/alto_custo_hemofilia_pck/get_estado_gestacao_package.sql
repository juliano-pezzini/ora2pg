-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_hemofilia_pck.get_estado_gestacao (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type) RETURNS varchar AS $body$
DECLARE

    ie_sexo_w     pessoa_fisica.ie_sexo%type;
    ds_retorno_w  varchar(255);

BEGIN
    begin
      select  ie_sexo
      into STRICT    ie_sexo_w
      from    pessoa_fisica
      where   cd_pessoa_fisica = cd_pessoa_fisica_p;

      if (ie_sexo_w = 'M') then
        ds_retorno_w := '3';
      else
        select  case
                  when max(a.ie_pac_gravida) = 'S' then 1
                  else 0
                end
        into STRICT    ds_retorno_w
        from    atendimento_gravidez a
        where   a.nr_sequencia =  (
                                    SELECT  max(b.nr_sequencia)
                                    from    table(alto_custo_pck.get_atendimentos_paciente(current_setting('alto_custo_hemofilia_pck.option_all_w')::varchar(1))) t,
                                            atendimento_gravidez b
                                    where   b.nr_atendimento = t.nr_atendimento
                                  );
      end if;
    exception
      when no_data_found then
        ds_retorno_w := '';
    end;

    return ds_retorno_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_hemofilia_pck.get_estado_gestacao (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type) FROM PUBLIC;
