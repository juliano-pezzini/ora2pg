-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_hemofilia_pck.get_fator_recebido ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, option_p text ) RETURNS varchar AS $body$
DECLARE

    ds_retorno_w varchar(5);

BEGIN
    begin
      select  ie_tipo_derivado
      into STRICT    ds_retorno_w
      from (
              SELECT  ie_tipo_derivado
              from (
                      SELECT  s.dt_transfusao,
                              alto_custo_hemofilia_pck.get_transfusao(s.nr_sequencia) ie_tipo_derivado
                      from    table(alto_custo_pck.get_atendimentos_paciente(option_p)) t,
                              san_transfusao s
                      where   s.nr_atendimento = t.nr_atendimento

                      
union all
   

                      select  p.dt_transfusao,
                              s.ie_tipo_derivado
                      from    paciente_transfusao p,
                              san_derivado s
                      where   s.nr_sequencia = p.nr_seq_derivado
                      and     p.nr_sequencia = alto_custo_hemofilia_pck.get_first_or_last_transfusao(cd_pessoa_fisica_p, option_p)
                    ) alias4
              order by  
                        CASE WHEN option_p=current_setting('alto_custo_hemofilia_pck.option_first_w')::varchar(1) THEN  dt_transfusao  ELSE null END  asc,
                        CASE WHEN option_p=current_setting('alto_custo_hemofilia_pck.option_last_w')::varchar(1) THEN  dt_transfusao  ELSE null END  desc
            ) alias9 LIMIT 1;
    exception
      when no_data_found then
        ds_retorno_w := null;
    end;

    return ds_retorno_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_hemofilia_pck.get_fator_recebido ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, option_p text ) FROM PUBLIC;
