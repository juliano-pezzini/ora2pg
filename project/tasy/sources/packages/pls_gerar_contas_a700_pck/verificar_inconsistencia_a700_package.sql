-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerar_contas_a700_pck.verificar_inconsistencia_a700 ( nr_seq_servico_p ptu_servico_pre_pagto.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) AS $body$
DECLARE
		
/* ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: 	Rotina responsavel por verificar se existe alguma nota de cobranca consistente, ou seja, apta para que as contas possam ser geradas. 
	Se nao houverem contas consistentes uma mensagem sera apresentada.
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 	
	
qt_consistencias_w	integer;
	

BEGIN		
		
select	count(1)
into STRICT	qt_consistencias_w
from	ptu_nota_cobranca
where	nr_seq_serv_pre_pagto = nr_seq_servico_p
and	ie_consistente <> 'IN' -- IN = Inconsistente nao permite gerar contas
  LIMIT 1;

if (qt_consistencias_w = 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(267347);
	/* Mensagem: Nao e possivel gerar contas medicas, existem apenas registros A700 com inconsistencias que impedem a geracao das contas, favor verificar. 
	*/

end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_contas_a700_pck.verificar_inconsistencia_a700 ( nr_seq_servico_p ptu_servico_pre_pagto.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) FROM PUBLIC;
