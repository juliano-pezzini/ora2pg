-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_imp_xml_cta_pck.pls_imp_nv_item ( nr_seq_conta_p pls_conta_item_imp.nr_seq_conta%type, ie_tipo_item_p pls_conta_item_imp.ie_tipo_item%type, cd_procedimento_p pls_conta_item_imp.cd_procedimento%type, qt_executado_p pls_conta_item_imp.qt_executado%type, ds_procedimento_p pls_conta_item_imp.ds_procedimento%type, cd_tipo_tabela_p pls_conta_item_imp.cd_tipo_tabela%type, dt_execucao_p pls_conta_item_imp.dt_execucao%type, dt_inicio_p pls_conta_item_imp.dt_inicio%type, dt_fim_p pls_conta_item_imp.dt_fim%type, tx_reducao_acrescimo_p pls_conta_item_imp.tx_reducao_acrescimo%type, vl_unitario_p pls_conta_item_imp.vl_unitario%type, vl_total_p pls_conta_item_imp.vl_total%type, nr_seq_item_tiss_p pls_conta_proc_regra.nr_seq_item_tiss%type, nr_seq_item_tiss_vinculo_p pls_conta_proc_regra.nr_seq_item_tiss_vinculo%type, -- especificos para material
 ie_tipo_despesa_p pls_conta_item_imp.ie_tipo_despesa%type, cd_unidade_medida_p pls_conta_item_imp.cd_unidade_medida%type, nr_registro_anvisa_p pls_conta_item_imp.nr_registro_anvisa%type, cd_ref_fabricante_p pls_conta_item_imp.cd_ref_fabricante%type, nr_aut_funcionamento_p pls_conta_item_imp.nr_aut_funcionamento%type, -- especificos para procedimentos
 ie_via_acesso_p pls_conta_item_imp.ie_via_acesso%type, ie_tecnica_utilizada_p pls_conta_item_imp.ie_tecnica_utilizada%type, qt_unidade_serv_p pls_conta_item_imp.qt_unidade_serv%type, vl_proc_copartic_p pls_conta_item_imp.vl_proc_copartic%type, ie_autorizado_p pls_conta_item_imp.ie_autorizado%type, cd_dente_p pls_conta_item_imp.cd_dente%type, cd_regiao_boca_p pls_conta_item_imp.cd_regiao_boca%type, cd_face_dente_p pls_conta_item_imp.cd_face_dente%type, -- FIM especificos para procedimentos
 nm_usuario_p usuario.nm_usuario%type, nr_sequencia_p INOUT pls_conta_item_imp.nr_sequencia%type) AS $body$
BEGIN

-- insere o item da conta


insert 	into pls_conta_item_imp(
	nr_sequencia, dt_atualizacao, nm_usuario,
	dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_conta,
	cd_procedimento, qt_executado, ds_procedimento,
	cd_tipo_tabela, dt_execucao, dt_inicio,
	dt_fim, tx_reducao_acrescimo, vl_unitario,
	vl_total, ie_tipo_despesa, cd_unidade_medida,
	nr_registro_anvisa, cd_ref_fabricante, nr_aut_funcionamento,
	ie_via_acesso, ie_tecnica_utilizada, qt_unidade_serv,
	vl_proc_copartic, ie_autorizado, cd_dente,
	cd_regiao_boca, cd_face_dente, ie_tipo_item,
	nr_seq_item_tiss, nr_seq_item_tiss_vinculo
) values (
	nextval('pls_conta_item_imp_seq'), clock_timestamp(), nm_usuario_p,
	clock_timestamp(), nm_usuario_p, nr_seq_conta_p,
	cd_procedimento_p, qt_executado_p, ds_procedimento_p,
	cd_tipo_tabela_p, dt_execucao_p, dt_inicio_p,
	dt_fim_p, tx_reducao_acrescimo_p, coalesce(vl_unitario_p,dividir(vl_total_p,qt_executado_p)),
	vl_total_p, ie_tipo_despesa_p, cd_unidade_medida_p,
	nr_registro_anvisa_p, cd_ref_fabricante_p, nr_aut_funcionamento_p,
	ie_via_acesso_p, ie_tecnica_utilizada_p, qt_unidade_serv_p,
	vl_proc_copartic_p, ie_autorizado_p, cd_dente_p,
	cd_regiao_boca_p, cd_face_dente_p, ie_tipo_item_p,
	nr_seq_item_tiss_p, nr_seq_item_tiss_vinculo_p
) returning nr_sequencia into nr_sequencia_p;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_xml_cta_pck.pls_imp_nv_item ( nr_seq_conta_p pls_conta_item_imp.nr_seq_conta%type, ie_tipo_item_p pls_conta_item_imp.ie_tipo_item%type, cd_procedimento_p pls_conta_item_imp.cd_procedimento%type, qt_executado_p pls_conta_item_imp.qt_executado%type, ds_procedimento_p pls_conta_item_imp.ds_procedimento%type, cd_tipo_tabela_p pls_conta_item_imp.cd_tipo_tabela%type, dt_execucao_p pls_conta_item_imp.dt_execucao%type, dt_inicio_p pls_conta_item_imp.dt_inicio%type, dt_fim_p pls_conta_item_imp.dt_fim%type, tx_reducao_acrescimo_p pls_conta_item_imp.tx_reducao_acrescimo%type, vl_unitario_p pls_conta_item_imp.vl_unitario%type, vl_total_p pls_conta_item_imp.vl_total%type, nr_seq_item_tiss_p pls_conta_proc_regra.nr_seq_item_tiss%type, nr_seq_item_tiss_vinculo_p pls_conta_proc_regra.nr_seq_item_tiss_vinculo%type,  ie_tipo_despesa_p pls_conta_item_imp.ie_tipo_despesa%type, cd_unidade_medida_p pls_conta_item_imp.cd_unidade_medida%type, nr_registro_anvisa_p pls_conta_item_imp.nr_registro_anvisa%type, cd_ref_fabricante_p pls_conta_item_imp.cd_ref_fabricante%type, nr_aut_funcionamento_p pls_conta_item_imp.nr_aut_funcionamento%type,  ie_via_acesso_p pls_conta_item_imp.ie_via_acesso%type, ie_tecnica_utilizada_p pls_conta_item_imp.ie_tecnica_utilizada%type, qt_unidade_serv_p pls_conta_item_imp.qt_unidade_serv%type, vl_proc_copartic_p pls_conta_item_imp.vl_proc_copartic%type, ie_autorizado_p pls_conta_item_imp.ie_autorizado%type, cd_dente_p pls_conta_item_imp.cd_dente%type, cd_regiao_boca_p pls_conta_item_imp.cd_regiao_boca%type, cd_face_dente_p pls_conta_item_imp.cd_face_dente%type,  nm_usuario_p usuario.nm_usuario%type, nr_sequencia_p INOUT pls_conta_item_imp.nr_sequencia%type) FROM PUBLIC;
