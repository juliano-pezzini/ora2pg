-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE exames_grid_pck.updateresult (ds_resultado_p text, ds_cor_p text, ds_referencia_p text, nr_seq_exame_p prescr_procedimento.nr_seq_exame%type, nr_seq_material_p exame_lab_result_item.nr_seq_material%type, ds_unidade_resultado_p text, ds_referencia_ext_p text, ie_resultado_referencia_p text, ds_metodo_p text, ie_formato_p text, indice bigint) AS $body$
DECLARE

current_setting('exames_grid_pck.ds_comando_w')::varchar(32000)    varchar(32000);
current_setting('exames_grid_pck.ds_parametro_w')::varchar(32000)    varchar(32000);

BEGIN

PERFORM set_config('exames_grid_pck.ds_comando_w', ' update w_result_exame_grid '||
                   ' set ds_result' || to_char(indice) || ' = :ds_resultado' ||
                   ' ,ds_cor = ds_cor || :ds_cor' ||
                   ' ,ds_referencia = :ds_referencia' ||
                   ' ,ds_referencia_ext = :ds_referencia_ext' ||
                   ' ,ie_resultado_referencia = :ie_resultado_referencia' ||
                   ' where nr_seq_exame  = :nr_seq_exame'    ||
                   ' and nr_seq_material = :nr_seq_material' ||
                   ' and ie_formato_resultado = :ie_formato '||
                   ' and decode(ds_unidade_medida, :ds_unidade_resultado, 1, 0) = 1'||
                   ' and nm_usuario = :nm_usuario'||
                   ' and decode(ds_metodo, :ds_metodo, 1, 0) = 1', false);

PERFORM set_config('exames_grid_pck.ds_parametro_w', 'ds_resultado='||ds_resultado_p||'#@#@ds_cor='||ds_cor_p||'#@#@ds_referencia='||ds_referencia_p||
                    '#@#@nr_seq_exame='||nr_seq_exame_p||'#@#@nr_seq_material='||nr_seq_material_p||'#@#@ie_formato='||ie_formato_p||
                    '#@#@nm_usuario='||current_setting('exames_grid_pck.nm_usuario_param')::prescr_medica.nm_usuario%type||'#@#@ds_unidade_resultado='||ds_unidade_resultado_p||'#@#@ds_referencia_ext='||ds_referencia_ext_p||
                    '#@#@ie_resultado_referencia='||ie_resultado_referencia_p||'#@#@ds_metodo='||ds_metodo_p||'#@#@', false);

if current_setting('exames_grid_pck.ie_modo_agrup_param')::varchar(1) <> 'E' then
   PERFORM set_config('exames_grid_pck.ds_comando_w', current_setting('exames_grid_pck.ds_comando_w')::varchar(32000)||' and nr_seq_resultado_lab = :nr_seq_resultado_lab ', false);
   PERFORM set_config('exames_grid_pck.ds_parametro_w', current_setting('exames_grid_pck.ds_parametro_w')::varchar(32000)||'nr_seq_resultado_lab='||current_setting('exames_grid_pck.rowc03')::C03%rowtype.nr_seq_result_lab_coluna||'#@#@', false);
end if;

CALL exec_sql_dinamico_bv('TASY', current_setting('exames_grid_pck.ds_comando_w')::varchar(32000),current_setting('exames_grid_pck.ds_parametro_w')::varchar(32000));

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE exames_grid_pck.updateresult (ds_resultado_p text, ds_cor_p text, ds_referencia_p text, nr_seq_exame_p prescr_procedimento.nr_seq_exame%type, nr_seq_material_p exame_lab_result_item.nr_seq_material%type, ds_unidade_resultado_p text, ds_referencia_ext_p text, ie_resultado_referencia_p text, ds_metodo_p text, ie_formato_p text, indice bigint) FROM PUBLIC;
