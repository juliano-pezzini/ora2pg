-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_usuario_pck.carregar_estab_usuario () AS $body$
DECLARE

	
	i 		smallint := 1;
	C01		integer;
	ds_comando_w	varchar(2000);
	retorno_w	integer;
	current_setting('wheb_usuario_pck.cd_estabelecimento_w')::smallint smallint;
	
	
BEGIN
	
	ds_comando_w	:=	' SELECT	cd_estabelecimento ' ||
				' FROM		usuario_estabelecimento ' ||
				' WHERE		nm_usuario_param = :nm_usuario ';

	C01 := DBMS_SQL.OPEN_CURSOR;
	DBMS_SQL.PARSE(C01, ds_comando_w, dbms_sql.Native);
	DBMS_SQL.DEFINE_COLUMN(c01,1,current_setting('wheb_usuario_pck.cd_estabelecimento_w')::smallint);		
	DBMS_SQL.BIND_VARIABLE(c01,'NM_USUARIO', current_setting('wheb_usuario_pck.nm_usuario_w')::varchar(15),15);
	retorno_w := DBMS_SQL.execute(c01);

	while( DBMS_SQL.FETCH_ROWS(C01) > 0 ) loop

		DBMS_SQL.COLUMN_VALUE(C01, 1, current_setting('wheb_usuario_pck.cd_estabelecimento_w')::smallint);
		current_setting('wheb_usuario_pck.estabelecimentos_usuario_w')::Vetor[i].cd_estabelecimento := current_setting('wheb_usuario_pck.cd_estabelecimento_w')::smallint;
		i := i + 1;
	END LOOP;

	DBMS_SQL.CLOSE_CURSOR(C01);
	
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wheb_usuario_pck.carregar_estab_usuario () FROM PUBLIC;
