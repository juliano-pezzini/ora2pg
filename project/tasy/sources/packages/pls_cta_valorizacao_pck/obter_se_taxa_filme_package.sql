-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_cta_valorizacao_pck.obter_se_taxa_filme ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS PLS_REGRA_TAXA_FILME.IE_APLICAR_TAXA%TYPE AS $body$
DECLARE


ie_aplicar_taxa_w	pls_regra_taxa_filme.ie_aplicar_taxa%type;

C01 CURSOR FOR
	SELECT	a.ie_aplicar_taxa
	from	pls_regra_taxa_filme a
	where	a.cd_estabelecimento	= cd_estabelecimento_p
	and	((a.nr_seq_prestador	= nr_seq_prestador_p) or (coalesce(a.nr_seq_prestador::text, '') = ''))
	order 	by coalesce(a.nr_seq_prestador,0);
				
BEGIN

ie_aplicar_taxa_w	:= current_setting('pls_cta_valorizacao_pck.ie_aplicar_taxa_filme_pw')::pls_regra_taxa_filme.ie_aplicar_taxa%type;

if (coalesce(current_setting('pls_cta_valorizacao_pck.nr_seq_prestador_pw')::pls_prestador.nr_sequencia%type, 0) <> coalesce(nr_seq_prestador_p,0)) or (coalesce(current_setting('pls_cta_valorizacao_pck.cd_estabelecimento_pw')::estabelecimento.cd_estabelecimento%type, 0) <> coalesce(cd_estabelecimento_p,0)) then
	ie_aplicar_taxa_w		:= 'S';
	for	r_C01_w in C01() loop
		ie_aplicar_taxa_w	:= r_C01_w.ie_aplicar_taxa;
	end loop;
	PERFORM set_config('pls_cta_valorizacao_pck.nr_seq_prestador_pw', nr_seq_prestador_p, false);
	PERFORM set_config('pls_cta_valorizacao_pck.cd_estabelecimento_pw', cd_estabelecimento_p, false);
end if;

PERFORM set_config('pls_cta_valorizacao_pck.ie_aplicar_taxa_filme_pw', ie_aplicar_taxa_w, false);

return		current_setting('pls_cta_valorizacao_pck.ie_aplicar_taxa_filme_pw')::pls_regra_taxa_filme.ie_aplicar_taxa%type;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_cta_valorizacao_pck.obter_se_taxa_filme ( nr_seq_prestador_p pls_prestador.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
