-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ageint_sugerir_html5_pck.get_ex_agenda_vet (ds_lista_sequencia_p text, cd_estabelecimento_p bigint ) RETURNS varchar AS $body$
DECLARE


ds_retorno_w varchar(4000);
qt_tempo_intervalo_w bigint;
vl_retorno_w bigint;WITH RECURSIVE cte AS (


c01 is CURSOR

with temp as (SELECT ds_lista_sequencia_p as nr_sequencias
 )
 SELECT 1 as n,regexp_substr(nr_sequencias, '[^,]+', 1, 1) as nr_sequencia_lista
 from temp
(regexp_substr(nr_sequencias, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencias, '[^,]+', 1, level))::text <> '')  UNION ALL


c01 is CURSOR 

with temp as (SELECT ds_lista_sequencia_p as nr_sequencias
 )
 SELECT (c.level+1) as n,regexp_substr(nr_sequencias, '[^,]+', 1, (c.level+1)) as nr_sequencia_lista
 from temp
(regexp_substr(nr_sequencias, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_sequencias, '[^,]+', 1, level))::text <> '') JOIN cte c ON ()

) SELECT * FROM cte;
;

BEGIN

for c_01 in c01 loop

  SELECT * FROM ageint_sugerir_html5_pck.obter_seq_ex_agenda_vet(c_01.nr_sequencia_lista, cd_estabelecimento_p, qt_tempo_intervalo_w, vl_retorno_w, null) INTO STRICT qt_tempo_intervalo_w, vl_retorno_w;
  ds_retorno_w := ds_retorno_w || c_01.nr_sequencia_lista || ':' || coalesce(qt_tempo_intervalo_w, -1) || ':' || coalesce(vl_retorno_w, -1) || ';';

end loop;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ageint_sugerir_html5_pck.get_ex_agenda_vet (ds_lista_sequencia_p text, cd_estabelecimento_p bigint ) FROM PUBLIC;
