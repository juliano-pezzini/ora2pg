-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_contab_onl_lote_fin_pck.contabiliza_documento ( doc_p ctb_documento, nm_usuario_p text) AS $body$
DECLARE

	ds_erro_w 	varchar(4000);
	current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype 		ctb_documento%rowtype;

	
BEGIN

		PERFORM set_config('pls_contab_onl_lote_fin_pck.doc_w', doc_p, false);
		current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.ds_inconsistencia := null;

		if (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 23) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_reembolso(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 24) then
			if (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.nr_seq_info = 26) then
				current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_repasse(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
			elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.nr_seq_info = 75) then
				current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_comissao(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
			end if;
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 27) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_ressarcimento(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 33) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_desp_intercambio(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 35) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_peona(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 36) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_fatura_interc(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 37) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_notas_contest(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 38) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_discussao_glosa(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 39) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_baixa_mens(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 40) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_provisao_prod(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 41) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_prod_med(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 42) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_prov_copart(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 43) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_prov_faturamento(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 44) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_rec_faturamento(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 49) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_provisao_ppcng(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 50) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_rec_ppcng(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		elsif (current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.cd_tipo_lote_contabil = 57) then
			current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype := pls_contab_onl_lote_fin_pck.contab_aviso_cobranca(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		end if;

		if (coalesce(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.nr_lote_contabil, 0) <> 0) then
			CALL pls_contab_onl_lote_fin_pck.gravar_lote_ctb_documento(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
			begin
			ctb_atualizar_saldo(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.nr_lote_contabil, 'S', nm_usuario_p, 'N', ds_erro_w, 'S');	
			exception when others then
				null;
			end;
		end if;
		
		if (coalesce(doc_p.ds_inconsistencia, 'X') <> coalesce(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype.ds_inconsistencia, 'X')) then
			CALL CALL CALL pls_contab_onl_lote_fin_pck.gravar_inconsistencia(current_setting('pls_contab_onl_lote_fin_pck.doc_w')::ctb_documento%rowtype, nm_usuario_p);
		end if;

		commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_contab_onl_lote_fin_pck.contabiliza_documento ( doc_p ctb_documento, nm_usuario_p text) FROM PUBLIC;
