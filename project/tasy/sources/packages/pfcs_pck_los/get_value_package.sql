-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_los.get_value (nr_seq_encounter_p bigint, ie_unit_category_p text) RETURNS bigint AS $body$
DECLARE

        vl_los_w double precision;

BEGIN
        select max(to_number(substr(replace(vl_reference,',','.'), 0, 7), '999.9999999999'))
        into STRICT vl_los_w
        from (
            SELECT obs.vl_referencia vl_reference
            from pfcs_observation obs
            where obs.nr_seq_encounter = nr_seq_encounter_p
                and obs.cd_observation_type in (current_setting('pfcs_pck_los.cd_medsurg_los_w')::varchar(16), current_setting('pfcs_pck_los.cd_icu_los_w')::varchar(12))
            order by obs.dt_atualizacao desc
        ) alias9 LIMIT 1;
        RETURN vl_los_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_pck_los.get_value (nr_seq_encounter_p bigint, ie_unit_category_p text) FROM PUBLIC;
