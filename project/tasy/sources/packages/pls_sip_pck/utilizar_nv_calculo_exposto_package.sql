-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_sip_pck.utilizar_nv_calculo_exposto ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS varchar AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Rotina responsavel por definir se sera utilizado o novo calculo de exposto,
	ou sera utilizado o antigo.

	A regra que define quando sera utilizado o calculo novo e a verificacao
	da existencia de regra de exposto, na tabela SIP_ITEM_EXPOSICAO_REGRA.
	
	Caso tenha alguma regra cadastrada, sera entao utilizado o novo calculo	
		
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

Alteracoes:
-------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


ds_retorno_w		varchar(1) := 'N';

BEGIN

-- Busca a quantidade de regras de exposicao existentes no estabelecimento, se possuir alguma, sera considerado 'S'

select	CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
into STRICT	ds_retorno_w
from	sip_item_exposicao_regra	a,
	sip_item_assistencial		b
where	b.nr_sequencia		= a.nr_seq_item_assist
and	b.cd_estabelecimento	= cd_estabelecimento_p;


return ds_retorno_w;


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_sip_pck.utilizar_nv_calculo_exposto ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
