-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_sip_pck.gerencia_incon_sistema ( nr_seq_incon_sist_p sip_nv_vinc_incon_sist.nr_seq_incon_sist%type, nr_seq_nv_dados_p sip_nv_dados.nr_sequencia%type, ie_situacao_p sip_nv_vinc_incon_sist.ie_situacao%type, nr_sequencia_p sip_nv_vinc_incon_sist.nr_sequencia%type, nm_usuario_p text) AS $body$
DECLARE


qt_registro_w		integer;


BEGIN
	select	count(1)
	into STRICT	qt_registro_w
	from	sip_nv_vinc_incon_sist
	where	nr_seq_incon_sist	= nr_seq_incon_sist_p
	and	nr_seq_nv_dados		= nr_seq_nv_dados_p;
	
	-- se nao tiver registros, faz insert

	if (qt_registro_w = 0) then
		insert into sip_nv_vinc_incon_sist(nr_sequencia, nr_seq_incon_sist, nr_seq_nv_dados,
			nm_usuario, nm_usuario_nrec, dt_atualizacao,
			dt_atualizacao_nrec, ie_situacao)
		values (nextval('sip_nv_vinc_incon_sist_seq'), nr_seq_incon_sist_p, nr_seq_nv_dados_p,
			nm_usuario_p, nm_usuario_p, clock_timestamp(),
			clock_timestamp(), ie_situacao_p);
		commit;
	else
		-- se tem, manda atualizar

		CALL pls_sip_pck.atualiza_ie_situacao(	nr_seq_incon_sist_p, nr_seq_nv_dados_p, nr_sequencia_p,
					ie_situacao_p, nm_usuario_p);
	end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sip_pck.gerencia_incon_sistema ( nr_seq_incon_sist_p sip_nv_vinc_incon_sist.nr_seq_incon_sist%type, nr_seq_nv_dados_p sip_nv_dados.nr_sequencia%type, ie_situacao_p sip_nv_vinc_incon_sist.ie_situacao%type, nr_sequencia_p sip_nv_vinc_incon_sist.nr_sequencia%type, nm_usuario_p text) FROM PUBLIC;
