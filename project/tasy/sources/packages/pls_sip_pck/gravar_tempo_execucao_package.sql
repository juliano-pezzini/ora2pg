-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Grava o tempo de execucao de cada processo.



CREATE OR REPLACE PROCEDURE pls_sip_pck.gravar_tempo_execucao ( nr_seq_lote_p pls_lote_sip.nr_sequencia%type, ds_comando_p pls_sip_nv_tempo_geracao.ds_comando%type, ds_observacao_p pls_sip_nv_tempo_geracao.ds_observacao%type, ie_tipo_gravacao text, nm_usuario_p text, nr_sequencia_p INOUT pls_sip_nv_tempo_geracao.nr_sequencia%type) AS $body$
DECLARE

/*
ie_tipo_gravacao =>  I - gravar data de inicio
	            F - gravar data de fim*/


BEGIN
	-- tratamento para insert

	-- nao faz sentido informar dt_fim em um insert

	if (ie_tipo_gravacao = 'I') then
	
		insert into pls_sip_nv_tempo_geracao(nr_sequencia, nr_seq_lote, ds_comando, ds_observacao,
			dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
			nm_usuario_nrec, dt_inicio)
		values (nextval('pls_sip_nv_tempo_geracao_seq'), nr_seq_lote_p, ds_comando_p, ds_observacao_p,
			clock_timestamp(), nm_usuario_p, clock_timestamp(),
			nm_usuario_p, clock_timestamp())
		returning nr_sequencia into nr_sequencia_p;
		commit;
		
	-- tratamento para update

	elsif (ie_tipo_gravacao = 'F') then
	
		update 	pls_sip_nv_tempo_geracao
		set	dt_fim			= clock_timestamp(),
			dt_atualizacao		= clock_timestamp(),
			nm_usuario		= nm_usuario_p
		where	nr_sequencia		= nr_sequencia_p;
		commit;
	end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sip_pck.gravar_tempo_execucao ( nr_seq_lote_p pls_lote_sip.nr_sequencia%type, ds_comando_p pls_sip_nv_tempo_geracao.ds_comando%type, ds_observacao_p pls_sip_nv_tempo_geracao.ds_observacao%type, ie_tipo_gravacao text, nm_usuario_p text, nr_sequencia_p INOUT pls_sip_nv_tempo_geracao.nr_sequencia%type) FROM PUBLIC;
