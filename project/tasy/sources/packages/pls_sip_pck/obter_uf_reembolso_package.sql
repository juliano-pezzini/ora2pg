-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_sip_pck.obter_uf_reembolso ( nr_seq_conta_p pls_conta.nr_sequencia%type, cd_pf_conta_p pls_conta.cd_pessoa_fisica%type, cd_cgc_conta_p pls_conta.cd_cgc%type) RETURNS SIP_NV_DADOS.SG_UF%TYPE AS $body$
DECLARE


sg_estado_w		sip_nv_dados.sg_uf%type;


BEGIN

-- Comeca como nao sendo nada.

sg_estado_w := null;	

-- Se for uma conta valida buscar os dados da mesma

if (nr_seq_conta_p IS NOT NULL AND nr_seq_conta_p::text <> '') then
	
	-- Se tiver a pessoa fisica informada, busca o dado da mesma, 

	if (cd_pf_conta_p IS NOT NULL AND cd_pf_conta_p::text <> '') then
	
		select	max(a.sg_estado)
		into STRICT	sg_estado_w
		from  	compl_pessoa_fisica	a
		where	a.cd_pessoa_fisica = cd_pf_conta_p
		-- Pode ter mais de um registro, buscar o que tenha o estado informado apenas.

		and	(a.sg_estado IS NOT NULL AND a.sg_estado::text <> '');
		
	-- SE nao busca da pessoa juridica caso esta serja informada.

	elsif (cd_cgc_conta_p IS NOT NULL AND cd_cgc_conta_p::text <> '') then
	
		select 	max(a.sg_estado)
		into STRICT 	sg_estado_w
		from 	pessoa_juridica a
		where	a.cd_cgc = cd_cgc_conta_p;
	end if;
end if;	

return sg_estado_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_sip_pck.obter_uf_reembolso ( nr_seq_conta_p pls_conta.nr_sequencia%type, cd_pf_conta_p pls_conta.cd_pessoa_fisica%type, cd_cgc_conta_p pls_conta.cd_cgc%type) FROM PUBLIC;
