-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_sip_pck.sip_nv_insere_lote ( nr_seq_item_assist_p sip_item_assistencial.nr_sequencia%type, nr_seq_lote_p pls_lote_sip.nr_sequencia%type, sg_uf_p sip_lote_item_assistencial.sg_uf%type, ie_tipo_contratacao_p sip_lote_item_assistencial.ie_tipo_contratacao%type, ie_segmentacao_sip_p sip_lote_item_assistencial.ie_segmentacao_sip%type, dt_ocorrencia_p sip_lote_item_assistencial.dt_ocorrencia%type, qt_evento_p sip_lote_item_assistencial.qt_evento%type, vl_despesa_p sip_lote_item_assistencial.vl_despesa%type, nm_usuario_p usuario.nm_usuario%type, nr_sequencia_p INOUT sip_lote_item_assistencial.nr_sequencia%type) AS $body$
DECLARE


cs_item_assist CURSOR(	nr_seq_item_assist_pc	sip_item_assistencial.nr_sequencia%type) FOR
	SELECT	nextval('sip_lote_item_assistencial_seq') nr_seq_gerado,
		a.ie_evento,
		a.ie_benef_carencia, 
		a.ie_despesa, 
		a.nr_seq_apres,
		a.cd_classificacao, 
		a.nr_seq_superior
	from	sip_item_assistencial a
	where	a.nr_sequencia	= nr_seq_item_assist_pc;

BEGIN
	
	for	rw_item_assist_w in cs_item_assist(nr_seq_item_assist_p) loop
	
		nr_sequencia_p	:= rw_item_assist_w.nr_seq_gerado;
		
		-- insere um registro com as quantidades de evento, despesa e expostos zeradas

		insert into sip_lote_item_assistencial(nr_sequencia, nr_seq_lote, sg_uf,
			qt_evento, qt_beneficiario, vl_despesa,
			dt_atualizacao, nm_usuario, nr_seq_item_sip,
			ie_evento, ie_benef_carencia, ie_despesa,
			nr_seq_apres, ie_tipo_contratacao, ie_segmentacao_sip,
			cd_classificacao_sip, nr_seq_superior,
			dt_ocorrencia)
		values (nr_sequencia_p, nr_seq_lote_p, sg_uf_p,
			qt_evento_p, 0, vl_despesa_p,
			clock_timestamp(), nm_usuario_p, nr_seq_item_assist_p,
			rw_item_assist_w.ie_evento, rw_item_assist_w.ie_benef_carencia, rw_item_assist_w.ie_despesa,
			rw_item_assist_w.nr_seq_apres, ie_tipo_contratacao_p, ie_segmentacao_sip_p,
			rw_item_assist_w.cd_classificacao, rw_item_assist_w.nr_seq_superior, 
			dt_ocorrencia_p);
		commit;
	end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sip_pck.sip_nv_insere_lote ( nr_seq_item_assist_p sip_item_assistencial.nr_sequencia%type, nr_seq_lote_p pls_lote_sip.nr_sequencia%type, sg_uf_p sip_lote_item_assistencial.sg_uf%type, ie_tipo_contratacao_p sip_lote_item_assistencial.ie_tipo_contratacao%type, ie_segmentacao_sip_p sip_lote_item_assistencial.ie_segmentacao_sip%type, dt_ocorrencia_p sip_lote_item_assistencial.dt_ocorrencia%type, qt_evento_p sip_lote_item_assistencial.qt_evento%type, vl_despesa_p sip_lote_item_assistencial.vl_despesa%type, nm_usuario_p usuario.nm_usuario%type, nr_sequencia_p INOUT sip_lote_item_assistencial.nr_sequencia%type) FROM PUBLIC;
