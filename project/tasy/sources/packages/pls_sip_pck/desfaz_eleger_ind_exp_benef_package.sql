-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_sip_pck.desfaz_eleger_ind_exp_benef ( nr_seq_lote_sip_p pls_lote_sip.nr_sequencia%type) AS $body$
DECLARE

_ora2pg_r RECORD;
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Desfaz a escolha do indice a ser utilizado no SIP por beneficiario.

		
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

Alteracoes:
-------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


-- tabelas contendo os dados a serem atualizados

tb_nr_seq_item_benef_w	dbms_sql.number_table;
tb_ie_envio_sip_w	dbms_sql.varchar2_table;

c01 CURSOR(	nr_seq_lote_sip_pc	pls_lote_sip.nr_sequencia%type) FOR
	SELECT	x.nr_sequencia,
		'N' ie_envio_sip
	from	sip_nv_benef_exp_item	x
	where	x.nr_seq_lote	= nr_seq_lote_sip_pc
	and	x.ie_envio_sip	= 'S';

BEGIN

-- Carrega os indices que forma marcados para enviar no sip

open c01(nr_seq_lote_sip_p);

-- navega entre os registros

loop

	fetch c01 bulk collect into	tb_nr_seq_item_benef_w,
					tb_ie_envio_sip_w limit current_setting('pls_sip_pck.qt_registro_transacao_w')::integer;
	exit when tb_nr_seq_item_benef_w.count = 0;
	
	-- manda para o banco

	SELECT * FROM pls_sip_pck.atualiza_envio_indice_exp(tb_nr_seq_item_benef_w, tb_ie_envio_sip_w, 'S', 'S') INTO STRICT _ora2pg_r;
 tb_nr_seq_item_benef_w := _ora2pg_r.tb_nr_seq_item_benef_p; tb_ie_envio_sip_w := _ora2pg_r.tb_ie_envio_sip_p;

end loop;

-- Se o cursor estiver aberto, fecha

if (c01%isopen) then

	close c01;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sip_pck.desfaz_eleger_ind_exp_benef ( nr_seq_lote_sip_p pls_lote_sip.nr_sequencia%type) FROM PUBLIC;
