-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



-- Utilizada para descrever o processo atual na geracao do SIP.



CREATE OR REPLACE FUNCTION pls_sip_pck.obter_descricao_processo_pb ( nr_processo_atual_p integer, nr_processo_maximo_p integer, ie_recarrega_conta_p text default 'S') RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(100) := '';
ds_acao_executada_w 	varchar(100);
nr_processo_atual_w	integer;

BEGIN

if (nr_processo_atual_p = 1) then
	ds_acao_executada_w := 'Iniciando geracao do SIP - Preparando dados iniciais';
elsif (nr_processo_atual_p = 2) then
	ds_acao_executada_w := 'Limpando dados da geracao anterior';
elsif (nr_processo_atual_p = 3) then
	ds_acao_executada_w := 'Calculando a quantidade de vidas';
elsif (nr_processo_atual_p = 4) then
	ds_acao_executada_w := 'Obtendo dados para o lote';
elsif (nr_processo_atual_p = 5) then
	ds_acao_executada_w := 'Processando as regras dos itens assistenciais';
elsif (nr_processo_atual_p = 6) then
	ds_acao_executada_w := 'Realizando a consistencia dos dados x regras';
elsif (nr_processo_atual_p = 7) then
	ds_acao_executada_w := 'Vinculando dados aos itens assistenciais';
elsif (nr_processo_atual_p = 8) then
	ds_acao_executada_w := 'Calculando os expostos';
elsif (nr_processo_atual_p = 9) then
	ds_acao_executada_w := 'Atualizando os expostos';
elsif (nr_processo_atual_p = 10) then
	ds_acao_executada_w := 'Consistindo a quantidade de eventos';
elsif (nr_processo_atual_p = 11) then
	ds_acao_executada_w := 'Finalizando geracao do lote';
end if;

-- sem recarregar as contas fica com um processo a menos a partir do processo 4

if (ie_recarrega_conta_p = 'N' and nr_processo_atual_p > 4) then
	nr_processo_atual_w := nr_processo_atual_p - 1;
else
	nr_processo_atual_w := nr_processo_atual_p;
end if;
	
ds_retorno_w := 'Etapa ' || nr_processo_atual_w || '/' || nr_processo_maximo_p || ' - ' || ds_acao_executada_w;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_sip_pck.obter_descricao_processo_pb ( nr_processo_atual_p integer, nr_processo_maximo_p integer, ie_recarrega_conta_p text default 'S') FROM PUBLIC;
