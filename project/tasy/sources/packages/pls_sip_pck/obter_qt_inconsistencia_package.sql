-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Conta as inconsistencias de determinado lote.



CREATE OR REPLACE FUNCTION pls_sip_pck.obter_qt_inconsistencia (nr_lote_sip_p pls_lote_sip.nr_sequencia%type) RETURNS bigint AS $body$
DECLARE

	
qt_inconsistencia_w	integer;

BEGIN
-- So processa se tem informacao valida.

if (nr_lote_sip_p IS NOT NULL AND nr_lote_sip_p::text <> '') then
	
	select	count(distinct a.nr_seq_conta)
	into STRICT	qt_inconsistencia_w
	from	sip_nv_dados	a
	where	a.nr_seq_lote_sip = nr_lote_sip_p
	and	exists (	SELECT	1
				from	sip_nv_vinc_incon_sist x
				where	x.nr_seq_nv_dados = a.nr_sequencia
				and	x.ie_situacao = 'A');
end if;

return qt_inconsistencia_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_sip_pck.obter_qt_inconsistencia (nr_lote_sip_p pls_lote_sip.nr_sequencia%type) FROM PUBLIC;
