-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE vipe_gerar_horario_dif_pck.vipe_gerar_horarios_doses ( ds_valores_p text, ds_separador_p text, ie_opcao_p text) AS $body$
DECLARE


	ds_valores_w	varchar(2000);
	pos_separador_w	bigint;
	ds_horario_w	varchar(255);

	
BEGIN

	PERFORM set_config('vipe_gerar_horario_dif_pck.ivet_w', 0, false);

	if (ds_valores_p IS NOT NULL AND ds_valores_p::text <> '') and (ds_separador_p IS NOT NULL AND ds_separador_p::text <> '') then
		begin
		ds_valores_w := ds_valores_p;

		while(ds_valores_w IS NOT NULL AND ds_valores_w::text <> '') loop
			begin
			pos_separador_w	:= position(ds_separador_p in ds_valores_w);
			ds_horario_w	:= substr(ds_valores_w, 1, pos_separador_w-1);
			ds_valores_w	:= substr(ds_valores_w, pos_separador_w+1, length(ds_valores_w));

			if (pos_separador_w > 0) then
				begin

				if (ie_opcao_p = 'H') then
					current_setting('vipe_gerar_horario_dif_pck.vetor_w')::vetor(current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint).horario_w	:= ds_horario_w;
				elsif (ie_opcao_p = 'D') then
					current_setting('vipe_gerar_horario_dif_pck.vetor_dose_w')::vetor_dose(current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint).dose_w	:= ds_horario_w;
				end if;

				PERFORM set_config('vipe_gerar_horario_dif_pck.ivet_w', current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint + 1, false);
				end;
			elsif (pos_separador_w = 0) then
				begin
				if ((trim(both ds_valores_w) IS NOT NULL AND (trim(both ds_valores_w))::text <> '')) then
					begin
					ds_horario_w 			:= trim(both ds_valores_w);

					if (ie_opcao_p = 'H') then
						current_setting('vipe_gerar_horario_dif_pck.vetor_w')::vetor(current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint).horario_w	:= ds_horario_w;
					elsif (ie_opcao_p = 'D') then
						current_setting('vipe_gerar_horario_dif_pck.vetor_dose_w')::vetor_dose(current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint).dose_w	:= ds_horario_w;
					end if;

					PERFORM set_config('vipe_gerar_horario_dif_pck.ivet_w', current_setting('vipe_gerar_horario_dif_pck.ivet_w')::bigint + 1, false);
					end;
				end if;
				ds_valores_w := null;
				end;
			end if;
			end;
		end loop;
		end;
	end if;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE vipe_gerar_horario_dif_pck.vipe_gerar_horarios_doses ( ds_valores_p text, ds_separador_p text, ie_opcao_p text) FROM PUBLIC;
