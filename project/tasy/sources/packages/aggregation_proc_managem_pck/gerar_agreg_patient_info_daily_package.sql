-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE aggregation_proc_managem_pck.gerar_agreg_patient_info_daily (nr_seq_daily_report_p agreg_surgery_information.nr_seq_main_daily_rep%type ,cd_estabelecimento_p establishment_locale.cd_estabelecimento%type ,ie_main_flag_p agreg_surgery_information.ie_main_flag%type ,nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


cd_ward_w       agreg_main_daily_reports.cd_ward%type;
cd_department_w agreg_patient_information.cd_department%type;
nr_sequencia_w  bigint;


BEGIN
  -- obter setor de atendimento
  select max(cd_ward)
  into STRICT   cd_ward_w
  from   agreg_main_daily_reports
  where  nr_sequencia       = nr_seq_daily_report_p
  and    cd_estabelecimento = cd_estabelecimento_p;
  
  cd_department_w := obter_departamento_setor(cd_ward_w);

  select nextval('agreg_patient_information_seq')
  into STRICT   nr_sequencia_w
;

  insert into agreg_patient_information(nr_sequencia
         ,dt_atualizacao
         ,nm_usuario
         ,nm_usuario_nrec
         ,dt_atualizacao_nrec
         ,nr_seq_main_daily_rep
         ,dt_target
         ,cd_department
         ,qt_total
         ,qt_sum
         ,ie_main_flag
         ,qt_revisit
         ,qt_first_visit
         ,qt_first_treatment )
  values (nr_sequencia_w
         ,clock_timestamp()
         ,nm_usuario_p
         ,nm_usuario_p
         ,clock_timestamp()
         ,nr_seq_daily_report_p
         ,clock_timestamp()
         ,cd_department_w
         ,0
         ,0
         ,ie_main_flag_p
         ,0
         ,0
         ,0 );
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE aggregation_proc_managem_pck.gerar_agreg_patient_info_daily (nr_seq_daily_report_p agreg_surgery_information.nr_seq_main_daily_rep%type ,cd_estabelecimento_p establishment_locale.cd_estabelecimento%type ,ie_main_flag_p agreg_surgery_information.ie_main_flag%type ,nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
