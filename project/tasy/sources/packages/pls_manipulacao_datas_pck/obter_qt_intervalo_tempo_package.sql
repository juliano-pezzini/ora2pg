-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_manipulacao_datas_pck.obter_qt_intervalo_tempo ( dt_inicio_p timestamp, dt_fim_p timestamp, ie_tipo_retorno_p text) RETURNS bigint AS $body$
DECLARE


/* 
ie_tipo_retorno_p
	D - dia
	H - Hora
	M - Minutos
	S - Segundos
*/
ds_retorno_w	varchar(30);
dt_fim_w	timestamp;


BEGIN

if (coalesce(dt_fim_p::text, '') = '') then

	dt_fim_w := dt_fim_p;
else
	dt_fim_w := clock_timestamp();
end if;

case(ie_tipo_retorno_p)
	-- Dia
	when 'D' then
		ds_retorno_w := (dt_fim_w - dt_inicio_p);
	-- Horas 
	when 'H' then
		ds_retorno_w := round((abs(dt_fim_w - dt_inicio_p)* 24)::numeric,0);
	-- Minutos
	when 'M' then
		ds_retorno_w := round(abs(dt_fim_w - dt_inicio_p) * 24 * 60);
	-- Segundos
	when 'S' then
		ds_retorno_w := round(abs(dt_fim_w - dt_inicio_p) * 24 * 60 * 60);
/*
ds_hora_w := round(trunc( abs(dt_termino_p - dt_inicio_p) * 24 ), 0);
	ds_minuto_w := lpad(trunc((mod(trunc(abs(dt_termino_p - dt_inicio_p) * 24 * 60 ), 60))), 2, '0');
	ds_segundo_w := lpad(trunc((mod(round(abs(dt_termino_p - dt_inicio_p) * 24 * 60 * 60), 60))), 2, '0');
*/
	else
		null;
end case;

return	(coalesce(ds_retorno_w, 0))::numeric;
	
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_manipulacao_datas_pck.obter_qt_intervalo_tempo ( dt_inicio_p timestamp, dt_fim_p timestamp, ie_tipo_retorno_p text) FROM PUBLIC;
