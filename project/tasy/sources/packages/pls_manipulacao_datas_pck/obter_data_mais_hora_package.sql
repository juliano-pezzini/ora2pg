-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_manipulacao_datas_pck.obter_data_mais_hora ( dt_data_p timestamp, dt_horas_p timestamp) RETURNS timestamp AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:  Para casos aonde exita mais de um campo de data para compor apenas uma data,
	como  na pls_conta_proc e na pls_conta_mat aonde é gravado a data em um campo 
	e  as horas de início e fim em outros dois campos diferentes para compor apenas
	uma data pode ser usado esta function para obter o retorno desse registro.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X] Objetos do dicionário [ X] Tasy (Delphi/Java) [X] Portal [X]  Relatórios [X] Outros:
------------------------------------------------------------------------------------------------------------------
Pontos de atenção: 

Alterações: 
------------------------------------------------------------------------------------------------------------------
jjung OS 601998 - 12/06/2013  Criação da function.
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_retorno_w	timestamp;

BEGIN
-- deve ter a informação de data para que seja feito algo
if (dt_data_p IS NOT NULL AND dt_data_p::text <> '') then

	-- se tiver horas informado então gera a data de retorno com dia, mes e ano da data em si (dt_data_p) e horas, minutos e segundos da hora informada (dt_horas_p)
	if (dt_horas_p IS NOT NULL AND dt_horas_p::text <> '') then
	
		dt_retorno_w := to_date(to_char(dt_data_p,'dd/mm/yyyy')||' '||to_char(dt_horas_p,'hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss');
		
	-- se não tiver horas informado então ignora as hora da data.
	else
		dt_retorno_w := trunc(dt_data_p);
	end if;
	
end if;

return dt_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_manipulacao_datas_pck.obter_data_mais_hora ( dt_data_p timestamp, dt_horas_p timestamp) FROM PUBLIC;
