-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_manipulacao_datas_pck.fim_ano ( dt_ano_p text, ie_com_horas_p text default 'N') RETURNS timestamp AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: 	Obter em forma de data o último dia do ano passado por parâmetro. Pode ser obtido
	com ou sem horas.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X] Objetos do dicionário [ X] Tasy (Delphi/Java) [X] Portal [X]  Relatórios [X] Outros:
------------------------------------------------------------------------------------------------------------------
Pontos de atenção: 

Alterações: 
------------------------------------------------------------------------------------------------------------------
jjung 06/08/2013 - Documentação da function.
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
			
ds_data_criada_w	varchar(30);
ds_mascara_data_w	varchar(30);

BEGIN
-- Se não tiver informação da data será retornado null.
if (dt_ano_p IS NOT NULL AND dt_ano_p::text <> '') then
	-- Com horas
	if (ie_com_horas_p = 'S') then
		-- Compor a máscara padrão com horas
		ds_mascara_data_w := 'dd/mm/yyyy hh24:mi:ss';
		-- Compor os valores da data. Quando for com hora coloca a maior data possível.
		ds_data_criada_w := '31/12/'||dt_ano_p||' 23:59:59';
	-- Sem horas
	elsif (ie_com_horas_p = 'N') then
		
		-- Compor a máscara padrão sem horas
		ds_mascara_data_w := 'dd/mm/yyyy';
		-- Compor os valores da data. Quando for sem horas ignora estes valores.
		ds_data_criada_w := '31/12/'||dt_ano_p;
	end if;
	
	-- criar a data e retornar.
	return to_date(ds_data_criada_w,ds_mascara_data_w);
else
	return null;
end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_manipulacao_datas_pck.fim_ano ( dt_ano_p text, ie_com_horas_p text default 'N') FROM PUBLIC;
