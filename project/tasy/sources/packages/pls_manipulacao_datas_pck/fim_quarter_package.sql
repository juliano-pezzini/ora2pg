-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_manipulacao_datas_pck.fim_quarter ( dt_data_p timestamp, ie_com_horas_p text default 'N') RETURNS timestamp AS $body$
DECLARE

			
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Obter a data final de um quarter do ano
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X] Objetos do dicionário [ X] Tasy (Delphi/Java) [X] Portal [X]  Relatórios [X] Outros:
------------------------------------------------------------------------------------------------------------------
Pontos de atenção: 

IE_COM_HORAS_P: Se deve retornar o dia com a última hora informado 23:59:59 

Alterações: 
------------------------------------------------------------------------------------------------------------------
jjung 11/08/2014 - Criação da function
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
							

ds_data_w	varchar(50);
ds_mascara_w	varchar(50);
dt_retorno_w	timestamp;

BEGIN

-- Verifica se a data foi informada
if (dt_data_p IS NOT NULL AND dt_data_p::text <> '') then
	
	-- se for para colocar horas também será considerado o horário 23:59:59 senão trunca a hora.
	if (ie_com_horas_p = 'S') then
	
		ds_mascara_w	:= 'dd/mm/yyyy hh24:mi:ss';
		ds_data_w	:= to_char(dt_data_p, 'dd/mm/yyyy') || ' 23:59:59';
	else
		ds_mascara_w	:= 'dd/mm/yyyy';
		ds_data_w	:= to_char(dt_data_p, ds_mascara_w);
	end if;
	
	-- deduz-se o final do quarter navegando até o próximo, obtendo o primeiro dia e voltando um dia, desta forma você obtém o último dia do quarter
	dt_retorno_w := trunc(add_months(to_date(ds_data_w, ds_mascara_w), 3), 'Q') - 1;
end if;

return dt_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_manipulacao_datas_pck.fim_quarter ( dt_data_p timestamp, ie_com_horas_p text default 'N') FROM PUBLIC;
