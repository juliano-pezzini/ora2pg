-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE techone_pck.update_parameters ( nr_lote_contabil_p bigint, nr_seq_parametro_p bigint, parametros_p batchparameters_tp) AS $body$
DECLARE

					
	cd_tipo_lote_contabil_w		lote_contabil.cd_tipo_lote_contabil%type;
	ie_tipo_parametro_w		tipo_lote_contabil_param.ie_tipo_parametro%type;
	
	
BEGIN
	
	select	max(cd_tipo_lote_contabil)
	into STRICT	cd_tipo_lote_contabil_w
	from	lote_contabil
	where	nr_lote_contabil	= nr_lote_contabil_p;
	
	select	max(a.ie_tipo_parametro)
	into STRICT	ie_tipo_parametro_w
	from	tipo_lote_contabil_param a
	where	a.cd_tipo_lote_contabil	= cd_tipo_lote_contabil_w
	and	a.nr_seq_parametro		= nr_seq_parametro_p;
	
	
	if (ie_tipo_parametro_w	= 3) then
		update	LOTE_CONTABIL_PARAMETRO
		set	DT_PARAMETRO			= parametros_p.DT_PARAMETRO
		where	nr_lote_contabil		= nr_lote_contabil_p
		and	CD_TIPO_LOTE_CONTABIL		= cd_tipo_lote_contabil_w
		and	nr_seq_parametro		= nr_seq_parametro_p;
	elsif (ie_tipo_parametro_w	in (2,5)) then
		update	LOTE_CONTABIL_PARAMETRO
		set	VL_PARAMETRO			= parametros_p.VL_PARAMETRO
		where	nr_lote_contabil		= nr_lote_contabil_p
		and	CD_TIPO_LOTE_CONTABIL		= cd_tipo_lote_contabil_w
		and	nr_seq_parametro		= nr_seq_parametro_p;
	else
		update	LOTE_CONTABIL_PARAMETRO
		set	DS_VALOR_PARAMETRO		= substr(parametros_p.DS_VALOR_PARAMETRO,1,4000),
			DS_VALOR_PARAMETRO_COMPL	= substr(parametros_p.DS_VALOR_PARAMETRO,4001,4000)
		where	nr_lote_contabil		= nr_lote_contabil_p
		and	CD_TIPO_LOTE_CONTABIL		= cd_tipo_lote_contabil_w
		and	nr_seq_parametro		= nr_seq_parametro_p;
		
	end if;
		
	commit;
		
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE techone_pck.update_parameters ( nr_lote_contabil_p bigint, nr_seq_parametro_p bigint, parametros_p batchparameters_tp) FROM PUBLIC;
