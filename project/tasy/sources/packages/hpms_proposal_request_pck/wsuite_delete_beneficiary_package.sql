-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE hpms_proposal_request_pck.wsuite_delete_beneficiary ( nr_seq_prop_benef_p pls_proposta_benef_online.nr_sequencia%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Delete beneficiary from proposal.
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ x] Outros: HTML5
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 

nr_seq_declaracao_w		pls_declaracao_segurado.nr_sequencia%type;


BEGIN

select	max(nr_sequencia)
into STRICT	nr_seq_declaracao_w
from	pls_declaracao_segurado 
where	nr_seq_prop_benef_online	= nr_seq_prop_benef_p;

if (nr_seq_declaracao_w IS NOT NULL AND nr_seq_declaracao_w::text <> '') then
	delete	FROM pls_declaracao_resposta
	where	nr_seq_declaracao	= nr_seq_declaracao_w;
	
	delete	FROM pls_declaracao_segurado
	where	nr_sequencia		= nr_seq_declaracao_w;
end if;

delete	FROM pls_proposta_hist_online
where	nr_seq_prop_benef_online	= nr_seq_prop_benef_p;

delete	FROM pls_proposta_anexo_online
where	nr_seq_prop_benef_online	= nr_seq_prop_benef_p;

delete	FROM pls_proposta_benef_online
where	nr_sequencia	= nr_seq_prop_benef_p;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hpms_proposal_request_pck.wsuite_delete_beneficiary ( nr_seq_prop_benef_p pls_proposta_benef_online.nr_sequencia%type) FROM PUBLIC;
