-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE hpms_proposal_request_pck.wsuite_update_storage (nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Tratamento criado temporariamente, pois os clientes que utilizam Delphi e o portal TWS precisam
atualizar a Storage do HTML5 pois e o mesmo metodo utilizado no TWS.
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ x] Outros: HTML5
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


qt_storage_w			smallint;


BEGIN
CALL CALL CALL CALL CALL hpms_proposal_request_pck.carregar_parametros(cd_estabelecimento_p);

if (current_setting('hpms_proposal_request_pck.ds_diretorio_anexo_w')::pls_param_proposta_online.ds_diretorio_anexo%(type IS NOT NULL AND type::text <> '')) then
	select	count(1)
	into STRICT	qt_storage_w
	from	file_storage_path
	where	nm_storage = 'HPMS_PROPOSAL_ONLINE';
	
	if (qt_storage_w > 0) then
		update	file_storage_path
		set	ds_path = current_setting('hpms_proposal_request_pck.ds_diretorio_anexo_w')::pls_param_proposta_online.ds_diretorio_anexo%type
		where	nm_storage = 'HPMS_PROPOSAL_ONLINE';
	else	
		insert into file_storage_path(nm_storage, cd_uuid, cd_estabelecimento,
			ds_path, ie_writable, ie_readable,
			dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
			nm_usuario_nrec, ie_driver)
		values ( 'HPMS_PROPOSAL_ONLINE', '1fa090ec-85c9-4c67-87a4-91586b0c9c94',cd_estabelecimento_p,
			current_setting('hpms_proposal_request_pck.ds_diretorio_anexo_w')::pls_param_proposta_online.ds_diretorio_anexo%type, 'S', 'S',
			clock_timestamp(), nm_usuario_p, clock_timestamp(),
			nm_usuario_p, 'local');
	end if;
	
	commit;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hpms_proposal_request_pck.wsuite_update_storage (nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type ) FROM PUBLIC;
