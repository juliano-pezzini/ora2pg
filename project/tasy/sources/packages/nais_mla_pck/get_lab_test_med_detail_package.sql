-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE nais_mla_pck.get_lab_test_med_detail ( order_unit_p cpoe_order_unit.nr_order_unit%type, record_p medtreatmentinforedtyp, message_data INOUT text ) AS $body$
DECLARE

        record_w     medtreatmentinforedtyp;
        medical_affair_code nais_conversion_master%rowtype;
        lab_test_material_w cpoe_order_unit.NR_SEQ_MAT_LAB%type;

BEGIN
        PERFORM set_config('nais_mla_pck.ds_line_w', null, false);
        record_w := record_p;
        record_w.nr_data_class := '01';


    
        select coalesce(max(NR_SEQ_MAT_LAB),0)
            into STRICT lab_test_material_w
            from cpoe_order_unit
            where nr_order_unit=order_unit_p;

          if lab_test_material_w <> 0 then
              medical_affair_code := get_medicalaffair_code('B','MATERIAL_EXAME_LAB','NR_SEQUENCIA',lab_test_material_w);--record_w.internal_code
              if (medical_affair_code.cd_medical_affair IS NOT NULL AND medical_affair_code.cd_medical_affair::text <> '') then
                        record_w.internal_code := rpad(medical_affair_code.cd_medical_affair, 6, ' ');
                else
                 record_w.internal_code := rpad('0', 6, ' ');
              end if;
          end if;

                
                
        record_w.dosage := 0;
        record_w.unit := ' ';
        record_w.free_comments := ' ';
        CALL CALL CALL CALL nais_mla_pck.common_med_treatment_info(record_w);
        message_data := current_setting('nais_mla_pck.ds_line_w')::varchar(32767);

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nais_mla_pck.get_lab_test_med_detail ( order_unit_p cpoe_order_unit.nr_order_unit%type, record_p medtreatmentinforedtyp, message_data INOUT text ) FROM PUBLIC;
