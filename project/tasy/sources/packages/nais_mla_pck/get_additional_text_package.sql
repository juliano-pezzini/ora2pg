-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION nais_mla_pck.get_additional_text ( nr_comment_link_seq_p cpoe_comment_linkage.nr_sequencia%type, si_format_value_p cpoe_std_comment.si_format_value%type, nr_additional_text_p cpoe_comment_linkage.nr_additional_text%type, dt_additional_text_p cpoe_comment_linkage.dt_additional_text%type ) RETURNS varchar AS $body$
DECLARE


    ds_additional_comment_w varchar(255);
    nr_index_position_w   smallint;
    nr_integer_part_w   varchar(6);
    nr_decimal_part_w   varchar(3);


BEGIN
        case
            when( si_format_value_p = '0' and (dt_additional_text_p IS NOT NULL AND dt_additional_text_p::text <> '') ) then --Date
                ds_additional_comment_w := rpad(regexp_replace(to_char(dt_additional_text_p, 'YYYY/MM/DD'), '[^0-9]', ''), 9, '0');

            when( si_format_value_p = '1' and (dt_additional_text_p IS NOT NULL AND dt_additional_text_p::text <> '') ) then --Date and time
                ds_additional_comment_w := rpad(regexp_replace(to_char(dt_additional_text_p, 'DD:HH:MI'), '[^0-9]', ''), 9, '0');

            when( si_format_value_p = '2' and (dt_additional_text_p IS NOT NULL AND dt_additional_text_p::text <> '') ) then --Hour and minute
                ds_additional_comment_w := lpad(regexp_replace(to_char(dt_additional_text_p, 'HH'), '[^0-9]', ''), 4, '0')||rpad(regexp_replace(to_char(dt_additional_text_p, 'MI'), '[^0-9]', ''), 5, '0');

            when( si_format_value_p = '3' and (nr_additional_text_p IS NOT NULL AND nr_additional_text_p::text <> '') ) then --Numeric
                select  position('.' in nr_additional_text_p)
                into STRICT    nr_index_position_w
;

                if (nr_index_position_w > 0) then

                    select  substr(nr_additional_text_p, 0, nr_index_position_w - 1),
                            substr(nr_additional_text_p, nr_index_position_w + 1)
                    into STRICT    nr_integer_part_w,
                            nr_decimal_part_w
;

                    ds_additional_comment_w := lpad(nr_integer_part_w, 6, '0') || rpad(nr_decimal_part_w, 3, '0');
                else
                    ds_additional_comment_w := lpad(nr_additional_text_p, 6, '0') || rpad('0', 3, '0');
                end if;
            else
                ds_additional_comment_w := rpad('0', 9, '0');
            end case;
        return ds_additional_comment_w;
   END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION nais_mla_pck.get_additional_text ( nr_comment_link_seq_p cpoe_comment_linkage.nr_sequencia%type, si_format_value_p cpoe_std_comment.si_format_value%type, nr_additional_text_p cpoe_comment_linkage.nr_additional_text%type, dt_additional_text_p cpoe_comment_linkage.dt_additional_text%type ) FROM PUBLIC;
