-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_seguranca.encrypt (texto_p text) RETURNS bytea AS $body$
DECLARE

	l_text_w       varchar(32767) := texto_p;
	l_encrypted_w  bytea;
	ds_chave_w     bytea;
	g_key_w        bytea;
	
BEGIN
		if (texto_p IS NOT NULL AND texto_p::text <> '') then
		        ds_chave_w 	:= wheb_seguranca.gerar_chave();
			g_key_w		:= encode(ds_chave_w::bytea, 'hex')::bytea;
			l_text_w := wheb_seguranca.padstring(l_text_w);
			DBMS_OBFUSCATION_toolkit.desencrypt(	input          => encode(l_text_w::bytea, 'hex')::bytea,
								key            => g_key_w,
								encrypted_data => l_encrypted_w);

			l_encrypted_w	:= substr(ds_chave_w,1,14) || l_encrypted_w || substr(ds_chave_w,15,14);
			RETURN l_encrypted_w;
		else
			RETURN null;
		end if;
	END;



$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_seguranca.encrypt (texto_p text) FROM PUBLIC;
