-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tax_dmed_ir_pck.remove_receivable (sequence_p tax_dmed_dados_gerais.nr_sequencia%type) AS $body$
DECLARE

	nr_contrato_w			pls_contrato.nr_contrato%type;
	cd_responsavel_pagamento_w	pessoa_fisica.cd_pessoa_fisica%type;
	nr_seq_lote_w			tax_dmed_lote.nr_sequencia%type;

BEGIN
	select	max(b.nr_contrato),
		max(a.cd_responsavel_pagamento),
		max(c.nr_seq_lote)
	into STRICT	nr_contrato_w,
		cd_responsavel_pagamento_w,
		nr_seq_lote_w
	from	tax_dmed_dados_gerais a,
		fis_dados_dmed b,
		tax_dmed_lote_mensal c
	where	b.nr_sequencia = a.nr_seq_dados_dmed
	and	c.nr_sequencia = a.nr_seq_lote_mensal
	and	a.nr_sequencia = sequence_p;

      delete from tax_dmed_dados_gerais
      where nr_sequencia = sequence_p;

      CALL tax_dmed_ir_pck.update_payer_amount_irpf(nr_contrato_w, cd_responsavel_pagamento_w, nr_seq_lote_w);

  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_dmed_ir_pck.remove_receivable (sequence_p tax_dmed_dados_gerais.nr_sequencia%type) FROM PUBLIC;
