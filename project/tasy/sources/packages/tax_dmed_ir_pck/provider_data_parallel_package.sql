-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tax_dmed_ir_pck.provider_data_parallel (job_code_p bigint, batch_monthly_sequence_p tax_dmed_lote_mensal.nr_sequencia%type, queue_sequence_p bigint) AS $body$
DECLARE

      sequence_queue_w    fis_fila_arquivo.nr_sequencia%type;

BEGIN
      PERFORM set_config('tax_dmed_ir_pck.batch_monthly_sequence', batch_monthly_sequence_p, false);
      CALL tax_dmed_ir_pck.load_general_rule();
      CALL tax_parallel_procedure_pck.update_sid(queue_sequence_p, job_code_p);

      for i in current_setting('tax_dmed_ir_pck.establishment_vector')::establishment_type.first .. current_setting('tax_dmed_ir_pck.establishment_vector')::establishment_type.last loop	   
        PERFORM set_config('tax_dmed_ir_pck.reference_establishment', current_setting('tax_dmed_ir_pck.establishment_vector')::establishment_type[i].cd_estabelecimento, false);
        CALL tax_dmed_ir_pck.generate_provider_data();
      end loop;

      CALL tax_parallel_procedure_pck.update_status(queue_sequence_p, 3);
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_dmed_ir_pck.provider_data_parallel (job_code_p bigint, batch_monthly_sequence_p tax_dmed_lote_mensal.nr_sequencia%type, queue_sequence_p bigint) FROM PUBLIC;
