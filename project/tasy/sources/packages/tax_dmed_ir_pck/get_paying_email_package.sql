-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tax_dmed_ir_pck.get_paying_email ( cd_pagador_p pessoa_fisica.cd_pessoa_fisica%type, nr_contrato_p pls_contrato.nr_contrato%type) RETURNS varchar AS $body$
DECLARE


ds_email_w		varchar(255);


BEGIN

select	CASE WHEN coalesce(ds_email::text, '') = '' THEN  obter_email_pf(cd_pagador_p)  ELSE ds_email END
into STRICT	ds_email_w
from	pls_contrato_pagador
where	nr_sequencia = (SELECT	max(a.nr_sequencia)
			from	pls_contrato_pagador a,
				pls_contrato b
			where	b.nr_sequencia = a.nr_seq_contrato
			and	b.nr_contrato = nr_contrato_p
			and	a.cd_pessoa_fisica = cd_pagador_p);

return ds_email_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tax_dmed_ir_pck.get_paying_email ( cd_pagador_p pessoa_fisica.cd_pessoa_fisica%type, nr_contrato_p pls_contrato.nr_contrato%type) FROM PUBLIC;
