-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tax_dmed_ir_pck.add_data_file (file_content_p tax_dmed_arquivo.ds_arquivo%type, type_record_p text, compl_file_content_p tax_dmed_arquivo.ds_arquivo_compl%type default null) AS $body$
DECLARE

                          new_sequence    tax_dmed_arquivo.nr_sequencia%type;

BEGIN
      select  nextval('tax_dmed_arquivo_seq')
      into STRICT    new_sequence
;

      PERFORM set_config('tax_dmed_ir_pck.file_data_table_count', current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint + 1, false);

      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).nr_sequencia         :=  new_sequence;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).dt_atualizacao       :=  clock_timestamp();
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).nm_usuario           :=  current_setting('tax_dmed_ir_pck.generation_user')::tax_dmed_arquivo.nm_usuario%type;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).dt_atualizacao_nrec  :=  clock_timestamp();
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).nm_usuario_nrec      :=  current_setting('tax_dmed_ir_pck.generation_user')::tax_dmed_arquivo.nm_usuario%type;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).nr_seq_controle      :=  current_setting('tax_dmed_ir_pck.file_control_sequence')::tax_dmed_arquivo.nr_sequencia%type;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).nr_linha             :=  current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).ds_arquivo           :=  file_content_p;
      current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).cd_registro          :=  type_record_p;

      if (compl_file_content_p IS NOT NULL AND compl_file_content_p::text <> '') then
          current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type(current_setting('tax_dmed_ir_pck.file_data_table_count')::bigint).ds_arquivo_compl :=  compl_file_content_p;
      end if;

      if current_setting('tax_dmed_ir_pck.file_data_table')::general_file_data_type.count >= 1000 then
          CALL tax_dmed_ir_pck.write_file_data_table();
      end if;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_dmed_ir_pck.add_data_file (file_content_p tax_dmed_arquivo.ds_arquivo%type, type_record_p text, compl_file_content_p tax_dmed_arquivo.ds_arquivo_compl%type default null) FROM PUBLIC;
