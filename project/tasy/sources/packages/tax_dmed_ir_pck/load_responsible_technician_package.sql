-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tax_dmed_ir_pck.load_responsible_technician () AS $body$
DECLARE

      file_content tax_dmed_arquivo.ds_arquivo%type;

BEGIN
    begin
        select	'RESPO' 				                                                                    || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                lpad(p.nr_cpf, 11, '0')			                                                        || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(fis_remove_special_characters(p.nm_pessoa_fisica), 1, 60)                    || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(c.nr_ddd_telefone, 1, 2)		                                                  || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(c.nr_telefone, 1, 8)		                                                      || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(c.nr_ramal, 1, 6)			                                                      || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(c.ds_fax, 1, 8)			                                                        || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1) ||
                substr(c.ds_email, 1, 50)			                                                      || current_setting('tax_dmed_ir_pck.data_separator')::varchar(1)
        into STRICT	file_content	
        FROM pessoa_fisica p
LEFT OUTER JOIN compl_pessoa_fisica c ON (p.cd_pessoa_fisica = c.cd_pessoa_fisica)
WHERE c.ie_tipo_complemento	= 2 and p.cd_pessoa_fisica	    = current_setting('tax_dmed_ir_pck.control_table')::generalda_control_type[1].cd_responsavel_dados;
    exception
    when others then
    CALL wheb_mensagem_pck.exibir_mensagem_abort(1131175);
    end;
    CALL tax_dmed_ir_pck.add_data_file(file_content, 'RESPO');
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_dmed_ir_pck.load_responsible_technician () FROM PUBLIC;
