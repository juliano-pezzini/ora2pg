-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tax_dmed_ir_pck.process_monitor_parallel (job_code_p bigint, batch_monthly_sequence_p tax_dmed_lote_mensal.nr_sequencia%type, username_p text, profile_code_p bigint, languege_code_p bigint) AS $body$
DECLARE

      is_running_w    bigint := 1;
      message_w       varchar(200);
      status_w        integer;

BEGIN
      while is_running_w > 0 
      loop
          select  count(*)
          into STRICT    is_running_w
          from    fis_fila_arquivo
          where   nr_seq_lote = batch_monthly_sequence_p
          and     ie_status = 2;

          CALL tax_parallel_procedure_pck.sleep(5);
      end loop;

      update  tax_dmed_lote_mensal
      set     dt_geracao = clock_timestamp()
      where   nr_sequencia = batch_monthly_sequence_p;
      commit;

      CALL tax_parallel_procedure_pck.add_notification(1108697, languege_code_p, username_p, profile_code_p, 1, 6, batch_monthly_sequence_p);
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tax_dmed_ir_pck.process_monitor_parallel (job_code_p bigint, batch_monthly_sequence_p tax_dmed_lote_mensal.nr_sequencia%type, username_p text, profile_code_p bigint, languege_code_p bigint) FROM PUBLIC;
