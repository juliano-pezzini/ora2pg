-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pde.trata_array () AS $body$
DECLARE

      COUNT_WITH_ENC_W    bigint := 0;
      COUNT_WITHOUT_ENC_W bigint := 0;
      INDEX_DEL_W         bigint;
      LIST_ID_W           varchar(4000);

BEGIN
      FOR I IN 1 .. current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T.COUNT LOOP
        IF (current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T[I](.NR_ATENDIMENTO IS NOT NULL AND .NR_ATENDIMENTO::text <> '')) THEN
          COUNT_WITH_ENC_W := COUNT_WITH_ENC_W + 1;
        ELSE
          COUNT_WITHOUT_ENC_W := COUNT_WITHOUT_ENC_W + 1;
        END IF;
      END LOOP;

      IF (COUNT_WITH_ENC_W = 1 AND COUNT_WITHOUT_ENC_W = 1) THEN
        FOR I IN 1 .. current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T.COUNT LOOP
          IF (current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T[I]coalesce(.NR_ATENDIMENTO::text, '') = '') THEN
            INDEX_DEL_W := I;
            LIST_ID_W   := current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T[I].LIST_ID;
          END IF;
        END LOOP;

        current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T.DELETE(INDEX_DEL_W);
        current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T(current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T.COUNT).LIST_ID := current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T(current_setting('pde.number_set_w')::PDE.NUMBER_ROW_DATA_T.COUNT)
                                                   .LIST_ID || ',' ||
                                                    LIST_ID_W;
      END IF;
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pde.trata_array () FROM PUBLIC;
