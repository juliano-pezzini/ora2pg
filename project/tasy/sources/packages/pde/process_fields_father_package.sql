-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pde.process_fields_father (NM_TAB_FATHER_P text) AS $body$
DECLARE

      NM_TAB_CHILD_W       PDE_ATTRIBUTE.NM_TABELA_FK%TYPE;
      NM_CONS_TAB_CHILD_W  PDE_ATTRIBUTE.NM_FK_TABELA_FK%TYPE;
      NM_CONS_TAB_FATHER_W PDE_ATTRIBUTE.NM_FK_TABELA_FK%TYPE;

BEGIN
      SELECT PA.NM_TABELA, PA.NM_FK_TABELA_FK
        INTO STRICT NM_TAB_CHILD_W, NM_CONS_TAB_CHILD_W
        FROM PDE_ATTRIBUTE PA
       WHERE coalesce(PA.IE_SITUACAO, 'A') = 'A'
         AND PA.NM_TABELA_FK = NM_TAB_FATHER_P
         AND (PA.NM_FK_TABELA_FK IS NOT NULL AND PA.NM_FK_TABELA_FK::text <> '')
         AND (PA.NM_TABELA IS NOT NULL AND PA.NM_TABELA::text <> '')
         AND (PA.NM_ATRIBUTO IS NOT NULL AND PA.NM_ATRIBUTO::text <> '')  LIMIT 1;

      SELECT UC.R_CONSTRAINT_NAME
        INTO STRICT NM_CONS_TAB_FATHER_W
        FROM USER_CONSTRAINTS UC
       WHERE UC.TABLE_NAME = NM_TAB_CHILD_W
         AND UC.CONSTRAINT_NAME = NM_CONS_TAB_CHILD_W;

      CALL pde.process_fk_values(NM_TAB_FATHER_P, NM_CONS_TAB_FATHER_W);
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pde.process_fields_father (NM_TAB_FATHER_P text) FROM PUBLIC;
