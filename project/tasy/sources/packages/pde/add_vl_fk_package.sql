-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pde.add_vl_fk (NM_TABELA_P PDE_STAGE.NM_TABELA%TYPE, VL_FK_1_P PDE_STAGE.VL_FK_1%TYPE, VL_FK_2_P PDE_STAGE.VL_FK_2%TYPE, VL_FK_3_P PDE_STAGE.VL_FK_3%TYPE, VL_FK_4_P PDE_STAGE.VL_FK_4%TYPE) AS $body$
DECLARE

        COUNT_W bigint := 0;

BEGIN
        IF ((NM_TABELA_P IS NOT NULL AND NM_TABELA_P::text <> '') AND ((VL_FK_1_P IS NOT NULL AND VL_FK_1_P::text <> '') OR (VL_FK_2_P IS NOT NULL AND VL_FK_2_P::text <> '') OR
           (VL_FK_3_P IS NOT NULL AND VL_FK_3_P::text <> '') OR (VL_FK_4_P IS NOT NULL AND VL_FK_4_P::text <> ''))) THEN
          FOR I IN 1 .. VL_FK_ROW_DATA_P.COUNT LOOP
            IF (VL_FK_ROW_DATA_P[I].NM_TABELA = NM_TABELA_P AND
                coalesce(VL_FK_ROW_DATA_P[I].VL_FK_1, '#@#@') =
                coalesce(VL_FK_1_P, '#@#@') AND
                coalesce(VL_FK_ROW_DATA_P[I].VL_FK_2, '#@#@') =
                coalesce(VL_FK_2_P, '#@#@') AND
                coalesce(VL_FK_ROW_DATA_P[I].VL_FK_3, '#@#@') =
                coalesce(VL_FK_3_P, '#@#@') AND
                coalesce(VL_FK_ROW_DATA_P[I].VL_FK_4, '#@#@') =
                coalesce(VL_FK_4_P, '#@#@')) THEN
              COUNT_W := COUNT_W + 1;
            END IF;
          END LOOP;

          IF (COUNT_W = 0) THEN
            VL_FK_ROW_DATA_P.EXTEND;
            VL_FK_ROW_DATA_P[VL_FK_ROW_DATA_P.COUNT].NM_TABELA := NM_TABELA_P;
            VL_FK_ROW_DATA_P[VL_FK_ROW_DATA_P.COUNT].VL_FK_1 := VL_FK_1_P;
            VL_FK_ROW_DATA_P[VL_FK_ROW_DATA_P.COUNT].VL_FK_2 := VL_FK_2_P;
            VL_FK_ROW_DATA_P[VL_FK_ROW_DATA_P.COUNT].VL_FK_3 := VL_FK_3_P;
            VL_FK_ROW_DATA_P[VL_FK_ROW_DATA_P.COUNT].VL_FK_4 := VL_FK_4_P;
          END IF;
        END IF;
      END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pde.add_vl_fk (NM_TABELA_P PDE_STAGE.NM_TABELA%TYPE, VL_FK_1_P PDE_STAGE.VL_FK_1%TYPE, VL_FK_2_P PDE_STAGE.VL_FK_2%TYPE, VL_FK_3_P PDE_STAGE.VL_FK_3%TYPE, VL_FK_4_P PDE_STAGE.VL_FK_4%TYPE) FROM PUBLIC;
