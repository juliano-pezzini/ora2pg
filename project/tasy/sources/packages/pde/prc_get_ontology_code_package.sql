-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pde.prc_get_ontology_code (CD_SEQ_RECORD_P text, IE_GROUP_P text, DS_TYPE_P text, CD_ONTOLOGY_P INOUT text, CD_ONTOLOGY2_P INOUT text, CD_ONTOLOGY3_P INOUT text, CD_ONTOLOGY4_P INOUT text, CD_ONTOLOGY5_P INOUT text, CD_ONTOLOGY6_P INOUT text, CD_ONTOLOGY7_P INOUT text, NR_SEQ_RES_CAD_ONT_P INOUT bigint) AS $body$
BEGIN
    IF DS_TYPE_P = 'GROUP' THEN
      SELECT MAX(PHI.NR_SEQUENCIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA2) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA3) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA4) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA5) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA6) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA7) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA)
        INTO STRICT NR_SEQ_RES_CAD_ONT_P,
             CD_ONTOLOGY_P,
             CD_ONTOLOGY2_P,
             CD_ONTOLOGY3_P,
             CD_ONTOLOGY4_P,
             CD_ONTOLOGY5_P,
             CD_ONTOLOGY6_P,
             CD_ONTOLOGY7_P
        FROM RES_CADASTRO_ONTOLOGIA_PHI PHI
       WHERE UPPER(PHI.IE_ONTOLOGIA) = 'SNO'
         AND PHI.NM_TABELA = 'ONTOLOGIA_LISTA_W'
         AND PHI.IE_GRUPO = IE_GROUP_P
         AND UPPER(PHI.NM_ATRIBUTO) = 'NULL'
         AND coalesce(PHI.NR_SEQ_ATRIB_GRUPO::text, '') = ''
         AND coalesce(PHI.CD_VALOR_TASY::text, '') = '';

    ELSIF DS_TYPE_P = 'TABLE' THEN
      SELECT MAX(PHI.NR_SEQUENCIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA2) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA3) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA4) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA5) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA6) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA7) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA)
        INTO STRICT NR_SEQ_RES_CAD_ONT_P,
             CD_ONTOLOGY_P,
             CD_ONTOLOGY2_P,
             CD_ONTOLOGY3_P,
             CD_ONTOLOGY4_P,
             CD_ONTOLOGY5_P,
             CD_ONTOLOGY6_P,
             CD_ONTOLOGY7_P
        FROM RES_CADASTRO_ONTOLOGIA_PHI PHI
       INNER JOIN ONTOLOGIA_TABELA OT ON PHI.NM_TABELA = OT.NM_TABELA
       WHERE OT.NR_SEQUENCIA = (CD_SEQ_RECORD_P)::numeric 
         AND UPPER(IE_ONTOLOGIA) = 'SNO'
         AND UPPER(PHI.NM_ATRIBUTO) = 'NULL'
         AND coalesce(PHI.NR_SEQ_ATRIB_GRUPO::text, '') = ''
         AND coalesce(PHI.CD_VALOR_TASY::text, '') = '';

    ELSIF DS_TYPE_P = 'ATTRIBUTE_GROUP' THEN
      SELECT MAX(PHI.NR_SEQUENCIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA2) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA3) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA4) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA5) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA6) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA7) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA)
        INTO STRICT NR_SEQ_RES_CAD_ONT_P,
             CD_ONTOLOGY_P,
             CD_ONTOLOGY2_P,
             CD_ONTOLOGY3_P,
             CD_ONTOLOGY4_P,
             CD_ONTOLOGY5_P,
             CD_ONTOLOGY6_P,
             CD_ONTOLOGY7_P
        FROM ONTOLOGIA_TAB_ATRIB_GRUPO OTAG
       INNER JOIN RES_CADASTRO_ONTOLOGIA_PHI PHI ON PHI.NR_SEQ_ATRIB_GRUPO =
                                                    OTAG.NR_SEQUENCIA
       INNER JOIN ONTOLOGIA_TABELA OT ON OT.NM_TABELA = PHI.NM_TABELA
       WHERE OTAG.NR_SEQUENCIA = (CD_SEQ_RECORD_P)::numeric 
         AND UPPER(PHI.IE_ONTOLOGIA) = 'SNO'
         AND (PHI.NM_TABELA IS NOT NULL AND PHI.NM_TABELA::text <> '')
         AND coalesce(PHI.CD_VALOR_TASY::text, '') = '';
    ELSE
      SELECT MAX(PHI.NR_SEQUENCIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA2) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA3) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA4) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA5) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA6) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA),
             MAX(PHI.CD_VALOR_ONTOLOGIA7) KEEP(DENSE_RANK FIRST ORDER BY PHI.NR_SEQUENCIA)
        INTO STRICT NR_SEQ_RES_CAD_ONT_P,
             CD_ONTOLOGY_P,
             CD_ONTOLOGY2_P,
             CD_ONTOLOGY3_P,
             CD_ONTOLOGY4_P,
             CD_ONTOLOGY5_P,
             CD_ONTOLOGY6_P,
             CD_ONTOLOGY7_P
        FROM RES_CADASTRO_ONTOLOGIA_PHI PHI
       INNER JOIN ONTOLOGIA_TABELA_ATRIBUTO OTA ON PHI.NM_TABELA =
                                                   OTA.NM_TABELA
                                               AND PHI.NM_ATRIBUTO =
                                                   OTA.NM_ATRIBUTO
       INNER JOIN ONTOLOGIA_TABELA OT ON OT.NM_TABELA = OTA.NM_TABELA
       WHERE OTA.NR_SEQUENCIA = (CD_SEQ_RECORD_P)::numeric
         AND UPPER(PHI.IE_ONTOLOGIA) = 'SNO'
         AND coalesce(PHI.CD_VALOR_TASY::text, '') = ''  LIMIT 1;

    END IF;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pde.prc_get_ontology_code (CD_SEQ_RECORD_P text, IE_GROUP_P text, DS_TYPE_P text, CD_ONTOLOGY_P INOUT text, CD_ONTOLOGY2_P INOUT text, CD_ONTOLOGY3_P INOUT text, CD_ONTOLOGY4_P INOUT text, CD_ONTOLOGY5_P INOUT text, CD_ONTOLOGY6_P INOUT text, CD_ONTOLOGY7_P INOUT text, NR_SEQ_RES_CAD_ONT_P INOUT bigint) FROM PUBLIC;
