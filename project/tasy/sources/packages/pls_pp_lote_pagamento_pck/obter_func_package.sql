-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_pp_lote_pagamento_pck.obter_func (nr_seq_lote_p pls_pp_lote.nr_sequencia%type, nr_seq_prestador_p pls_prestador.nr_sequencia%type, dt_referencia_p timestamp) RETURNS varchar AS $body$
DECLARE

ds_retorno_w	varchar(5);
-- Utilizado em holerite do portal para nao gerar holerite de lote duplicado


BEGIN
select	CASE WHEN count(1)=0 THEN '1'  ELSE '2' END  -- 1. Pagamento Antigo / 2. Pagamento Novo
into STRICT	ds_retorno_w
from	pls_pp_prestador p,
	pls_pp_lote	l
where	l.nr_sequencia		= p.nr_seq_lote
and	l.nr_sequencia		= nr_seq_lote_p
and	p.nr_seq_prestador	= nr_seq_prestador_p
and	trunc(l.dt_mes_competencia) > trunc(dt_referencia_p)  LIMIT 1;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_pp_lote_pagamento_pck.obter_func (nr_seq_lote_p pls_pp_lote.nr_sequencia%type, nr_seq_prestador_p pls_prestador.nr_sequencia%type, dt_referencia_p timestamp) FROM PUBLIC;
