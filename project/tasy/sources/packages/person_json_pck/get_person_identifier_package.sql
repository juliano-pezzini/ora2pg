-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION person_json_pck.get_person_identifier (CD_PESSOA_FISICA_P text) RETURNS PHILIPS_JSON AS $body$
DECLARE

    JSON_IDENTIFIER_W PHILIPS_JSON := PHILIPS_JSON();

    CD_RFC_W                    PESSOA_FISICA.CD_RFC%TYPE;
    NR_CNH_W                    PESSOA_FISICA.NR_CNH%TYPE;
    NR_PRONT_EXT_W              PESSOA_FISICA.NR_PRONT_EXT%TYPE;
    CD_PESSOA_FISICA_EXTERNO_W  PF_CODIGO_EXTERNO.CD_PESSOA_FISICA_EXTERNO%TYPE;
    ALTERNATE_PATIENT_NUM_EXT_W PF_CODIGO_EXTERNO.ALTERNATE_PATIENT_NUM_EXT%TYPE;
    ACCOUNT_NUMBER_EXT_W        PF_CODIGO_EXTERNO.ACCOUNT_NUMBER_EXT%TYPE;
    HEALTH_CARD_EXT_W           PF_CODIGO_EXTERNO.HEALTH_CARD_EXT%TYPE;
    MEDICAID_NUMBER_EXT_W       PF_CODIGO_EXTERNO.MEDICAID_NUMBER_EXT%TYPE;
    MEDICARE_NUMBER_EXT_W       PF_CODIGO_EXTERNO.MEDICARE_NUMBER_EXT%TYPE;
    CD_PESSOA_IDENTIFIER_EXT_W  PF_CODIGO_EXTERNO.CD_PESSOA_IDENTIFIER_EXT%TYPE;
    PREADMIT_NUMBER_EXT_W       PF_CODIGO_EXTERNO.PREADMIT_NUMBER_EXT%TYPE;
    VISIT_NUMBER_EXT_W          PF_CODIGO_EXTERNO.VISIT_NUMBER_EXT%TYPE;

BEGIN
    SELECT PF.CD_RFC,
           PF.NR_CNH,
           PF.NR_PRONT_EXT,
           PFE.CD_PESSOA_FISICA_EXTERNO,
           PFE.ALTERNATE_PATIENT_NUM_EXT,
           PFE.ACCOUNT_NUMBER_EXT,
           PFE.HEALTH_CARD_EXT,
           PFE.MEDICAID_NUMBER_EXT,
           PFE.MEDICARE_NUMBER_EXT,
           PFE.CD_PESSOA_IDENTIFIER_EXT,
           PFE.PREADMIT_NUMBER_EXT,
           PFE.VISIT_NUMBER_EXT
      INTO STRICT CD_RFC_W,
           NR_CNH_W,
           NR_PRONT_EXT_W,
           CD_PESSOA_FISICA_EXTERNO_W,
           ALTERNATE_PATIENT_NUM_EXT_W,
           ACCOUNT_NUMBER_EXT_W,
           HEALTH_CARD_EXT_W,
           MEDICAID_NUMBER_EXT_W,
           MEDICARE_NUMBER_EXT_W,
           CD_PESSOA_IDENTIFIER_EXT_W,
           PREADMIT_NUMBER_EXT_W,
           VISIT_NUMBER_EXT_W
      FROM PESSOA_FISICA PF
      LEFT JOIN PF_CODIGO_EXTERNO PFE ON (PFE.CD_PESSOA_FISICA = PF.CD_PESSOA_FISICA)
     WHERE PF.CD_PESSOA_FISICA = CD_PESSOA_FISICA_P  LIMIT 1;

    JSON_IDENTIFIER_W.PUT('ssnNumber', CD_RFC_W);
    JSON_IDENTIFIER_W.PUT('driverLicenceNumber', NR_CNH_W);
    JSON_IDENTIFIER_W.PUT('externalMedicalRecordNumber', NR_PRONT_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalId', CD_PESSOA_FISICA_EXTERNO_W);
    JSON_IDENTIFIER_W.PUT('alternateId', ALTERNATE_PATIENT_NUM_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalAccountNumber', ACCOUNT_NUMBER_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalHealthCardNumber', HEALTH_CARD_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalMedicaidNumber', MEDICAID_NUMBER_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalMedicareNumber', MEDICARE_NUMBER_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalIdentifierId', CD_PESSOA_IDENTIFIER_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalPreadmitNumber', PREADMIT_NUMBER_EXT_W);
    JSON_IDENTIFIER_W.PUT('externalVisitNumber', VISIT_NUMBER_EXT_W);

    RETURN JSON_IDENTIFIER_W;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION person_json_pck.get_person_identifier (CD_PESSOA_FISICA_P text) FROM PUBLIC;
