-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_demonstrativo_pgto_pck.obter_tiss_termo_cred_deb ( cd_tributo_p tributo.cd_tributo%type, nr_seq_evento_p pls_evento.nr_sequencia%type) RETURNS SETOF T_TISS_CRED_DEB_TAB_DATA AS $body$
DECLARE


nr_seq_termo_cred_deb_w		tributo.nr_seq_termo_cred_deb%type;
t_tiss_cred_deb_tab_row_w	t_tiss_cred_deb_tab_row;


BEGIN

if (cd_tributo_p IS NOT NULL AND cd_tributo_p::text <> '') then

	select	max(nr_seq_termo_cred_deb)
	into STRICT	nr_seq_termo_cred_deb_w
	from	tributo
	where	cd_tributo = cd_tributo_p;

elsif (nr_seq_evento_p IS NOT NULL AND nr_seq_evento_p::text <> '') then

	select	max(nr_seq_termo_cred_deb)
	into STRICT	nr_seq_termo_cred_deb_w
	from	pls_evento
	where	nr_sequencia = nr_seq_evento_p;
end if;

if (coalesce(nr_seq_termo_cred_deb_w::text, '') = '') then

	t_tiss_cred_deb_tab_row_w.cd_termo 	:= '00';
	t_tiss_cred_deb_tab_row_w.nr_sequencia	:= null;
else
	select	max(nr_sequencia),
		max(cd_termo)
	into STRICT	t_tiss_cred_deb_tab_row_w.nr_sequencia,
		t_tiss_cred_deb_tab_row_w.cd_termo
	from	pls_tiss_termo_cred_deb
	where	nr_sequencia = nr_seq_termo_cred_deb_w;
end if;

RETURN NEXT t_tiss_cred_deb_tab_row_w;

return;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_demonstrativo_pgto_pck.obter_tiss_termo_cred_deb ( cd_tributo_p tributo.cd_tributo%type, nr_seq_evento_p pls_evento.nr_sequencia%type) FROM PUBLIC;
