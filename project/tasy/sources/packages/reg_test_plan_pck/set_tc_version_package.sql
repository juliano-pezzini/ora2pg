-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE reg_test_plan_pck.set_tc_version (nr_seq_intencao_uso_p bigint default 2) AS $body$
DECLARE


	ds_versao_w		reg_tc_pendencies.ds_version%type;
	ie_plano_ant_gerado_w	varchar(1);

	
BEGIN

		ds_versao_w := obter_versao_tasy_data(clock_timestamp(), 'V', nr_seq_intencao_uso_p);

		select	CASE WHEN count(1)=0 THEN  'N'  ELSE 'S' END
		into STRICT	ie_plano_ant_gerado_w
		from	reg_plano_teste_controle
		where	cd_versao = ds_versao_w;

		if (ie_plano_ant_gerado_w = 'N') then
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.cd_versao := ds_versao_w;
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.dt_inicio_versao := obter_datas_versao('I', ds_versao_w);
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.dt_fim_versao := obter_datas_versao('F', ds_versao_w);
		else
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.cd_versao := substr(ds_versao_w, 1, instr(ds_versao_w, '.', 1, 2)) || to_char((substr(ds_versao_w, instr(ds_versao_w, '.', 1, 2) + 1, length(ds_versao_w)))::numeric  + 1);
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.dt_inicio_versao := obter_datas_versao('I');
			current_setting('reg_test_plan_pck.t_tc_version_w')::t_tc_version.dt_fim_versao := obter_datas_versao('F');
		end if;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_test_plan_pck.set_tc_version (nr_seq_intencao_uso_p bigint default 2) FROM PUBLIC;
