-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE reg_test_plan_pck.insert_reg_tc_so_dev (nr_seq_service_order_p bigint, nr_seq_pendency_p bigint, nm_usuario_p text) AS $body$
DECLARE


	nr_seq_ordem_serv_w	man_ordem_servico.nr_sequencia%type;

	
BEGIN

	begin
		nr_seq_ordem_serv_w := coalesce(man_obter_os_ccb(nr_seq_service_order_p),nr_seq_service_order_p);
	exception
	when others then
		nr_seq_ordem_serv_w := nr_seq_service_order_p;
	end;

		insert into reg_tc_so_dev(
			nr_sequencia,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			nr_seq_service_order,
			nr_seq_pendency)
		SELECT
			nextval('reg_tc_so_dev_seq'), 
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nr_seq_ordem_serv_w,
			nr_seq_pendency_p
		 
		where not exists (	SELECT	1
					from	reg_tc_so_dev 
					where	nr_seq_pendency = nr_seq_pendency_p 
					and	nr_seq_service_order = nr_seq_service_order_p);
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_test_plan_pck.insert_reg_tc_so_dev (nr_seq_service_order_p bigint, nr_seq_pendency_p bigint, nm_usuario_p text) FROM PUBLIC;
