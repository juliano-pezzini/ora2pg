-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION reg_test_plan_pck.get_prs_list_preview ( nr_seq_intencao_uso_p bigint default null) RETURNS SETOF T_TC_TABLE AS $body$
DECLARE


	t_tc_row_w		t_tc_row;

	c_prs_list CURSOR FOR
	SELECT	tcp.ie_tipo_mudanca,
		tcp.nr_seq_pr nr_seq_product_req,
		tcp.nr_seq_tc nr_seq_caso_teste,
		tcp.cd_funcao,
        (SELECT coalesce(max('S'), 'N')
           from reg_product_req_type rt
          where rt.nr_seq_type = 12
            and rt.nr_seq_product_req = ct.nr_seq_product) ie_matriz_risco
	from	reg_tc_pendencies tcp,
		reg_caso_teste ct
	where (coalesce(nr_seq_intencao_uso_p::text, '') = '' or coalesce(tcp.nr_seq_intencao_uso,nr_seq_intencao_uso_p) = nr_seq_intencao_uso_p)
	and	tcp.nr_seq_tc = ct.nr_sequencia
	and	coalesce(tcp.ds_version::text, '') = '';

	
BEGIN

		for r_c_prs_list in c_prs_list loop
			t_tc_row_w.ie_tipo_mudanca := r_c_prs_list.ie_tipo_mudanca;
			t_tc_row_w.nr_seq_product_req := r_c_prs_list.nr_seq_product_req;
			t_tc_row_w.nr_seq_caso_teste := r_c_prs_list.nr_seq_caso_teste;
			t_tc_row_w.cd_funcao := r_c_prs_list.cd_funcao;
			t_tc_row_w.ie_matriz_risco := r_c_prs_list.ie_matriz_risco;

			RETURN NEXT t_tc_row_w;
		end loop;

	return;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION reg_test_plan_pck.get_prs_list_preview ( nr_seq_intencao_uso_p bigint default null) FROM PUBLIC;
