-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE nais_mla_treatment.get_action_code_med_detail ( messagetype_p text, record_p medtreatmentinforedtyp, message_data INOUT text, nr_seq_gasoterapia_p bigint ) AS $body$
DECLARE

        record_w     medtreatmentinforedtyp;
        actioncode   varchar(10);
        medical_affair_code NAIS_CONVERSION_MASTER%rowtype;
        ie_respiracao_w varchar(10);

BEGIN
        PERFORM set_config('nais_mla_treatment.ds_line_w', null, false);
        record_w := record_p;
        record_w.nr_data_class := '01';
        case
            when( messagetype_p = 'P0' ) then

                record_w.internal_code := rpad('.4000', 6, ' ');

        end case;

        begin
        select      a.ie_respiracao 
        into STRICT        ie_respiracao_w
        from        cpoe_gasoterapia a,
                    prescr_gasoterapia b,
                    valor_dominio_v c,
                    prescr_gasoterapia_evento d     
        where       a.ie_respiracao = c.vl_dominio 
        and         b.nr_seq_gas_cpoe = a.nr_sequencia 
        and         b.nr_sequencia = d.nr_seq_gasoterapia
        and         d.nr_seq_gasoterapia = nr_seq_gasoterapia_p  LIMIT 1;
        exception
		when        no_data_found then
                    ie_respiracao_w:= null;
		end;

        medical_affair_code := get_medicalaffair_code('PC','valor_dominio_v','VL_DOMINIO',ie_respiracao_w);
        record_w.internal_code := rpad(medical_affair_code.CD_MEDICAL_ACTION, 6, ' ');
        record_w.dosage := 0;
        record_w.unit := ' ';
        record_w.free_comments := ' ';
        CALL CALL CALL CALL nais_mla_treatment.common_med_treatment_info(record_w);
        message_data := current_setting('nais_mla_treatment.ds_line_w')::varchar(32767);
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nais_mla_treatment.get_action_code_med_detail ( messagetype_p text, record_p medtreatmentinforedtyp, message_data INOUT text, nr_seq_gasoterapia_p bigint ) FROM PUBLIC;
