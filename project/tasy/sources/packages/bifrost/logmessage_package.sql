-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE bifrost.logmessage ( bifrostMessageId text, eventName text, javaClass text, content text, resultValue text, userName text, errorMessage text ) AS $body$
DECLARE

    nextSequence integer := 0;

BEGIN
    select nextval('bifrost_layer_log_seq') into STRICT nextSequence;
    delete from bifrost_layer_log where nr_sequence = nextSequence;

    if (errorMessage IS NOT NULL AND errorMessage::text <> '') then
        insert into bifrost_layer_log(nr_sequence, dt_integration, ds_message_id, nm_event, nm_java_class, ds_content, ds_result, ie_delivered, ds_message_error, nm_usuario, cd_estabelecimento, ds_call_stack) values (nextSequence, clock_timestamp(), bifrostMessageId, eventName, javaClass, content, resultValue, 'N', errorMessage, coalesce(wheb_usuario_pck.get_nm_usuario, userName), wheb_usuario_pck.get_cd_estabelecimento, substr(dbms_utility.format_call_stack,1,4000));
    else
        insert into bifrost_layer_log(nr_sequence, dt_integration, ds_message_id, nm_event, nm_java_class, ds_content, ds_result, ie_delivered, nm_usuario, cd_estabelecimento, ds_call_stack) values (nextSequence, clock_timestamp(), bifrostMessageId, eventName, javaClass, content, resultValue, 'S', coalesce(wheb_usuario_pck.get_nm_usuario, userName), wheb_usuario_pck.get_cd_estabelecimento, substr(dbms_utility.format_call_stack,1,4000));
    end if;

    commit;

END;

$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE bifrost.logmessage ( bifrostMessageId text, eventName text, javaClass text, content text, resultValue text, userName text, errorMessage text ) FROM PUBLIC;
