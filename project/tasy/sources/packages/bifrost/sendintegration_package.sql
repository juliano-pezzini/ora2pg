-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION bifrost.sendintegration ( direct boolean, eventName text, javaClass text, content text, synchronous char, userName text, usesTasyBackend char, headers text ) RETURNS text AS $body$
DECLARE

    resultValue text := 'NACK';
	integrationType varchar(1) := 'H';
    eventInvalidCount integer := 0;	

BEGIN

	-- the bifrost_events cache table stores all invalid events
	-- always try to execute the first time, if invalid the tasy-interfaces insert this event in table
	select count(event) into STRICT eventInvalidCount from bifrost_events where event = eventName;
	if eventInvalidCount <= 0 then

		integrationType := obter_valor_param_usuario(9041, 12, 0, coalesce(wheb_usuario_pck.get_nm_usuario, userName), wheb_usuario_pck.get_cd_estabelecimento);

		if integrationType = 'P' then

			--POLLING INTEGRATION
			resultValue := bifrost.sendintegrationpolling(direct, eventName, javaClass, content, synchronous, userName, usesTasyBackend, headers);

		else

			--HTTP INTEGRATION
			resultValue := bifrost.sendintegrationhttp(direct, eventName, javaClass, content, synchronous, userName, usesTasyBackend, headers);

		end if;	

	end if;

    return resultValue;

END;

$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON FUNCTION bifrost.sendintegration ( direct boolean, eventName text, javaClass text, content text, synchronous char, userName text, usesTasyBackend char, headers text ) FROM PUBLIC;
