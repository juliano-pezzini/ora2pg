-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE validar_updates_aut_conv_pck.grava_log_processo_erro (ds_message_p integration_call_log.ds_notes%TYPE) AS $body$
DECLARE


    nm_interface_w constant integration_call_log.nm_interface%type := 'api.insurance.authorization';
    nm_usuario_w constant procedimento_autorizado.nm_usuario%type := 'interfaces';
    nr_seq_int_call_log_w integration_message_log.nr_seq_int_call_log%type := 0;
    ds_notes_w integration_call_log.ds_notes%TYPE;
    ds_notes_message_w integration_call_log.ds_notes%TYPE := 'Error in the insurance authorization validation process.';
    ds_notes_params_w integration_call_log.ds_notes%TYPE;
    ie_status_w integration_call_log.ie_status%type := 'E';
    ie_message_type_w integration_call_log.ie_message_type%type := 'R';
    current_setting('validar_updates_aut_conv_pck.separador_linha_w')::varchar(50)CHR(13)|| constant varchar(50) :=  CHR(13) || CHR(10);


BEGIN

        ds_notes_params_w := substr(' '||ds_message_p,1,499);

        ds_notes_w := substr(ds_notes_message_w || current_setting('validar_updates_aut_conv_pck.separador_linha_w')::varchar(50)CHR(13)|||| ds_notes_params_w,1,499);

        record_integration_call_log(nm_usuario_w, nm_usuario_w, clock_timestamp(), nm_interface_w, nm_interface_w, ie_status_w,
                                    ie_message_type_w, null, ds_notes_w, null, null, null, nr_seq_int_call_log_w, null, null, null);

    EXCEPTION
        WHEN data_exception THEN
             CALL wheb_mensagem_pck.exibir_mensagem_abort('An error occurred writing the error log in the insurance authorization validation process. Error: '
                                                     || sqlerrm);
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE validar_updates_aut_conv_pck.grava_log_processo_erro (ds_message_p integration_call_log.ds_notes%TYPE) FROM PUBLIC;
