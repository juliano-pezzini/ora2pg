-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ctb_contab_mexico_pck.gerar_arquivo_xml ( ds_nome_arquivo_p INOUT text, ds_diretorio_utl_file_p text, arquivo_xml_p xml ) AS $body$
DECLARE


    arquivo_xml_clob_w          text;
    arquivo_xml_file_w          utl_file.file_type;
    qt_limite_w                 bigint;
    qt_valor_gravado_w          bigint;
    qt_tamanho_arquivo_w        bigint;


BEGIN
    /*
    Cadastro diretorio servidor e diretorio rede:
    Funcao:
        Cadastros gerais(Shift+F11)
    Aba:
        Sistema\Usuario\Eventos gravacao/leitura de arquivos (UTL_FILE)

    dir_servidor    /oraprd03/utlfile/
    dir_rede        \\192.168.0.230\utlfile
    */


    arquivo_xml_clob_w      := arquivo_xml_p;
    qt_tamanho_arquivo_w    := coalesce(octet_length(arquivo_xml_clob_w),0);
    qt_valor_gravado_w      := 1;
    qt_limite_w             := 10000;

    begin
    arquivo_xml_file_w := utl_file.fopen_nchar(ds_diretorio_utl_file_p, ds_nome_arquivo_p, 'W', 10000);
    while(qt_valor_gravado_w < qt_tamanho_arquivo_w) loop
        begin
        utl_file.put_nchar(arquivo_xml_file_w,substr(arquivo_xml_clob_w,qt_limite_w,qt_valor_gravado_w));
        utl_file.fflush(arquivo_xml_file_w);
        qt_valor_gravado_w := qt_valor_gravado_w + qt_limite_w;
        end;
    end loop;

    utl_file.fclose(arquivo_xml_file_w);

    exception
        when no_data_found then
            utl_file.fclose(arquivo_xml_file_w);
        when others then
            utl_file.fclose(arquivo_xml_file_w);
    end;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_contab_mexico_pck.gerar_arquivo_xml ( ds_nome_arquivo_p INOUT text, ds_diretorio_utl_file_p text, arquivo_xml_p xml ) FROM PUBLIC;
