-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_hiv_pck.get_data_diagnostico (cd_pessoa_fisica_p text) RETURNS timestamp AS $body$
DECLARE

		
	ds_retorno_w timestamp;

	
BEGIN

		select min(dt_inicio)
		into STRICT ds_retorno_w
		from (
			SELECT  min(trunc(pac.dt_inicio)) dt_inicio
			from    paciente_antec_clinico pac
			where   (pac.dt_inicio IS NOT NULL AND pac.dt_inicio::text <> '')
			and     (pac.dt_liberacao IS NOT NULL AND pac.dt_liberacao::text <> '')
			and     coalesce(pac.dt_inativacao::text, '') = ''
			and     alto_custo_pck.obter_se_tipo_doenca(pac.cd_doenca, 'V') = 'S'
			and     pac.cd_pessoa_fisica = cd_pessoa_fisica_p
			
union

			SELECT  min(trunc(dd.dt_diagnostico)) dt_inicio
			from    diagnostico_doenca dd
			where   (dd.dt_diagnostico IS NOT NULL AND dd.dt_diagnostico::text <> '')
			and     (dd.dt_liberacao IS NOT NULL AND dd.dt_liberacao::text <> '')
			and     coalesce(dd.dt_inativacao::text, '') = ''
			and     alto_custo_pck.obter_se_tipo_doenca(dd.cd_doenca, 'V') = 'S'
			and     dd.nr_atendimento in (select nr_atendimento from atendimento_paciente where cd_pessoa_fisica = cd_pessoa_fisica_p)) alias14;

		return ds_retorno_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_hiv_pck.get_data_diagnostico (cd_pessoa_fisica_p text) FROM PUBLIC;
