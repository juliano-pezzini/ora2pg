-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_hiv_pck.get_mae_hiv ( cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE


	ds_retorno_w	varchar(255);

	
BEGIN

		select CASE WHEN count(1)=0 THEN  0  ELSE 1 END
		into STRICT  ds_retorno_w
		from  paciente_antec_clinico pac
		inner join pessoa_fisica pf
		on    pf.cd_pessoa_fisica = pac.cd_pessoa_fisica
		where pf.cd_pessoa_fisica = cd_pessoa_fisica_p
		and   (pf.dt_nascimento IS NOT NULL AND pf.dt_nascimento::text <> '')
		and   months_between(trunc(clock_timestamp()), pf.dt_nascimento) < 18
		and   alto_custo_pck.obter_se_tipo_doenca(pac.cd_doenca, 'V') = 'S'
		and   pac.nr_seq_parentesco in (  SELECT  gp.nr_sequencia
										  from    grau_parentesco gp
										  where   gp.ie_grau_parentesco = 5);

		return ds_retorno_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_hiv_pck.get_mae_hiv ( cd_pessoa_fisica_p text) FROM PUBLIC;
