-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_tipos_ocor_pck.obter_restricao_protocolo ( dados_regra_p pls_tipos_ocor_pck.dados_regra, dados_filtro_p pls_tipos_ocor_pck.dados_filtro, dados_filtro_prot_p pls_tipos_ocor_pck.dados_filtro_prot, ie_tipo_tabela_p text, valor_bind_p INOUT sql_pck.t_dado_bind) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Monta as restricoes e binds dos campos de filtro de protocolo
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta:
[  X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

Alteracoes:
 ------------------------------------------------------------------------------------------------------------------

 usuario OS XXXXXX 01/01/2000 -
 Alteracao:	Descricao da alteracao.
Motivo:	Descricao do motivo.
 ------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


dados_restricao_w	pls_tipos_ocor_pck.dados_select;
ds_alias_w		varchar(5);


BEGIN
-- Inicializar o retorno

dados_restricao_w.ds_campos	:= null;
dados_restricao_w.ds_tabelas	:= null;
dados_restricao_w.ds_restricao	:= null;

if (dados_filtro_prot_p.nr_sequencia IS NOT NULL AND dados_filtro_prot_p.nr_sequencia::text <> '') then

	-- obtem o alias da tabela

	ds_alias_w := pls_tipos_ocor_pck.obter_alias_tab(	dados_filtro_p.ie_processo_excecao, dados_regra_p.ie_incidencia_selecao,
					dados_filtro_p.ie_incidencia_selecao, ie_tipo_tabela_p);

	-- Apresentacao

	if (dados_filtro_prot_p.ie_apresentacao <> 'T') then
		dados_restricao_w.ds_restricao :=	dados_restricao_w.ds_restricao || pls_util_pck.enter_w ||
							'and	' || ds_alias_w || '.ie_apresentacao = :ie_apresentacao';
		valor_bind_p := sql_pck.bind_variable(	':ie_apresentacao', dados_filtro_prot_p.ie_apresentacao, valor_bind_p);
	end if;

	if (dados_filtro_prot_p.cd_versao_tiss IS NOT NULL AND dados_filtro_prot_p.cd_versao_tiss::text <> '') then
		dados_restricao_w.ds_restricao :=	dados_restricao_w.ds_restricao || pls_util_pck.enter_w ||
							'and	' || ds_alias_w || '.cd_versao_tiss = :cd_versao_tiss';
		valor_bind_p := sql_pck.bind_variable(	':cd_versao_tiss', dados_filtro_prot_p.cd_versao_tiss, valor_bind_p);
	end if;
	
	if	(dados_filtro_prot_p.ie_guia_fisica_apresentada IS NOT NULL AND dados_filtro_prot_p.ie_guia_fisica_apresentada::text <> '' AND dados_filtro_prot_p.ie_guia_fisica_apresentada != 'A') then
		dados_restricao_w.ds_restricao :=	dados_restricao_w.ds_restricao || pls_util_pck.enter_w ||
							' and	' || ds_alias_w || '.ie_guia_fisica = :ie_guia_fisica';
		valor_bind_p := sql_pck.bind_variable(	':ie_guia_fisica', dados_filtro_prot_p.ie_guia_fisica_apresentada, valor_bind_p);
	end if;
	
end if;

return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_tipos_ocor_pck.obter_restricao_protocolo ( dados_regra_p pls_tipos_ocor_pck.dados_regra, dados_filtro_p pls_tipos_ocor_pck.dados_filtro, dados_filtro_prot_p pls_tipos_ocor_pck.dados_filtro_prot, ie_tipo_tabela_p text, valor_bind_p INOUT sql_pck.t_dado_bind) FROM PUBLIC;
