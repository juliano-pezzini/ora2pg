-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_tipos_ocor_pck.ie_reg_valido_fil_conta ( dados_filtro_conta_p pls_tipos_ocor_pck.dados_filtro_conta, dados_regra_p pls_tipos_ocor_pck.dados_regra, ie_internado_p text, ie_vinc_internado_p text, ie_carater_internacao_p text, ie_carater_internacao_imp_p text, cd_versao_tiss_p text) RETURNS boolean AS $body$
DECLARE


ie_registro_valido_w boolean;

BEGIN

ie_registro_valido_w := true;

-- se for marcado para filtra  Atendimento em internacao e verificado o campo ie_internado

if ( dados_filtro_conta_p.ie_internado = 'S') then

	if ( coalesce(ie_internado_p, 'N') != 'S') then
		ie_registro_valido_w := false;
	end if;
end if;
-- se for marcado para filtra  Atend vinculado a uma internacao e verificado o campo ie_vinc_internacao

if ( dados_filtro_conta_p.ie_vinc_internacao = 'S') then

	if ( coalesce(ie_vinc_internado_p, 'N') != 'I') then
		ie_registro_valido_w := false;
	end if;
end if;

if (dados_filtro_conta_p.ie_carater_internacao IS NOT NULL AND dados_filtro_conta_p.ie_carater_internacao::text <> '') then
	-- Precisa ser verificado a versao do tiss pois existe um tratamento para versao TISS >= 3.01 para alimentar o campo ie_carater_internacao na pls_gerar_conta

	-- caso seja regra para Importacao do XML e versao TISS anterior a 3.01 tem que filtrar o campo IMP

	if ( cd_versao_tiss_p < '3.01.00') and ( dados_regra_p.ie_evento = 'IMP') then



		if ( dados_filtro_conta_p.ie_carater_internacao != ie_carater_internacao_imp_p) then
			ie_registro_valido_w := false;
		end if;
	else
		if ( dados_filtro_conta_p.ie_carater_internacao != ie_carater_internacao_p) then
			ie_registro_valido_w := false;
		end if;



	end if;
end if;

return ie_registro_valido_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_tipos_ocor_pck.ie_reg_valido_fil_conta ( dados_filtro_conta_p pls_tipos_ocor_pck.dados_filtro_conta, dados_regra_p pls_tipos_ocor_pck.dados_regra, ie_internado_p text, ie_vinc_internado_p text, ie_carater_internacao_p text, ie_carater_internacao_imp_p text, cd_versao_tiss_p text) FROM PUBLIC;
