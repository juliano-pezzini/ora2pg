-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_tipos_ocor_pck.gerencia_selecao_validacao ( nr_seq_selecao_p dbms_sql.number_table, nr_seq_selecoes_p dbms_sql.clob_table, ie_sequencia_lista_p text, ds_observacao_p dbms_sql.varchar2_table, ie_valido_p dbms_sql.varchar2_table, nm_usuario_p usuario.nm_usuario%type, nr_id_transacao_p pls_selecao_ocor_cta.nr_id_transacao%type default null, qt_excedido_p dbms_sql.number_table default num_table_vazia) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Gerenciar a manutencao da tabela PLS_SELECAO_OCOR_CTA atraves da execucao de comandos
	para manipulacao de multiplas linhas em uma execucao para o contexto SQL para a utilizacao
	em validacoes.
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta:
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

ie_sequencia_lista_p:

SEQ - Sequencia (ira atualizar os registros pela sequencia usando o parametro nr_seq_selecao_p)  - vem as sequencias certas ja dentro de uma tabela numerica.
LISTA - Lista de Sequencias (ira atualizar os registros pela lista de sequencias passados no parametro nr_seq_selecoes_p) - vem as sequencias dentro de uma tabela de varchar separadas por virgulas

Alteracoes:
------------------------------------------------------------------------------------------------------------------

jjung OS 659951 - 23/10/2013 - Criacao da procedure.
------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */

resultado_conversao_table_w dados_table_selecao_ocor;


BEGIN

if (ie_sequencia_lista_p = 'SEQ') then

	-- se tiver registros na tabela

	if (nr_seq_selecao_p.count > 0) then
		-- faz a atualizacao direto, pois tudo ja esta no formato de tabela

		CALL CALL pls_tipos_ocor_pck.atualizar_lista(nr_seq_selecao_p, ds_observacao_p, ie_valido_p, nm_usuario_p, qt_excedido_p);
	end if;

elsif (ie_sequencia_lista_p = 'SEQ_CONTA') then

	-- se tiver registros na tabela

	if (nr_seq_selecao_p.count > 0) then
		-- faz a atualizacao direto, pois tudo ja esta no formato de tabela

		CALL CALL pls_tipos_ocor_pck.atualizar_lista_conta(nr_seq_selecao_p, ds_observacao_p, ie_valido_p, nm_usuario_p, nr_id_transacao_p, qt_excedido_p);
	end if;

elsif (ie_sequencia_lista_p = 'LISTA') then

	-- se tiver registros

	if (nr_seq_selecoes_p.count > 0) then

		-- alimenta um registro novo na lista para cada registro separado por virgula na lista .

		resultado_conversao_table_w :=	tratar_lista_selecao(nr_seq_selecoes_p, ds_observacao_p, ie_valido_p, qt_excedido_p);

		-- se tiver registro manda para atualizar.

		if (resultado_conversao_table_w.nr_seq_selecao.count > 0) then

			-- faz a atualizacao dos dados na tabela

			CALL CALL pls_tipos_ocor_pck.atualizar_lista(	resultado_conversao_table_w.nr_seq_selecao, resultado_conversao_table_w.ds_observacao,
						resultado_conversao_table_w.ie_valido, nm_usuario_p,resultado_conversao_table_w.qt_excedido);
		end if;
	end if;
end if;



END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_tipos_ocor_pck.gerencia_selecao_validacao ( nr_seq_selecao_p dbms_sql.number_table, nr_seq_selecoes_p dbms_sql.clob_table, ie_sequencia_lista_p text, ds_observacao_p dbms_sql.varchar2_table, ie_valido_p dbms_sql.varchar2_table, nm_usuario_p usuario.nm_usuario%type, nr_id_transacao_p pls_selecao_ocor_cta.nr_id_transacao%type default null, qt_excedido_p dbms_sql.number_table default num_table_vazia) FROM PUBLIC;
