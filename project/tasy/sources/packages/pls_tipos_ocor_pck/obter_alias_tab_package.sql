-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_tipos_ocor_pck.obter_alias_tab ( ie_processo_excecao_p text, ie_incidencia_selecao_regra_p text, ie_incidencia_selecao_filtro_p text, ie_tipo_tabela_p text default null) RETURNS varchar AS $body$
DECLARE

ds_alias_tab_w 		varchar(20);

BEGIN

-- se for para validar todo o atendimento (excecao), vai direto de acordo com o que esta cadastrado no filtro

-- essa variavel tem o seu valor modificado na procedure gerencia_aplic_filtro_ex_atend

-- nao e uma pratica de programacao muito segura, porem foi implementada devido ser a mais rapida para realizar a entrega das OSs de Rio Preto

-- no futuro acredito que seria interessante criar um novo parametro nas rotinas de obter_restricao_filtro e na pls_tipos_ocor_pck.obter_alias_tab(essa mesmo!) para tratar quando e um processamento

-- de filtros de excecao para verificar todo o atendimento e substituir o if abaixo com esse novo parametro

if (current_setting('pls_tipos_ocor_pck.ie_controle_todo_atendimento_w')::varchar(1) = 'S') then

	if (ie_incidencia_selecao_filtro_p = 'P') then
		-- procedimento

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_proc')::varchar(10);

	elsif (ie_incidencia_selecao_filtro_p = 'M') then
		 -- material

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_mat')::varchar(10);
	else
		-- conta

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_conta')::varchar(10);
	end if;
else
	-- para todo o processo normal pega esse caminho

	if	((ie_incidencia_selecao_filtro_p = 'P' and ie_processo_excecao_p = 'S') or (ie_incidencia_selecao_regra_p = 'P')) then
		-- procedimento

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_proc')::varchar(10);

	elsif	((ie_incidencia_selecao_filtro_p = 'M' and ie_processo_excecao_p = 'S') or (ie_incidencia_selecao_regra_p = 'M')) then
		 -- material

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_mat')::varchar(10);

	elsif (ie_incidencia_selecao_regra_p = 'PM' and ie_processo_excecao_p = 'N') then

		if (ie_tipo_tabela_p = 'PROC') then
			-- procedimento

			ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_proc')::varchar(10);
		elsif (ie_tipo_tabela_p = 'MAT') then
			-- material

			ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_mat')::varchar(10);
		end if;
	else
		-- conta

		ds_alias_tab_w := current_setting('pls_tipos_ocor_pck.ds_alias_conta')::varchar(10);
	end if;
end if;

return ds_alias_tab_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 IMMUTABLE;
-- REVOKE ALL ON FUNCTION pls_tipos_ocor_pck.obter_alias_tab ( ie_processo_excecao_p text, ie_incidencia_selecao_regra_p text, ie_incidencia_selecao_filtro_p text, ie_tipo_tabela_p text default null) FROM PUBLIC;
