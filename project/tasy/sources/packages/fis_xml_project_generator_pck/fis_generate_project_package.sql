-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE fis_xml_project_generator_pck.fis_generate_project (name_p text, header_p text, definition_p text, username_p text, content_p text, nr_seq_proj_p INOUT text, sep_list_p text default '|', sep_data_p text default '>', sep_subdata_p text default ',') AS $body$
DECLARE


        content_w     dbms_sql.varchar2_table;
        data_w        dbms_sql.varchar2_table;
        attributes_w  dbms_sql.varchar2_table;
        nr_seq_elem_w xml_elemento.nr_sequencia%type;
        nr_seq_proj_w xml_projeto.nr_sequencia%type;

    
BEGIN
        /* xml project creation */


        nr_seq_proj_w := fis_xml_project_generator_pck.create_project(name_p, header_p, definition_p, username_p, nr_seq_proj_w);

        /* separation of element tags */


        content_w := obter_lista_string(content_p, sep_list_p);
        CALL fis_xml_project_generator_pck.validate_vector(content_w, 'Content');

        for i in 1 .. content_w.count loop
            begin
                /* separation of element tags and attribute tags */


                data_w := obter_lista_string(content_w(i), sep_data_p);
                CALL fis_xml_project_generator_pck.validate_vector(data_w, 'Data');
                nr_seq_elem_w := fis_xml_project_generator_pck.create_element(i, nr_seq_proj_w, data_w(1), username_p, nr_seq_elem_w);

                /*  
                    separation of attributes tags
                    data_w(2) == List of attribute
                */

                attributes_w := obter_lista_string(data_w(2), sep_subdata_p);
                CALL fis_xml_project_generator_pck.validate_vector(attributes_w, 'Subdata');

                for j in 1 .. attributes_w.count loop
                    begin
                        CALL fis_xml_project_generator_pck.create_attribute(nr_seq_elem_w, j, attributes_w(j), username_p);
                    end;
                end loop;
            end;
        end loop;

        nr_seq_proj_p := nr_seq_proj_w;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_xml_project_generator_pck.fis_generate_project (name_p text, header_p text, definition_p text, username_p text, content_p text, nr_seq_proj_p INOUT text, sep_list_p text default '|', sep_data_p text default '>', sep_subdata_p text default ',') FROM PUBLIC;
