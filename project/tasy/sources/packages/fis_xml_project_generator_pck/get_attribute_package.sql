-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


    /*
        Checks for an attribute in the list. 
        If you have reference to the element to send the structure 
        of XML and, if not, it is because the element is root.
    */



CREATE OR REPLACE PROCEDURE fis_xml_project_generator_pck.get_attribute (ds_tag_p text, seq_tag_p INOUT text) AS $body$
DECLARE


        seq_tag_w           varchar(255);
        nr_seq_atrib_elem_w xml_atributo.nr_seq_atrib_elem%type;

    
BEGIN
        seq_tag_w := null;

        for i in 1 .. current_setting('fis_xml_project_generator_pck.vector_attributes_w')::reference_attributes.count loop
            begin
                if (ds_tag_p = current_setting('fis_xml_project_generator_pck.vector_attributes_w')::reference_attributes[i].ds_attribute) then
                    seq_tag_w := current_setting('fis_xml_project_generator_pck.vector_attributes_w')::reference_attributes[i].seq_attribute;

                    select max(nr_seq_atrib_elem) into STRICT nr_seq_atrib_elem_w from xml_atributo where nr_sequencia = seq_tag_w;

                    if (coalesce(nr_seq_atrib_elem_w::text, '') = '') then
                        exit;
                    end if;

                    seq_tag_w := null;

                end if;
            end;
        end loop;

        seq_tag_p := seq_tag_w;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_xml_project_generator_pck.get_attribute (ds_tag_p text, seq_tag_p INOUT text) FROM PUBLIC;
