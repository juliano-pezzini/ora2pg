-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION xdok_json_pck.get_comments ( nr_seq_episodio_p bigint ) RETURNS PHILIPS_JSON AS $body$
DECLARE


json_comments_w philips_json;

x07 CURSOR FOR
SELECT  ap.nr_atendimento,
        ap.nr_seq_episodio casenumber,
        ap.cd_pessoa_fisica,
        ap.ie_tipo_atendimento,
        to_char(ap.dt_entrada, 'dd/mm/yyyy hh24:mi:ss') entrydate,
        ep.nr_sequencia,
        ep.nr_episodio,
        to_char(sc.dt_admission, 'dd/mm/yyyy hh24:mi:ss') admissiondate,
        sc.ds_comment1 comment1,
        sc.ds_comment2 comment2,
        sc.ds_comment3 comment3,
        sc.ds_comment4 comment4,
        sc.ds_comment5 comment5,
        sc.ds_comment6 comment6
FROM episodio_paciente ep, atendimento_paciente ap, to_char(ep
LEFT OUTER JOIN scoring_comments sc ON (to_char(ep.nr_sequencia) = sc.nr_case)
WHERE ap.nr_seq_episodio = ep.nr_sequencia  and ap.nr_seq_episodio = nr_seq_episodio_p;

BEGIN
json_comments_w := philips_json();
for r_x07 in x07 loop
    begin
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'hospitalID', '');
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'caseNumber', r_x07.casenumber);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'recordID', '');
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'entryDate', r_x07.entrydate);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment1', r_x07.comment1);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment2', r_x07.comment2);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment3', r_x07.comment3);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment4', r_x07.comment4);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment5', r_x07.comment5);
    json_comments_w := xdok_json_pck.add_json_value(json_comments_w, 'comment6', r_x07.comment6);
    end;
end loop;

return json_comments_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION xdok_json_pck.get_comments ( nr_seq_episodio_p bigint ) FROM PUBLIC;
