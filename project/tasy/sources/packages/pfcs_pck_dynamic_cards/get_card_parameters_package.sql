-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_dynamic_cards.get_card_parameters (nr_seq_dynamic_module_p bigint, nr_region_p bigint, nr_seq_card_p bigint) RETURNS varchar AS $body$
DECLARE

        cur_cards CURSOR FOR
        SELECT
            pci.nr_seq_indicator,
            pi.nr_seq_list,
            coalesce(pci.ds_indicator, substr(obter_desc_expressao(pi.cd_exp_indicator),1,255)) DS_INDICATOR,
            coalesce(pi.ie_target, PFCS_PCK_CONSTANTS.IE_NO) IE_TARGET,
            coalesce(pi.ie_time, PFCS_PCK_CONSTANTS.IE_NO) IE_TIME,
            pi.ie_predicted,
            pi.ie_type_value,
            ( SELECT max(substr(obter_desc_expressao(pi.cd_exp_indicator),1,255))
                from  pfcs_indicator pi,
                            pfcs_card_indicator pci,
                            pfcs_card pc
                where pi.nr_sequencia = pci.nr_seq_indicator
                    AND pci.nr_seq_card = pc.nr_sequencia
                    AND pci.CD_type = PFCS_PCK_CONSTANTS.CD_TYPE_SIMPLE_CHART
            AND pc.cd_card_type = PFCS_PCK_CONSTANTS.CD_EXPANSIBLE_BN) title_bnex_tablechart,
            pc.NR_SEQ_DYNAMIC_MODULE,
            pi.nr_seq_object,
            pc.nr_seq_display,
            pi.nr_seq_third_level,
            pci.cd_type
        from pfcs_card pc,
            pfcs_indicator pi,
            pfcs_card_indicator pci
        where pi.nr_sequencia = pci.nr_seq_indicator
            and pci.nr_seq_card = pc.nr_sequencia
            and pc.nr_seq_dynamic_module = nr_seq_dynamic_module_p
            and pc.nr_region = nr_region_p
            and pc.nr_sequencia =nr_seq_card_p;

        json_item_w PHILIPS_JSON := PHILIPS_JSON();
        json_list_w PHILIPS_JSON_LIST := PHILIPS_JSON_LIST();

BEGIN
        for c01_w in cur_cards loop

            json_item_w.put('NR_SEQ_INDICATOR',to_char(c01_w.nr_seq_indicator));
            json_item_w.put('DS_INDICATOR', to_char(c01_w.ds_indicator));
            json_item_w.put('NR_SEQ_LIST',to_char(c01_w.nr_seq_list));
            json_item_w.put('IE_TARGET',to_char(c01_w.ie_target));
            json_item_w.put('IE_TIME',to_char(c01_w.ie_time));
            json_item_w.put('IE_PREDICTED',to_char(c01_w.ie_predicted));
            json_item_w.put('IE_TYPE_VALUE',to_char(c01_w.ie_type_value));
            json_item_w.put('TITLE_BNEX_TABLECHART', c01_w.title_bnex_tablechart);
            json_item_w.put('NR_SEQ_DYNAMIC_MODULE', to_char(c01_w.NR_SEQ_DYNAMIC_MODULE));
            json_item_w.put('NR_SEQ_OBJECT', c01_w.nr_seq_object);
            json_item_w.put('NR_SEQ_DISPLAY', c01_w.nr_seq_display);
            json_item_w.put('NR_SEQ_THIRD_LEVEL', c01_w.nr_seq_third_level);
            json_item_w.put('CD_TYPE', c01_w.cd_type);

            json_list_w.append(json_item_w.to_json_value());
        end loop;

        return json_list_w.to_char();
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_dynamic_cards.get_card_parameters (nr_seq_dynamic_module_p bigint, nr_region_p bigint, nr_seq_card_p bigint) FROM PUBLIC;
