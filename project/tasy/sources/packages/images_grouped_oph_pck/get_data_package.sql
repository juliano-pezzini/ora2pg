-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION images_grouped_oph_pck.get_data ( nr_sequencia_p bigint, nr_seq_item_p bigint, cd_pessoa_fisica_p text, dt_registro_p timestamp) RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE

							
t_objeto_row_w t_objeto_row;

c01 REFCURSOR;

ds_query_w           varchar(4000);
sql_w                varchar(4000);
ds_arquivo_w         varchar(2000);
ds_lado_w            varchar(255);
ds_titulo_tela_w     varchar(2000);
dt_registro_w        timestamp;
ie_tipo_w            smallint;
ds_blind_w           varchar(255);
nm_medico_w          varchar(2000);
nm_usuario_w         usuario.nm_usuario%type := wheb_usuario_pck.get_nm_usuario;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type	:= wheb_usuario_pck.get_cd_estabelecimento;


BEGIN
case nr_seq_item_p
   when 71 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        a.dt_registro, '||
               '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_angio_retino a, '||
               '        oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and     a.nr_sequencia       = b.nr_seq_angio_retino  '||
               'and     a.nr_sequencia       = :nr_sequencia_p '||
               'and     b.ds_arquivo         is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_angio_retino is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '        null ds_lado, '||
               '        a.dt_registro, '||
               '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_angio_retino a, '||
               '        oft_consulta_imagem b, '||
               '        oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and     a.nr_sequencia       = b.nr_seq_angio_retino  '||
               'and     a.nr_sequencia       = :nr_sequencia_p '||
               'and     b.ds_arquivo_backup is not null';
   when 298 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        a.dt_registro, '||
               '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_angio_retino a, '||
               '        oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and     a.nr_sequencia       = b.nr_seq_angio_retino  '||
               'and     a.nr_sequencia       = :nr_sequencia_p '||
               'and     b.ds_arquivo         is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_angio_retino is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '        null ds_lado, '||
               '        a.dt_registro, '||
               '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_angio_retino a, '||
               '        oft_consulta_imagem b, '||
               '        oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and     a.nr_sequencia       = b.nr_seq_angio_retino  '||
               'and     a.nr_sequencia       = :nr_sequencia_p '||
               'and     b.ds_arquivo_backup is not null';
   when 10 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo,  '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_biomicroscopia a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_biomicroscopia  '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo         is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_biomicroscopia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '         null ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_biomicroscopia a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_biomicroscopia  '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup is not null';
   when 6 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo,  '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_exame_externo a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_oft_exame_externo '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_oft_exame_externo is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '         null ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_exame_externo a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_exame_externo '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup is not null';
   when 9 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo,  '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_fundoscopia a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_fundoscopia '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_fundoscopia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '         null ds_lado, '||
               '         a.dt_exame dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_fundoscopia a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_oft_fundoscopia  '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup  is not null';

   
   when 276 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_mapeamento_retina a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_mapeamento '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_mapeamento is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||                              
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo,  '||
               '         null ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_mapeamento_retina a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_mapeamento '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup is not null';
   
   when 173 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_tomografia_olho a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_tomografia '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_tomografia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   
   when 277 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_ultrassonografia a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_ultrassonografia '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_ultrassonografia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||                              
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo, '|| 
               '         null ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_ultrassonografia a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_ultrassonografia '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup is not null';
   
   when 80 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_microscopia_especular a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_microscopia '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_microscopia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   
   when 177 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_oct a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_oct '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_oct is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select 	b.ds_arquivo_backup ds_arquivo, '|| 
               '         null ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_oct a, '||
               '         oft_consulta_imagem b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_oct '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo_backup is not null';
   
   when 171 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_campimetria a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_campimetria '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_campimetria is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   
   when 78 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_biometria a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_biometria '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and    	(b.dt_inativacao is null) '||
               'and      b.ds_arquivo is not null '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_biometria is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   when 84 then
      ds_blind_w := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         a.dt_registro, '||
               '         substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
               'from   	oft_paquimetria a, '||
               '         oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	a.nr_seq_consulta		= c.nr_sequencia '||
               'and      a.nr_sequencia       = b.nr_seq_paquimetria '||
               'and      a.nr_sequencia       = :nr_sequencia_p '||
               'and      b.ds_arquivo is not null '||
               'and    	(b.dt_inativacao is null) '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.nr_seq_paquimetria is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   when 168 then
      ds_blind_w := 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         b.dt_atualizacao_nrec dt_registro, '||
               '         substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	b.nr_seq_consulta		= c.nr_sequencia '||
               'and      c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and      trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and      b.ie_ceratoscopia = ''S'' '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and      b.dt_inativacao is null '||
               'and      b.ds_arquivo is not null '||
               'union all '||
               'select  b.ds_arquivo, '||
               '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '        b.dt_atualizacao_nrec dt_registro, '||
               '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '        oft_consulta c '||
               'where  	b.ie_ceratoscopia is null  '||
               'and     b.nr_seq_item       = :nr_seq_item_p '||
               'and     b.nr_seq_consulta   = c.nr_sequencia '||
               'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and     b.ds_arquivo        is not null '||
               'and    	(b.dt_inativacao is null) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ';
   when 31 then
      ds_blind_w := 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_arquivo, '||
               '         obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
               '         b.dt_atualizacao_nrec dt_registro, '||
               '         substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_imagem_exame b, '||
               '         oft_consulta c '||
               'where  	b.nr_seq_consulta		= c.nr_sequencia '||
               'and      c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and      trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and      b.dt_inativacao is null '||
               'and      nvl(b.ie_ceratoscopia,''N'') = ''N'' '||
               'and      b.nr_seq_paquimetria is null '||
               'and      b.nr_seq_biometria is null '||
               'and      b.nr_seq_campimetria is null '||
               'and      b.nr_seq_oct is null '||
               'and      b.nr_seq_microscopia is null '||
               'and      b.nr_seq_ultrassonografia is null '||
               'and      b.nr_seq_mapeamento is null '||
               'and      b.nr_seq_fundoscopia is null '||
               'and      b.nr_seq_oft_exame_externo is null '||
               'and      b.nr_seq_biomicroscopia is null '||
               'and      b.nr_seq_angio_retino is null '||
               'and      b.nr_seq_tomografia is null '||
               'and      b.nr_seq_aberrometria is null '||
               'and      b.ds_arquivo is not null '||
               'and      b.nr_seq_item is null '||
               'union all '||
               'select 	b.ds_anexo ds_arquivo,  '||
               '         null ds_lado, '||
               '         b.dt_registro, '||
               '         substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
               'from   	oft_anexo b, '||
               '         oft_consulta c '||
               'where  	b.nr_seq_consulta		= c.nr_sequencia '||
               'and      c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
               'and      trunc(b.dt_registro) = trunc(:dt_registro_p) '||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
               'and      b.dt_inativacao is null '||
               'and      b.ds_anexo is not null';
   when 220 then
      ds_blind_w := 'nr_sequencia_p';
      sql_w := 'select 	e.ds_arquivo ds_arquivo, '||
               '         null ds_lado, '||
               '         a.dt_avaliacao dt_registro, '||
               '         substr(obter_nome_pf(a.cd_medico),1,255) nm_medico '||
               'from   	med_avaliacao_paciente a, '||
               '         oft_consulta c, '||
               '         med_tipo_avaliacao d, '||
               '         oft_consulta_imagem e '||
               'where  	a.nr_seq_consulta		   = c.nr_sequencia '||
               'and      a.nr_sequencia          = e.nr_seq_avaliacao '||
               'and      a.nr_seq_tipo_avaliacao = d.nr_sequencia '||
               'and      a.nr_sequencia          = :nr_sequencia_p';
   when 15 then
      ds_blind_w := 'nr_sequencia_p';
      sql_w := 'select 	c.ds_arquivo ds_arquivo, '||
               '         obter_valor_dominio(1372,a.ie_lado) ds_lado, '||
               '         a.dt_inicio_real dt_registro, '||
               '         substr(obter_nome_pf(b.cd_responsavel),1,255) nm_medico '||
               'from   	cirurgia a, '||
               '         cirurgia_descricao b, '||
               '         imagem_cirurgia c '||
               'where  	a.nr_cirurgia        = b.nr_cirurgia '||
               'and      b.nr_sequencia       = c.nr_seq_prot_cirurgia '||
               'and      a.ie_status_cirurgia = 2 '||
               'and      c.ds_arquivo is not null '||
               'and      b.nr_sequencia       = :nr_sequencia_p';
   when 165 then
      ds_blind_w := 'nr_sequencia_p';
      sql_w := 'SELECT  DS_ARQUIVO_IMAGEM ds_arquivo, '||
               '        null ds_lado, '||
               '        a.dt_laudo dt_registro, '||
               '        nvl(nm_medico_resp,nm_medico) nm_medico '||
               'FROM	   laudo_paciente_v a, '||
               '        laudo_paciente_imagem b '||
               'WHERE   a.nr_sequencia = b.nr_sequencia '||
               'and     a.nr_sequencia = :nr_sequencia_p';
   when 302 then
      ds_blind_w  := 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p';
      sql_w       := 'select  b.ds_arquivo, '||
                     '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
                     '        a.dt_exame dt_registro, '||
                     '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
                     'from   	oft_aberrometria a, '||
                     '        oft_imagem_exame b, '||
                     '        oft_consulta c '||
                     'where  	a.nr_seq_consulta		= c.nr_sequencia '||
                     'and     a.nr_sequencia       = b.nr_seq_aberrometria  '||
                     'and     a.nr_sequencia       = :nr_sequencia_p '||
                     'and     b.ds_arquivo         is not null '||
                     'and    	(b.dt_inativacao is null) '||
                     'union all '||
                     'select  b.ds_arquivo, '||
                     '        obter_valor_dominio(1372,b.ie_lado) ds_lado, '||
                     '        b.dt_atualizacao_nrec dt_registro, '||
                     '        substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico '||
                     'from   	oft_imagem_exame b, '||
                     '        oft_consulta c '||
                     'where  	b.nr_seq_aberrometria is null  '||
                     'and     b.nr_seq_item       = :nr_seq_item_p '||
                     'and     b.nr_seq_consulta   = c.nr_sequencia '||
                     'and     c.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
                     'and     trunc(b.dt_atualizacao_nrec) = trunc(:dt_registro_p) '||
                     'and     b.ds_arquivo        is not null '||
                     'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) '||
                     'and    	(b.dt_inativacao is null) '||
                     'union all '||
                     'select 	b.ds_arquivo_backup ds_arquivo,  '||
                     '        null ds_lado, '||
                     '        a.dt_exame dt_registro, '||
                     '        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
                     'from   	oft_aberrometria a, '||
                     '        oft_consulta_imagem b, '||
                     '        oft_consulta c '||
                     'where  	a.nr_seq_consulta		= c.nr_sequencia '||
                     'and     a.nr_sequencia       = b.nr_seq_aberrometria  '||
                     'and     a.nr_sequencia       = :nr_sequencia_p '||
                     'and     b.ds_arquivo_backup is not null';
	when 235 then
      ds_blind_w := 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 	'SELECT  a.DS_ARQUIVO, '||
				'        null ds_lado, '||
				'        a.dt_registro, '||
				'        substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico '||
				'from   	GED_ATENDIMENTO a '||
				'where  	a.cd_pessoa_fisica   = :cd_pessoa_fisica_p  '||
				'and      	trunc(a.dt_registro)        = trunc(:dt_registro_p) '||
				'and    	(a.dt_liberacao is not null or a.nm_usuario = :nm_usuario_w) '||
				'and      	a.dt_inativacao is null '||
				'and      	a.ds_arquivo is not null ';
   else
      ds_blind_w := 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w';
      sql_w := 'select 	b.ds_anexo ds_arquivo, ' ||
               '         null ds_lado, ' ||
               '         b.dt_registro, ' ||
               '         substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico ' ||
               'from   	oft_anexo b, ' ||
               '         oft_consulta c, ' ||
               '         relatorio d ' ||
               'where  	b.nr_seq_consulta		= c.nr_sequencia ' ||
               'and      c.cd_pessoa_fisica   = :cd_pessoa_fisica_p ' ||
               'and      b.cd_relatorio       = d.cd_relatorio ' ||
               'and      b.cd_classif_relat   = d.cd_classif_relat ' ||
               'and      trunc(b.dt_registro) = trunc(:dt_registro_p) ' ||
               'and    	(b.dt_liberacao is not null or b.nm_usuario = :nm_usuario_w) ' ||
               'and      b.dt_inativacao is null ' ||
               'and      b.ds_anexo is not null';
end case;
               
ds_query_w  := sql_w;

/*
if (nr_blind_w = 1) then
   open c01 for ds_query_w using nr_sequencia_p;
elsif (nr_blind_w = 2) then
   open c01 for ds_query_w using nr_sequencia_p,nr_sequencia_p;
elsif (nr_blind_w = 3) then
   open c01 for ds_query_w using cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
elsif (nr_blind_w = 6) then   
   open c01 for ds_query_w using cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
end if;   
*/


if (ds_blind_w = 'nr_sequencia_p') then
   open c01 for EXECUTE ds_query_w using nr_sequencia_p;
elsif (ds_blind_w = 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w') then
   open c01 for EXECUTE ds_query_w using cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
elsif (ds_blind_w = 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w') then
   open c01 for EXECUTE ds_query_w using nr_sequencia_p,nr_seq_item_p,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
elsif (ds_blind_w = 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w') then
   open c01 for EXECUTE ds_query_w using cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w,nr_seq_item_p,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
elsif (ds_blind_w = 'cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w') then
   open c01 for EXECUTE ds_query_w using cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
elsif (ds_blind_w = 'nr_sequencia_p;nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w;nr_sequencia_p') then
   open c01 for EXECUTE ds_query_w using nr_sequencia_p,nr_seq_item_p,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w,nr_sequencia_p;
elsif (ds_blind_w = 'nr_seq_item_p;cd_pessoa_fisica_p;dt_registro_p;nm_usuario_w') then
   open c01 for EXECUTE ds_query_w using nr_seq_item_p,cd_pessoa_fisica_p,dt_registro_p,nm_usuario_w;
end if;



loop
fetch c01 into	 
   ds_arquivo_w, 
   ds_lado_w, 
   dt_registro_w, 
   nm_medico_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
   begin
   ds_titulo_tela_w  := obter_desc_expressao(327202,'Data:')|| ' ';
   ds_titulo_tela_w  := ds_titulo_tela_w||PKG_DATE_FORMATERS.to_varchar(dt_registro_w,'shortDate',cd_estabelecimento_w,nm_usuario_w);
   ds_titulo_tela_w  := ds_titulo_tela_w||' - '||obter_desc_expressao(947102,'Lado:')|| ' ';
   if (coalesce(ds_lado_w::text, '') = '') then
      ds_titulo_tela_w  := ds_titulo_tela_w||obter_desc_expressao(327119,'N'||chr(227)||'o informado');
   else
      ds_titulo_tela_w  := ds_titulo_tela_w||ds_lado_w;
   end if;
   ds_titulo_tela_w  := ds_titulo_tela_w||' - '||obter_desc_expressao(622367,'M'||chr(233)||'dico:')|| ' ';
   ds_titulo_tela_w  := ds_titulo_tela_w||nm_medico_w;

   t_objeto_row_w.ds_arquivo	            := ds_arquivo_w;
   t_objeto_row_w.ds_titulo_tela          := ds_titulo_tela_w;
   RETURN NEXT t_objeto_row_w;
   end;
end loop;
close C01;

RETURN;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION images_grouped_oph_pck.get_data ( nr_sequencia_p bigint, nr_seq_item_p bigint, cd_pessoa_fisica_p text, dt_registro_p timestamp) FROM PUBLIC;
