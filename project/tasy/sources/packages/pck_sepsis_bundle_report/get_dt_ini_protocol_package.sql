-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

--Variaveis globais
   --3349; -- ICCA Sepsis - Prescription order Blood Culture
   --3654; -- ICCA Sepsis - Prescription order Lactate
   --3653; -- ICCA Sepsis - Prescription order Antibiotic
   --3350; -- ICCA sepsis - Compliance measure 1 treatment
   --3353; -- ICCA sepsis - Compliance measures 2 Treatment
   --3634; -- ICCA Sepsis Admission - Chart Care goal
   
   --76; --Para administracao de cristaloides etapa 4
   --247; --Para administracao de vasopressores etapa 5
   
    --  Blood Culture
    --  Lactate
   


CREATE OR REPLACE PROCEDURE pck_sepsis_bundle_report.get_dt_ini_protocol (nr_atendimento_p gqa_protocolo_pac.nr_atendimento%type, cd_etpapa_p gqa_protocolo_etapa_pac.nr_seq_etapa%type, dt_inicio_protocolo_p INOUT gqa_protocolo_etapa_pac.dt_inicio%type) AS $body$
BEGIN

       select min(b.dt_inicio)
        into STRICT dt_inicio_protocolo_p
        from gqa_protocolo_pac       a,
             gqa_protocolo_etapa_pac b
       where a.nr_sequencia = b.nr_seq_prot_pac
         and a.nr_atendimento = nr_atendimento_p
         and b.nr_seq_etapa = pkg_report_data.get_stage(cd_etpapa_p,b.nr_seq_etapa)
         and b.dt_atualizacao >= b.dt_inicio;

   END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pck_sepsis_bundle_report.get_dt_ini_protocol (nr_atendimento_p gqa_protocolo_pac.nr_atendimento%type, cd_etpapa_p gqa_protocolo_etapa_pac.nr_seq_etapa%type, dt_inicio_protocolo_p INOUT gqa_protocolo_etapa_pac.dt_inicio%type) FROM PUBLIC;
