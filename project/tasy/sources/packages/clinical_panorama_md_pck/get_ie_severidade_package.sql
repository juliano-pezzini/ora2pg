-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clinical_panorama_md_pck.get_ie_severidade ( ie_escala_acuidade_p text, nr_pontuacao_p bigint, ie_severidade_default_p text) RETURNS varchar AS $body$
DECLARE

ie_severidade_w      				varchar(2);
nr_pontuacao_w       				bigint;


BEGIN
	nr_pontuacao_w	:= coalesce(nr_pontuacao_p,0);
	ie_severidade_w := ie_severidade_default_p;
	
	if (ie_escala_acuidade_p = 'AA') then
	
		if coalesce(nr_pontuacao_w,0) = 0 then
			ie_severidade_w := 'X';
		end if;
		
	elsif ie_escala_acuidade_p = 'EWS' then
	
		if coalesce(nr_pontuacao_w,0) = 0 then
			ie_severidade_w := 'X';
		end if;
		
	elsif ie_escala_acuidade_p = 'SAPS II' then
		ie_severidade_w := 'X';
		IF nr_pontuacao_w > 107 THEN
			ie_severidade_w := 'H';
		ELSIF nr_pontuacao_w < 55 THEN
			ie_severidade_w := 'L';
		ELSIF nr_pontuacao_w >= 55 AND nr_pontuacao_w <= 107 THEN
			ie_severidade_w := 'M';
		END IF;
		
	elsif ie_escala_acuidade_p = 'PEWS' then

      IF nr_pontuacao_w < 3 THEN
        ie_severidade_w := 'L';
      ELSIF nr_pontuacao_w > 2 AND nr_pontuacao_w < 5  THEN
        ie_severidade_w := 'M';
      ELSIF nr_pontuacao_w > 4 THEN
        ie_severidade_w := 'H';
      END IF;
		
	elsif ie_escala_acuidade_p = 'MEWS' then
	
      IF nr_pontuacao_w < 3 THEN
        ie_severidade_w := 'L';
      ELSIF nr_pontuacao_w > 2 AND nr_pontuacao_w < 5  THEN
        ie_severidade_w := 'M';
      ELSIF nr_pontuacao_w > 4 THEN
        ie_severidade_w := 'H';
      END IF;
	
	end if;
	
	return ie_severidade_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION clinical_panorama_md_pck.get_ie_severidade ( ie_escala_acuidade_p text, nr_pontuacao_p bigint, ie_severidade_default_p text) FROM PUBLIC;
