-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

--=========================================== Cursors ===========================================
    
    
    --=========================================== Functions ===========================================
CREATE OR REPLACE FUNCTION pfcs_permissions_pck.is_module_access_granted ( nr_seq_dynamic_module_p bigint, nm_user_p text, cd_profile_p bigint, cd_establishment_p bigint ) RETURNS varchar AS $body$
DECLARE

        ie_allowed_w pfcs_module_permission.ie_allowed%TYPE := 'N';

BEGIN
        SELECT
            coalesce(MAX(x.ie_allowed), 'N') into STRICT ie_allowed_w
        FROM (
                SELECT
                    ie_allowed,
                    nm_allowed_user,
                    nr_seq_profile,
                    cd_establishment
								from
                    pfcs_module_permission
                WHERE nr_seq_dynamic_module = nr_seq_dynamic_module_p
                    AND coalesce(nm_allowed_user,NM_USER_P) = nm_user_p
                    AND coalesce(nr_seq_profile, cd_profile_p) = cd_profile_p
                    AND coalesce(cd_establishment, cd_establishment_p) = cd_establishment_p
                ORDER BY
                    nm_allowed_user,
                    nr_seq_profile,
                    cd_establishment ASC
            ) x LIMIT 1;

        RETURN ie_allowed_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_permissions_pck.is_module_access_granted ( nr_seq_dynamic_module_p bigint, nm_user_p text, cd_profile_p bigint, cd_establishment_p bigint ) FROM PUBLIC;
