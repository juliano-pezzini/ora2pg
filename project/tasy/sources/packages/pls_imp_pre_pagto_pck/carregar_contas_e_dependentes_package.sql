-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



-- Carrregar os dados das contas e dependentes()declaracoes, itens, equipes



CREATE OR REPLACE PROCEDURE pls_imp_pre_pagto_pck.carregar_contas_e_dependentes ( ds_xml_p pls_faturamento_arq.ds_xml%type, nr_seq_protocolo_p pls_faturamento_prot.nr_sequencia%type, nr_guias_p bigint, ie_tipo_guias_p pls_protocolo_conta.ie_tipo_guia%type, cd_versao_tiss_p pls_faturamento_prot.cd_versao_tiss%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


nr_guia_w			bigint := 1;
nr_proc_w			bigint := 1;
nr_desp_w			bigint := 1;
nr_equipe_w			bigint := 1;
nr_tag_proc_w			bigint := 0;
nr_tag_equipe_w			bigint := 0;
nr_tag_desp_w			bigint := 0;
ds_guia_w			text; -- guia
ds_solic_w			text; -- solicitante
ds_solicitacao_w	text; --dados solicitacao
ds_exec_w			text; -- executor
ds_prof_exec_w		text; -- profissional executor
ds_procs_w			text; -- procedimentos
ds_proc_w			text; -- procedimento
ds_equipe_w			text; -- equipe
ds_desps_w			text; -- outras depesas
ds_desp_w			text; -- despesa
ds_local_w			text; --local contratado - guia de honorario individual
ds_dados_declaracoes_w text;-- dados das declaracoes
ds_ident_acidente_consulta text;-- Para consulta a identificacao de acidente nao fica internamente a outras tags
ds_dados_atendimento_w text; --dados atendimento
ds_dados_internacao_w text; --dados internacao
ds_dados_saida_internacao_w text; --dados saida internacao
ds_dados_beneficiario_w text; --dados beneficiario
-- Guia


nr_conta_gerada_w		pls_faturamento_conta.nr_sequencia%type;
cd_cgc_prest_exec_w		pls_faturamento_conta.cd_cgc_prest_exec%type;			
cd_guia_operadora_w		pls_faturamento_conta.cd_guia_operadora%type;			
cd_guia_prestador_w		pls_faturamento_conta.cd_guia_prestador%type;
cd_guia_principal_w		pls_faturamento_conta.cd_guia_principal%type;
cd_senha_w			pls_faturamento_conta.cd_senha%type;
dt_validade_senha_w		pls_faturamento_conta.dt_validade_senha%type;			
dt_autorizacao_w		pls_faturamento_conta.dt_autorizacao%type;			
nm_segurado_imp_w		pls_faturamento_conta.nm_segurado_imp%type;			
cd_cpf_prest_exec_w		pls_faturamento_conta.cd_cpf_prest_exec%type;		
cd_medico_solicitante_imp_w	pls_faturamento_conta.cd_medico_solicitante_imp%type;
cd_medico_executor_imp_w	pls_faturamento_conta.cd_medico_executor_imp%type;	
cd_cgc_prest_solic_w		pls_faturamento_conta.cd_cgc_prest_solic%type;		
cd_cpf_prest_solic_w		pls_faturamento_conta.cd_cpf_prest_solic%type;		
nr_seq_protocolo_w		pls_faturamento_conta.nr_seq_protocolo%type;			
nm_prestador_imp_w		pls_faturamento_conta.nm_prestador_imp%type;			
nm_contratado_solicit_w		pls_faturamento_conta.nm_prestador_imp%type;
dt_atendimento_w		pls_faturamento_conta.dt_atendimento%type;			
dt_fim_faturamento_w		pls_faturamento_conta.dt_fim_faturamento%type;		
dt_emissao_guia_w		pls_faturamento_conta.dt_emissao_guia%type;			
vl_procedimentos_imp_w		pls_faturamento_conta.vl_procedimentos_imp%type;		
vl_diarias_imp_w		pls_faturamento_conta.vl_diarias_imp%type;			
vl_taxas_imp_w			pls_faturamento_conta.vl_taxas_imp%type;				
vl_materiais_imp_w		pls_faturamento_conta.vl_materiais_imp%type;			
vl_medicamentos_imp_w		pls_faturamento_conta.vl_medicamentos_imp%type;		
vl_gases_imp_w			pls_faturamento_conta.vl_gases_imp%type;				
vl_opm_imp_w			pls_faturamento_conta.vl_opm_imp%type;				
vl_total_imp_w			pls_faturamento_conta.vl_total_imp%type;				
cd_cbo_saude_exec_imp_w		pls_faturamento_conta.cd_cbo_saude_exec_imp%type;		
nm_medico_solic_imp_w		pls_faturamento_conta.nm_medico_solic_imp%type;		
cd_cbo_saude_solic_imp_w	pls_faturamento_conta.cd_cbo_saude_solic_imp%type;	
sg_conselho_solic_imp_w		pls_faturamento_conta.sg_conselho_solic_imp%type;		
nm_medico_executor_imp_w	pls_faturamento_conta.nm_medico_executor_imp%type;	
nr_crm_exec_imp_w		pls_faturamento_conta.nr_crm_exec_imp%type;			
sg_conselho_exec_imp_w		pls_faturamento_conta.sg_conselho_exec_imp%type;		
uf_crm_exec_imp_w		pls_faturamento_conta.uf_crm_exec_imp%type;			
uf_crm_solic_imp_w		pls_faturamento_conta.uf_crm_solic_imp%type;			
nr_crm_solic_imp_w		pls_faturamento_conta.nr_crm_solic_imp%type;		
nm_prestador_exec_imp_w		pls_faturamento_conta.nm_prestador_exec_imp%type;
hr_fim_faturamento_w		timestamp;
dt_inicio_faturamento_w		pls_faturamento_conta.dt_inicio_faturamento%type;
hr_inicio_faturamento_w		timestamp;
cd_despesa_w			pls_fat_conta_item.ie_tipo_despesa%type;				
dt_execucao_desp_w		pls_fat_conta_item.dt_execucao%type;			
hr_inicial_desp_w		pls_fat_conta_item.dt_inicio%type;			
hr_final_desp_w			pls_fat_conta_item.dt_fim%type;				
cd_tabela_desp_w		pls_fat_conta_item.cd_tipo_tabela%type;			
cd_mat_envio_w			pls_fat_conta_item.cd_procedimento%type;
qt_executada_desp_w		pls_fat_conta_item.qt_executado%type;
cd_unidade_medida_w		pls_fat_conta_item.cd_unidade_medida%type;
tx_reducao_acrescimo_desp_w	pls_fat_conta_item.tx_reducao_acrescimo%type;
vl_unitario_desp_w		pls_fat_conta_item.vl_unitario%type;
vl_total_desp_w			pls_fat_conta_item.vl_total%type;
ds_material_w			pls_fat_conta_item.ds_procedimento%type;
nr_registro_anvisa_w		pls_fat_conta_item.nr_registro_anvisa%type;
cd_ref_fabricante_w		pls_fat_conta_item.cd_ref_fabricante%type;
cd_autoriz_funcionamento_w	pls_fat_conta_item.nr_aut_funcionamento%type;
nr_seq_item_gerado_w		pls_fat_conta_item.nr_sequencia%type;
dt_execucao_w			pls_fat_conta_item.dt_execucao%type;		
hr_inicial_w			pls_fat_conta_item.dt_inicio%type;
hr_final_w			pls_fat_conta_item.dt_fim%type;
cd_tabela_w			pls_fat_conta_item.cd_tipo_tabela%type;
cd_proc_envio_w			pls_fat_conta_item.cd_procedimento%type;
ds_procedimento_w		pls_fat_conta_item.ds_procedimento%type;
qt_executada_w			pls_fat_conta_item.qt_executado%type;
ie_via_acesso_w			pls_fat_conta_item.ie_via_acesso%type;
ie_tecnica_utilizada_w		pls_fat_conta_item.ie_tecnica_utilizada%type;
tx_reducao_acrescimo_w		pls_fat_conta_item.tx_reducao_acrescimo%type;
vl_unitario_w			pls_fat_conta_item.vl_unitario%type;
vl_total_w			pls_fat_conta_item.vl_total%type;
ie_grau_participante_w		pls_fat_conta_item_equipe.cd_grau_partic%type;
cd_cpf_contratado_w		pls_fat_conta_item_equipe.cd_cpf_prestador%type;
nm_profissional_w		pls_fat_conta_item_equipe.nm_profissional%type;
nr_conselho_w			pls_fat_conta_item_equipe.nr_conselho_profissional%type;
nr_cbo_w			pls_fat_conta_item_equipe.cd_cbo_saude_profissional%type;
nr_diag_w			integer := 0;
nr_tag_diag_w			bigint;
nr_tag_declaracoes_w		integer := 0;
nr_declaracao_w			integer := 0;
cd_doenca_w			pls_fat_diagnostico_conta.cd_doenca%type;
nr_carteira_benef_w		pls_faturamento_conta.cd_usuario_plano%type;
cd_uf_w				pls_fat_conta_item_equipe.uf_conselho%type;
cd_conselho_w			pls_fat_conta_item_equipe.cd_conselho_profissional%type;
ie_recem_nascido_imp_w		pls_faturamento_conta.ie_recem_nascido_imp%type;	
ie_tipo_atendimento_w		pls_faturamento_conta.ie_tipo_atendimento%type;	
ie_tipo_consulta_w		pls_faturamento_conta.ie_tipo_consulta%type;
ie_indicacao_acidente_w		pls_faturamento_conta.ie_indicacao_acidente%type;
nr_seq_motivo_encerramento_w	pls_faturamento_conta.nr_seq_motivo_encerramento%type;
ie_motivo_encerramento_w	pls_faturamento_conta.ie_motivo_encerramento%type;
ie_regime_atendimento_w		pls_faturamento_conta.ie_regime_atendimento%type;
ie_saude_ocupacional_w		pls_faturamento_conta.ie_saude_ocupacional%type;
ie_regime_internacao_w		pls_faturamento_conta.ie_regime_internacao%type;
ie_tipo_faturamento_w		pls_faturamento_conta.ie_tipo_faturamento%type;
ie_tipo_internacao_w		pls_faturamento_conta.ie_tipo_internacao%type;
cd_cnes_w			pls_faturamento_conta.cd_cnes%type;
ie_carater_atendimento_w	pls_faturamento_conta.ie_carater_atendimento%type;
ie_cobertura_especial_w		pls_faturamento_conta.ie_cobertura_especial%type;
cnes_local_w			pls_faturamento_conta.cd_cnes_hosp_exec%type;
nome_hospital_w			pls_faturamento_conta.nm_hosp_exec%type;
cd_cgc_hospital_w		pls_faturamento_conta.cd_cnpj_hosp_exec%type;
declaracao_nascido_w 		pls_fat_decl_conta_vivo.nr_declaracao%type;
diagnostico_obito_w 		pls_fat_decl_conta_obito.cd_doenca_obito%type;	
declaracao_obito_w 		pls_fat_decl_conta_obito.nr_declaracao%type;
indicador_rn_w			pls_fat_decl_conta_obito.ie_indicador_dorn%type;


BEGIN

while(nr_guia_w <= nr_guias_p) loop
	
	if (ie_tipo_guias_p = 4) then
		--Obtem conjuntos de informacoes(Tags agrupadoras)

		ds_guia_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_xml_p,'ans:guiaSP-SADT',nr_guia_w);
		ds_solic_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosSolicitante',1);
		ds_solicitacao_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosSolicitacao',1);
		ds_exec_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosExecutante',1);
		ds_dados_atendimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosAtendimento',1);
		ds_dados_beneficiario_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosBeneficiario',1);
	
		--Obtem as informacoes especificas

		cd_guia_principal_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:guiaPrincipal',1);
		cd_cgc_prest_exec_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:cnpjContratado',1);	
		cd_cpf_prest_exec_w	 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:cpfContratado',1);			
		cd_guia_operadora_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaOperadora',1);	
		dt_autorizacao_w		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataAutorizacao',1));	
		cd_guia_prestador_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaPrestador',1);	
		cd_senha_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:senha',1);								
		dt_validade_senha_w		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataValidadeSenha',1));		
		nm_segurado_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:nomeBeneficiario',1);									
		cd_cgc_prest_solic_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:cnpjContratado',1);	
		cd_cpf_prest_solic_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:cpfContratado',1);
		nr_seq_protocolo_w		:= nr_seq_protocolo_p;		
		nm_prestador_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:nomeContratado',1);
		nm_contratado_solicit_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:nomeContratadoSolicitante',1);
		nm_prestador_imp_w		:= coalesce(nm_prestador_imp_w, nm_contratado_solicit_w);
		vl_procedimentos_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorProcedimentos',1));	
		vl_diarias_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorDiarias',1));			
		vl_taxas_imp_w 			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTaxasAlugueis',1));				
		vl_materiais_imp_w		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMateriais',1));	
		vl_medicamentos_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMedicamentos',1));		
		vl_gases_imp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorGasesMedicinais',1));		
		vl_opm_imp_w 			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorOPME',1));		
		vl_total_imp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTotalGeral',1));
		nm_medico_solic_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:nomeProfissional',1);	
		cd_cbo_saude_solic_imp_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:CBOS',1);
		sg_conselho_solic_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:conselhoProfissional',1);			
		uf_crm_solic_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:UF',1);			
		nr_crm_solic_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solic_w,'ans:numeroConselhoProfissional',1);	
		nm_prestador_exec_imp_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:nomeContratado',1);
		nr_carteira_benef_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroCarteira',1);		
		ie_recem_nascido_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_beneficiario_w,'ans:atendimentoRN',1);
		ie_tipo_atendimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:tipoAtendimento',1);
		ie_tipo_consulta_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:tipoConsulta',1);	
		ie_indicacao_acidente_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:indicacaoAcidente',1);
		ie_motivo_encerramento_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:motivoEncerramento',1);
		ie_regime_atendimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:regimeAtendimento',1);
		ie_saude_ocupacional_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_atendimento_w,'ans:saudeOcupacional',1);
		cd_cnes_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:CNES',1);
		ie_carater_atendimento_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solicitacao_w,'ans:caraterAtendimento',1);
		ie_cobertura_especial_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_solicitacao_w,'ans:indCobEspecial',1);
		
	elsif ( ie_tipo_guias_p = 5) then
		ds_guia_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_xml_p,'ans:guiaResumoInternacao',nr_guia_w);
		ds_exec_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosExecutante',1);
		ds_dados_internacao_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosInternacao',1);
		ds_dados_saida_internacao_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosSaidaInternacao',1);
		ds_dados_beneficiario_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosBeneficiario',1);
		
		cd_guia_principal_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaSolicitacaoInternacao',1);
		cd_cgc_prest_exec_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:cnpjContratado',1);	
		cd_cpf_prest_exec_w	 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:cpfContratado',1);		
		cd_guia_operadora_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaOperadora',1);	
		dt_autorizacao_w		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataAutorizacao',1));	
		cd_guia_prestador_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaPrestador',1);	
		cd_senha_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:senha',1);								
		dt_validade_senha_w		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataValidadeSenha',1));			
		nm_segurado_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:nomeBeneficiario',1);		
		dt_inicio_faturamento_w 	:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataInicioFaturamento',1));			
		hr_inicio_faturamento_w		:= pls_imp_pre_pagto_pck.converte_data_hora( dt_inicio_faturamento_w, pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:horaInicioFaturamento',1));
		dt_inicio_faturamento_w 	:= pls_imp_pre_pagto_pck.concatena_data_hora( to_char(dt_inicio_faturamento_w,'dd/mm/yyyy'), hr_inicio_faturamento_w);
		dt_fim_faturamento_w 		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataFinalFaturamento',1));			
		hr_fim_faturamento_w		:= pls_imp_pre_pagto_pck.converte_data_hora( dt_fim_faturamento_w, pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:horaFinalFaturamento',1));
		dt_fim_faturamento_w 		:= pls_imp_pre_pagto_pck.concatena_data_hora( to_char(dt_fim_faturamento_w,'dd/mm/yyyy'), hr_fim_faturamento_w);
		nr_seq_protocolo_w		:= nr_seq_protocolo_p;		
		nm_prestador_exec_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:nomeContratado',1);			
		vl_procedimentos_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorProcedimentos',1));	
		vl_diarias_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorDiarias',1));			
		vl_taxas_imp_w 			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTaxasAlugueis',1));				
		vl_materiais_imp_w		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMateriais',1));	
		vl_medicamentos_imp_w 		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMedicamentos',1));		
		vl_gases_imp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorGasesMedicinais',1));		
		vl_opm_imp_w 			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorOPME',1));		
		vl_total_imp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTotalGeral',1));	
		nr_carteira_benef_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroCarteira',1);			
		ie_recem_nascido_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_beneficiario_w,'ans:atendimentoRN',1);
		ie_regime_internacao_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_internacao_w,'ans:regimeInternacao',1);
		ie_tipo_faturamento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_internacao_w,'ans:tipoFaturamento',1);
		ie_tipo_internacao_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_internacao_w,'ans:tipoInternacao',1);
		ie_motivo_encerramento_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_saida_internacao_w,'ans:motivoEncerramento',1);
		cd_cnes_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:CNES',1);
		ie_carater_atendimento_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_internacao_w,'ans:caraterAtendimento',1);
		ie_indicacao_acidente_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_saida_internacao_w,'ans:indicadorAcidente',1);
			
	elsif ( ie_tipo_guias_p = 6) then
		ds_guia_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_xml_p,'ans:guiaHonorarios',nr_guia_w);
		ds_local_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:localContratado',1);
		ds_exec_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosContratadoExecutante',1);					
		cd_guia_principal_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:guiaSolicInternacao',1);
		
		/*No Schema das guias de honorario, na  tag dos dados do contratado executante, apenas existe a tag codigonaOperadora como identificador do mesmo,
			nao tendo tags especificas para CPF ou CNPJ e em  conversa com Diogo, definimos utilizar a codigoNaOperadora a principio, pois em tese a indetificacao
			via CPF ou CNPJ devera estar contida aqui
		*/
		
		if (length(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_exec_w,'ans:codigonaOperadora',1)) = 14) then
			cd_cgc_prest_exec_w := pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_exec_w,'ans:codigonaOperadora',1);--No schema do honorario individual nao tem tag para cpf do executor, entao provavelmente vira nessa tag o CNPJ
		elsif (length(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_exec_w,'ans:codigonaOperadora',1)) = 11) then
			cd_cpf_prest_exec_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_exec_w,'ans:codigonaOperadora',1);--No schema do honorario individual nao tem tag para cpf do executor, entao provavelmente vira nessa tag o CPF
		end if;
		
		cd_guia_operadora_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:numeroGuiaOperadora',1);	
		cd_guia_prestador_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:numeroGuiaPrestador',1);	
		cd_senha_w 				:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:senha',1);								
		dt_validade_senha_w		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:dataValidadeSenha',1));		
		nm_segurado_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:nomeBeneficiario',1);										
		nr_seq_protocolo_w		:= nr_seq_protocolo_p;					
		vl_total_imp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:valorTotalHonorarios',1));
		nm_medico_solic_imp_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_solic_w,'ans:nomeProfissional',1);	
		cd_cbo_saude_solic_imp_w := pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_solic_w,'ans:CBOS',1);
		sg_conselho_solic_imp_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_solic_w,'ans:conselhoProfissional',1);			
		uf_crm_solic_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_solic_w,'ans:UF',1);			
		nr_crm_solic_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_solic_w,'ans:numeroConselhoProfissional',1);	
		nm_prestador_exec_imp_w := pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_exec_w,'ans:nomeContratadoExecutante',1);
		dt_atendimento_w 		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:dataEmissaoGuia',1));			
		dt_fim_faturamento_w 	:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:dataFimFaturamento',1));		
		dt_inicio_faturamento_w := pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:dataInicioFaturamento',1));
		dt_emissao_guia_w 		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:dataEmissaoGuia',1));	
		nr_carteira_benef_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:numeroCarteira',1);	
		cd_cnes_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:cnesContratadoExecutante',1);
		cnes_local_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_local_w,'ans:cnes',1);
		nome_hospital_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_local_w,'ans:nomeContratado',1);
		cd_cgc_hospital_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_local_w,'ans:cnpjLocalExecutante',1); --Na guia de HI, essa tag sera o identificador do local executante
		ie_recem_nascido_imp_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:atendimentoRN',1);
		
	elsif (ie_tipo_guias_p = 3) then
		ds_guia_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_xml_p,'ans:guiaConsulta',nr_guia_w);
		ds_exec_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:contratadoExecutante',1);
		ds_prof_exec_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:profissionalExecutante',1);
		ds_ident_acidente_consulta 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:identificacaoAcidente',1);
		cd_cgc_prest_exec_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:cnpjContratado',1);	
		cd_cpf_prest_exec_w	 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:cpfContratado',1);			
		cd_guia_operadora_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaOperadora',1);	
		cd_guia_prestador_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaPrestador',1);	
		nm_segurado_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:nomeBeneficiario',1);									
		nr_seq_protocolo_w		:= nr_seq_protocolo_p;		
		nm_prestador_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:nomeContratado',1);	
		nm_prestador_exec_imp_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:nomeContratado',1);
		ie_cobertura_especial_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:coberturaEspecial',1);
		ie_regime_atendimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:regimeAtendimento',1);
		ie_saude_ocupacional_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:saudeOcupacional',1);
		dt_atendimento_w 		:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:dataAtendimento',1));						
		nm_medico_executor_imp_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_prof_exec_w,'ans:nomeProfissional',1);			
		nr_crm_exec_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_prof_exec_w,'ans:numeroConselhoProfissional',1);		
		sg_conselho_exec_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_prof_exec_w,'ans:conselhoProfissional',1);	
		uf_crm_exec_imp_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_prof_exec_w,'ans:UF',1);
		cd_cbo_saude_exec_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_prof_exec_w,'ans:CBOS',1);
		nr_carteira_benef_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroCarteira',1);
		cd_cnes_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_exec_w,'ans:CNES',1);	
		ie_indicacao_acidente_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:indicacaoAcidente',1);
		ie_recem_nascido_imp_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:atendimentoRN',1);
	end if;
		
		nr_conta_gerada_w := pls_imp_pre_pagto_pck.inserir_guias(	nr_conta_gerada_w, cd_cgc_prest_exec_w, cd_guia_operadora_w, cd_guia_prestador_w, cd_guia_principal_w, cd_senha_w, dt_validade_senha_w, dt_autorizacao_w, nm_segurado_imp_w, cd_cpf_prest_exec_w, cd_medico_solicitante_imp_w, cd_medico_executor_imp_w, cd_cgc_prest_solic_w, cd_cpf_prest_solic_w, nr_seq_protocolo_w, nm_prestador_imp_w, dt_atendimento_w, dt_fim_faturamento_w, dt_inicio_faturamento_w, dt_emissao_guia_w, vl_procedimentos_imp_w, vl_diarias_imp_w, vl_taxas_imp_w, vl_materiais_imp_w, vl_medicamentos_imp_w, vl_gases_imp_w, vl_opm_imp_w, vl_total_imp_w, cd_cbo_saude_exec_imp_w, nm_medico_solic_imp_w, cd_cbo_saude_solic_imp_w, sg_conselho_solic_imp_w, nm_medico_executor_imp_w, nr_crm_exec_imp_w, sg_conselho_exec_imp_w, uf_crm_exec_imp_w, uf_crm_solic_imp_w, nr_crm_solic_imp_w, nm_prestador_exec_imp_w, nr_carteira_benef_w, nm_usuario_p, ie_recem_nascido_imp_w, ie_tipo_atendimento_w, ie_tipo_consulta_w, ie_indicacao_acidente_w, nr_seq_motivo_encerramento_w, ie_regime_internacao_w, ie_tipo_faturamento_w, ie_tipo_internacao_w, ie_tipo_guias_p, cd_cnes_w, ie_carater_atendimento_w, ie_motivo_encerramento_w, cnes_local_w, nome_hospital_w, cd_cgc_hospital_w, ie_regime_atendimento_w, ie_saude_ocupacional_w, ie_cobertura_especial_w);
			
	if (ie_tipo_guias_p in (4, 5)) then
	
		-- Outras depesas

		ds_desps_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:outrasDespesas',1);
		nr_tag_desp_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_desps_w,'ans:despesa');	
		while(nr_desp_w <= nr_tag_desp_w) loop
			ds_desp_w					:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desps_w,'ans:despesa',nr_desp_w);
			cd_despesa_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoDespesa',1);
			dt_execucao_desp_w			:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:dataExecucao',1));
			hr_inicial_desp_w			:= pls_imp_pre_pagto_pck.converte_data_hora(to_char(to_date(dt_execucao_desp_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:horaInicial',1));
			hr_final_desp_w				:= pls_imp_pre_pagto_pck.converte_data_hora( to_char(to_date(dt_execucao_desp_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:horaFinal',1));	
			hr_inicial_desp_w			:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date(dt_execucao_desp_w,'dd/mm/yyyy'), hr_inicial_desp_w);
			hr_final_desp_w				:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date(dt_execucao_desp_w,'dd/mm/yyyy'), hr_final_desp_w);
			cd_tabela_desp_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoTabela',1);
			cd_mat_envio_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoProcedimento',1);
			qt_executada_desp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:quantidadeExecutada',1));
			cd_unidade_medida_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:unidadeMedida',1);
			tx_reducao_acrescimo_desp_w	:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:reducaoAcrescimo',1));
			vl_unitario_desp_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:valorUnitario',1));
			vl_total_desp_w				:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:valorTotal',1));
			ds_material_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:descricaoProcedimento',1);
			nr_registro_anvisa_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:registroANVISA',1);
			cd_ref_fabricante_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoRefFabricante',1);
			cd_autoriz_funcionamento_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_desp_w,'ans:autorizacaoFuncionamento',1);
			
			-- Inserir ergistros na pls_fat_conta_item

			nr_seq_item_gerado_w := pls_imp_pre_pagto_pck.inserir_fat_item( cd_mat_envio_w, cd_ref_fabricante_w, cd_tabela_desp_w, cd_unidade_medida_w, ds_material_w, dt_execucao_desp_w, hr_final_desp_w, hr_inicial_desp_w, null, cd_despesa_w, 'OD', null, nm_usuario_p, cd_autoriz_funcionamento_w, nr_registro_anvisa_w, nr_conta_gerada_w, qt_executada_desp_w, tx_reducao_acrescimo_desp_w, vl_total_desp_w, vl_unitario_desp_w, nr_seq_item_gerado_w);
		
			nr_desp_w := nr_desp_w + 1;
		end loop;
		nr_desp_w := 1;
	
	end if;
	
	if (ie_tipo_guias_p = 4) then
	
		-- Procedimentos

		ds_procs_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:procedimentosExecutados',1);
		nr_tag_proc_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_procs_w,'ans:procedimentoExecutado');
		while(nr_proc_w <= nr_tag_proc_w) loop
			ds_proc_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_procs_w,'ans:procedimentoExecutado',nr_proc_w);
			dt_execucao_w			:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:dataExecucao',1));
			hr_inicial_w			:= pls_imp_pre_pagto_pck.converte_data_hora(to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaInicial',1));
			hr_final_w			:= pls_imp_pre_pagto_pck.converte_data_hora(to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaFinal',1));		
			hr_inicial_w			:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date( dt_execucao_w,'dd/mm/yyyy'), hr_inicial_w);
			hr_final_w				:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date( dt_execucao_w,'dd/mm/yyyy'), hr_final_w);
			cd_tabela_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoTabela',1);
			cd_proc_envio_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoProcedimento',1);
			ds_procedimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:descricaoProcedimento',1);
			qt_executada_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:quantidadeExecutada',1));
			ie_via_acesso_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:viaAcesso',1);
			ie_tecnica_utilizada_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:tecnicaUtilizada',1);
			tx_reducao_acrescimo_w		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:reducaoAcrescimo',1));
			vl_unitario_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:valorUnitario',1));
			vl_total_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:valorTotal',1));
			
			-- Inserir registros na pls_fat_conta_item

			nr_seq_item_gerado_w := pls_imp_pre_pagto_pck.inserir_fat_item( cd_proc_envio_w, null, cd_tabela_w, null, ds_procedimento_w, dt_execucao_w, hr_final_w, hr_inicial_w, ie_tecnica_utilizada_w, null, 'P', ie_via_acesso_w, nm_usuario_p, null, null, nr_conta_gerada_w, qt_executada_w, tx_reducao_acrescimo_w, vl_total_w, vl_unitario_w, nr_seq_item_gerado_w);
			
			-- Participantes

			nr_tag_equipe_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_proc_w,'ans:equipeSadt');
			while(nr_equipe_w <= nr_tag_equipe_w) loop
				ds_equipe_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:equipeSadt',nr_equipe_w);
				ie_grau_participante_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:grauPart',1);
				cd_cpf_contratado_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:cpfContratado',1);
				nm_profissional_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:nomeProf',1);				
				nr_conselho_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:numeroConselhoProfissional',1);
				nr_cbo_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:CBOS',1);
				cd_uf_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:UF',1);
				cd_conselho_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:conselho',1);
				
				-- Inserir participante A520

				CALL pls_imp_pre_pagto_pck.inserir_partic(	nr_cbo_w, cd_conselho_w, cd_cpf_contratado_w,
								ie_grau_participante_w, nm_profissional_w, nm_usuario_p,
								nr_conselho_w, nr_seq_item_gerado_w, cd_versao_tiss_p,
								cd_uf_w);

				nr_equipe_w := nr_equipe_w + 1;
			end loop;
			nr_equipe_w := 1;
			
			nr_proc_w := nr_proc_w + 1;
		end loop;
		nr_proc_w := 1;
	
	
	elsif (ie_tipo_guias_p = 5) then
	
		-- Procedimentos

		ds_procs_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:procedimentosExecutados',1);
		nr_tag_proc_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_procs_w,'ans:procedimentoExecutado');
		while(nr_proc_w <= nr_tag_proc_w) loop
			ds_proc_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_procs_w,'ans:procedimentoExecutado',nr_proc_w);
			dt_execucao_w			:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:dataExecucao',1));
			hr_inicial_w			:= pls_imp_pre_pagto_pck.converte_data_hora( to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaInicial',1));
			hr_final_w			:= pls_imp_pre_pagto_pck.converte_data_hora( to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaFinal',1));
			hr_inicial_w			:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date( dt_execucao_w,'dd/mm/yyyy'), hr_inicial_w);
			hr_final_w				:= pls_imp_pre_pagto_pck.concatena_data_hora(to_date( dt_execucao_w,'dd/mm/yyyy'), hr_final_w);			
			cd_tabela_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoTabela',1);
			cd_proc_envio_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoProcedimento',1);
			ds_procedimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:descricaoProcedimento',1);
			qt_executada_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:quantidadeExecutada',1));
			ie_via_acesso_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:viaAcesso',1);
			ie_tecnica_utilizada_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:tecnicaUtilizada',1);
			tx_reducao_acrescimo_w		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:reducaoAcrescimo',1));
			vl_unitario_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:valorUnitario',1));
			vl_total_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:valorTotal',1));
			
			-- Inserir registros na pls_fat_conta_item

			nr_seq_item_gerado_w := pls_imp_pre_pagto_pck.inserir_fat_item( cd_proc_envio_w, null, cd_tabela_w, null, ds_procedimento_w, dt_execucao_w, hr_final_w, hr_inicial_w, ie_tecnica_utilizada_w, null, 'P', ie_via_acesso_w, nm_usuario_p, null, null, nr_conta_gerada_w, qt_executada_w, tx_reducao_acrescimo_w, vl_total_w, vl_unitario_w, nr_seq_item_gerado_w);
							
			-- Participantes

			nr_tag_equipe_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_proc_w,'ans:identificacaoEquipe');
			while(nr_equipe_w <= nr_tag_equipe_w) loop
				ds_equipe_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:identificacaoEquipe',nr_equipe_w);
				ie_grau_participante_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:grauPart',1);
				cd_cpf_contratado_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:cpfContratado',1);
				nm_profissional_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:nomeProf',1);
				nr_conselho_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:numeroConselhoProfissional',1);
				nr_cbo_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:CBOS',1);
				cd_uf_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:UF',1);
				cd_conselho_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:conselho',1);
				
				-- Inserir participante A520

				CALL pls_imp_pre_pagto_pck.inserir_partic(	nr_cbo_w, cd_conselho_w, cd_cpf_contratado_w,
								ie_grau_participante_w, nm_profissional_w, nm_usuario_p,
								nr_conselho_w, nr_seq_item_gerado_w, cd_versao_tiss_p,
								cd_uf_w);

				nr_equipe_w := nr_equipe_w + 1;
			end loop;
			nr_equipe_w := 1;
						
			nr_proc_w := nr_proc_w + 1;
		end loop;
		nr_proc_w := 1;
	
	elsif (ie_tipo_guias_p = 6) then
	
		-- Procedimentos

		ds_procs_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_guia_w,'ans:procedimentosRealizados',1);
		nr_tag_proc_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_procs_w,'ans:procedimentoRealizado');
		while( nr_proc_w <= nr_tag_proc_w) loop
			ds_proc_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_procs_w,'ans:procedimentoRealizado',nr_proc_w);
			dt_execucao_w			:= pls_imp_pre_pagto_pck.converte_data(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:dataExecucao',1));
			hr_inicial_w			:= pls_imp_pre_pagto_pck.converte_data_hora(to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaInicial',1));
			hr_final_w			:= pls_imp_pre_pagto_pck.converte_data_hora(to_char(to_date(dt_execucao_w,'dd/mm/yyyy'),'dd/mm/yyyy'),pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:horaFinal',1));		
			cd_tabela_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoTabela',1);
			cd_proc_envio_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoProcedimento',1);
			ds_procedimento_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:descricaoProcedimento',1);
			qt_executada_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:quantidadeExecutada',1));
			ie_via_acesso_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:viaAcesso',1);
			ie_tecnica_utilizada_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:tecnicaUtilizada',1);
			tx_reducao_acrescimo_w		:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:reducaoAcrescimo',1));
			vl_unitario_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:valorUnitario',1));
			vl_total_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag( ds_proc_w,'ans:valorTotal',1));
			
			-- Inserir registros na pls_fat_conta_item

			nr_seq_item_gerado_w := pls_imp_pre_pagto_pck.inserir_fat_item( cd_proc_envio_w, null, cd_tabela_w, null, ds_procedimento_w, dt_execucao_w, hr_final_w, hr_inicial_w, ie_tecnica_utilizada_w, null, 'P', ie_via_acesso_w, nm_usuario_p, null, null, nr_conta_gerada_w, qt_executada_w, tx_reducao_acrescimo_w, vl_total_w, vl_unitario_w, nr_seq_item_gerado_w);
			
			-- Participantes

			nr_tag_equipe_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_proc_w,'ans:profissionais');
			while(nr_equipe_w <= nr_tag_equipe_w) loop
				
				ds_equipe_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_proc_w,'ans:profissionais',nr_equipe_w);
				ie_grau_participante_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:grauParticipacao',1);
				cd_cpf_contratado_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:cpfContratado',1);
				nm_profissional_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:nomeProfissional',1);
				nr_conselho_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:numeroConselhoProfissional',1);				
				nr_cbo_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:CBO',1);
				cd_uf_w				:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:UF',1);
				cd_conselho_w		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_equipe_w,'ans:conselhoProfissional',1);
						
				-- Inserir participante A520

				CALL pls_imp_pre_pagto_pck.inserir_partic(	nr_cbo_w, cd_conselho_w, cd_cpf_contratado_w,
								ie_grau_participante_w, nm_profissional_w, nm_usuario_p,
								nr_conselho_w, nr_seq_item_gerado_w, cd_versao_tiss_p,
								cd_uf_w);

				nr_equipe_w := nr_equipe_w + 1;
			end loop;
			nr_equipe_w := 1;
			
			nr_proc_w := nr_proc_w + 1;
		end loop;
		nr_proc_w := 1;
	
	elsif (ie_tipo_guias_p = 3) then
	
		-- Procedimentos

		nr_tag_proc_w			:= 1;
		while(nr_proc_w <= nr_tag_proc_w) loop
			dt_execucao_w			:= null;
			hr_inicial_w			:= null;
			hr_final_w			:= null;		
			cd_tabela_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:codigoTabela',1);
			cd_proc_envio_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:codigoProcedimento',1);
			ds_procedimento_w		:= null;
			qt_executada_w			:= 1;
			ie_via_acesso_w			:= null;
			ie_tecnica_utilizada_w		:= null;
			tx_reducao_acrescimo_w		:= null;
			vl_unitario_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorProcedimento',1));
			vl_total_w			:= pls_imp_pre_pagto_pck.converte_numero(pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:valorProcedimento',1));
			
			-- Inserir registros na pls_fat_conta_item

			nr_seq_item_gerado_w := pls_imp_pre_pagto_pck.inserir_fat_item( cd_proc_envio_w, null, cd_tabela_w, null, ds_procedimento_w, dt_execucao_w, hr_final_w, hr_inicial_w, ie_tecnica_utilizada_w, null, 'P', ie_via_acesso_w, nm_usuario_p, null, null, nr_conta_gerada_w, qt_executada_w, tx_reducao_acrescimo_w, vl_total_w, vl_unitario_w, nr_seq_item_gerado_w);
			
			nr_proc_w := nr_proc_w + 1;
		end loop;
		nr_proc_w := 1;
	
	end if;	
	
	if (ie_tipo_guias_p = 5) then
		ds_dados_declaracoes_w	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:declaracoes',1);
		
		nr_tag_declaracoes_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_procs_w,'ans:declaracoes');
		while(nr_declaracao_w <= nr_tag_declaracoes_w) loop
			
			declaracao_nascido_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_declaracoes_w,'ans:declaracaoNascido',1);
			diagnostico_obito_w 	:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_declaracoes_w,'ans:diagnosticoObito',1);
			declaracao_obito_w 		:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_declaracoes_w,'ans:declaracaoObito',1);
			indicador_rn_w			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_dados_declaracoes_w,'ans:indicadorDORN',1);
			
			if (declaracao_nascido_w IS NOT NULL AND declaracao_nascido_w::text <> '') then
				
				CALL pls_imp_pre_pagto_pck.inserir_declaracao_nasc_vivo(nr_conta_gerada_w, declaracao_nascido_w, indicador_rn_w, nm_usuario_p);							
				
			end if;
			
			if (declaracao_obito_w IS NOT NULL AND declaracao_obito_w::text <> '') then
				CALL pls_imp_pre_pagto_pck.inserir_declaracao_obito( nr_conta_gerada_w, declaracao_obito_w, diagnostico_obito_w, indicador_rn_w, nm_usuario_p);
			end if;
		
			nr_declaracao_w := nr_declaracao_w + 1;
		end loop;
				
	end if;
	
	--Diagnostico

	nr_diag_w				:= 1;
	nr_tag_diag_w			:= pls_imp_pre_pagto_pck.obter_numero_tag(ds_guia_w,'ans:diagnostico');
	while(nr_diag_w <= nr_tag_diag_w) loop
		cd_doenca_w 			:= pls_imp_pre_pagto_pck.obter_conteudo_tag(ds_guia_w,'ans:diagnostico',1);
		
		insert into pls_fat_diagnostico_conta(	nr_sequencia, cd_doenca, dt_atualizacao,
												dt_atualizacao_nrec, nm_usuario, nm_usuario_nrec, 
												nr_seq_conta, cd_doenca_conv) 
		values (nextval('pls_fat_diagnostico_conta_seq'), cd_doenca_w, clock_timestamp(), 
				clock_timestamp(), nm_usuario_p, nm_usuario_p,
				nr_conta_gerada_w, cd_doenca_w);
		
		nr_diag_w := nr_diag_w + 1;
	end loop;
	
	nr_guia_w := nr_guia_w + 1;
	
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_pre_pagto_pck.carregar_contas_e_dependentes ( ds_xml_p pls_faturamento_arq.ds_xml%type, nr_seq_protocolo_p pls_faturamento_prot.nr_sequencia%type, nr_guias_p bigint, ie_tipo_guias_p pls_protocolo_conta.ie_tipo_guia%type, cd_versao_tiss_p pls_faturamento_prot.cd_versao_tiss%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
