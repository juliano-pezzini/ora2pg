-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_imp_pre_pagto_pck.conversao_participantes ( nr_seq_prot_gerado_p pls_faturamento_prot.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE


sg_conselho_w	pls_fat_conta_item_equipe.sg_conselho_imp%type;
									
C01 CURSOR FOR
	SELECT	a.nr_sequencia,
			a.cd_conselho_profissional
	from	pls_fat_conta_item_equipe a,
			pls_fat_conta_item b,
			pls_faturamento_conta c
	where	a.nr_seq_item_conta = b.nr_sequencia
	and		b.nr_seq_conta = c.nr_sequencia
	and		c.nr_seq_protocolo = nr_seq_prot_gerado_p;
									
BEGIN

for r_c01_w in c01 loop

	select 	max(sg_conselho)
	into STRICT 	sg_conselho_w
	from 	tiss_conselho_profissional
	where 	cd_conselho = r_c01_w.cd_conselho_profissional;
	
	update 	pls_fat_conta_item_equipe
	set		sg_conselho_imp = sg_conselho_w
	where	nr_sequencia = r_c01_w.nr_sequencia;

end loop;

END; 								

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_pre_pagto_pck.conversao_participantes ( nr_seq_prot_gerado_p pls_faturamento_prot.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
