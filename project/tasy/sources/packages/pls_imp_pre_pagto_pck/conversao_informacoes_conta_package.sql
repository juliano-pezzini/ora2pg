-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_imp_pre_pagto_pck.conversao_informacoes_conta ( nr_seq_prot_gerado_p pls_faturamento_prot.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE


c01 CURSOR FOR
	SELECT	b.ie_tipo_internacao,
			b.ie_tipo_atendimento,
			(	SELECT 	max(nr_sequencia)
				from 	pls_tipo_atendimento x
				where	x.cd_tiss = b.ie_tipo_atendimento
				and		x.cd_estabelecimento = cd_estabelecimento_p) nr_seq_tipo_atend_conv,
			(	select	max(a.nr_sequencia)
				from	pls_clinica a
				where	a.cd_tiss = b.ie_tipo_internacao) ie_tipo_intern_conv,
			pls_obter_seq_mot_saida_tiss(b.ie_motivo_encerramento, a.cd_versao_tiss, cd_estabelecimento_p) nr_seq_motivo_encerramento,
			b.nr_sequencia nr_seq_fat_conta,
			b.ie_recem_nascido_imp
	from	pls_faturamento_prot a,
			pls_faturamento_conta b
	where	a.nr_sequencia = nr_seq_prot_gerado_p
	and		b.nr_seq_protocolo = a.nr_sequencia;
										
BEGIN

	for r_c01_w in c01 loop
	
		update 	pls_faturamento_conta
		set		nr_seq_tipo_atend_conv = r_c01_w.nr_seq_tipo_atend_conv,
				ie_tipo_internacao_conv = r_c01_w.ie_tipo_intern_conv,
				nr_seq_motivo_encerramento = r_c01_w.nr_seq_motivo_encerramento,
				ie_recem_nascido				= r_c01_w.ie_recem_nascido_imp
		where	nr_sequencia = r_c01_w.nr_seq_fat_conta;
				
	end loop;

END;							

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_pre_pagto_pck.conversao_informacoes_conta ( nr_seq_prot_gerado_p pls_faturamento_prot.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
