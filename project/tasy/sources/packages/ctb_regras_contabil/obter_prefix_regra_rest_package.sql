-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_regras_contabil.obter_prefix_regra_rest ( cd_tipo_lote_contabil_p LOTE_CONTABIL.CD_TIPO_LOTE_CONTABIL%type, ds_operacao_p text ) RETURNS ARR_REGRA_PREFIX_T AS $body$
DECLARE


    cd_regra_mais_rest_w        REGRAS_TIPO_LOTE_CONTABIL.CD_REGRA%type;
    cd_regra_w                  REGRAS_TIPO_LOTE_CONTABIL.CD_REGRA%type     := '';
    ds_prefixo_w                REGRAS_TIPO_LOTE_CONTABIL.DS_PREFIXO%type   := '';
    arr_data_w                  arr_regra_prefix_t;


BEGIN
	
        cd_regra_mais_rest_w    := ctb_regras_contabil.ctb_obter_regra_mais_retr(cd_tipo_lote_contabil_p, ds_operacao_p);
	
        IF (cd_regra_mais_rest_w IS NOT NULL AND cd_regra_mais_rest_w::text <> '') THEN
            cd_regra_w              := trim(both REGEXP_SUBSTR(cd_regra_mais_rest_w,'[^,]+',1, 1));
            ds_prefixo_w            := trim(both REGEXP_SUBSTR(cd_regra_mais_rest_w,'[^,]+',1, 2));
        END IF;
	
        arr_data_w(1) := cd_regra_w;
        arr_data_w(2) := ds_prefixo_w;
        RETURN arr_data_w;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_regras_contabil.obter_prefix_regra_rest ( cd_tipo_lote_contabil_p LOTE_CONTABIL.CD_TIPO_LOTE_CONTABIL%type, ds_operacao_p text ) FROM PUBLIC;
