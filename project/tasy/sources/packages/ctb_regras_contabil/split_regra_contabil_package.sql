-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_regras_contabil.split_regra_contabil ( ds_comando_p text, ds_alias_p text, ds_separador_p text ) RETURNS varchar AS $body$
DECLARE


    ds_flag_w           varchar(50)     := 'ds_valor';
    ds_comando_base_w   varchar(4000)   := '';


BEGIN

        IF (ds_comando_p IS NOT NULL AND ds_comando_p::text <> '') THEN
            ds_comando_base_w := ' SELECT ' || ds_flag_w || ' FROM (WITH TBL AS (' || ds_comando_p || ')' ||
            ' SELECT SUBSTR('|| ds_alias_p ||
            ', INSTR(' || ds_alias_p || 
            ', ''' || ds_separador_p || ''', 1, LEVEL) + 1, NVL(LEAD(INSTR(' || ds_alias_p ||
            ', ''' || ds_separador_p || ''', 1, LEVEL)) OVER (ORDER BY INSTR('|| ds_alias_p ||
            ', ''' || ds_separador_p || ''', 1, LEVEL)) -1, LENGTH('|| ds_alias_p ||
            ' ) + 1) -  INSTR('|| ds_alias_p ||
            ', ''' || ds_separador_p || ''', 1, LEVEL)) ' || ds_flag_w ||
            ' FROM TBL, DUAL' ||
            ' CONNECT BY LEVEL <= LENGTH(' || ds_alias_p ||
            ') - LENGTH(REPLACE(' || ds_alias_p || 
            ', ''' || ds_separador_p || ''')) + 1)';

            RETURN ds_comando_base_w;
        END IF;

        RETURN '';

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_regras_contabil.split_regra_contabil ( ds_comando_p text, ds_alias_p text, ds_separador_p text ) FROM PUBLIC;
