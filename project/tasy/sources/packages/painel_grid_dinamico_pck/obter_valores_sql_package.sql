-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION painel_grid_dinamico_pck.obter_valores_sql (ds_sql text, nm_atributo text, ds_atributo_p text default null, nr_seq_sql_p bigint default null) RETURNS SETOF T_VALORES_SQL AS $body$
DECLARE


  sql_base_w       varchar(4000);
  t_valores_sql_w  t_valores_sql;


  retorno_valores_sql_w REFCURSOR;

  cont_w 		smallint;
  nm_atributo_w varchar(255);

BEGIN

	nm_atributo_w := nm_atributo;
	if (coalesce(nm_atributo::text, '') = '') then
		nm_atributo_w := painel_grid_dinamico_pck.get_nm_atributo(ds_atributo_p, nr_seq_sql_p);
	end if;

	select count(*)
	into STRICT   cont_w
	
	where  ds_sql like '%ds_cor%';

	if (cont_w > 0) then
		sql_base_w := ' select ' || nm_atributo_w || ', ds_cor ' ||
					  ' from  (' || ds_sql || ')';
	else
		sql_base_w := ' select ' || nm_atributo_w || ', null ds_cor ' ||
				      ' from  (' || ds_sql || ')';
	end if;

	begin
		open retorno_valores_sql_w for EXECUTE sql_base_w;
		fetch retorno_valores_sql_w bulk collect into t_valores_sql_w limit current_setting('painel_grid_dinamico_pck.qt_registro_limite_w')::integer;
		close retorno_valores_sql_w;

		for i in t_valores_sql_w.first..t_valores_sql_w.last loop
			RETURN NEXT t_valores_sql_w(i);
		end loop;
	exception when others then
		sql_base_w := '';
	end;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION painel_grid_dinamico_pck.obter_valores_sql (ds_sql text, nm_atributo text, ds_atributo_p text default null, nr_seq_sql_p bigint default null) FROM PUBLIC;
