-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION schedule_daily_calendar_pck.get_legenda_data ( nr_seq_imagem_p text) RETURNS SETOF ITEM_LEGENDA_RECORD_DATA AS $body$
DECLARE

        item_legenda_record_type_w item_legenda_record_type;
		cd_estabelecimento_w estabelecimento.cd_estabelecimento%type := wheb_usuario_pck.get_cd_estabelecimento;
		cd_perfil_w perfil.cd_perfil%type := wheb_usuario_pck.get_cd_perfil;
		nm_usuario_w usuario.nm_usuario%type := wheb_usuario_pck.get_nm_usuario;
	
  i RECORD;

BEGIN
		For i IN (WITH RECURSIVE cte AS (
select regexp_substr(nr_seq_imagem_p ,'[^,]+', 1, level) As str  (regexp_substr(nr_seq_imagem_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_seq_imagem_p, '[^,]+', 1, level))::text <> '')  UNION ALL
select regexp_substr(nr_seq_imagem_p ,'[^,]+', 1, level) As str  (regexp_substr(nr_seq_imagem_p, '[^,]+', 1, level) IS NOT NULL AND (regexp_substr(nr_seq_imagem_p, '[^,]+', 1, level))::text <> '') JOIN cte c ON ()

) SELECT * FROM cte;
)
		LOOP
			select i.str, OBTER_SE_EXIBE_ITEM_LEGENDA(null,i.str,cd_estabelecimento_w,cd_perfil_w,nm_usuario_w)
				into STRICT item_legenda_record_type_w.nr_seq_imagem , item_legenda_record_type_w.ie_utiliza;
			RETURN NEXT item_legenda_record_type_w;
		END LOOP;
	return;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION schedule_daily_calendar_pck.get_legenda_data ( nr_seq_imagem_p text) FROM PUBLIC;
