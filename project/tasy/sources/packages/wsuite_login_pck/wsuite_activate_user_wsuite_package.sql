-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wsuite_login_pck.wsuite_activate_user_wsuite ( ds_hash_ativacao_p wsuite_usuario.ds_hash_ativacao%type, nm_usuario_p usuario.nm_usuario%type, ds_replacement_login_p INOUT wsuite_usuario.nm_usuario_web%type, ds_login_p INOUT wsuite_usuario.ds_login%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finality: Activate user, after to receive the email
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta:
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Caution:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


ds_replacement_login_w	wsuite_usuario.nm_usuario_web%type;
ds_login_w		wsuite_usuario.ds_login%type;

C01 CURSOR FOR
	SELECT	count(1) over () qt_registro,
		nm_usuario_web,
		ds_login
	from	wsuite_usuario
	where	ds_hash_ativacao 	= ds_hash_ativacao_p
	and	ie_situacao		= 'I';

BEGIN

for c01_w in c01 loop

	if ( c01_w.qt_registro = 1 ) then
		ds_replacement_login_w  := c01_w.nm_usuario_web;
		ds_login_w		:= c01_w.ds_login;


		update	wsuite_usuario
		set	nm_usuario 		= nm_usuario_p,
			dt_atualizacao 		= clock_timestamp(),
			dt_ativacao		= clock_timestamp(),
			ie_situacao		= 'A'
		where	ds_hash_ativacao	= ds_hash_ativacao_p
		and	ie_situacao		= 'I';

		commit;
	end if;
end loop;

ds_replacement_login_p	:= ds_replacement_login_w;
ds_login_p		:= ds_login_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wsuite_login_pck.wsuite_activate_user_wsuite ( ds_hash_ativacao_p wsuite_usuario.ds_hash_ativacao%type, nm_usuario_p usuario.nm_usuario%type, ds_replacement_login_p INOUT wsuite_usuario.nm_usuario_web%type, ds_login_p INOUT wsuite_usuario.ds_login%type) FROM PUBLIC;
