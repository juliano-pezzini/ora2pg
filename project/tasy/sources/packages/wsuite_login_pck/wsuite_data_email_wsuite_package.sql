-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wsuite_login_pck.wsuite_data_email_wsuite ( ds_email_p INOUT text, ds_endereco_p INOUT text, cd_cep_p INOUT text, sg_estado_p INOUT text, nr_telefone_p INOUT text, ds_razao_social_p INOUT pessoa_juridica.ds_razao_social%type, ds_email_remetente_p INOUT wsuite_configuracao.ds_email_remetente%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finality: Return data for email signature
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta:
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Caution:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


cd_cgc_w 	pessoa_juridica.cd_cgc%type;

C01 CURSOR( cd_cgc_pc 	pessoa_juridica.cd_cgc%type )FOR

	SELECT  ds_email,
		a.ds_endereco,
		a.cd_cep,
		a.sg_estado,
		nr_ddd_telefone || ' ' || nr_telefone nr_phone,
		(SELECT b.ds_razao_social
		from    pessoa_juridica b
		where   b.cd_cgc = a.cd_cgc) ds_razao_social
	from    pessoa_juridica_compl a
	where   a.cd_cgc = cd_cgc_pc
	and     a.ie_tipo_complemento = 3
	
union

	select  a.ds_email,
		a.ds_endereco,
		a.cd_cep,
		a.sg_estado,
		nr_ddd_telefone || ' ' || nr_telefone nr_phone,
		ds_razao_social
	from    pessoa_juridica a
	where   a.cd_cgc = cd_cgc_pc
	and     not exists (select 1
			  from  pessoa_juridica_compl b
			  where   b.cd_cgc = a.cd_cgc
			  and     b.ie_tipo_complemento = 3);

C02 CURSOR FOR
	SELECT	cd_estabelecimento,
		ds_email_remetente,
		(SELECT	max(cd_cgc)
		from	estabelecimento
		where	cd_estabelecimento = a.cd_estabelecimento) cd_cgc
	from	wsuite_configuracao a;

BEGIN


for c02_w in c02 loop

	for c01_w in c01( c02_w.cd_cgc ) loop
		ds_email_p		:= c01_w.ds_email;
		ds_endereco_p		:= c01_w.ds_endereco;
		cd_cep_p		:= c01_w.cd_cep;
		sg_estado_p		:= c01_w.sg_estado;
		nr_telefone_p		:= c01_w.nr_phone;
		ds_razao_social_p  	:= c01_w.ds_razao_social;
		ds_email_remetente_p 	:= c02_w.ds_email_remetente;
	end loop;

end loop;


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wsuite_login_pck.wsuite_data_email_wsuite ( ds_email_p INOUT text, ds_endereco_p INOUT text, cd_cep_p INOUT text, sg_estado_p INOUT text, nr_telefone_p INOUT text, ds_razao_social_p INOUT pessoa_juridica.ds_razao_social%type, ds_email_remetente_p INOUT wsuite_configuracao.ds_email_remetente%type) FROM PUBLIC;
