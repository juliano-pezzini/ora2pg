-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wsuite_login_pck.wsuite_include_patient ( ds_given_name_P person_name.ds_given_name%type, ds_family_name_P person_name.ds_family_name%type, ds_component_name1_P person_name.ds_component_name_1%type, ds_component_name2_P person_name.ds_component_name_2%type, ds_component_name3_P person_name.ds_component_name_3%type, nr_cpf_p pessoa_fisica.nr_cpf%type, nr_identidade_p pessoa_fisica.nr_identidade%type, cd_rfc_p pessoa_fisica.cd_rfc%type, nm_pessoa_fisica_p pessoa_fisica.nm_pessoa_fisica%type, dt_nascimento_p pessoa_fisica.dt_nascimento%type, ds_email_p compl_pessoa_fisica.ds_email%type, ie_sexo_p pessoa_fisica.ie_sexo%type, cd_usuario_plano_p pls_segurado_carteira.cd_usuario_plano%type, nr_ddd_celular_p pessoa_fisica.nr_ddd_celular%type, nr_telefone_celular_p pessoa_fisica.nr_telefone_celular%type, cd_cep_p compl_pessoa_fisica.cd_cep%type, ds_endereco_p compl_pessoa_fisica.ds_endereco%type, cd_municipio_ibge_p compl_pessoa_fisica.cd_municipio_ibge%type, nr_seq_pais_p pais.nr_sequencia%type, nr_passaporte_p pessoa_fisica.nr_passaporte%type, sg_estado_p compl_pessoa_fisica.sg_estado%type, ds_municipio_p compl_pessoa_fisica.ds_municipio%type, sg_departamento_p pessoa_fisica_aux.sg_departamento%type, nr_digito_verif_p pessoa_fisica_aux.nr_digito_verif%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_solic_inclusao_p INOUT wsuite_solic_inclusao_pf.nr_sequencia%type) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finality: Insert a new user on database
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta:
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  x] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------

Caution:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */

nr_seq_solic_w	 	wsuite_solic_inclusao_pf.nr_sequencia%type;
nr_seq_person_name_w	person_name.nr_sequencia%type;
nm_pessoa_fisica_w	pessoa_fisica.nm_pessoa_fisica%type;


BEGIN

--This validation is required because some problem may occur in the process after the include request

select	max(nr_sequencia)
into STRICT	nr_seq_solic_w
from	wsuite_solic_inclusao_pf
where	ds_email 	= ds_email_p
and	dt_nascimento 	= dt_nascimento_p
and (coalesce(ie_origem_solicitacao::text, '') = '' or ie_origem_solicitacao = '1');

if	( ( (ds_email_p IS NOT NULL AND ds_email_p::text <> '') and coalesce(nr_seq_solic_w::text, '') = '' ) and (  (nm_pessoa_fisica_p IS NOT NULL AND nm_pessoa_fisica_p::text <> '') or (ds_given_name_p IS NOT NULL AND ds_given_name_p::text <> '') ) ) then

	nr_seq_solic_w := wsuite_login_pck.wsuite_include_request( ds_given_name_P, ds_family_name_P, ds_component_name1_P, ds_component_name2_P, ds_component_name3_P, nr_cpf_p, nr_identidade_p, cd_rfc_p, nm_pessoa_fisica_p, dt_nascimento_p, ds_email_p, ie_sexo_p, cd_usuario_plano_p, nr_ddd_celular_p, nr_telefone_celular_p, cd_cep_p, ds_endereco_p, cd_municipio_ibge_p, nr_seq_pais_p, nr_passaporte_p, sg_estado_p, ds_municipio_p, null, null, null, null, null, null, '1', sg_departamento_p, nr_digito_verif_p, nm_usuario_p, nr_seq_solic_w);	
	
end if;

nr_seq_solic_inclusao_p := nr_seq_solic_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wsuite_login_pck.wsuite_include_patient ( ds_given_name_P person_name.ds_given_name%type, ds_family_name_P person_name.ds_family_name%type, ds_component_name1_P person_name.ds_component_name_1%type, ds_component_name2_P person_name.ds_component_name_2%type, ds_component_name3_P person_name.ds_component_name_3%type, nr_cpf_p pessoa_fisica.nr_cpf%type, nr_identidade_p pessoa_fisica.nr_identidade%type, cd_rfc_p pessoa_fisica.cd_rfc%type, nm_pessoa_fisica_p pessoa_fisica.nm_pessoa_fisica%type, dt_nascimento_p pessoa_fisica.dt_nascimento%type, ds_email_p compl_pessoa_fisica.ds_email%type, ie_sexo_p pessoa_fisica.ie_sexo%type, cd_usuario_plano_p pls_segurado_carteira.cd_usuario_plano%type, nr_ddd_celular_p pessoa_fisica.nr_ddd_celular%type, nr_telefone_celular_p pessoa_fisica.nr_telefone_celular%type, cd_cep_p compl_pessoa_fisica.cd_cep%type, ds_endereco_p compl_pessoa_fisica.ds_endereco%type, cd_municipio_ibge_p compl_pessoa_fisica.cd_municipio_ibge%type, nr_seq_pais_p pais.nr_sequencia%type, nr_passaporte_p pessoa_fisica.nr_passaporte%type, sg_estado_p compl_pessoa_fisica.sg_estado%type, ds_municipio_p compl_pessoa_fisica.ds_municipio%type, sg_departamento_p pessoa_fisica_aux.sg_departamento%type, nr_digito_verif_p pessoa_fisica_aux.nr_digito_verif%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_solic_inclusao_p INOUT wsuite_solic_inclusao_pf.nr_sequencia%type) FROM PUBLIC;
