-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_consistir_diops_pck.pls_diops_consist_idade_saldos ( nr_seq_periodo_p bigint, cd_estabelecimento_p bigint) AS $body$
DECLARE

							
	ds_acao_usuario_w			diops_periodo_inconsist.ds_acao_usuario%type;	
	dt_primeiro_mes_w			diops_periodo.dt_periodo_inicial%type;
	dt_terceiro_mes_w			diops_periodo.dt_periodo_inicial%type;	
	vl_individual_pre_w			diops_fin_idadesaldo_ati.vl_individual%type;
	vl_individual_pre_ppsc_w		diops_fin_idadesaldo_ati.vl_individual%type;
	vl_individual_pos_w			diops_fin_idadesaldo_ati.vl_individual%type;
	vl_individual_pos_ppsc_w		diops_fin_idadesaldo_ati.vl_individual%type;
	vl_coletivo_pre_w			diops_fin_idadesaldo_ati.vl_coletivo_pre%type;
	vl_coletivo_pre_ppsc_w			diops_fin_idadesaldo_ati.vl_coletivo_pre%type;
	vl_coletivo_pos_w			diops_fin_idadesaldo_ati.vl_coletivo_pos%type;
	vl_coletivo_pos_ppsc_w			diops_fin_idadesaldo_ati.vl_coletivo_pos%type;
	vl_taxa_adm_w				diops_fin_idadesaldo_ati.vl_taxa_adm%type;
	vl_taxa_adm_ppsc_w			diops_fin_idadesaldo_ati.vl_taxa_adm%type;
	vl_part_benefes_w			diops_fin_idadesaldo_ati.vl_part_benefes%type;
	vl_part_benefes_ppsc_w			diops_fin_idadesaldo_ati.vl_part_benefes%type;
	vl_credito_operadoras_w			diops_fin_idadesaldo_ati.vl_credito_operadoras%type;
	vl_credito_operadoras_ppsc_w		diops_fin_idadesaldo_ati.vl_credito_operadoras%type;
	vl_outros_creditos_w			diops_fin_idadesaldo_ati.vl_outros_creditos%type;
	vl_outros_creditos_ppsc_w		diops_fin_idadesaldo_ati.vl_outros_creditos%type;
	vl_outros_cred_sem_plano_w		diops_fin_idadesaldo_ati.vl_outros_creditos_sem_plano%type;
	vl_outros_cred_plano_ppsc_w		diops_fin_idadesaldo_ati.vl_outros_creditos_sem_plano%type;
	vl_cred_operadoras_pos_w		diops_fin_idadesaldo_ati.vl_credito_oper_pos%type;
	
	vl_evento_pass_w			diops_fin_idadesaldo_pas.vl_evento_liquidar%type;
	vl_comerc_pass_w			diops_fin_idadesaldo_pas.vl_comercializacao%type;	
	vl_deb_operad_pass_w			diops_fin_idadesaldo_pas.vl_debito_operadora%type;	
	vl_outros_deb_operad_pass_w		diops_fin_idadesaldo_pas.vl_debito_oper%type;		
	vl_prest_serv_pass_w			diops_fin_idadesaldo_pas.vl_prest_serv_as%type;	
	vl_outros_deb_pag_pass_w                diops_fin_idadesaldo_pas.vl_outros_deb_pagar%type;	
	vl_deb_ben_seg_rec_pass_w		diops_fin_idadesaldo_pas.vl_deb_ben_con_seg_rec%type;	
	vl_aquis_carre_pass_w			diops_fin_idadesaldo_pas.vl_dep_aquis_carre%type;	
	vl_eventos_sus_pass_w			diops_fin_idadesaldo_pas.vl_eventos_sus%type;		
	vl_titulos_encargos_pass_w		diops_fin_idadesaldo_pas.vl_titulos_encargos%type;
	
	vl_saldo_individuais_pre_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_indiv_pre_ppsc_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_individuais_pos_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_indiv_pos_ppsc_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_coletivos_pre_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_col_pre_ppsc_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_coletivos_pos_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_col_pos_ppsc_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_taxa_adm_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_taxa_ppsc_w 			ctb_balancete_v.vl_movimento%type;
	vl_saldo_part_benefes_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_part_benef_ppsc_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_oper_ant_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_oper_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_oper_ppsc_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_operadoras_w		ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_ant_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_ppsc_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_cred_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_total_w			ctb_balancete_v.vl_movimento%type;
	vl_total_w				ctb_balancete_v.vl_movimento%type;
	vl_outros_sem_plano_w			ctb_balancete_v.vl_movimento%type;
	vl_outros_plano_ppsc_w			ctb_balancete_v.vl_movimento%type;
	vl_saldo_total_ppsc_w			ctb_balancete_v.vl_movimento%type;
	vl_total_ppsc_w				ctb_balancete_v.vl_movimento%type;
	vl_saldo_sus_w				ctb_balancete_v.vl_movimento%type;
	vl_saldo_event_sinis_w               	ctb_balancete_v.vl_movimento%type;
	vl_saldo_comerc_operac_w                ctb_balancete_v.vl_movimento%type;
	vl_saldo_deb_operad_w                   ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_deb_operac_w            ctb_balancete_v.vl_movimento%type;
	vl_saldo_trib_encarg_w                  ctb_balancete_v.vl_movimento%type;
	vl_saldo_deb_benef_w                    ctb_balancete_v.vl_movimento%type;
	vl_saldo_prest_serv_w                   ctb_balancete_v.vl_movimento%type;
	vl_saldo_deb_aquis_cart_w               ctb_balancete_v.vl_movimento%type;
	vl_saldo_outros_deb_pag_w               ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_operadoras_pos_w 		ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_oper_pos_ant_w 		ctb_balancete_v.vl_movimento%type;
	vl_saldo_cred_oper_pos_w		ctb_balancete_v.vl_movimento%type;

	c_titulos_pagar CURSOR FOR
		SELECT 	a.nr_titulo													
		from  	titulo_pagar a,													
			titulo_pagar_classif b												
		where 	a.nr_titulo = b.nr_titulo											
		and	coalesce(a.dt_liquidacao::text, '') = ''												
		and	a.dt_emissao < dt_periodo_final_w										
		and	coalesce(b.cd_conta_contabil,'0') = '0'										
		and	a.ie_origem_titulo in ('5', '6', '8', '9', '10', '12', '15', '16', '18', '19', '20', '23', '24', '25');	 	

	vet_titulos_pagar			c_titulos_pagar%rowtype;
	
	c_titulos_receber CURSOR FOR
		SELECT 	a.nr_titulo													
		from  	titulo_receber a,												
			titulo_receber_classif b											
		where 	a.nr_titulo = b.nr_titulo											
		and	coalesce(a.dt_liquidacao::text, '') = ''												
		and	a.dt_emissao < dt_periodo_final_w										
		and	coalesce(b.cd_conta_contabil,'0') = '0'										
		and	a.ie_origem_titulo in ('5', '6', '8', '9', '10', '12', '15', '16', '18', '19', '20', '23', '24', '25');		
		
	vet_titulos_receber			c_titulos_receber%rowtype;
	
	
BEGIN
	
	delete	from 	diops_periodo_inconsist a
	where	a.nr_seq_periodo	= nr_seq_periodo_p
	and		a.nr_seq_inconsistencia	in (72,78,80,87);
	
	commit;

	PERFORM set_config('pls_consistir_diops_pck.nr_quadro_w', 20, false);
	
	select	a.dt_periodo_inicial,
			a.dt_periodo_final
	into STRICT	dt_primeiro_mes_w,
			dt_terceiro_mes_w
	from	diops_periodo		a
	where	a.nr_sequencia		= nr_seq_periodo_p;
	
	--ACTIVE
	select 		coalesce(sum(a.vl_individual),0),
			coalesce(sum(a.vl_individual_pos),0),
			coalesce(sum(a.vl_coletivo_pre),0),
			coalesce(sum(a.vl_coletivo_pos),0),
			coalesce(sum(a.vl_taxa_adm),0),
			coalesce(sum(a.vl_part_benefes),0),
			coalesce(sum(a.vl_credito_operadoras),0),
			coalesce(sum(a.vl_outros_creditos),0),
			coalesce(sum(a.vl_outros_creditos_sem_plano),0),
			coalesce(sum(a.vl_credito_oper_pos), 0)
	into STRICT		vl_individual_pre_w,
			vl_individual_pos_w,
			vl_coletivo_pre_w,
			vl_coletivo_pos_w,
			vl_taxa_adm_w,
			vl_part_benefes_w,
			vl_credito_operadoras_w,
			vl_outros_creditos_w,
			vl_outros_cred_sem_plano_w,
			vl_cred_operadoras_pos_w
	from		diops_fin_idadesaldo_ati a
	where		a.nr_seq_periodo	= nr_seq_periodo_p
	and		a.ie_tipo_vencimento 	in ('00','30','60','90','999');

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_individuais_pre_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123111011','123121011')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_individuais_pos_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123112011','123122011')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_coletivos_pre_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('123111012','123111013', '123121012', '123121013') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto in ('123111012','123121012', '123112015', '123122015') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_coletivos_pos_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('123112012', '123112013', '123112015', '123122012', '123122013', '123122015') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123112012','123122012') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_taxa_adm_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('123219011','123219012','123219021','123219022','123229011','123229012','123229021','123229022') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123111013','123111014','123112013','123112014','123121013','123121014','123122013','123122014') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_part_benefes_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123311011','123312011','123321011','123322011')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_cred_oper_ant_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('123411', '123421') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	= '1234' and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_cred_oper_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('123411091','123421091') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123411091','123412091','123421091','123422091') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	vl_saldo_cred_operadoras_w := vl_saldo_cred_oper_ant_w - vl_saldo_cred_oper_w;

	select 	coalesce(sum(v.vl_movimento), 0)
	into STRICT	vl_saldo_cred_oper_pos_ant_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123412', '123422')
	and	current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S'
	and	v.ie_normal_encerramento = 'N';

	select 	coalesce(sum(v.vl_movimento), 0)
	into STRICT	vl_saldo_cred_oper_pos_w
	from	ctb_balancete_v 	v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto	in ('123412091', '123422091')
	and	current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S'
	and	v.ie_normal_encerramento = 'N';

	vl_saldo_cred_operadoras_pos_w := vl_saldo_cred_oper_pos_ant_w - vl_saldo_cred_oper_pos_w;

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_outros_ant_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	= '1239'
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_outros_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('123911019', '123911029', '123911089', '123912089', '123921019', '123921029', '123921089','123922089') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123911019','123911089','123912089','123921019','123921089','123922089') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	vl_saldo_outros_cred_w := vl_saldo_outros_ant_w - vl_saldo_outros_w;

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_outros_sem_plano_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto 	in ('124119011','124119021','124119022', '124119082', '124119088','124129011','124129021','124129022', '124129082', '124129088') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('124119011','124119021','124119022','124119088','124129011','124129021','124129022','124129088') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';
		
	PERFORM set_config('pls_consistir_diops_pck.ds_ativo_passivo_macro_w', wheb_mensagem_pck.get_texto(840789) || ',', false);

	if (vl_individual_pre_w <> vl_saldo_individuais_pre_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823710)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111011 e 123121011', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_individual_pos_w <> vl_saldo_individuais_pos_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823711)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112011 e 123122011', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_coletivo_pre_w <> vl_saldo_coletivos_pre_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823804)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111012, 123111013, 123121012 e 123121013', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111012 e 123121012', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_coletivo_pos_w <> vl_saldo_coletivos_pos_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823820)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112012, 123112013, 123112015, 123122012, 123122013 e 123122015', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112012 e 123122012', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;
	
	if (vl_taxa_adm_w <> vl_saldo_taxa_adm_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(840791) || ',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123219011, 123219012, 123219021, 123219022, 123229011, 123229012, 123229021 e 123229022', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111013, 123111014, 123112013, 123112014, 123121013, 123121014, 123122013 e 123122014', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_part_benefes_w <> vl_saldo_part_benefes_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823907)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123311011, 123312011, 123321011 e 123322011', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_credito_operadoras_w <> vl_saldo_cred_operadoras_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823916)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123411091, 123412091, 123421091 e 123422091', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_cred_operadoras_pos_w <> vl_saldo_cred_operadoras_pos_w and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(1059390)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123412, 123412091, 123422, 123422091', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_outros_creditos_w <> vl_saldo_outros_cred_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823928)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123911019, 123911029, 123911089, 123912089, 123921019, 123921029, 123921089 e 123922089', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123911019, 123911089, 123912089, 123921019, 123921089 e 123922089', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	vl_saldo_total_w := vl_saldo_individuais_pre_w + vl_saldo_individuais_pos_w + vl_saldo_coletivos_pre_w + vl_saldo_coletivos_pos_w + vl_saldo_taxa_adm_w + vl_saldo_part_benefes_w + vl_saldo_cred_operadoras_w + vl_saldo_outros_cred_w;

	vl_total_w := vl_individual_pre_w + vl_individual_pos_w + vl_coletivo_pre_w + vl_coletivo_pos_w + vl_taxa_adm_w + vl_part_benefes_w + vl_credito_operadoras_w + vl_outros_creditos_w;

	if (vl_saldo_total_w <> vl_total_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_ativo_passivo_macro_w', wheb_mensagem_pck.get_texto(840789), false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 87);
	end if;
	
	if (vl_outros_cred_sem_plano_w <> vl_outros_sem_plano_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(840804) || ',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '124119011, 124119021, 124119022, 124119088, 124129011, 124129021, 124129022 e 124129088', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;
	
	--ACTIVE PPSC
	select 	coalesce(sum(a.vl_individual),0),
			coalesce(sum(a.vl_individual_pos),0),
			coalesce(sum(a.vl_coletivo_pre),0),
			coalesce(sum(a.vl_coletivo_pos),0),
			coalesce(sum(a.vl_taxa_adm),0),
			coalesce(sum(a.vl_part_benefes),0),
			coalesce(sum(a.vl_credito_operadoras),0),
			coalesce(sum(a.vl_outros_creditos),0),
			coalesce(sum(a.vl_outros_creditos_sem_plano),0)
	into STRICT	vl_individual_pre_ppsc_w,
			vl_individual_pos_ppsc_w,
			vl_coletivo_pre_ppsc_w,
			vl_coletivo_pos_ppsc_w,
			vl_taxa_adm_ppsc_w,
			vl_part_benefes_ppsc_w,
			vl_credito_operadoras_ppsc_w,
			vl_outros_creditos_ppsc_w,
			vl_outros_cred_plano_ppsc_w
	from	diops_fin_idadesaldo_ati a
	where	a.nr_seq_periodo	= nr_seq_periodo_p
	and	a.ie_tipo_vencimento 	in ('400');

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_indiv_pre_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123111091','123121091')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_indiv_pos_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123112091','123122091')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_col_pre_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('123111092', '123111093','123121092', '123121093') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto in ('123111092','123121092') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_col_pos_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('123112092', '123112093', '123112095', '123122092', '123122093', '123122095') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto in ('123112092','123122092', '123112015', '123122015') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_taxa_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('123219019', '123219029', '123229019', '123229029') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123111093','123111094','123112093','123112094','123121093','123121094','123122093','123122094') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_part_benef_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123311019','123312019','123321019','123322019')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_cred_oper_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('123411091','123412091','123421091','123422091')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_outros_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('123911019', '123911029', '123911089','123912089','123921019', '123921029','123921089','123922089') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto 	in ('123911019','123911089','123912089','123921019','123921089','123922089') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_outros_plano_ppsc_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('124119019','124119029','124119089','124129019','124129029','124129089')
	and	v.ie_normal_encerramento = 'N';

	PERFORM set_config('pls_consistir_diops_pck.ds_ativo_passivo_macro_w', wheb_mensagem_pck.get_texto(841241), false);

	if (vl_individual_pre_ppsc_w <> vl_saldo_indiv_pre_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823710)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111091 e 123121091', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_individual_pos_ppsc_w <> vl_saldo_indiv_pos_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823711)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112091 e 123122091', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_coletivo_pre_ppsc_w <> vl_saldo_col_pre_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823804)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111092, 123111093, 123121092 e 123121093', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111092 e 123121092', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_coletivo_pos_ppsc_w <> vl_saldo_col_pos_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823820)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112092, 123112093, 123112095, 123122092, 123122093 e 123122095', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123112092 e 123122092', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_taxa_adm_ppsc_w <> vl_saldo_taxa_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(840791) || ',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123219019, 123219029, 123229019 e 123229029', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123111093,123111094,123112093,123112094,123121093,123121094,123122093 e 123122094', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_part_benefes_ppsc_w <> vl_saldo_part_benef_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823907)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123311019, 123312019, 123321019 e 123322019', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_credito_operadoras_ppsc_w <> vl_saldo_cred_oper_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823916)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123411091, 123412091, 123421091 e 123422091', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_outros_creditos_ppsc_w <> vl_saldo_outros_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(823928)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123911019, 123911029, 123911089, 123912089, 123921019, 123921029, 123921089 e 123922089', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '123911019, 123911089, 123912089, 123921019, 123921089 e 123922089', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	vl_saldo_total_ppsc_w := vl_saldo_indiv_pre_ppsc_w + vl_saldo_indiv_pos_ppsc_w + vl_saldo_col_pre_ppsc_w + vl_saldo_col_pos_ppsc_w + vl_saldo_taxa_ppsc_w + vl_saldo_part_benef_ppsc_w + vl_saldo_cred_oper_ppsc_w + vl_saldo_outros_ppsc_w + vl_outros_plano_ppsc_w;

	vl_total_ppsc_w := vl_individual_pre_ppsc_w + vl_individual_pos_ppsc_w + vl_coletivo_pre_ppsc_w + vl_coletivo_pos_ppsc_w + vl_taxa_adm_ppsc_w + vl_part_benefes_ppsc_w + vl_credito_operadoras_ppsc_w + vl_outros_creditos_ppsc_w + vl_outros_cred_plano_ppsc_w;

	if (vl_total_ppsc_w <> vl_saldo_total_ppsc_w) then
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 87);
	end if;

	if (vl_outros_cred_plano_ppsc_w <> vl_outros_plano_ppsc_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(840804) || ',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '124119019, 124119029, 124119089, 124129019, 124129029 e 124129089', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;
	
	--PASSIVE
	select 	coalesce(sum(a.vl_evento_liquidar),0),
			coalesce(sum(vl_comercializacao),0),
			coalesce(sum(vl_debito_operadora),0),
			coalesce(sum(vl_debito_oper),0),
			coalesce(sum(vl_prest_serv_as),0),
			coalesce(sum(vl_outros_deb_pagar),0),
			coalesce(sum(vl_deb_ben_con_seg_rec),0),
			coalesce(sum(vl_dep_aquis_carre),0),
			coalesce(sum(vl_eventos_sus),0),
			coalesce(sum(vl_titulos_encargos),0)
	into STRICT	vl_evento_pass_w,		
			vl_comerc_pass_w,		
			vl_deb_operad_pass_w,		
			vl_outros_deb_operad_pass_w,		
			vl_prest_serv_pass_w,		
			vl_outros_deb_pag_pass_w,
			vl_deb_ben_seg_rec_pass_w,	
			vl_aquis_carre_pass_w,		
			vl_eventos_sus_pass_w,		
			vl_titulos_encargos_pass_w	
	from	diops_fin_idadesaldo_pas a
	where	a.nr_seq_periodo	= nr_seq_periodo_p
	and		a.ie_tipo_vencimento 	in ('00','30','60','90','120','999');

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_sus_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('21111102', '21111202', '21112102', '21112202') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto in ('2111902','21112902') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_event_sinis_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	((v.cd_classif_sem_ponto in ('21111103', '21111203', '21112103', '21112203') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S')
		or (v.cd_classif_sem_ponto in ('21111903','21112903') and current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N'))
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_comerc_operac_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2134')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_deb_operad_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2135')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_outros_deb_operac_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2131','2138')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_trib_encarg_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('216')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_deb_benef_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2185')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_prest_serv_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('214')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_deb_aquis_cart_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2186')
	and	v.ie_normal_encerramento = 'N';

	select	coalesce(sum(v.vl_movimento),0)
	into STRICT	vl_saldo_outros_deb_pag_w
	from	ctb_balancete_v		v
	where	v.dt_referencia between dt_primeiro_mes_w and dt_terceiro_mes_w
	and	v.cd_classif_sem_ponto 	in ('2188')
	and	v.ie_normal_encerramento = 'N';

	commit;

	PERFORM set_config('pls_consistir_diops_pck.ds_ativo_passivo_macro_w', wheb_mensagem_pck.get_texto(841237) || ',', false);
	
	if (vl_eventos_sus_pass_w <> vl_saldo_sus_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831983)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '21111102, 21111202, 21112102 e 21112202', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2111902 e 21112902', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_evento_pass_w <> vl_saldo_event_sinis_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831985)||',', false);
		if (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'S') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '21111103, 21111203, 21112103 e 21112203', false);
		elsif (current_setting('pls_consistir_diops_pck.ie_2019_ou_posterior_w')::varchar(2) = 'N') then
			PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '21111903 e 21112903', false);
		end if;
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_comerc_pass_w <> vl_saldo_comerc_operac_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831986)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2134', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_deb_operad_pass_w <> vl_saldo_deb_operad_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831993)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2135', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_outros_deb_operad_pass_w <> vl_saldo_outros_deb_operac_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831994)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2131 e 2138', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_titulos_encargos_pass_w <> vl_saldo_trib_encarg_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831995)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '216', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_deb_ben_seg_rec_pass_w <> vl_saldo_deb_benef_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831996)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2185', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_prest_serv_pass_w <> vl_saldo_prest_serv_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831997)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '214', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_aquis_carre_pass_w <> vl_saldo_deb_aquis_cart_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831998)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2186', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;

	if (vl_outros_deb_pag_pass_w <> vl_saldo_outros_deb_pag_w) then
		PERFORM set_config('pls_consistir_diops_pck.ds_campo_macro_w', wheb_mensagem_pck.get_texto(831999)||',', false);
		PERFORM set_config('pls_consistir_diops_pck.nr_contas_macro_w', '2188', false);
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 72);
	end if;
	
	PERFORM set_config('pls_consistir_diops_pck.ds_titulos_w', null, false);
	
	open c_titulos_pagar;

	loop	
	fetch c_titulos_pagar into	
		vet_titulos_pagar;
	EXIT WHEN NOT FOUND; /* apply on c_titulos_pagar */
		begin
	
		if (length(current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500)||', '||vet_titulos_pagar.nr_titulo) > 180) then
			exit;
		end if;
					
		PERFORM set_config('pls_consistir_diops_pck.ds_titulos_w', current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500)||', '||vet_titulos_pagar.nr_titulo, false);	
		
		end;
	end loop;
	close c_titulos_pagar;
		
	if (coalesce(current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500),'0') <> '0') then
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 78);
	end if;
	
	PERFORM set_config('pls_consistir_diops_pck.ds_titulos_w', null, false);
	
	open c_titulos_receber;
	loop
	fetch c_titulos_receber into	
		vet_titulos_receber;
	EXIT WHEN NOT FOUND; /* apply on c_titulos_receber */
		begin
			
		if (length(current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500)||', '||vet_titulos_receber.nr_titulo) > 180) then
			exit;
		end if;
					
		PERFORM set_config('pls_consistir_diops_pck.ds_titulos_w', current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500)||', '||vet_titulos_receber.nr_titulo, false);
		
		end;
	end loop;
	close c_titulos_receber;
		
	if (coalesce(current_setting('pls_consistir_diops_pck.ds_titulos_w')::varchar(500),'0') <> '0') then
		CALL pls_consistir_diops_pck.pls_gravar_consistencia(nr_seq_periodo_p, cd_estabelecimento_p, 80);
	end if;

	commit;	

	PERFORM set_config('pls_consistir_diops_pck.nr_quadro_w', 0, false);
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_consistir_diops_pck.pls_diops_consist_idade_saldos ( nr_seq_periodo_p bigint, cd_estabelecimento_p bigint) FROM PUBLIC;
