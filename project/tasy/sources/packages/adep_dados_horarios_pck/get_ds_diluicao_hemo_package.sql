-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION adep_dados_horarios_pck.get_ds_diluicao_hemo ( nr_prescricao_p bigint, nr_seq_prescr_proced_p bigint, nr_seq_solic_san_p bigint, ie_tipo_p text ) RETURNS varchar AS $body$
DECLARE

	
	ds_retorno_w 		varchar(2000)	:= null;
	ds_aux_w 		varchar(2000)	:= null;
	ie_aliquotado_w		prescr_procedimento.ie_aliquotado%type;
	ie_filtrado_w		prescr_procedimento.ie_filtrado%type;
	ie_irradiado_w		prescr_procedimento.ie_irradiado%type;
	ie_lavado_w		prescr_procedimento.ie_lavado%type;
	ie_via_aplicacao_w	prescr_procedimento.ie_via_aplicacao%type;
	ds_observacao_w		prescr_procedimento.ds_observacao%type;
	
BEGIN
	
	select 	max(ie_aliquotado),
		max(ie_filtrado),
		max(ie_irradiado),
		max(ie_lavado),
		max(ie_via_aplicacao),
		max(ds_observacao)
	into STRICT	ie_aliquotado_w,
		ie_filtrado_w,
		ie_irradiado_w,
		ie_lavado_w,
		ie_via_aplicacao_w,
		ds_observacao_w
	from 	prescr_procedimento
	where 	nr_sequencia 	= nr_seq_prescr_proced_p
	and 	nr_prescricao	= nr_prescricao_p;

	if (ie_aliquotado_w = 'S') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(283367) || '; ', 'N');
	end if;
	if (ie_filtrado_w = 'S') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(290096) || '; ', 'N');
	end if;
	if (ie_irradiado_w = 'S') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(292247) || '; ', 'N');
	end if;
	if (ie_lavado_w = 'S') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(292460) || '; ', 'N');
	end if;
	
	ds_aux_w := obter_via_aplicacao(ie_via_aplicacao_w,'D');
	if (ds_aux_w IS NOT NULL AND ds_aux_w::text <> '') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(301661) || ': ' || ds_aux_w);
	end if;

	ds_aux_w := obter_infusion_duration_cpoe(nr_seq_solic_san_p);
	if (ds_aux_w IS NOT NULL AND ds_aux_w::text <> '') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(1024001) || ': '|| ds_aux_w);
	end if;
	
	ds_aux_w	:= obter_valor_dominio_idioma(1223, ie_tipo_p, wheb_usuario_pck.get_nr_seq_idioma);
	if (ds_aux_w IS NOT NULL AND ds_aux_w::text <> '') then
		ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(657039, '') || ': ' || ds_aux_w);
	end if;
	
	if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
		if (pkg_i18n.get_user_locale() = 'en_AU') then
			ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(obter_desc_expressao(294286, '') || ': ' || ds_observacao_w, ds_retorno_w);
		else
			ds_retorno_w	:= adep_dados_horarios_pck.get_value_concat(ds_retorno_w, obter_desc_expressao(294286, '') || ': ' || ds_observacao_w);
		end if;
	end if;

	
	return substr(ds_retorno_w,1,2000);
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION adep_dados_horarios_pck.get_ds_diluicao_hemo ( nr_prescricao_p bigint, nr_seq_prescr_proced_p bigint, nr_seq_solic_san_p bigint, ie_tipo_p text ) FROM PUBLIC;
