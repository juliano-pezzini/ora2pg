-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION adep_dados_horarios_pck.get_ds_diluicao_gas ( nr_seq_cpoe_p bigint, nr_prescricao_p bigint, nr_seq_gas_p bigint, ie_disp_resp_esp_p text, cd_modalidade_vent_p text, ie_respiracao_p text, ie_modo_adm_p text, ds_observacao_p text ) RETURNS varchar AS $body$
DECLARE


	ds_retorno_w 		varchar(2000)	:= null;
	ds_obs_just_w 		varchar(2000)	:= null;
	ds_aux_w 		varchar(2000)	:= null;
	ie_disp_resp_esp_w	varchar(30);
	ds_respiratorio_w	varchar(50);
	ie_respiracao_cpoe_w	cpoe_gasoterapia.ie_respiracao%type;
	qt_fio2_w		cpoe_gasoterapia.qt_fio2%type;
	ds_fio2_w		varchar(20);

	
BEGIN
	
	if (ie_disp_resp_esp_p IS NOT NULL AND ie_disp_resp_esp_p::text <> '') then
		ie_disp_resp_esp_w := substr(obter_valor_dominio(1612,ie_disp_resp_esp_p),1,30);
		/* Disp. respiracao: */

		ds_respiratorio_w := substr(wheb_mensagem_pck.get_texto(1091754) || ' ' || ie_disp_resp_esp_w,1,50);
	end if;
	
	select	max(ie_respiracao),
		max(qt_fracao_oxigenio)
	into STRICT	ie_respiracao_cpoe_w,
		qt_fio2_w
	from cpoe_gasoterapia
	where nr_sequencia = nr_seq_cpoe_p;

	if (ie_respiracao_cpoe_w = 'ESPONT' and (qt_fio2_w IS NOT NULL AND qt_fio2_w::text <> '')) then
		--Aerosolterapia
		/*FiO2 (%)*/

		ds_fio2_w := substr(chr(10) || wheb_mensagem_pck.get_texto(1127375) ||' '|| qt_fio2_w || chr(10),1,2000);
	end if;
	
	ds_retorno_w := adep_dados_horarios_pck.get_value_concat(ds_retorno_w, adep_obter_config_gas(cd_modalidade_vent_p, ie_respiracao_p, ie_modo_adm_p) || '  ' || ds_respiratorio_w || ds_fio2_w, 'N');

	if (ds_observacao_p IS NOT NULL AND ds_observacao_p::text <> '') then
		ds_obs_just_w := adep_dados_horarios_pck.get_value_concat(ds_obs_just_w, obter_desc_expressao(692668) || ds_observacao_p);
	end if;
	
	ds_aux_w := obter_justificativa_item(nr_prescricao_p, nr_seq_gas_p, 'G');
	if (ds_aux_w IS NOT NULL AND ds_aux_w::text <> '') then
		ds_obs_just_w := adep_dados_horarios_pck.get_value_concat(ds_obs_just_w, wheb_mensagem_pck.get_texto(1091527,'DS_JUSTIFICATIVA=' || ds_aux_w));
	end if;

	if (pkg_i18n.get_user_locale() = 'en_AU') then
		ds_retorno_w := adep_dados_horarios_pck.get_value_concat(ds_obs_just_w, ds_retorno_w);
	else
		ds_retorno_w := adep_dados_horarios_pck.get_value_concat(ds_retorno_w, ds_obs_just_w);
	end if;
	
	return substr(ds_retorno_w,1,2000);
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION adep_dados_horarios_pck.get_ds_diluicao_gas ( nr_seq_cpoe_p bigint, nr_prescricao_p bigint, nr_seq_gas_p bigint, ie_disp_resp_esp_p text, cd_modalidade_vent_p text, ie_respiracao_p text, ie_modo_adm_p text, ds_observacao_p text ) FROM PUBLIC;
