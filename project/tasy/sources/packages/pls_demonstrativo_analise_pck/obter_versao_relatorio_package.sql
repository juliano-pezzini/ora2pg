-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_demonstrativo_analise_pck.obter_versao_relatorio ( nr_seq_protocolo_p pls_relatorio_analise.nr_sequencia%type, nr_seq_usuario_web_p pls_regra_demons_analise.nr_seq_usuario%type, nr_seq_prestador_pag_p pls_relatorio_analise.nr_seq_prestador%type) RETURNS bigint AS $body$
DECLARE

									
nr_seq_relatorio_w	pls_relatorio_analise.nr_sequencia%type;
nr_seq_versao_w		pls_rel_an_versao.nr_sequencia%type;
nr_seq_relatorio_ws_w	pls_relatorio_analise_ws.nr_sequencia%type;


BEGIN

-- obtem a sequencia do relatorio em questao

SELECT * FROM pls_demonstrativo_analise_pck.gerar_relatorio(nr_seq_protocolo_p, nr_seq_prestador_pag_p, nr_seq_usuario_web_p, null, 'N', nr_seq_relatorio_w, nr_seq_relatorio_ws_w) INTO STRICT nr_seq_relatorio_w, nr_seq_relatorio_ws_w;

-- obtem a ultima versao do relatorio em questao

select	max(nr_sequencia)
into STRICT	nr_seq_versao_w
from	pls_rel_an_versao
where	nr_seq_relatorio_analise = nr_seq_relatorio_w;

return nr_seq_versao_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_demonstrativo_analise_pck.obter_versao_relatorio ( nr_seq_protocolo_p pls_relatorio_analise.nr_sequencia%type, nr_seq_usuario_web_p pls_regra_demons_analise.nr_seq_usuario%type, nr_seq_prestador_pag_p pls_relatorio_analise.nr_seq_prestador%type) FROM PUBLIC;
