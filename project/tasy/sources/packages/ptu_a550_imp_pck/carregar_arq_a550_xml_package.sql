-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ptu_a550_imp_pck.carregar_arq_a550_xml ( nr_seq_arq_xml_p ptu_aviso_arq_xml.nr_sequencia%type, ie_tipo_arquivo_p ptu_aviso_arq_xml.ie_tipo_arquivo%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_camara_p INOUT bigint) AS $body$
DECLARE

					
ds_erro_w		ptu_processo_camara_cont.ds_erro%type;
ds_erro_aux_w		ptu_processo_camara_cont.ds_erro%type;
ie_novo_imp_a550_w	pls_visible_false.ie_novo_imp_a550%type;


BEGIN
	nr_seq_camara_p := ptu_a550_imp_pck.carregar_arq_a550_xml_int(nr_seq_arq_xml_p, ie_tipo_arquivo_p, nm_usuario_p, cd_estabelecimento_p, nr_seq_camara_p);
	
	select	coalesce(max(ie_novo_imp_a550),'N')
	into STRICT	ie_novo_imp_a550_w
	from	pls_visible_false
	where	cd_estabelecimento = cd_estabelecimento_p;

	if (ie_novo_imp_a550_w = 'S') then
		-- Finalizar importacao A550

		pls_gerar_log_imp_a550(nr_seq_camara_p, 'IA', 'FI', nm_usuario_p, null, clock_timestamp(), null, null, 'S');
	end if;
exception
when others then
	ds_erro_w	:= substr(sqlerrm || pls_util_pck.enter_w || 'Error Back Trace: ' || dbms_utility.format_error_backtrace, 1, 4000);
	ds_erro_aux_w 	:= sqlerrm;
	
	pls_gerar_log_imp_a550(nr_seq_camara_p, 'IA', 'FI', nm_usuario_p, null, clock_timestamp(), ds_erro_w, null, 'S');
	
	-- Finalizar importacao A550

	CALL wheb_mensagem_pck.exibir_mensagem_abort(ds_erro_aux_w);
	
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_a550_imp_pck.carregar_arq_a550_xml ( nr_seq_arq_xml_p ptu_aviso_arq_xml.nr_sequencia%type, ie_tipo_arquivo_p ptu_aviso_arq_xml.ie_tipo_arquivo%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_camara_p INOUT bigint) FROM PUBLIC;
