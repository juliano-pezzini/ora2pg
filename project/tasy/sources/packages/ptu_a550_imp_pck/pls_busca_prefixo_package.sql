-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ptu_a550_imp_pck.pls_busca_prefixo (nr_sequencia_p ptu_aviso_arq_xml.nr_sequencia%type, ie_cabec_arquiv_p text ) RETURNS varchar AS $body$
DECLARE


xmltype_w      xml;
domdocument_w           dbms_xmldom.domdocument;
domnodelist_w         dbms_xmldom.domnodelist;

prefixo_w      varchar(10) := '';

BEGIN
select 	xmlparse(DOCUMENT, convert_from(, 'utf-8'))
into STRICT 	xmltype_w
from 	ptu_aviso_arq_xml a
where 	nr_sequencia = nr_sequencia_p;

-- create the dom document from our example xmltype

domdocument_w := dbms_xmldom.newdomdocument(xmltype_w);

-- find all text nodes in the dom document and return them into a node list

domnodelist_w := dbms_xslprocessor.selectnodes(	n         	=> dbms_xmldom.makenode(dbms_xmldom.getdocumentelement(domdocument_w)),
            pattern     => '/'|| ie_cabec_arquiv_p ||'/cabecalho/nrVerTra_PTU',
						namespace 	=> null);
-- iterate through the node list

for i in 0 .. dbms_xmldom.getlength(domnodelist_w) - 1 loop
	prefixo_w := dbms_xmldom.getprefix(dbms_xmldom.item(domnodelist_w, i));
end loop;

-- free up document resources

dbms_xmldom.freedocument(domdocument_w);
domdocument_w := null;

return prefixo_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ptu_a550_imp_pck.pls_busca_prefixo (nr_sequencia_p ptu_aviso_arq_xml.nr_sequencia%type, ie_cabec_arquiv_p text ) FROM PUBLIC;
