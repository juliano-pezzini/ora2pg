-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerar_mala_direta_pck.gerar_emissao_carteira (nr_seq_lote_carteira_p pls_lote_carteira.nr_sequencia%type, ie_benef_titular_p text, ie_benef_dependente_p text, ie_estipulante_pj_p text, ie_estipulante_pf_p text, ie_subestipulante_p text, ie_pagador_pj_p text, ie_pagador_pf_p text, ie_contato_contrato_p text) AS $body$
DECLARE


ie_tipo_beneficiario_w	varchar(1);
nm_usuario_w		usuario.nm_usuario%type;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;


BEGIN

nm_usuario_w		:= wheb_usuario_pck.get_nm_usuario;
cd_estabelecimento_w	:= wheb_usuario_pck.get_cd_estabelecimento;

CALL pls_gerar_mala_direta_pck.deletar_mala_direta_nm_usuario(nm_usuario_w);

if	((ie_benef_titular_p = 'S') or (ie_benef_dependente_p = 'S')) then
	if	(ie_benef_titular_p = 'S' AND ie_benef_dependente_p = 'S') then
		ie_tipo_beneficiario_w	:= 0;
	elsif (ie_benef_titular_p = 'S') then
		ie_tipo_beneficiario_w	:= 1;
	elsif (ie_benef_dependente_p = 'S') then
		ie_tipo_beneficiario_w	:= 2;
	end if;

	CALL CALL pls_gerar_mala_direta_pck.gerar_beneficiario(	null, null, null, null, null, null, nr_seq_lote_carteira_p,
				null, null, null, null, null, null, null,
				null, null, null, null, null, null, ie_tipo_beneficiario_w,
				null, null, null, null, null, null, null,
				null, null, null, null, null, null, cd_estabelecimento_w,
				nm_usuario_w);
end if;

if (ie_estipulante_pf_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_estipulante(	null, null, null, null, null, null, null,
				null, null, null, null, null, null, null,
				null, 1, null, cd_estabelecimento_w, nm_usuario_w, null, null,
				nr_seq_lote_carteira_p, null);
end if;

if (ie_estipulante_pj_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_estipulante(	null, null, null, null, null, null, null,
				null, null, null, null, null, null, null,
				null, 2, null, cd_estabelecimento_w, nm_usuario_w, null, null,
				nr_seq_lote_carteira_p, null);
end if;

if (ie_subestipulante_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_estipulante(	null, null, null, null, null, null, null,
				null, null, null, null, null, null, null,
				null, 3, null, cd_estabelecimento_w, nm_usuario_w, null, null,
				nr_seq_lote_carteira_p, null);
end if;

if (ie_contato_contrato_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_estipulante(	null, null, null, null, null, null, null,
				null, null, null, null, null, null, null,
				null, 4, null, cd_estabelecimento_w, nm_usuario_w, null, null,
				nr_seq_lote_carteira_p, null);
end if;

if (ie_pagador_pj_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_pagador(	null, null, null, null,	null, null, null,
			null, null, null, nr_seq_lote_carteira_p, null, null, null,
			null, null, null, null, null, null, cd_estabelecimento_w,
			null, 'PJ', nm_usuario_w);
end if;

if (ie_pagador_pf_p = 'S') then
	CALL pls_gerar_mala_direta_pck.gerar_pagador(	null, null, null, null,	null, null, null,
			null, null, null, nr_seq_lote_carteira_p, null, null, null,
			null, null, null, null, null, null, cd_estabelecimento_w,
			null, 'PF', nm_usuario_w);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_mala_direta_pck.gerar_emissao_carteira (nr_seq_lote_carteira_p pls_lote_carteira.nr_sequencia%type, ie_benef_titular_p text, ie_benef_dependente_p text, ie_estipulante_pj_p text, ie_estipulante_pf_p text, ie_subestipulante_p text, ie_pagador_pj_p text, ie_pagador_pf_p text, ie_contato_contrato_p text) FROM PUBLIC;
