-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_mens_criticas_pck.critica_reajuste_faixa_etaria ( nr_seq_mensalidade_seg_p pls_mensalidade_segurado.nr_sequencia%type, ie_mes_cobranca_reaj_p text, dt_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, qt_idade_inicial_p pls_plano_preco.qt_idade_inicial%type, dt_nascimento_p pessoa_fisica.dt_nascimento%type, qt_idade_p pls_mensalidade_segurado.qt_idade%type) AS $body$
DECLARE


qt_idade_inicial_w		pls_plano_preco.qt_idade_inicial%type;
ds_mes_reajuste_w		varchar(2);
ds_mes_aniversario_w		varchar(2);
			

BEGIN

if (ie_mes_cobranca_reaj_p = 'P') then
	ds_mes_aniversario_w	:= to_char(add_months(dt_nascimento_p, 1), 'mm');
else
	ds_mes_aniversario_w	:= to_char(dt_nascimento_p, 'mm');	
end if;
	
ds_mes_reajuste_w	:= to_char(dt_referencia_p, 'mm');

if	((qt_idade_inicial_p <> qt_idade_p) or (ds_mes_aniversario_w <> ds_mes_reajuste_w)) then
	CALL pls_mens_criticas_pck.add_critica(nr_seq_mensalidade_seg_p, 5);
end if;	

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_mens_criticas_pck.critica_reajuste_faixa_etaria ( nr_seq_mensalidade_seg_p pls_mensalidade_segurado.nr_sequencia%type, ie_mes_cobranca_reaj_p text, dt_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, qt_idade_inicial_p pls_plano_preco.qt_idade_inicial%type, dt_nascimento_p pessoa_fisica.dt_nascimento%type, qt_idade_p pls_mensalidade_segurado.qt_idade%type) FROM PUBLIC;
