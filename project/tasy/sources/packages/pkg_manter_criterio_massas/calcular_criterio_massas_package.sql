-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pkg_manter_criterio_massas.calcular_criterio_massas ( nr_seq_exame_p bigint, qt_result_p bigint, ds_result_p text, nr_seq_prescr_p bigint, nr_seq_resultado_p bigint, nr_seq_patologia_p bigint, nr_seq_grupo_pat_p bigint ) RETURNS LAB_LOTE_CRIT_MASSA%ROWTYPE AS $body$
DECLARE

		qt_dias_w                        double precision := 0;
		qt_horas_w                       bigint := 0;
		ie_tipo_valor_w                  bigint := 0;
		ie_valor_percent_w               varchar(10);
		ie_sexo_w                        varchar(1);
		qt_percent_min_w                 bigint;
		qt_percent_max_w                 bigint;
		ds_msg_criterio_w                varchar(4000);
		ds_acao_criterio_w               varchar(4000);
		cd_pessoa_fisica_w               varchar(10);
		nr_prescricao_w                  bigint;
		qt_dias_prev_w                   varchar(255);
		dt_coleta_w                      timestamp;
		dt_transf_w                      timestamp;
		qt_dias_coleta_w                 bigint := 0;
		qt_horas_coleta_w                bigint := 0;
		qt_dias_transf_w                 bigint := 0;
		qt_horas_transf_w                bigint := 0;
		ie_tipo_busca_w                  varchar(1);
		ie_acao_criterio_w               varchar(1);
		ds_resultado_sugerido_w          varchar(255);
		ds_material_criterio_w           varchar(255);
		ds_metodo_criterio_w             varchar(255);
		ds_query_w                       varchar(32000);
		ds_quebra_linha_w                varchar(10);
		-- variaveis da lote_ent_sec_ficha
		lote_qt_idade_gest_w             bigint;
		lote_ie_amamentado_w             varchar(1);
		lote_ie_prematuro_w              varchar(1);
		lote_ie_transfundido_w           varchar(1);
		lote_qt_peso_w                   double precision;
		lote_nr_seq_classif_w            bigint;
		lote_nr_seq_grau_w               bigint;
		lote_ie_mae_veg_w                varchar(1);
		lote_ie_ictericia_w              varchar(1);
		lote_ie_npp_w                    varchar(1);
		lote_ie_cor_pf_w                 varchar(10);
		lote_ie_gemelar_w                varchar(1);
		lote_qt_media_w                  varchar(10);
		lote_qt_gest_w                   smallint;
		lote_dt_ult_menst_w              timestamp;
		lote_ie_tipo_parto_w             varchar(1);
		lote_ie_alim_leite_w             varchar(1);
		ie_classif_lote_ent_w            smallint;
		lote_cd_convenio_w               integer;
		lote_pessoa_fisica_w             varchar(10);
		lote_medic_uso_w                 bigint;
		lote_cd_municipio_w              varchar(6);
		lote_ie_tipo_coleta_w            varchar(1);
		lote_ie_data_coleta_w            timestamp;
		lote_ie_hora_coleta_w            timestamp;
		lote_ie_data_nascimento_w        timestamp;
		lote_ie_hora_nascimento_w        timestamp;
		ie_corticoide_f_w                varchar(1);
		nr_atendimento_w                 bigint;
		ie_result_numeric_w              varchar(1);
		c01_w                            integer;
		qtd_rows                         integer;
        crit                             lab_lote_crit_massa%rowtype;

		
BEGIN

		ds_quebra_linha_w := chr(13);

		select	max(nr_prescricao)
		into STRICT	nr_prescricao_w
		from	exame_lab_resultado
		where	nr_seq_resultado = nr_seq_resultado_p;

		select 	cd_pessoa_fisica
		into STRICT	cd_pessoa_fisica_w
		from	prescr_medica
		where	nr_prescricao = nr_prescricao_w;

		select 	obter_dias_entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),clock_timestamp()),
			round(Obter_Hora_Entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),clock_timestamp()))
		into STRICT 	qt_dias_w,
			qt_horas_w
		;

		select 	max(IE_FORMATO_RESULTADO)
		into STRICT	ie_valor_percent_w
		from	exame_laboratorio
		where	nr_seq_exame = nr_seq_exame_p;

		select 	max(Obter_Sexo_Prescricao(nr_prescricao_w))
		into STRICT	ie_sexo_w
		;

		select	TO_DATE(TO_CHAR(max(coalesce(b.DT_COLETA_FICHA_F,clock_timestamp())),'dd/mm/yyyy')||' '||TO_CHAR(max(coalesce(b.HR_COLETA_F,clock_timestamp())),'hh24:mi:ss'),'dd/mm/yyyy hh24:mi:ss'),
				max(coalesce(b.DT_TRANSF_F,clock_timestamp()))
		into STRICT	dt_coleta_w,
				dt_transf_w
		from	prescr_procedimento a,
				lote_ent_sec_ficha b
		where	a.nr_prescricao = b.nr_prescricao
		and		a.nr_prescricao = nr_prescricao_w;

		if (dt_coleta_w IS NOT NULL AND dt_coleta_w::text <> '') then

			select 	obter_dias_entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w), dt_coleta_w),
					round(Obter_Hora_Entre_datas(obter_data_nascto_pf(cd_pessoa_fisica_w),dt_coleta_w))
			into STRICT 	qt_dias_coleta_w,
					qt_horas_coleta_w
			;

		end if;

		if (dt_transf_w IS NOT NULL AND dt_transf_w::text <> '') then

			select 	obter_dias_entre_datas(dt_transf_w,dt_coleta_w),
					round(Obter_Hora_Entre_datas(dt_transf_w,dt_coleta_w))
			into STRICT 	qt_dias_transf_w,
					qt_horas_transf_w
			;

		end if;

		select	max(nr_atendimento)
		into STRICT	nr_atendimento_w
		from	prescr_medica
		where	nr_prescricao = nr_prescricao_w;

		select	max(ie_classif_lote_ent)
		into STRICT	ie_classif_lote_ent_w
		from	atendimento_paciente
		where	nr_atendimento = nr_atendimento_w;

		select	max(qt_peso_f),
				max(nr_idade_gest_f),
				max(ie_premat_s_f),
				max(IE_AMAMENTADO_F),
				max(ie_transfusao_f),
				max(nr_seq_grau_parentesco),
				max(substr(obter_classif_atendimento(nr_atendimento_w),1,10)),
				max(IE_MAE_VEG_F),
				max(IE_ICTERICIA_F),
				max(IE_NPP_F),
				max(IE_COR_PF_F),
				max(IE_GEMELAR_F),
				max(substr(lote_ent_obter_result_ant(nr_prescricao_w, nr_seq_prescr_p, nr_seq_resultado_p, nr_seq_exame_p, 99),1,255)),
				max(QT_GEST_F),
				max(DT_ULT_MENST),
				max(IE_TIPO_PARTO),
				max(IE_ALIM_LEITE_F),
				max(cd_pessoa_fisica),
				max(ie_corticoide_f),
				max(DT_COLETA_FICHA_F),
				max(HR_COLETA_F),
				max(DT_NASCIMENTO_F),
				max(HR_NASCIMENTO_F)
		into STRICT	lote_qt_peso_w,
				lote_qt_idade_gest_w,
				lote_ie_prematuro_w,
				lote_ie_amamentado_w,
				lote_ie_transfundido_w,
				lote_nr_seq_grau_w,
				lote_nr_seq_classif_w,
				lote_ie_mae_veg_w,
				lote_ie_ictericia_w,
				lote_ie_npp_w,
				lote_ie_cor_pf_w,
				lote_ie_gemelar_w,
				lote_qt_media_w,
				lote_qt_gest_w,
				lote_dt_ult_menst_w,
				lote_ie_tipo_parto_w,
				lote_ie_alim_leite_w,
				lote_pessoa_fisica_w,
				ie_corticoide_f_w,
				lote_ie_data_coleta_w,
				lote_ie_hora_coleta_w,
				lote_ie_data_nascimento_w,
				lote_ie_hora_nascimento_w
		from	lote_ent_sec_ficha
		where	nr_prescricao = nr_prescricao_w;

		ds_query_w :=
				'select	a.qt_percent_min,' || ds_quebra_linha_w ||
				'		a.qt_percent_max,' || ds_quebra_linha_w ||
				'		a.ds_mensagem,' || ds_quebra_linha_w ||
				'		a.ds_acao_criterio,' || ds_quebra_linha_w ||
				'		a.qt_dias_prev,' || ds_quebra_linha_w ||
				'		a.ie_tipo_busca,' || ds_quebra_linha_w ||
				'		a.ie_acao_criterio,' || ds_quebra_linha_w ||
				'		a.ds_result_sugerido,' || ds_quebra_linha_w ||
				'		a.ds_material_exame,' || ds_quebra_linha_w ||
				'		a.ds_metodo,' || ds_quebra_linha_w ||
				'		a.ie_tipo_valor' || ds_quebra_linha_w ||
				'from (' || ds_quebra_linha_w ||
				'select	a.qt_percent_min,' || ds_quebra_linha_w ||
				'		a.qt_percent_max,' || ds_quebra_linha_w ||
				'		d.ds_mensagem,' || ds_quebra_linha_w ||
				'		decode(d.ie_acao_criterio, ''T'', Obter_Desc_Expressao(349095), ''R'', Obter_Desc_Expressao(349096), ''N'', Obter_Desc_Expressao(349097), ''D'', Obter_Desc_Expressao(349098), '''') ds_acao_criterio,' || ds_quebra_linha_w ||
				'		d.qt_dias_prev,' || ds_quebra_linha_w ||
				'		nvl(d.ie_gerar_busca_ativa,''A'') ie_tipo_busca,' || ds_quebra_linha_w ||
				'		d.ie_acao_criterio,' || ds_quebra_linha_w ||
				'		d.ds_result_sugerido,' || ds_quebra_linha_w ||
				'		substr(Obter_Material_Exame_Lab(d.nr_seq_material,null,3),1,255) ds_material_exame,' || ds_quebra_linha_w ||
				'		substr(Obter_Metodo_Exame_Lab(d.nr_seq_metodo,2),1,255) ds_metodo,' || ds_quebra_linha_w ||
				'		a.ie_tipo_valor' || ds_quebra_linha_w ||
				'from 	LOTE_ENT_PATOL_EXAM_REF a,' || ds_quebra_linha_w ||
				'		lab_patologia_exame b,' || ds_quebra_linha_w ||
				'		lab_patologia c,' || ds_quebra_linha_w ||
				'		LOTE_ENT_PATOL_EXAM_CRIT d' || ds_quebra_linha_w ||
				'where 	a.nr_seq_exame = b.nr_seq_exame' || ds_quebra_linha_w ||
				'and	a.nr_Seq_patologia = :nr_seq_patologia_p' || ds_quebra_linha_w ||
				'and	b.nr_seq_patologia = :nr_seq_patologia_p' || ds_quebra_linha_w ||
				'and	c.nr_seq_grupo_pat = :nr_seq_grupo_pat_p' || ds_quebra_linha_w ||
				'and	d.nr_seq_pat_exam_ref = a.nr_sequencia' || ds_quebra_linha_w ||
				'and	((a.ie_sexo = nvl(:ie_sexo_w,''0'')) or (a.ie_sexo = ''0''))' || ds_quebra_linha_w ||
				'and 	a.nr_seq_exame = :nr_seq_exame_p' || ds_quebra_linha_w ||
				'and 	(((nvl(a.ie_tipo_data,''N'') = ''N'') and (((nvl(trunc((:qt_dias_w / 365.25),2),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''A'')) or' || ds_quebra_linha_w ||
				'		(((nvl((:qt_dias_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = ''M'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_dias_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''D'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_horas_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''H''))))' || ds_quebra_linha_w ||
				'	or	((nvl(a.ie_tipo_data,''N'') = ''C'') and (((nvl((:qt_dias_coleta_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''A'')) or' || ds_quebra_linha_w ||
				'		(((nvl((:qt_dias_coleta_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = ''M'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_dias_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''D'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_horas_coleta_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''H''))))' || ds_quebra_linha_w ||
				'	or	((nvl(a.ie_tipo_data,''N'') = ''T'') and (((nvl((:qt_dias_transf_w / 365.25),0) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''A'')) or' || ds_quebra_linha_w ||
				'		(((nvl((:qt_dias_transf_w / 365.25),0) * 12) between a.qt_idade_min and qt_idade_max) and (a.ie_periodo = ''M'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_dias_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''D'')) or' || ds_quebra_linha_w ||
				'		(((nvl(:qt_horas_transf_w,0)) between a.qt_idade_min and a.qt_idade_max) and (a.ie_periodo = ''H'')))))' || ds_quebra_linha_w;
				if (ie_valor_percent_w = 'P') then
					ds_query_w := ds_query_w || 'and 	:qt_result_p between a.qt_percent_min and a.qt_percent_max' || ds_quebra_linha_w;
					ie_result_numeric_w := 'S';
				elsif (ie_valor_percent_w = 'V') then
					ds_query_w := ds_query_w || 'and 	:qt_result_p between a.qt_minima and a.qt_maxima' || ds_quebra_linha_w;
					ie_result_numeric_w := 'S';
				elsif (ie_valor_percent_w = 'D') then
					ds_query_w := ds_query_w || 'and 	upper(ELIMINA_ACENTOS(:ds_result_p)) like upper(ELIMINA_ACENTOS(a.DS_OBSERVACAO))' || ds_quebra_linha_w;
					ie_result_numeric_w := 'N';
				elsif (ie_valor_percent_w = 'DV') then
					if (coalesce(ds_result_p,'0') <> '0') then
						ds_query_w := ds_query_w || 'and 	upper(ELIMINA_ACENTOS(:ds_result_p)) like upper(ELIMINA_ACENTOS(a.DS_OBSERVACAO))' || ds_quebra_linha_w;
						ie_result_numeric_w := 'N';
					else
						ds_query_w := ds_query_w || 'and 	:qt_result_p between a.qt_minima and a.qt_maxima' || ds_quebra_linha_w;
						ie_result_numeric_w := 'S';
					end if;
				else
					ds_query_w := ds_query_w || 'and 	upper(ELIMINA_ACENTOS(:ds_result_p)) like upper(ELIMINA_ACENTOS(a.DS_OBSERVACAO))' || ds_quebra_linha_w;
					ie_result_numeric_w := 'N';
				end if;
				ds_query_w := ds_query_w ||
				'and	((:lote_qt_peso_w between d.qt_peso_inic and d.qt_peso_fim) or (nvl(:lote_qt_peso_w,''0'') = ''0''))' || ds_quebra_linha_w ||
				'and	((:lote_qt_idade_gest_w between d.QT_IDADE_GESTACIONAL and d.QT_IDADE_GEST_FIM) or (nvl(:lote_qt_idade_gest_w,0) = 0))' || ds_quebra_linha_w ||
				'and	((:lote_ie_prematuro_w = nvl(d.ie_prematuro,:lote_ie_prematuro_w)) or (nvl(:lote_ie_prematuro_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and	((:lote_ie_amamentado_w = nvl(d.ie_amamentado,:lote_ie_amamentado_w)) or (nvl(:lote_ie_amamentado_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and	((:lote_ie_transfundido_w = nvl(d.ie_transfundido,:lote_ie_transfundido_w)) or (nvl(:lote_ie_transfundido_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and	((:lote_nr_seq_grau_w = nvl(d.nr_seq_grau_parentesco,:lote_nr_seq_grau_w)) or (nvl(:lote_nr_seq_grau_w,0) = 0))' || ds_quebra_linha_w ||
				'and	((:lote_nr_seq_classif_w = nvl(d.nr_seq_classificacao,:lote_nr_seq_classif_w)) or (nvl(:lote_nr_seq_classif_w,0) = 0))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_mae_veg_w = nvl(d.IE_MAE_VEG,:lote_ie_mae_veg_w)) or (nvl(:lote_ie_mae_veg_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_ictericia_w = nvl(d.IE_ICTERICIA,:lote_ie_ictericia_w)) or (nvl(:lote_ie_ictericia_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_npp_w = nvl(d.IE_NPP,:lote_ie_npp_w)) or (nvl(:lote_ie_npp_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_cor_pf_w = nvl(d.IE_COR_PF,:lote_ie_cor_pf_w)) or (nvl(:lote_ie_cor_pf_w,''N'') = ''N''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_gemelar_w = nvl(d.IE_GEMELAR,:lote_ie_gemelar_w)) or (nvl(:lote_ie_gemelar_w,''N'') = ''N''))' || ds_quebra_linha_w ||
				'and	(((d.QT_MINIMA is not null and d.QT_MAXIMA is not null and :lote_qt_media_w is not null) and (:lote_qt_media_w  between d.QT_MINIMA and d.QT_MAXIMA)) or	(1=1))' || ds_quebra_linha_w ||
				'and	((:lote_qt_gest_w between d.QT_GEST_INI and d.QT_GEST_FIM) or (nvl(:lote_qt_gest_w,''0'') = ''0''))' || ds_quebra_linha_w ||
				'and	((:lote_dt_ult_menst_w is null) or (:lote_dt_ult_menst_w between d.DT_ULT_MENST_INI and d.DT_ULT_MENST_FIM))' || ds_quebra_linha_w ||
				'and	((:lote_ie_tipo_parto_w = nvl(d.IE_TIPO_PARTO,:lote_ie_tipo_parto_w)) or (nvl(:lote_ie_tipo_parto_w,''N'') = ''N''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_alim_leite_w = nvl(d.IE_ALIM_LEITE,:lote_ie_alim_leite_w)) or (nvl(:lote_ie_alim_leite_w,''I'') = ''I''))' || ds_quebra_linha_w ||
				'and	((:ie_classif_lote_ent_w = d.IE_CLASSIF_LOTE_ENT) or (nvl(:ie_classif_lote_ent_w,0) = 0))' || ds_quebra_linha_w ||
				'and	((:lote_cd_convenio_w = nvl(d.CD_CONVENIO,:lote_cd_convenio_w)) or (nvl(:lote_cd_convenio_w,0) = 0))' || ds_quebra_linha_w ||
				'and	((:lote_medic_uso_w = nvl(d.CD_MATERIAL_MED,:lote_medic_uso_w)) or (nvl(:lote_medic_uso_w,0) = 0))' || ds_quebra_linha_w ||
				'and 	((:lote_cd_municipio_w = nvl(d.CD_MUNICIPIO_IBGE,:lote_cd_municipio_w)) or (nvl(:lote_cd_municipio_w,''0'') = ''0''))' || ds_quebra_linha_w ||
				'and 	((:lote_ie_tipo_coleta_w = nvl(d.IE_TIPO_COLETA,:lote_ie_tipo_coleta_w)) or (nvl(:lote_ie_tipo_coleta_w,''N'') = ''N''))' || ds_quebra_linha_w ||
				'AND	((:ie_corticoide_f_w = nvl(ie_corticoide,:ie_corticoide_f_w)) OR (NVL(:ie_corticoide_f_w,''0'') = ''0''))' || ds_quebra_linha_w ||
				'and 	(((:lote_ie_data_coleta_w is null) and (nvl(ie_data_coleta, ''N'') = ''I'')) or (nvl(ie_data_coleta, ''N'') = ''N''))' || ds_quebra_linha_w ||
				'and 	(((:lote_ie_hora_coleta_w is null) and (nvl(ie_hora_coleta, ''N'') = ''I'')) or (nvl(ie_hora_coleta, ''N'') = ''N''))' || ds_quebra_linha_w ||
				'and 	(((:lote_ie_data_nascimento_w is null) and (nvl(ie_data_nascimento, ''N'') = ''I'')) or (nvl(ie_data_nascimento, ''N'') = ''N''))' || ds_quebra_linha_w ||
				'and 	(((:lote_ie_hora_nascimento_w is null) and (nvl(ie_hora_nascimento, ''N'') = ''I'')) or (nvl(ie_hora_nascimento, ''N'') = ''N''))' || ds_quebra_linha_w ||
				'order by a.NR_SEQ_PRIORIDADE, a.nr_seq_material, a.ie_sexo, a.ie_tipo_valor) a' || ds_quebra_linha_w ||
				'where rownum <= 1';

		c01_w := DBMS_SQL.OPEN_CURSOR;
		DBMS_SQL.PARSE(c01_w, ds_query_w, DBMS_SQL.NATIVE);

		DBMS_SQL.DEFINE_COLUMN(c01_w, 1, qt_percent_min_w);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 2, qt_percent_max_w);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 3, ds_msg_criterio_w, 4000);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 4, ds_acao_criterio_w, 4000);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 5, qt_dias_prev_w, 255);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 6, ie_tipo_busca_w, 1);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 7, ie_acao_criterio_w, 1);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 8, ds_resultado_sugerido_w, 255);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 9, ds_material_criterio_w, 255);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 10, ds_metodo_criterio_w, 255);
		DBMS_SQL.DEFINE_COLUMN(c01_w, 11, ie_tipo_valor_w);

		if (coalesce(ie_result_numeric_w, 'N') = 'S') then
			DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_result_p', qt_result_p);
		else
			DBMS_SQL.BIND_VARIABLE(c01_w, 'ds_result_p', ds_result_p);
		end if;
		DBMS_SQL.BIND_VARIABLE(c01_w, 'nr_seq_patologia_p', nr_seq_patologia_p);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'nr_seq_grupo_pat_p', nr_seq_grupo_pat_p);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'ie_sexo_w', ie_sexo_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'nr_seq_exame_p', nr_seq_exame_p);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_dias_w', qt_dias_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_horas_w', qt_horas_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_dias_coleta_w', qt_dias_coleta_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_horas_coleta_w', qt_horas_coleta_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_dias_transf_w', qt_dias_transf_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'qt_horas_transf_w', qt_horas_transf_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_qt_peso_w', lote_qt_peso_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_qt_idade_gest_w', lote_qt_idade_gest_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_prematuro_w', lote_ie_prematuro_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_amamentado_w', lote_ie_amamentado_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_transfundido_w', lote_ie_transfundido_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_nr_seq_grau_w', lote_nr_seq_grau_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_nr_seq_classif_w', lote_nr_seq_classif_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_mae_veg_w', lote_ie_mae_veg_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_ictericia_w', lote_ie_ictericia_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_npp_w', lote_ie_npp_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_cor_pf_w', lote_ie_cor_pf_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_gemelar_w', lote_ie_gemelar_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_qt_media_w', lote_qt_media_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_qt_gest_w', lote_qt_gest_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_dt_ult_menst_w', lote_dt_ult_menst_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_tipo_parto_w', lote_ie_tipo_parto_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_alim_leite_w', lote_ie_alim_leite_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'ie_classif_lote_ent_w', ie_classif_lote_ent_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_cd_convenio_w', lote_cd_convenio_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_medic_uso_w', lote_medic_uso_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_cd_municipio_w', lote_cd_municipio_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_tipo_coleta_w', lote_ie_tipo_coleta_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'ie_corticoide_f_w', ie_corticoide_f_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_data_coleta_w', lote_ie_data_coleta_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_hora_coleta_w', lote_ie_hora_coleta_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_data_nascimento_w', lote_ie_data_nascimento_w);
		DBMS_SQL.BIND_VARIABLE(c01_w, 'lote_ie_hora_nascimento_w', lote_ie_hora_nascimento_w);
		begin
			qtd_rows := DBMS_SQL.EXECUTE_AND_FETCH(c01_w);

			DBMS_SQL.COLUMN_VALUE(c01_w, 1, qt_percent_min_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 2, qt_percent_max_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 3, ds_msg_criterio_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 4, ds_acao_criterio_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 5, qt_dias_prev_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 6, ie_tipo_busca_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 7, ie_acao_criterio_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 8, ds_resultado_sugerido_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 9, ds_material_criterio_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 10, ds_metodo_criterio_w);
			DBMS_SQL.COLUMN_VALUE(c01_w, 11, ie_tipo_valor_w);

			DBMS_SQL.CLOSE_CURSOR(c01_w);

            select nextval('lab_lote_crit_massa_seq') into STRICT crit.nr_sequencia;
            crit.qt_percent_min := qt_percent_min_w;
            crit.qt_percent_max := qt_percent_max_w;
            crit.ds_msg_criterio := ds_msg_criterio_w;
            crit.ds_acao_criterio := ds_acao_criterio_w;
            crit.qt_dias_prev := qt_dias_prev_w;
            crit.ie_tipo_busca := ie_tipo_busca_w;
            crit.ie_acao_criterio := ie_acao_criterio_w;
            crit.ds_resultado_sugerido := ds_resultado_sugerido_w;
            crit.ds_material_criterio := ds_material_criterio_w;
            crit.ds_metodo_criterio := ds_metodo_criterio_w;
            crit.ie_tipo_valor := ie_tipo_valor_w;
            crit.nr_seq_prescr := nr_prescricao_w;
            crit.nr_seq_exame := nr_seq_exame_p;

		exception
			when others then
				ie_tipo_valor_w := 0;
		end;

        return crit;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pkg_manter_criterio_massas.calcular_criterio_massas ( nr_seq_exame_p bigint, qt_result_p bigint, ds_result_p text, nr_seq_prescr_p bigint, nr_seq_resultado_p bigint, nr_seq_patologia_p bigint, nr_seq_grupo_pat_p bigint ) FROM PUBLIC;
