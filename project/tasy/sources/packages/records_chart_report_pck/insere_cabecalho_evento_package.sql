-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE records_chart_report_pck.insere_cabecalho_evento ( nr_sequencia_p bigint, ds_sufixo_p text) AS $body$
DECLARE

	ds_descricao_w		w_chart_pepo_report.ds_descricao%type;

	ds_Paciente_w		varchar(200) := substr(wheb_mensagem_pck.get_texto(1028069),1,200);/*'Paciente'*/

	ds_Anestesia_w		varchar(200) := substr(wheb_mensagem_pck.get_texto(1028070),1,200);/*'Anestesia'*/

	ds_Procedimento_w	varchar(200) := substr(wheb_mensagem_pck.get_texto(1028071),1,200);/*'Procedimento'*/


BEGIN
		SELECT	substr(coalesce(max(description), ds_Paciente_w),1,255)
		into STRICT	   ds_descricao_w 
		FROM	   TABLE(search_chart(nr_cirurgia_p,nr_seq_pepo_p,'NAV'))
		WHERE (nm_usuario = nm_usuario_p OR coalesce(nm_usuario::text, '') = '')
		and		nm_tabela =	'EVENTO_CIRURGIA_PACIENTE'
		and		nm_atributo = 'DS_PACIENTE';
		
		CALL records_chart_report_pck.insere_registro_descricao(nr_sequencia_p, ds_descricao_w, 'PA' || ds_sufixo_p,nm_usuario_p);
		
		SELECT	substr(coalesce(max(description), ds_Anestesia_w),1,255)
		into STRICT	   ds_descricao_w
		FROM	   TABLE(search_chart(nr_cirurgia_p,nr_seq_pepo_p,'NAV'))
		WHERE (nm_usuario = nm_usuario_p OR coalesce(nm_usuario::text, '') = '')
		and		nm_tabela =	'EVENTO_CIRURGIA_PACIENTE'
		and		nm_atributo = 'DS_ANESTESIA';
		
		CALL records_chart_report_pck.insere_registro_descricao(nr_sequencia_p, ds_descricao_w, 'AN' || ds_sufixo_p,nm_usuario_p);
		
		SELECT	substr(coalesce(max(description), ds_Procedimento_w),1,255)
		into STRICT	   ds_descricao_w
		FROM	   TABLE(search_chart(nr_cirurgia_p,nr_seq_pepo_p,'NAV'))
		WHERE (nm_usuario = nm_usuario_p OR coalesce(nm_usuario::text, '') = '')
		and		nm_tabela =	'EVENTO_CIRURGIA_PACIENTE'
		and		nm_atributo = 'DS_PROCEDIMENTO';
		
		CALL records_chart_report_pck.insere_registro_descricao(nr_sequencia_p, ds_descricao_w, 'PR' || ds_sufixo_p,nm_usuario_p);
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE records_chart_report_pck.insere_cabecalho_evento ( nr_sequencia_p bigint, ds_sufixo_p text) FROM PUBLIC;
