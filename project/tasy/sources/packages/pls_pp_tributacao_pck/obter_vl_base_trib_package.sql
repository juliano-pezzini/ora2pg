-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Function retorna o valor de base usado no tributo para rateio dos itens do pagamento



CREATE OR REPLACE FUNCTION pls_pp_tributacao_pck.obter_vl_base_trib ( ie_tipo_tributo_p pls_pp_valor_trib_pessoa.ie_tipo_tributo%type, vl_base_calculo_p pls_pp_valor_trib_pessoa.vl_base_calculo%type, vl_base_acumulada_p pls_pp_valor_trib_pessoa.vl_base_acumulada%type) RETURNS bigint AS $body$
DECLARE

					
vl_base_calculo_w		pls_pp_valor_trib_pessoa.vl_base_calculo%type := vl_base_calculo_p;
					

BEGIN
-- Quando possui IR estava dobrando o valor, e com isso tivemos que descontar a base de calculo com a base acumulada.

if (ie_tipo_tributo_p = 'IR') and (vl_base_calculo_p >= 0) then
	vl_base_calculo_w := vl_base_calculo_p - vl_base_acumulada_p;
end if;

return vl_base_calculo_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_pp_tributacao_pck.obter_vl_base_trib ( ie_tipo_tributo_p pls_pp_valor_trib_pessoa.ie_tipo_tributo%type, vl_base_calculo_p pls_pp_valor_trib_pessoa.vl_base_calculo%type, vl_base_acumulada_p pls_pp_valor_trib_pessoa.vl_base_acumulada%type) FROM PUBLIC;
