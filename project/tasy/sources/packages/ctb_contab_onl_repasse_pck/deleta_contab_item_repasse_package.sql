-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ctb_contab_onl_repasse_pck.deleta_contab_item_repasse ( nr_sequencia_p repasse_terceiro_item.nr_sequencia%type, nm_usuario_p text, ie_commit_p text default 'N') AS $body$
DECLARE


ctb_documento_w     ctb_documento%rowtype;
ie_situacao_mes_w   varchar(01);
cd_empresa_w        empresa.cd_empresa%type;


BEGIN
begin
select *
into STRICT   ctb_documento_w
from   ctb_documento a
where  a.cd_tipo_lote_contabil = 14
and    a.nm_tabela = 'REPASSE_TERCEIRO_ITEM'
and    a.nr_documento = nr_sequencia_p;
exception
    when no_data_found then
        ctb_documento_w := null;
end;

if (ctb_documento_w.nr_sequencia IS NOT NULL AND ctb_documento_w.nr_sequencia::text <> '') then
    cd_empresa_w := obter_empresa_estab(ctb_documento_w.cd_estabelecimento);
    ie_situacao_mes_w := ctb_obter_situacao_mes(cd_empresa_p         => cd_empresa_w,
                                                dt_referencia_p      => ctb_documento_w.dt_competencia,
                                                cd_estabelecimento_p => ctb_documento_w.cd_estabelecimento);

    if (ie_situacao_mes_w = 'A') then
        CALL ctb_online_pck.ctb_excluir_lancamento_doc(nr_seq_ctb_documento_p => ctb_documento_w.nr_sequencia,
                                                  nm_usuario_p           => nm_usuario_p,
                                                  ie_commit_p            => ie_commit_p);
    else
        CALL wheb_mensagem_pck.exibir_mensagem_abort(207399); -- O mes esta fechado
    end if;
end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_contab_onl_repasse_pck.deleta_contab_item_repasse ( nr_sequencia_p repasse_terceiro_item.nr_sequencia%type, nm_usuario_p text, ie_commit_p text default 'N') FROM PUBLIC;
