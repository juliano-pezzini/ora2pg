-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_rec_glosa_emp_pck.excluir_dmp_demonstrativo ( nr_sequencia_p pls_dmp_demons_pagto.nr_sequencia%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Realizar a exclusao do demonstrativo pagto.

-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

	
Alteracoes:
-------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


BEGIN

-- Apaga os dados do pagamento

delete	from pls_dmp_dad_prt_guia_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c,
				pls_dmp_dados_pagto_imp		d,
				pls_dmp_dados_resumo_imp	e
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	d.nr_seq_dmp_prestador		= c.nr_sequencia
			and	e.nr_seq_dmp_dados_pagto	= d.nr_sequencia
			and	x.nr_seq_dmp_dados_res		= e.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_dados_resumo_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c,
				pls_dmp_dados_pagto_imp		d
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	d.nr_seq_dmp_prestador		= c.nr_sequencia
			and	x.nr_seq_dmp_dados_pagto	= d.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_deb_cred_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c,
				pls_dmp_dados_pagto_imp		d
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	d.nr_seq_dmp_prestador		= c.nr_sequencia
			and	x.nr_seq_dmp_dados_pagto	= d.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_total_bruto_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c,
				pls_dmp_dados_pagto_imp		d
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	d.nr_seq_dmp_prestador		= c.nr_sequencia
			and	x.nr_seq_dmp_dados_pagto	= d.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_total_liquido_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c,
				pls_dmp_dados_pagto_imp		d
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	d.nr_seq_dmp_prestador		= c.nr_sequencia
			and	x.nr_seq_dmp_dados_pagto	= d.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_dados_pagto_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	c.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	x.nr_seq_dmp_prestador		= c.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
-- Apaga os dados do cabecalho

delete	from pls_dmp_deb_cre_dem_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	x.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_tot_bruto_dem_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	x.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);

delete	from pls_dmp_tot_liq_dem_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b,
				pls_dmp_prestador_imp		c
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	x.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
delete	from pls_dmp_prestador_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a,
				pls_dmp_cabecalho_imp		b
			where	b.nr_seq_dmp_pagto		= a.nr_sequencia
			and	x.nr_seq_dmp_cabecalho		= b.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
-- Apaga os dados do cabecalho

delete	from pls_dmp_cabecalho_imp	x
where	exists (	SELECT	1
			from	pls_dmp_demons_pagto		a
			where	x.nr_seq_dmp_pagto		= a.nr_sequencia
			and	a.nr_sequencia			= nr_sequencia_p);
			
-- Apaga os dados do Demonstrativo

delete	from pls_dmp_demons_pagto
where	nr_sequencia	= nr_sequencia_p;
			

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_rec_glosa_emp_pck.excluir_dmp_demonstrativo ( nr_sequencia_p pls_dmp_demons_pagto.nr_sequencia%type) FROM PUBLIC;
