-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pkg_date_utils.get_diffdate (startDate timestamp, endDate timestamp, field text, CALENDAR CALENDAR DEFAULT ESTABLISHMENT) RETURNS bigint AS $body$
BEGIN
	CASE field
		WHEN 'YEAR' THEN
		
		  RETURN MONTHS_BETWEEN(TRUNC(endDate), TRUNC(startDate)) /12;
		WHEN 'MONTH%' THEN
		  RETURN MOD( TRUNC( MONTHS_BETWEEN( TRUNC(endDate), TRUNC(startDate)  )), 12 );
		WHEN 'MONTH' THEN
		  RETURN TRUNC( MONTHS_BETWEEN( TRUNC(endDate), TRUNC(startDate)  ));
		WHEN 'DAY%' THEN				
		  RETURN TRUNC(endDate) - ADD_MONTHS(TRUNC(startDate),TRUNC( MONTHS_BETWEEN( TRUNC(endDate), TRUNC(startDate) ) ));
		WHEN 'DAY' THEN				
		  RETURN TRUNC(endDate) - TRUNC(startDate);
		WHEN 'HOUR%' THEN
			RETURN ((TO_CHAR(endDate, 'hh24'))::numeric  + ((TO_CHAR(endDate, 'mi'))::numeric /60))
				 - ((TO_CHAR(startDate, 'hh24') +(TO_CHAR(startDate, 'mi')/60)::numeric )::numeric );
		WHEN 'HOUR' THEN
			RETURN  ((TRUNC(endDate, 'hh') - TRUNC(startDate, 'hh')) * 24);
		WHEN 'MINUTE%' THEN
			RETURN MOD( pkg_date_utils.get_DiffDate(startDate, endDate, 'HOUR%') * 60, 60 );
		WHEN 'MINUTE' THEN
			RETURN  ((TRUNC(endDate, 'mi') - TRUNC(startDate, 'mi')) * (24*60));
    END CASE;
    RETURN 0;
  END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pkg_date_utils.get_diffdate (startDate timestamp, endDate timestamp, field text, CALENDAR CALENDAR DEFAULT ESTABLISHMENT) FROM PUBLIC;
