-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_filtro_regra_preco_cta_pck.obter_restricao_participante ( nr_seq_grau_partic_p pls_cp_cta_filtro_partic.nr_seq_grau_partic%type, nr_seq_prestador_p pls_cp_cta_filtro_partic.nr_seq_prestador%type, cd_medico_p pls_cp_cta_filtro_partic.cd_medico%type, ie_cooperado_p pls_cp_cta_filtro_partic.ie_cooperado%type, ds_campos_p out text, valor_bind_p INOUT sql_pck.t_dado_bind) AS $body$
DECLARE

					
ds_restricao_partic_w	varchar(2500);
ds_campos_w		varchar(500);


BEGIN

ds_campos_w := null;

-- Grau participacao

if (nr_seq_grau_partic_p IS NOT NULL AND nr_seq_grau_partic_p::text <> '') then

	ds_restricao_partic_w := ds_restricao_partic_w || '	and ' || pls_filtro_regra_preco_cta_pck.obter_alias_tabela('participante') ||
				'.nr_seq_grau_partic = :nr_seq_grau_partic_pc ' || pls_util_pck.enter_w;
	valor_bind_p := sql_pck.bind_variable(	':nr_seq_grau_partic_pc', nr_seq_grau_partic_p, valor_bind_p);
end if;

-- Prestador participante

if (nr_seq_prestador_p IS NOT NULL AND nr_seq_prestador_p::text <> '') then

	ds_restricao_partic_w := ds_restricao_partic_w || '	and ' || pls_filtro_regra_preco_cta_pck.obter_alias_tabela('participante') ||
				'.nr_seq_prestador = :nr_seq_prestador_pc ' || pls_util_pck.enter_w;
	valor_bind_p := sql_pck.bind_variable(	':nr_seq_prestador_pc', nr_seq_prestador_p, valor_bind_p);
end if;

-- medico participante

if (cd_medico_p IS NOT NULL AND cd_medico_p::text <> '') then

	ds_restricao_partic_w := ds_restricao_partic_w || '	and ' || pls_filtro_regra_preco_cta_pck.obter_alias_tabela('participante') ||
				'.cd_medico = :cd_medico_pc ' || pls_util_pck.enter_w;
	valor_bind_p := sql_pck.bind_variable(	':cd_medico_pc', cd_medico_p, valor_bind_p);
end if;

-- medico cooperado

-- somente verifica caso seja S, seNAO NAO e para verificar. Retorna no select por questaes de performance

if (ie_cooperado_p = 'S') then
		
	ds_campos_w := ds_campos_w || ', ' || pls_util_pck.enter_w ||
			'	pls_obter_se_cooperado_ativo(' || pls_filtro_regra_preco_cta_pck.obter_alias_tabela('participante') || '.cd_medico, nvl(' ||
			pls_filtro_regra_preco_cta_pck.obter_alias_tabela('procedimento') || '.dt_procedimento_referencia, trunc(sysdate, ''dd'')), ''X'') ie_cooperado ';
-- se for nulo retorna S

else
	
	ds_campos_w := ds_campos_w || ', ' || pls_util_pck.enter_w || '	''S'' ie_cooperado ';
end if;

ds_campos_p := ds_campos_w;

return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_filtro_regra_preco_cta_pck.obter_restricao_participante ( nr_seq_grau_partic_p pls_cp_cta_filtro_partic.nr_seq_grau_partic%type, nr_seq_prestador_p pls_cp_cta_filtro_partic.nr_seq_prestador%type, cd_medico_p pls_cp_cta_filtro_partic.cd_medico%type, ie_cooperado_p pls_cp_cta_filtro_partic.ie_cooperado%type, ds_campos_p out text, valor_bind_p INOUT sql_pck.t_dado_bind) FROM PUBLIC;
