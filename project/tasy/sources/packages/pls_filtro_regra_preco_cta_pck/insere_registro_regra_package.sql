-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_filtro_regra_preco_cta_pck.insere_registro_regra ( ie_tipo_filtro_p text, tb_seq_conta_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_proc_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_mat_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_partic_p INOUT pls_util_cta_pck.t_number_table, tb_seq_selecao_p INOUT pls_util_cta_pck.t_number_table, nm_usuario usuario.nm_usuario%type) AS $body$
BEGIN

-- se tem algum registro e se o tipo de regra for diferente de participante do procedimento processa

-- so tem o vinculo de regra para pls_conta_proc e pls_conta_mat (o participante tens as regras na propria tabela)

if (tb_seq_conta_p.count > 0 and ie_tipo_filtro_p != 'PP') then

	if (ie_tipo_filtro_p = 'M') then
		forall i in tb_seq_conta_mat_p.first..tb_seq_conta_mat_p.last
			insert into pls_conta_mat_regra(
						nr_sequencia, dt_atualizacao, nm_usuario
						) values (
						tb_seq_conta_mat_p(i), clock_timestamp(), nm_usuario);
	
	else
		forall i in tb_seq_conta_proc_p.first..tb_seq_conta_proc_p.last
			insert into pls_conta_proc_regra(
						nr_sequencia, dt_atualizacao, nm_usuario
						) values (
						tb_seq_conta_proc_p(i), clock_timestamp(), nm_usuario);
	end if;
	
	commit;
end if;

-- limpa as tabelas

tb_seq_conta_p.delete;
tb_seq_conta_proc_p.delete;
tb_seq_conta_mat_p.delete;
tb_nr_seq_partic_p.delete;
tb_seq_selecao_p.delete;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_filtro_regra_preco_cta_pck.insere_registro_regra ( ie_tipo_filtro_p text, tb_seq_conta_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_proc_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_mat_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_partic_p INOUT pls_util_cta_pck.t_number_table, tb_seq_selecao_p INOUT pls_util_cta_pck.t_number_table, nm_usuario usuario.nm_usuario%type) FROM PUBLIC;
