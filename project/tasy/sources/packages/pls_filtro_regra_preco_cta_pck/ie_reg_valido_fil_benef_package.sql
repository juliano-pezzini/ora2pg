-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_filtro_regra_preco_cta_pck.ie_reg_valido_fil_benef ( ie_cart_valida_p text, cd_convenio_seg_p pessoa_titular_convenio.cd_convenio%type, cd_categoria_seg_p pessoa_titular_convenio.cd_categoria%type, ie_grupo_valido_p text, qt_idade_seg_p bigint, qt_idade_inicial_p pls_cp_cta_filtro_benef.qt_idade_inicial%type, qt_idade_final_p pls_cp_cta_filtro_benef.qt_idade_final%type, cd_convenio_fil_p pls_cp_cta_filtro_benef.cd_convenio%type, cd_categoria_fil_p pls_cp_cta_filtro_benef.cd_categoria%type) RETURNS boolean AS $body$
DECLARE


ie_valido_w	boolean;
					

BEGIN
-- sempre comeca NAO sendo valido

ie_valido_w := true;

-- se retornou qualquer coisa diferente de S NAO e valido

if (ie_cart_valida_p != 'S') then
	ie_valido_w := false;
end if;

-- se retornou qualquer coisa diferente de S NAO e valido

if (ie_grupo_valido_p != 'S') then
	ie_valido_w := false;
end if;

-- se existe convenio informado na regra precisa ser verificado

if (cd_convenio_fil_p IS NOT NULL AND cd_convenio_fil_p::text <> '') then
	
	-- se for diferente NAO e valido

	if (cd_convenio_fil_p != cd_convenio_seg_p) then 
	
		ie_valido_w := false;
	end if;
end if;

-- se existe categoria informado na regra precisa ser verificado

if (cd_categoria_fil_p IS NOT NULL AND cd_categoria_fil_p::text <> '') then

	-- se for diferente NAO e valido

	if (cd_categoria_fil_p != cd_categoria_seg_p) then 
	
		ie_valido_w := false;
	end if;
end if;

-- se foi informado ambas as idades

if (qt_idade_inicial_p IS NOT NULL AND qt_idade_inicial_p::text <> '') and (qt_idade_final_p IS NOT NULL AND qt_idade_final_p::text <> '') then
	
	-- NAO pode ser menor que a inicial

	-- ou maior que a final

	if (qt_idade_seg_p < qt_idade_inicial_p) or (qt_idade_seg_p > qt_idade_final_p) then
		
		ie_valido_w := false;
	end if;
-- se foi so a inicial

elsif (qt_idade_inicial_p IS NOT NULL AND qt_idade_inicial_p::text <> '') then

	-- NAO pode ser menor que a inicial

	if (qt_idade_seg_p < qt_idade_inicial_p) then
	
		ie_valido_w := false;
	end if;
-- se foi so a final

elsif (qt_idade_final_p IS NOT NULL AND qt_idade_final_p::text <> '') then

	-- NAO pode ser maior que a final

	if (qt_idade_seg_p > qt_idade_final_p) then
	
		ie_valido_w := false;
	end if;
end if;

return ie_valido_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_filtro_regra_preco_cta_pck.ie_reg_valido_fil_benef ( ie_cart_valida_p text, cd_convenio_seg_p pessoa_titular_convenio.cd_convenio%type, cd_categoria_seg_p pessoa_titular_convenio.cd_categoria%type, ie_grupo_valido_p text, qt_idade_seg_p bigint, qt_idade_inicial_p pls_cp_cta_filtro_benef.qt_idade_inicial%type, qt_idade_final_p pls_cp_cta_filtro_benef.qt_idade_final%type, cd_convenio_fil_p pls_cp_cta_filtro_benef.cd_convenio%type, cd_categoria_fil_p pls_cp_cta_filtro_benef.cd_categoria%type) FROM PUBLIC;
