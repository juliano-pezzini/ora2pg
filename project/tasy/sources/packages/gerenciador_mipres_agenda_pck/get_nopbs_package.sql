-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION gerenciador_mipres_agenda_pck.get_nopbs ( cd_procedimento_p bigint default null, nr_seq_exame_p bigint default null, ie_origem_proced_p bigint DEFAULT NULL) RETURNS varchar AS $body$
DECLARE

    ie_nopbs_w           varchar(2) := 'N';

BEGIN
    
        if (nr_seq_exame_p IS NOT NULL AND nr_seq_exame_p::text <> '') then
        
        select  coalesce(a.ie_nopbs, 'N')
        into STRICT    ie_nopbs_w
        from    procedimento a,
                exame_laboratorio b
        where   b.nr_seq_exame = nr_seq_exame_p
        and     a.cd_procedimento = b.cd_procedimento
        and     a.ie_origem_proced = ie_origem_proced_p
        and     a.ie_origem_proced = 4;

        elsif (cd_procedimento_p IS NOT NULL AND cd_procedimento_p::text <> '') then 
        
        select  coalesce(a.ie_nopbs, 'N')
        into STRICT    ie_nopbs_w
        from    procedimento a
        where   a.cd_procedimento = cd_procedimento_p
        and     a.ie_origem_proced = ie_origem_proced_p    
        and     a.ie_origem_proced = 4;

        end if;

        
        
        return ie_nopbs_w;
        exception
        when no_data_found then return null;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION gerenciador_mipres_agenda_pck.get_nopbs ( cd_procedimento_p bigint default null, nr_seq_exame_p bigint default null, ie_origem_proced_p bigint DEFAULT NULL) FROM PUBLIC;
