-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_conversao_itens_pck.inserir_proc_conv_item_pos_seq ( tb_seq_proc_p INOUT pls_util_cta_pck.t_number_table, tb_seq_regra_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

	if (tb_seq_proc_p.count > 0) then
		forall i in tb_seq_proc_p.first..tb_seq_proc_p.last
			insert	into pls_conta_proc(nr_sequencia, dt_atualizacao, nm_usuario,dt_atualizacao_nrec, nm_usuario_nrec,
				nr_seq_conta,cd_procedimento, ie_origem_proced, qt_procedimento,qt_procedimento_imp, 
				ie_status, nr_seq_proc_princ,ie_situacao, ie_via_acesso, vl_unitario_imp,
				vl_procedimento_imp, vl_unitario, vl_liberado,vl_medico, vl_anestesista, 
				vl_auxiliares,vl_custo_operacional, vl_materiais, vl_procedimento,vl_glosa, 
				vl_beneficiario, nr_seq_regra_conv,ie_lanc_manual_pos, ie_apenas_pagamento, dt_procedimento,
				dt_inicio_proc,dt_fim_proc,ie_repassa_medico,nr_seq_honorario_crit,ie_criterio_horario,
				nr_seq_regra_cooperado,ie_ato_cooperado)
			(SELECT	nextval('pls_conta_proc_seq'), clock_timestamp(), nm_usuario_p,clock_timestamp(), nm_usuario_p, 
				tb_seq_conta_p(i),cd_procedimento, ie_origem_proced, qt_procedimento,qt_procedimento_imp, 
				'M', tb_seq_proc_p(i),'D', 'U',0,
				0,0,0,0,0,
				0,0,0,0,0,
				0, tb_seq_regra_p(i),'S', 'N', dt_procedimento,
				dt_inicio_proc,dt_fim_proc,ie_repassa_medico,nr_seq_honorario_crit,ie_criterio_horario,
				nr_seq_regra_cooperado,ie_ato_cooperado
			from	pls_conta_proc
			where	nr_sequencia	= tb_seq_proc_p(i));
			
		tb_seq_proc_p := pls_cta_proc_mat_regra_pck.cria_registro_regra_proc_p_t(tb_seq_proc_p, nm_usuario_p);
		-- pega os itens sem o sequencial tiss de cada conta, e gera o mesmo

		tb_seq_conta_p := pls_cta_proc_mat_regra_pck.gera_seq_tiss_conta_proc_t(tb_seq_conta_p, nm_usuario_p);
		
		
	end if;
	tb_seq_proc_p.delete;
	tb_seq_regra_p.delete;
	tb_seq_conta_p.delete;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_conversao_itens_pck.inserir_proc_conv_item_pos_seq ( tb_seq_proc_p INOUT pls_util_cta_pck.t_number_table, tb_seq_regra_p INOUT pls_util_cta_pck.t_number_table, tb_seq_conta_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
