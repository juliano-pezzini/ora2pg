-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--Lanaamento dos procedimentos da regra de  converaao de pas



CREATE OR REPLACE PROCEDURE pls_conversao_itens_pck.inserir_proc_conv_itens_pos ( tb_proc_lancar_p INOUT table_dados_lanc_item_proc, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

tb_nr_seq_conta_proc_nv_w	dbms_sql.number_table;
tb_nr_seq_conta_proc_w		dbms_sql.number_table;



BEGIN

	if (tb_proc_lancar_p.nr_sequencia.count > 0) then
	
		forall i in tb_proc_lancar_p.nr_sequencia.first..tb_proc_lancar_p.nr_sequencia.last
			insert	into pls_conta_proc(nr_sequencia, dt_atualizacao, nm_usuario,
				dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_conta,
				cd_procedimento, ie_origem_proced, qt_procedimento,
				qt_procedimento_imp, ie_status, nr_seq_proc_princ,
				ie_situacao, ie_via_acesso, vl_unitario_imp,
				vl_procedimento_imp, vl_unitario, vl_liberado,
				vl_medico, vl_anestesista, vl_auxiliares,
				vl_custo_operacional, vl_materiais, vl_procedimento,
				vl_glosa, vl_beneficiario, nr_seq_regra_conv,
				ie_lanc_manual_pos, ie_apenas_pagamento, dt_procedimento,
				dt_inicio_proc, dt_fim_proc, ie_repassa_medico,
				nr_seq_honorario_crit, ie_criterio_horario, tx_item,
				nr_seq_regra_cooperado,ie_ato_cooperado)
			values (nextval('pls_conta_proc_seq'), clock_timestamp(), nm_usuario_p,
				clock_timestamp(), nm_usuario_p, tb_proc_lancar_p.nr_seq_conta(i),
				tb_proc_lancar_p.cd_procedimento(i), tb_proc_lancar_p.ie_origem_proced(i), tb_proc_lancar_p.qt_procedimento(i),
				tb_proc_lancar_p.qt_procedimento_imp(i), tb_proc_lancar_p.ie_status(i), tb_proc_lancar_p.nr_seq_proc_princ(i),
				tb_proc_lancar_p.ie_situacao(i), 'U',0,0,0,0,0,0,0,0,0,0,
				0, 0, tb_proc_lancar_p.nr_seq_regra_conv(i),
				'S', tb_proc_lancar_p.ie_apenas_pagamento(i), tb_proc_lancar_p.dt_procedimento(i),
				tb_proc_lancar_p.dt_inicio_proc(i), tb_proc_lancar_p.dt_fim_proc(i), tb_proc_lancar_p.ie_repassa_medico(i),
				tb_proc_lancar_p.nr_seq_honorario_crit(i), tb_proc_lancar_p.ie_criterio_horario(i), tb_proc_lancar_p.tx_item(i),
				tb_proc_lancar_p.nr_seq_regra_cooperado(i), tb_proc_lancar_p.ie_ato_cooperado(i)) returning nr_sequencia bulk collect into tb_nr_seq_conta_proc_nv_w;
		
		commit;
		
		
		tb_nr_seq_conta_proc_nv_w := pls_cta_proc_mat_regra_pck.cria_registro_regra_proc_tb(tb_nr_seq_conta_proc_nv_w, nm_usuario_p);
		tb_proc_lancar_p.nr_seq_conta := pls_cta_proc_mat_regra_pck.gera_seq_tiss_conta_proc_t(tb_proc_lancar_p.nr_seq_conta, nm_usuario_p);
	
	end if;
	tb_proc_lancar_p.nr_sequencia.delete; 		
	tb_proc_lancar_p.nr_seq_conta.delete; 		
	tb_proc_lancar_p.cd_procedimento.delete; 	
	tb_proc_lancar_p.ie_origem_proced.delete;	
	tb_proc_lancar_p.qt_procedimento.delete; 	
	tb_proc_lancar_p.qt_procedimento_imp.delete; 	
	tb_proc_lancar_p.ie_status.delete;		
	tb_proc_lancar_p.nr_seq_proc_princ.delete; 	
	tb_proc_lancar_p.ie_situacao.delete;		
	tb_proc_lancar_p.nr_seq_regra_conv.delete;	
	tb_proc_lancar_p.ie_apenas_pagamento.delete;	
	tb_proc_lancar_p.dt_procedimento.delete;	
	tb_proc_lancar_p.dt_inicio_proc.delete;		
	tb_proc_lancar_p.dt_fim_proc.delete;		
	tb_proc_lancar_p.ie_repassa_medico.delete;	
	tb_proc_lancar_p.nr_seq_honorario_crit.delete; 	
	tb_proc_lancar_p.ie_criterio_horario.delete; 	
	tb_proc_lancar_p.tx_item.delete;		
	tb_proc_lancar_p.nr_seq_regra_cooperado.delete;
	tb_proc_lancar_p.ie_ato_cooperado.delete; 	
			
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_conversao_itens_pck.inserir_proc_conv_itens_pos ( tb_proc_lancar_p INOUT table_dados_lanc_item_proc, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
