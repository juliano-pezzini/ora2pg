-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE gerar_int_dankia_pck.dankia_atualizar_ds_barras (ds_barras_old_p text, ds_barras_new_p text, nm_usuario_p text) AS $body$
BEGIN
        if (get_ie_int_dankia = 'S') then
		
			insert into gerar_int_dankia_pck.dankia_disp_item_transf(
							nr_sequencia,
							cd_estabelecimento,
							cd_transferencia,
							dt_atualizacao,
							nm_usuario,
							cd_material,
							cd_barras,
							cd_item_transferencia,
							ie_operacao,
							cd_local_estoque_origem,
							qt_material,
							cd_local_estoque_destino,
							dt_lido_dankia,
							ie_processado,
							ds_processado_observacao,
							ds_stack)
				(SELECT		nextval('dankia_disp_item_transf_seq'),
							cd_estabelecimento,
							cd_transferencia,
							clock_timestamp(),
							nm_usuario_p,
							cd_material,
							cd_barras,
							cd_item_transferencia,
							'E',
							cd_local_estoque_origem,
							qt_material,
							cd_local_estoque_destino,
							null,
							'N',
							ds_processado_observacao,
							ds_stack
				from		dankia_disp_item_transf
				where 		cd_barras = ds_barras_old_p
				and 		ie_operacao <> 'E');	

		   insert into gerar_int_dankia_pck.dankia_disp_item_transf( 
							nr_sequencia,
							cd_estabelecimento,
							cd_transferencia,
							dt_atualizacao,
							nm_usuario,
							cd_material,
							cd_barras,
							cd_item_transferencia,
							ie_operacao,
							cd_local_estoque_origem,
							qt_material,
							cd_local_estoque_destino,
							dt_lido_dankia,
							ie_processado,
							ds_processado_observacao,
							ds_stack)
				(SELECT		nextval('dankia_disp_item_transf_seq'),
							cd_estabelecimento,
							cd_transferencia,
							clock_timestamp(),
							nm_usuario_p,
							cd_material,
							ds_barras_new_p,
							cd_item_transferencia,
							'I',
							cd_local_estoque_origem,
							qt_material,
							cd_local_estoque_destino,
							null,
							'N',
							ds_processado_observacao,
							ds_stack
				from		dankia_disp_item_transf
				where 		cd_barras = ds_barras_old_p
				and 		ie_operacao <> 'E');
			end if;
        end;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_int_dankia_pck.dankia_atualizar_ds_barras (ds_barras_old_p text, ds_barras_new_p text, nm_usuario_p text) FROM PUBLIC;
