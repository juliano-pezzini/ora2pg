-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integr_resp_rec_pck2.atualizar_itens () AS $body$
DECLARE

current_setting('conciliar_integr_resp_rec_pck2.i')::integer                   integer := 0;
nr_seq_partic_w		procedimento_participante.nr_seq_partic%type;

BEGIN
FOR current_setting('conciliar_integr_resp_rec_pck2.i')::integer IN 0..campos_itens_w.count - 1 LOOP

    if (current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer)(.cd_funcao IS NOT NULL AND .cd_funcao::text <> '')) then

        select	max(nr_seq_partic)
        into STRICT	nr_seq_partic_w
        from	procedimento_participante
        where	ie_funcao 	= current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_funcao
        and	vl_participante = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_informado;

	end if;

   	update	imp_resp_recurso_item
		set	dt_atualizacao = clock_timestamp(),
			nm_usuario     = 'Integration',
			ie_status      = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status,
            nr_seq_matpaci = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_seq_matpaci,
            nr_seq_propaci = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_seq_propaci,
            nr_seq_propaci_partic  = nr_seq_partic_w
    where	nr_seq_res_rec_guia = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_seq_res_rec_guia
    and     nr_sequencia   = current_setting('conciliar_integr_resp_rec_pck2.campos_itens_w')::campos_itens_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_sequencia;

END LOOP;
commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integr_resp_rec_pck2.atualizar_itens () FROM PUBLIC;
