-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integr_resp_rec_pck2.atualizar_guia () AS $body$
DECLARE

current_setting('conciliar_integr_resp_rec_pck2.i')::integer integer := 0;

BEGIN
FOR current_setting('conciliar_integr_resp_rec_pck2.i')::integer IN 0..campos_guia_w.count - 1 LOOP

	update	imp_resp_recurso_guia
		set	dt_atualizacao = clock_timestamp(),
			nm_usuario     = 'Integration',
			ie_status      = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status
    where	nr_seq_res_rec_prot = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_seq_res_rec_prot
    and     nr_sequencia   = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_sequencia;

	if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status <> 'C') then

		update	imp_resp_recurso_item
		set	dt_atualizacao = clock_timestamp(),
			nm_usuario     = 'Integration',
			ie_status      = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status
		where	nr_seq_res_rec_guia in (SELECT	x.nr_sequencia from imp_resp_recurso_guia x where x.nr_seq_res_rec_prot = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_sequencia);

--        campos_guia_w.delete(i);
	end if;
END LOOP;
commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integr_resp_rec_pck2.atualizar_guia () FROM PUBLIC;
