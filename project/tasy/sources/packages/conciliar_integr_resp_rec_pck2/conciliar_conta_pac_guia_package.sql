-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integr_resp_rec_pck2.conciliar_conta_pac_guia () AS $body$
DECLARE

current_setting('conciliar_integr_resp_rec_pck2.i')::integer 	integer := 0;
k 	integer := 0;

BEGIN

if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.count > 0) then

    for current_setting('conciliar_integr_resp_rec_pck2.i')::integer in current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.last loop

        if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status = 'P') then
    
            for k in current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v.last loop
    
                if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v[k].ie_conciliado = 'N' and (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v[k].ie_lido = 'N')) then
    
                    if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_interno_conta = current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v[k].nr_interno_conta)  then
                        current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v[k].cd_autorizacao;
                        current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status := 'C';
                        current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';
                        current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia    := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v[k].vl_guia;
                    else
                        current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status := 'N';--guia não localizada na conta paciente
                        current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';
                    end if;

                end if;

            end loop;

    
        end if;

    end loop;

    PERFORM set_config('conciliar_integr_resp_rec_pck2.i', 0, false);
    k := 0;
    for current_setting('conciliar_integr_resp_rec_pck2.i')::integer in current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.last loop

        if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status = 'P') then
            if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v.count > 0) then
                for k in current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v.last loop		
        
                    if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].ie_conciliado = 'N') then
        
                        if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].nr_interno_conta = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_interno_conta)then
        
                            if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_guia_operadora) then
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';

                            elsif (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_guia_prestador) then
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';

                            elsif (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].vl_guia = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_informado) then	
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux2_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';
                            else
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status := 'M';--Localizada mais de uma guia
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'N';
                            end if;
                        end if;
                    end if;
                end loop;
            end if;
        end if;

    end loop;

    PERFORM set_config('conciliar_integr_resp_rec_pck2.i', 0, false);
    k := 0;
    for current_setting('conciliar_integr_resp_rec_pck2.i')::integer in current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v.last loop

        if (current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status = 'P') then
            if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v.count > 0) then
                for k in current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v.first .. current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v.last loop		
        
                    if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].ie_conciliado = 'N') then
        
                        if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].nr_interno_conta = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_interno_conta)then
        
                            if (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_guia_operadora) then
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';

                            elsif (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).nr_guia_prestador) then
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';

                            elsif (current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].vl_guia = current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_informado) then	
        
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].cd_autorizacao;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).vl_guia	:= current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v[k].vl_guia;
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status	:= 'C';
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_aux_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';
                            else
                                current_setting('conciliar_integr_resp_rec_pck2.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_status := 'N';--guia não localizada na conta paciente
                                current_setting('conciliar_integr_resp_rec_pck2.campos_conta_w')::campos_conta_v(current_setting('conciliar_integr_resp_rec_pck2.i')::integer).ie_conciliado := 'S';
                            end if;
                        end if;

                    end if;
        
                end loop;
            end if;

        end if;

    end loop;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integr_resp_rec_pck2.conciliar_conta_pac_guia () FROM PUBLIC;
