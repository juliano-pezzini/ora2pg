-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

/*
    * GET ALL GROUP's FORM 
    */
CREATE OR REPLACE FUNCTION apap_houdini_pck.get_form_groups ( SECTION_ID_P w_apap_pac_grupo.nr_sequencia%TYPE ) RETURNS SETOF T_FORM_GROUP_TABLE AS $body$
DECLARE

        w_group_row t_form_group_row;
        w_cursor_group_w CURSOR FOR
            SELECT   
                c.nr_seq_linha        ROW_ID,
                --c.ds_informacao       ROW_DESCRIPTION,
				CASE WHEN coalesce(c.ds_unid_med::text, '') = '' THEN c.ds_informacao  ELSE c.ds_informacao ||' ('||c.ds_unid_med||')' END  ROW_DESCRIPTION
            FROM
            TABLE( apap_dinamico_pck.get_linhas_secao_pac(SECTION_ID_P) ) c
            WHERE
                coalesce(nr_seq_superior::text, '') = ''
            ORDER BY c.nr_seq_apresentacao, c.nr_ordem_composto, c.ds_informacao;


BEGIN 

        FOR w_cursor_row in w_cursor_group_w LOOP

            w_group_row.ds_titulo       :=  w_cursor_row.ROW_DESCRIPTION;
            w_group_row.nr_seq_grupo    :=  w_cursor_row.ROW_ID;

            RETURN NEXT w_group_row;
        END LOOP;
        RETURN;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION apap_houdini_pck.get_form_groups ( SECTION_ID_P w_apap_pac_grupo.nr_sequencia%TYPE ) FROM PUBLIC;
