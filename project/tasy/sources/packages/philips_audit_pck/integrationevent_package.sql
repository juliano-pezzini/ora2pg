-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE philips_audit_pck.integrationevent (nm_usuario_p text, ds_usuario_p text, host_address_p text, integration_id_p text, integration_name_p text, integration_type_p text, content_p text, status_p text, extras_p text) AS $body$
DECLARE

    REQ utl_http.req;
    RES utl_http.resp;
    ADDRESS_SERVER varchar(250);
    CONTENT_DATA text;
    USER_ID varchar(100);
    USER_FULLNAME varchar(100);
    HOST_ADDRESS varchar(50);
    INTEGRATION_ID varchar(100);
    INTEGRATION_NAME varchar(100);
    INTEGRATION_TYPE varchar(50);
    INTEGRATION_CONTENT varchar(1000);
    INTEGRATION_STATUS varchar(50);
    INTEGRATION_EXTRAS varchar(500);


BEGIN

    USER_ID			:= AE_FORMAT_JSON_STRING(nm_usuario_p);
    USER_FULLNAME  		:= AE_FORMAT_JSON_STRING(ds_usuario_p);
    HOST_ADDRESS  		:= AE_FORMAT_JSON_STRING(host_address_p);
    INTEGRATION_ID  		:= AE_FORMAT_JSON_STRING(integration_id_p);
    INTEGRATION_NAME 	 	:= AE_FORMAT_JSON_STRING(integration_name_p);
    INTEGRATION_TYPE  		:= AE_FORMAT_JSON_STRING(integration_type_p);
    INTEGRATION_CONTENT  	:= AE_FORMAT_JSON_STRING(content_p);
    INTEGRATION_STATUS  	:= AE_FORMAT_JSON_STRING(status_p);
    INTEGRATION_EXTRAS  	:= AE_FORMAT_JSON_STRING(extras_p);

    ADDRESS_SERVER := philips_audit_pck.getaddress();
    IF (ADDRESS_SERVER IS NOT NULL AND ADDRESS_SERVER::text <> '') THEN

	CONTENT_DATA := '{
			  "userID" : ' || USER_ID || ',
			  "userFullName" : ' || USER_FULLNAME || ',
			  "hostAddress" : ' || HOST_ADDRESS || ',
			  "integrationId" : ' || INTEGRATION_ID || ',
			  "integrationName" : ' || INTEGRATION_NAME || ',
			  "type" : ' || INTEGRATION_TYPE || ',
			  "content" : ' || INTEGRATION_CONTENT || ',
			  "status" : ' || INTEGRATION_STATUS || ',
			  "extras" : ' || INTEGRATION_EXTRAS || '
			}';


        UTL_HTTP.set_wallet(getWallet, NULL);
        REQ := utl_http.begin_request(ADDRESS_SERVER || '/philips-audit/IntegrationEvent', 'POST');
		utl_http.set_header(REQ, 'content-type', 'application/json');
		utl_http.set_header(REQ, 'Content-Length', LENGTH(CONTENT_DATA));

		utl_http.write_text(REQ, CONTENT_DATA);

		RES := utl_http.get_response(REQ);

		BEGIN
			utl_http.end_response(RES);
		EXCEPTION
			WHEN utl_http.end_of_body THEN
				utl_http.end_response(RES);
		END;
    END IF;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE philips_audit_pck.integrationevent (nm_usuario_p text, ds_usuario_p text, host_address_p text, integration_id_p text, integration_name_p text, integration_type_p text, content_p text, status_p text, extras_p text) FROM PUBLIC;
