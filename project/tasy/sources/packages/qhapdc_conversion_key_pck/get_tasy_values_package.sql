-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION qhapdc_conversion_key_pck.get_tasy_values ( nm_tabela_qhapdc_p text, nm_tabela_tasy_p text default null) RETURNS SETOF T_VALORES_TASY AS $body$
DECLARE


r_valores_tasy_w	r_valores_tasy;
vl_chave_w		varchar(50);
ds_valor_w		varchar(2000);
ie_tab_valida_w		boolean;
tc 			t_crs;
dva_restriction varchar(50);


BEGIN

ie_tab_valida_w	:= true;
dva_restriction := ' and cd_convenio = '||nm_tabela_tasy_p ||'and ie_situacao = ''A''';

/*Add here the tables from QHAPDC that will be used for the mapping keys*/

case nm_tabela_qhapdc_p
	-- Tables
  when 'QHAPDC_CHARGABLE_STATUS' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('TIPO_ACOMODACAO', 'CD_TIPO_ACOMODACAO', 'DS_TIPO_ACOMODACAO', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_EMPLOYMENT_STATUS' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('PROFISSAO', 'CD_PROFISSAO', 'DS_PROFISSAO', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_SEPARATION_MODE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('MOTIVO_ALTA', 'CD_MOTIVO_ALTA', 'DS_MOTIVO_ALTA', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_FUNDING_SOURCE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('CONVENIO', 'CD_CONVENIO', 'DS_CONVENIO', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_PRIN_REF_SERVICE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('SUBMOTIVO_ALTA', 'NR_SEQUENCIA', 'DS_MOTIVO', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_COMPENSABLE_STATUS' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('CONVENIO', 'CD_CONVENIO', 'DS_CONVENIO', ' AND IE_SITUACAO = ''A''', tc);
  --when 'QHAPDC_CARE_TYPE' 	then qhapdc_conversion_key_pck.obtain_table_cursor('CLASSIFICACAO_ATENDIMENTO','NR_SEQUENCIA','DS_CLASSIFICACAO',' AND IE_SITUACAO = ''A''', tc);
  --when 'QHAPDC_BAND_TYPE' 	then qhapdc_conversion_key_pck.obtain_table_cursor('PRECO_AMB','CD_LEVEL','CD_LEVEL',' AND 1 = 1', tc);
  when 'QHAPDC_BAND_TYPE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('PROCEDIMENTO', 'CD_PROCEDIMENTO', 'DS_PROCEDIMENTO', ' AND 1 = 1 AND IE_ORIGEM_PROCED = 4', tc);
  when 'QHAPDC_DVA_CARD_TYPE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('CONVENIO_PLANO', 'CD_PLANO', 'DS_PLANO', dva_restriction, tc);
  when 'QHAPDC_COUNTRY_CODE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('NACIONALIDADE', 'CD_NACIONALIDADE', 'DS_NACIONALIDADE', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_STANDARD_UNIT_CODE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('MEDICO_CATEGORIA', 'NR_SEQUENCIA', 'DS_CATEGORIA', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_SOURCE_OF_REFERRAL' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('PROCEDENCIA', 'CD_PROCEDENCIA', 'DS_PROCEDENCIA', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_FURTHER_CARE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('CADASTRO_SUBMOTIVO_ALTA', 'NR_SEQUENCIA', 'DS_SUBMOTIVO_ALTA', ' AND IE_SITUACAO = ''A''', tc);
  when 'QHAPDC_ELECTIVE_STATUS' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('SUS_CARATER_INTERNACAO', 'CD_CARATER_INTERNACAO', 'DS_CARATER_INTERNACAO', '', tc);

  -- Domains 
  when 'QHAPDC_MARITAL_STATUS'		then tc := qhapdc_conversion_key_pck.obtain_domain_cursor('5', tc);
  when 'QHAPDC_CARE_TYPE'		then tc := qhapdc_conversion_key_pck.obtain_domain_cursor('9561', tc);

  -- Tables
  --when 'HCP_CARE_TYPE' 	then qhapdc_conversion_key_pck.obtain_table_cursor('CLASSIFICACAO_ATENDIMENTO','NR_SEQUENCIA','DS_CLASSIFICACAO',' AND IE_SITUACAO = ''A''', tc);
  when 'HCP_SEPARATION_MODE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('MOTIVO_ALTA', 'CD_MOTIVO_ALTA', 'DS_MOTIVO_ALTA', ' AND IE_SITUACAO = ''A''', tc);
  when 'HCP_REF_SOURCE' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('PROCEDENCIA', 'CD_PROCEDENCIA', 'DS_PROCEDENCIA', ' AND IE_SITUACAO = ''A''', tc);
  when 'HCP_DISCHARGE_INTENTION' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('MOTIVO_ALTA', 'CD_MOTIVO_ALTA', 'DS_MOTIVO_ALTA', ' AND IE_SITUACAO = ''A''', tc);
  when 'HCP_DEPART_TYPE' then tc := qhapdc_conversion_key_pck.obtain_table_cursor('SETOR_ATENDIMENTO', 'CD_SETOR_ATENDIMENTO', 'DS_SETOR_ATENDIMENTO', ' AND IE_SITUACAO = ''A''', tc);
  when 'HPC_EPISODE_END' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('MOTIVO_ALTA', 'CD_MOTIVO_ALTA', 'DS_MOTIVO_ALTA', ' AND IE_SITUACAO = ''A''', tc);
  when 'HPC_EPISODE_START' 	then tc := qhapdc_conversion_key_pck.obtain_table_cursor('PROCEDENCIA', 'CD_PROCEDENCIA', 'DS_PROCEDENCIA', ' AND IE_SITUACAO = ''A''', tc);

  -- Domains
  when 'HCP_CARE_TYPE'		then tc := qhapdc_conversion_key_pck.obtain_domain_cursor('9561', tc);

	else ie_tab_valida_w := false;
end case;

if (ie_tab_valida_w) then
loop
	fetch tc into vl_chave_w, ds_valor_w;
  --fetch tc into  ds_valor_w ;
	EXIT WHEN NOT FOUND; /* apply on tc */
		r_valores_tasy_w.vl_chave	:= vl_chave_w;
		r_valores_tasy_w.ds_valor	:= ds_valor_w;
		RETURN NEXT r_valores_tasy_w;

end loop;

end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION qhapdc_conversion_key_pck.get_tasy_values ( nm_tabela_qhapdc_p text, nm_tabela_tasy_p text default null) FROM PUBLIC;
