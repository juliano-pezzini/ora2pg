-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_apropriacao_pck.get_qt_itens_cobrar (pls_regra_copartic_p pls_apropriacao_pck.dados_regra_copartic) RETURNS bigint AS $body$
DECLARE

	
	regras_incidencia CURSOR FOR
		SELECT	*
		from	pls_regra_copartic_util
		where	nr_seq_regra = pls_regra_copartic_p.nr_sequencia;
	
	qt_itens_cobrar_w	double precision;
BEGIN
	if (pls_regra_copartic_p.ie_utilizacao = 'S') then
		for regras_incidencia_w in regras_incidencia loop
			if (current_setting('pls_apropriacao_pck.ie_gerando_conta_proc_mat_w')::varchar(255) = 'P') and
			   ((regras_incidencia_w.ie_eventos_incidencia = 'S') or (pls_se_grupo_preco_servico(regras_incidencia_w.nr_seq_grupo_serv, current_setting('pls_apropriacao_pck.pls_conta_proc_w')::pls_conta_proc%rowtype.cd_procedimento, current_setting('pls_apropriacao_pck.pls_conta_proc_w')::pls_conta_proc%rowtype.ie_origem_proced) = 'S')) then
				qt_itens_cobrar_w := coalesce(qt_itens_cobrar_w, 0) + pls_apropriacao_pck.get_qt_proc_incidencia_cobrar(regras_incidencia_w, pls_regra_copartic_p);
			elsif (current_setting('pls_apropriacao_pck.ie_gerando_conta_proc_mat_w')::varchar(255) = 'M' and regras_incidencia_w.ie_eventos_incidencia = 'S') then
				qt_itens_cobrar_w := coalesce(qt_itens_cobrar_w, 0) + pls_apropriacao_pck.get_qt_mat_incidencia_cobrar(regras_incidencia_w, pls_regra_copartic_p);
			end if;
		end loop;
	end if;
	
	return coalesce(qt_itens_cobrar_w, get_qt_itens);
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_apropriacao_pck.get_qt_itens_cobrar (pls_regra_copartic_p pls_apropriacao_pck.dados_regra_copartic) FROM PUBLIC;
