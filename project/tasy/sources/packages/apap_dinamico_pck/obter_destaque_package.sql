-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION apap_dinamico_pck.obter_destaque ( nr_seq_documento_p bigint, nr_atendimento_p bigint, nm_tabela_p text, nm_atributo_p text, dt_apap_p timestamp, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

   ds_retorno_w   		varchar(2000);
   nr_seq_destaque_w	apap_destaque_celula.nr_sequencia%type;
   ds_cor_w				apap_destaque_celula.ds_cor%type;
   ds_descricao_w		apap_destaque_celula.ds_descricao%type;

BEGIN
   select   max(nr_seq_destaque),
			max(ds_cor),
			max(ds_descricao)
   into STRICT     nr_seq_destaque_w,
			ds_cor_w,
			ds_descricao_w
   from     w_apap_pac_registro_hist a,
			apap_destaque_celula b
   where    a.nr_seq_destaque		= b.nr_sequencia
   and		a.nr_seq_documento  	= nr_seq_documento_p
   and		a.nr_atendimento	  	= nr_atendimento_p
   and      a.nm_tabela         	= nm_tabela_p
   and      a.nm_atributo       	= nm_atributo_p
   and      a.dt_apap           	= dt_apap_p
   and      coalesce(a.ie_situacao,'A')	= 'A'
   and		coalesce(a.ie_tipo,'C')		= 'D';

	if (ie_opcao_p	= 'S') then
		ds_retorno_w	:= coalesce(nr_seq_destaque_w,'-1');
	elsif (ie_opcao_p	= 'C') then
		ds_retorno_w	:= ds_cor_w;
	elsif (ie_opcao_p	= 'D') then
		ds_retorno_w	:= coalesce(ds_descricao_w,obter_desc_expressao(10652714));
	end if;	

   return   ds_retorno_w;
   END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION apap_dinamico_pck.obter_destaque ( nr_seq_documento_p bigint, nr_atendimento_p bigint, nm_tabela_p text, nm_atributo_p text, dt_apap_p timestamp, ie_opcao_p text) FROM PUBLIC;
