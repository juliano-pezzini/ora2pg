-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE apap_dinamico_pck.atualiza_row_families (nr_seq_documento_secao_p bigint,nr_atendimento_p bigint,nr_seq_documento_p bigint) AS $body$
DECLARE

	current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type	usuario.nm_usuario%type	:=	wheb_usuario_pck.get_nm_usuario;
	c_linhas CURSOR FOR
		SELECT	nr_seq_linked_data,
				nm_atributo,
				coalesce(nr_seq_exame,0) nr_seq_exame
		from	documento_subsecao
		where	nr_seq_documento_secao = nr_seq_documento_secao_p;
	
BEGIN
	<<read_linhas>>
	for r_linhas in c_linhas
		loop
		update  w_apap_pac_informacao a
		set     a.ie_visivel = 'S', a.ie_exibe_grafico = 'S'
		where	a.nr_seq_linked_data 	= r_linhas.nr_seq_linked_data
		and		a.nm_atributo_linked	= r_linhas.nm_atributo
		and		coalesce(a.nr_seq_exame,0)	= r_linhas.nr_seq_exame
		and		exists (SELECT	1
						from	w_apap_pac_grupo b,
								w_apap_pac c
						where	a.nr_seq_apap_grupo = b.nr_sequencia
						and		b.nr_seq_mod_apap	= c.nr_sequencia
						and		c.nr_atendimento	= nr_atendimento_p
						and		c.nr_seq_documento	= nr_seq_documento_p
						and		c.nm_usuario		= current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type);
		end loop read_linhas;
	commit;	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE apap_dinamico_pck.atualiza_row_families (nr_seq_documento_secao_p bigint,nr_atendimento_p bigint,nr_seq_documento_p bigint) FROM PUBLIC;
