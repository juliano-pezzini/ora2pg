-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE apap_dinamico_pck.gerar_documento ( nr_seq_documento_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, dt_inicial_p timestamp, dt_final_p timestamp, cd_setor_atendimento_p bigint, gap_p bigint) AS $body$
DECLARE


  nr_indice_apap_w     bigint;
  nr_indice_grupo_w    bigint;
  nr_indice_linha_w    bigint;
  nr_indice_sup_w	   bigint;
  nr_indice_tree_w	   bigint;	
  ds_titulo_linha_w    w_apap_pac_informacao.ds_informacao%type;
  ds_titulo_informacao_w w_apap_pac_informacao.ds_informacao%type;
  nm_atributo_unico_w	w_apap_pac_informacao.nm_atributo_unico%type;
  ds_unid_med_w	      varchar(50) := null;
  ds_unid_med_ww	      varchar(50);
  ie_visivel_w         varchar(15);
  cd_pf_usuario_w      pessoa_fisica.cd_pessoa_fisica%type := obter_pf_usuario(current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type,'C');
  nr_seq_dispositivo_w atendimento_perda_ganho.nr_seq_dispositivo%type;
  nr_seq_atend_disp_w  atendimento_perda_ganho.nr_seq_atend_disp%type;
  ds_dispositivo_w     varchar(80);
  ds_topografia_w      varchar(60);
  ie_possui_w          varchar(1)  := 'N';
  ds_grupo_gp_w		grupo_perda_ganho.ds_grupo%type := null;
  count_w              bigint := 0;
  cd_unidade_medida_w  varchar(50) := null;
  ie_reload_warning_rule	varchar(1)  := 'N';
  nr_seq_vital_sign_rule	bigint;
  min_value_warning_exist_w	double precision;
  max_value_warning_exist_w	double precision;
  min_value_warning_sv_w	double precision;
  max_value_warning_sv_w	double precision;
  qt_idade_pf_w		double precision;
  qt_idade_dia_w		double precision;
  current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type		sinal_vital_regra.cd_perfil%type;
  param_inter_colors_w funcao_param_usuario.vl_parametro%type;

  c_grupo CURSOR FOR
	SELECT	nr_seq_apresentacao,
			ds_titulo,
			ie_padrao_visivel,
			nr_escala_minima_esq,
			nr_escala_maxima_esq,
			nr_seq_linked_data,
			nr_sequencia nr_seq_documento_secao,
			coalesce(ie_mostra_disp,'N') ie_mostra_disp,
			ie_tipo,
			nr_seq_template,
			cd_funcao_add_new,
			nr_seq_item_pront,
			ie_tipo_acesso
	from	  documento_secao
	where	  nr_seq_documento = current_setting('apap_dinamico_pck.nr_seq_documento_w')::documento.nr_sequencia%type
	and     apap_obter_se_exibe_grupo_doc(null,nr_sequencia,current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type) = 'S'
	and     coalesce(ie_row_families,'N') = 'N'
	order by
			nr_seq_apresentacao,
			ds_titulo;

  c_linha CURSOR(nr_seq_documento_secao_p  bigint) FOR
	SELECT	*
	from	(	SELECT	a.nr_sequencia,
					a.nr_seq_apresentacao,
					a.nm_atributo nm_atributo_apap,
					c.nm_atributo nm_atributo_tabela,
					c.nm_atributo_linked,
					a.ie_modo,
					CASE WHEN a.ie_modo='A' THEN 'S'  ELSE CASE WHEN a.ie_modo='M' THEN 'N'  ELSE 'F' END  END  ie_visivel,
					a.ie_intake_output,
					a.ie_controla_adep,
					a.ie_plot_style,
					a.ie_symbol,
					a.ds_color,
					a.nr_seq_grupo_pg,
					a.nr_seq_tipo_pg,
					a.nr_seq_score_flex,
					a.nr_seq_tipo_avaliacao,
					a.nr_ficha_tecnica,
					a.ie_tipo_dosagem,
					a.nr_seq_gas,
					a.cd_material,
					a.cd_grupo_material,
					a.cd_subgrupo_material,
					a.cd_classe_material,
					a.ie_evolucao_clinica,
					a.nr_seq_tipo_registro,
					a.nr_seq_diagnostico,				  
					substr(PE_obter_desc_diag(a.nr_seq_diagnostico,'DI'),1,120) ds_diagnostico,																		
					a.nr_seq_inf_adic,
					a.ie_membro,
					a.nr_seq_exame,
					a.ie_pupila_lado,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_maxima  ELSE CASE WHEN a.ie_plot_axis='E' THEN b.nr_escala_maxima_esq  ELSE b.nr_escala_maxima_dir END  END  nr_escala_maxima,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_minima  ELSE CASE WHEN a.ie_plot_axis='E' THEN b.nr_escala_minima_esq  ELSE b.nr_escala_minima_dir END  END  nr_escala_minima,
					d.nm_table nm_tabela,
					a.ds_title ds_title,
					obter_desc_expressao(c.cd_exp_informacao) ds_label,
					CASE WHEN coalesce(a.nr_seq_score_flex::text, '') = '' THEN null  ELSE obter_desc_score_flex_2(a.nr_seq_score_flex) || ' ('||obter_desc_expressao(c.cd_exp_informacao)||')' END  ds_label_escala,
					CASE WHEN coalesce(a.nr_seq_tipo_avaliacao::text, '') = '' THEN null  ELSE obter_desc_tipo_avaliacao(a.nr_seq_tipo_avaliacao) END  ds_tipo_avaliacao,
					obter_desc_gas(a.nr_seq_gas) ds_gasoterapia,
					obter_desc_ficha_tecnica(a.nr_ficha_tecnica) ds_ficha_tecnica,
					CASE WHEN coalesce(a.nr_seq_grupo_pg::text, '') = '' THEN null  ELSE obter_desc_grupo_pg(a.nr_seq_grupo_pg) END  ds_grupo_pg,
					CASE WHEN coalesce(a.nr_seq_tipo_pg::text, '') = '' THEN null  ELSE Obter_Desc_Tipo_Perda_Ganho(a.nr_seq_tipo_pg) END  ds_tipo_pg,
					obter_desc_tipo_evolucao(a.ie_evolucao_clinica) ds_tipo_evolucao,
					(select WW.ds_template from ehr_template WW where WW.nr_sequencia = a.nr_seq_tipo_registro) ds_tipo_registro,
					lab_obter_dados_exame(a.nr_seq_exame,'N') nm_exame,
					obter_valor_dominio(1304,a.ie_membro) ds_membro,
					obter_valor_dominio(1372,a.ie_pupila_lado) ds_pupila_lado,
					obter_dados_pg_inf_adic(a.nr_seq_inf_adic,'D') ds_inf_adic,
					e.ie_informacao,
					e.ds_sql,
					a.nr_seq_documento_secao,
					obter_desc_expressao(d.CD_EXP_TITLE) nm_visao,
					e.ie_grupo,
					d.nr_seq_vision nr_seq_visao,
					coalesce(a.nr_ordem_composto,-1) nr_ordem_composto,
					coalesce(a.ie_integracao,'A') ie_integracao,
					coalesce(a.ie_aparelho_pa,'C') ie_aparelho_pa,					
					coalesce(a.ie_mediana,'N') ie_mediana,
					coalesce(a.ie_mediana_1_min,'N') ie_mediana_1_min,
					coalesce(a.ie_mediana_5_min,'N') ie_mediana_5_min,
					coalesce(a.ie_mediana_10_min,'N') ie_mediana_10_min,
					coalesce(a.ie_mediana_15_min,'N') ie_mediana_15_min,
					--obter_desc_expressao(c.cd_exp_unid_med) ds_unidade_medida,
					case 
						when(c.cd_exp_unid_med IS NOT NULL AND c.cd_exp_unid_med::text <> '') then obter_desc_expressao(c.cd_exp_unid_med)
						when(a.nr_seq_exame IS NOT NULL AND a.nr_seq_exame::text <> '') and ((coalesce(c.nm_atributo::text, '') = '') or (c.nm_atributo in ('PR_RESULTADO','DS_RESULTADO_CURTO','DS_RESULTADO','QT_RESULTADO'))) then obter_desc_unid_exame(a.nr_seq_exame)
						else null	
					end ds_unidade_medida,
					d.nr_sequencia nr_seq_linked_data,
					a.nr_seq_superior,
					a.ds_formato_composto,
					a.ie_evento_tipo,
					obter_valor_dominio(10224,a.ie_evento_tipo) ds_evento_tipo,
					obter_valor_dominio(2159,a.ie_tipo_elemento) ds_tipo_elemento,
					a.ie_tipo_elemento,
					e.ie_read_only,
					a.ie_trend,
					a.nr_width,
					c.nm_atrib_vl_graf,
					CASE WHEN coalesce(a.nr_seq_exame::text, '') = '' THEN null  ELSE (	select  max(Obter_Desc_Exame(x.nr_seq_superior))									  from    exame_laboratorio x									  where   x.nr_seq_exame = a.nr_seq_exame) END  ds_exame_superior,
					CASE WHEN coalesce(a.ie_tipo_elemento::text, '') = '' THEN null  ELSE (	select	max(y.cd_unidade_medida)										from	nut_elemento y										where	y.ie_tipo_elemento 		= a.ie_tipo_elemento										and		coalesce(y.ie_situacao,'A')	= 'A') END  ds_unid_med_elemento,
					a.ie_line,	
					a.nr_size,
					a.nr_valor_minimo,
					a.nr_valor_maximo,
					a.ds_symbol_color_exceeded,
					a.ie_reference_line,
					a.nr_reference_line,
					a.nr_seq_atrib_cliente,
					a.nr_seq_temp_conteudo,
					--a.nr_escala_intervalo,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_intervalo  ELSE CASE WHEN a.ie_plot_axis='E' THEN b.nr_escala_intervalo_esq  ELSE b.nr_escala_intervalo_dir END  END  nr_escala_intervalo,
					a.ie_mark_exceeded_value_chart,
					a.ie_plot_axis,
					coalesce(a.ie_grafico,'N') ie_grafico,
					c.ds_lookup,
					substr(c.nm_atributo_linked||'_'||CASE WHEN coalesce(e.ie_informacao::text, '') = '' THEN 'ID_'||e.ie_grupo  ELSE 'ID_'||e.ie_grupo||'_'||e.ie_informacao END ,1,50) nm_id
			from    documento_subsecao a,
					documento_secao b,
					linked_data_atributo c,
					linked_data d,
					linked_data_ativacao e
			where   a.nr_seq_documento_secao  	= b.nr_sequencia
			and     a.nr_seq_linked_data      	= c.nr_seq_linked_data
			and     a.nr_seq_linked_data      	= e.nr_seq_linked_data
			and     d.nr_sequencia            	= a.nr_seq_linked_data
			and     a.nm_atributo             	= c.nm_atributo_linked
			and     coalesce(b.ie_row_families,'N')  = 'N'
			and     a.nr_seq_documento_secao  	= nr_seq_documento_secao_p
			
union

			select  a.nr_sequencia,
					a.nr_seq_apresentacao,
					a.nm_atributo nm_atributo_apap,
					a.nm_atributo nm_atributo_tabela,
					a.nm_atributo nm_atributo_linked,
					a.ie_modo,
					CASE WHEN a.ie_modo='A' THEN 'S'  ELSE CASE WHEN a.ie_modo='M' THEN 'N'  ELSE 'F' END  END  ie_visivel,
					a.ie_intake_output,
					a.ie_controla_adep,
					a.ie_plot_style,
					a.ie_symbol,
					a.ds_color,
					a.nr_seq_grupo_pg,
					a.nr_seq_tipo_pg,
					a.nr_seq_score_flex,
					a.nr_seq_tipo_avaliacao,
					a.nr_ficha_tecnica,
					a.ie_tipo_dosagem,
					a.nr_seq_gas,
					a.cd_material,
					a.cd_grupo_material,
					a.cd_subgrupo_material,
					a.cd_classe_material,
					a.ie_evolucao_clinica,
					a.nr_seq_tipo_registro,
					a.nr_seq_diagnostico,				  
					substr(PE_obter_desc_diag(a.nr_seq_diagnostico,'DI'),1,120) ds_diagnostico,																		
					a.nr_seq_inf_adic,
					a.ie_membro,
					a.nr_seq_exame,
					a.ie_pupila_lado,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_maxima  ELSE CASE WHEN a.ie_plot_axis='E' THEN c.nr_escala_maxima_esq  ELSE c.nr_escala_maxima_dir END  END  nr_escala_maxima,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_minima  ELSE CASE WHEN a.ie_plot_axis='E' THEN c.nr_escala_minima_esq  ELSE c.nr_escala_minima_dir END  END  nr_escala_minima,
					e.nm_table nm_tabela,
					a.ds_title ds_title,
					b.ds_label ds_label,
					null ds_label_escala,
					null ds_tipo_avaliacao,
					null ds_gasoterapia,
					null ds_ficha_tecnica,
					null ds_grupo_pg,
					null ds_tipo_pg,
					null ds_tipo_evolucao,
					null ds_tipo_registro,
					null nm_exame,
					null ds_membro,
					null ds_pupila_lado,
					null ds_inf_adic,
					d.ie_informacao,
					d.ds_sql,
					a.nr_seq_documento_secao,
					null nm_visao,
					d.ie_grupo,
					null nr_seq_visao,
					coalesce(a.nr_ordem_composto,-1) nr_ordem_composto,
					coalesce(a.ie_integracao,'A') ie_integracao,
					coalesce(a.ie_aparelho_pa,'C') ie_aparelho_pa,					
					coalesce(a.ie_mediana,'N') ie_mediana,
					coalesce(a.ie_mediana_1_min,'N') ie_mediana_1_min,
					coalesce(a.ie_mediana_5_min,'N') ie_mediana_5_min,
					coalesce(a.ie_mediana_10_min,'N') ie_mediana_10_min,
					coalesce(a.ie_mediana_15_min,'N') ie_mediana_15_min,
					null ds_unidade_medida,
					a.nr_seq_linked_data nr_seq_linked_data,
					a.nr_seq_superior,
					a.ds_formato_composto,
					null ie_evento_tipo,
					null ds_evento_tipo,
					null ds_tipo_elemento,
					null ie_tipo_elemento,
					null ie_read_only,
					a.ie_trend,
					a.nr_width,
					null nm_atrib_vl_graf,
					null ds_exame_superior,
					null ds_unid_med_elemento,
					a.ie_line,
					a.nr_size,
					a.nr_valor_minimo,
					a.nr_valor_maximo,
					a.ds_symbol_color_exceeded,
					a.ie_reference_line,
					a.nr_reference_line,
					a.nr_seq_atrib_cliente,
					a.nr_seq_temp_conteudo,
					CASE WHEN coalesce(a.ie_plot_axis::text, '') = '' THEN a.nr_escala_intervalo  ELSE CASE WHEN a.ie_plot_axis='E' THEN c.nr_escala_intervalo_esq  ELSE c.nr_escala_intervalo_dir END  END  nr_escala_intervalo,
					a.ie_mark_exceeded_value_chart,
					a.ie_plot_axis,
					coalesce(a.ie_grafico,'N') ie_grafico,
					CASE WHEN coalesce(b.ds_sql::text, '') = '' THEN null  ELSE 'select max(ds) from ('||b.ds_sql||') where cd = :vl_resultado' END  ds_lookup,
					substr(a.nm_atributo||CASE WHEN coalesce(d.ie_informacao::text, '') = '' THEN 'ID_'||d.ie_grupo  ELSE 'ID_'||d.ie_grupo||'_'||d.ie_informacao END ,1,50) nm_id
			from    documento_subsecao a,
					ehr_template_conteudo b,
					linked_data_ativacao d,
					linked_data e,
					documento_secao c
			where   a.nr_seq_temp_conteudo 	= b.nr_sequencia
			and     a.nr_seq_linked_data    = d.nr_seq_linked_data
			and     a.nr_seq_linked_data    = e.nr_sequencia
			and		a.nr_seq_documento_secao= c.nr_sequencia
			and     a.nr_seq_documento_secao= nr_seq_documento_secao_p) alias73
	order by	nr_seq_apresentacao,
				coalesce(nr_ordem_composto,-1),
				ds_label;

  c_linha_ganho_perda CURSOR(nr_seq_tipo_pg_p  bigint,ie_mostra_disp_p  text) FOR
	SELECT	b.ds_tipo,
			c.nr_seq_topografia,
			c.ie_lado,
			coalesce(b.ie_exibir_topografia,'N') ie_exibir_topografia,
			coalesce(b.ie_exibir_lado,'N') ie_exibir_lado,
			obter_desc_topografia_dor(c.nr_seq_topografia) ds_topografia,
			obter_valor_dominio(1372,c.ie_lado) ds_lado,
			CASE WHEN ie_mostra_disp_p='S' THEN CASE WHEN coalesce(c.nr_seq_dispositivo::text, '') = '' THEN null  ELSE substr(obter_descricao_padrao('DISPOSITIVO','DS_DISPOSITIVO',c.nr_seq_dispositivo),1,80) END   ELSE null END  ds_disp_gp,
			CASE WHEN ie_mostra_disp_p='S' THEN CASE WHEN coalesce(c.nr_seq_atend_disp::text, '') = '' THEN null  ELSE obter_complem_adicional(obter_nr_seq_comp_adic(c.nr_seq_atend_disp)) END   ELSE null END  ds_complemento_disp,
			CASE WHEN ie_mostra_disp_p='S' THEN c.nr_seq_dispositivo  ELSE null END  nr_seq_dispositivo,
			CASE WHEN ie_mostra_disp_p='S' THEN c.nr_seq_atend_disp  ELSE null END  nr_seq_atend_disp,
			a.ds_grupo
	from    tipo_perda_ganho b,
			grupo_perda_ganho a,
			atendimento_perda_ganho c,
			table(lista_pck.obter_lista_char('V,P,O',',')) l
	where   c.nr_atendimento	= current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
	and     b.nr_sequencia		= c.nr_seq_tipo
	and     b.nr_seq_grupo		= a.nr_sequencia
	and     b.ie_volume_ocorrencia = l.cd_registro
	and     c.nr_seq_tipo		= nr_seq_tipo_pg_p
	and     ((current_setting('apap_dinamico_pck.cd_setor_atendimento_w')::setor_atendimento.cd_setor_atendimento%coalesce(type::text, '') = '') or (coalesce(c.cd_setor_atendimento,current_setting('apap_dinamico_pck.cd_setor_atendimento_w')::setor_atendimento.cd_setor_atendimento%type) = current_setting('apap_dinamico_pck.cd_setor_atendimento_w')::setor_atendimento.cd_setor_atendimento%type))
	and     coalesce(b.ie_soma_bh,'S')	= 'S'
	and     coalesce(c.dt_apap,c.dt_medida) between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp
	and     coalesce(c.ie_situacao,'A')	= 'A'
	and     (c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> '')
	group by
			b.ds_tipo,
			a.ds_grupo,	
			c.nr_seq_topografia,
			c.ie_lado,
			b.ie_exibir_topografia,
			b.ie_exibir_lado,
			CASE WHEN ie_mostra_disp_p='S' THEN CASE WHEN coalesce(c.nr_seq_dispositivo::text, '') = '' THEN null  ELSE substr(obter_descricao_padrao('DISPOSITIVO','DS_DISPOSITIVO',c.nr_seq_dispositivo),1,80) END   ELSE null END ,
			CASE WHEN ie_mostra_disp_p='S' THEN CASE WHEN coalesce(c.nr_seq_atend_disp::text, '') = '' THEN null  ELSE obter_complem_adicional(obter_nr_seq_comp_adic(c.nr_seq_atend_disp)) END   ELSE null END ,
			CASE WHEN ie_mostra_disp_p='S' THEN c.nr_seq_dispositivo  ELSE null END ,
			CASE WHEN ie_mostra_disp_p='S' THEN c.nr_seq_atend_disp  ELSE null END;

	c_solucao_item CURSOR FOR
	SELECT	nr_prescricao,
			nr_seq_solucao,
			ds_solucao
	from (	SELECT	a.nr_prescricao,
							x.nr_seq_solucao,
							SUBSTR(coalesce(trim(both x.ds_solucao),obter_prim_comp_sol(a.nr_prescricao,x.nr_seq_solucao)),1,240) ds_solucao,
							obter_status_solucao_prescr(1,a.nr_prescricao, x.nr_seq_solucao) ie_status_solucao
					FROM	prescr_solucao x,
							prescr_medica a,
							prescr_material b
					WHERE	a.nr_prescricao      = x.nr_prescricao
					AND		x.nr_prescricao      = b.nr_prescricao
					AND		x.nr_seq_solucao     = b.nr_sequencia_solucao
					AND		a.nr_atendimento     = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
					AND 	a.dt_validade_prescr > clock_timestamp()
					AND 	coalesce(a.dt_suspensao::text, '') = ''
					AND		coalesce(x.dt_suspensao::text, '') = ''
					AND		coalesce(x.nr_seq_dialise::text, '') = '') alias10
	  where	ie_status_solucao not in ('T','N')
	  GROUP BY nr_prescricao, nr_seq_solucao, ds_solucao;

  c_itens_administrados CURSOR(cd_material_secao_p         bigint,
								  cd_grupo_secao_p            bigint,
								  cd_subgrupo_secao_p         bigint,
								  cd_classe_secao_p           bigint,
								  nr_ficha_tecnica_secao_p    bigint) FOR
	SELECT	distinct
			cd_material,
			ds_material,
			ds_unidade_medida
	from	  table(get_itens_administrados)
	where (cd_material            = cd_material_secao_p or coalesce(cd_material_secao_p::text, '') = '')
	and (cd_grupo_material      = cd_grupo_secao_p or coalesce(cd_grupo_secao_p::text, '') = '')
	and (cd_subgrupo_material   = cd_subgrupo_secao_p or coalesce(cd_subgrupo_secao_p::text, '') = '')
	and (cd_classe_material     = cd_classe_secao_p or coalesce(cd_classe_secao_p::text, '') = '')
	and (nr_seq_ficha_tecnica   = nr_ficha_tecnica_secao_p or coalesce(nr_ficha_tecnica_secao_p::text, '') = '')
	order by
			ds_material;

	c_itens_pendentes CURSOR(cd_material_secao_p         bigint,
							  cd_grupo_secao_p            bigint,
							  cd_subgrupo_secao_p         bigint,
							  cd_classe_secao_p           bigint,
							  nr_ficha_tecnica_secao_p    bigint) FOR
	SELECT	distinct
			cd_material,
			ds_material,
			ds_unidade_medida
	from	  table(get_itens_pendentes)
	where (cd_material            = cd_material_secao_p or coalesce(cd_material_secao_p::text, '') = '')
	and (cd_grupo_material      = cd_grupo_secao_p or coalesce(cd_grupo_secao_p::text, '') = '')
	and (cd_subgrupo_material   = cd_subgrupo_secao_p or coalesce(cd_subgrupo_secao_p::text, '') = '')
	and (cd_classe_material     = cd_classe_secao_p or coalesce(cd_classe_secao_p::text, '') = '')
	and (nr_seq_ficha_tecnica   = nr_ficha_tecnica_secao_p or coalesce(nr_ficha_tecnica_secao_p::text, '') = '')
	order by
			ds_material;

  c_ult_disp_solucao CURSOR(nr_seq_dispositivo_p  bigint) FOR
	SELECT	substr(obter_nome_dispositivo(nr_seq_dispositivo),1,80) ds_dispositivo,
			substr(obter_desc_topografia_dor(nr_seq_topografia),1,60) ds_topografia,
			dt_instalacao
	from	  atend_pac_dispositivo
		where   nr_atendimento       = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
		and     nr_seq_dispositivo   = nr_seq_dispositivo_p
		and     (dt_instalacao IS NOT NULL AND dt_instalacao::text <> '')
		and     coalesce(dt_retirada::text, '') = ''
		order by
			dt_instalacao;

	c_nutricao CURSOR FOR
	SELECT  ds_tooltip ds_ie_tipo_dieta,
			ds_tooltip,
			nr_seq_cpoe,
			ie_tipo_dieta,
			cd_um_dose_adm,
			cd_unidade_medida_dose,
			cd_unid_med_prod1
	from (SELECT  apap_dinamico_pck.get_ds_tooltip_cpoe(a.nr_sequencia) ds_tooltip,
				  a.nr_sequencia nr_seq_cpoe,
				  a.ie_tipo_dieta,
				  ( select  max(c.cd_um_dose_adm)
					from    prescr_mat_alteracao c,
							prescr_mat_hor x,
							prescr_material y
					where   x.nr_prescricao = y.nr_prescricao
					and     x.nr_seq_material = y.nr_sequencia
					and     a.nr_sequencia = y.nr_seq_mat_cpoe
					and     c.nr_seq_horario = x.nr_sequencia
					and     c.ie_alteracao = 3
					and     coalesce(c.ie_evento_valido, 'S') = 'S'
					
union

					select  max(c.cd_um_dose_adm)
					from    prescr_mat_alteracao c,
							prescr_dieta_hor x,
							prescr_dieta y
					where   x.nr_prescricao = y.nr_prescricao
					and     x.nr_seq_dieta = y.nr_sequencia
					and     a.nr_sequencia = y.nr_seq_dieta_cpoe
					and     c.nr_seq_horario_dieta = x.nr_sequencia
					and     c.ie_alteracao = 3
					and     coalesce(c.ie_evento_valido, 'S') = 'S'
				  ) cd_um_dose_adm,
				  cd_unidade_medida_dose,
				  cd_unid_med_prod1
		from      cpoe_dieta a
		where     cd_pessoa_fisica = current_setting('apap_dinamico_pck.cd_pessoa_fisica_w')::pessoa_fisica.cd_pessoa_fisica%type
		and       cpoe_reg_valido_ativacao(CASE WHEN coalesce(dt_lib_suspensao::text, '') = '' THEN  dt_fim  ELSE coalesce(dt_suspensao,dt_fim) END , dt_inicio, current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp, null ,   current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,   ie_retrogrado, dt_liberacao   , 'N', ie_futuro, dt_liberacao_fut   ) = 'S'
		and (cpoe_funcao_prescr_liberada(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type, nm_usuario_nrec) = 'S' or cd_medico = cd_pf_usuario_w
		and (cd_funcao_origem in (998, 440)))
		and (nr_atendimento = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type or (coalesce(nr_atendimento::text, '') = '' and	coalesce(dt_liberacao_fut::text, '') = '' and	ie_futuro = 'S'))
		and       ((dt_liberacao IS NOT NULL AND dt_liberacao::text <> '') or (nm_usuario = current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type) or  ((cd_medico = cd_pf_usuario_w)
		and       ((dt_liberacao_aux IS NOT NULL AND dt_liberacao_aux::text <> '') or (cd_funcao_origem in (998, 440)))) or ((dt_liberacao_aux IS NOT NULL AND dt_liberacao_aux::text <> '')
		and       cpoe_verifica_regra_aprovacao(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type, current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type, 'AX') = 'S'))
		and       cpoe_visualizar_itens_cururgia( current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type, nr_sequencia, 'N', nr_atendimento) = 'S'
	order by
			cpoe_obter_ordem_subgrupo('N',ie_tipo_dieta,current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type,current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,obter_setor_ativo, current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type),
			1
  ) alias43;

  c_medicamento_solucao CURSOR FOR
	SELECT  ds_material,
			ds_tooltip,
			nr_seq_apresent_item,
			nr_seq_apresent_subgrupo,
			nr_seq_apresent_acm_sn,
			nr_seq_cpoe,
			ie_controle_tempo,
			nr_seq_dispositivo,
			ie_bomba_infusao,
			cd_um_dose_adm,
			cd_unidade_medida,
      cd_material
	from    (SELECT	substr(cpoe_obter_desc_info_material(	cd_material,
														  cd_mat_comp1,
														  qt_dose_comp1,
														  cd_unid_med_dose_comp1,
														  cd_mat_comp2,
														  qt_dose_comp2,
														  cd_unid_med_dose_comp2,
														  cd_mat_comp3,
														  qt_dose_comp3,
														  cd_unid_med_dose_comp3,
														  cd_mat_dil,
														  qt_dose_dil,
														  cd_unid_med_dose_dil,
														  cd_mat_red,
														  qt_dose_red,
														  cd_unid_med_dose_red,
														  dt_liberacao,
														  qt_dose,
														  cd_unidade_medida,
														  ie_via_aplicacao,
														  cd_intervalo,
														  dt_lib_suspensao,
														  dt_suspensao,
														  ie_administracao,
														  nr_seq_ataque,
														  nr_seq_procedimento,
														  nr_seq_adicional,
														  nr_seq_hemoterapia,
														  ds_dose_diferenciada,
														  ds_dose_diferenciada_dil,
														  ds_dose_diferenciada_red,
														  ds_dose_diferenciada_comp1,
														  ds_dose_diferenciada_comp2,
														  ds_dose_diferenciada_comp3,
														  cd_mat_comp4,
														  qt_dose_comp4,
														  cd_unid_med_dose_comp4,
														  ds_dose_diferenciada_comp4,
														  cd_mat_comp5,
														  qt_dose_comp5,
														  cd_unid_med_dose_comp5,
														  ds_dose_diferenciada_comp5,
														  cd_mat_comp6,
														  qt_dose_comp6,
														  cd_unid_med_dose_comp6,
														  ds_dose_diferenciada_comp6,
														  dt_inicio,
														  dt_fim,
														  dt_fim_cih,
														  nr_dia_util,
														  ie_antibiotico,
														  ie_tipo_solucao,
														  cd_mat_comp7,
														  qt_dose_comp7,
														  cd_unid_med_dose_comp7,
														  ds_dose_diferenciada_comp7,
														  null,
														  cd_mat_recons,
														  qt_dose_recons,
														  cd_unid_med_dose_recons,
														  ds_dose_diferenciada_rec,
														  ds_solucao,
														  ie_duracao,
														  ie_ref_calculo,
														  nr_etapas,
														  ie_controle_tempo,
														  qt_dias_solicitado,
														  qt_dias_liberado,
														  nr_atendimento,
														  ie_baixado_por_alta,
														  dt_alta_medico,
														  substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),
														  'N',
														  nr_sequencia,
														  obter_horarios_regra(ds_horarios),
														  cpoe_obter_tipo_item('CPOE_MATERIAL',nr_sequencia, null, ie_controle_tempo, ie_material),
														  ie_reset_atb,
														  nr_seq_cpoe_anterior,
														  ds_calc_therap_dose,
														  null,
														  qt_final_concentration,
														  ie_um_final_conc_pca,
														  qt_dose_range_min,
														  qt_dose_range_max,
														  ie_dose_range,
														  ds_medic_nao_padrao,
														  ie_medicacao_paciente,
														  'S'),1,2000) ds_tooltip,
					cpoe_obter_ordem_mat_sol(cd_material,ie_controle_tempo,ie_tipo_solucao,ie_via_aplicacao,current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type,current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,obter_setor_usuario(current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type),current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type,null,cd_mat_comp1,cd_mat_comp2,cd_mat_comp3,cd_mat_comp4,cd_mat_comp5,cd_mat_comp6,cd_mat_comp7) nr_seq_apresent_item,
					cpoe_obter_ordem_subgrupo('M',CASE WHEN coalesce(ie_controle_tempo,'N')='N' THEN 'M'  ELSE 'SOL' END ,current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type,current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,obter_setor_ativo,current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type,'C') nr_seq_apresent_subgrupo,
					cpoe_obter_posicao_acm(ie_administracao,current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type,current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,obter_setor_ativo,current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type,'M') nr_seq_apresent_acm_sn,
					nr_sequencia nr_seq_cpoe,
					a.ie_controle_tempo,
					(	select  max(x.nr_seq_dispositivo)
					  from    prescr_solucao x,
							  prescr_material y
					  where   x.nr_prescricao = y.nr_prescricao
					  and     x.nr_seq_solucao = y.nr_sequencia_solucao
					  and     a.nr_sequencia = y.nr_seq_mat_cpoe
					) nr_seq_dispositivo,
					( select	max(x.ie_bomba_infusao)
					  from    prescr_solucao x,
							  prescr_material y
					  where   x.nr_prescricao = y.nr_prescricao
					  and     x.nr_seq_solucao = y.nr_sequencia_solucao
					  and     a.nr_sequencia = y.nr_seq_mat_cpoe
					) ie_bomba_infusao,
					( select  max(c.cd_um_dose_adm)
					  from    prescr_mat_alteracao c,
							  prescr_mat_hor x,
							  prescr_material y
					  where   x.nr_prescricao = y.nr_prescricao
					  and     x.nr_seq_material = y.nr_sequencia
					  and     a.nr_sequencia = y.nr_seq_mat_cpoe
					  and     c.nr_seq_horario = x.nr_sequencia
					  and     c.ie_alteracao = 3
					  and     coalesce(c.ie_evento_valido, 'S') = 'S'
					) cd_um_dose_adm,
					cd_unidade_medida,
                    substr(apap_obter_desc_info_material(a.cd_material,a.ds_medic_nao_padrao),1,2000) ds_material,
          a.cd_material
		  from      cpoe_material a
		  where     cd_pessoa_fisica = current_setting('apap_dinamico_pck.cd_pessoa_fisica_w')::pessoa_fisica.cd_pessoa_fisica%type
		  and       cpoe_reg_valido_ativacao(CASE WHEN coalesce(dt_lib_suspensao::text, '') = '' THEN coalesce(dt_fim_cih,dt_fim)  ELSE coalesce(dt_suspensao,dt_fim) END ,dt_inicio,current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp,cd_funcao_origem,current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,ie_retrogrado,dt_liberacao,'N',ie_futuro,dt_liberacao_fut) = 'S'
		  and (cpoe_funcao_prescr_liberada(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,nm_usuario_nrec) = 'S' or cd_medico = cd_pf_usuario_w
		  and (cd_funcao_origem in (998,440)))
		  and (nr_atendimento = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
					or (coalesce(nr_atendimento::text, '') = ''
						and coalesce(dt_liberacao_fut::text, '') = ''
						and ie_futuro = 'S'))
		  and       ((dt_liberacao IS NOT NULL AND dt_liberacao::text <> '') or (nm_usuario = current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type) or  ((cd_medico = cd_pf_usuario_w)
		  and       ((dt_liberacao_aux IS NOT NULL AND dt_liberacao_aux::text <> '') or (cd_funcao_origem in (998, 440)))) or ((dt_liberacao_aux IS NOT NULL AND dt_liberacao_aux::text <> '')
		  and       cpoe_verifica_regra_aprovacao(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type, 'AX') = 'S') or ((coalesce(dt_liberacao::text, '') = ''
		  and       (dt_liberacao_aux IS NOT NULL AND dt_liberacao_aux::text <> '')
		  and       ie_exige_ciencia = 'V')
		  and       cpoe_verifica_regra_aprovacao(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type,current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type,'CA') = 'S'))
		  and       cpoe_visualizar_itens_cururgia(current_setting('apap_dinamico_pck.cd_perfil_w')::perfil.cd_perfil%type, nr_sequencia,'M',nr_atendimento) = 'S'
		  and       coalesce(ie_material,'N') = 'N'
		  and       (not ((dt_lib_suspensao IS NOT NULL AND dt_lib_suspensao::text <> '') and (dt_suspensao IS NOT NULL AND dt_suspensao::text <> '') and (dt_suspensao <= clock_timestamp())))
		  order by
				  dt_lib_suspensao desc,
				  nr_seq_apresent_acm_sn,
				  nr_seq_apresent_subgrupo,
				  nr_seq_apresent_item,
				  2,
				  nr_sequencia desc
		) alias78;

  c_bundles CURSOR FOR
	SELECT	a.nr_sequencia,
			a.ds_nome_protocolo
	FROM    gqa_protocolo_pac a
	WHERE   a.cd_pessoa_fisica = current_setting('apap_dinamico_pck.cd_pessoa_fisica_w')::pessoa_fisica.cd_pessoa_fisica%type
	AND (a.nm_usuario = current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type OR (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> ''))
	AND     a.ie_situacao = 'A'
	and     ((coalesce(dt_termino,current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp) between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp) or (coalesce(a.dt_liberacao, a.dt_atualizacao_nrec) between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp))
	ORDER BY
			a.dt_atualizacao_nrec desc;

  c_etapa_bundles CURSOR(nr_seq_prot_pac_gqa_p  bigint) FOR
	SELECT  a.ds_nome_etapa,
			a.dt_inicio,
			a.nr_sequencia
	from    gqa_protocolo_etapa_pac a,
			gqa_protocolo_pac b
	where   a.nr_seq_prot_pac = b.nr_sequencia
	and     a.nr_seq_prot_pac = nr_seq_prot_pac_gqa_p
	order by
			obter_dependencia_etapa(b.nr_seq_protocolo, a.nr_seq_etapa, 'O');

  -- Diagnosticos       
  c_cp_diagnostico CURSOR(nr_seq_diagnostico_p  bigint) FOR
	SELECT 	pd.nr_sequencia nr_seq_diagnostico,
			pd.nr_sequencia nr_sequencia,
			pd.ds_diagnostico as ds_titulo_linha
	from 	  pe_diagnostico pd
	where   pd.nr_sequencia = nr_seq_diagnostico_p;
	
  -- Intervencoes
  c_cp_intervencoes CURSOR(nr_seq_diagnostico_p  bigint) FOR
	SELECT 	distinct coalesce(proc.ds_display_name,substr(obter_desc_intervencoes(proc.nr_seq_proc),1,255)) as ds_titulo_linha,  
			ci.nr_sequencia as nr_seq_cp_interv,
			proc.nr_seq_proc
	from    pe_prescr_proc proc, 
			pe_prescr_diag ppd,
			patient_cp_intervention pci,
			pe_prescricao pe,
			cp_intervention ci
	where   ppd.nr_seq_prescr = pe.nr_sequencia
	and     ppd.nr_seq_diag   = nr_seq_diagnostico_p
	and     pe.nr_atendimento = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
	and     pe.dt_prescricao between trunc(current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp, 'dd') and current_setting('apap_dinamico_pck.dt_final_w')::timestamp
	and     proc.nr_seq_prescr = pe.nr_sequencia
	and     ppd.nr_sequencia = pci.nr_seq_prescr_diag
	and     ci.nr_sequencia = pci.nr_seq_cp_intervention
	and     coalesce(pe.dt_suspensao::text, '') = ''
	and     pe.ie_situacao = 'A'
	and     ((pci.nr_sequencia = proc.nr_seq_pat_cp_interv and coalesce(proc.ie_related_problem::text, '') = '') or (proc.ie_related_problem = ppd.nr_sequencia));

  -- Indicadores
  c_cp_indicadores CURSOR(nr_seq_diagnostico_p  bigint) FOR
	SELECT 	i.ds_display_name as ds_titulo_linha,
			max(pci.nr_sequencia) nr_sequencia
	from    pe_diagnostico pd,
			pe_prescr_diag ppd,
			cp_goal c,
			patient_cp_goal a,
			cp_indicator i,
			patient_cp_indicator pci,
			pe_prescricao pe       
	where   pd.nr_sequencia = ppd.nr_seq_diag          
	and     ppd.nr_seq_prescr = pe.nr_sequencia
	and     ppd.nr_seq_diag = nr_seq_diagnostico_p
	and     pe.nr_atendimento = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
	and     pe.dt_prescricao between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp  
	and     a.nr_seq_cp_goal = c.nr_sequencia
	and     ppd.nr_sequencia = a.nr_seq_prescr_diag
	and     pci.nr_seq_pat_cp_goal = a.nr_sequencia
	and     pci.nr_seq_cp_indicator = i.nr_sequencia
	and     coalesce(pe.dt_suspensao::text, '') = ''
	and     pe.ie_situacao = 'A'
	group by
			i.ds_display_name;

  c_dispositivos CURSOR FOR
	SELECT  substr(b.ds_dispositivo,1,80) DS_DISPOSITIVO,
			substr(obter_desc_topografia_dor(a.nr_seq_topografia),1,60) DS_TOPOGRAFIA,
			substr(obter_valor_dominio(1372,a.ie_lado),1,10) ds_lado,
			substr(obter_calibre(a.nr_seq_calibre),1,100) DS_CALIBRE,
			a.nr_sequencia,
			obter_complem_adicional(a.nr_seq_complemento) ds_complemento,
			pkg_date_formaters.to_varchar(a.dt_instalacao, 'timestamp', current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type) dt_instalacao,
			pkg_date_formaters.to_varchar(a.dt_retirada_prev, 'timestamp', current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('apap_dinamico_pck.nm_usuario_w')::usuario.nm_usuario%type) dt_retirada_prev
	from    atend_pac_dispositivo a,
			dispositivo b
	where   a.nr_seq_dispositivo = b.nr_sequencia
	and		  a.nr_atendimento = current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type
	and		  ((a.dt_instalacao between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp) or (coalesce(a.dt_retirada,current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp) between current_setting('apap_dinamico_pck.dt_inicial_w')::timestamp and current_setting('apap_dinamico_pck.dt_final_w')::timestamp))
	ORDER BY
			b.nr_seq_apres DESC,
			b.ds_dispositivo DESC,
			a.dt_instalacao desc;

	
BEGIN
	CALL apap_dinamico_pck.limpa_dados();
	PERFORM set_config('apap_dinamico_pck.cd_estabelecimento_w', wheb_usuario_pck.get_cd_estabelecimento, false);
	PERFORM set_config('apap_dinamico_pck.nm_usuario_w', wheb_usuario_pck.get_nm_usuario, false);
	PERFORM set_config('apap_dinamico_pck.cd_perfil_w', wheb_usuario_pck.get_cd_perfil, false);
	PERFORM set_config('apap_dinamico_pck.nr_seq_documento_w', nr_seq_documento_p, false);
	PERFORM set_config('apap_dinamico_pck.nr_atendimento_w', nr_atendimento_p, false);
	PERFORM set_config('apap_dinamico_pck.cd_pessoa_fisica_w', cd_pessoa_fisica_p, false);
	PERFORM set_config('apap_dinamico_pck.dt_inicial_w', trunc(dt_inicial_p,'hh24'), false);
	PERFORM set_config('apap_dinamico_pck.dt_final_w', dt_final_p + 2/24, false);
	PERFORM set_config('apap_dinamico_pck.cd_setor_atendimento_w', cd_setor_atendimento_p, false);
	PERFORM set_config('apap_dinamico_pck.gap_w', gap_p, false);
	obter_param_usuario(1355, 19, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, param_inter_colors_w);
	begin
	ds_unid_med_w  := substr(obter_desc_unidade_medida(obter_unid_med_usua('ml')),1,40);

	select	to_date(to_char(clock_timestamp(),'dd/mm/yyyy') || ' ' || coalesce(max(to_char(hr_inicio_apap,'hh24:mi:ss')),'06:00:01'),'dd/mm/yyyy hh24:mi:ss'),
			  coalesce(max(ie_glicemia_confirmada),'N')
	into STRICT     current_setting('apap_dinamico_pck.hr_inicio_apap_w')::timestamp,
			  current_setting('apap_dinamico_pck.ie_glicemia_confirmada_w')::parametro_medico.ie_glicemia_confirmada%type
	from	   	parametro_medico
	where	cd_estabelecimento = current_setting('apap_dinamico_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type;
	
	current_setting('apap_dinamico_pck.apap_v_w')::apap_t.extend();
	nr_indice_apap_w := current_setting('apap_dinamico_pck.apap_v_w')::apap_t.count;
	current_setting('apap_dinamico_pck.apap_v_w')::apap_t[nr_indice_apap_w].cd_pessoa_fisica  := current_setting('apap_dinamico_pck.cd_pessoa_fisica_w')::pessoa_fisica.cd_pessoa_fisica%type;
	current_setting('apap_dinamico_pck.apap_v_w')::apap_t[nr_indice_apap_w].nr_atendimento    := current_setting('apap_dinamico_pck.nr_atendimento_w')::atendimento_paciente.nr_atendimento%type;
	current_setting('apap_dinamico_pck.apap_v_w')::apap_t[nr_indice_apap_w].nr_seq_documento  := current_setting('apap_dinamico_pck.nr_seq_documento_w')::documento.nr_sequencia%type;
	current_setting('apap_dinamico_pck.apap_v_w')::apap_t[nr_indice_apap_w].nr_sequencia      := nr_indice_apap_w;

	<<read_grupo>>
	for r_grupo in c_grupo
	loop
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t.extend();
	  nr_indice_grupo_w := current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t.count;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_sequencia           	:= nr_indice_grupo_w;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_mod_apap        	:= nr_indice_apap_w;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].ds_grupo_informacao    	:= r_grupo.ds_titulo;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_apresentacao    	:= r_grupo.nr_seq_apresentacao;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].ie_padrao_visivel      	:= r_grupo.ie_padrao_visivel;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_escala_minima_esq   	:= r_grupo.nr_escala_minima_esq;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_escala_maxima_esq   	:= r_grupo.nr_escala_maxima_esq;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_linked_data     	:= r_grupo.nr_seq_linked_data;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_documento_secao 	:= r_grupo.nr_seq_documento_secao;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].ie_tipo 			   	:= r_grupo.ie_tipo;		
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_template			:= r_grupo.nr_seq_template;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].cd_funcao_add_new		:= r_grupo.cd_funcao_add_new;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].nr_seq_item_pront		:= r_grupo.nr_seq_item_pront;
	  current_setting('apap_dinamico_pck.grupo_apap_v_w')::grupo_apap_t[nr_indice_grupo_w].ie_tipo_acesso			:= r_grupo.ie_tipo_acesso;

	  <<read_linha>>
	  for r_linha in c_linha(r_grupo.nr_seq_documento_secao)
	  loop
		gera_dados_array(r_linha.ie_informacao);

		if (r_linha.nr_seq_tipo_pg IS NOT NULL AND r_linha.nr_seq_tipo_pg::text <> '') then
		  ie_possui_w          := 'N';
		  <<read_linha_ganho_perda>>
		  for r_linha_ganho_perda in c_linha_ganho_perda(r_linha.nr_seq_tipo_pg,r_grupo.ie_mostra_disp)
		  loop
			ie_possui_w          := 'S';
			nr_seq_dispositivo_w := null;
			nr_seq_atend_disp_w  := null;

			if (r_grupo.ie_mostra_disp = 'S') and (r_linha_ganho_perda.nr_seq_dispositivo IS NOT NULL AND r_linha_ganho_perda.nr_seq_dispositivo::text <> '') and (r_linha_ganho_perda.nr_seq_atend_disp IS NOT NULL AND r_linha_ganho_perda.nr_seq_atend_disp::text <> '') then
			  nr_seq_dispositivo_w := r_linha_ganho_perda.nr_seq_dispositivo;
			  ds_titulo_linha_w    := r_linha_ganho_perda.ds_disp_gp;
			  if (r_linha_ganho_perda.ds_complemento_disp IS NOT NULL AND r_linha_ganho_perda.ds_complemento_disp::text <> '') then
				ds_titulo_linha_w    := substr(ds_titulo_linha_w ||' - '||r_linha_ganho_perda.ds_complemento_disp,1,2000);
				nr_seq_atend_disp_w  := r_linha_ganho_perda.nr_seq_atend_disp;
			  end if;
			else
			  ds_titulo_linha_w := substr(r_linha_ganho_perda.ds_tipo ||' ('||r_linha_ganho_perda.ds_grupo||')',1,2000);
			end if;

			if (r_linha_ganho_perda.nr_seq_topografia IS NOT NULL AND r_linha_ganho_perda.nr_seq_topografia::text <> '') and (r_linha_ganho_perda.ie_exibir_topografia <> 'N') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w ||' - '||r_linha_ganho_perda.ds_topografia,1,2000);
			end if;

			if (r_linha_ganho_perda.ie_lado IS NOT NULL AND r_linha_ganho_perda.ie_lado::text <> '') and (r_linha_ganho_perda.ie_exibir_lado <> 'N') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w ||' - '||r_linha_ganho_perda.ds_lado,1,2000);
			end if;
			
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w        							   := r_linha.ds_title;
			end if;

			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.extend();
			nr_indice_linha_w := current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.count;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_sequencia           := nr_indice_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_apap_grupo      := nr_indice_grupo_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_informacao          := ds_titulo_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_tabela              := r_linha.nm_tabela;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_apap       := upper(substr('ID_'||r_linha.nr_seq_tipo_pg||r_linha_ganho_perda.nr_seq_topografia||r_linha_ganho_perda.ie_lado,1,30));
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_tabela     := r_linha.nm_atributo_tabela;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_linked     := r_linha.nm_atributo_linked;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_unico      := upper(substr(r_linha.nm_id||'_'||r_linha.nr_seq_tipo_pg||'_'||r_linha_ganho_perda.nr_seq_topografia||'_'||r_linha_ganho_perda.ie_lado,1,50));
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_grupo_pg        := r_linha.nr_seq_grupo_pg;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_tipo_pg         := r_linha.nr_seq_tipo_pg;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_topografia      := r_linha_ganho_perda.nr_seq_topografia;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_lado                := r_linha_ganho_perda.ie_lado;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_apresentacao    := r_linha.nr_seq_apresentacao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_unid_med            := substr(r_linha.ds_inf_adic,1,40);
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_informacao          := r_linha.ie_informacao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_sql                 := r_linha.ds_sql;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_doc_subsecao    := r_linha.nr_sequencia;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_plot_style          := r_linha.ie_plot_style;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_symbol              := r_linha.ie_symbol;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_color               := r_linha.ds_color;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_minima       := r_linha.nr_escala_minima;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_maxima       := r_linha.nr_escala_maxima;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_visao           := r_linha.nr_seq_visao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_ordem_composto      := r_linha.nr_ordem_composto;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_dispositivo     := nr_seq_dispositivo_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_atend_disp      := nr_seq_atend_disp_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			if (r_linha.nm_atributo_tabela = 'QT_VOLUME') then
			  current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_unid_med_col     := 'ml';
			end if;
		  end loop read_linha_ganho_perda;

		  if (ie_possui_w = 'N') then
			ds_grupo_gp_w := r_linha.ds_grupo_pg;

			if (r_linha.nr_seq_tipo_pg IS NOT NULL AND r_linha.nr_seq_tipo_pg::text <> '') and (coalesce(r_linha.ds_grupo_pg::text, '') = '') then	
			  select	max(ds_grupo)
			  into STRICT	  ds_grupo_gp_w
			  from	  grupo_perda_ganho a,
					  tipo_perda_ganho b
			  where	  a.nr_sequencia = b.nr_seq_grupo
			  and		  b.nr_sequencia = r_linha.nr_seq_tipo_pg;
			end if;
			
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w        							   := r_linha.ds_title;
			else
				ds_titulo_linha_w        							   := r_linha.ds_tipo_pg ||' ('||ds_grupo_gp_w||')';
			end if;

			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.extend();
			nr_indice_linha_w := current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.count;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_sequencia           := nr_indice_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_apap_grupo      := nr_indice_grupo_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_informacao          := ds_titulo_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_tabela              := r_linha.nm_tabela;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_apap       := upper(substr('ID_'||r_linha.nr_seq_tipo_pg,1,30));
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_tabela     := r_linha.nm_atributo_tabela;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_linked     := r_linha.nm_atributo_linked;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atributo_unico      := upper(substr(r_linha.nm_id||'_'||r_linha.nr_seq_tipo_pg,1,50));
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_grupo_pg        := r_linha.nr_seq_grupo_pg;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_tipo_pg         := r_linha.nr_seq_tipo_pg;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_topografia      := null;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_lado                := null;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_apresentacao    := r_linha.nr_seq_apresentacao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_unid_med            := substr(r_linha.ds_inf_adic,1,40);
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_informacao          := r_linha.ie_informacao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_sql                 := r_linha.ds_sql;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_doc_subsecao    := r_linha.nr_sequencia;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_plot_style          := r_linha.ie_plot_style;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_symbol              := r_linha.ie_symbol;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_color               := r_linha.ds_color;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_minima       := r_linha.nr_escala_minima;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_maxima       := r_linha.nr_escala_maxima;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_visao           := r_linha.nr_seq_visao;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_ordem_composto      := r_linha.nr_ordem_composto;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_dispositivo     := nr_seq_dispositivo_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_atend_disp      := nr_seq_atend_disp_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			if (r_linha.nm_atributo_tabela = 'QT_VOLUME') then
			  current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].ds_unid_med_col     := 'ml';--obter_desc_expressao(489756);
			end if;
		  end if;
		elsif (r_linha.ie_informacao = 'DISP') then
		  <<dispositivos>>
		  for r_dispositivos in c_dispositivos
		  loop
			ds_titulo_linha_w := substr(r_dispositivos.ds_dispositivo,1,2000);
			if (r_dispositivos.ds_complemento IS NOT NULL AND r_dispositivos.ds_complemento::text <> '') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w||' ('||r_dispositivos.ds_complemento||')',1,2000);
			end if;	
			if (r_dispositivos.ds_topografia IS NOT NULL AND r_dispositivos.ds_topografia::text <> '') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w||' - '||obter_desc_expressao(300156)||': '||r_dispositivos.ds_topografia,1,2000);
			end if;	
			if (r_dispositivos.ds_lado IS NOT NULL AND r_dispositivos.ds_lado::text <> '') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w||' - '||obter_desc_expressao(292416)||': '||r_dispositivos.ds_lado,1,2000);
			end if;
			if (r_dispositivos.ds_calibre IS NOT NULL AND r_dispositivos.ds_calibre::text <> '') then
			  ds_titulo_linha_w := substr(ds_titulo_linha_w||' - '||obter_desc_expressao(284472)||': '||r_dispositivos.ds_calibre,1,2000);
			end if;

			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w := r_linha.ds_title;
			end if;

			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.extend();
			nr_indice_linha_w 	:= current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t.count;
			nr_indice_sup_w		:= nr_indice_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_sequencia        	:= nr_indice_linha_w;
			current_setting('apap_dinamico_pck.linha_apap_v_w')::linha_apap_t[nr_indice_linha_w].nr_seq_apap_grupo   	:= nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao       	:= ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].ds_tooltip            := ds_titulo_linha_w || '<br/>' ||
																	  obter_desc_expressao(287008)||': </b>'||r_dispositivos.dt_instalacao || '<br/>' ||
																	  obter_desc_expressao(698843)||': </b>'||r_dispositivos.dt_retirada_prev;
			linha_apap_v_w[nr_indice_linha_w].nm_tabela             := r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    	:= upper(substr('ID_'||r_dispositivos.nr_sequencia||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  	:= r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  	:= r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico     := upper(substr(r_linha.nm_id||'_'||r_dispositivos.nr_sequencia,1,50));
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao 	:= nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_disp_pac		:= r_dispositivos.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao       	:= r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_sql              	:= r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao 	:= r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel            := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style       	:= r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol           	:= r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color            	:= r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    	:= r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    	:= r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        	:= r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   	:= r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  	:= r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     	:= null;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
		  end loop dispositivos;
		elsif (r_linha.ie_informacao = 'CP') then
		  <<diagnostico>>
		  for r_cp_diagnostico in  c_cp_diagnostico(r_linha.nr_seq_diagnostico)
		  loop
		  
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w        							   := r_linha.ds_title;
			else
				ds_titulo_linha_w        							   := r_cp_diagnostico.ds_titulo_linha;			
			end if;

			count_w := count_w + 1;
			linha_apap_v_w.extend();
			nr_indice_linha_w                                          := linha_apap_v_w.count;
			nr_indice_sup_w                                            := nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_sequencia             := nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo        := nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao            := ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nm_tabela                := r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap         := upper(substr('ID_'||r_cp_diagnostico.nr_sequencia||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela       := r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked       := r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico        := upper(substr(r_linha.nm_id||'_'||r_cp_diagnostico.nr_sequencia,1,50));
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao      := count_w;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao            := r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_sql                   := r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao   := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao      := r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel               := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style            := r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol                := r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color                 := r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima         := r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima         := r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao             := r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto        := r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data       := r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_superior          := null;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto      := r_linha.ds_formato_composto;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only             := r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend                 := r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width                 := r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf         := r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		            := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		            := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		    := r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		    := r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded 	:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		    := r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		    := r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].ie_tipo_informacao	    := 'D';
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo      	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis				:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico				:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup					:= r_linha.ds_lookup;
			<<intervencoes>>
			for r_cp_intervencoes in c_cp_intervencoes(r_cp_diagnostico.nr_sequencia)
			loop
			  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w := r_linha.ds_title;
			  else
				ds_titulo_linha_w := r_cp_intervencoes.ds_titulo_linha;
			  end if;
			  count_w := count_w + 1;
			  linha_apap_v_w.extend();
			  nr_indice_linha_w 	                                     := linha_apap_v_w.count;
			  linha_apap_v_w[nr_indice_linha_w].nr_sequencia        	 := nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   	 := nr_indice_grupo_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_informacao       	 := ds_titulo_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nm_tabela           	 := r_linha.nm_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    	 := upper(substr('ID_'||r_cp_intervencoes.nr_seq_cp_interv||r_linha.ie_informacao||r_cp_intervencoes.nr_seq_proc,1,30));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_diagnostico     := r_linha.nr_seq_diagnostico;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  	 := r_linha.nm_atributo_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  	 := r_linha.nm_atributo_linked;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico        := upper(substr(r_linha.nm_id||'_'||r_cp_intervencoes.nr_seq_cp_interv||'_'||r_cp_intervencoes.nr_seq_proc,1,50));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao 	 := 1;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_intervention	  := r_cp_intervencoes.nr_seq_proc;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_cp_indicator	   := null;
			  linha_apap_v_w[nr_indice_linha_w].ie_informacao          := r_linha.ie_informacao;
			  linha_apap_v_w[nr_indice_linha_w].ds_sql                 := r_linha.ds_sql;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao 	 := r_linha.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_style       	 := r_linha.ie_plot_style;
			  linha_apap_v_w[nr_indice_linha_w].ie_symbol           	 := r_linha.ie_symbol;
			  linha_apap_v_w[nr_indice_linha_w].ds_color            	 := r_linha.ds_color;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    	 := r_linha.nr_escala_minima;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    	 := r_linha.nr_escala_maxima;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        	 := r_linha.nr_seq_visao;
			  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   	 := count_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  	 := r_linha.nr_seq_linked_data;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     	 := nr_indice_sup_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	 := r_linha.ds_formato_composto;
			  linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			  linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			  linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			  linha_apap_v_w[nr_indice_linha_w].ie_tipo_informacao	   	:= 'I';
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;	
			  linha_apap_v_w[nr_indice_linha_w].ie_grafico				:= r_linha.ie_grafico;	
			  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;	
			end loop intervencoes;

			<<indicadores>>
			for r_cp_indicadores in c_cp_indicadores(r_cp_diagnostico.nr_sequencia)
			loop
			  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w := r_linha.ds_title;
			  else
				ds_titulo_linha_w := r_cp_indicadores.ds_titulo_linha;
			  end if;
			  count_w := count_w + 1;
			  linha_apap_v_w.extend();
			  nr_indice_linha_w 	                                     := linha_apap_v_w.count;
			  linha_apap_v_w[nr_indice_linha_w].nr_sequencia        	 := nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   	 := nr_indice_grupo_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_informacao       	 := ds_titulo_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nm_tabela           	 := r_linha.nm_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    	 := upper(substr('ID_'||r_cp_indicadores.nr_sequencia||r_linha.ie_informacao,1,30));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_diagnostico     := r_linha.nr_seq_diagnostico;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  	 := r_linha.nm_atributo_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  	 := r_linha.nm_atributo_linked;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico        := upper(substr(r_linha.nm_id||'_'||r_cp_indicadores.nr_sequencia,1,50));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao 	 := 1;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_cp_indicator	   := r_cp_indicadores.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_intervention	   := null;
			  linha_apap_v_w[nr_indice_linha_w].ie_informacao          := r_linha.ie_informacao;
			  linha_apap_v_w[nr_indice_linha_w].ds_sql                 := r_linha.ds_sql;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao 	 := r_linha.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_style       	 := r_linha.ie_plot_style;
			  linha_apap_v_w[nr_indice_linha_w].ie_symbol           	 := r_linha.ie_symbol;
			  linha_apap_v_w[nr_indice_linha_w].ds_color            	 := r_linha.ds_color;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    	 := r_linha.nr_escala_minima;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    	 := r_linha.nr_escala_maxima;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        	 := r_linha.nr_seq_visao;
			  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   	 := count_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  	 := r_linha.nr_seq_linked_data;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     	 := nr_indice_sup_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	 := r_linha.ds_formato_composto;
			  linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			  linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			  linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			  linha_apap_v_w[nr_indice_linha_w].ie_tipo_informacao	   	:= 'M';
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			  linha_apap_v_w[nr_indice_linha_w].ie_grafico				:= r_linha.ie_grafico;
			  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			end loop indicadores;
		  end loop diagnostico;
		elsif (r_linha.ie_informacao = 'CB') then
		  <<bundle>>
		  for r_bundles in c_bundles
		  loop
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w := r_linha.ds_title;
			else
			  ds_titulo_linha_w := r_bundles.ds_nome_protocolo;
			end if;
			linha_apap_v_w.extend();
			nr_indice_linha_w 	:= linha_apap_v_w.count;
			nr_indice_sup_w		:= nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_sequencia        	:= nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   	:= nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao       	:= ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nm_tabela           	:= r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    	:= upper(substr('ID_'||r_bundles.nr_sequencia||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  	:= r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  	:= r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico     := upper(substr(r_linha.nm_id||'_'||r_bundles.nr_sequencia,1,50));
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao 	:= nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_gqa_prot_pac	:= r_bundles.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao       	:= r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_sql              	:= r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao 	:= r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel            := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style       	:= r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol           	:= r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color            	:= r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    	:= r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    	:= r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        	:= r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   	:= r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  	:= r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     	:= null;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			<<etapa_bundle>>
			for r_etapa_bundles in c_etapa_bundles(r_bundles.nr_sequencia)
			loop
			  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w := r_linha.ds_title;
			  else
				ds_titulo_linha_w := r_etapa_bundles.ds_nome_etapa;
			  end if;
			  linha_apap_v_w.extend();
			  nr_indice_linha_w := linha_apap_v_w.count;
			  linha_apap_v_w[nr_indice_linha_w].nr_sequencia        		:= nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   		:= nr_indice_grupo_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_informacao       		:= ds_titulo_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nm_tabela           		:= r_linha.nm_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    		:= upper(substr('ID_'||r_bundles.nr_sequencia||'_'||r_etapa_bundles.nr_sequencia||'_'||r_linha.ie_informacao,1,30));
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  		:= r_linha.nm_atributo_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  		:= r_linha.nm_atributo_linked;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico     		:= upper(substr(r_linha.nm_id||'_'||r_bundles.nr_sequencia||'_'||r_etapa_bundles.nr_sequencia,1,50));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao 		:= nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_gqa_prot_eta		:= r_etapa_bundles.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_informacao       		:= r_linha.ie_informacao;
			  linha_apap_v_w[nr_indice_linha_w].ds_sql              		:= r_linha.ds_sql;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao 	:= r_linha.nr_seq_documento_secao;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao 		:= r_linha.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_visivel            	:= r_linha.ie_visivel;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_style       		:= r_linha.ie_plot_style;
			  linha_apap_v_w[nr_indice_linha_w].ie_symbol           		:= r_linha.ie_symbol;
			  linha_apap_v_w[nr_indice_linha_w].ds_color            		:= r_linha.ds_color;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    		:= r_linha.nr_escala_minima;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    		:= r_linha.nr_escala_maxima;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        		:= r_linha.nr_seq_visao;
			  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   		:= nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  		:= r_linha.nr_seq_linked_data;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     		:= nr_indice_sup_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 		:= r_linha.ds_formato_composto;
			  linha_apap_v_w[nr_indice_linha_w].ie_read_only     			:= r_linha.ie_read_only;
			  linha_apap_v_w[nr_indice_linha_w].ie_trend     				:= r_linha.ie_trend;
			  linha_apap_v_w[nr_indice_linha_w].nr_width     				:= r_linha.nr_width;
			  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf			:= r_linha.nm_atrib_vl_graf;
			  linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			  linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			  linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			  linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			  linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			end loop	etapa_bundle;
		  end loop bundle;
		elsif (r_linha.ie_informacao = 'IA') then
		  <<itens_administrados>>
		  for r_itens_administrados in c_itens_administrados(  r_linha.cd_material,
																r_linha.cd_grupo_material,
																r_linha.cd_subgrupo_material,
																r_linha.cd_classe_material,
																r_linha.nr_ficha_tecnica)
		  loop
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w := r_linha.ds_title;
			else
			  ds_titulo_linha_w := r_itens_administrados.ds_material;
			end if;
			linha_apap_v_w.extend();
			nr_indice_linha_w := linha_apap_v_w.count;
			linha_apap_v_w[nr_indice_linha_w].nr_sequencia        := nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   := nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao       := ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med         := r_itens_administrados.ds_unidade_medida;
			linha_apap_v_w[nr_indice_linha_w].nm_tabela           := r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    := upper(substr('ID_'||r_itens_administrados.cd_material||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  := r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  := r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	  := upper(substr(r_linha.nm_id||'_'||r_itens_administrados.cd_material,1,50));
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao := r_linha.nr_seq_apresentacao;
			linha_apap_v_w[nr_indice_linha_w].cd_material         := r_itens_administrados.cd_material;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao       := r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_sql              := r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style       := r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol           := r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color            := r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    := r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    := r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        := r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   := r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col     := linha_apap_v_w[nr_indice_linha_w].ds_unid_med;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data  := r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
		  end loop itens_administrados;
		elsif (r_linha.ie_informacao = 'IP') then
		  <<itens_pendentes>>
		  for r_itens_pendentes in c_itens_pendentes( r_linha.cd_material,
														r_linha.cd_grupo_material,
														r_linha.cd_subgrupo_material,
														r_linha.cd_classe_material,
														r_linha.nr_ficha_tecnica)
		  loop
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w := r_linha.ds_title;
			else
			  ds_titulo_linha_w := r_itens_pendentes.ds_material;
			end if;
			linha_apap_v_w.extend();
			nr_indice_linha_w := linha_apap_v_w.count;
			linha_apap_v_w[nr_indice_linha_w].nr_sequencia        := nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   := nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao       := ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med         := r_itens_pendentes.ds_unidade_medida;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    := upper(substr('ID_'||r_itens_pendentes.cd_material||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  := r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  := r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	  := upper(substr(r_linha.nm_id||'_'||r_itens_pendentes.cd_material,1,50));
			linha_apap_v_w[nr_indice_linha_w].nm_tabela           := r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao := r_linha.nr_seq_apresentacao;
			linha_apap_v_w[nr_indice_linha_w].cd_material         := r_itens_pendentes.cd_material;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao       := r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_sql              := r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style       := r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol           := r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color            := r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    := r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    := r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        := r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   := r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col     := linha_apap_v_w[nr_indice_linha_w].ds_unid_med;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend     			:= r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
		  end loop itens_pendentes;
		elsif (r_linha.ie_informacao = 'SM') then
		  <<read_medic_solucao>>
		  for r_medicamento_solucao in c_medicamento_solucao
		  loop
			ds_dispositivo_w  := null;
			ds_topografia_w   := null;
			cd_unidade_medida_w := null;

			if (r_medicamento_solucao.ie_controle_tempo = 'S') then
			  cd_unidade_medida_w := 'ml';
			else
			  cd_unidade_medida_w := r_medicamento_solucao.cd_unidade_medida;
			end if;

			if (r_medicamento_solucao.ds_tooltip IS NOT NULL AND r_medicamento_solucao.ds_tooltip::text <> '') then
			  ds_titulo_linha_w := r_medicamento_solucao.ds_tooltip;
			  if (r_medicamento_solucao.nr_seq_dispositivo IS NOT NULL AND r_medicamento_solucao.nr_seq_dispositivo::text <> '') then
				<<read_disp_solucao>>
				for r_ult_disp_solucao in c_ult_disp_solucao(r_medicamento_solucao.nr_seq_dispositivo)
				loop
				  ds_dispositivo_w  := r_ult_disp_solucao.ds_dispositivo;
				  ds_topografia_w   := r_ult_disp_solucao.ds_topografia;
				end loop read_disp_solucao;
			  elsif (r_medicamento_solucao.ie_bomba_infusao IS NOT NULL AND r_medicamento_solucao.ie_bomba_infusao::text <> '') then
				  ds_dispositivo_w  := substr(obter_valor_dominio(1537,r_medicamento_solucao.ie_bomba_infusao),1,80);
			  end if;

			  if (ds_dispositivo_w IS NOT NULL AND ds_dispositivo_w::text <> '') then
				ds_titulo_linha_w := substr(ds_titulo_linha_w||obter_desc_expressao(288031)||': '||ds_dispositivo_w,1,2000);
				if (ds_topografia_w IS NOT NULL AND ds_topografia_w::text <> '') then
				  ds_titulo_linha_w := substr(ds_titulo_linha_w||obter_desc_expressao(300156)||' - '||ds_topografia_w,1,2000);
				end if;
			  end if;
			
			  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_informacao_w := r_linha.ds_title;
			  else
				ds_titulo_informacao_w := r_medicamento_solucao.ds_material;
			  end if;

			  linha_apap_v_w.extend();
			  nr_indice_linha_w := linha_apap_v_w.count;
			  linha_apap_v_w[nr_indice_linha_w].nr_sequencia        := nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   := nr_indice_grupo_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_informacao       := ds_titulo_informacao_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_tooltip       	:= ds_titulo_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nm_tabela           := r_linha.nm_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    := upper(substr('ID_'||r_medicamento_solucao.nr_seq_cpoe||r_linha.ie_informacao,1,30));
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  := r_linha.nm_atributo_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  := r_linha.nm_atributo_linked;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	:= upper(substr(r_linha.nm_id||'_'||r_medicamento_solucao.nr_seq_cpoe,1,50));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_cpoe         := r_medicamento_solucao.nr_seq_cpoe;
			  linha_apap_v_w[nr_indice_linha_w].ie_controle_tempo   := r_medicamento_solucao.ie_controle_tempo;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao := 1;
			  linha_apap_v_w[nr_indice_linha_w].ie_informacao       := r_linha.ie_informacao;
			  linha_apap_v_w[nr_indice_linha_w].ds_unid_med         := cd_unidade_medida_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_sql              := r_linha.ds_sql;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_style       := r_linha.ie_plot_style;
			  linha_apap_v_w[nr_indice_linha_w].ie_symbol           := r_linha.ie_symbol;
			  linha_apap_v_w[nr_indice_linha_w].ds_color            := r_linha.ds_color;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    := r_linha.nr_escala_minima;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    := r_linha.nr_escala_maxima;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        := r_linha.nr_seq_visao;
			  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   := r_linha.nr_ordem_composto;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			  linha_apap_v_w[nr_indice_linha_w].ie_read_only     	:= r_linha.ie_read_only;
			  linha_apap_v_w[nr_indice_linha_w].ie_trend			:= r_linha.ie_trend;
			  linha_apap_v_w[nr_indice_linha_w].nr_width     		:= r_linha.nr_width;
			  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf	:= r_linha.nm_atrib_vl_graf;
			  linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			  linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			  linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			  linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			  linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			  IF (param_inter_colors_w = 'S') THEN
				  linha_apap_v_w[nr_indice_linha_w].ds_icone_inter_medic 	:= OBTER_ICONE_LEGEND_INTER_MEDIC(OBTER_DOMAIN_LEGEND_INTER_MED(r_medicamento_solucao.cd_material, 'M'));
			  END IF;
			end if;
		  end loop read_medic_solucao;
		elsif (r_linha.ie_informacao = 'NUT') then
		  <<read_nutricao>>
		  for r_nutricao in c_nutricao
		  loop

			cd_unidade_medida_w := null;

			if (r_nutricao.ds_ie_tipo_dieta IS NOT NULL AND r_nutricao.ds_ie_tipo_dieta::text <> '') then
			  linha_apap_v_w.extend();
			  nr_indice_linha_w := linha_apap_v_w.count;

			  if (r_nutricao.ie_tipo_dieta in ('E', 'P', 'I')) then
				cd_unidade_medida_w := 'ml';
			  elsif (r_nutricao.ie_tipo_dieta = 'L') then
				cd_unidade_medida_w := r_nutricao.cd_unid_med_prod1;
			  else
				cd_unidade_medida_w := r_nutricao.cd_unidade_medida_dose;
			  end if;
			
			  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
				ds_titulo_linha_w := r_linha.ds_title;
			  else
				ds_titulo_linha_w := r_nutricao.ds_ie_tipo_dieta;
			  end if;

			  linha_apap_v_w[nr_indice_linha_w].nr_sequencia        := nr_indice_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   := nr_indice_grupo_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_informacao       := ds_titulo_linha_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_tooltip       	:= r_nutricao.ds_tooltip;
			  linha_apap_v_w[nr_indice_linha_w].nm_tabela           := r_linha.nm_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    := upper(substr('ID_'||r_nutricao.nr_seq_cpoe||r_linha.ie_informacao,1,30));
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  := r_linha.nm_atributo_tabela;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  := r_linha.nm_atributo_linked;
			  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	:= upper(substr(r_linha.nm_id||'_'||r_nutricao.nr_seq_cpoe,1,50));
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_cpoe         := r_nutricao.nr_seq_cpoe;
			  linha_apap_v_w[nr_indice_linha_w].ie_tipo_dieta       := r_nutricao.ie_tipo_dieta;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao := 1;
			  linha_apap_v_w[nr_indice_linha_w].ie_informacao       := r_linha.ie_informacao;
			  linha_apap_v_w[nr_indice_linha_w].ds_unid_med         := cd_unidade_medida_w;
			  linha_apap_v_w[nr_indice_linha_w].ds_sql              := r_linha.ds_sql;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
			  linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_style       := r_linha.ie_plot_style;
			  linha_apap_v_w[nr_indice_linha_w].ie_symbol           := r_linha.ie_symbol;
			  linha_apap_v_w[nr_indice_linha_w].ds_color            := r_linha.ds_color;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    := r_linha.nr_escala_minima;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    := r_linha.nr_escala_maxima;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        := r_linha.nr_seq_visao;
			  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   := r_linha.nr_ordem_composto;
			  linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col     := linha_apap_v_w[nr_indice_linha_w].ds_unid_med;
			  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			  linha_apap_v_w[nr_indice_linha_w].ie_read_only     	:= r_linha.ie_read_only;
			  linha_apap_v_w[nr_indice_linha_w].ie_trend     		:= r_linha.ie_trend;
			  linha_apap_v_w[nr_indice_linha_w].nr_width     		:= r_linha.nr_width;
			  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf	:= r_linha.nm_atrib_vl_graf;
			  linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			  linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			  linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			  linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			  linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			  linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			  linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
			end if;
		  end loop read_nutricao;
		elsif (r_linha.ie_informacao = 'SVP') then
		  <<read_solucao>>
		  for r_solucao_item in c_solucao_item
		  loop
			if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			  ds_titulo_linha_w := r_linha.ds_title;
			else
			  ds_titulo_linha_w := r_solucao_item.ds_solucao;
			end if;
			linha_apap_v_w.extend();
			nr_indice_linha_w := linha_apap_v_w.count;
			linha_apap_v_w[nr_indice_linha_w].nr_sequencia        := nr_indice_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo   := nr_indice_grupo_w;
			linha_apap_v_w[nr_indice_linha_w].ds_informacao       := ds_titulo_linha_w;
			linha_apap_v_w[nr_indice_linha_w].nm_tabela           := r_linha.nm_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap    := upper(substr('ID_'||r_solucao_item.nr_prescricao||r_solucao_item.nr_seq_solucao||r_linha.ie_informacao,1,30));
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela  := r_linha.nm_atributo_tabela;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked  := r_linha.nm_atributo_linked;
			linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	  := upper(substr(r_linha.nm_id||'_'||r_solucao_item.nr_prescricao||'_'||r_solucao_item.nr_seq_solucao,1,50));
			linha_apap_v_w[nr_indice_linha_w].nr_prescricao       := r_solucao_item.nr_prescricao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_solucao      := r_solucao_item.nr_seq_solucao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao := r_linha.nr_seq_apresentacao;
			linha_apap_v_w[nr_indice_linha_w].ie_informacao       := r_linha.ie_informacao;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med         := null;
			linha_apap_v_w[nr_indice_linha_w].ds_sql              := r_linha.ds_sql;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
			linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_style       := r_linha.ie_plot_style;
			linha_apap_v_w[nr_indice_linha_w].ie_symbol           := r_linha.ie_symbol;
			linha_apap_v_w[nr_indice_linha_w].ds_color            := r_linha.ds_color;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_minima    := r_linha.nr_escala_minima;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima    := r_linha.nr_escala_maxima;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_visao        := r_linha.nr_seq_visao;
			linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto   := r_linha.nr_ordem_composto;
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col     := linha_apap_v_w[nr_indice_linha_w].ds_unid_med;
			linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
			linha_apap_v_w[nr_indice_linha_w].ie_read_only     		:= r_linha.ie_read_only;
			linha_apap_v_w[nr_indice_linha_w].ie_trend				:= r_linha.ie_trend;
			linha_apap_v_w[nr_indice_linha_w].nr_width     			:= r_linha.nr_width;
			linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		:= r_linha.nm_atrib_vl_graf;
			linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
			linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
			linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
			linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
			linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
			linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
			linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
			linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
			linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
			linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;
			linha_apap_v_w[nr_indice_linha_w].ds_formato_composto 	:= r_linha.ds_formato_composto;
		  end loop read_solucao;
		else
		  if (r_linha.ds_title IS NOT NULL AND r_linha.ds_title::text <> '') then
			ds_titulo_linha_w := r_linha.ds_title;
		  else	
			ds_titulo_linha_w := substr(r_linha.ds_label,1,2000);
		  end if;	

		  if (r_linha.nr_seq_score_flex IS NOT NULL AND r_linha.nr_seq_score_flex::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_label_escala,1,2000);
		  elsif (r_linha.ie_grupo = 'ES') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w,1,2000);
		  end if;

		  if (r_linha.nr_ficha_tecnica IS NOT NULL AND r_linha.nr_ficha_tecnica::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_ficha_tecnica,1,2000);
		  end if;

		  if (r_linha.ds_tipo_elemento IS NOT NULL AND r_linha.ds_tipo_elemento::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_tipo_elemento,1,2000);
		  end if;

		  if (r_linha.ds_tipo_avaliacao IS NOT NULL AND r_linha.ds_tipo_avaliacao::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_tipo_avaliacao,1,2000);
		  end if;

		  if (r_linha.nr_seq_grupo_pg IS NOT NULL AND r_linha.nr_seq_grupo_pg::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_grupo_pg,1,2000);
		  end if;

		  if (r_linha.nr_seq_gas IS NOT NULL AND r_linha.nr_seq_gas::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_gasoterapia,1,2000);
		  end if;

		  if (r_linha.ie_evolucao_clinica IS NOT NULL AND r_linha.ie_evolucao_clinica::text <> '') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w || ' - ' ||r_linha.ds_tipo_evolucao,1,2000);
		  end if;

		  if (r_linha.nr_seq_tipo_registro IS NOT NULL AND r_linha.nr_seq_tipo_registro::text <> '') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w || ' - ' ||r_linha.ds_tipo_registro,1,2000);
		  end if;

		  if (r_linha.nr_seq_diagnostico IS NOT NULL AND r_linha.nr_seq_diagnostico::text <> '') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w  || ' - ' || r_linha.ds_diagnostico ,1,2000);
		  end if;            												

		  if (r_linha.nm_exame IS NOT NULL AND r_linha.nm_exame::text <> '') then
			if (coalesce(r_linha.nr_seq_superior::text, '') = '') then
			  if (r_linha.ds_exame_superior IS NOT NULL AND r_linha.ds_exame_superior::text <> '') then
				ds_titulo_linha_w := substr(r_linha.nm_exame ||'('||r_linha.ds_exame_superior||')',1,2000);
			  else	
				ds_titulo_linha_w := substr(r_linha.nm_exame,1,2000);
			  end if;
			else
			  ds_titulo_linha_w := substr(r_linha.ds_label,1,2000);
			end if;	
		  end if;

		  if (r_linha.ds_membro IS NOT NULL AND r_linha.ds_membro::text <> '') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w ||' - '|| r_linha.ds_membro,1,2000);
		  end if;

		  if (r_linha.ds_pupila_lado IS NOT NULL AND r_linha.ds_pupila_lado::text <> '') then
			ds_titulo_linha_w := substr(ds_titulo_linha_w ||' - '|| r_linha.ds_pupila_lado,1,2000);
		  end if;

		  if (r_linha.ds_evento_tipo IS NOT NULL AND r_linha.ds_evento_tipo::text <> '') then
			ds_titulo_linha_w := substr(r_linha.ds_evento_tipo,1,2000);
		  end if;

		  ds_unid_med_ww := null;

		  if (r_linha.ds_inf_adic IS NOT NULL AND r_linha.ds_inf_adic::text <> '') and ((r_linha.nr_seq_tipo_pg IS NOT NULL AND r_linha.nr_seq_tipo_pg::text <> '') or (r_linha.nr_seq_grupo_pg IS NOT NULL AND r_linha.nr_seq_grupo_pg::text <> '')) then
			ds_unid_med_ww := substr(r_linha.ds_inf_adic,1,40);
		  elsif (r_linha.ie_informacao in ('S','H','D','I')) then
			ds_unid_med_ww := 'ml';
		  elsif (r_linha.ds_unid_med_elemento IS NOT NULL AND r_linha.ds_unid_med_elemento::text <> '') then
			ds_unid_med_ww := r_linha.ds_unid_med_elemento;
		  end if;	

		  linha_apap_v_w.extend();
		  nr_indice_linha_w := linha_apap_v_w.count;

		  if (coalesce(r_linha.nr_seq_superior::text, '') = '') then
			current_setting('apap_dinamico_pck.tree_v_w')::tree_t.extend();
			nr_indice_tree_w := current_setting('apap_dinamico_pck.tree_v_w')::tree_t.count;
			current_setting('apap_dinamico_pck.tree_v_w')::tree_t[nr_indice_tree_w].nr_sequencia		:= r_linha.nr_sequencia;
			current_setting('apap_dinamico_pck.tree_v_w')::tree_t[nr_indice_tree_w].nr_seq_superior	:= nr_indice_linha_w;
		  else
			  select	max(nr_seq_superior)
			  into STRICT		nr_indice_sup_w
			  from		table(get_tree)
			  where		nr_sequencia = r_linha.nr_seq_superior;
		  end if;	

		  nm_atributo_unico_w := r_linha.nm_id;
		  if (r_linha.ie_read_only = 'S') then
			if (r_linha.nr_seq_score_flex IS NOT NULL AND r_linha.nr_seq_score_flex::text <> '') then
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_score_flex;
			end if;		
			if (r_linha.nr_seq_tipo_avaliacao IS NOT NULL AND r_linha.nr_seq_tipo_avaliacao::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_tipo_avaliacao;
			end if;		
			if (r_linha.nr_ficha_tecnica IS NOT NULL AND r_linha.nr_ficha_tecnica::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_ficha_tecnica;
			end if;		
			if (r_linha.nr_seq_gas IS NOT NULL AND r_linha.nr_seq_gas::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_gas;
			end if;		
			if (r_linha.ie_evolucao_clinica IS NOT NULL AND r_linha.ie_evolucao_clinica::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.ie_evolucao_clinica;
			end if;		
			if (r_linha.nr_seq_tipo_registro IS NOT NULL AND r_linha.nr_seq_tipo_registro::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_tipo_registro;
			end if;		
			if (r_linha.nr_seq_diagnostico IS NOT NULL AND r_linha.nr_seq_diagnostico::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_diagnostico;
			end if;		
			if (r_linha.nr_seq_exame IS NOT NULL AND r_linha.nr_seq_exame::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_exame;
			end if;		
			if (r_linha.nr_seq_grupo_pg IS NOT NULL AND r_linha.nr_seq_grupo_pg::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_grupo_pg;
			end if;		
			if (r_linha.nr_seq_tipo_pg IS NOT NULL AND r_linha.nr_seq_tipo_pg::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_tipo_pg;
			end if;		
			if (r_linha.nr_seq_temp_conteudo IS NOT NULL AND r_linha.nr_seq_temp_conteudo::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.nr_seq_temp_conteudo;
			end if;		
			if (r_linha.ie_evento_tipo IS NOT NULL AND r_linha.ie_evento_tipo::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.ie_evento_tipo;
			end if;		
			if (r_linha.ie_tipo_elemento IS NOT NULL AND r_linha.ie_tipo_elemento::text <> '') then	
				nm_atributo_unico_w := nm_atributo_unico_w||'_'||r_linha.ie_tipo_elemento;
			end if;	
		  else
			nm_atributo_unico_w := r_linha.nm_atributo_linked;
		  end if;	

		  linha_apap_v_w[nr_indice_linha_w].nr_sequencia           := nr_indice_linha_w;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_apap_grupo      := nr_indice_grupo_w;
		  linha_apap_v_w[nr_indice_linha_w].ds_informacao          := ds_titulo_linha_w;
		  linha_apap_v_w[nr_indice_linha_w].nm_tabela              := r_linha.nm_tabela;
		  linha_apap_v_w[nr_indice_linha_w].nm_atributo_apap       := upper(substr('nm_atributo_'||r_linha.nr_sequencia,1,30));
		  linha_apap_v_w[nr_indice_linha_w].nm_atributo_tabela     := r_linha.nm_atributo_tabela;
		  linha_apap_v_w[nr_indice_linha_w].nm_atributo_linked     := r_linha.nm_atributo_linked;
		  linha_apap_v_w[nr_indice_linha_w].nm_atributo_unico	   := upper(substr(nm_atributo_unico_w,1,50));
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_score_flex      := r_linha.nr_seq_score_flex;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_tipo_avaliacao  := r_linha.nr_seq_tipo_avaliacao;
		  linha_apap_v_w[nr_indice_linha_w].nr_ficha_tecnica       := r_linha.nr_ficha_tecnica;
		  linha_apap_v_w[nr_indice_linha_w].ie_controla_adep       := r_linha.ie_controla_adep;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_gas             := r_linha.nr_seq_gas;
		  linha_apap_v_w[nr_indice_linha_w].ie_evolucao_clinica    := r_linha.ie_evolucao_clinica;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_tipo_registro   := r_linha.nr_seq_tipo_registro;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_diagnostico     := r_linha.nr_seq_diagnostico;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_exame           := r_linha.nr_seq_exame;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_grupo_pg        := r_linha.nr_seq_grupo_pg;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_tipo_pg         := r_linha.nr_seq_tipo_pg;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_apresentacao    := r_linha.nr_seq_apresentacao;
		  linha_apap_v_w[nr_indice_linha_w].ds_unid_med            := ds_unid_med_ww;
		  linha_apap_v_w[nr_indice_linha_w].ie_informacao          := r_linha.ie_informacao;
		  linha_apap_v_w[nr_indice_linha_w].ds_sql                 := r_linha.ds_sql;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_documento_secao := r_linha.nr_seq_documento_secao;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_doc_subsecao := r_linha.nr_sequencia;
		  linha_apap_v_w[nr_indice_linha_w].ie_visivel             := r_linha.ie_visivel;
		  linha_apap_v_w[nr_indice_linha_w].ie_plot_style          := r_linha.ie_plot_style;
		  linha_apap_v_w[nr_indice_linha_w].ie_symbol              := r_linha.ie_symbol;
		  linha_apap_v_w[nr_indice_linha_w].ds_color               := r_linha.ds_color;
		  linha_apap_v_w[nr_indice_linha_w].nr_escala_minima       := r_linha.nr_escala_minima;
		  linha_apap_v_w[nr_indice_linha_w].nr_escala_maxima       := r_linha.nr_escala_maxima;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_visao           := r_linha.nr_seq_visao;
		  linha_apap_v_w[nr_indice_linha_w].nr_ordem_composto      := r_linha.nr_ordem_composto;
		  linha_apap_v_w[nr_indice_linha_w].ie_integracao          := r_linha.ie_integracao;

		  if (r_linha.nm_tabela = 'ATENDIMENTO_SINAL_VITAL') then
			linha_apap_v_w[nr_indice_linha_w].ie_aparelho_pa         := r_linha.ie_aparelho_pa;																		
		  end if;

		  linha_apap_v_w[nr_indice_linha_w].ie_mediana             := r_linha.ie_mediana;
		  linha_apap_v_w[nr_indice_linha_w].ie_mediana_1_min       := r_linha.ie_mediana_1_min;
		  linha_apap_v_w[nr_indice_linha_w].ie_mediana_5_min       := r_linha.ie_mediana_5_min;
		  linha_apap_v_w[nr_indice_linha_w].ie_mediana_10_min      := r_linha.ie_mediana_10_min;
		  linha_apap_v_w[nr_indice_linha_w].ie_mediana_15_min      := r_linha.ie_mediana_15_min;
		  if (r_linha.nm_atributo_tabela in ('QT_ALTURA_M', 'QT_PESO_ATUAL') and obtain_user_locale(wheb_usuario_pck.get_nm_usuario) = 'ja_JP') then
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col        := null;
		  else
			linha_apap_v_w[nr_indice_linha_w].ds_unid_med_col        := coalesce(linha_apap_v_w[nr_indice_linha_w].ds_unid_med,r_linha.ds_unidade_medida);
		  end if;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_linked_data     := r_linha.nr_seq_linked_data;
		  linha_apap_v_w[nr_indice_linha_w].ie_read_only     		 := r_linha.ie_read_only;
		  linha_apap_v_w[nr_indice_linha_w].ie_trend     			 := r_linha.ie_trend;
		  linha_apap_v_w[nr_indice_linha_w].nm_atrib_vl_graf		 := r_linha.nm_atrib_vl_graf;
		  linha_apap_v_w[nr_indice_linha_w].nr_width     			 := r_linha.nr_width;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_superior     	 := null;
		  linha_apap_v_w[nr_indice_linha_w].ie_line		        := r_linha.ie_line;
		  linha_apap_v_w[nr_indice_linha_w].nr_size		        := r_linha.nr_size;
		  linha_apap_v_w[nr_indice_linha_w].nr_valor_minimo		:= r_linha.nr_valor_minimo;
		  linha_apap_v_w[nr_indice_linha_w].nr_valor_maximo		:= r_linha.nr_valor_maximo;
		  linha_apap_v_w[nr_indice_linha_w].ds_symbol_color_exceeded		:= r_linha.ds_symbol_color_exceeded;
		  linha_apap_v_w[nr_indice_linha_w].ie_reference_line		:= r_linha.ie_reference_line;
		  linha_apap_v_w[nr_indice_linha_w].nr_reference_line		:= r_linha.nr_reference_line;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_atrib_cliente	 := r_linha.nr_seq_atrib_cliente;
		  linha_apap_v_w[nr_indice_linha_w].nr_seq_temp_conteudo	 := r_linha.nr_seq_temp_conteudo;
		  linha_apap_v_w[nr_indice_linha_w].nr_escala_intervalo	:= r_linha.nr_escala_intervalo;
		  linha_apap_v_w[nr_indice_linha_w].ie_mark_exceeded_value_chart	:= r_linha.ie_mark_exceeded_value_chart;
		  linha_apap_v_w[nr_indice_linha_w].ie_plot_axis			:= r_linha.ie_plot_axis;
		  linha_apap_v_w[nr_indice_linha_w].ie_grafico			:= r_linha.ie_grafico;
		  linha_apap_v_w[nr_indice_linha_w].ds_lookup				:= r_linha.ds_lookup;

		  if (r_linha.nr_seq_superior IS NOT NULL AND r_linha.nr_seq_superior::text <> '') then
			linha_apap_v_w[nr_indice_linha_w].nr_seq_superior	 	 := nr_indice_sup_w;
		  end if;	

		  linha_apap_v_w[nr_indice_linha_w].ds_formato_composto	 := r_linha.ds_formato_composto;
		  linha_apap_v_w[nr_indice_linha_w].ie_evento_tipo		 := r_linha.ie_evento_tipo;
		  linha_apap_v_w[nr_indice_linha_w].ie_tipo_elemento		 := r_linha.ie_tipo_elemento;
		end if;
	  end loop read_linha;
	end loop read_grupo;

	CALL apap_dinamico_pck.gera_sequencia_dados_passados();
	CALL apap_dinamico_pck.gera_atributos_array();
	gera_querys_array;
	CALL apap_dinamico_pck.gera_resultados_agrupamento();
	CALL apap_dinamico_pck.executa_consultas();
	CALL apap_dinamico_pck.executa_transacao();
	CALL apap_dinamico_pck.limpa_dados();
  exception
	when others then
	  PERFORM set_config('apap_dinamico_pck.sql_errm_w', sqlerrm, false);
	  CALL apap_dinamico_pck.gera_log_apap('gerar_documento: '||current_setting('apap_dinamico_pck.sql_errm_w')::varchar(4000));
  end;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE apap_dinamico_pck.gerar_documento ( nr_seq_documento_p bigint, nr_atendimento_p bigint, cd_pessoa_fisica_p text, dt_inicial_p timestamp, dt_final_p timestamp, cd_setor_atendimento_p bigint, gap_p bigint) FROM PUBLIC;
