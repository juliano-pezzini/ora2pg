-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE apap_dinamico_pck.gera_atributos_array () AS $body$
DECLARE

	indice_w 	bigint := 0;
	ds_valores_w	tabela_visao_atributo.ds_valores%type;
	current_setting('apap_dinamico_pck.c_atributo')::CURSOR(nr_seq_linked_data_p CURSOR FOR
		SELECT	distinct c.nm_atributo,
				b.nm_atributo_apap,
				upper(c.ie_tipo_atributo) ie_tipo_atributo,
				upper(coalesce(d.ie_componente,c.ie_componente)) ie_componente,
				coalesce(d.ds_valores,c.ds_valores) ds_valores,
				coalesce(c.nm_atributo_pai,d.nm_atributo_pai) nm_atributo_pai,
				b.nr_seq_linked_data,
				c.nm_tabela,
				b.ds_unid_med,
				b.nr_seq_grupo_pg,
				b.nr_seq_tipo_pg,
				b.nr_seq_score_flex,
				b.nr_seq_topografia,
				b.ie_lado,
				b.nr_ficha_tecnica,
				coalesce(b.ie_controla_adep,'N') ie_controla_adep,
				b.nr_seq_gas,
				b.cd_material,
				b.ie_evolucao_clinica,
				b.nr_seq_tipo_registro,
				b.nr_prescricao,
				b.nr_seq_solucao,
				b.nr_seq_exame,
				b.nr_seq_cpoe,
				b.ie_informacao,
				b.nr_seq_tipo_avaliacao,
				b.nr_seq_dispositivo,
				b.nr_seq_atend_disp,
				b.ie_integracao,
				b.ie_mediana,
				b.ie_mediana_1_min,
				b.ie_mediana_5_min,
				b.ie_mediana_10_min,
				b.ie_mediana_15_min,
				b.ie_evento_tipo,
				b.ie_tipo_elemento,
				b.nr_seq_gqa_prot_eta,
				b.nr_seq_disp_pac,
				b.nr_seq_diagnostico,
				b.nr_seq_intervention,
				null nr_seq_temp_conteudo,
				coalesce(b.ie_aparelho_pa,'C') ie_aparelho_pa,
				b.nr_seq_cp_indicator
		from	table(get_grupo_apap) a,
				table(get_linha_apap) b,
				tabela_atributo c,
				tabela_visao_atributo d
		where	a.nr_sequencia        = b.nr_seq_apap_grupo
		and		b.nm_tabela           = c.nm_tabela
		and		b.nm_atributo_tabela  = c.nm_atributo
		and		b.nr_seq_visao        = d.nr_sequencia
		and		c.nm_atributo         = d.nm_atributo
		and		((coalesce(b.nr_seq_exame::text, '') = '') or (exists (SELECT 1 from table(lista_pck.obter_lista(ds_lista_ex_w,',')) x where x.nr_registro = b.nr_seq_exame)))
		and		((coalesce(b.nr_seq_grupo_pg::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_grupo_pg_w,',')) x where x.nr_registro = b.nr_seq_grupo_pg)))
		and		((coalesce(b.nr_seq_tipo_pg::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_pg_w,',')) x where x.nr_registro = b.nr_seq_tipo_pg)))
		and		((coalesce(b.nr_seq_score_flex::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_score_flex_w,',')) x where x.nr_registro = b.nr_seq_score_flex)))																																														
		and		((coalesce(b.nr_seq_tipo_avaliacao::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_avaliacao_w,',')) x where x.nr_registro = b.nr_seq_tipo_avaliacao)))
		and		((coalesce(b.nr_seq_tipo_registro::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_registro_w,',')) x where x.nr_registro = b.nr_seq_tipo_registro)))
		and		((coalesce(b.ie_evolucao_clinica::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista_char(ds_lista_ev_w,',')) x where x.cd_registro = b.ie_evolucao_clinica)))
		
union

		select	distinct coalesce(b.nm_atrib_vl_graf,b.nm_atributo_linked) nm_atributo,
				b.nm_atributo_apap,
				upper(d.ie_tipo_atributo) ie_tipo_atributo,
				upper(coalesce(e.ie_componente,d.ie_componente)) ie_componente,
				'converte_pck.string_to_integer('||coalesce(e.ds_valores,d.ds_valores)||')' ds_valores,
				coalesce(e.nm_atributo_pai,d.nm_atributo_pai) nm_atributo_pai,
				b.nr_seq_linked_data,
				c.nm_tabela,
				b.ds_unid_med,
				b.nr_seq_grupo_pg,
				b.nr_seq_tipo_pg,
				b.nr_seq_score_flex,
				b.nr_seq_topografia,
				b.ie_lado,
				b.nr_ficha_tecnica,
				coalesce(b.ie_controla_adep,'N') ie_controla_adep,
				b.nr_seq_gas,
				b.cd_material,
				b.ie_evolucao_clinica,
				b.nr_seq_tipo_registro,
				b.nr_prescricao,
				b.nr_seq_solucao,
				b.nr_seq_exame,
				b.nr_seq_cpoe,
				b.ie_informacao,
				b.nr_seq_tipo_avaliacao,
				b.nr_seq_dispositivo,
				b.nr_seq_atend_disp,
				b.ie_integracao,
				b.ie_mediana,
				b.ie_mediana_1_min,
				b.ie_mediana_5_min,
				b.ie_mediana_10_min,
				b.ie_mediana_15_min,
				b.ie_evento_tipo,
				b.ie_tipo_elemento,
				b.nr_seq_gqa_prot_eta,
				b.nr_seq_disp_pac,
				b.nr_seq_diagnostico,
				b.nr_seq_intervention,
				null nr_seq_temp_conteudo,
				coalesce(b.ie_aparelho_pa,'C') ie_aparelho_pa,
				b.nr_seq_cp_indicator
		from	table(get_grupo_apap) a,
				table(get_linha_apap) b,
				table(get_linha_apap) c,
				tabela_atributo d,
				tabela_visao_atributo e
		where   a.nr_sequencia        = b.nr_seq_apap_grupo
		and     a.nr_sequencia        = c.nr_seq_apap_grupo
		and     b.nr_seq_linked_data  = c.nr_seq_linked_data
		and     b.nm_atrib_vl_graf    = c.nm_atributo_tabela
		and		c.nm_tabela           = d.nm_tabela
		and		c.nm_atributo_tabela  = d.nm_atributo
		and		c.nr_seq_visao        = e.nr_sequencia
		and		d.nm_atributo         = e.nm_atributo
		and     coalesce(b.nm_atributo_tabela::text, '') = ''
		and     ((coalesce(b.nr_seq_exame::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_ex_w,',')) x where x.nr_registro = b.nr_seq_exame)))
		and     ((coalesce(b.nr_seq_grupo_pg::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_grupo_pg_w,',')) x where x.nr_registro = b.nr_seq_grupo_pg)))
		and     ((coalesce(b.nr_seq_tipo_pg::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_pg_w,',')) x where x.nr_registro = b.nr_seq_tipo_pg)))
		and     ((coalesce(b.nr_seq_score_flex::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_score_flex_w,',')) x where x.nr_registro = b.nr_seq_score_flex)))
		and     ((coalesce(b.nr_seq_tipo_avaliacao::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_avaliacao_w,',')) x where x.nr_registro = b.nr_seq_tipo_avaliacao)))
		and     ((coalesce(b.nr_seq_tipo_registro::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista(ds_lista_tipo_registro_w,',')) x where x.nr_registro = b.nr_seq_tipo_registro)))    																																															
		and     ((coalesce(b.ie_evolucao_clinica::text, '') = '') or (exists (select 1 from table(lista_pck.obter_lista_char(ds_lista_ev_w,',')) x where x.cd_registro = b.ie_evolucao_clinica)))
		
union

		select  CASE WHEN c.ie_tipo_atrib_cliente='VARCHAR2' THEN 'DS_RESULTADO'  ELSE CASE WHEN c.IE_TIPO_ATRIB_CLIENTE='NUMBER' THEN 'VL_RESULTADO'  ELSE 'DT_RESULTADO' END  END  nm_atributo,
				b.nm_atributo_apap,
				upper(c.ie_tipo_atrib_cliente) ie_tipo_atributo,
				upper(c.ie_comp_cliente) ie_componente,
				null ds_valores,
				null nm_atributo_pai,
				b.nr_seq_linked_data,
				b.nm_tabela,
				b.ds_unid_med,
				b.nr_seq_grupo_pg,
				b.nr_seq_tipo_pg,
				b.nr_seq_score_flex,
				b.nr_seq_topografia,
				b.ie_lado,
				b.nr_ficha_tecnica,
				coalesce(b.ie_controla_adep,'N') ie_controla_adep,
				b.nr_seq_gas,
				b.cd_material,
				b.ie_evolucao_clinica,
				b.nr_seq_tipo_registro,
				b.nr_prescricao,
				b.nr_seq_solucao,
				b.nr_seq_exame,
				b.nr_seq_cpoe,
				b.ie_informacao,
				b.nr_seq_tipo_avaliacao,
				b.nr_seq_dispositivo,
				b.nr_seq_atend_disp,
				b.ie_integracao,
				b.ie_mediana,
				b.ie_mediana_1_min,
				b.ie_mediana_5_min,
				b.ie_mediana_10_min,
				b.ie_mediana_15_min,
				b.ie_evento_tipo,
				b.ie_tipo_elemento,
				b.nr_seq_gqa_prot_eta,
				b.nr_seq_disp_pac,
				b.nr_seq_diagnostico,
				b.nr_seq_intervention,
				null nr_seq_temp_conteudo,
				coalesce(b.ie_aparelho_pa,'C') ie_aparelho_pa,
				b.nr_seq_cp_indicator
		from    table(get_grupo_apap) a,
				table(get_linha_apap) b,
				apap_atributo_cliente c  
		where   a.nr_sequencia         = b.nr_seq_apap_grupo
		and     b.nr_seq_atrib_cliente = c.nr_sequencia
		
union

		select  case	upper(e.ds_openehr)
					when  'DV_TIME' then 'DT_RESULTADO'
					when  'DV_DATE' then 'DT_RESULTADO'
					when  'DV_DATE_TIME' then 'DT_RESULTADO'
					when  'DV_BOOLEAN' then 'DS_RESULTADO'
					when  'DV_TEXT' then 'DS_RESULTADO'
					when  'DV_COUNT' then 'VL_RESULTADO'
					when  'DV_QUANTITY' then 'VL_RESULTADO'
				end 	nm_atributo,
				b.nm_atributo_apap,
				case	upper(e.ds_openehr)
					when  'DV_TIME' then 'DATE'
					when  'DV_DATE' then 'DATE'
					when  'DV_DATE_TIME' then 'DATE'
					when  'DV_BOOLEAN' then 'VARCHAR2'
					when  'DV_TEXT' then 'VARCHAR2'
					when  'DV_COUNT' then 'NUMBER'
					when  'DV_QUANTITY' then 'NUMBER'
				end 	ie_tipo_atributo,
				upper(d.ie_componente) ie_componente,
				null ds_valores,
				null nm_atributo_pai,
				b.nr_seq_linked_data,
				b.nm_tabela,
				b.ds_unid_med,
				b.nr_seq_grupo_pg,
				b.nr_seq_tipo_pg,
				b.nr_seq_score_flex,
				b.nr_seq_topografia,
				b.ie_lado,
				b.nr_ficha_tecnica,
				coalesce(b.ie_controla_adep,'N') ie_controla_adep,
				b.nr_seq_gas,
				b.cd_material,
				b.ie_evolucao_clinica,
				b.nr_seq_tipo_registro,
				b.nr_prescricao,
				b.nr_seq_solucao,
				b.nr_seq_exame,
				b.nr_seq_cpoe,
				b.ie_informacao,
				b.nr_seq_tipo_avaliacao,
				b.nr_seq_dispositivo,
				b.nr_seq_atend_disp,
				b.ie_integracao,
				b.ie_mediana,
				b.ie_mediana_1_min,
				b.ie_mediana_5_min,
				b.ie_mediana_10_min,
				b.ie_mediana_15_min,
				b.ie_evento_tipo,
				b.ie_tipo_elemento,
				b.nr_seq_gqa_prot_eta,
				b.nr_seq_disp_pac,
				b.nr_seq_diagnostico,
				b.nr_seq_intervention,
				b.nr_seq_temp_conteudo,
				coalesce(b.ie_aparelho_pa,'C') ie_aparelho_pa,
				b.nr_seq_cp_indicator
		from    table(get_grupo_apap) a,
				table(get_linha_apap) b,
				ehr_template_conteudo c,
				ehr_elemento d,
				ehr_tipo_dado e
		where   a.nr_sequencia         	= b.nr_seq_apap_grupo
		and     b.nr_seq_temp_conteudo 	= c.nr_sequencia
		and     c.nr_seq_elemento      	= d.nr_sequencia 
		and     d.nr_seq_tipo_dado  	= e.nr_sequencia;

	c_chave CURSOR FOR
		SELECT  distinct d.nm_tabela,
				e.nm_atributo,
				e.nr_sequencia,
				'PK_'||e.nr_sequencia nm_coluna,
				null nm_atributo_pai
		from    table(get_linha_apap) a,
				indice d,
				indice_atributo e
		where   a.nm_tabela = d.nm_tabela
		and     d.nm_indice = e.nm_indice
		and     d.ie_tipo             = upper('PK')
		and     not exists (SELECT 1 from indice x where x.nm_tabela = d.nm_tabela and x.ie_tipo = upper('UK'))
		
union

		select  distinct d.nm_tabela,
				e.nm_atributo,
				e.nr_sequencia,
				'PK_'||e.nr_sequencia nm_coluna,
				null nm_atributo_pai
		from    table(get_linha_apap) a,
				indice d,
				indice_atributo e
		where   a.nm_tabela = d.nm_tabela
		and     d.nm_indice = e.nm_indice
		and     d.ie_tipo             = upper('UK')
		
union

		select  distinct d.nm_tabela,
				d.nm_atributo,
				null nr_sequencia,
				d.nm_atributo nm_coluna,
				null nm_atributo_pai
		from    table(get_linha_apap) a,
				tabela_atributo d
		where   a.nm_tabela 	= d.nm_tabela
		and		d.nm_atributo 	in ('IE_SITUACAO','IE_INTEGRACAO','DT_INATIVACAO','DT_LIBERACAO','NR_SEQ_ICONE')
		
union

		select	distinct 'ATENDIMENTO_ATRIB_CLIENTE' nm_tabela,
				'DT_REGISTRO',
				null,
				'DT_REGISTRO' nm_coluna,
				null nm_atributo_pai
		from	documento_secao a,
				documento_subsecao b
		where	a.nr_sequencia 		= b.nr_seq_documento_secao
		and		a.nr_seq_documento 	= nr_seq_documento_w
		and		(b.nr_seq_atrib_cliente IS NOT NULL AND b.nr_seq_atrib_cliente::text <> '')
		
union

		select	distinct 'EHR_REG_ELEMENTO' nm_tabela,
				'(	select	max(c.dt_registro) '||
				'	from	ehr_registro c, '||
				'			ehr_reg_template b '||
				'	where	c.nr_sequencia 			= b.nr_seq_reg '||
				'	and		a.nr_seq_reg_template	= b.nr_sequencia)',
				null,
				'DT_REGISTRO' nm_coluna,
				null nm_atributo_pai
		from	documento_secao a,
				documento_subsecao b
		where	a.nr_sequencia 		= b.nr_seq_documento_secao
		and		a.nr_seq_documento 	= nr_seq_documento_w
		and		(b.nr_seq_temp_conteudo IS NOT NULL AND b.nr_seq_temp_conteudo::text <> '')
		
union

		select  distinct c.nm_tabela,
				CASE WHEN coalesce(b.ds_valores::text, '') = '' THEN b.nm_atributo  ELSE b.ds_valores END  nm_atributo,
				null nr_sequencia,
				case	a.ie_referencia
					when 'A'      then 'DT_APAP'
					when 'R'      then 'DT_REGISTRO'
					when 'I'      then 'DT_INICIO'
					when 'F'      then 'DT_FIM'
					when 'PADSV'  then 'VL_PAD'
					when 'PASSV'  then 'VL_PAS'
					when 'PAMSV'  then 'VL_PAM'
					when 'PADHEM' then 'VL_PAD'
					when 'PASHEM' then 'VL_PAS'
					when 'PAMHEM' then 'VL_PAM'
					when 'PAPS'   then 'VL_PAPS'
					when 'PAPD'   then 'VL_PAPD'
					when 'PAPM'   then 'VL_PAPM'
					when 'PF'     then 'DS_PROFISSIONAL'
					when 'W'      then 'IE_ALERTA'
					when 'CA'     then 'DS_COR_ALERTA'
					--when 'T'      then 'DS_TOOLTIP'
					when 'VG'     then 'VL_GRAFICO'
					when 'STATUS' then 'IE_STATUS'
					else null
				end nm_coluna,
				b.nm_atributo_pai
		from    documento_atributo_ref a,
				tabela_visao_atributo b,
				linked_data_atributo c,
				linked_data d
		where   a.nr_seq_linked_data  = c.nr_seq_linked_data
		and		c.nr_seq_linked_data  = d.nr_sequencia
		and     a.nr_seq_linked_data  = d.nr_sequencia
		and     a.nr_seq_visao        = b.nr_sequencia
		and     a.nr_seq_visao        = d.nr_seq_vision
		and     a.nm_atributo         = b.nm_atributo
		and     b.nm_atributo         = c.nm_atributo
		and     exists (  	select  1
							from    documento_secao x,
									documento_subsecao y
							where   x.nr_sequencia       = y.nr_seq_documento_secao
							and     y.nr_seq_linked_data = a.nr_seq_linked_data
							and     x.nr_seq_documento   = nr_seq_documento_w);
	
BEGIN
	begin
	<<read_atributo>>
	for r_atributo in current_setting('apap_dinamico_pck.c_atributo')::CURSOR(nr_seq_linked_data_p
		loop
		ds_valores_w := null;
		if (r_atributo.ie_tipo_atributo = 'FUNCTION') then
			ds_valores_w	:= r_atributo.ds_valores;
		end if;	
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t.extend(1);
		indice_w := current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t.count;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nm_atributo           := r_atributo.nm_atributo;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nm_atributo_apap      := r_atributo.nm_atributo_apap;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ds_valores            := ds_valores_w;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nm_atributo_pai       := r_atributo.nm_atributo_pai;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_linked_data    := r_atributo.nr_seq_linked_data;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nm_tabela             := r_atributo.nm_tabela;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ds_unid_med           := r_atributo.ds_unid_med;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_grupo_pg       := r_atributo.nr_seq_grupo_pg;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_tipo_pg        := r_atributo.nr_seq_tipo_pg;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_score_flex     := r_atributo.nr_seq_score_flex;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_topografia     := r_atributo.nr_seq_topografia;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_lado               := r_atributo.ie_lado;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_ficha_tecnica      := r_atributo.nr_ficha_tecnica;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_controla_adep      := r_atributo.ie_controla_adep;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_gas            := r_atributo.nr_seq_gas;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].cd_material           := r_atributo.cd_material;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_evolucao_clinica   := r_atributo.ie_evolucao_clinica;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_tipo_registro  := r_atributo.nr_seq_tipo_registro;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_diagnostico    := r_atributo.nr_seq_diagnostico;      																					
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_intervention   := r_atributo.nr_seq_intervention;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_tipo_avaliacao := r_atributo.nr_seq_tipo_avaliacao;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_prescricao         := r_atributo.nr_prescricao;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_solucao        := r_atributo.nr_seq_solucao;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_exame          := r_atributo.nr_seq_exame;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_cpoe           := r_atributo.nr_seq_cpoe;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_informacao         := r_atributo.ie_informacao;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_dispositivo    := r_atributo.nr_seq_dispositivo;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_integracao         := r_atributo.ie_integracao;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_aparelho_pa        := r_atributo.ie_aparelho_pa;																					
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_mediana            := r_atributo.ie_mediana;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_mediana_1_min      := r_atributo.ie_mediana_1_min;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_mediana_5_min      := r_atributo.ie_mediana_5_min;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_mediana_10_min     := r_atributo.ie_mediana_10_min;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_mediana_15_min     := r_atributo.ie_mediana_15_min;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_evento_tipo        := r_atributo.ie_evento_tipo;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].ie_tipo_elemento      := r_atributo.ie_tipo_elemento;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_gqa_prot_eta   := r_atributo.nr_seq_gqa_prot_eta;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_disp_pac   	 := r_atributo.nr_seq_disp_pac;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_temp_conteudo  := r_atributo.nr_seq_temp_conteudo;
		current_setting('apap_dinamico_pck.atributo_v_w')::atributo_t[indice_w].nr_seq_cp_indicator   := r_atributo.nr_seq_cp_indicator;
		end loop read_atributo;
	<<read_chave>>
	for r_chave in c_chave
		loop
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t.extend(1);
		indice_w := current_setting('apap_dinamico_pck.chave_v_w')::chave_t.count;
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t[indice_w].nm_tabela    		:= r_chave.nm_tabela;
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t[indice_w].nm_atributo  		:= r_chave.nm_atributo;
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t[indice_w].nr_sequencia 		:= r_chave.nr_sequencia;
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t[indice_w].nm_coluna    		:= r_chave.nm_coluna;
		current_setting('apap_dinamico_pck.chave_v_w')::chave_t[indice_w].nm_atributo_pai   := r_chave.nm_atributo_pai;
	end loop read_chave;
	exception
	when others then
		PERFORM set_config('apap_dinamico_pck.sql_errm_w', sqlerrm, false);
		CALL apap_dinamico_pck.gera_log_apap('gera_atributos_array: '||current_setting('apap_dinamico_pck.sql_errm_w')::varchar(4000));
	end;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE apap_dinamico_pck.gera_atributos_array () FROM PUBLIC;
