-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION apap_dinamico_pck.get_suggested_comments () RETURNS SETOF T_SUGGESTED_COMMENT AS $body$
DECLARE

	c1 CURSOR FOR
	SELECT a.nr_sequencia cd,
		   a.ds_title ds,
		   a.ds_text text
	from apap_standard_text a
	left join apap_standard_text_access b
		on b.nr_seq_standard_text = a.nr_sequencia
	where a.ie_situacao = 'A'
	and a.cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento
	and (b.nm_user_access = wheb_usuario_pck.get_nm_usuario
	   or coalesce(b.nr_seq_standard_text::text, '') = '');

	suggested_comments_w r_suggested_comment;

	
BEGIN

		for comment_w in c1 loop
			suggested_comments_w.cd := comment_w.cd;
			suggested_comments_w.ds := comment_w.ds;
			suggested_comments_w.ds_comment := comment_w.text;
			suggested_comments_w.content_field := 'DS_COMMENT';
			RETURN NEXT suggested_comments_w;

		end loop;
		return;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION apap_dinamico_pck.get_suggested_comments () FROM PUBLIC;
