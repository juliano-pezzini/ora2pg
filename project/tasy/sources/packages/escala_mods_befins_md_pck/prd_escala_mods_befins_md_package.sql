-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE escala_mods_befins_md_pck.prd_escala_mods_befins_md (qt_rel_pao2_fio2_p bigint, qt_plaquetas_p bigint, qt_bilirrubina_serica_p bigint, qt_pa_diastolica_p bigint, qt_pa_sistolica_p bigint, qt_freq_cardiaca_p bigint, qt_pvc_p bigint, qt_glasgow_p bigint, qt_creatinina_serica_p bigint, qt_pto_resp_p bigint, qt_pto_coag_p bigint, qt_pto_hepatica_p bigint, qt_pto_cardio_p bigint, qt_pto_snc_p bigint, qt_pto_renal_p bigint, qtptoresp_p INOUT bigint, qtptocoag_p INOUT bigint, qtptohepatica_p INOUT bigint, qtpam_p INOUT bigint, qtpaajustada_p INOUT bigint, qtptocardio_p INOUT bigint, qtptosnc_p INOUT bigint, qtptorenal_p INOUT bigint, qtpontuacao_p INOUT bigint, prmortalidade_uti_p INOUT bigint, prmortalidade_p INOUT bigint, qtdias_p INOUT bigint ) AS $body$
BEGIN

    qtptoresp_p := escala_mods_befins_md_pck.obter_score_rel_pao2_fio2_md(qt_rel_pao2_fio2_p);
    qtptocoag_p := escala_mods_befins_md_pck.obter_score_cont_plaqueta_md(qt_plaquetas_p);
    qtptohepatica_p := escala_mods_befins_md_pck.obter_score_bili_serica_md(qt_bilirrubina_serica_p);

    SELECT * FROM escala_mods_befins_md_pck.obter_score_cardiovascular_md(qt_pa_diastolica_p, qt_pa_sistolica_p, qt_freq_cardiaca_p, qt_pvc_p, qtpam_p, qtpaajustada_p, qtptocardio_p) INTO STRICT qtpam_p, qtpaajustada_p, qtptocardio_p;

    qtptosnc_p := escala_mods_befins_md_pck.obter_score_glasgow_md(qt_glasgow_p);

    qtptorenal_p := escala_mods_befins_md_pck.obter_score_creat_serica_md(qt_creatinina_serica_p);

    qtpontuacao_p := coalesce(qtptoresp_p, 0) + coalesce(qtptocoag_p, 0) + coalesce(qtptohepatica_p, 0) +
                     coalesce(qtptocardio_p, 0) + coalesce(qtptosnc_p,0) + coalesce(qtptorenal_p,0);

    if (qtpontuacao_p = 0) then
	  prmortalidade_uti_p := 0;
	  prmortalidade_p := 0;
	  qtdias_p := 2;
    elsif (qtpontuacao_p >= 1) and (qtpontuacao_p <= 2) then
	  prmortalidade_uti_p := 1;
	  prmortalidade_p := 7;
	  qtdias_p := 3;
    elsif (qtpontuacao_p >= 3) and (qtpontuacao_p <= 4) then
	  prmortalidade_uti_p := 2;
	  prmortalidade_p := 7;
	  qtdias_p := 3;
    elsif (qtpontuacao_p = 5) then
	  prmortalidade_uti_p := 3;
	  prmortalidade_p := 16;
	  qtdias_p := 6;
    elsif (qtpontuacao_p >= 6) and (qtpontuacao_p <= 7) then
	  prmortalidade_uti_p := 4;
	  prmortalidade_p := 16;
	  qtdias_p := 6;
    elsif (qtpontuacao_p = 8) then
	  prmortalidade_uti_p := 5;
	  prmortalidade_p := 16;
	  qtdias_p := 6;
    elsif (qtpontuacao_p >= 9) and (qtpontuacao_p <= 12) then
	  prmortalidade_uti_p := 25;
	  prmortalidade_p := 50;
	  qtdias_p := 10;
    elsif (qtpontuacao_p >= 13) and (qtpontuacao_p <= 16) then
	  prmortalidade_uti_p := 50;
	  prmortalidade_p := 70;
	  qtdias_p := 17;
    elsif (qtpontuacao_p >= 17) and (qtpontuacao_p <= 20) then
	  prmortalidade_uti_p := 75;
	  prmortalidade_p := 82;
	  qtdias_p := 21;
    elsif (qtpontuacao_p >= 21) and (qtpontuacao_p <= 24) then
	  prmortalidade_uti_p := 100;
	  prmortalidade_p := 100;
	  qtdias_p := null;
    end if;

  end;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE escala_mods_befins_md_pck.prd_escala_mods_befins_md (qt_rel_pao2_fio2_p bigint, qt_plaquetas_p bigint, qt_bilirrubina_serica_p bigint, qt_pa_diastolica_p bigint, qt_pa_sistolica_p bigint, qt_freq_cardiaca_p bigint, qt_pvc_p bigint, qt_glasgow_p bigint, qt_creatinina_serica_p bigint, qt_pto_resp_p bigint, qt_pto_coag_p bigint, qt_pto_hepatica_p bigint, qt_pto_cardio_p bigint, qt_pto_snc_p bigint, qt_pto_renal_p bigint, qtptoresp_p INOUT bigint, qtptocoag_p INOUT bigint, qtptohepatica_p INOUT bigint, qtpam_p INOUT bigint, qtpaajustada_p INOUT bigint, qtptocardio_p INOUT bigint, qtptosnc_p INOUT bigint, qtptorenal_p INOUT bigint, qtpontuacao_p INOUT bigint, prmortalidade_uti_p INOUT bigint, prmortalidade_p INOUT bigint, qtdias_p INOUT bigint ) FROM PUBLIC;
