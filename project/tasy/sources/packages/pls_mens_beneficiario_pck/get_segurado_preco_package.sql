-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_mens_beneficiario_pck.get_segurado_preco ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, dt_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, ie_regulamentacao_p pls_plano.ie_regulamentacao%type) RETURNS bigint AS $body$
DECLARE

nr_seq_segurado_preco_w	pls_segurado_preco.nr_sequencia%type;
dt_referencia_fim_w	pls_mensalidade_segurado.dt_mesano_referencia%type;

BEGIN
dt_referencia_fim_w		:= fim_dia(last_day(dt_referencia_p));

select	max(a.nr_sequencia)
into STRICT	nr_seq_segurado_preco_w
from	pls_segurado_preco	a
where	a.nr_seq_segurado	= nr_seq_segurado_p
and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
and	a.ie_situacao	= 'A'
and	((((a.dt_reajuste between dt_referencia_p and dt_referencia_fim_w) or dt_referencia_p > a.dt_reajuste) and
	((a.cd_motivo_reajuste	<> 'E') or (pls_mensalidade_util_pck.get_ie_mes_reaj_faixa_etaria(ie_regulamentacao_p) = 'M'))) or
	(((a.cd_motivo_reajuste	= 'E') and (dt_referencia_p >= trunc(add_months(a.dt_reajuste,1), 'month'))) and (pls_mensalidade_util_pck.get_ie_mes_reaj_faixa_etaria(ie_regulamentacao_p) = 'P')));

return nr_seq_segurado_preco_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_mens_beneficiario_pck.get_segurado_preco ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, dt_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, ie_regulamentacao_p pls_plano.ie_regulamentacao%type) FROM PUBLIC;
