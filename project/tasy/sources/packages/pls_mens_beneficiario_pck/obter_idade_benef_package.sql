-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_mens_beneficiario_pck.obter_idade_benef ( dt_referencia_p timestamp, dt_nascimento_p timestamp, ie_regulamentacao_p pls_plano.ie_regulamentacao%type, dt_adesao_p pls_segurado.dt_contratacao%type) RETURNS bigint AS $body$
DECLARE

qt_idade_w	bigint;
dt_base_w	timestamp;

BEGIN

dt_base_w	:= fim_dia(last_day(dt_referencia_p));

--Se o reajuste por faixa etaria for para o mes posterior ao aniversario, entao deve lancar a idade sem considerar o aniversario

if (pls_mensalidade_util_pck.get_ie_mes_reaj_faixa_etaria(ie_regulamentacao_p) = 'P') then
	dt_base_w	:= fim_dia(last_day(add_months(dt_referencia_p,-1)));
else
	dt_base_w	:= fim_dia(last_day(dt_referencia_p));
end if;

select	trunc(months_between(dt_base_w, dt_nascimento_p) / 12)
into STRICT	qt_idade_w
;

return qt_idade_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_mens_beneficiario_pck.obter_idade_benef ( dt_referencia_p timestamp, dt_nascimento_p timestamp, ie_regulamentacao_p pls_plano.ie_regulamentacao%type, dt_adesao_p pls_segurado.dt_contratacao%type) FROM PUBLIC;
