-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION medical_net_pck.process_edifact_ftx (edifact_message_p text) RETURNS R_GET_FTX AS $body$
DECLARE

	json_return	text;
	ds_oneMessage_w	varchar(70);
	json_msg_group	philips_json;
	r_ftx_w		r_get_ftx;

	
BEGIN
	$if dbms_db_version.version >= 12 $then
	SELECT	edifact.oneMessage, edifact.messageGroup
	INTO STRICT	ds_oneMessage_w, json_return
	FROM	JSON_TABLE(edifact_message_p, '$'
	COLUMNS(
		NESTED PATH '$.EDIFACT'
		COLUMNS(
			NESTED PATH '$.FTX'
			COLUMNS(
				messagesType VARCHAR2(100) PATH '$."2"',
				oneMessage VARCHAR2(100) PATH '$."4"',
				messageGroup VARCHAR2(2000) FORMAT JSON PATH '$."4"'
			)
		)
	)
	) AS edifact;

	json_msg_group	:=	philips_json(json_return);

	r_ftx_w.text1	:=	ds_oneMessage_w;
	if (json_msg_group IS NOT NULL AND json_msg_group::text <> '') then
	   if ((json_msg_group.get('1') IS NOT NULL AND (json_msg_group.get('1'))::text <> '')) then
		   r_ftx_w.text1 := json_msg_group.get['1'].get_string();
	   end if;
	   if ((json_msg_group.get('2') IS NOT NULL AND (json_msg_group.get('2'))::text <> '')) then
		   r_ftx_w.text2 := json_msg_group.get['2'].get_string();
	   end if;
	   if ((json_msg_group.get('3') IS NOT NULL AND (json_msg_group.get('3'))::text <> '')) then
		   r_ftx_w.text3 := json_msg_group.get['3'].get_string();
	   end if;
	   if ((json_msg_group.get('4') IS NOT NULL AND (json_msg_group.get('4'))::text <> '')) then
		   r_ftx_w.text4 := json_msg_group.get['4'].get_string();
	   end if;
	   if ((json_msg_group.get('5') IS NOT NULL AND (json_msg_group.get('5'))::text <> '')) then
		   r_ftx_w.text5 := json_msg_group.get['5'].get_string();
	   end if;
	end if;
	
	$end
	return	r_ftx_w;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION medical_net_pck.process_edifact_ftx (edifact_message_p text) FROM PUBLIC;
