-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION medical_net_pck.process_edifact_unh (edifact_message_p text) RETURNS R_GET_UNH AS $body$
DECLARE

	edifactPattern_w	philips_json;
	ds_nrReference_w	varchar(30);
	r_unh_w			r_get_unh;

	
BEGIN
	$if dbms_db_version.version >= 12 $then
	SELECT	edifact.referenceNr
	INTO STRICT	ds_nrReference_w
	FROM	JSON_TABLE(edifact_message_p, '$'
	COLUMNS(
		NESTED PATH '$.EDIFACT'
		COLUMNS(
			NESTED PATH '$.UNH'
			COLUMNS(
				referenceNr VARCHAR2(100) PATH '$."2"',
				edifactPattern VARCHAR2(100) FORMAT JSON PATH '$."3"'
			)
		)
	)
	) AS edifact;

	r_unh_w.referenceNumber	:=	ds_nrReference_w;

	
	$end
	return	r_unh_w;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION medical_net_pck.process_edifact_unh (edifact_message_p text) FROM PUBLIC;
