-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION medical_net_pck.process_edifact_nad (edifact_message_p text) RETURNS R_GET_NAD AS $body$
DECLARE

	json_name	text;
	json_nameGroup	philips_json;
	ds_city_w	varchar(50);
	ds_zipCode_w	varchar(20);
	r_nad_w		r_get_nad;

	
BEGIN
	$if dbms_db_version.version >= 12 $then
	SELECT	edifact.nameGroup, edifact.city, edifact.zipCode
	INTO STRICT	json_name, ds_city_w, ds_zipCode_w
	FROM	JSON_TABLE(edifact_message_p, '$'
	COLUMNS(
		NESTED PATH '$.EDIFACT'
		COLUMNS(
			NESTED PATH '$.NAD'
			COLUMNS(
				nameGroup VARCHAR2(100) FORMAT JSON PATH '$."4"',
				city VARCHAR2(100) PATH '$."7"',
				zipCode VARCHAR2(100) PATH '$."9"'
			)
		)
	)
	) AS edifact;

	json_nameGroup := philips_json(json_name);

	if ((json_nameGroup.get('1') IS NOT NULL AND (json_nameGroup.get('1'))::text <> '')) then
		r_nad_w.surname :=  json_nameGroup.get['1'].get_string();
	end if;
	if ((json_nameGroup.get('2') IS NOT NULL AND (json_nameGroup.get('2'))::text <> '')) then
		r_nad_w.givenName :=  json_nameGroup.get['2'].get_string();
	end if;
	if ((json_nameGroup.get('3') IS NOT NULL AND (json_nameGroup.get('3'))::text <> '')) then
		r_nad_w.title :=  json_nameGroup.get['3'].get_string();
	end if;
	if ((json_nameGroup.get('4') IS NOT NULL AND (json_nameGroup.get('4'))::text <> '')) then
		r_nad_w.street :=  json_nameGroup.get['4'].get_string();
	end if;
	if ((json_nameGroup.get('5') IS NOT NULL AND (json_nameGroup.get('5'))::text <> '')) then
		r_nad_w.caseNumber :=  json_nameGroup.get['5'].get_string();
	end if;

	r_nad_w.city	:=	ds_city_w;
	r_nad_w.zipCode	:=	ds_zipCode_w;
	$end
	return	r_nad_w;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION medical_net_pck.process_edifact_nad (edifact_message_p text) FROM PUBLIC;
