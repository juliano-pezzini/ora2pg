-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_bed_requests.get_admission_orders ( cd_establishment_p bigint, cd_unit_classification_p text default null, cd_unit_p bigint default null, ie_hospital_occupancy_p text default PFCS_PCK_CONSTANTS.IE_NO) RETURNS bigint AS $body$
DECLARE

        qt_admission_orders_w integer := 0;

BEGIN
        select coalesce(sum(p.vl_indicator), 0)
        into STRICT qt_admission_orders_w
        from pfcs_panel p
        where p.nr_seq_indicator = PFCS_PCK_INDICATORS.NR_ICU_ADMISSION_ORDERS
            and p.ie_situation = PFCS_PCK_CONSTANTS.IE_ACTIVE
            and p.nr_seq_operational_level = cd_establishment_p
            and p.cd_reference_aux = coalesce(cd_unit_classification_p, p.cd_reference_aux)
            and p.cd_reference_value = coalesce(to_char(cd_unit_p), p.cd_reference_value)
            and (ie_hospital_occupancy_p = PFCS_PCK_CONSTANTS.IE_NO or
                    pfcs_pck_utils.get_ie_hospital_occupancy(isnumber(p.cd_reference_value)) = PFCS_PCK_CONSTANTS.IE_YES_BR);
        return qt_admission_orders_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_bed_requests.get_admission_orders ( cd_establishment_p bigint, cd_unit_classification_p text default null, cd_unit_p bigint default null, ie_hospital_occupancy_p text default PFCS_PCK_CONSTANTS.IE_NO) FROM PUBLIC;
