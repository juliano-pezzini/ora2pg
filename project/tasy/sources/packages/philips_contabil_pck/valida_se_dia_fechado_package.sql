-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE philips_contabil_pck.valida_se_dia_fechado (cd_empresa_p bigint, dt_parametro_p timestamp) AS $body$
BEGIN
		PERFORM set_config('philips_contabil_pck.dt_referencia_w', pkg_date_utils.start_of(dt_parametro_p, 'MM'), false);
		PERFORM set_config('philips_contabil_pck.dt_fech_diario_w', philips_contabil_pck.get_fech_diario(cd_empresa_p, current_setting('philips_contabil_pck.dt_referencia_w')::ctb_mes_ref.dt_referencia%type), false);

		if (trunc(dt_parametro_p) <= trunc(current_setting('philips_contabil_pck.dt_fech_diario_w')::ctb_mes_ref.dt_fech_diario%type)) then
      		CALL wheb_mensagem_pck.exibir_mensagem_abort(1129447, 'DT_OPERACAO=' 	|| dt_parametro_p 	||
                                                      		 ';DT_FECHAMENTO=' 	|| current_setting('philips_contabil_pck.dt_fech_diario_w')::ctb_mes_ref.dt_fech_diario%type 	||
                                                      		 ';CD_COD_EMPRESA=' 	|| cd_empresa_p 	||
                                                      		 ';DS_EMPRESA=' 	|| obter_nome_empresa(cd_empresa_p));
		end if;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE philips_contabil_pck.valida_se_dia_fechado (cd_empresa_p bigint, dt_parametro_p timestamp) FROM PUBLIC;
