-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE reg_documento_pck.solicitar_acesso_repo ( nr_seq_repositorio_p repositorio_reg_documento.nr_sequencia%type, ds_motivo_solicitacao_p text, nm_usuario_p text ) AS $body$
DECLARE

		nm_usuario_resp_w 	REPOSITORIO_REG_DOCUMENTO.NM_USUARIO_RESP%type;
	
BEGIN
	
		select 	nm_usuario_resp
		into STRICT 	nm_usuario_resp_w
		from 	repositorio_reg_documento
		where 	nr_sequencia = nr_seq_repositorio_p;

		insert into REG_SOL_ACESSO_REPOSITORIO(
			NR_SEQUENCIA,
			NR_SEQ_REPOSITORIO,
			NM_USUARIO_RESP,
			DT_ATUALIZACAO,
			NM_USUARIO,
			DT_ATUALIZACAO_NREC,
			NM_USUARIO_NREC,
			NM_USUARIO_SOLICITANTE,
			DS_MOTIVO_SOLICITACAO
		) values (
			nextval('reg_sol_acesso_repositorio_seq'),
			nr_seq_repositorio_p,
			nm_usuario_resp_w,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			nm_usuario_p,
			ds_motivo_solicitacao_p
		);

		commit;
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_documento_pck.solicitar_acesso_repo ( nr_seq_repositorio_p repositorio_reg_documento.nr_sequencia%type, ds_motivo_solicitacao_p text, nm_usuario_p text ) FROM PUBLIC;
