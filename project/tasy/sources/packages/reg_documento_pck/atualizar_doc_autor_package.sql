-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE reg_documento_pck.atualizar_doc_autor ( nr_seq_revision_p reg_version_revision.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type ) AS $body$
DECLARE


		ds_doc_structure_w		reg_doc_revisor.ds_doc_structure%type;
		ie_doc_extension_w		reg_doc_revisor.ie_doc_extension%type;
		nr_seq_doc_revisor_w		reg_doc_revisor.nr_sequencia%type;
		nr_seq_documento_w		reg_version_revision.nr_seq_documento%type;

		
BEGIN

		if (nr_seq_revision_p IS NOT NULL AND nr_seq_revision_p::text <> '') then

			select	rvr.nr_seq_documento,
				rvr.ds_doc_structure,
				rvr.ie_doc_extension
			into STRICT	nr_seq_documento_w,
				ds_doc_structure_w,
				ie_doc_extension_w
			from	reg_version_revision rvr
			where	rvr.nr_sequencia = nr_seq_revision_p;
			
			if (nr_seq_documento_w IS NOT NULL AND nr_seq_documento_w::text <> '') then
				select	a.nr_sequencia
				into STRICT	nr_seq_doc_revisor_w
				from	reg_doc_revisor a
				where 	a.nr_seq_documento = nr_seq_documento_w
				and	ie_tipo_revisor = 'C';
				
				update	reg_doc_revisor
				set	ds_doc_structure = ds_doc_structure_w,
					ie_doc_extension = ie_doc_extension_w,
					dt_atualizacao = clock_timestamp(),
					nm_usuario = nm_usuario_p
				where	nr_sequencia = nr_seq_doc_revisor_w;
			end if;
		end if;

		commit;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE reg_documento_pck.atualizar_doc_autor ( nr_seq_revision_p reg_version_revision.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type ) FROM PUBLIC;
