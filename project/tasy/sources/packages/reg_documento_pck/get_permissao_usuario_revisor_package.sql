-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION reg_documento_pck.get_permissao_usuario_revisor ( nr_seq_documento_p reg_documento.nr_sequencia%type, ie_tipo_revisor_p text, nm_usuario_revisor_p usuario.nm_usuario%type ) RETURNS varchar AS $body$
DECLARE

	
		ie_permissao_w		varchar(1);
	
		
BEGIN
		
			if (ie_tipo_revisor_p <> 'C') then
			--caso queira cadastrar um REVIEWER ou APPROVER 
			--verificar se existe um OWNER com o mesmo usuario
				select 	CASE WHEN count(1)=0 THEN  'S'  ELSE 'N' END
				into STRICT 	ie_permissao_w
				from 	reg_doc_revisor 
				where 	nr_seq_documento = nr_seq_documento_p
				and	ie_tipo_revisor = 'C'
				and 	nm_usuario_revisor = nm_usuario_revisor_p;
			else
			--caso queira cadastrar o OWNER
			--verificar se existe um REVIEWER ou APPROVER com o mesmo usuario
				select 	CASE WHEN count(1)=0 THEN  'S'  ELSE 'N' END
				into STRICT 	ie_permissao_w
				from 	reg_doc_revisor 
				where 	nr_seq_documento = nr_seq_documento_p
				and	ie_tipo_revisor <> 'C'
				and 	nm_usuario_revisor = nm_usuario_revisor_p;
			end if;
		
		return ie_permissao_w;
		
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION reg_documento_pck.get_permissao_usuario_revisor ( nr_seq_documento_p reg_documento.nr_sequencia%type, ie_tipo_revisor_p text, nm_usuario_revisor_p usuario.nm_usuario%type ) FROM PUBLIC;
