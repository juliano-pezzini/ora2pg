-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_hl7_pck.copiar_hl7_segm_atrib_original (nr_sequencia_p bigint, nr_seq_mensagem_p bigint, nr_seq_atrib_p bigint) AS $body$
DECLARE

        nr_sequencia_w bigint;
        c01 CURSOR FOR
            SELECT * from wheb_hl7_segmento a where nr_sequencia = nr_sequencia_p;

        hl7_segmento_w c01%rowtype;

    
BEGIN
    
        open c01;
        loop
            fetch c01
                into hl7_segmento_w;
            EXIT WHEN NOT FOUND; /* apply on c01 */
            begin

                $if $$tasy_local_dict=true $then
                nr_sequencia_w := get_remote_sequence('seq:hl7_segmento_seq');
                $else
                select nextval('hl7_segmento_seq') into STRICT nr_sequencia_w;
                $end

                insert into hl7_segmento(nr_sequencia,
                     nr_seq_apresentacao,
                     nr_seq_mensagem,
                     nm_segmento,
                     ds_segmento,
                     ds_sql,
                     nm_usuario,
                     dt_atualizacao,
                     nm_usuario_nrec,
                     dt_atualizacao_nrec,
                     ie_criar_segmento,
                     ie_tipo)
                values (nr_sequencia_w,
                     hl7_segmento_w.nr_seq_apresentacao,
                     nr_seq_mensagem_p,
                     hl7_segmento_w.nm_segmento,
                     hl7_segmento_w.ds_segmento,
                     hl7_segmento_w.ds_sql,
                     wheb_usuario_pck.get_nm_usuario,
                     clock_timestamp(),
                     wheb_usuario_pck.get_nm_usuario,
                     clock_timestamp(),
                     hl7_segmento_w.ie_criar_segmento,
                     hl7_segmento_w.ie_tipo);

                update hl7_atributo set nr_seq_atrib_segm = nr_sequencia_w where nr_sequencia = nr_seq_atrib_p;

                CALL wheb_hl7_pck.copiar_hl7_atributo_original(nr_sequencia_p, nr_sequencia_w, nr_seq_mensagem_p);

            end;
        end loop;
        close c01;
    end;


$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE wheb_hl7_pck.copiar_hl7_segm_atrib_original (nr_sequencia_p bigint, nr_seq_mensagem_p bigint, nr_seq_atrib_p bigint) FROM PUBLIC;
