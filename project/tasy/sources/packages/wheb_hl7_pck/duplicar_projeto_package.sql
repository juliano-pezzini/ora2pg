-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_hl7_pck.duplicar_projeto (nr_seq_projeto_p bigint) AS $body$
DECLARE

        c01 CURSOR FOR
            SELECT ie_versao_oficial,
                   ds_projeto,
                   ds_observacao,
                   cd_versao,
                   ie_situacao,
                   nr_seq_versao_oficial
              from hl7_projeto
             where nr_sequencia = nr_seq_projeto_p;

        hl7_projeto_w c01%rowtype;

BEGIN
        PERFORM set_config('wheb_hl7_pck.nr_seq_proj_old_w', nr_seq_projeto_p, false);

        CALL wheb_usuario_pck.set_ie_executar_trigger('N');

        $if $$tasy_local_dict=true $then
        PERFORM set_config('wheb_hl7_pck.nr_seq_proj_new_w', get_remote_sequence('seq:hl7_projeto_seq'), false);
        $else
        select nextval('hl7_projeto_seq') into STRICT current_setting('wheb_hl7_pck.nr_seq_proj_new_w')::bigint;
        $end

        open c01;
        loop
            fetch c01
                into hl7_projeto_w;
            EXIT WHEN NOT FOUND; /* apply on c01 */
            begin
                insert into hl7_projeto(nr_sequencia,
                     ie_versao_oficial,
                     ds_projeto,
                     ds_observacao,
                     cd_versao,
                     ie_situacao,
                     nr_seq_versao_oficial,
                     dt_atualizacao,
                     nm_usuario,
                     dt_atualizacao_nrec,
                     nm_usuario_nrec)
                values (current_setting('wheb_hl7_pck.nr_seq_proj_new_w')::bigint,
                     'N',
                     'C'||chr(243)||'pia ' || hl7_projeto_w.ds_projeto,
                     hl7_projeto_w.ds_observacao,
                     hl7_projeto_w.cd_versao,
                     hl7_projeto_w.ie_situacao,
                     nr_seq_projeto_p,
                     clock_timestamp(),
                     wheb_usuario_pck.get_nm_usuario,
                     clock_timestamp(),
                     wheb_usuario_pck.get_nm_usuario);
            end;
            CALL wheb_hl7_pck.copiar_hl7_mensagem(current_setting('wheb_hl7_pck.nr_seq_proj_old_w')::bigint, null, null);
        end loop;
        close c01;
        commit;
        CALL wheb_usuario_pck.set_ie_executar_trigger('S');
    end;


$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE wheb_hl7_pck.duplicar_projeto (nr_seq_projeto_p bigint) FROM PUBLIC;
