-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_hl7_pck.deletar_hl7_segmento (nr_seq_segmento_p bigint) AS $body$
DECLARE


        nr_sequencia_w      bigint;
        nr_seq_atrib_segm_w bigint;

        c01 CURSOR FOR
            SELECT nr_sequencia,
                   nr_seq_atrib_segm
              from hl7_atributo
             where nr_seq_segmento = nr_seq_segmento_p;

BEGIN
    
        if (wheb_usuario_pck.get_nm_usuario = 'Luis') then
            CALL wheb_usuario_pck.set_ie_executar_trigger('N');
        end if;

        open c01;
        loop
            fetch c01
                into nr_sequencia_w,
                     nr_seq_atrib_segm_w;
            EXIT WHEN NOT FOUND; /* apply on c01 */
            begin
                delete from hl7_atributo where nr_sequencia = nr_sequencia_w;

                CALL wheb_hl7_pck.deletar_hl7_segmento(nr_seq_atrib_segm_w);
            end;
        end loop;
        close c01;

        delete from hl7_segmento where nr_sequencia = nr_seq_segmento_p;

        CALL wheb_usuario_pck.set_ie_executar_trigger('S');

    end;

    --copiar as informacoes de segmentos (atributos do sql)



$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE wheb_hl7_pck.deletar_hl7_segmento (nr_seq_segmento_p bigint) FROM PUBLIC;
