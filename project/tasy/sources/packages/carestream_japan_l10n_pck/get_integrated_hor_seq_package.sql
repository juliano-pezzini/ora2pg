-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


    
    /** 
	+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Get the sequence of an integrated order from prescr_proc_hor table 
	+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   **/
 


CREATE OR REPLACE FUNCTION carestream_japan_l10n_pck.get_integrated_hor_seq (nr_prescricao_p bigint, nr_sequencia_p bigint, nr_seq_proc_interno_p bigint, cd_estabelecimento_p bigint, nr_seq_sistema_integ_p bigint) RETURNS varchar AS $body$
DECLARE


    proc_hor_sequence_w bigint;

BEGIN

        select  max(e.nr_sequencia)
            into STRICT proc_hor_sequence_w
        from    proc_interno_integracao b,
                    proc_interno c,
                    procedimento d,
                    prescr_proc_hor e
        where  c.nr_sequencia = nr_seq_proc_interno_p
        and     coalesce(b.nr_seq_proc_interno, c.nr_sequencia) = nr_seq_proc_interno_p
        and     c.cd_procedimento = d.cd_procedimento
        and     c.ie_origem_proced = d.ie_origem_proced
        and     coalesce(b.cd_estabelecimento, cd_estabelecimento_p) = coalesce(cd_estabelecimento_p,0)
        and     coalesce(b.cd_tipo_procedimento,coalesce( d.cd_tipo_procedimento,0)) = coalesce(d.cd_tipo_procedimento,0)
        and     b.nr_seq_sistema_integ = nr_seq_sistema_integ_p
        and     e.nr_prescricao = nr_prescricao_p
        and     e.nr_seq_procedimento = nr_sequencia_p
        and     (e.dt_suspensao IS NOT NULL AND e.dt_suspensao::text <> '');

    return proc_hor_sequence_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION carestream_japan_l10n_pck.get_integrated_hor_seq (nr_prescricao_p bigint, nr_sequencia_p bigint, nr_seq_proc_interno_p bigint, cd_estabelecimento_p bigint, nr_seq_sistema_integ_p bigint) FROM PUBLIC;
