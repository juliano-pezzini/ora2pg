-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--------------------------------------------------------------------------------01100 Consultas transacoes Respondidas pelo WSD---------------------------------------------------------------------------------------------------------------------------------------------------



CREATE OR REPLACE PROCEDURE ptu_env_pck.ptu_env_a1100_v70 ( nm_usuario_p usuario.nm_usuario%type, dt_solicitacao_p ptu_consulta_a1100.dt_solicitacao%type, nr_seq_pedido_novo_p INOUT ptu_pedido_autorizacao.nr_sequencia%type) AS $body$
DECLARE


cd_cgc_outorgante_w		pls_outorgante.cd_cgc_outorgante%type;
cd_cooperativa_w		pls_congenere.cd_cooperativa%type;


BEGIN

select	max(cd_cgc_outorgante)
into STRICT	cd_cgc_outorgante_w
from	pls_outorgante;

select	max(cd_cooperativa)
into STRICT	cd_cooperativa_w
from	pls_congenere
where	cd_cgc			= cd_cgc_outorgante_w
and	(cd_cooperativa IS NOT NULL AND cd_cooperativa::text <> '');

select	nextval('ptu_consulta_a1100_seq')
into STRICT	nr_seq_pedido_novo_p
;

insert	into ptu_consulta_a1100(
		nr_sequencia, cd_transacao, ie_tipo_cliente,
		dt_atualizacao, nm_usuario, dt_atualizacao_nrec,
		nm_usuario_nrec, nr_versao, cd_unimed_solicitante,
		dt_solicitacao)
values (	nr_seq_pedido_novo_p, '01100', 'U',
		clock_timestamp(), nm_usuario_p, clock_timestamp(),
		nm_usuario_p, pls_obter_versao_scs, cd_cooperativa_w,
		dt_solicitacao_p);

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_env_pck.ptu_env_a1100_v70 ( nm_usuario_p usuario.nm_usuario%type, dt_solicitacao_p ptu_consulta_a1100.dt_solicitacao%type, nr_seq_pedido_novo_p INOUT ptu_pedido_autorizacao.nr_sequencia%type) FROM PUBLIC;
