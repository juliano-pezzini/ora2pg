-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE qt_prescricao_md_pck.prescrever (particao_p bigint, dose_p bigint, particao_medicamentos_p bigint, tolerancia_p bigint) AS $body$
DECLARE


    medicamento_w qt_prescricao_pck.medicamento;
    medicamentos_w qt_prescricao_pck.medicamento_vetor;
    nr_particao_w bigint;

    medicamentos_da_particao CURSOR FOR
    SELECT  *
    from    qt_medic_disponivel_prescr
    where   nr_particao = nr_particao_w;


BEGIN
        nr_particao_w := particao_medicamentos_p;

        for item in medicamentos_da_particao loop
            medicamento_w.codigo := item.cd_material;
            medicamento_w.nome := item.ds_material;
            medicamento_w.dose := item.qt_dose;
            medicamento_w.unidade_medida := item.cd_unidade_medida;
            medicamento_w.quantidade := item.qt_quantidade;

			medicamentos_w(medicamentos_w.count) := medicamento_w;
        end loop;

        CALL qt_prescricao_md_pck.prescrever_internal(particao_p, dose_p, medicamentos_w, tolerancia_p);
    end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qt_prescricao_md_pck.prescrever (particao_p bigint, dose_p bigint, particao_medicamentos_p bigint, tolerancia_p bigint) FROM PUBLIC;
