-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE panorama_leito_pck.gerar_w_surgery_status_54 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) AS $body$
DECLARE



	ds_surgery_status_w	varchar(1000)	:= null;
	ds_img_address_w	varchar(1000)	:= null;
	ie_surgery_status_w	varchar(2);
	nr_seq_legenda_w	bigint;

	
BEGIN


	select	max(obter_status_paciente_painel(	a.dt_analise,
							a.dt_chegada,
							a.dt_paciente_aguardo,
							a.dt_alta_cc,
							a.dt_chamada_pre_inducao,
							a.dt_sala_recuperacao,
							a.dt_chegada_fim,
							a.dt_saida_paciente_cc,
							a.ie_status_agenda))
	into STRICT	ie_surgery_status_w
	from	agenda_paciente a,
		cirurgia b
	where	a.nr_cirurgia	= b.nr_cirurgia
	and	b.nr_atendimento = nr_atendimento_p
	and	b.dt_inicio_prevista between trunc(clock_timestamp() - interval '1 days') and fim_dia(clock_timestamp());

	if	(ie_surgery_status_w IS NOT NULL AND ie_surgery_status_w::text <> '')  then
		nr_seq_legenda_w := panorama_leito_pck.get_surgery_status_leg(ie_surgery_status_w);

		if (coalesce(nr_seq_legenda_w, 0) > 0) then
			select 	max(obter_desc_expressao(a.cd_exp_legenda)),
				max('assets/' || b.ds_dir_img_server)
			into STRICT	ds_surgery_status_w,
				ds_img_address_w
			from 	tasy_padrao_imagem a,
				tasy_padrao_imagem_html b
			where 	b.nr_sequencia = a.nr_seq_img_html
			and 	a.nr_seq_legenda = 1716
			and	a.nr_sequencia = nr_seq_legenda_w;

			CALL panorama_leito_pck.insert_ocorrencia(nr_atendimento_p,
					54,
					ds_img_address_w,
					ds_img_address_w,
					834493 , /* Surgery status */
					1097046,
					null,
					null,
					ds_surgery_status_w,
					54,
					pIeConcluido);
		end if;
	end if;
	exception
	when others then
		null;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE panorama_leito_pck.gerar_w_surgery_status_54 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) FROM PUBLIC;
