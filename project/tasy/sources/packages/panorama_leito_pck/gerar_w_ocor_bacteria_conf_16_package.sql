-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


	/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
	----------------------------- 17---------------------------------
	XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
	/*procedure	gerar_w_ocor_alta_medica_17(nr_atendimento_p number,
											cd_estabelecimento_p	number,
											nm_usuario_p		varchar2,
                                            pIeConcluido varchar2) is

	ds_alerta_w	varchar2(100);
	dt_alerta_w	date;
	begin

	ds_alerta_w := null;

	select	max(dt_alta_medico)
	into 	dt_alerta_w
	from	atendimento_paciente
	where	nr_atendimento = nr_atendimento_p;

	select	to_char(dt_alerta_w, pkg_date_formaters.localize_mask('date(shortDate)',pkg_date_formaters.getUserLanguageTag(cd_estabelecimento_p,nm_usuario_p)))
	into	ds_alerta_w
	from	dual;

	if	(ds_alerta_w is not null) then
		panorama_leito_pck.insert_ocorrencia(nr_atendimento_p,
					17,
					'assets/icons/status-and-feedback/physician-arrow-up.svg',
					'assets/icons/status-and-feedback/physician-arrow-up.svg',
					309145, /* Alta medica
					967930,
					null,
					966278,
					ds_alerta_w,
					3,
                    pIeConcluido);
	end if;

	end gerar_w_ocor_alta_medica_17;*/
	/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
	----------------------------- 2---------------------------------
	XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
	/*procedure	gerar_w_ocor_aniversario_2(	nr_atendimento_p	number,
											cd_pessoa_fisica_p	varchar2) is

	ds_alerta_w		varchar2(4000);
	dt_nascimento_w	date;

	begin
	select	dt_nascimento
	into	dt_nascimento_w
	from	pessoa_fisica
	where	cd_pessoa_fisica	= cd_pessoa_fisica_p;

	if	(to_char(dt_nascimento_w,'dd/mm') = to_char(sysdate,'dd/mm')) then
		ds_alerta_w := substr(obter_se_aniversario_paciente(cd_pessoa_fisica_p),1,4000);

		panorama_leito_pck.insert_ocorrencia(nr_atendimento_p,
				2,
				'assets/icons/status-and-feedback/cake.svg',
				'assets/icons/status-and-feedback/cake.svg',
				310540, /* Aniversario*/
				/*967932,
				null,
				null,
				ds_alerta_w,
				4);
	end if;

	end gerar_w_ocor_aniversario_2;*/
	/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
	----------------------------- 16 ---------------------------------
	XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
CREATE OR REPLACE PROCEDURE panorama_leito_pck.gerar_w_ocor_bacteria_conf_16 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) AS $body$
DECLARE


	ds_alerta_w	varchar(10000)	:= null;
	ie_pac_mr_w			varchar(5);
	ie_pac_isol_w		varchar(5);

	
BEGIN

	ie_pac_mr_w		:=	Obter_se_paciente_MR(nr_atendimento_p);
	ie_pac_isol_w	:=	obter_se_pac_isolamento(nr_atendimento_p);

	if (ie_pac_mr_w = 'S') and (ie_pac_isol_w = 'S') then

		ds_alerta_w := substr(Obter_desc_MR(nr_atendimento_p) || ' - ' || obter_desc_precaucao_atend(nr_atendimento_p, 'P'), 1, 4000);

		CALL panorama_leito_pck.insert_ocorrencia(nr_atendimento_p,
				16,
				'assets/icons/status-and-feedback/bacteria-check.svg',
				'assets/icons/status-and-feedback/bacteria-check.svg',
				654195, /* Bacteria confirmada */
				967929,
				null,
				988847,
				ds_alerta_w,
				1,
                pIeConcluido);
	end if;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE panorama_leito_pck.gerar_w_ocor_bacteria_conf_16 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) FROM PUBLIC;
