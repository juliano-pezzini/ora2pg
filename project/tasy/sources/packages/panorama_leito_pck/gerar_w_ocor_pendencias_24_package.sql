-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


	/*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
	----------------------------- 24 ---------------------------------
	XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*/
CREATE OR REPLACE PROCEDURE panorama_leito_pck.gerar_w_ocor_pendencias_24 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) AS $body$
DECLARE


		ds_material_w		material.ds_material%type;

		C01 CURSOR FOR
			SELECT	distinct obter_desc_material(a.cd_material)
			from	cpoe_material a,
					prescr_material b,
					prescr_mat_hor c
			where	a.nr_sequencia = b.nr_seq_mat_cpoe
			and		b.nr_prescricao = c.nr_prescricao
			and 	b.nr_sequencia = c.nr_seq_material
			and 	c.ie_horario_especial = 'S'
			and 	coalesce(a.dt_fim::text, '') = ''
			and		coalesce(a.dt_suspensao::text, '') = ''
			and		(a.ie_urgencia IS NOT NULL AND a.ie_urgencia::text <> '')
			and		coalesce(c.dt_fim_horario::text, '') = ''
			and		a.nr_atendimento = nr_atendimento_p;

	
BEGIN

		open C01;
		loop
		fetch C01 into
			ds_material_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
			begin
				CALL panorama_leito_pck.insert_ocorrencia(nr_atendimento_p,
								  24,
								  'assets//icons/status-and-feedback/moderate-warning.svg',
								  'assets//icons/status-and-feedback/moderate-warning.svg',
								  885116,
								  null,
								  null,
								  null,
								  ds_material_w,
								  18,
								  pIeConcluido);
			end;
		end loop;
		close C01;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE panorama_leito_pck.gerar_w_ocor_pendencias_24 ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, pIeConcluido text) FROM PUBLIC;
