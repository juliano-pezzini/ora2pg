-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE panorama_leito_pck.inserepaninfoadicional (pIeConcluido text, nr_seq_interno_p bigint, ie_paciente_p text, ie_leito_p text, nm_usuario_p text, cd_estabelecimento_p bigint) AS $body$
DECLARE

        dt_historico_manutencao_w       timestamp;
       	ds_motivo_manutencao_w          varchar(80);
        dt_prevista_w                   timestamp;
        dt_inicio_w                     timestamp;
        ds_servico_w                    varchar(80);
        nm_prof_previsto_w              varchar(60);
        ds_executor_w                   varchar(40);
        dt_historico_interdicao_w       timestamp;
        ds_motivo_interdicao_w          varchar(60);
        nm_acompanhante_w	            varchar(255);
        nr_atendimento_w	            atendimento_paciente.nr_atendimento%type;
        dt_historico_isolamento_w	    timestamp;
        ds_motivo_isolamento_w		    varchar(255);
        nm_paciente_reserva_w		    varchar(255);
        ie_solicitacao_reserva_pend_w   smallint;
        cd_departamento_w	            departamento_medico.cd_departamento%type;
        ie_pflegegrad_w                 varchar(4000);
        nm_paciente_w                   varchar(255);
        w_ds_valor_dominio              valor_dominio_v.ds_valor_dominio%TYPE;
        ie_protocol_gerenciado          varchar(1);


BEGIN

        if (ie_paciente_p = 'S') then
		begin
            for r_c_atendimento in current_setting('panorama_leito_pck.c_atendimento')::CURSOR(nr_seq_interno_p(nr_seq_interno_p, nm_usuario_p, cd_estabelecimento_p) loop

      		if (r_c_atendimento.ds_tipo_remocao IS NOT NULL AND r_c_atendimento.ds_tipo_remocao::text <> '') then
		    CALL panorama_leito_pck.insert_inf_adic(90,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,1026642,1163651,r_c_atendimento.ds_tipo_remocao,null,null,90,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
		end if;

		if (r_c_atendimento.dt_previsto_alta IS NOT NULL AND r_c_atendimento.dt_previsto_alta::text <> '') then
		    CALL panorama_leito_pck.insert_inf_adic(75,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309369,1065031,r_c_atendimento.dt_previsto_alta,null,r_c_atendimento.dt_previsto_alta,75,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
		end if;

		if (r_c_atendimento.ds_classif_esp_pac IS NOT NULL AND r_c_atendimento.ds_classif_esp_pac::text <> '') then
		    CALL panorama_leito_pck.insert_inf_adic(69,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,285109,1061836,r_c_atendimento.ds_classif_esp_pac,null,null,69,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica , r_c_atendimento.nr_atendimento);
		end if;

                if (r_c_atendimento.dt_nascimento IS NOT NULL AND r_c_atendimento.dt_nascimento::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(2,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,287065,968853,r_c_atendimento.dt_nascimento,null,r_c_atendimento.dt_nascimento,2,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.dt_obito IS NOT NULL AND r_c_atendimento.dt_obito::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(66,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,286749,1058604,r_c_atendimento.dt_obito,null,r_c_atendimento.dt_obito,66,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ie_fator_rh IS NOT NULL AND r_c_atendimento.ie_fator_rh::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(67,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,290015,1058609,r_c_atendimento.ie_fator_rh,null,null,67,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ie_tipo_sangue IS NOT NULL AND r_c_atendimento.ie_tipo_sangue::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(68,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,299998,1058610,r_c_atendimento.ie_tipo_sangue,null,null,68,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
                if (r_c_atendimento.ie_sexo IS NOT NULL AND r_c_atendimento.ie_sexo::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(3,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,298476,968960,r_c_atendimento.ie_sexo,null,null,3,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_convenio IS NOT NULL AND r_c_atendimento.ds_convenio::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(4,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,696048,968976,r_c_atendimento.ds_convenio,null,null,4,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_plano_convenio IS NOT NULL AND r_c_atendimento.ds_plano_convenio::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(5,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,697043,969125,r_c_atendimento.ds_plano_convenio,null,null,5,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_clinica IS NOT NULL AND r_c_atendimento.ds_clinica::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(6,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,284962,969181,r_c_atendimento.ds_clinica,null,null,7, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.nr_dias_internado IS NOT NULL AND r_c_atendimento.nr_dias_internado::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(7,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,692411,1024110,null,r_c_atendimento.nr_dias_internado,null,8, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_vaga IS NOT NULL AND r_c_atendimento.ds_vaga::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(8,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,298850,969267,r_c_atendimento.ds_vaga,null,null,9, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_escalas IS NOT NULL AND r_c_atendimento.ds_escalas::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(9,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,308877,969272,r_c_atendimento.ds_escalas,null,null,10, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                /*Utilizado para estrutura case*/

                if (r_c_atendimento.nr_atendimento IS NOT NULL AND r_c_atendimento.nr_atendimento::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(11,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,283863,969291,null,r_c_atendimento.nr_atendimento,null,1, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                /* Informacoes adicionais para localizacao - novas
                Esses campos ficarao com NR_SEQ_APRES null para nao listar por padrao */
                if (r_c_atendimento.nr_seq_episodio IS NOT NULL AND r_c_atendimento.nr_seq_episodio::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(28,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,783146,969276,null,r_c_atendimento.nr_seq_episodio,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                cd_departamento_w	:= obter_departamento_data(r_c_atendimento.nr_atendimento);
                if (cd_departamento_w IS NOT NULL AND cd_departamento_w::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(29,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,332098,969277,obter_nome_departamento_medico(cd_departamento_w),null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

				if (r_c_atendimento.ds_score_flex IS NOT NULL AND r_c_atendimento.ds_score_flex::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(76,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,313958,1069291,r_c_atendimento.ds_score_flex,null,null,null, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ds_score_flex_II IS NOT NULL AND r_c_atendimento.ds_score_flex_II::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(77,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,313969,1069676,r_c_atendimento.ds_score_flex_II,null,null,null, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;

                if (r_c_atendimento.ds_nivel_complexidade IS NOT NULL AND r_c_atendimento.ds_nivel_complexidade::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(30,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,859709,996138,r_c_atendimento.ds_nivel_complexidade,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_diagnostico IS NOT NULL AND r_c_atendimento.ds_diagnostico::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(32,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,287694,1022593,r_c_atendimento.ds_diagnostico,null,null,6,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_colab_resp IS NOT NULL AND r_c_atendimento.nm_colab_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(33,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,714994,1022634,r_c_atendimento.nm_colab_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_pontos IS NOT NULL AND r_c_atendimento.qt_pontos::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(34,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309327,1022649,r_c_atendimento.qt_pontos,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_gradacao2 IS NOT NULL AND r_c_atendimento.ds_gradacao2::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(35,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309328,1022671,r_c_atendimento.ds_gradacao2,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

		if (r_c_atendimento.ds_gradacao1 IS NOT NULL AND r_c_atendimento.ds_gradacao1::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(61,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309312,1052766,r_c_atendimento.ds_gradacao1,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

		if (r_c_atendimento.ds_gradacao3 IS NOT NULL AND r_c_atendimento.ds_gradacao3::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(62,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309329,1052768,r_c_atendimento.ds_gradacao3,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

		if (r_c_atendimento.ds_gradacao4 IS NOT NULL AND r_c_atendimento.ds_gradacao4::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(63,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,686100,1052769,r_c_atendimento.ds_gradacao4,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_ponto_nut IS NOT NULL AND r_c_atendimento.qt_ponto_nut::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(36,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309319,1022693,r_c_atendimento.qt_ponto_nut,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

		if (r_c_atendimento.qt_ponto_nut2 IS NOT NULL AND r_c_atendimento.qt_ponto_nut2::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(65,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,854589,1053077,r_c_atendimento.qt_ponto_nut2,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

		if (r_c_atendimento.ds_escalas_panorama IS NOT NULL AND r_c_atendimento.ds_escalas_panorama::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(64,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,308877,969272,r_c_atendimento.ds_escalas_panorama,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_anotacao IS NOT NULL AND r_c_atendimento.ds_anotacao::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(37,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,308100,1022887,r_c_atendimento.ds_anotacao,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.dt_cirurgia IS NOT NULL AND r_c_atendimento.dt_cirurgia::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(38,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,614821,1022890,r_c_atendimento.dt_cirurgia,null,r_c_atendimento.dt_cirurgia,null,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_tipo_isolamento_cih IS NOT NULL AND r_c_atendimento.ds_tipo_isolamento_cih::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(39,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,306717,1022904,r_c_atendimento.ds_tipo_isolamento_cih,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_escala_dor IS NOT NULL AND r_c_atendimento.qt_escala_dor::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(42,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,669692,1022924,r_c_atendimento.qt_escala_dor,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_escala_dor IS NOT NULL AND r_c_atendimento.ds_escala_dor::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(43,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,600756,1022945,r_c_atendimento.ds_escala_dor,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_nutricionista IS NOT NULL AND r_c_atendimento.nm_nutricionista::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(44,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,310527,1022946,r_c_atendimento.nm_nutricionista,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_dias_prev_inter IS NOT NULL AND r_c_atendimento.qt_dias_prev_inter::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(45,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,287749,1022953,r_c_atendimento.qt_dias_prev_inter,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_aval_nut IS NOT NULL AND r_c_atendimento.nm_aval_nut::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(46,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,738750,1022961,r_c_atendimento.nm_aval_nut,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.dt_escala_dor IS NOT NULL AND r_c_atendimento.dt_escala_dor::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(40,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309093,1022963,r_c_atendimento.dt_escala_dor,null,r_c_atendimento.dt_escala_dor,null,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_medico_resp IS NOT NULL AND r_c_atendimento.nm_medico_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(41,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,293157,1022986,r_c_atendimento.nm_medico_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_psicologo_resp IS NOT NULL AND r_c_atendimento.nm_psicologo_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(47,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,682758,1022992,r_c_atendimento.nm_psicologo_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_farmaceutico_resp IS NOT NULL AND r_c_atendimento.nm_farmaceutico_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(48,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,289984,1022995,r_c_atendimento.nm_farmaceutico_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_fisioterapeuta_resp IS NOT NULL AND r_c_atendimento.nm_fisioterapeuta_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(49,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,682744,1022997,r_c_atendimento.nm_fisioterapeuta_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_assistente_resp IS NOT NULL AND r_c_atendimento.nm_assistente_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(50,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,682746,1022999,r_c_atendimento.nm_assistente_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.nm_enf_resp IS NOT NULL AND r_c_atendimento.nm_enf_resp::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(51,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,682733,1023009,r_c_atendimento.nm_enf_resp,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.dt_entrada IS NOT NULL AND r_c_atendimento.dt_entrada::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(52,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,873779,1028751,r_c_atendimento.dt_entrada,null,r_c_atendimento.dt_entrada,null,'date(timestamp)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_dia_unidade IS NOT NULL AND r_c_atendimento.qt_dia_unidade::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(53,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,560060,1028880,r_c_atendimento.qt_dia_unidade,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.dt_diag_nutricional IS NOT NULL AND r_c_atendimento.dt_diag_nutricional::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(54,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,309331,1028885,r_c_atendimento.dt_diag_nutricional,null,r_c_atendimento.dt_diag_nutricional,null,'date(shortDate)',pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_nutricional IS NOT NULL AND r_c_atendimento.ds_nutricional::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(55,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,287708,1028886,r_c_atendimento.ds_nutricional,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_dieta_liberada IS NOT NULL AND r_c_atendimento.ds_dieta_liberada::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(57,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,287910,1028890,r_c_atendimento.ds_dieta_liberada,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_cirurgia IS NOT NULL AND r_c_atendimento.ds_cirurgia::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(58,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,316812,1028959,r_c_atendimento.ds_cirurgia,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;


                if (r_c_atendimento.qt_dia_perman_unid IS NOT NULL AND r_c_atendimento.qt_dia_perman_unid::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(70,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,744330,1064727,r_c_atendimento.qt_dia_perman_unid,null,null,70,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ds_tipo_vaga IS NOT NULL AND r_c_atendimento.ds_tipo_vaga::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(71,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,300053,1064728,r_c_atendimento.ds_tipo_vaga,null,null,71, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ds_prox_leito_desej IS NOT NULL AND r_c_atendimento.ds_prox_leito_desej::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(72,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,1064729,1064729,r_c_atendimento.ds_prox_leito_desej,null,null,72, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ds_classif_setor_solic IS NOT NULL AND r_c_atendimento.ds_classif_setor_solic::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(73,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,935780,1064735,r_c_atendimento.ds_classif_setor_solic,null,null,73, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
				if (r_c_atendimento.ds_lista_exame_agendado IS NOT NULL AND r_c_atendimento.ds_lista_exame_agendado::text <> '') then
					CALL panorama_leito_pck.insert_inf_adic(74,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,609024,1064736,r_c_atendimento.ds_lista_exame_agendado,null,null,74, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
				end if;
----------
                if (r_c_atendimento.ds_sae IS NOT NULL AND r_c_atendimento.ds_sae::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(59,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,297968,1033368,r_c_atendimento.ds_sae,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_tipo_episodio IS NOT NULL AND r_c_atendimento.ds_tipo_episodio::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(78,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,855574,1073621,r_c_atendimento.ds_tipo_episodio,null,null,null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_queixa_principal IS NOT NULL AND r_c_atendimento.ds_queixa_principal::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(80,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,297168,1159069,r_c_atendimento.ds_queixa_principal,null,null, 80, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_diagnostico_principal IS NOT NULL AND r_c_atendimento.ds_diagnostico_principal::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(81,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,341207,297305,r_c_atendimento.ds_diagnostico_principal,null,null, 81, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                if (r_c_atendimento.ds_diagnostico_admissao IS NOT NULL AND r_c_atendimento.ds_diagnostico_admissao::text <> '') then
                    CALL panorama_leito_pck.insert_inf_adic(82,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,722006,1159068,r_c_atendimento.ds_diagnostico_admissao,null,null, 82, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.qt_dia_uti IS NOT NULL AND r_c_atendimento.qt_dia_uti::text <> '') then
                   CALL panorama_leito_pck.insert_inf_adic(96,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,1057488,1172376,r_c_atendimento.qt_dia_uti,null,null, 96, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                 if (r_c_atendimento.qt_dia_hcu IS NOT NULL AND r_c_atendimento.qt_dia_hcu::text <> '') then
                   CALL panorama_leito_pck.insert_inf_adic(97,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,1057591,1172626,r_c_atendimento.qt_dia_hcu,null,null, 97, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.ds_popover_comentario IS NOT NULL AND r_c_atendimento.ds_popover_comentario::text <> '') then
                   CALL panorama_leito_pck.insert_inf_adic(98,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,285521,1172643,r_c_atendimento.ds_popover_comentario,null,null, 98, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                if (r_c_atendimento.protolo_gererenciado_qtd IS NOT NULL AND r_c_atendimento.protolo_gererenciado_qtd::text <> '') then
                    select CASE WHEN r_c_atendimento.protolo_gererenciado_qtd=0 THEN  'N'  ELSE 'S' END  ds
                    into STRICT ie_protocol_gerenciado;
                    CALL panorama_leito_pck.insert_inf_adic(79,r_c_atendimento.nr_seq_interno,r_c_atendimento.cd_unidade_basica,r_c_atendimento.cd_unidade_compl,296595,1122773,ie_protocol_gerenciado,null,null,null, null, pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;

                ie_pflegegrad_w := obter_pflegegrad(r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                if (ie_pflegegrad_w IS NOT NULL AND ie_pflegegrad_w::text <> '') then
                    select max(v_dom.ds_valor_dominio) as ds_valor_dominio
                    into STRICT w_ds_valor_dominio
                    from dominio dom
                        ,valor_dominio_v v_dom
                    where dom.cd_dominio = v_dom.cd_dominio
                    and dom.cd_dominio = 8674 -- Pflegegrad
                    and v_dom.vl_dominio = ie_pflegegrad_w;

                    CALL panorama_leito_pck.insert_inf_adic(31, r_c_atendimento.nr_seq_interno, r_c_atendimento.cd_unidade_basica, r_c_atendimento.cd_unidade_compl, 795203, 996681, w_ds_valor_dominio, null, null, null,null,pIeConcluido, r_c_atendimento.cd_pessoa_fisica, r_c_atendimento.nr_atendimento);
                end if;
                commit;
            end loop;
			exception when others then
            null;
            end;
        end if;

        if (ie_leito_p = 'S') then
            for r_c_leito in current_setting('panorama_leito_pck.c_leitos')::CURSOR(nr_seq_interno_p(nr_seq_interno_p) loop
                if (r_c_leito.ie_status_unidade = 'A') then
                    if (r_c_leito.nr_atendimento IS NOT NULL AND r_c_leito.nr_atendimento::text <> '') then
                        CALL panorama_leito_pck.insert_inf_adic(10,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,283863,969291,null,r_c_leito.nr_atendimento,null,1,null,pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(11,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,295156,969294,obter_pessoa_atendimento(r_c_leito.nr_atendimento, 'N'),null,null,2,null,pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(12,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,309145,969295,null,null,obter_dados_atendimento_dt(nr_atendimento_w, 'DAM'),3,'date(shortDate)', pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(13,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,283377,969298,null,null,obter_dados_atendimento_dt(nr_atendimento_w, 'DA'),4,'date(shortDate)', pIeConcluido);
                    end if;

                --CHAMADO MANUTENCAO
                --MANUTENCAO
                elsif (r_c_leito.ie_status_unidade = 'C') or (r_c_leito.ie_status_unidade = 'E') then
                    begin
                        select	a.dt_historico,
                                coalesce(substr(obter_desc_mot_manut(a.cd_motivo_manutencao),1,80), '327119')
                        into STRICT	dt_historico_manutencao_w,
                                ds_motivo_manutencao_w
                        from	unidade_atend_hist a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and 	coalesce(a.dt_fim_historico::text, '') = ''
                        and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
                        and 	a.dt_historico =
                                (SELECT	max(z.dt_historico)
                                from    unidade_atend_hist z
                                where   z.nr_seq_unidade = b.nr_seq_interno
                                and 	coalesce(z.dt_fim_historico::text, '') = ''
                                and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
                    exception
                        when others then
                        null;
                    end;

                    CALL panorama_leito_pck.insert_inf_adic(14,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,291978,969306,null,null,dt_historico_manutencao_w,1,'date(shortDate)', pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(15,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969307,ds_motivo_manutencao_w,null,null,2,null,pIeConcluido);

                --AGUARDANDO HIGIENIZACAO
                --EM HIGIENIZACAO
                elsif (r_c_leito.ie_status_unidade = 'G') or (r_c_leito.ie_status_unidade = 'H') then
                    begin
                        select	a.dt_inicio,
                                a.dt_prevista,
                                ('DS_SERV_' || a.NR_SEQ_SERVICO) ds_servico,
                                coalesce(substr(obter_nome_pf(a.cd_prof_previsto), 1, 60), '327119') nm_prof_previsto,
                                ('D_1811S_' || ie_executor ||'_E') ds_executor
                        into STRICT	dt_inicio_w,
                                dt_prevista_w,
                                ds_servico_w,
                                nm_prof_previsto_w,
                                ds_executor_w
                        from	sl_unid_atend a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and 	coalesce(a.dt_fim::text, '') = ''
                        and  	coalesce(a.dt_inicio::text, '') = ''
                        and 	a.dt_prevista =
                                (SELECT	min(z.dt_prevista)
                                from    sl_unid_atend z
                                where   z.nr_seq_unidade = a.nr_seq_unidade
                                and 	coalesce(z.dt_fim::text, '') = ''
                                and  	coalesce(z.dt_inicio::text, '') = '');
                    exception
                        when others then
                        null;
                    end;

                    if (r_c_leito.ie_status_unidade = 'G') then
                        CALL panorama_leito_pck.insert_inf_adic(16,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,314396,969308, null,null,dt_prevista_w,1,'date(shortDate)', pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(17,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969309,ds_servico_w,null,null,2,null,pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(18,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,310486,969313,nm_prof_previsto_w,null,null,3,null,pIeConcluido);
                    elsif (r_c_leito.ie_status_unidade = 'H') then
                        CALL panorama_leito_pck.insert_inf_adic(16,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,291978,969318,null,null,dt_inicio_w,1,'date(shortDate)', pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(17,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969309,ds_servico_w,null,null,2,null,pIeConcluido);
                        CALL panorama_leito_pck.insert_inf_adic(18,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,296514,969319,ds_executor_w,null,null,3,null,pIeConcluido);
                    end if;

                -- INTERDITADO
                elsif (r_c_leito.ie_status_unidade = 'I') then
                    begin
                        select	a.dt_historico,
                                coalesce(substr(OBTER_DESC_MOT_INTER(a.CD_MOTIVO_INTERDICAO),1,60), '327119')
                        into STRICT	dt_historico_interdicao_w,
                                ds_motivo_interdicao_w
                        from	unidade_atend_hist a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and 	coalesce(a.dt_fim_historico::text, '') = ''
                        and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
                        and 	a.dt_historico =
                                (SELECT	max(z.dt_historico)
                                from    unidade_atend_hist z
                                where   z.nr_seq_unidade = b.nr_seq_interno
                                and 	coalesce(z.dt_fim_historico::text, '') = ''
                                and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
                    exception
                        when others then
                        null;
                    end;

                    CALL panorama_leito_pck.insert_inf_adic(19,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,291978,969320,null,null,dt_historico_interdicao_w,1,'date(shortDate)', pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(20,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969321,ds_motivo_interdicao_w,null,null,2,null,pIeConcluido);

                -- ACOMPANHANTE
                elsif (r_c_leito.ie_status_unidade = 'M') then
                    begin
                        select	coalesce(obter_nome_pf(cd_paciente_reserva), nm_pac_reserva),
                                nr_atendimento_acomp
                        into STRICT	nm_acompanhante_w,
                                nr_atendimento_w
                        from	unidade_atendimento
                        where	nr_seq_interno = r_c_leito.nr_seq_interno;
                    exception
                        when others then
                        null;
                    end;

                    if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
                        select  obter_nome_pf(cd_pessoa_fisica)
                        into STRICT    nm_paciente_w
                        from	atendimento_paciente
                        where	nr_atendimento = nr_atendimento_w;
                    end if;

                    CALL panorama_leito_pck.insert_inf_adic(21,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,283172,974474,nm_acompanhante_w,null,null,1,null,pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(21,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,295156,969294,nm_paciente_w,null,null,1,null,pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(22,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,283863,969361,null,nr_atendimento_w,null,2,null,pIeConcluido);

                -- ISOLAMENTO
                elsif (r_c_leito.ie_status_unidade = 'O') then
                    begin
                        select	a.dt_historico,
                                coalesce(substr(obter_motivo_isol_leito(a.nr_seq_mot_isol),1,255), '327119')
                        into STRICT	dt_historico_isolamento_w,
                                ds_motivo_isolamento_w
                        from	unidade_atend_hist a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and 	coalesce(a.dt_fim_historico::text, '') = ''
                        and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
                        and 	a.dt_historico =
                                (SELECT	max(z.dt_historico)
                                from    unidade_atend_hist z
                                where   z.nr_seq_unidade = b.nr_seq_interno
                                and 	coalesce(z.dt_fim_historico::text, '') = ''
                                and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
                    exception
                        when others then
                        null;
                    end;

                    CALL panorama_leito_pck.insert_inf_adic(23,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,291978,969422,null,null,dt_historico_isolamento_w,1,'date(shortDate)', pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(24,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969502,ds_motivo_isolamento_w,null,null,2,null,pIeConcluido);

                -- RESERVADO
                elsif (r_c_leito.ie_status_unidade = 'R') then
                    begin
                        select	coalesce(nm_pac_reserva, obter_nome_pf(cd_paciente_reserva))
                        into STRICT	nm_paciente_reserva_w
                        from	unidade_atendimento
                        where	nr_seq_interno = r_c_leito.nr_seq_interno;
                    exception
                        when others then
                        null;
                    end;

                    if (coalesce(r_c_leito.ie_retaguarda_atual,'N') = 'S') then
                        CALL panorama_leito_pck.insert_inf_adic(25,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,683266,969587,'719927',null,null,1,null,pIeConcluido);
                    end if;

                    if (nm_paciente_reserva_w IS NOT NULL AND nm_paciente_reserva_w::text <> '') then
                        CALL panorama_leito_pck.insert_inf_adic(26,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,295156,969602,nm_paciente_reserva_w,null,null,2,null,pIeConcluido);
                    end if;
                --LIVRE
                elsif (r_c_leito.ie_status_unidade = 'L') then
                    begin
                        select	1
                        into STRICT 	ie_solicitacao_reserva_pend_w
                        from	unidade_atendimento a,
                                gestao_vaga b
                        where	a.cd_setor_atendimento = b.cd_setor_desejado
                        and		a.cd_unidade_basica = b.cd_unidade_basica
                        and		a.cd_unidade_compl = b.cd_unidade_compl
                        and		b.ie_status not in ('F','C','D','N','T')
                        and		a.nr_seq_interno = r_c_leito.nr_seq_interno  LIMIT 1;
                    exception
                        when others then
                        null;
                    end;

                    if (coalesce(r_c_leito.ie_retaguarda_atual,'N') = 'S') then
                        CALL panorama_leito_pck.insert_inf_adic(25,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,683266,969628,'719927',null,null,1,null,pIeConcluido);
                        if (ie_solicitacao_reserva_pend_w = 1) then
                            CALL panorama_leito_pck.insert_inf_adic(27,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,100330842,969629,'719927',null,null,1,null,pIeConcluido);
                        end if;
                    end if;
                --SAIDA INTERDICAO
                elsif (r_c_leito.ie_status_unidade = 'S') then
                    begin
                        select	a.dt_historico
                        into STRICT	dt_historico_interdicao_w
                        from	unidade_atend_hist a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and 	coalesce(a.dt_fim_historico::text, '') = ''
                        and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
                        and 	a.dt_historico =
                                (SELECT	max(z.dt_historico)
                                from    unidade_atend_hist z
                                where   z.nr_seq_unidade = b.nr_seq_interno
                                and 	coalesce(z.dt_fim_historico::text, '') = ''
                                and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
                    exception
                        when others then
                        null;
                    end;

                    begin
                        select	coalesce(substr(OBTER_DESC_MOT_INTER(a.CD_MOTIVO_INTERDICAO),1,60), '327119')
                        into STRICT	ds_motivo_interdicao_w
                        from	unidade_atend_hist a,
                                unidade_atendimento b
                        where	a.nr_seq_unidade = r_c_leito.nr_seq_interno
                        and		b.nr_seq_interno = a.nr_seq_unidade
                        and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
                        and 	a.dt_historico =
                                (SELECT	max(z.dt_historico)
                                from    unidade_atend_hist z
                                where   z.nr_seq_unidade = b.nr_seq_interno
                                and 	coalesce(z.dt_fim_historico::text, '') = ''
                                and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> '')
                                and 	z.ie_status_unidade = 'I');
                    exception
                        when others then
                        null;
                    end;

                    CALL panorama_leito_pck.insert_inf_adic(19,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,291978,969647,null,null,dt_historico_interdicao_w,1,'date(shortDate)', pIeConcluido);
                    CALL panorama_leito_pck.insert_inf_adic(20,r_c_leito.nr_seq_interno,r_c_leito.cd_unidade_basica,r_c_leito.cd_unidade_compl,293478,969661,ds_motivo_interdicao_w,null,null,2,null,pIeConcluido);

                end if;
            end loop;
        end if;
        commit;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE panorama_leito_pck.inserepaninfoadicional (pIeConcluido text, nr_seq_interno_p bigint, ie_paciente_p text, ie_leito_p text, nm_usuario_p text, cd_estabelecimento_p bigint) FROM PUBLIC;
