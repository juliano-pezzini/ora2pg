-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE panorama_leito_pck.finalizar () AS $body$
BEGIN
        /* Delecoes e conclusao */

        delete from w_pan_agrup_leito
        where	ie_concluido = 'S';

        update	w_pan_agrup_leito
        set		ie_concluido = 'S';

        delete from w_pan_leito
        where	ie_concluido = 'S';

        update	w_pan_leito
        set		ie_concluido = 'S';

        delete from w_pan_paciente
        where	ie_concluido = 'S';

        update	w_pan_paciente
        set		ie_concluido = 'S';

        delete from w_pan_ocorrencia
        where	ie_concluido = 'S';

        update	w_pan_ocorrencia
        set		ie_concluido = 'S';

        delete from w_pan_info_adicional
        where	ie_concluido = 'S';

        update	w_pan_info_adicional
        set		ie_concluido = 'S';

		if (current_setting('panorama_leito_pck.ie_gerar_log')::varchar(1) = 'S') then
			delete from w_panorama_etapa
			where ie_panorama_conc = 'S';

			update	w_panorama_etapa
			set	ie_panorama_conc = 'S';
		end if;

		delete from w_panorama
        where	ie_concluido = 'S';

        update	w_panorama
        set		dt_fim_atualizacao = clock_timestamp(),
                ie_concluido = 'S'
        where	coalesce(dt_fim_atualizacao::text, '') = '';

        commit;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE panorama_leito_pck.finalizar () FROM PUBLIC;
