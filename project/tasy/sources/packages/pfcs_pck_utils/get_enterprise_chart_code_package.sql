-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_utils.get_enterprise_chart_code () RETURNS bigint AS $body$
DECLARE

        NR_MAIN_HISTOGRAM_CHART_W   CONSTANT dic_objeto.nr_sequencia%type := 1148327;

        nr_chart_code_w             pfcs_indicator.nr_seq_object%type;
        cd_profile_w                pfcs_chart_config.cd_perfil%type;
        cd_establishment_w          pfcs_chart_config.cd_estabelecimento%type;
        nm_user_w                   pfcs_chart_config.nm_usuario_regra%type;

BEGIN
        cd_profile_w := obter_perfil_ativo;
        cd_establishment_w := obter_estabelecimento_ativo;
        nm_user_w := obter_usuario_ativo;

        select  coalesce(max(nr_seq_object),NR_MAIN_HISTOGRAM_CHART_W)
        into STRICT    nr_chart_code_w
        from (
            SELECT  ind.nr_seq_object
            from    pfcs_chart_config cfg,
                    pfcs_indicator ind
            where   coalesce(cfg.nm_usuario_regra, nm_user_w) = nm_user_w and
                    coalesce(cfg.cd_perfil, cd_profile_w) = cd_profile_w and
                    coalesce(cfg.cd_estabelecimento, cd_establishment_w) = cd_establishment_w and
                    cfg.nr_seq_indicator = ind.nr_sequencia and
                    cfg.ie_enterprise_demand = PFCS_PCK_CONSTANTS.IE_YES
            order by    cfg.nm_usuario_regra,
                        cfg.cd_perfil,
                        cfg.cd_estabelecimento asc
        ) v LIMIT 1;

        return nr_chart_code_w;
    end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_utils.get_enterprise_chart_code () FROM PUBLIC;
