-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_utils.get_general_rule_value (ds_column_name_p text, cd_establishment_p bigint) RETURNS varchar AS $body$
DECLARE

        ds_sql_w            dic_objeto.ds_sql%type;
        vl_configuration_w  PFCS_PCK_SUBTYPES.VARCHAR_255_T;

BEGIN
        ds_sql_w :=
            ' select v.vl_configuration ' ||
            ' from (' ||
                ' select max(to_char(r.'||ds_column_name_p||')) vl_configuration ' ||
                ' from   pfcs_general_rule r ' ||
                ' order  by r.dt_atualizacao desc ' ||
            ') v';

        EXECUTE ds_sql_w into STRICT vl_configuration_w;
        if (coalesce(vl_configuration_w::text, '') = '') then
             ds_sql_w :=
                ' select max(t.vl_default) vl_configuration ' ||
                ' from tabela_atributo t ' ||
                ' where upper(nm_tabela) = ' || chr(39) || 'PFCS_GENERAL_RULE' || chr(39) ||
                ' and upper(nm_atributo) = ' || chr(39) || upper(ds_column_name_p) || chr(39);

            EXECUTE ds_sql_w into STRICT vl_configuration_w;
        end if;

        return vl_configuration_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_utils.get_general_rule_value (ds_column_name_p text, cd_establishment_p bigint) FROM PUBLIC;
