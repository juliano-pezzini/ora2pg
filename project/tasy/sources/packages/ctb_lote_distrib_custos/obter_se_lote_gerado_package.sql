-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_lote_distrib_custos.obter_se_lote_gerado ( nr_seq_tabela_p tabela_custo.nr_sequencia%type, nr_seq_mes_ref_p lote_contabil.nr_seq_mes_ref%type, dt_mes_referencia_p ctb_mes_ref.dt_referencia%type ) RETURNS bigint AS $body$
DECLARE


retorno_w                       bigint;


BEGIN

select  count(*)
into STRICT    retorno_w
from    lote_contabil a,
        tabela_custo b
where   b.cd_empresa = obter_empresa_estab(a.cd_estabelecimento)
and     trunc(a.dt_referencia,'mm') = trunc(b.dt_mes_referencia,'mm')
and     a.cd_estabelecimento = coalesce(b.cd_estabelecimento, a.cd_estabelecimento)
and     a.cd_tipo_lote_contabil = 58
and     b.ie_orcado_real = 'R'
and     b.nr_sequencia = coalesce(nr_seq_tabela_p, b.nr_sequencia)
and     a.nr_seq_mes_ref = coalesce(nr_seq_mes_ref_p, a.nr_seq_mes_ref)
and     trunc(a.dt_referencia,'mm') = coalesce(trunc(dt_mes_referencia_p,'mm'), trunc(a.dt_referencia,'mm'));

return  retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_lote_distrib_custos.obter_se_lote_gerado ( nr_seq_tabela_p tabela_custo.nr_sequencia%type, nr_seq_mes_ref_p lote_contabil.nr_seq_mes_ref%type, dt_mes_referencia_p ctb_mes_ref.dt_referencia%type ) FROM PUBLIC;
