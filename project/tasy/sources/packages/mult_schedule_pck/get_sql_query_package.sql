-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION mult_schedule_pck.get_sql_query (nr_seq_agenda_p agenda_paciente.nr_sequencia%type, cd_tipo_agenda_p agenda.cd_tipo_agenda%type, ie_sem_atendimento_p text) RETURNS varchar AS $body$
DECLARE

	ds_sql_w varchar(30000);					
	
BEGIN
	
		if (cd_tipo_agenda_p in (3,5)) then
			ds_sql_w := 'from	agenda a,
								agenda_consulta ac,
								atendimento_paciente atend
						 where 	ac.cd_agenda = a.cd_agenda 
						 and	ac.nr_atendimento = atend.nr_atendimento (+) 
						 and	(rownum <= a.qt_horarios_ageint or a.qt_horarios_ageint is null) 
						 and	ac.nr_sequencia = '|| nr_seq_agenda_p ||' 
						 order by nr_seq_agenda';
		elsif (cd_tipo_agenda_p = 2) then
			ds_sql_w :=	'from	agenda a,
								agenda_paciente ac,
								atendimento_paciente atend
						where ac.cd_agenda = a.cd_agenda 
						and	ac.nr_atendimento = atend.nr_atendimento (+) 
						and	(rownum <= a.qt_horarios_ageint or a.qt_horarios_ageint is null) 
						and	ac.nr_sequencia = '|| nr_seq_agenda_p ||'
						order by nr_seq_agenda';
		end if;
		return ds_sql_w;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION mult_schedule_pck.get_sql_query (nr_seq_agenda_p agenda_paciente.nr_sequencia%type, cd_tipo_agenda_p agenda.cd_tipo_agenda%type, ie_sem_atendimento_p text) FROM PUBLIC;
