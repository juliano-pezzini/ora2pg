-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE sequence_pck.create_sequence_commands () AS $body$
DECLARE

    n_count_table bigint;

  
BEGIN
    select count(1) into STRICT n_count_table from user_tables where table_name = 'SEQUENCE_INFO_BKP';
    if (n_count_table > 0) then
      EXECUTE ' DROP TABLE sequence_info_bkp';
    end if;

    EXECUTE '
    CREATE TABLE sequence_info_bkp AS
    SELECT
        a.nm_tabela,
        a.constraint_name,
        a.sequence_name,
        a.sequence_last_number,
        b.last_number,
        b.increment_by,
        b.cycle_flag,
        b.max_value,
        b.order_flag,      
        a.table_num_rows,
        a.table_pk_max_value,
        a.sequence_increment_by,
        a.constraint_number_of_columns,
        a.constraint_columns_list,
        CAST(''NO'' AS VARCHAR2(3)) as removed,
        CAST(''NO'' AS VARCHAR2(3)) as created,
        ''drop sequence '' || b.sequence_name as drop_sequence, 
        ''create sequence '' || b.sequence_name || '' minvalue '' || b.min_value || '' maxvalue '' || b.max_value ||
        '' increment by '' || b.increment_by || '' start with 1 '' || decode(b.cache_size,0,''nocache'',''cache '' || b.cache_size) || '' noorder cycle nopartition'' as create_sequence
    FROM
        fix_sequences a join user_sequences b on (a.sequence_name = b.sequence_name)
    WHERE
        a.table_pk_max_value = 0
    AND a.sequence_last_number > 1
    AND a.table_num_rows = 0
    AND a.constraint_number_of_columns = 1';

    n_count_table := 0;
    EXECUTE 'select count(1) from sequence_info_bkp' into STRICT n_count_table;
    CALL cleanupdb_pck.init_progress(current_setting('sequence_pck.const_cleanupdb')::varchar(20),0,n_count_table);
  end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sequence_pck.create_sequence_commands () FROM PUBLIC;
