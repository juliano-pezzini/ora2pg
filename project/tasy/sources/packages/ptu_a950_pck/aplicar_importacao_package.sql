-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ptu_a950_pck.aplicar_importacao ( nr_seq_arq_xml_p pls_imp_arq_A950.nr_sequencia%type, cd_edicao_amb_p edicao_amb.cd_edicao_amb%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Pega as inf importadas do arquivo, e aplica para as tabelas de preco AMB

		Quando existir o A950 para a tabela, deve-se somente atualizar
		
		Quando NAO existir o A950 para a tabela, deve-se inserir o registro novo, usando
		como base os campos a serem atualizados.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[ ]  Objetos do dicionario [X] Tasy (Delphi/Java) [ X] Portal [ X]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

			Como a tabela de preco e muito utilizada, foi desconsiderado a hipotese de utilizar um MERGE INTO,
			mesmo sendo o comando ideal conforme a regra de atualizar ou criar, ele pode causar um lock caso o 
			A950 seja muito grande, afetando diversas partes do sistema.

Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
BEGIN
-- validacao
CALL ptu_a950_pck.valida_imp_tabela_preco(nr_seq_arq_xml_p, cd_edicao_amb_p, nm_usuario_p);

-- verifica os registros que precisam ser gerados
CALL ptu_a950_pck.gera_tabela_preco(nr_seq_arq_xml_p, cd_edicao_amb_p, nm_usuario_p);

-- Processa os registros ja existentes na tabela de preco
CALL ptu_a950_pck.atualiza_tabela_preco(nr_seq_arq_xml_p, cd_edicao_amb_p, nm_usuario_p);

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_a950_pck.aplicar_importacao ( nr_seq_arq_xml_p pls_imp_arq_A950.nr_sequencia%type, cd_edicao_amb_p edicao_amb.cd_edicao_amb%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
