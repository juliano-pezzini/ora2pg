-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_sib_validacao_pck.add_inconsistencia ( nr_seq_segurado_inc_p pls_segurado.nr_sequencia%type, cd_inconsistencia_p bigint, nm_beneficiario_p text, ie_titularidade_p text, qt_idade_p bigint, cd_pessoa_fisica_inc_p text, ie_consistencia_p INOUT text) AS $body$
DECLARE

ds_inconsistencia_w		pls_sib_inconsistencia.ds_inconsistencia%type;
ie_inconsistente_w		varchar(1);

BEGIN
PERFORM set_config('pls_sib_validacao_pck.linha_w', null, false);
ie_inconsistente_w	:= 'S';

begin
select	a.ds_inconsistencia
into STRICT	ds_inconsistencia_w
from	pls_sib_inconsistencia a
where	a.cd_inconsistencia	= cd_inconsistencia_p
and	a.ie_inclusao = 'S'
and	((coalesce(ie_titularidade_p::text, '') = '') or (ie_titularidade_p = 'T' and a.ie_titular = 'S') or (ie_titularidade_p = 'D' and a.ie_dependente_menor_idade = 'S' and qt_idade_p < 18) or (ie_titularidade_p = 'D' and a.ie_dependente_maior_idade = 'S' and qt_idade_p >= 18));
exception
when others then
	ie_inconsistente_w	:= 'N';
end;

if (ie_inconsistente_w = 'S') then
	current_setting('pls_sib_validacao_pck.linha_w')::t_dados_validacao_row.nr_seq_segurado			:= nr_seq_segurado_inc_p;
	current_setting('pls_sib_validacao_pck.linha_w')::t_dados_validacao_row.nm_beneficiario			:= nm_beneficiario_p;
	current_setting('pls_sib_validacao_pck.linha_w')::t_dados_validacao_row.cd_inconsistencia		:= cd_inconsistencia_p;
	current_setting('pls_sib_validacao_pck.linha_w')::t_dados_validacao_row.ds_inconsistencia		:= ds_inconsistencia_w;
	current_setting('pls_sib_validacao_pck.linha_w')::t_dados_validacao_row.cd_pessoa_fisica		:= cd_pessoa_fisica_inc_p;
	ie_consistencia_p			:= 'S';
else
	ie_consistencia_p			:= 'N';
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_sib_validacao_pck.add_inconsistencia ( nr_seq_segurado_inc_p pls_segurado.nr_sequencia%type, cd_inconsistencia_p bigint, nm_beneficiario_p text, ie_titularidade_p text, qt_idade_p bigint, cd_pessoa_fisica_inc_p text, ie_consistencia_p INOUT text) FROM PUBLIC;
