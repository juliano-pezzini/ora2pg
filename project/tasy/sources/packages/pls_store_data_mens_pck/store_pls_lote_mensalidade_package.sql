-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

/*PLS_LOTE_MENSALIDADE*/
 
	 
	 
	/*PLS_PARAMETROS*/
 
	 
	 
	/*PLS_PARAMETRO_PAGAMENTO*/
 
	 
	 
	/*PLS_REGRA_SERIE_NF_COMPL*/
 
	 
	 
	/*PLS_MENSALIDADE*/
 
	 --PF ou PJ 
	 
	 
	/*PLS_CONTRATO*/
 
	 
	 
	/*PLS_MENSALIDADE_SEGURADO*/
 
	 
	 
	/*PLS_SEGURADO*/
 
	 
	 
	/*PLS_REGRA_MENS_CONTRATO*/
 
	 
	 
	--PLS_MENSALIDADE_GRUPO 
	 
	 
	--TRIBUTOS 
	


CREATE OR REPLACE PROCEDURE pls_store_data_mens_pck.store_pls_lote_mensalidade ( nr_seq_lote_p pls_lote_mensalidade.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN
	 
	select	trunc(dt_mesano_referencia,'month'), 
		trunc(last_day(dt_mesano_referencia),'dd') + 86399/86400, 
		ie_tipo_contratacao, 
		ie_regulamentacao, 
		ie_fator_moderador, 
		nr_seq_contrato, 
		trunc(dt_inicio_adesao,'dd'), 
		CASE WHEN coalesce(dt_fim_adesao::text, '') = '' THEN null  ELSE trunc(dt_fim_adesao,'dd') + 86399/86400 END , 
		nr_seq_contrato_inter, 
		ie_tipo_preco, 
		nr_seq_regra_grupo, 
		coalesce(ie_cobrar_retroativo,'N'), 
		cd_empresa_inicial, 
		cd_empresa_final, 
		dt_rescisao_programada, 
		nr_seq_regra_serie_nf, 
		coalesce(ie_primeira_mensalidade,'N'), 
		nr_seq_classif_benef 
	into STRICT	current_setting('pls_store_data_mens_pck.dt_referencia_lote_w')::pls_lote_mensalidade.dt_mesano_referencia%type, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_mesano_referencia, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_contratacao, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_regulamentacao, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_fator_moderador, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_contrato, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_inicio_adesao, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_fim_adesao, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_contrato_inter, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_preco, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_regra_grupo, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_cobrar_retroativo, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.cd_empresa_inicial, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.cd_empresa_final, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_rescisao_programada, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_regra_serie_nf, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_primeira_mensalidade, 
		current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_classif_benef 
	from	pls_lote_mensalidade 
	where	nr_sequencia	= nr_seq_lote_p;
	 
	current_setting('pls_store_data_mens_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_sequencia	:= nr_seq_lote_p;
	PERFORM set_config('pls_store_data_mens_pck.qt_meses_parametro_w', coalesce(obter_valor_param_usuario(1205, 5, Obter_Perfil_Ativo, nm_usuario_p, cd_estabelecimento_p), 0), false);
	 
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_store_data_mens_pck.store_pls_lote_mensalidade ( nr_seq_lote_p pls_lote_mensalidade.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
