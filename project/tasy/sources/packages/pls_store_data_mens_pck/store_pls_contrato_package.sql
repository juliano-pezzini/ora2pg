-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_store_data_mens_pck.store_pls_contrato (nr_seq_contrato_p pls_contrato.nr_sequencia%type) AS $body$
BEGIN
		if (nr_seq_contrato_p IS NOT NULL AND nr_seq_contrato_p::text <> '') then 
			select	qt_idade_limite_reaj, 
				qt_anos_limite_reaj, 
				ie_geracao_valores, 
				CASE WHEN coalesce(cd_pf_estipulante::text, '') = '' THEN 'PJ'  ELSE 'PF' END  
			into STRICT	current_setting('pls_store_data_mens_pck.contrato_w')::pls_contrato%rowtype.qt_idade_limite_reaj, 
				current_setting('pls_store_data_mens_pck.contrato_w')::pls_contrato%rowtype.qt_anos_limite_reaj, 
				current_setting('pls_store_data_mens_pck.contrato_w')::pls_contrato%rowtype.ie_geracao_valores, 
				current_setting('pls_store_data_mens_pck.ie_tipo_estipulante_w')::varchar(2) 
			from	pls_contrato 
			where	nr_sequencia	= nr_seq_contrato_p;
			 
			select	max(nr_sequencia) 
			into STRICT	current_setting('pls_store_data_mens_pck.nr_seq_regra_limite_copar_w')::pls_regra_limite_copartic.nr_sequencia%type 
			from	pls_regra_limite_copartic 
			where	nr_seq_contrato	= nr_seq_contrato_p 
			and	get_dt_final_lote	between coalesce(dt_inicio_vigencia,get_dt_final_lote) and coalesce(dt_fim_vigencia,get_dt_final_lote);
			 
			if (current_setting('pls_store_data_mens_pck.nr_seq_regra_limite_copar_w')::pls_regra_limite_copartic.nr_sequencia%(type IS NOT NULL AND type::text <> '')) then 
				select	vl_max_copartic 
				into STRICT	current_setting('pls_store_data_mens_pck.vl_max_copartic_w')::pls_regra_limite_copartic.vl_max_copartic%type 
				from	pls_regra_limite_copartic 
				where	nr_sequencia	= current_setting('pls_store_data_mens_pck.nr_seq_regra_limite_copar_w')::pls_regra_limite_copartic.nr_sequencia%type;
			end if;
		end if;
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_store_data_mens_pck.store_pls_contrato (nr_seq_contrato_p pls_contrato.nr_sequencia%type) FROM PUBLIC;
