-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_solic_rescisao_fin_pck.finalizar_analise ( nr_seq_solic_resc_fin_p pls_solic_rescisao_fin.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE

nr_seq_pagador_w		pls_contrato_pagador.nr_sequencia%type;
nr_seq_solic_rescisao_w		pls_solicitacao_rescisao.nr_sequencia%type;
dt_rescisao_w			timestamp;

BEGIN
select	a.nr_seq_pagador,
	b.nr_sequencia,
	coalesce(b.dt_rescisao,b.dt_solicitacao)
into STRICT	nr_seq_pagador_w,
	nr_seq_solic_rescisao_w,
	dt_rescisao_w
from	pls_solic_rescisao_fin a,
	pls_solicitacao_rescisao b
where	b.nr_sequencia	= a.nr_seq_solicitacao
and	a.nr_sequencia	= nr_seq_solic_resc_fin_p;

update	pls_solic_rescisao_fin
set	dt_fim_analise	= clock_timestamp(),
	ie_status	= 3,
	nm_usuario	= nm_usuario_p,
	dt_atualizacao	= clock_timestamp()
where	nr_sequencia	= nr_seq_solic_resc_fin_p;

CALL pls_solic_rescisao_fin_pck.gerar_historico_pagador(nr_seq_pagador_w, nr_seq_solic_rescisao_w, nr_seq_solic_resc_fin_p, dt_rescisao_w, nm_usuario_p, cd_estabelecimento_p);

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_solic_rescisao_fin_pck.finalizar_analise ( nr_seq_solic_resc_fin_p pls_solic_rescisao_fin.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
