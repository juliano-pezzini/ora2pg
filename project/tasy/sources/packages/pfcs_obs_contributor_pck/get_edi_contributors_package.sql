-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_obs_contributor_pck.get_edi_contributors (nr_seq_encounter_p bigint) RETURNS varchar AS $body$
DECLARE

		ds_return_w		varchar(255);
	
BEGIN
		ds_return_w := '';
		PERFORM set_config('pfcs_obs_contributor_pck.nr_seq_observation_w', pfcs_obs_contributor_pck.get_observation_seq(nr_seq_encounter_p, current_setting('pfcs_obs_contributor_pck.cd_edi_type_w')::varchar(100)), false);

		for c01_w in current_setting('pfcs_obs_contributor_pck.cursor_rank')::CURSOR(nr_seq_observation_p(current_setting('pfcs_obs_contributor_pck.nr_seq_observation_w')::pfcs_observ_extension.nr_seq_observation%type, '#EDI_CONTRIBUTOR', 3) loop
        if (upper(c01_w.ds_title) != 'NA' and upper(c01_w.ds_title) != 'NAN') then
		PERFORM set_config('pfcs_obs_contributor_pck.ds_unit_w', pfcs_obs_contributor_pck.get_contributor_unit(c01_w.ds_title), false);
			if (coalesce(ds_return_w::text, '') = '') then
				ds_return_w := 'Title:' || c01_w.ds_title || ';Value:' || c01_w.ds_value || ' ' || current_setting('pfcs_obs_contributor_pck.ds_unit_w')::pfcs_contributor_metadata.ds_unit_disp%type || ';Trend:' || c01_w.cd_trend;
			else
				ds_return_w := ds_return_w || '|' || 'Title:' || c01_w.ds_title || ';Value:' || c01_w.ds_value || ' ' || current_setting('pfcs_obs_contributor_pck.ds_unit_w')::pfcs_contributor_metadata.ds_unit_disp%type || ';Trend:' || c01_w.cd_trend;
			end if;
            end if;
		end loop;

		return replace(ds_return_w, 'slope:', '');

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_obs_contributor_pck.get_edi_contributors (nr_seq_encounter_p bigint) FROM PUBLIC;
