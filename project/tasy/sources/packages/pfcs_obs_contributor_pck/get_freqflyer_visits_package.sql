-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_obs_contributor_pck.get_freqflyer_visits (nr_seq_encounter_p bigint) RETURNS varchar AS $body$
DECLARE

		ds_return_w		varchar(255);
	
BEGIN
		PERFORM set_config('pfcs_obs_contributor_pck.nr_seq_observation_w', pfcs_obs_contributor_pck.get_observation_seq(nr_seq_encounter_p, current_setting('pfcs_obs_contributor_pck.cd_freqflyer_type_w')::varchar(100)), false);

		SELECT * FROM pfcs_obs_contributor_pck.obs_extension_single_data(current_setting('pfcs_obs_contributor_pck.nr_seq_observation_w')::pfcs_observ_extension.nr_seq_observation%type, '#FREQFLYER_ADMISION_30_DAYS', current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type) INTO STRICT current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type;
		select 'ADMISION_30_DAYS:' || CASE WHEN coalesce(current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type,0)=0 THEN 'N' WHEN coalesce(current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type,0)='' THEN 'N' WHEN coalesce(current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type,0)='0' THEN 'N'  ELSE 'Y' END  || '|'
        into STRICT ds_return_w
;

		SELECT * FROM pfcs_obs_contributor_pck.obs_extension_single_data(current_setting('pfcs_obs_contributor_pck.nr_seq_observation_w')::pfcs_observ_extension.nr_seq_observation%type, '#FREQFLYER_ADMISION_PAST_YEAR', current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type) INTO STRICT current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type;
		ds_return_w :=  ds_return_w || 'ADMISION_PAST_YEAR:' || current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type || '|';

		SELECT * FROM pfcs_obs_contributor_pck.obs_extension_single_data(current_setting('pfcs_obs_contributor_pck.nr_seq_observation_w')::pfcs_observ_extension.nr_seq_observation%type, '#FREQFLYER_ED_PAST_YEAR', current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type) INTO STRICT current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type, current_setting('pfcs_obs_contributor_pck.ds_title_w')::pfcs_observ_extension.ds_title%type;
		ds_return_w := ds_return_w || 'ED_PAST_YEAR:' || current_setting('pfcs_obs_contributor_pck.ds_value_w')::pfcs_observ_extension.ds_value%type;

		return ds_return_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_obs_contributor_pck.get_freqflyer_visits (nr_seq_encounter_p bigint) FROM PUBLIC;
