-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_indicators.get_indicator_value ( nr_seq_indicator_p bigint, cd_establishment_p bigint, ds_department_p text default null, cd_unit_p bigint default null) RETURNS bigint AS $body$
DECLARE

        cd_type_w                   pfcs_indicator.cd_type%type;
        ds_value_w                  pfcs_panel.ds_reference_value%type;
        vl_return_w                 pfcs_panel.vl_indicator%type := 0;

BEGIN
        if (nr_seq_indicator_p IS NOT NULL AND nr_seq_indicator_p::text <> '') then
            SELECT * FROM pfcs_pck_indicators.indicator_values(   nr_seq_indicator_p => nr_seq_indicator_p, cd_establishment_p => cd_establishment_p, ds_department_p => ds_department_p, cd_unit_p => cd_unit_p, vl_indicator_p => current_setting('pfcs_pck_indicators.vl_indicator_w')::pfcs_panel.vl_indicator%type, vl_indicator_help_p => current_setting('pfcs_pck_indicators.vl_indicator_help_w')::pfcs_panel.vl_indicator_help%type, vl_indicator_dec_p => current_setting('pfcs_pck_indicators.vl_indicator_dec_w')::pfcs_panel.vl_indicator_dec%type, cd_unit_classification_p => current_setting('pfcs_pck_indicators.cd_unit_classification_w')::pfcs_panel.cd_reference_aux%type) INTO STRICT vl_indicator_p => current_setting('pfcs_pck_indicators.vl_indicator_w')::pfcs_panel.vl_indicator%type, vl_indicator_help_p => current_setting('pfcs_pck_indicators.vl_indicator_help_w')::pfcs_panel.vl_indicator_help%type, vl_indicator_dec_p => current_setting('pfcs_pck_indicators.vl_indicator_dec_w')::pfcs_panel.vl_indicator_dec%type, cd_unit_classification_p => current_setting('pfcs_pck_indicators.cd_unit_classification_w')::pfcs_panel.cd_reference_aux%type;

            cd_type_w := pfcs_pck_indicators.get_type(nr_seq_indicator_p);
            case cd_type_w
                when current_setting('pfcs_pck_indicators.cd_type_percentage')::varchar(1) then
                    vl_return_w := pfcs_get_percentage_value(current_setting('pfcs_pck_indicators.vl_indicator_help_w')::pfcs_panel.vl_indicator_help%type, current_setting('pfcs_pck_indicators.vl_indicator_w')::pfcs_panel.vl_indicator%type);
                when current_setting('pfcs_pck_indicators.cd_type_fraction')::varchar(1) then
                    vl_return_w := current_setting('pfcs_pck_indicators.vl_indicator_help_w')::pfcs_panel.vl_indicator_help%type;
                when current_setting('pfcs_pck_indicators.cd_type_decimal')::varchar(1) then
                    return current_setting('pfcs_pck_indicators.vl_indicator_dec_w')::pfcs_panel.vl_indicator_dec%type;
                when current_setting('pfcs_pck_indicators.cd_type_time')::varchar(1) then
                    vl_return_w := current_setting('pfcs_pck_indicators.vl_indicator_w')::pfcs_panel.vl_indicator%type;
            else
                vl_return_w := current_setting('pfcs_pck_indicators.vl_indicator_w')::pfcs_panel.vl_indicator%type;
            end case;
        end if;

        return vl_return_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pfcs_pck_indicators.get_indicator_value ( nr_seq_indicator_p bigint, cd_establishment_p bigint, ds_department_p text default null, cd_unit_p bigint default null) FROM PUBLIC;
