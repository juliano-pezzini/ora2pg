-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION holding_pck.get_centro_custo_ref (cd_empresa_p bigint, cd_centro_custo_ref_p centro_custo.cd_centro_custo_ref%type, cd_estab_destino_p bigint default null) RETURNS bigint AS $body$
DECLARE


cd_centro_custo_w	centro_custo.cd_centro_custo%type;


BEGIN
  begin
	select  c.cd_centro_custo
	into STRICT	cd_centro_custo_w
	from	centro_custo c,
			estabelecimento e,
			grupo_emp_estrutura g
	where   e.cd_empresa 			= g.cd_empresa
	and     c.cd_estabelecimento 	= e.cd_estabelecimento
	and 	g.nr_seq_grupo 			= holding_pck.get_grupo_emp_usuario_vigente(cd_empresa_p)
	and (c.cd_centro_custo_ref  = cd_centro_custo_ref_p or c.cd_centro_custo = cd_centro_custo_ref_p)
	and 	g.cd_empresa			= cd_empresa_p
	and     ((e.cd_estabelecimento 	= cd_estab_destino_p) or (coalesce(cd_estab_destino_p::text, '') = '' and e.ie_tipo_estab = 'M'));
  exception
  when others then
	cd_centro_custo_w	:= null;
  end;
  return cd_centro_custo_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION holding_pck.get_centro_custo_ref (cd_empresa_p bigint, cd_centro_custo_ref_p centro_custo.cd_centro_custo_ref%type, cd_estab_destino_p bigint default null) FROM PUBLIC;
