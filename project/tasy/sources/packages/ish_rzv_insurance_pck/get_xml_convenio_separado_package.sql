-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ish_rzv_insurance_pck.get_xml_convenio_separado ( ds_xml_convenio_p text, ds_xml_conv1_p INOUT text, ds_xml_conv2_p INOUT text) AS $body$
DECLARE


ds_xml_convenio_w	varchar(4000);
ds_xml_convenio2_w	varchar(4000);
ds_xml_aux_w      	varchar(4000);
ds_xml_w		varchar(4000);


BEGIN

ds_xml_w	:= replace(ds_xml_convenio_p, 'vsda:','');
ds_xml_w	:= replace(ds_xml_w, ':vsda','');
ds_xml_w	:= replace(ds_xml_w, 'vsdg:','');
ds_xml_w	:= replace(ds_xml_w, ':vsdg','');

ds_xml_aux_w := substr(ds_xml_w,instr(ds_xml_w,'<UC_AllgemeineVersicherungsdatenXML',1,1),4000);

if (instr(ds_xml_aux_w,'</UC_AllgemeineVersicherungsdatenXML>',1,1) > 0) then
	begin
	ds_xml_convenio_w 	:= substr(ds_xml_aux_w,1,position('</UC_AllgemeineVersicherungsdatenXML>' in ds_xml_aux_w)+36);
	ds_xml_convenio_w	:= '<ListOfDocs>' || ds_xml_convenio_w || '</ListOfDocs>';
	ds_xml_convenio_w	:= replace(ds_xml_convenio_w,'<','#');
	ds_xml_convenio_w	:= replace(ds_xml_convenio_w,'>','~');
	ds_xml_conv1_p		:= ds_xml_convenio_w;
	end;
end if;

ds_xml_aux_w := substr(ds_xml_w,instr(ds_xml_w,'<UC_GeschuetzteVersichertendatenXML',1,1),4000);

if (instr(ds_xml_aux_w,'</UC_GeschuetzteVersichertendatenXML>',1,1) > 0) then
	begin
	ds_xml_convenio2_w 	:= substr(ds_xml_aux_w,1,position('</UC_GeschuetzteVersichertendatenXML>' in ds_xml_aux_w)+36);
	ds_xml_convenio2_w	:= '<ListOfDocs>' || ds_xml_convenio2_w || '</ListOfDocs>';
	ds_xml_convenio2_w	:= ish_rzv_insurance_pck.replace_character_tag_xml(ds_xml_convenio2_w);
	end;
else
	begin
	ds_xml_conv2_p	:= '#ListOfDocs~#UC_GeschuetzteVersichertendatenXML CDM_VERSION="5.2.0" xmlns="http://ws.gematik.de/fa/vsdm/vsd/v5.2"~#Zuzahlungsstatus~#Status~0#/Status~#/Zuzahlungsstatus~#Selektivvertraege~#Aerztlich~9#/Aerztlich~#Zahnaerztlich~9#/Zahnaerztlich~#/Selektivvertraege~#/UC_GeschuetzteVersichertendatenXML~#/ListOfDocs~';
	end;
end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ish_rzv_insurance_pck.get_xml_convenio_separado ( ds_xml_convenio_p text, ds_xml_conv1_p INOUT text, ds_xml_conv2_p INOUT text) FROM PUBLIC;
