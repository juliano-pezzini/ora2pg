-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ish_rzv_insurance_pck.get_xml_conv_pesfisi ( ds_xml_p xml, ds_xml_pesfisi_p INOUT text, ds_xml_conv_p INOUT text) AS $body$
DECLARE


ds_xml_w        	varchar(4000);
ds_xml_pessoa_w    	varchar(4000);
ds_xml_convenio_w  	varchar(4000);
ds_xml_aux_w		varchar(4000);
ds_xml_aux2_w		varchar(4000);


BEGIN

begin

ds_xml_w	:= ds_xml_p;
ds_xml_w	:= replace(ds_xml_w, obter_desc_expressao(961209), 'ss');
ds_xml_w	:= replace(ds_xml_w, chr(38) ||'lt;','<');
ds_xml_w	:= replace(ds_xml_w, chr(38) ||'#xA;','');
ds_xml_w	:= replace(ds_xml_w, chr(38) ||'gt;','>');
ds_xml_w	:= replace(ds_xml_w, chr(38) ||'quot;','"');
ds_xml_w	:= replace(ds_xml_w, 'vsdp:','');
ds_xml_w	:= replace(ds_xml_w, 'vsda:','');
ds_xml_w	:= replace(ds_xml_w, 'vsdg:','');
ds_xml_w	:= replace(ds_xml_w, ':vsdp','');
ds_xml_w	:= replace(ds_xml_w, ':vsda','');
ds_xml_w	:= replace(ds_xml_w, ':vsdg','');

ds_xml_w	:= replace(ds_xml_w, substr(ds_xml_w,1, position('?>' in ds_xml_w)+1),'');
ds_xml_w	:= replace(ds_xml_w, '<ListOfDocs>','');
ds_xml_w	:= replace(ds_xml_w, '</ListOfDocs>','');

ds_xml_aux_w	:= substr(ds_xml_w,instr(ds_xml_w,'<UC_AllgemeineVersicherungsdatenXML',1,1),4000);

if (position('</UC_AllgemeineVersicherungsdatenXML>' in ds_xml_aux_w) > 0) then
	ds_xml_convenio_w 	:= substr(ds_xml_aux_w,1,position('</UC_AllgemeineVersicherungsdatenXML>' in ds_xml_aux_w)+36);
end if;

ds_xml_aux_w	:= substr(ds_xml_w,instr(ds_xml_w,'<UC_GeschuetzteVersichertendatenXML',1,1),4000);

if (position('</UC_GeschuetzteVersichertendatenXML>' in ds_xml_aux_w) > 0) then	
	ds_xml_aux2_w 		:= substr(ds_xml_aux_w,1,position('</UC_GeschuetzteVersichertendatenXML>' in ds_xml_aux_w)+36);
end if;

ds_xml_aux_w	:= substr(ds_xml_w,instr(ds_xml_w,'<UC_PersoenlicheVersichertendatenXML',1,1),4000);

if (position('</UC_PersoenlicheVersichertendatenXML>' in ds_xml_aux_w) > 0) then
	ds_xml_pessoa_w 	:= substr(ds_xml_aux_w,1,position('</UC_PersoenlicheVersichertendatenXML>' in ds_xml_aux_w)+37);
end if;

ds_xml_conv_p 		:= ds_xml_convenio_w || ds_xml_aux2_w;
ds_xml_pesfisi_p	:= ds_xml_pessoa_w;
exception
when others then
	ds_xml_conv_p		:= null;
	ds_xml_pesfisi_p	:= null;
end;	
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ish_rzv_insurance_pck.get_xml_conv_pesfisi ( ds_xml_p xml, ds_xml_pesfisi_p INOUT text, ds_xml_conv_p INOUT text) FROM PUBLIC;
