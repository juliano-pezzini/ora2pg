-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE execucao_prescricao_pck.consiste_medico ( nr_atendimento_p bigint, cd_convenio_p bigint, cd_setor_atendimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_tipo_atendimento_p bigint, nr_seq_proc_interno_p bigint, dt_execucao_p timestamp, nr_seq_classificacao_p bigint, ie_acao_executada_p bigint, ie_funcao_medico_p text, ie_funcao_med_enabled_p text, ie_medico_exe_enabled_p text, cd_medico_executor_p text, nm_usuario_p text, ie_erro_p INOUT text) AS $body$
BEGIN
	
	ie_erro_p := 'N';
	
	consiste_medico_executor(
				get_estabelecimento,
				cd_convenio_p,
				cd_setor_atendimento_p,
				cd_procedimento_p,
				ie_origem_proced_p,
				ie_tipo_atendimento_p,
				null,
				nr_seq_proc_interno_p,
				current_setting('execucao_prescricao_pck.ie_medico_executor_w')::varchar(10),
				current_setting('execucao_prescricao_pck.cd_cgc_w')::varchar(14),
				current_setting('execucao_prescricao_pck.cd_medico_executor_w')::procedimento_paciente.cd_medico_executor%type,
				current_setting('execucao_prescricao_pck.cd_pessoa_fisica_w')::procedimento_paciente.cd_pessoa_fisica%type,
				null,
				dt_execucao_p,
				nr_seq_classificacao_p,
				null,
				null,
				null,
				null);
				
	if (ie_acao_executada_p = 1) and (coalesce(cd_medico_executor_p::text, '') = '') and (ie_medico_exe_enabled_p = 'S') then
		
		if (current_setting('execucao_prescricao_pck.ie_medico_executor_w')::varchar(10) in ('X', 'U')) then
			ie_erro_p := 'S';
			CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(317836, 'ie_medico='|| substr(obter_nome_medico(current_setting('execucao_prescricao_pck.cd_medico_executor_w')::procedimento_paciente.cd_medico_executor%type, 'N'),1,80)), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
		end if;
		
	end if;
	
	if (ie_erro_p = 'N') and (ie_acao_executada_p = 1) and (coalesce(ie_funcao_medico_p::text, '') = '') and (ie_funcao_med_enabled_p = 'S') then
		if (current_setting('execucao_prescricao_pck.ie_medico_executor_w')::varchar(10) = 'U') then
			ie_erro_p := 'S';
			CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(317841), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
		end if;
	end if;
	
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE execucao_prescricao_pck.consiste_medico ( nr_atendimento_p bigint, cd_convenio_p bigint, cd_setor_atendimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, ie_tipo_atendimento_p bigint, nr_seq_proc_interno_p bigint, dt_execucao_p timestamp, nr_seq_classificacao_p bigint, ie_acao_executada_p bigint, ie_funcao_medico_p text, ie_funcao_med_enabled_p text, ie_medico_exe_enabled_p text, cd_medico_executor_p text, nm_usuario_p text, ie_erro_p INOUT text) FROM PUBLIC;
