-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE execucao_prescricao_pck.valida_data_proc ( nr_atendimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_parametro_p timestamp, dt_entrada_p timestamp, dt_entrada_unidade_p timestamp, dt_alta_p timestamp, nm_usuario_p text, ie_erro_p INOUT text) AS $body$
BEGIN
	
	ie_erro_p := 'N';
	
	obter_param_usuario(24, 98, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, current_setting('execucao_prescricao_pck.ie_parametro_98_w')::varchar(1));
	obter_param_usuario(24, 223, obter_perfil_ativo, nm_usuario_p, wheb_usuario_pck.get_cd_estabelecimento, current_setting('execucao_prescricao_pck.ie_parametro_223_w')::varchar(1));
	
	if (current_setting('execucao_prescricao_pck.ie_parametro_98_w')::varchar(1) = 'S') and (dt_parametro_p IS NOT NULL AND dt_parametro_p::text <> '') and (dt_parametro_p < dt_entrada_unidade_p) then
		ie_erro_p := 'S';
		CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176823), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
	elsif (dt_parametro_p IS NOT NULL AND dt_parametro_p::text <> '') and (dt_entrada_p IS NOT NULL AND dt_entrada_p::text <> '') and (dt_parametro_p < dt_entrada_p) then
		ie_erro_p := 'S';
		CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176837), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
	elsif (current_setting('execucao_prescricao_pck.ie_parametro_223_w')::varchar(1) <> 'S') and (dt_parametro_p IS NOT NULL AND dt_parametro_p::text <> '') and (dt_alta_p IS NOT NULL AND dt_alta_p::text <> '') and (dt_parametro_p > dt_alta_p) then
		PERFORM set_config('execucao_prescricao_pck.ie_atendimento_apac_w', obter_se_atendimento_apac(nr_atendimento_p), false);
		if (current_setting('execucao_prescricao_pck.ie_atendimento_apac_w')::varchar(1) = 'N') then
			ie_erro_p := 'S';
			CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176838), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
		end if;
	elsif (dt_parametro_p IS NOT NULL AND dt_parametro_p::text <> '') and (trunc(dt_parametro_p) > trunc(clock_timestamp())) then
		ie_erro_p := 'S';
		CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176839), null, 'S', cd_procedimento_p, null, ie_origem_proced_p, nm_usuario_p);
	end if;
	
	end;	
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE execucao_prescricao_pck.valida_data_proc ( nr_atendimento_p bigint, cd_procedimento_p bigint, ie_origem_proced_p bigint, dt_parametro_p timestamp, dt_entrada_p timestamp, dt_entrada_unidade_p timestamp, dt_alta_p timestamp, nm_usuario_p text, ie_erro_p INOUT text) FROM PUBLIC;
