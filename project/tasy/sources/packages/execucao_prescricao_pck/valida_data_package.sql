-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE execucao_prescricao_pck.valida_data ( nr_atendimento_p bigint, cd_material_p bigint, dt_parametro_p timestamp, dt_entrada_p timestamp, dt_alta_p timestamp, nm_usuario_p text, ie_erro_p INOUT text) AS $body$
BEGIN
	ie_erro_p := 'N';
	if (dt_parametro_p < dt_entrada_p) then
		ie_erro_p := 'S';
		CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176837), null, 'S', null, cd_material_p, null, nm_usuario_p);
	elsif (dt_alta_p IS NOT NULL AND dt_alta_p::text <> '') and (dt_parametro_p > dt_alta_p) then
		
		PERFORM set_config('execucao_prescricao_pck.ie_atendimento_apac_w', obter_se_atendimento_apac(nr_atendimento_p), false);
		
		if (current_setting('execucao_prescricao_pck.ie_atendimento_apac_w')::varchar(1) = 'N') then
			ie_erro_p := 'S';
			CALL execucao_prescricao_pck.gerar_w_execucao_proc_mat(nr_atendimento_p, wheb_mensagem_pck.get_texto(176838), null, 'S', null, cd_material_p, null, nm_usuario_p);
		end if;
		
	end if;
	
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE execucao_prescricao_pck.valida_data ( nr_atendimento_p bigint, cd_material_p bigint, dt_parametro_p timestamp, dt_entrada_p timestamp, dt_alta_p timestamp, nm_usuario_p text, ie_erro_p INOUT text) FROM PUBLIC;
