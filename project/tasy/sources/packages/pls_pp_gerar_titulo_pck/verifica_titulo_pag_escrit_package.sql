-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_pp_gerar_titulo_pck.verifica_titulo_pag_escrit ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type) AS $body$
DECLARE


c01 CURSOR(	nr_seq_lote_pc	pls_pp_lote.nr_sequencia%type) FOR
	SELECT	a.nr_titulo_pagar,
		b.nr_seq_escrit
	from	pls_pp_prestador a,
		titulo_pagar_escrit b
	where	a.nr_seq_lote = nr_seq_lote_pc
	and	a.ie_cancelado = 'N'
	and	b.nr_titulo = a.nr_titulo_pagar
	and	(b.nr_seq_escrit IS NOT NULL AND b.nr_seq_escrit::text <> '');

BEGIN

for r_c01_w in c01(nr_seq_lote_p) loop
	if (r_c01_w.nr_seq_escrit IS NOT NULL AND r_c01_w.nr_seq_escrit::text <> '') then

		-- O titulo #@NR_TITULO#@ ja esta no pagamento_escritural #@NR_SEQ_ESCRIT#@!

		-- Nao e possivel cancelar este pagamento.

		CALL wheb_mensagem_pck.exibir_mensagem_abort(283646, 'NR_TITULO=' || r_c01_w.nr_titulo_pagar || ';NR_SEQ_ESCRIT=' || r_c01_w.nr_seq_escrit);
	end if;
end loop;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_pp_gerar_titulo_pck.verifica_titulo_pag_escrit ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type) FROM PUBLIC;
