-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_pp_gerar_titulo_pck.obter_data_venc_tit_terceiro ( ds_dia_p text, dt_referencia_p timestamp, dt_default_p timestamp) RETURNS timestamp AS $body$
DECLARE


dt_retorno_w	timestamp;


BEGIN

dt_retorno_w := dt_default_p;

-- caso o campo dia esteja informado entao altera a data de vencimento

if (ds_dia_p IS NOT NULL AND ds_dia_p::text <> '') and ((ds_dia_p)::numeric  between 1 and 31) then

	-- verifica se o ultimo dia do mes e menor que o dia informado na regra (ex. regra 31 mes 30)

	if (to_char(last_day(dt_referencia_p),'dd') < ds_dia_p) then
		dt_retorno_w := to_date(to_char(last_day(dt_referencia_p),'dd') || '/' ||
						to_char(dt_referencia_p,'mm/yyyy'));
	else
		dt_retorno_w := to_date(ds_dia_p || '/' || to_char(dt_referencia_p,'mm/yyyy'));
	end if;

	-- se a data for menor que a data de geracao dos titulos e adicionado um mes

	if (trunc(dt_retorno_w,'dd') < trunc(clock_timestamp(),'dd')) then

		dt_retorno_w := add_months(dt_retorno_w, 1);
	end if;
end if;

return dt_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_pp_gerar_titulo_pck.obter_data_venc_tit_terceiro ( ds_dia_p text, dt_referencia_p timestamp, dt_default_p timestamp) FROM PUBLIC;
