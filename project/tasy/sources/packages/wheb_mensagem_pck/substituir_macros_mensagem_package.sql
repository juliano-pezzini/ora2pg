-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_mensagem_pck.substituir_macros_mensagem ( vl_macros_p text) AS $body$
DECLARE


	ds_valores_macros_w	varchar(32766);
	nr_ctrl_loop_w		smallint := 0;
	nr_pos_separador_w	smallint;
	ds_macro_e_valor_w	varchar(32766);
	ds_macro_w		varchar(32766);
	ds_valor_w		varchar(32766);

	
BEGIN
	ds_valores_macros_w := vl_macros_p;

	while(ds_valores_macros_w IS NOT NULL AND ds_valores_macros_w::text <> '') and (nr_ctrl_loop_w < 100) loop
		begin
		nr_pos_separador_w := position(';' in ds_valores_macros_w);

		if (nr_pos_separador_w > 0) then
			begin
			ds_macro_e_valor_w	:= substr(ds_valores_macros_w, 1, nr_pos_separador_w-1);
			ds_valores_macros_w	:= substr(ds_valores_macros_w, nr_pos_separador_w+1, length(ds_valores_macros_w));
			end;
		else
			begin
			ds_macro_e_valor_w	:= ds_valores_macros_w;
			ds_valores_macros_w	:= null;
			end;
		end if;

		nr_pos_separador_w := position('=' in ds_macro_e_valor_w);

		if (nr_pos_separador_w > 0) then
			begin
			ds_macro_w	:= substr(ds_macro_e_valor_w, 1, nr_pos_separador_w-1);
			ds_valor_w	:= substr(ds_macro_e_valor_w, nr_pos_separador_w+1, length(ds_macro_e_valor_w));

			if (ds_macro_w IS NOT NULL AND ds_macro_w::text <> '') then
				begin
				PERFORM set_config('wheb_mensagem_pck.ds_mensagem_w', replace(current_setting('wheb_mensagem_pck.ds_mensagem_w')::varchar(32766), '#@' || upper(ds_macro_w) || '#@', ds_valor_w), false);
				PERFORM set_config('wheb_mensagem_pck.ds_mensagem_w', replace(current_setting('wheb_mensagem_pck.ds_mensagem_w')::varchar(32766), '#@' || lower(ds_macro_w) || '#@', ds_valor_w), false);
				end;
			end if;
			end;
		end if;

		nr_ctrl_loop_w := nr_ctrl_loop_w + 1;
		end;
	end loop;
	end;
	
	-- utilizar a chamada apenas qdo retorna um DS_ERRO ja tratado
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE wheb_mensagem_pck.substituir_macros_mensagem ( vl_macros_p text) FROM PUBLIC;
