-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

-- retorna todas as regras e eventos de acordo com os parâmetros (desconto, provento, etc.)
	-- todas as regras que contém valor fixo diretamente na regra
	
	-- todas as regras que possuem valor fixo
	-- configurado na tabela filha da regra
	
	-- todas as regras que possuem valor para gerar
	-- configurado na tabela filha da regra (geralmente valores baseados em percentual)
	

-- busca os detalhes da regra quando a mesma quando a mesma for
		-- lançamento de valor fixo
		
		-- demais tipos de lançamento
		
		-- parte SE
		
		-- parte ENTÃO
		-- lançamento de valor fixo baseado em percentual
		
		-- lançamento de valor fixo baseado em percentual com valor limite
		
	-- somente retorna para lote/prestador e evento que estiver liberado para ter lançamento
	


CREATE OR REPLACE FUNCTION pls_pp_lanc_programado_pck.obter_lotes_lanc_prog_post ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE


ds_retorno_w	varchar(4000);

c01 CURSOR(	nr_seq_lote_pc	pls_pp_lote.nr_sequencia%type) FOR
	SELECT	to_char(b.nr_seq_lote) nr_seq_lote
	from	pls_pp_item_lote_lp_v a,
		pls_pp_item_lote_origem b
	where	a.nr_seq_lote = nr_seq_lote_pc
	and	b.nr_seq_item_origem = a.nr_sequencia
	and	b.nr_seq_lote != nr_seq_lote_pc;

BEGIN

for r_c01_w in c01(nr_seq_lote_p) loop

	ds_retorno_w := pls_util_pck.concatena_string(	ds_retorno_w, r_c01_w.nr_seq_lote);
end loop;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_pp_lanc_programado_pck.obter_lotes_lanc_prog_post ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type) FROM PUBLIC;
