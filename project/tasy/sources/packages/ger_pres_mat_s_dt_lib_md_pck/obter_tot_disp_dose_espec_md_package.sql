-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ger_pres_mat_s_dt_lib_md_pck.obter_tot_disp_dose_espec_md ( ie_regra_p text, ie_tipo_regra_disp_p text, ie_param1132_p text, nr_ocorrencia_p bigint, qt_dose_especial_p INOUT bigint, qt_total_dispensar_p INOUT bigint) AS $body$
BEGIN
		if (ie_regra_p	= 'S') and (trunc(qt_dose_especial_p,0) <> qt_dose_especial_p) then
			qt_dose_especial_p	:= trunc(qt_dose_especial_p,0) + 1;
		end if;

		if (ie_tipo_regra_disp_p <> 'H') then
			if (ie_tipo_regra_disp_p = 'S') and (ie_param1132_p = 'S') then
				qt_total_dispensar_p	:= coalesce(qt_total_dispensar_p,0) - ceil(qt_dose_especial_p);
			else
				qt_total_dispensar_p	:= coalesce(qt_total_dispensar_p,0) - coalesce(qt_dose_especial_p,0);
			end if;

			if (ie_param1132_p = 'S') then
				qt_dose_especial_p	:= ceil(qt_dose_especial_p);
			end if;
		else
			qt_dose_especial_p		:=  dividir_md(qt_total_dispensar_p,nr_ocorrencia_p);
		end if;
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ger_pres_mat_s_dt_lib_md_pck.obter_tot_disp_dose_espec_md ( ie_regra_p text, ie_tipo_regra_disp_p text, ie_param1132_p text, nr_ocorrencia_p bigint, qt_dose_especial_p INOUT bigint, qt_total_dispensar_p INOUT bigint) FROM PUBLIC;
