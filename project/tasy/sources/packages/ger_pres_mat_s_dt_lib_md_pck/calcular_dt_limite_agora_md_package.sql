-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ger_pres_mat_s_dt_lib_md_pck.calcular_dt_limite_agora_md (ds_turno_agora_p text, ds_final_turno_agora_p text, dt_inicio_prescr_p timestamp, qt_min_antes_atend_p bigint, dt_horario_p timestamp ) RETURNS timestamp AS $body$
DECLARE

    dt_limite_agora_w timestamp;

BEGIN
    if (ds_turno_agora_p > ds_final_turno_agora_p) then
      if (ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_horario_p) > ESTABLISHMENT_TIMEZONE_UTILS.startOfDay(dt_inicio_prescr_p)) then
        dt_limite_agora_w := PKG_DATE_UTILS.get_Time(dt_horario_p - 1, ds_turno_agora_p) - (dividir_sem_round_md(qt_min_antes_atend_p,1440));
   
																																			 
																																			 
  
	  else 
		dt_limite_agora_w := PKG_DATE_UTILS.get_Time(dt_horario_p, ds_turno_agora_p) - (dividir_sem_round_md(qt_min_antes_atend_p,1440));
      end if;
    else
      dt_limite_agora_w := PKG_DATE_UTILS.get_Time(dt_horario_p, ds_turno_agora_p) - (dividir_sem_round_md(qt_min_antes_atend_p,1440));
    end if;

    return dt_limite_agora_w;
  end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ger_pres_mat_s_dt_lib_md_pck.calcular_dt_limite_agora_md (ds_turno_agora_p text, ds_final_turno_agora_p text, dt_inicio_prescr_p timestamp, qt_min_antes_atend_p bigint, dt_horario_p timestamp ) FROM PUBLIC;
