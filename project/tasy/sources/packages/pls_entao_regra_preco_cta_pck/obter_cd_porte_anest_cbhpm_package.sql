-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_entao_regra_preco_cta_pck.obter_cd_porte_anest_cbhpm ( nr_porte_anest_p INOUT cbhpm_preco.nr_porte_anest%type) AS $body$
DECLARE


cd_porte_anestesista_w	pls_ajuste_porte_cbhpm.cd_porte%type;
nr_porte_anest_cob_w	regra_porte_anest_cbhpm.nr_porte_anest_cobranca%type;

C01 CURSOR(	nr_porte_anest_pc	regra_porte_anest_cbhpm.nr_porte_anest%type) FOR
	SELECT	nr_porte_anest_cobranca
	from	regra_porte_anest_cbhpm
	where	nr_porte_anest = nr_porte_anest_pc
	order by nr_porte_anest desc;

BEGIN

for r_c01_w in C01(nr_porte_anest_p) loop
	
	-- o primeiro que retornou é o correto
	nr_porte_anest_cob_w := r_c01_w.nr_porte_anest_cobranca;
	
	-- sai do for e fecha o cursor
	exit;
end loop;

-- verifica se tem o número do porte da regra
if (nr_porte_anest_cob_w IS NOT NULL AND nr_porte_anest_cob_w::text <> '') then
	
	nr_porte_anest_p:= nr_porte_anest_cob_w;
end if;

-- Define porte do anestesista
case(nr_porte_anest_p)

	when 1 then

		cd_porte_anestesista_w := '3A';
	when 2 then

		cd_porte_anestesista_w := '3C';
	when 3 then

		cd_porte_anestesista_w := '4C';
	when 4 then

		cd_porte_anestesista_w := '6B';
	when 5 then

		cd_porte_anestesista_w := '7C';
	when 6 then

		cd_porte_anestesista_w := '9B';
	when 7 then

		cd_porte_anestesista_w := '10C';
	when 8 then

		cd_porte_anestesista_w := '12A';
	else

		cd_porte_anestesista_w := null;
end case;

return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_entao_regra_preco_cta_pck.obter_cd_porte_anest_cbhpm ( nr_porte_anest_p INOUT cbhpm_preco.nr_porte_anest%type) FROM PUBLIC;
