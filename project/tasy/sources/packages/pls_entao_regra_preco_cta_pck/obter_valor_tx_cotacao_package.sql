-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_entao_regra_preco_cta_pck.obter_valor_tx_cotacao ( vl_taxa_p pls_cp_cta_eproc.vl_ch_honorarios%type, cd_moeda_p pls_cp_cta_eproc.cd_moeda_ch_medico%type, dt_proced_referencia_p pls_conta_proc.dt_procedimento_referencia%type) RETURNS bigint AS $body$
DECLARE


vl_final_w	pls_cp_cta_eproc.vl_ch_honorarios%type;


BEGIN
-- se não foi informado a moeda retorna o valor informado no campo valor
if (coalesce(cd_moeda_p::text, '') = '') then 

	vl_final_w := vl_taxa_p;
-- senão verifica a cotação da moeda
else

	vl_final_w := pls_entao_regra_preco_cta_pck.obter_cotacao_moeda(cd_moeda_p, dt_proced_referencia_p);
end if;

return vl_final_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_entao_regra_preco_cta_pck.obter_valor_tx_cotacao ( vl_taxa_p pls_cp_cta_eproc.vl_ch_honorarios%type, cd_moeda_p pls_cp_cta_eproc.cd_moeda_ch_medico%type, dt_proced_referencia_p pls_conta_proc.dt_procedimento_referencia%type) FROM PUBLIC;
