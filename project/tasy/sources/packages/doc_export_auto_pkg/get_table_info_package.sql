-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION doc_export_auto_pkg.get_table_info (DS_TABLE_P TABELA_SISTEMA.NM_TABELA%TYPE, DT_REPORT_P DOC_EXPORT_MONIT.DT_ULTIMA_EXEC%TYPE) RETURNS RELATORIO_DINAMICO.DS_LABEL%TYPE AS $body$
DECLARE


    DS_RETURN_W      RELATORIO_DINAMICO.DS_LABEL%TYPE;
    DT_ATUALIZACAO_W DOC_EXPORT_MONIT.DT_ATUALIZACAO_TABELA%TYPE;
    QT_REGISTROS_W   DOC_EXPORT_MONIT.QT_REGISTROS_TABELA%TYPE;


BEGIN

    DS_RETURN_W := NULL;

    EXECUTE 'SELECT MAX(DT_ATUALIZACAO), COUNT(1) FROM ' || DS_TABLE_P || ' WHERE DT_ATUALIZACAO <= :A'
       INTO STRICT DT_ATUALIZACAO_W, QT_REGISTROS_W
      USING DT_REPORT_P;

    IF QT_REGISTROS_W > 0 THEN

      DS_RETURN_W := TO_CHAR(DT_ATUALIZACAO_W, 'YYYY/MM/DD HH24:MI:SS')
                     || ';' || QT_REGISTROS_W;

    END IF;

    RETURN DS_RETURN_W;

  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION doc_export_auto_pkg.get_table_info (DS_TABLE_P TABELA_SISTEMA.NM_TABELA%TYPE, DT_REPORT_P DOC_EXPORT_MONIT.DT_ULTIMA_EXEC%TYPE) FROM PUBLIC;
