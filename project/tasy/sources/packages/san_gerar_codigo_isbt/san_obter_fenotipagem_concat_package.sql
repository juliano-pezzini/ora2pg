-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION san_gerar_codigo_isbt.san_obter_fenotipagem_concat ( nr_seq_doacao_p bigint, ie_nt_p integer default 0) RETURNS varchar AS $body$
DECLARE


ds_retorno_w   varchar(255);
ds_d_w         varchar(7);
ds_c_w         varchar(7);
ds_e_w         varchar(7);
ds_c_min_w     varchar(7);
ds_e_min_w     varchar(7);
ds_f_min_w     varchar(7);
ds_cw_w        varchar(7);
ds_k_w         varchar(7);
ds_k_min_w     varchar(7);
ds_kpa_w       varchar(7);
ds_kpb_w       varchar(7);
ds_jsa_w       varchar(7);
ds_jsb_w       varchar(7);
ds_fya_w       varchar(7);
ds_fyb_w       varchar(7);
ds_jka_w       varchar(7);
ds_jkb_w       varchar(7);
ds_lea_w       varchar(7);
ds_leb_w       varchar(7);
ds_s_w         varchar(7);
ds_s_min_w     varchar(7);
ds_m_w         varchar(7);
ds_n_w         varchar(7);
ds_p1_w        varchar(7);
ds_lua_w       varchar(7);
ds_lub_w       varchar(7);
ds_dia_w       varchar(7);

c01 CURSOR FOR
	SELECT
		CASE WHEN ds_d=1 THEN  'D+' WHEN ds_d=0 THEN  'D-' WHEN ds_d=2 THEN  'D_T' END ,
		CASE WHEN ds_c=1 THEN  'C+' WHEN ds_c=0 THEN  'C-' WHEN ds_c=2 THEN  'C_T' END ,
		CASE WHEN ds_e=1 THEN  'E+' WHEN ds_e=0 THEN  'E-' WHEN ds_e=2 THEN  'E_T' END ,
		CASE WHEN ds_c_min=1 THEN  'c+' WHEN ds_c_min=0 THEN  'c-' WHEN ds_c_min=2 THEN  'c_T' END ,
		CASE WHEN ds_e_min=1 THEN  'e+' WHEN ds_e_min=0 THEN  'e-' WHEN ds_e_min=2 THEN  'e_T' END ,
		CASE WHEN ds_f_min=1 THEN  'f+' WHEN ds_f_min=0 THEN  'f-' WHEN ds_f_min=2 THEN  'f_T' END ,
		CASE WHEN ds_cw=1 THEN  'Cw+' WHEN ds_cw=0 THEN  'Cw-' WHEN ds_cw=2 THEN  'Cw_T' END ,
		CASE WHEN ds_k=1 THEN  'K+' WHEN ds_k=0 THEN  'K-' WHEN ds_k=2 THEN  'K_T' END ,
		CASE WHEN ds_k_min=1 THEN  'k+' WHEN ds_k_min=0 THEN  'k-' WHEN ds_k_min=2 THEN  'k_T' END ,
		CASE WHEN ds_kpa=1 THEN  'Kpa+' WHEN ds_kpa=0 THEN  'Kpa-' WHEN ds_kpa=2 THEN  'Kpa_T' END ,
		CASE WHEN ds_kpb=1 THEN  'Kpb+' WHEN ds_kpb=0 THEN  'Kpb-' WHEN ds_kpb=2 THEN  'Kpb_T' END ,
		CASE WHEN ds_jsa=1 THEN  'Jsa+' WHEN ds_jsa=0 THEN  'Jsa-' WHEN ds_jsa=2 THEN  'Jsa_T' END ,
		CASE WHEN ds_jsb=1 THEN  'Jsb+' WHEN ds_jsb=0 THEN  'Jsb-' WHEN ds_jsb=2 THEN  'Jsb_T' END ,
		CASE WHEN ds_fya=1 THEN  'Fya+' WHEN ds_fya=0 THEN  'Fya-' WHEN ds_fya=2 THEN  'Fya_T' END ,
		CASE WHEN ds_fyb=1 THEN  'Fyb+' WHEN ds_fyb=0 THEN  'Fyb-' WHEN ds_fyb=2 THEN  'Fyb_T' END ,
		CASE WHEN ds_jka=1 THEN  'Jka+' WHEN ds_jka=0 THEN  'Jka-' WHEN ds_jka=2 THEN  'Jka_T' END ,
		CASE WHEN ds_jkb=1 THEN  'Jkb+' WHEN ds_jkb=0 THEN  'Jkb-' WHEN ds_jkb=2 THEN  'Jkb_T' END ,
		CASE WHEN ds_lea=1 THEN  'Lea+' WHEN ds_lea=0 THEN  'Lea-' WHEN ds_lea=2 THEN  'Lea_T' END ,
		CASE WHEN ds_leb=1 THEN  'Leb+' WHEN ds_leb=0 THEN  'Leb-' WHEN ds_leb=2 THEN  'Leb_T' END ,
		CASE WHEN ds_s=1 THEN  'S+' WHEN ds_s=0 THEN  'S-' WHEN ds_s=2 THEN  'S_T' END ,
		CASE WHEN ds_s_min=1 THEN  's+' WHEN ds_s_min=0 THEN  's-' WHEN ds_s_min=2 THEN  's_T' END ,
		CASE WHEN ds_m=1 THEN  'M+' WHEN ds_m=0 THEN  'M-' WHEN ds_m=2 THEN  'M_T' END ,
		CASE WHEN ds_n=1 THEN  'N+' WHEN ds_n=0 THEN  'N-' WHEN ds_n=2 THEN  'N_T' END ,
		CASE WHEN ds_p1=1 THEN  'P1+' WHEN ds_p1=0 THEN  'P1-' WHEN ds_p1=2 THEN  'P1_T' END ,
		CASE WHEN ds_lua=1 THEN  'Lua+' WHEN ds_lua=0 THEN  'Lua-' WHEN ds_lua=2 THEN  'Lua_T' END ,
		CASE WHEN ds_lub=1 THEN  'Lub+' WHEN ds_lub=0 THEN  'Lub-' WHEN ds_lub=2 THEN  'Lub_T' END ,
		CASE WHEN ds_dia=1 THEN  'Dia+' WHEN ds_dia=0 THEN  'Dia-' WHEN ds_dia=2 THEN  'Dia_T' END
	FROM
		san_result_fenotipagem
	WHERE (nr_seq_doacao = nr_seq_doacao_p or nr_seq_producao = nr_seq_doacao_p)
		AND (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
		AND coalesce(dt_inativacao::text, '') = ''
		order by dt_liberacao desc;

BEGIN

ds_retorno_w := '';

IF (nr_seq_doacao_p IS NOT NULL AND nr_seq_doacao_p::text <> '') THEN

  open c01;
	loop
	fetch c01 into
		ds_d_w,
                ds_c_w,
                ds_e_w,
                ds_c_min_w,
                ds_e_min_w,
                ds_f_min_w,
                ds_cw_w,
                ds_k_w,
                ds_k_min_w,
                ds_kpa_w,
                ds_kpb_w,
                ds_jsa_w,
                ds_jsb_w,
                ds_fya_w,
                ds_fyb_w,
                ds_jka_w,
                ds_jkb_w,
                ds_lea_w,
                ds_leb_w,
                ds_s_w,
                ds_s_min_w,
                ds_m_w,
                ds_n_w,
                ds_p1_w,
                ds_lua_w,
                ds_lub_w,
                ds_dia_w;
	EXIT WHEN NOT FOUND; /* apply on c01 */
  begin

        IF (ds_d_w IS NOT NULL AND ds_d_w::text <> '') THEN
		if((position('D+' in ds_retorno_w) = 0 and position('D-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('D_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_d_w <> 'D_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_d_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_d_w;
				end if;
			end if;
		end if;
        END IF;
	
	 IF (ds_c_w IS NOT NULL AND ds_c_w::text <> '') THEN
		if((position('C+' in ds_retorno_w) = 0 and position('C-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('C_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_c_w <> 'C_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_c_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_c_w;
				end if;
			end if;
		end if;
        END IF;

	IF (ds_c_min_w IS NOT NULL AND ds_c_min_w::text <> '') THEN
		if((position('c+' in ds_retorno_w) = 0 and position('c-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('c_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_c_min_w <> 'c_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_c_min_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_c_min_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_e_w IS NOT NULL AND ds_e_w::text <> '') THEN
		if((position('E+' in ds_retorno_w) = 0 and position('E-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('E_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_e_w <> 'E_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_e_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_e_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_e_min_w IS NOT NULL AND ds_e_min_w::text <> '') THEN
		if((position('e+' in ds_retorno_w) = 0 and position('e-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('e_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_e_min_w <> 'e_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_e_min_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_e_min_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_f_min_w IS NOT NULL AND ds_f_min_w::text <> '') THEN
		if((position('f+' in ds_retorno_w) = 0 and position('f-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('f_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_f_min_w <> 'f_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_f_min_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_f_min_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_cw_w IS NOT NULL AND ds_cw_w::text <> '') THEN
		if((position('Cw+' in ds_retorno_w) = 0 and position('Cw-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Cw_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_Cw_w <> 'Cw_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_cw_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_cw_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_k_w IS NOT NULL AND ds_k_w::text <> '') THEN
		if((position('K+' in ds_retorno_w) = 0 and position('K-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('K_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_k_w <> 'K_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_k_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_k_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_k_min_w IS NOT NULL AND ds_k_min_w::text <> '') THEN
		if((position('k+' in ds_retorno_w) = 0 and position('k-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('k_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_k_min_w <> 'k_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_k_min_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_k_min_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_kpa_w IS NOT NULL AND ds_kpa_w::text <> '') THEN
		if((position('Kpa+' in ds_retorno_w) = 0 and position('Kpa-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Kpa_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_kpa_w <> 'Kpa_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_kpa_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_kpa_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_kpb_w IS NOT NULL AND ds_kpb_w::text <> '') THEN
		if((position('Kpb+' in ds_retorno_w) = 0 and position('Kpb-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Kpb_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_kpb_w <> 'Kpb_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_kpb_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_kpb_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_jsa_w IS NOT NULL AND ds_jsa_w::text <> '') THEN
		if((position('Jsa+' in ds_retorno_w) = 0 and position('Jsa-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Jsa_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_jsa_w <> 'Jsa_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_jsa_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_jsa_w;
				end if;	
			end if;
		end if;
  END IF;
	
	IF (ds_jsb_w IS NOT NULL AND ds_jsb_w::text <> '') THEN
		if((position('Jsb+' in ds_retorno_w) = 0 and position('Jsb-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Jsb_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_jsb_w <> 'Jsb_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_jsb_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_jsb_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_fya_w IS NOT NULL AND ds_fya_w::text <> '') THEN
		if((position('Fya+' in ds_retorno_w) = 0 and position('Fya-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Fya_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_fya_w <> 'Fya_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_fya_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_fya_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_fyb_w IS NOT NULL AND ds_fyb_w::text <> '') THEN
		if((position('Fyb+' in ds_retorno_w) = 0 and position('Fyb-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Fyb_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_fyb_w <> 'Fyb_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_fyb_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_fyb_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_jka_w IS NOT NULL AND ds_jka_w::text <> '') THEN
		if((position('Jka+' in ds_retorno_w) = 0 and position('Jka-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Jka_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_jka_w <> 'Jka_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_jka_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_jka_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_jkb_w IS NOT NULL AND ds_jkb_w::text <> '') THEN
		if((position('Jkb+' in ds_retorno_w) = 0 and position('Jkb-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Jkb_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_jkb_w <> 'Jkb_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_jkb_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_jkb_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_lea_w IS NOT NULL AND ds_lea_w::text <> '') THEN
		if((position('Lea+' in ds_retorno_w) = 0 and position('Lea-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Lea_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_lea_w <> 'Lea_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_lea_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_lea_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_leb_w IS NOT NULL AND ds_leb_w::text <> '') THEN
		if((position('Leb+' in ds_retorno_w) = 0 and position('Leb-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Leb_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_leb_w <> 'Leb_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_leb_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_leb_w;
				end if;
			end if;
		end if;
	END IF;
	
	IF (ds_p1_w IS NOT NULL AND ds_p1_w::text <> '') THEN
		if((position('P1+' in ds_retorno_w) = 0 and position('P1-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('P1_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_p1_w <> 'P1_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_p1_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_p1_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_m_w IS NOT NULL AND ds_m_w::text <> '') THEN
		if((position('M+' in ds_retorno_w) = 0 and position('M-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('M_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_m_w <> 'M_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_m_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_m_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_n_w IS NOT NULL AND ds_n_w::text <> '') THEN
		if((position('N+' in ds_retorno_w) = 0 and position('N-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('N_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_n_w <> 'N_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_n_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_n_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_s_w IS NOT NULL AND ds_s_w::text <> '') THEN
		if((position('S+' in ds_retorno_w) = 0 and position('S-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('S_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_s_w <> 'S_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_s_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_s_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_s_min_w IS NOT NULL AND ds_s_min_w::text <> '') THEN
		if((position('s+' in ds_retorno_w) = 0 and position('s-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('s_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_s_min_w <> 's_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_s_min_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_s_min_w;
				end if;
			end if;
		end if;
	END IF;
	
	IF (ds_lua_w IS NOT NULL AND ds_lua_w::text <> '') THEN
		if((position('Lua+' in ds_retorno_w) = 0 and position('Lua-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Lua_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_lua_w <> 'Lua_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_lua_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_lua_w;
				end if;
			end if;
		end if;
        END IF;
	
	IF (ds_lub_w IS NOT NULL AND ds_lub_w::text <> '') THEN
		if((position('Lub+' in ds_retorno_w) = 0 and position('Lub-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Lub_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_lub_w <> 'Lub_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_lub_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_lub_w;
				end if;
			end if;
		end if;
	END IF;
	
	IF (ds_dia_w IS NOT NULL AND ds_dia_w::text <> '') THEN
		if((position('Dia+' in ds_retorno_w) = 0 and position('Dia-' in ds_retorno_w) = 0) or coalesce(ds_retorno_w::text, '') = '') then
			if(((ie_nt_p = 1 and position('Dia_T' in ds_retorno_w) = 0) or (ie_nt_p = 1 and coalesce(ds_retorno_w::text, '') = '')) or (ie_nt_p = 0 and  ds_dia_w <> 'Dia_T')) then
				if (coalesce(ds_retorno_w::text, '') = '') then
					ds_retorno_w := ds_dia_w;
				else
					ds_retorno_w := ds_retorno_w || ', ' || ds_dia_w;
				end if;
			end if;
		end if;
        END IF;
	
	end;
	end loop;
	close c01;

END IF;

RETURN ds_retorno_w;

END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION san_gerar_codigo_isbt.san_obter_fenotipagem_concat ( nr_seq_doacao_p bigint, ie_nt_p integer default 0) FROM PUBLIC;
