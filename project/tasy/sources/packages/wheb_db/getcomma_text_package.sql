-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_db.getcomma_text (sql_p text, separator_p text DEFAULT ', ', prefix_p text DEFAULT NULL, sufix_p text DEFAULT NULL) RETURNS varchar AS $body$
DECLARE

	comma_text_w varchar(32000);
	column_w     varchar(4000);
	cursor_w     integer;
	ignore_w     integer;
	
BEGIN
	comma_text_w := NULL;
	BEGIN
	  cursor_w := DBMS_SQL.OPEN_CURSOR;
	  DBMS_SQL.PARSE(cursor_w, sql_p, DBMS_SQL.Native);
	  DBMS_SQL.DEFINE_COLUMN(cursor_w, 1, column_w, 4000);
	  ignore_w := DBMS_SQL.EXECUTE(cursor_w);

	  LOOP
		IF DBMS_SQL.FETCH_ROWS(cursor_w) > 0 THEN
		  DBMS_SQL.COLUMN_VALUE(cursor_w, 1, column_w);

		  IF (column_w IS NOT NULL AND column_w::text <> '') THEN

			IF (comma_text_w IS NOT NULL AND comma_text_w::text <> '') THEN
			  comma_text_w := comma_text_w || separator_p;
			END IF;

			comma_text_w := comma_text_w || prefix_p || column_w || sufix_p;
		  END IF;
		ELSE
		  EXIT;
		END IF;
	  END LOOP;

	  DBMS_SQL.CLOSE_CURSOR(cursor_w);
	EXCEPTION
	  WHEN OTHERS THEN
		DBMS_SQL.CLOSE_CURSOR(cursor_w);
		CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(sqlerrm(SQLSTATE));
	END;

	RETURN comma_text_w;
	END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_db.getcomma_text (sql_p text, separator_p text DEFAULT ', ', prefix_p text DEFAULT NULL, sufix_p text DEFAULT NULL) FROM PUBLIC;
