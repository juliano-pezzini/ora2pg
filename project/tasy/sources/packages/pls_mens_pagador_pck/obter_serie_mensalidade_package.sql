-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_mens_pagador_pck.obter_serie_mensalidade ( ie_contrato_p text, ie_tipo_contratacao_p pls_plano.ie_tipo_contratacao%type, ie_preco_p pls_plano.ie_preco%type, ie_situacao_trabalhista_p pls_contrato_pagador.ie_situacao_trabalhista%type, nr_seq_classif_itens_p pls_classif_itens_pagador.nr_sequencia%type) RETURNS PLS_MENSALIDADE.NR_SERIE_MENSALIDADE%TYPE AS $body$
DECLARE

nr_serie_mensalidade_w	pls_mensalidade.nr_serie_mensalidade%type;

C01 CURSOR FOR
	SELECT	a.nr_serie_nf
	from	pls_regra_serie_nf		b,
		pls_regra_serie_nf_compl	a
	where	a.nr_seq_regra		= b.nr_sequencia
	and	b.ie_situacao		= 'A'
	and	((a.ie_tipo_contrato	= ie_contrato_p) or (coalesce(a.ie_tipo_contrato::text, '') = ''))
	and	((a.ie_tipo_contratacao	= ie_tipo_contratacao_p) or (coalesce(a.ie_tipo_contratacao::text, '') = ''))
	and	((a.ie_preco		= ie_preco_p) or (coalesce(a.ie_preco::text, '') = ''))
	and	((a.ie_situacao_trabalhista = ie_situacao_trabalhista_p) or (coalesce(a.ie_situacao_trabalhista::text, '') = ''))
	and	((a.ie_primeira_mensalidade = 'S' AND pls_lote_mensalidade_w.ie_primeira_mensalidade = 'S') or (coalesce(a.ie_primeira_mensalidade,'N') = 'N'))
	and	((a.nr_seq_classif_itens = nr_seq_classif_itens_p) or (coalesce(a.nr_seq_classif_itens::text, '') = ''))
	order by coalesce(a.ie_primeira_mensalidade,'N'),
		coalesce(a.nr_seq_classif_itens,-1),
		coalesce(a.ie_situacao_trabalhista,' '),
		coalesce(a.ie_preco,'-1'),
		coalesce(a.ie_tipo_contratacao,' '),
		coalesce(a.ie_tipo_contrato,' ');

BEGIN

for r_c01_w in C01 loop
	nr_serie_mensalidade_w	:= r_c01_w.nr_serie_nf;
end loop;

return nr_serie_mensalidade_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_mens_pagador_pck.obter_serie_mensalidade ( ie_contrato_p text, ie_tipo_contratacao_p pls_plano.ie_tipo_contratacao%type, ie_preco_p pls_plano.ie_preco%type, ie_situacao_trabalhista_p pls_contrato_pagador.ie_situacao_trabalhista%type, nr_seq_classif_itens_p pls_classif_itens_pagador.nr_sequencia%type) FROM PUBLIC;
