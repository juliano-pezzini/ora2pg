-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ish_case_proc_data_pck.update_procedimento_paciente (procedimento_paciente_p procedimento_paciente, ie_proc_princ_p text, ie_proc_adicional_p text) AS $body$
DECLARE

			
procedimento_paciente_w		procedimento_paciente%rowtype;
procedimento_pac_medico_w	procedimento_pac_medico%rowtype;


BEGIN

procedimento_paciente_w	:= procedimento_paciente_p;

if (procedimento_paciente_w.nr_sequencia IS NOT NULL AND procedimento_paciente_w.nr_sequencia::text <> '') then

	procedimento_paciente_w.ie_proc_princ_atend	:= coalesce(ie_proc_princ_p,'N');

	update	procedimento_paciente
	set	row = procedimento_paciente_w
	where	nr_sequencia	= procedimento_paciente_w.nr_sequencia;
	
	begin
	select	*
	into STRICT	procedimento_pac_medico_w
	from	procedimento_pac_medico
	where	nr_atendimento	= procedimento_paciente_w.nr_atendimento
	and	nr_seq_propaci	= procedimento_paciente_w.nr_sequencia  LIMIT 1;
	exception
	when others then
		procedimento_pac_medico_w.nr_sequencia 	:= null;
	end;
	
	if (procedimento_pac_medico_w.nr_sequencia IS NOT NULL AND procedimento_pac_medico_w.nr_sequencia::text <> '') then
		
		procedimento_pac_medico_w.ie_proc_princ		:= ie_proc_princ_p;
		procedimento_pac_medico_w.ie_proc_adicional	:= ie_proc_adicional_p;
		procedimento_pac_medico_w.dt_atualizacao	:= procedimento_paciente_w.dt_atualizacao;
		procedimento_pac_medico_w.nm_usuario		:= procedimento_paciente_w.nm_usuario;
		procedimento_pac_medico_w.cd_procedimento 	:= procedimento_paciente_w.cd_procedimento;
		procedimento_pac_medico_w.ie_origem_proced	:= procedimento_paciente_w.ie_origem_proced;
		procedimento_pac_medico_w.qt_procedimento	:= procedimento_paciente_w.qt_procedimento;
		procedimento_pac_medico_w.ie_lado		:= procedimento_paciente_w.ie_lado;
		procedimento_pac_medico_w.nr_seq_proc_interno	:= procedimento_paciente_w.nr_seq_proc_interno;
		procedimento_pac_medico_w.dt_procedimento	:= procedimento_paciente_w.dt_procedimento;
		
		update	procedimento_pac_medico
		set	row		= procedimento_pac_medico_w
		where	nr_sequencia	= procedimento_pac_medico_w.nr_sequencia;
	end if;
	
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ish_case_proc_data_pck.update_procedimento_paciente (procedimento_paciente_p procedimento_paciente, ie_proc_princ_p text, ie_proc_adicional_p text) FROM PUBLIC;
