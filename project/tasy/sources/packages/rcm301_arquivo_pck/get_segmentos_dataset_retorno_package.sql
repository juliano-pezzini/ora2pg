-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION rcm301_arquivo_pck.get_segmentos_dataset_retorno (ie_dataset_p text, nr_seq_arquivo_p bigint) RETURNS SETOF T_DATASET_SEGMENTO AS $body$
DECLARE


r_dataset_segmento_w		r_dataset_segmento;
nr_seq_estrut_arq_w		d301_arquivo_retorno.nr_seq_estrut_arq%type;

c01 CURSOR FOR
SELECT	ie_segmento,
	ie_obrigatorio,
	nr_ordem
from	c301_estrutura_seg_dataset
where 	ie_dataset 		= ie_dataset_p
and	nr_seq_estrut_arq	= nr_seq_estrut_arq_w
order by nr_ordem;

c01_w	c01%rowtype;


BEGIN

select	max(nr_seq_estrut_arq)
into STRICT	nr_seq_estrut_arq_w
from	d301_arquivo_retorno
where	nr_sequencia	= nr_seq_arquivo_p;

r_dataset_segmento_w.ie_dataset	:= ie_dataset_p;

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	r_dataset_segmento_w.ie_elemento	:= c01_w.ie_segmento;
	r_dataset_segmento_w.nr_tree_node	:= rcm301_arquivo_pck.get_treenode_segmento_retorno(c01_w.ie_segmento);
	r_dataset_segmento_w.nr_ordem		:= c01_w.nr_ordem;
	r_dataset_segmento_w.ie_obrigatorio	:= coalesce(c01_w.ie_obrigatorio,'N');
	RETURN NEXT r_dataset_segmento_w;
end loop;
close C01;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION rcm301_arquivo_pck.get_segmentos_dataset_retorno (ie_dataset_p text, nr_seq_arquivo_p bigint) FROM PUBLIC;
