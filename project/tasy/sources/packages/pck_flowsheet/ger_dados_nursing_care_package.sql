-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pck_flowsheet.ger_dados_nursing_care (cd_relatorio_p bigint, ie_dados_p text, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p bigint) AS $body$
DECLARE


    c2 CURSOR FOR
      SELECT distinct ds_data, nr_atendimento, ano
        from (SELECT pck_flowsheet.get_formata_data(a1.dt_inicio_ferida) ds_data,
                     b1.nr_atendimento,
                     to_char(a1.dt_inicio_ferida, 'yyyy') ano
                from cur_ferida a1,
                     atendimento_paciente b1
               where a1.dt_inicio_ferida between dt_inicial_p and dt_final_p
                 and b1.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a1.nr_atendimento = b1.nr_atendimento
                 and coalesce(a1.ie_situacao, 'A') = 'A'

union

              select pck_flowsheet.get_formata_data(a2.dt_curativo) ds_data,
                     b2.nr_atendimento,
                     to_char(a2.dt_curativo, 'yyyy') ano
                from cur_curativo a2,
                     atendimento_paciente b2
               where a2.dt_curativo between dt_inicial_p and dt_final_p
                 and b2.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a2.nr_atendimento = b2.nr_atendimento
                 and coalesce(a2.ie_situacao, 'A') = 'A'
              
union

              select pck_flowsheet.get_formata_data(a3.dt_instalacao) ds_data,
                     b3.nr_atendimento,
                     to_char(a3.dt_instalacao, 'yyyy') ano
                from atend_pac_dispositivo a3,
                     atendimento_paciente b3
               where a3.dt_instalacao between dt_inicial_p and dt_final_p
                 and b3.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a3.nr_atendimento = b3.nr_atendimento
              
union

              select pck_flowsheet.get_formata_data(a4.dt_monitorizacao) ds_data,
                     b4.nr_atendimento,
                     to_char(a4.dt_monitorizacao, 'yyyy') ano
                from atendimento_monit_resp a4,
                     atendimento_paciente b4
               where a4.dt_monitorizacao between dt_inicial_p and dt_final_p
                 and b4.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a4.nr_atendimento = b4.nr_atendimento
                 and coalesce(a4.ie_situacao, 'A') = 'A'
              
union

              select pck_flowsheet.get_formata_data(a5.dt_liberacao) ds_data,
                     b5.nr_atendimento,
                     to_char(a5.dt_liberacao, 'yyyy') ano
                from atend_informacao_leito a5,
                     atendimento_paciente b5
               where a5.dt_liberacao between dt_inicial_p and dt_final_p
                 and b5.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a5.nr_atendimento = b5.nr_atendimento
                 and coalesce(a5.ie_situacao, 'A') = 'A'
              
union

              select pck_flowsheet.get_formata_data(a6.dt_registro) ds_data,
                     b6.nr_atendimento,
                     to_char(a6.dt_registro, 'yyyy') ano
                from atendimento_precaucao a6,
                     atendimento_paciente b6
               where a6.dt_registro between dt_inicial_p and dt_final_p
                 and b6.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a6.nr_atendimento = b6.nr_atendimento
                 and coalesce(a6.ie_situacao, 'A') = 'A'
              
union

              select pck_flowsheet.get_formata_data(a7.dt_liberacao) ds_data,
                     b7.nr_atendimento,
                     to_char(a7.dt_liberacao, 'yyyy') ano
                from paciente_rep_prescricao a7,
                     atendimento_paciente b7
               where a7.cd_pessoa_fisica = b7.cd_pessoa_fisica
                 and a7.dt_liberacao between dt_inicial_p and dt_final_p
                 and a7.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and coalesce(a7.ie_situacao, 'A') = 'A'
              
union

              select pck_flowsheet.get_formata_data(a8.dt_avaliacao) ds_data,
                     a8.nr_atendimento,
                     to_char(a8.dt_avaliacao, 'yyyy') ano
                from atend_aval_nut_enf a8,
                     tipo_aval_nut_enf b8,
                     atendimento_paciente c8
               where a8.nr_seq_tipo_aval = b8.nr_sequencia
                 and coalesce(a8.ie_situacao, 'A') = 'A'
                 and a8.nr_atendimento = c8.nr_atendimento
                 and c8.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and a8.dt_avaliacao between dt_inicial_p and dt_final_p
              
union

              select pck_flowsheet.get_formata_data(c.dt_atualizacao) ds_data,
                     e.nr_atendimento,
                     to_char(c.dt_atualizacao, 'yyyy') ano
                from pe_prescricao a,
                     pe_prescr_proc b,
                     pe_item_result_proc c,
                     cp_intervention d,
                     atendimento_paciente e
               where a.nr_atendimento = e.nr_atendimento
                 and b.nr_seq_prescr = a.nr_sequencia
                 and b.nr_seq_result = c.nr_seq_result
                 and c.nr_seq_proc = d.nr_seq_pe_procedimento
                 and d.ie_interv_sae_rel in (2, 3, 4, 5, 6, 7, 8)
                 and coalesce(a.ie_situacao, 'A') = 'A'
                 and coalesce(b.dt_suspensao::text, '') = ''
                 and e.cd_pessoa_fisica = cd_pessoa_fisica_p
                 and c.dt_atualizacao between dt_inicial_p and dt_final_p) alias28
      order by nr_atendimento, ano, ds_data;
    r2 c2%rowtype;

    c_cur_ferida CURSOR FOR
      SELECT lf.ds_localizacao,
             a1.ds_observacao,
             a1.dt_inicio_ferida,
             a1.nm_usuario
        from cur_ferida a1,
             localizacao_ferida lf
       where to_char(a1.dt_inicio_ferida, 'yyyy') = r2.ano
         and coalesce(a1.ie_situacao,'A') = 'A'
         and a1.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a1.dt_inicio_ferida) = r2.ds_data
         and lf.nr_sequencia = a1.nr_seq_localizacao
       order by a1.dt_inicio_ferida desc LIMIT 1;
    r_cur_ferida c_cur_ferida%rowtype;

    c_cur_curativo CURSOR FOR
      SELECT obter_valor_dominio_idioma(1097, a2.ie_borda, 8) ie_borda,
             obter_valor_dominio_idioma(1101, a2.ie_tipo_exsudato, 8) ie_tipo_exsudato,
             obter_valor_dominio_idioma(1095, a2.ie_tamanho, 8) ie_tamanho,
             a2.nr_horas_validade,
             a2.ds_observacao,
             a2.dt_curativo,
             a2.nm_usuario
        from cur_curativo a2
       where to_char(a2.dt_curativo, 'yyyy') = r2.ano
         and coalesce(a2.ie_situacao,'A') = 'A'
         and a2.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a2.dt_curativo) = r2.ds_data
       order by a2.dt_curativo desc LIMIT 1;
    r_cur_curativo c_cur_curativo%rowtype;

    c_pac_dispositivo1 CURSOR FOR
      SELECT a3.nr_seq_dispositivo,
             a3.nr_seq_topografia,
             c3.ds_dispositivo,
             d3.ds_topografia,
             a3.ds_observacao,
             a3.dt_instalacao,
             a3.nm_usuario
        from atend_pac_dispositivo a3,
             dispositivo  c3,
             topografia_dor d3
       where to_char(a3.dt_instalacao, 'yyyy') = r2.ano
         and c3.nr_sequencia = a3.nr_seq_dispositivo
         and d3.nr_sequencia = a3.nr_seq_topografia
         and a3.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a3.dt_instalacao) = r2.ds_data
       order by a3.dt_instalacao desc LIMIT 1;
    r_pac_dispositivo1 c_pac_dispositivo1%rowtype;

    c_monit_resp CURSOR FOR
      SELECT obter_valor_dominio_idioma(2816, a4.ie_canula_traqueo, 8) ie_canula_traqueo,
             a4.nr_protese,
             a4.qt_rima_labial,
             a4.ds_observacao,
             a4.dt_monitorizacao,
             a4.nm_usuario
        from atendimento_monit_resp a4
       where to_char(a4.dt_monitorizacao, 'yyyy') = r2.ano
         and coalesce(a4.ie_situacao,'A') = 'A'
         and a4.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a4.dt_monitorizacao) = r2.ds_data
       order by a4.dt_monitorizacao desc LIMIT 1;
    r_monit_resp c_monit_resp%rowtype;

    c_informacao_leito CURSOR FOR
      SELECT obter_valor_dominio_idioma(9270, a5.ie_bedposition, 8) ie_bedposition,
             obter_valor_dominio_idioma(9271, a5.ie_headrailsposition, 8) ie_headrailsposition,
             obter_valor_dominio_idioma(9282, a5.ie_hobalarminfo, 8) ie_hobalarminfo
        from atend_informacao_leito a5
       where to_char(a5.dt_liberacao, 'yyyy') = r2.ano
         and coalesce(a5.ie_situacao,'A') = 'A'
         and a5.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a5.dt_liberacao) = r2.ds_data
       order by a5.dt_liberacao desc LIMIT 1;
    r_informacao_leito c_informacao_leito%rowtype;

    c_atend_precaucao CURSOR FOR
      SELECT c6.ds_precaucao,
             substr(a6.ds_observacao, 1, 255) ds_observacao,
             a6.nm_usuario,
             a6.dt_registro
        from atendimento_precaucao a6,
             cih_precaucao c6
       where to_char(a6.dt_liberacao, 'yyyy') = r2.ano
         and coalesce(a6.ie_situacao,'A') = 'A'
         and a6.nr_atendimento = r2.nr_atendimento
         and pck_flowsheet.get_formata_data(a6.dt_registro) = r2.ds_data
         and c6.nr_sequencia = a6.nr_seq_precaucao
       order by a6.dt_liberacao desc LIMIT 1;
    r_atend_precaucao c_atend_precaucao%rowtype;

    c_paciente_rep_prescricao CURSOR FOR
      SELECT b7.ds_restricao,
             substr(a7.ds_observacao, 1, 255) ds_observacao,
             'Active' ie_situacao,
             c7.ds_nivel,
             a7.dt_liberacao,
             a7.nm_usuario
        from paciente_rep_prescricao a7,
             rep_restricao b7,
             nivel_seguranca_alerta c7,
             atendimento_paciente d7
       where to_char(a7.dt_liberacao, 'yyyy') = r2.ano
         and coalesce(a7.ie_situacao,'A') = 'A'
         and pck_flowsheet.get_formata_data(a7.dt_liberacao) = r2.ds_data
         and d7.nr_atendimento = r2.nr_atendimento
         and a7.cd_pessoa_fisica = d7.cd_pessoa_fisica
         and b7.nr_sequencia = a7.nr_seq_restricao
         and c7.nr_sequencia = a7.nr_seq_nivel_seg
       order by a7.dt_liberacao desc LIMIT 1;
    r_paciente_rep_prescricao c_paciente_rep_prescricao%rowtype;

    c_nutricao CURSOR FOR
      SELECT b8.ds_avaliacao
        from atend_aval_nut_enf a8,
             tipo_aval_nut_enf b8
       where a8.nr_seq_tipo_aval = b8.nr_sequencia
         and coalesce(a8.ie_situacao, 'A') = 'A'
         and pck_flowsheet.get_formata_data(a8.dt_avaliacao) = r2.ds_data
         and a8.nr_atendimento = r2.nr_atendimento
         and to_char(a8.dt_avaliacao, 'yyyy') = r2.ano
       order by a8.dt_avaliacao desc LIMIT 1;
    r_nutricao c_nutricao%rowtype;

    c_enferm CURSOR(ie_sae_rel_p cp_intervention.ie_interv_sae_rel%type) FOR
      SELECT e.ds_resultado,
             substr(b.ds_observacao, 1, 255) ds_observacao,
             c.dt_atualizacao,
             b.nm_usuario
        from pe_prescricao a,
             pe_prescr_proc b,
             pe_item_result_proc c,
             cp_intervention d,
             pe_item_resultado e
        where b.nr_seq_prescr = a.nr_sequencia
          and b.nr_seq_result = c.nr_seq_result
          and c.nr_seq_proc = d.nr_seq_pe_procedimento
          and d.ie_interv_sae_rel = ie_sae_rel_p
          and coalesce(a.ie_situacao, 'A') = 'A'
          and coalesce(b.dt_suspensao::text, '') = ''
          and a.nr_atendimento = r2.nr_atendimento
          and pck_flowsheet.get_formata_data(c.dt_atualizacao) = r2.ds_data
          and to_char(c.dt_atualizacao, 'yyyy') = r2.ano
          and e.nr_sequencia = c.nr_seq_result
        order by c.dt_atualizacao desc LIMIT 1;
    r_enferm_2 c_enferm%rowtype;
    r_enferm_3 c_enferm%rowtype;
    r_enferm_4 c_enferm%rowtype;
    r_enferm_5 c_enferm%rowtype;
    r_enferm_6 c_enferm%rowtype;
    r_enferm_7 c_enferm%rowtype;
    r_enferm_8 c_enferm%rowtype;

    c_sinal_vital CURSOR(nr_seq_w sinal_vital.nr_sequencia%type) FOR
      SELECT trim(both (CASE WHEN (qt_min_aviso IS NOT NULL AND qt_min_aviso::text <> '') THEN 'MIN: ' || qt_min_aviso ELSE null END) ||
                  (CASE WHEN (qt_max_aviso IS NOT NULL AND qt_max_aviso::text <> '') THEN ' MAX: ' || qt_max_aviso ELSE null END)) setting
        from sinal_vital
       where nr_sequencia = nr_seq_w
         and ((qt_min_aviso IS NOT NULL AND qt_min_aviso::text <> '') or (qt_max_aviso IS NOT NULL AND qt_max_aviso::text <> ''));
    r_sinal_1 c_sinal_vital%rowtype;
    r_sinal_2 c_sinal_vital%rowtype;
    r_sinal_3 c_sinal_vital%rowtype;
    r_sinal_6 c_sinal_vital%rowtype;
    r_sinal_9 c_sinal_vital%rowtype;
    r_sinal_16 c_sinal_vital%rowtype;
    r_sinal_17 c_sinal_vital%rowtype;
    r_sinal_18 c_sinal_vital%rowtype;

    w_val_flowsheet_w w_rel_val_flowsheet%rowtype;
    w_audit_flowsheet_w w_rel_audit_flowsheet%rowtype;

    pg_w bigint;
    cl_w bigint;
    nr_w atendimento_paciente.nr_atendimento%type;

  
BEGIN

    w_val_flowsheet_w.nr_relatorio := cd_relatorio_p;
    w_val_flowsheet_w.cd_pessoa_fisica := cd_pessoa_fisica_p;

    pg_w := null;
    cl_w := null;
    nr_w := null;

    w_audit_flowsheet_w.nr_ordem := 2;
    w_audit_flowsheet_w.nr_relatorio := cd_relatorio_p;
    w_audit_flowsheet_w.cd_pessoa_fisica := cd_pessoa_fisica_p;

    open c_sinal_vital(1);
      fetch c_sinal_vital into r_sinal_1;
    close c_sinal_vital;

    open c_sinal_vital(2);
      fetch c_sinal_vital into r_sinal_2;
    close c_sinal_vital;

    open c_sinal_vital(3);
      fetch c_sinal_vital into r_sinal_3;
    close c_sinal_vital;

    open c_sinal_vital(6);
      fetch c_sinal_vital into r_sinal_6;
    close c_sinal_vital;

    open c_sinal_vital(9);
      fetch c_sinal_vital into r_sinal_9;
    close c_sinal_vital;

    open c_sinal_vital(16);
      fetch c_sinal_vital into r_sinal_16;
    close c_sinal_vital;

    open c_sinal_vital(17);
      fetch c_sinal_vital into r_sinal_17;
    close c_sinal_vital;

    open c_sinal_vital(18);
      fetch c_sinal_vital into r_sinal_18;
    close c_sinal_vital;

    --Loop dos Hora
    open c2;
    loop
      fetch c2 into r2;
      EXIT WHEN NOT FOUND; /* apply on c2 */

        open c_cur_ferida;
          fetch c_cur_ferida into r_cur_ferida;
        close c_cur_ferida;

        open c_cur_curativo;
          fetch c_cur_curativo into r_cur_curativo;
        close c_cur_curativo;

        open c_pac_dispositivo1;
          fetch c_pac_dispositivo1 into r_pac_dispositivo1;
        close c_pac_dispositivo1;

        open c_monit_resp;
          fetch c_monit_resp into r_monit_resp;
        close c_monit_resp;

        open c_informacao_leito;
          fetch c_informacao_leito into r_informacao_leito;
        close c_informacao_leito;

        open c_atend_precaucao;
          fetch c_atend_precaucao into r_atend_precaucao;
        close c_atend_precaucao;

        open c_paciente_rep_prescricao;
          fetch c_paciente_rep_prescricao into r_paciente_rep_prescricao;
        close c_paciente_rep_prescricao;

        open c_nutricao;
          fetch c_nutricao into r_nutricao;
        close c_nutricao;

        open c_enferm(2);
          fetch c_enferm into r_enferm_2;
        close c_enferm;

        open c_enferm(3);
          fetch c_enferm into r_enferm_3;
        close c_enferm;

        open c_enferm(4);
          fetch c_enferm into r_enferm_4;
        close c_enferm;

        open c_enferm(5);
          fetch c_enferm into r_enferm_5;
        close c_enferm;

        open c_enferm(6);
          fetch c_enferm into r_enferm_6;
        close c_enferm;

        open c_enferm(7);
          fetch c_enferm into r_enferm_7;
        close c_enferm;

        open c_enferm(8);
          fetch c_enferm into r_enferm_8;
        close c_enferm;

        if coalesce(nr_w::text, '') = '' then
          nr_w := r2.nr_atendimento;
          pg_w := 1;
          cl_w := 1;
        else
          cl_w := cl_w + 1;
        end if;

        if nr_w <> r2.nr_atendimento then
          nr_w := r2.nr_atendimento;
          pg_w := pg_w + 1;
          cl_w := 1;
        end if;

        if cl_w = 5 then
          pg_w := pg_w + 1;
          cl_w := 1;
        end if;

        w_val_flowsheet_w.nr_atendimento := r2.nr_atendimento;
        w_val_flowsheet_w.ds_data_hora   := r2.ds_data;
        w_val_flowsheet_w.nr_pagina      := pg_w;
        w_val_flowsheet_w.ds_tipo_soma   := cl_w;

        w_audit_flowsheet_w.nr_atendimento := r2.nr_atendimento;

        -- Comments
        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_2.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_2.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Activity', r_enferm_2.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_3.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_3.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Hygiene/ADLs', r_enferm_3.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_monit_resp.dt_monitorizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_monit_resp.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Respiratory', r_monit_resp.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_4.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_4.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Treatments', r_enferm_4.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_5.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_5.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Incision/Woundcare', r_enferm_5.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_cur_ferida.dt_inicio_ferida, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_cur_ferida.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Incision/Woundcare', r_cur_ferida.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_cur_curativo.dt_curativo, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_cur_curativo.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Incision/Woundcare', r_cur_curativo.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_pac_dispositivo1.dt_instalacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_pac_dispositivo1.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Line Care', r_pac_dispositivo1.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_6.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_6.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Safety Assessment', r_enferm_6.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_7.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_7.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Precautions', r_enferm_7.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_enferm_8.dt_atualizacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_enferm_8.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Equipment', r_enferm_8.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_atend_precaucao.dt_registro, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_atend_precaucao.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Isolation Precautions', r_atend_precaucao.ds_observacao, w_audit_flowsheet_w);

        w_audit_flowsheet_w.dt_evento := to_char(r_paciente_rep_prescricao.dt_liberacao, 'MM/DD/YYYY HH24:MI:SS');
        w_audit_flowsheet_w.ds_autor  := r_paciente_rep_prescricao.nm_usuario;
        CALL pck_flowsheet.verify_and_insert_audit('Restraints', r_paciente_rep_prescricao.ds_observacao, w_audit_flowsheet_w);

        -- 1 - Nutrition
        w_val_flowsheet_w.nr_ordem       := 1;
        w_val_flowsheet_w.ds_valor       := r_nutricao.ds_avaliacao;--PEP>avaliacao nutricional de enfermagem
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 2 - Activity
        w_val_flowsheet_w.nr_ordem       := 2;
        w_val_flowsheet_w.ds_valor       := r_enferm_2.ds_resultado;--Prescricao de recomendacoes e intervencoes de enfermagem
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 3 - hygiene/ADLs
        w_val_flowsheet_w.nr_ordem       := 3;
        w_val_flowsheet_w.ds_valor       := r_enferm_3.ds_resultado;--Prescricao de recomendacoes e intervencoes de enfermagem
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 4 - Respiratory
        w_val_flowsheet_w.nr_ordem       := 4;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 5 - Airway Tipe
        w_val_flowsheet_w.nr_ordem       := 5;
        w_val_flowsheet_w.ds_valor       := r_monit_resp.ie_canula_traqueo;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 6 - Airway Size
        w_val_flowsheet_w.nr_ordem       := 6;
        w_val_flowsheet_w.ds_valor       := r_monit_resp.nr_protese;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 7 - Airway Position
        w_val_flowsheet_w.nr_ordem       := 7;
        w_val_flowsheet_w.ds_valor       := r_monit_resp.qt_rima_labial;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 8 - Treatments
        w_val_flowsheet_w.nr_ordem       := 8;
        w_val_flowsheet_w.ds_valor       := r_enferm_4.ds_resultado;--Prescricao de procedimentos
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 9 - Incision/Woundcare
        w_val_flowsheet_w.nr_ordem       := 9;
        w_val_flowsheet_w.ds_valor       := r_enferm_5.ds_resultado;--Prescricao de procedimentos / recomendacoes, intervencao de enfermagem
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 10 - Site assessment
        w_val_flowsheet_w.nr_ordem       := 10;
        w_val_flowsheet_w.ds_valor       := r_cur_ferida.ds_localizacao;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 11 - Margins
        w_val_flowsheet_w.nr_ordem       := 11;
        w_val_flowsheet_w.ds_valor       := r_cur_curativo.ie_borda;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 12 - Drainage
        w_val_flowsheet_w.nr_ordem       := 12;
        w_val_flowsheet_w.ds_valor       := r_cur_curativo.ie_tipo_exsudato;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 13 - dressing
        w_val_flowsheet_w.nr_ordem       := 13;
        w_val_flowsheet_w.ds_valor       := r_cur_curativo.ie_tamanho;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 14 - Care
        w_val_flowsheet_w.nr_ordem       := 14;
        w_val_flowsheet_w.ds_valor       := r_cur_curativo.nr_horas_validade;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 15 - Line Care
        w_val_flowsheet_w.nr_ordem       := 15;
        w_val_flowsheet_w.ds_valor       := r_pac_dispositivo1.ds_dispositivo;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 16 - Site assessment
        w_val_flowsheet_w.nr_ordem       := 16;
        w_val_flowsheet_w.ds_valor       := r_pac_dispositivo1.ds_topografia;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 17 - Care
        w_val_flowsheet_w.nr_ordem       := 17;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 18 - Drain/tube Care
        w_val_flowsheet_w.nr_ordem       := 18;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 19 - Site
        w_val_flowsheet_w.nr_ordem       := 19;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 20 - Assessment
        w_val_flowsheet_w.nr_ordem       := 20;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 21 - Drainage/residual
        w_val_flowsheet_w.nr_ordem       := 21;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 22 - Care
        w_val_flowsheet_w.nr_ordem       := 22;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 23 - Safety
        w_val_flowsheet_w.nr_ordem       := 23;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 24 - Assessment
        w_val_flowsheet_w.nr_ordem       := 24;
        w_val_flowsheet_w.ds_valor       := r_enferm_6.ds_resultado;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 25 - Bed Position
        w_val_flowsheet_w.nr_ordem       := 25;
        w_val_flowsheet_w.ds_valor       := r_informacao_leito.ie_bedposition;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 26 - Side Rails
        w_val_flowsheet_w.nr_ordem       := 26;
        w_val_flowsheet_w.ds_valor       := r_informacao_leito.ie_headrailsposition;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 27 - Safety Check
        w_val_flowsheet_w.nr_ordem       := 27;
        w_val_flowsheet_w.ds_valor       := r_informacao_leito.ie_hobalarminfo;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 28 - Precaution
        w_val_flowsheet_w.nr_ordem       := 28;
        w_val_flowsheet_w.ds_valor       := r_enferm_7.ds_resultado;--Cadastro - intervencoes de enfermagem e Prescricao de recomendacoes
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 29 - Alarms on
        w_val_flowsheet_w.nr_ordem       := 29;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 30 - Heart Rate
        w_val_flowsheet_w.nr_ordem       := 30;
        w_val_flowsheet_w.ds_valor       := r_sinal_9.setting;--SINAL_VITAL	NR_SEQUENCIA =9
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 31 - Systolic Blood Pressure
        w_val_flowsheet_w.nr_ordem       := 31;
        w_val_flowsheet_w.ds_valor       := r_sinal_1.setting;--SINAL_VITAL	NR_SEQUENCIA =1 E 2
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 32 - Diastolic Blood Pressure
        w_val_flowsheet_w.nr_ordem       := 32;
        w_val_flowsheet_w.ds_valor       := r_sinal_2.setting;--SINAL_VITAL	NR_SEQUENCIA =1 E 2
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 33 - SpO2
        w_val_flowsheet_w.nr_ordem       := 33;
        w_val_flowsheet_w.ds_valor       := r_sinal_6.setting;--SINAL_VITAL	NR_SEQUENCIA =6
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 34 - CVP (cmH2O)
        w_val_flowsheet_w.nr_ordem       := 34;
        w_val_flowsheet_w.ds_valor       := r_sinal_16.setting;--SINAL_VITAL	NR_SEQUENCIA = 16 e 17
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 35 - CVP (mmHg)
        w_val_flowsheet_w.nr_ordem       := 35;
        w_val_flowsheet_w.ds_valor       := r_sinal_17.setting;--SINAL_VITAL	NR_SEQUENCIA = 16 e 17
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 36 - ART
        w_val_flowsheet_w.nr_ordem       := 36;
        w_val_flowsheet_w.ds_valor       := r_sinal_18.setting;--SINAL_VITAL	NR_SEQUENCIA = 18
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 37 - Respiratory
        w_val_flowsheet_w.nr_ordem       := 37;
        w_val_flowsheet_w.ds_valor       := r_sinal_3.setting;--SINAL_VITAL	NR_SEQUENCIA = 3
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 38 - Isolation Precaution
        w_val_flowsheet_w.nr_ordem       := 38;
        w_val_flowsheet_w.ds_valor       := r_atend_precaucao.ds_precaucao;
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 39 - Equipment
        w_val_flowsheet_w.nr_ordem       := 39;
        w_val_flowsheet_w.ds_valor       := r_enferm_8.ds_resultado;--Cadastro - PEP>Feridas e curativos (se for apenas registro de ulcera por pressao) CPOE>Recomendacao (se for uma recomendacao para utilizar colchao de ar no paciente devido ulcera por pressao)
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 40 - Restraints
        w_val_flowsheet_w.nr_ordem       := 40;
        w_val_flowsheet_w.ds_valor       := r_paciente_rep_prescricao.ds_restricao;--PACIENTE_REP_PRESCRICAO	NR_SEQ_RESTRICAO
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 41 - Reason for restraint
        w_val_flowsheet_w.nr_ordem       := 41;
        w_val_flowsheet_w.ds_valor       := r_paciente_rep_prescricao.ds_observacao;--PACIENTE_REP_PRESCRICAO	DS_OBSERVACAO
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 42 - restraint Status
        w_val_flowsheet_w.nr_ordem       := 42;
        w_val_flowsheet_w.ds_valor       := r_paciente_rep_prescricao.ie_situacao;--PACIENTE_REP_PRESCRICAO	IE_SITUACAO
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 43 - restraint Type
        w_val_flowsheet_w.nr_ordem       := 43;
        w_val_flowsheet_w.ds_valor       := r_paciente_rep_prescricao.ds_nivel;--PACIENTE_REP_PRESCRICAO	NR_SEQ_NIVEL_SEG
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 44 - Restraint Education/Communications
        w_val_flowsheet_w.nr_ordem       := 44;
        w_val_flowsheet_w.ds_valor       := '';
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 45 - Alternative interventions
        w_val_flowsheet_w.nr_ordem       := 45;
        w_val_flowsheet_w.ds_valor       := '';--Alternative interventions
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 46 - Care
        w_val_flowsheet_w.nr_ordem       := 46;
        w_val_flowsheet_w.ds_valor       := '';--Care
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 47 - Restraint Discontinuation Criteria
        w_val_flowsheet_w.nr_ordem       := 47;
        w_val_flowsheet_w.ds_valor       := '';--Restraint Discontinuation Criteria
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        -- 48 - Patient Behavior
        w_val_flowsheet_w.nr_ordem       := 48;
        w_val_flowsheet_w.ds_valor       := '';--Patient Behavior
        CALL pck_flowsheet.insert_valor(w_val_flowsheet_p   => w_val_flowsheet_w);

        r_monit_resp := null;
        r_cur_ferida := null;
        r_cur_curativo := null;
        r_pac_dispositivo1 := null;
        r_informacao_leito := null;
        r_atend_precaucao := null;
        r_paciente_rep_prescricao := null;
        r_nutricao := null;
        r_enferm_2 := null;
        r_enferm_3 := null;
        r_enferm_4 := null;
        r_enferm_5 := null;
        r_enferm_6 := null;
        r_enferm_7 := null;
        r_enferm_8 := null;

        commit;

    end loop;
    close c2;

    commit;

  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pck_flowsheet.ger_dados_nursing_care (cd_relatorio_p bigint, ie_dados_p text, dt_inicial_p timestamp, dt_final_p timestamp, cd_pessoa_fisica_p bigint) FROM PUBLIC;
