-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_mens_itens_preco_pre_pck.obter_valor_proporcional ( dt_ref_mens_p timestamp, dt_inicio_cob_p timestamp, dt_fim_cob_p timestamp, vl_preco_p bigint) RETURNS bigint AS $body$
DECLARE

qt_dias_w		integer;
dt_ultimo_dia_mes_w	integer;
tx_proporcional_mens_w	double precision;
vl_preco_w		double precision;

BEGIN
qt_dias_w	:= obter_dias_entre_datas(dt_inicio_cob_p, dt_fim_cob_p) + 1;

if (pls_mensalidade_util_pck.get_ie_data_base_proporcional = 'T') then
	dt_ultimo_dia_mes_w	:= 30;
	
	if (dt_fim_cob_p = last_day(dt_fim_cob_p)) then
		dt_ultimo_dia_mes_w := to_char(last_day(dt_fim_cob_p),'dd');
	end if;
else
	dt_ultimo_dia_mes_w	:= to_char(last_day(dt_ref_mens_p),'dd');
end if;

tx_proporcional_mens_w		:= (qt_dias_w/(dt_ultimo_dia_mes_w)::numeric );
vl_preco_w			:= tx_proporcional_mens_w * vl_preco_p;

return	vl_preco_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_mens_itens_preco_pre_pck.obter_valor_proporcional ( dt_ref_mens_p timestamp, dt_inicio_cob_p timestamp, dt_fim_cob_p timestamp, vl_preco_p bigint) FROM PUBLIC;
