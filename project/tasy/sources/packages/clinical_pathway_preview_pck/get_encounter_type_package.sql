-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clinical_pathway_preview_pck.get_encounter_type (nr_seq_protocol_inc_p bigint, dt_estimated_p timestamp) RETURNS varchar AS $body$
DECLARE

        ie_type_encounter_w varchar(2) :=  NULL;

BEGIN

        SELECT
            MAX(A.ie_tipo_atendimento) ie_type_encounter_w
        INTO STRICT ie_type_encounter_w
        FROM atendimento_paciente A
        LEFT JOIN protocolo_int_paciente b ON
            A.cd_pessoa_fisica = b.cd_pessoa_fisica
        WHERE
            TRUNC(dt_estimated_p) BETWEEN TRUNC(A.dt_entrada) AND TRUNC(coalesce(A.dt_alta, clock_timestamp())) AND
            b.nr_sequencia = nr_seq_protocol_inc_p;

        if (ie_type_encounter_w IS NOT NULL AND ie_type_encounter_w::text <> '') then
         RETURN obter_valor_dominio(12, ie_type_encounter_w);
        end if;

        RETURN ie_type_encounter_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION clinical_pathway_preview_pck.get_encounter_type (nr_seq_protocol_inc_p bigint, dt_estimated_p timestamp) FROM PUBLIC;
