-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE cpoe_gerar_registro_json_pck.cpoe_gerar_registro_med_json ( nr_atendimento_p bigint, dt_referencia_p timestamp, nm_usuario_p text, nr_prescricao_p bigint default null) AS $body$
DECLARE


	current_setting('cpoe_gerar_registro_json_pck.ds_registro_w')::text					text;
	current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text					text;
	ds_node_horarios_w				text;
	current_setting('cpoe_gerar_registro_json_pck.ds_json_materiais_w')::text				text;
	current_setting('cpoe_gerar_registro_json_pck.ds_item_w')::varchar(1000)						varchar(1000);
	ds_dias_semana_w 				varchar(1000);
	ds_item_fun_w					varchar(1000);
	current_setting('cpoe_gerar_registro_json_pck.ds_orientacao_w')::prescr_solucao.ds_orientacao%type					varchar(255);
	ds_intervalo_w					varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.dt_horario_w')::prescr_mat_hor.dt_horario%type					varchar(20);
	current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20)				varchar(20);
	current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20)					varchar(20);
	dt_recusa_w		    			varchar(20);
	current_setting('cpoe_gerar_registro_json_pck.ds_hora_w')::varchar(255)						varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.nr_hora_w')::integer						bigint;
	current_setting('cpoe_gerar_registro_json_pck.count_cpoe_material_w')::integer 			bigint;
	current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer                   		double precision;
	current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255)					varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255)			varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)			varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp				timestamp;
	dt_inicio_medic_w				timestamp;
	ds_json_sol_ret_w				text;
	current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_w')::varchar(255)					varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.dt_prescrito_w')::varchar(255)					varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255)		varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255)		varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.ds_ciencia_detalhe_w')::varchar(255)			varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.dt_ciencia_detalhe_w')::varchar(255)			varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255)		varchar(255);

	current_setting('cpoe_gerar_registro_json_pck.nr_prescricao_w')::prescr_material.nr_prescricao%type					prescr_medica.nr_prescricao%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type 					prescr_medica.dt_liberacao%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type		prescr_medica.dt_liberacao%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type			prescr_medica.dt_liberacao_farmacia%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_momento_lote_w')::regra_disp_lote_farm.ie_momento_lote%type				regra_disp_lote_farm.ie_momento_lote%type;
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255)		varchar(255);
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255)		varchar(255);

	current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type					prescr_material.cd_material%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_material_w')::prescr_material.nr_sequencia%type   			prescr_material.NR_SEQUENCIA%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type				prescr_material.nr_seq_mat_cpoe%type;
	ie_agrupador_w					prescr_material.ie_agrupador%type;
	cd_mat_diluicao_w				prescr_material.cd_material%type;
	qt_dose_mat_dil_w				prescr_material.qt_dose%type;
	ds_dose_diferenciada_mat_dil_w	cpoe_material.ds_dose_diferenciada_dil%type;
	cd_unid_med_dose_mat_dil_w		prescr_material.cd_unidade_medida_dose%type;
	qt_solucao_mat_dil_w			prescr_material.qt_solucao%type;	

	current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type					prescr_mat_hor.dt_horario%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type				prescr_mat_hor.dt_horario%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type					cpoe_material.cd_intervalo%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type					cpoe_material.ds_horarios%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_acm_w')::varchar(1)						cpoe_material.ie_acm%type;
	current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5)				cpoe_material.hr_prim_horario%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_urgencia_w')::varchar(1)					cpoe_material.ie_urgencia%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_se_necessario_w')::varchar(1)				cpoe_material.ie_se_necessario%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_w')::cpoe_material.qt_dose%type						cpoe_material.qt_dose%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_w')::cpoe_material.ds_dose_diferenciada%type			cpoe_material.ds_dose_diferenciada%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unidade_medida_w')::cpoe_material.cd_unidade_medida%type				cpoe_material.cd_unidade_medida%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_objetivo_w')::cpoe_material.ie_objetivo%type					cpoe_material.ie_objetivo%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_indicacao_w')::cpoe_material.ie_indicacao%type					cpoe_material.ie_indicacao%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_dia_util_w')::cpoe_material.nr_dia_util%type					cpoe_material.nr_dia_util%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dias_solicitado_w')::cpoe_material.qt_dias_liberado%type			cpoe_material.qt_dias_solicitado%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dias_liberado_w')::cpoe_material.qt_dias_liberado%type				cpoe_material.qt_dias_liberado%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_inicio_cih_w')::timestamp					timestamp;
	current_setting('cpoe_gerar_registro_json_pck.dt_fim_cih_w')::cpoe_material.dt_fim_cih%type					cpoe_material.dt_fim_cih%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_antibiotico_w')::cpoe_material.ie_antibiotico%type				cpoe_material.ie_antibiotico%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_origem_infeccao_w')::cpoe_material.ie_origem_infeccao%type			cpoe_material.ie_origem_infeccao%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_amostra_cih_w')::cpoe_material.cd_amostra_cih%type				cpoe_material.cd_amostra_cih%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_topografia_cih_w')::cpoe_material.cd_topografia_cih%type 			cpoe_material.CD_TOPOGRAFIA_CIH%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_microorganismo_cih_w')::cpoe_material.cd_microorganismo_cih%type			cpoe_material.cd_microorganismo_cih%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type					cpoe_material.ds_observacao%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_medicacao_paciente_w')::cpoe_material.ie_medicacao_paciente%type			cpoe_material.ie_medicacao_paciente%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type				cpoe_material.ds_justificativa%type;
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type					cpoe_material.nm_usuario%type;
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type				cpoe_material.nm_usuario_nrec%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type				cpoe_material.dt_atualizacao%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type 			cpoe_material.dt_atualizacao%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type				cpoe_material.dt_suspensao%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type	 			cpoe_material.ie_via_aplicacao%type;
	ds_via_aplicacao_w				cpoe_material.ie_via_aplicacao%type;
	ie_lado_w						cpoe_material.ie_lado%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_bomba_infusao_w')::cpoe_material.ie_bomba_infusao%type				cpoe_material.ie_bomba_infusao%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_volume_w')::cpoe_material.qt_volume%type						cpoe_material.qt_volume%type;
	qt_dose_correcao_w      		cpoe_material.qt_dose_correcao1%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type						cpoe_material.dt_fim%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type						cpoe_material.dt_inicio%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_duracao_w')::cpoe_dieta.ie_duracao%type					cpoe_material.ie_duracao%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_ocorrencia_w')::cpoe_gasoterapia.nr_ocorrencia%type         		cpoe_material.nr_ocorrencia%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_administracao_w')::cpoe_dieta.ie_administracao%type				cpoe_material.ie_administracao%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_evento_unico_w')::cpoe_dieta.ie_evento_unico%type				cpoe_material.ie_evento_unico%type;

	cd_mat_comp_w           		cpoe_material.cd_mat_comp1%type;
	qt_dose_comp_w          		cpoe_material.qt_dose_comp1%type;
	ds_dose_diferenciada_comp_w		cpoe_material.ds_dose_diferenciada_comp1%type;
	cd_unid_med_dose_comp_w 		cpoe_material.cd_unid_med_dose_comp1%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_dil_w')::prescr_material.cd_material%type					cpoe_material.cd_mat_dil%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_dil_w')::prescr_material.qt_dose%type 					cpoe_material.qt_dose_dil%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_dil_w')::cpoe_material.ds_dose_diferenciada_dil%type		cpoe_material.ds_dose_diferenciada_dil%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_dil_w')::cpoe_material.cd_unid_med_dose_dil%type 			cpoe_material.cd_unid_med_dose_dil%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_red_w')::cpoe_material.cd_mat_red%type					cpoe_material.cd_mat_red%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_red_w')::cpoe_material.qt_dose_red%type					cpoe_material.qt_dose_red%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_red_w')::cpoe_material.ds_dose_diferenciada_red%type		cpoe_material.ds_dose_diferenciada_red%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_red_w')::cpoe_material.cd_unid_med_dose_red%type			cpoe_material.cd_unid_med_dose_red%type;
	qt_solucao_red_w				cpoe_material.qt_solucao_red%type;

	cd_mat_recons_w					cpoe_material.cd_mat_recons%type;
	qt_dose_recons_w				cpoe_material.qt_dose_recons%type;
	ds_dose_diferenciada_rec_w		cpoe_material.ds_dose_diferenciada_rec%type;
	cd_unid_med_dose_recons_w		cpoe_material.cd_unid_med_dose_recons%type;

	qt_dia_util_alb_w				cpoe_material.qt_dia_util_alb%type;
	qt_concentracao_alb_w			cpoe_material.qt_concentracao_alb%type;
	ie_base_dose_albumina_w			cpoe_material.ie_base_dose_albumina%type;
	nr_seq_grupo_indic_alb1_w		cpoe_material.nr_seq_grupo_indic_alb1%type;
	nr_seq_indicacao_alb1_w			cpoe_material.nr_seq_indicacao_alb1%type;
	ds_observacao_alb1_w			cpoe_material.ds_observacao_alb1%type;
	nr_seq_grupo_indic_alb2_w		cpoe_material.nr_seq_grupo_indic_alb2%type;
	nr_seq_indicacao_alb2_w			cpoe_material.nr_seq_indicacao_alb2%type;
	ds_observacao_alb2_w			cpoe_material.ds_observacao_alb2%type;
	nr_seq_grupo_indic_alb3_w		cpoe_material.nr_seq_grupo_indic_alb3%type;
	nr_seq_indicacao_alb3_w			cpoe_material.nr_seq_indicacao_alb3%type;
	ds_observacao_alb3_w			cpoe_material.ds_observacao_alb3%type;
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type				cpoe_material.nm_usuario_susp%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_w')::cpoe_dieta.dt_lib_suspensao%type				cpoe_material.dt_lib_suspensao%type;
	nr_seq_receita_amb_w			cpoe_material.nr_seq_receita_amb%type;

	qt_solucao_w					cpoe_material.qt_solucao%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dosagem_w')::cpoe_material.qt_dosagem%type					cpoe_material.qt_dosagem%type;
	ie_aplic_lenta_w				cpoe_material.ie_aplic_lenta%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_tipo_dosagem_w')::cpoe_material.ie_tipo_dosagem%type				cpoe_material.ie_tipo_dosagem%type;
	hr_min_aplicacao_w				cpoe_material.hr_min_aplicacao%type;
	ie_aplic_bolus_w				cpoe_material.ie_aplic_bolus%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_tipo_solucao_w')::cpoe_material.ie_tipo_solucao%type				cpoe_material.ie_tipo_solucao%type;
	ie_material_w					cpoe_material.ie_material%type;

	current_setting('cpoe_gerar_registro_json_pck.ie_motivo_prescricao_w')::cpoe_gasoterapia.ie_motivo_prescricao%type			cpoe_material.ie_motivo_prescricao%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_setor_atendimento_w')::cpoe_gasoterapia.cd_setor_atendimento%type			cpoe_material.cd_setor_atendimento%type;
	current_setting('cpoe_gerar_registro_json_pck.ie_oncologia_w')::cpoe_material.ie_oncologia%type					cpoe_material.ie_oncologia%type;
	dt_inicio_receita_w				timestamp;
	dt_fim_receita_w				timestamp;
	current_setting('cpoe_gerar_registro_json_pck.ds_principio_ativo_w')::varchar(255)			varchar(255);
	dt_prescricao_w					cpoe_material.dt_inicio%type;
	ds_prim_dshorario_w				varchar(10);
	ds_lista_seq_cpoe_w				varchar(2000);
	count_reg_duplicado_w			smallint;
	current_setting('cpoe_gerar_registro_json_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type			estabelecimento.cd_estabelecimento%type;
	nr_agrupamento_w       		 	integer;
	ie_dias_util_medic_w			material.ie_dias_util_medic%type;
	qt_dia_util_w					smallint;
	ds_horarios_rep_w				prescr_material.ds_horarios_medico%type;

	ie_segunda_w					cpoe_material.ie_segunda%type;
	ie_terca_w						cpoe_material.ie_terca%type;
	ie_quarta_w						cpoe_material.ie_quarta%type;
	ie_quinta_w						cpoe_material.ie_quinta%type;
	ie_sexta_w						cpoe_material.ie_sexta%type;
	ie_sabado_w						cpoe_material.ie_sabado%type;
	ie_domingo_w					cpoe_material.ie_domingo%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type				cpoe_material.cd_mat_recons1%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons1_w')::cpoe_material.qt_dose_recons1%type				cpoe_material.qt_dose_recons1%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons1_w')::cpoe_material.cd_unid_med_dose_recons1%type		cpoe_material.cd_unid_med_dose_recons1%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec1_w')::cpoe_material.ds_dose_diferenciada_rec1%type		cpoe_material.ds_dose_diferenciada_rec1%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type				cpoe_material.cd_mat_recons2%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons2_w')::cpoe_material.qt_dose_recons2%type				cpoe_material.qt_dose_recons2%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons2_w')::cpoe_material.cd_unid_med_dose_recons2%type		cpoe_material.cd_unid_med_dose_recons2%type;

	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec2_w')::cpoe_material.ds_dose_diferenciada_rec2%type		cpoe_material.ds_dose_diferenciada_rec2%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type				cpoe_material.cd_mat_recons3%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons3_w')::cpoe_material.qt_dose_recons3%type				cpoe_material.qt_dose_recons3%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons3_w')::cpoe_material.cd_unid_med_dose_recons3%type		cpoe_material.cd_unid_med_dose_recons3%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec3_w')::cpoe_material.ds_dose_diferenciada_rec3%type		cpoe_material.ds_dose_diferenciada_rec3%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type				cpoe_material.cd_mat_recons4%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons4_w')::cpoe_material.qt_dose_recons4%type				cpoe_material.qt_dose_recons4%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons4_w')::cpoe_material.cd_unid_med_dose_recons4%type		cpoe_material.cd_unid_med_dose_recons4%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec4_w')::cpoe_material.ds_dose_diferenciada_rec4%type		cpoe_material.ds_dose_diferenciada_rec4%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type				cpoe_material.cd_mat_recons5%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons5_w')::cpoe_material.qt_dose_recons5%type				cpoe_material.qt_dose_recons5%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons5_w')::cpoe_material.cd_unid_med_dose_recons5%type		cpoe_material.cd_unid_med_dose_recons5%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec5_w')::cpoe_material.ds_dose_diferenciada_rec5%type		cpoe_material.ds_dose_diferenciada_rec5%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons6_w')::cpoe_material.cd_mat_recons6%type				cpoe_material.cd_mat_recons6%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons6_w')::cpoe_material.qt_dose_recons6%type				cpoe_material.qt_dose_recons6%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons6_w')::cpoe_material.cd_unid_med_dose_recons6%type		cpoe_material.cd_unid_med_dose_recons6%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec6_w')::cpoe_material.ds_dose_diferenciada_rec6%type		cpoe_material.ds_dose_diferenciada_rec6%type;

	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons7_w')::cpoe_material.cd_mat_recons7%type				cpoe_material.cd_mat_recons7%type;
	current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons7_w')::cpoe_material.qt_dose_recons7%type				cpoe_material.qt_dose_recons7%type;
	current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons7_w')::cpoe_material.cd_unid_med_dose_recons7%type		cpoe_material.cd_unid_med_dose_recons7%type;
	current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec7_w')::cpoe_material.ds_dose_diferenciada_rec7%type		cpoe_material.ds_dose_diferenciada_rec7%type;

	current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type				cpoe_material.nr_seq_assinatura%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_susp_w')::cpoe_material.nr_seq_assinatura_susp%type		cpoe_material.nr_seq_assinatura_susp%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type			tasy_assinatura_digital.dt_assinatura%type;
	current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_dig_susp_w')::tasy_assinatura_digital.dt_assinatura%type		tasy_assinatura_digital.dt_assinatura%type;
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type        cpoe_order_unit.nr_sequencia%type;
    nr_seq_cpoe_rp_w                cpoe_rp.nr_sequencia%type;

	current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR CURSOR FOR  --Medicamentos
		SELECT	distinct a.cd_material,
			a.cd_intervalo,
			a.nr_sequencia,
			a.ds_horarios,
			a.ie_acm,
			a.ie_urgencia,
			a.ie_se_necessario,
			a.hr_prim_horario,
			a.dt_inicio,
			a.qt_dose,
			a.ds_dose_diferenciada,
			a.cd_unidade_medida,
			a.ie_objetivo,
			a.ie_indicacao,
			a.nr_dia_util,
			a.qt_dias_solicitado,
			a.qt_dias_liberado,
			a.dt_fim_cih,
			a.ie_antibiotico,
			a.ie_origem_infeccao,
			a.cd_amostra_cih,
			a.cd_topografia_cih,
			a.cd_microorganismo_cih,
			a.ds_observacao,
			a.ie_medicacao_paciente,
			a.ds_justificativa,
			substr(a.ds_orientacao_preparo,1,255),
			a.dt_liberacao,
			a.ie_motivo_prescricao,
			a.cd_setor_atendimento, 
			a.ie_oncologia,
			a.dt_suspensao, 
			a.nm_usuario,
			a.nm_usuario_nrec,
			a.dt_atualizacao,
			a.dt_atualizacao_nrec,
			a.nr_ocorrencia,
			a.ie_via_aplicacao,
			a.ie_via_aplicacao ds_via_aplicacao,					
			a.ie_lado,
			a.ie_bomba_infusao,
			a.qt_volume,
			qt_dia_util_alb,
			qt_concentracao_alb,
			ie_base_dose_albumina,
			nr_seq_grupo_indic_alb1,
			nr_seq_indicacao_alb1,
			ds_observacao_alb1,
			nr_seq_grupo_indic_alb2,
			nr_seq_indicacao_alb2,
			ds_observacao_alb2,
			nr_seq_grupo_indic_alb3,
			nr_seq_indicacao_alb3,
			ds_observacao_alb3,
			null nr_seq_receita_amb,
			a.qt_solucao,
			a.qt_dosagem,
			a.ie_aplic_lenta,
			a.ie_tipo_dosagem,
			a.hr_min_aplicacao,
			a.ie_aplic_bolus,
			a.ie_tipo_solucao,
			a.cd_mat_dil,
			a.qt_dose_dil,
			a.ds_dose_diferenciada_dil,
			a.cd_unid_med_dose_dil,
			a.cd_mat_red,
			a.qt_dose_red,
			a.cd_unid_med_dose_red,
			a.ds_dose_diferenciada_red,
			a.qt_solucao_red,
			a.cd_mat_recons,
			a.qt_dose_recons,
			a.ds_dose_diferenciada_rec,
			a.cd_unid_med_dose_recons,
			coalesce(a.ie_material,'N'),
			a.ie_segunda,
			a.ie_terca,
			a.ie_quarta,
			a.ie_quinta,
			a.ie_sexta,
			a.ie_sabado,
			a.ie_domingo,
			a.cd_mat_recons1,
			a.qt_dose_recons1,
			a.cd_unid_med_dose_recons1,
			a.ds_dose_diferenciada_rec1,
			a.cd_mat_recons2,
			a.qt_dose_recons2,
			a.cd_unid_med_dose_recons2,
			a.ds_dose_diferenciada_rec2,
			a.cd_mat_recons3,
			a.qt_dose_recons3,
			a.cd_unid_med_dose_recons3,
			a.ds_dose_diferenciada_rec3,
			a.cd_mat_recons4,
			a.qt_dose_recons4,
			a.cd_unid_med_dose_recons4,
			a.ds_dose_diferenciada_rec4,
			a.cd_mat_recons5,
			a.qt_dose_recons5,
			a.cd_unid_med_dose_recons5,
			a.ds_dose_diferenciada_rec5,
			a.cd_mat_recons6,
			a.qt_dose_recons6,
			a.cd_unid_med_dose_recons6,
			a.ds_dose_diferenciada_rec6,
			a.cd_mat_recons7,
			a.qt_dose_recons7,
			a.cd_unid_med_dose_recons7,
			a.ds_dose_diferenciada_rec7,
			a.nr_seq_assinatura,
			a.nr_seq_assinatura_susp,
			a.nr_seq_cpoe_order_unit,
            a.nr_seq_cpoe_rp
		from	cpoe_material a,
			prescr_material b,
			prescr_mat_hor c,
			prescr_medica d
		where	a.nr_atendimento = nr_atendimento_p
		and	a.dt_prox_geracao > current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp - 1
		and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
		and	a.nr_sequencia = b.nr_seq_mat_cpoe
		and	b.nr_prescricao = c.nr_prescricao
		and	b.nr_sequencia = c.nr_seq_material
		and	b.nr_prescricao = d.nr_prescricao
		and ((coalesce(nr_prescricao_p,0) = 0)  or (b.nr_prescricao = nr_prescricao_p))
		and coalesce(a.nr_seq_receita_amb::text, '') = ''
		and	b.ie_agrupador = 1
		and	coalesce(c.ie_situacao, 'A') = 'A'
		and upper(b.ie_origem_inf) <> 'K' --KIT
		and	coalesce(b.nr_seq_kit::text, '') = ''
		and	(((cpoe_reg_valido_ativacao(CASE WHEN coalesce(a.dt_lib_suspensao::text, '') = '' THEN  coalesce(a.dt_fim_cih, a.dt_fim)  ELSE coalesce(a.dt_suspensao, a.dt_fim) END , coalesce(cpoe_obter_data_hora_form(a.dt_inicio,a.hr_prim_horario), a.dt_inicio), current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp,NULL, a.cd_perfil_ativo, a.ie_retrogrado, a.dt_liberacao, 'N', a.ie_futuro, a.dt_liberacao_fut) = 'S') and (current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp > a.dt_inicio)) or 
			((((Obter_se_acm_sn_agora_especial(b.ie_acm, b.ie_se_necessario, 'N', 'N') = 'N') and (c.dt_horario between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp or b.nr_prescricao = nr_prescricao_p)) or
			((Obter_se_acm_sn_agora_especial(b.ie_acm, b.ie_se_necessario, 'N', 'N') = 'S') and (obter_se_prescr_vig_adep(d.dt_prescricao, d.dt_validade_prescr, current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp, current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp) = 'S')))))
		
union all

		SELECT 	distinct a.cd_material,
			a.cd_intervalo,
			a.nr_sequencia,
			a.ds_horarios,
			a.ie_acm,
			a.ie_urgencia,
			a.ie_se_necessario,
			a.hr_prim_horario,
			a.dt_inicio,
			a.qt_dose,
			a.ds_dose_diferenciada,
			a.cd_unidade_medida,
			a.ie_objetivo,
			a.ie_indicacao,
			a.nr_dia_util,
			a.qt_dias_solicitado,
			a.qt_dias_liberado,
			a.dt_fim_cih,
			a.ie_antibiotico,
			a.ie_origem_infeccao,
			a.cd_amostra_cih,
			a.cd_topografia_cih,
			a.cd_microorganismo_cih,
			a.ds_observacao,
			a.ie_medicacao_paciente,
			a.ds_justificativa,
			substr(a.ds_orientacao_preparo,1,255),
			a.dt_liberacao,
			a.ie_motivo_prescricao, 
			a.cd_setor_atendimento, 
			a.ie_oncologia,			
			a.dt_suspensao, 
			a.nm_usuario,
			a.nm_usuario_nrec,
			a.dt_atualizacao,
			a.dt_atualizacao_nrec,
			a.nr_ocorrencia,
			a.ie_via_aplicacao,
			a.ie_via_aplicacao ds_via_aplicacao,     
			a.ie_lado,
			a.ie_bomba_infusao,
			a.qt_volume,
			a.qt_dia_util_alb,
			a.qt_concentracao_alb,
			a.ie_base_dose_albumina,
			a.nr_seq_grupo_indic_alb1,
			a.nr_seq_indicacao_alb1,
			a.ds_observacao_alb1,
			a.nr_seq_grupo_indic_alb2,
			a.nr_seq_indicacao_alb2,
			a.ds_observacao_alb2,
			a.nr_seq_grupo_indic_alb3,
			a.nr_seq_indicacao_alb3,
			a.ds_observacao_alb3,
			a.nr_seq_receita_amb,
			a.qt_solucao,
			a.qt_dosagem,
			a.ie_aplic_lenta,
			a.ie_tipo_dosagem,
			a.hr_min_aplicacao,
			a.ie_aplic_bolus,
			a.ie_tipo_solucao,
			a.cd_mat_dil,
			a.qt_dose_dil,
			a.ds_dose_diferenciada_dil,
			a.cd_unid_med_dose_dil,
			a.cd_mat_red,
			a.qt_dose_red,
			a.cd_unid_med_dose_red,
			a.ds_dose_diferenciada_red,
			a.qt_solucao_red,
			a.cd_mat_recons,
			a.qt_dose_recons,
			a.ds_dose_diferenciada_rec,
			a.cd_unid_med_dose_recons,
			coalesce(a.ie_material,'N'),
			a.ie_segunda,
			a.ie_terca,
			a.ie_quarta,
			a.ie_quinta,
			a.ie_sexta,
			a.ie_sabado,
			a.ie_domingo,
			a.cd_mat_recons1,
			a.qt_dose_recons1,
			a.cd_unid_med_dose_recons1,
			a.ds_dose_diferenciada_rec1,
			a.cd_mat_recons2,
			a.qt_dose_recons2,
			a.cd_unid_med_dose_recons2,
			a.ds_dose_diferenciada_rec2,
			a.cd_mat_recons3,
			a.qt_dose_recons3,
			a.cd_unid_med_dose_recons3,
			a.ds_dose_diferenciada_rec3,
			a.cd_mat_recons4,
			a.qt_dose_recons4,
			a.cd_unid_med_dose_recons4,
			a.ds_dose_diferenciada_rec4,
			a.cd_mat_recons5,
			a.qt_dose_recons5,
			a.cd_unid_med_dose_recons5,
			a.ds_dose_diferenciada_rec5,
			a.cd_mat_recons6,
			a.qt_dose_recons6,
			a.cd_unid_med_dose_recons6,
			a.ds_dose_diferenciada_rec6,
			a.cd_mat_recons7,
			a.qt_dose_recons7,
			a.cd_unid_med_dose_recons7,
			a.ds_dose_diferenciada_rec7,
			a.nr_seq_assinatura,
			a.nr_seq_assinatura_susp,
			 a.nr_seq_cpoe_order_unit,
            a.nr_seq_cpoe_rp
		from 	cpoe_material a
		where	a.nr_atendimento = nr_atendimento_p
		and	a.dt_prox_geracao > current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp - 1
		and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
		and	(a.nr_seq_receita_amb IS NOT NULL AND a.nr_seq_receita_amb::text <> '')
		and	(((cpoe_reg_valido_ativacao(CASE WHEN coalesce(a.dt_lib_suspensao::text, '') = '' THEN  coalesce(a.dt_fim_cih, a.dt_fim)  ELSE coalesce(a.dt_suspensao, a.dt_fim) END , coalesce(cpoe_obter_data_hora_form(a.dt_inicio, a.hr_prim_horario), a.dt_inicio), current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp,NULL, a.cd_perfil_ativo, a.ie_retrogrado, a.dt_liberacao, 'N', a.ie_futuro, a.dt_liberacao_fut) = 'S') and (current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp > a.dt_inicio)) or 
			((((Obter_se_acm_sn_agora_especial(a.ie_acm, a.ie_se_necessario, 'N', 'N') = 'N') and (dt_referencia_p between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp and current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp)) or
			((Obter_se_acm_sn_agora_especial(a.ie_acm, a.ie_se_necessario, 'N', 'N') = 'S') and (obter_se_prescr_vig_adep(a.dt_inicio, a.dt_fim, current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp, current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp) = 'S')))))
		order by	nr_sequencia;

	current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR CURSOR FOR  --Buscar horarios dos medicamentos
		SELECT /*+ index (c PREMAHO_I9) */			to_char(c.dt_horario,'dd/mm/yyyy hh24:mi'),
			coalesce(to_char(c.dt_fim_horario,'dd/mm/yyyy hh24:mi'),'null'),
			coalesce(to_char(c.dt_suspensao,'dd/mm/yyyy hh24:mi'),'null'),
			coalesce(to_char(c.dt_recusa,'dd/mm/yyyy hh24:mi'),'null'),
			c.dt_horario,
			c.nr_prescricao,
			c.nr_seq_material
		from	cpoe_material a,
			prescr_material b,
			prescr_mat_hor c
		where	a.nr_sequencia = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
		and	a.nr_sequencia = b.nr_seq_mat_cpoe
		and	a.cd_material = b.cd_material
		and	b.nr_prescricao = c.nr_prescricao
		and	b.nr_sequencia = c.nr_seq_material
		and	b.cd_material = c.cd_material
		and 	coalesce(c.ie_horario_especial,'N') = 'N'
		and	coalesce(c.ie_situacao, 'A') = 'A'
		and	c.dt_horario between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp and current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp
		order by c.dt_horario;

	current_setting('cpoe_gerar_registro_json_pck.c03')::CURSOR CURSOR FOR
	SELECT cd_material, qt_dose, cd_unidade_medida, qt_dose_correcao, ds_dose_diferenciada, row_number() OVER () AS rownum
	from (	SELECT cd_material,
				qt_dose, 
				cd_unidade_medida, 
				qt_dose qt_dose_correcao, 
				ds_dose_diferenciada,
				ie_tipo_item
			from  cpoe_material_v
			where nr_sequencia = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
			and ie_tipo_item('MCOMP1', 'MCOMP2', 'MCOMP3', 'MCOMP4', 'MCOMP5', 'MCOMP6', 'MCOMP7')
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO1' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO2' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO3' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO4' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO5' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO6' ie_tipo_item 
			
union all
 select null cd_material, null qt_dose, null cd_unidade_medida, null qt_dose_correcao, null ds_dose_diferenciada,'XPTO17' ie_tipo_item ) alias3 ORDER by ie_tipo_item LIMIT 7;


	
BEGIN
	  ds_lista_seq_cpoe_w := ' ';
	open current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR;
	loop
	fetch current_setting('cpoe_gerar_registro_json_pck.c01')::into CURSOR
		current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_acm_w')::varchar(1),
		current_setting('cpoe_gerar_registro_json_pck.ie_urgencia_w')::varchar(1),
		current_setting('cpoe_gerar_registro_json_pck.ie_se_necessario_w')::varchar(1),
		current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5),
		current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_w')::cpoe_material.qt_dose%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_w')::cpoe_material.ds_dose_diferenciada%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unidade_medida_w')::cpoe_material.cd_unidade_medida%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_objetivo_w')::cpoe_material.ie_objetivo%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_indicacao_w')::cpoe_material.ie_indicacao%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_dia_util_w')::cpoe_material.nr_dia_util%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dias_solicitado_w')::cpoe_material.qt_dias_liberado%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dias_liberado_w')::cpoe_material.qt_dias_liberado%type,
		current_setting('cpoe_gerar_registro_json_pck.dt_fim_cih_w')::cpoe_material.dt_fim_cih%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_antibiotico_w')::cpoe_material.ie_antibiotico%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_origem_infeccao_w')::cpoe_material.ie_origem_infeccao%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_amostra_cih_w')::cpoe_material.cd_amostra_cih%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_topografia_cih_w')::cpoe_material.cd_topografia_cih%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_microorganismo_cih_w')::cpoe_material.cd_microorganismo_cih%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_medicacao_paciente_w')::cpoe_material.ie_medicacao_paciente%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_orientacao_w')::prescr_solucao.ds_orientacao%type,
		current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_motivo_prescricao_w')::cpoe_gasoterapia.ie_motivo_prescricao%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_setor_atendimento_w')::cpoe_gasoterapia.cd_setor_atendimento%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_oncologia_w')::cpoe_material.ie_oncologia%type,
		current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type,
		current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type,
		current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type,
		current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type,
		current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_ocorrencia_w')::cpoe_gasoterapia.nr_ocorrencia%type,
		current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type,
		ds_via_aplicacao_w,
		ie_lado_w,
		current_setting('cpoe_gerar_registro_json_pck.ie_bomba_infusao_w')::cpoe_material.ie_bomba_infusao%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_volume_w')::cpoe_material.qt_volume%type,
		qt_dia_util_alb_w,
		qt_concentracao_alb_w,
		ie_base_dose_albumina_w,
		nr_seq_grupo_indic_alb1_w,
		nr_seq_indicacao_alb1_w,
		ds_observacao_alb1_w,
		nr_seq_grupo_indic_alb2_w,
		nr_seq_indicacao_alb2_w,
		ds_observacao_alb2_w,
		nr_seq_grupo_indic_alb3_w,
		nr_seq_indicacao_alb3_w,
		ds_observacao_alb3_w,
		nr_seq_receita_amb_w,
		qt_solucao_w,
		current_setting('cpoe_gerar_registro_json_pck.qt_dosagem_w')::cpoe_material.qt_dosagem%type,
		ie_aplic_lenta_w,
		current_setting('cpoe_gerar_registro_json_pck.ie_tipo_dosagem_w')::cpoe_material.ie_tipo_dosagem%type,
		hr_min_aplicacao_w,
		ie_aplic_bolus_w,
		current_setting('cpoe_gerar_registro_json_pck.ie_tipo_solucao_w')::cpoe_material.ie_tipo_solucao%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_dil_w')::prescr_material.cd_material%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_dil_w')::prescr_material.qt_dose%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_dil_w')::cpoe_material.ds_dose_diferenciada_dil%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_dil_w')::cpoe_material.cd_unid_med_dose_dil%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_red_w')::cpoe_material.cd_mat_red%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_red_w')::cpoe_material.qt_dose_red%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_red_w')::cpoe_material.cd_unid_med_dose_red%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_red_w')::cpoe_material.ds_dose_diferenciada_red%type,
		qt_solucao_red_w,
		cd_mat_recons_w,
		qt_dose_recons_w,
		ds_dose_diferenciada_rec_w,
		cd_unid_med_dose_recons_w,
		ie_material_w,
		ie_segunda_w,
		ie_terca_w,
		ie_quarta_w,	
		ie_quinta_w,	
		ie_sexta_w,	
		ie_sabado_w,	
		ie_domingo_w,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons1_w')::cpoe_material.qt_dose_recons1%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons1_w')::cpoe_material.cd_unid_med_dose_recons1%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec1_w')::cpoe_material.ds_dose_diferenciada_rec1%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons2_w')::cpoe_material.qt_dose_recons2%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons2_w')::cpoe_material.cd_unid_med_dose_recons2%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec2_w')::cpoe_material.ds_dose_diferenciada_rec2%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons3_w')::cpoe_material.qt_dose_recons3%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons3_w')::cpoe_material.cd_unid_med_dose_recons3%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec3_w')::cpoe_material.ds_dose_diferenciada_rec3%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons4_w')::cpoe_material.qt_dose_recons4%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons4_w')::cpoe_material.cd_unid_med_dose_recons4%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec4_w')::cpoe_material.ds_dose_diferenciada_rec4%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons5_w')::cpoe_material.qt_dose_recons5%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons5_w')::cpoe_material.cd_unid_med_dose_recons5%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec5_w')::cpoe_material.ds_dose_diferenciada_rec5%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons6_w')::cpoe_material.cd_mat_recons6%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons6_w')::cpoe_material.qt_dose_recons6%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons6_w')::cpoe_material.cd_unid_med_dose_recons6%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec6_w')::cpoe_material.ds_dose_diferenciada_rec6%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons7_w')::cpoe_material.cd_mat_recons7%type,
		current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons7_w')::cpoe_material.qt_dose_recons7%type,
		current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons7_w')::cpoe_material.cd_unid_med_dose_recons7%type,
		current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec7_w')::cpoe_material.ds_dose_diferenciada_rec7%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_susp_w')::cpoe_material.nr_seq_assinatura_susp%type,
		current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type,
        nr_seq_cpoe_rp_w;
	EXIT WHEN NOT FOUND; /* apply on current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR */
		select 	count(*)
		into STRICT	count_reg_duplicado_w
		from 	table(lista_pck.obter_lista(ds_lista_seq_cpoe_w)) a
		where 	a.nr_registro = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type;

		PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_grid_w', cpoe_obter_data_hora_form(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp, current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5)), false);
		PERFORM set_config('cpoe_gerar_registro_json_pck.dt_suspensao_item_w', cpoe_gerar_registro_json_pck.regra_data_susp(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type), false);
		PERFORM set_config('cpoe_gerar_registro_json_pck.cd_estabelecimento_w', obter_estabelecimento_setor(current_setting('cpoe_gerar_registro_json_pck.cd_setor_atendimento_w')::cpoe_gasoterapia.cd_setor_atendimento%type), false);
		PERFORM set_config('cpoe_gerar_registro_json_pck.ie_momento_lote_w', cpoe_obter_momento_lote(current_setting('cpoe_gerar_registro_json_pck.ie_motivo_prescricao_w')::cpoe_gasoterapia.ie_motivo_prescricao%type, current_setting('cpoe_gerar_registro_json_pck.cd_setor_atendimento_w')::cpoe_gasoterapia.cd_setor_atendimento%type, current_setting('cpoe_gerar_registro_json_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('cpoe_gerar_registro_json_pck.ie_oncologia_w')::cpoe_material.ie_oncologia%type, 'CPOE_MATERIAL', current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type, null, 'N', 'N'), false);
		PERFORM set_config('cpoe_gerar_registro_json_pck.ds_principio_ativo_w', substr(obter_princ_ativo_matmed(current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type),1,100), false);

		if (current_setting('cpoe_gerar_registro_json_pck.ie_antibiotico_w')::cpoe_material.ie_antibiotico%type = 'S') then
			PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_cih_w', cpoe_obter_inicio_cih_detail(current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type, current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp), false);

			select	coalesce(max(ie_dias_util_medic),'N')
			into STRICT	ie_dias_util_medic_w
			from	material
			where	cd_material	= current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type;

			if (ie_dias_util_medic_w = 'S') then
				qt_dia_util_w := 1;
			elsif (ie_dias_util_medic_w = 'O') then
				qt_dia_util_w := 0;
			end if;

			PERFORM set_config('cpoe_gerar_registro_json_pck.nr_dia_util_w', (trunc(current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp) - trunc(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_cih_w')::timestamp)) + qt_dia_util_w, false);
		end if;

		if (nr_seq_receita_amb_w IS NOT NULL AND nr_seq_receita_amb_w::text <> '') then
			dt_inicio_receita_w := cpoe_obter_data_receita_amb(nr_seq_receita_amb_w, 'I');
			dt_fim_receita_w := cpoe_obter_data_receita_amb(nr_seq_receita_amb_w, 'F');
		end if;	

		if (count_reg_duplicado_w = 0) then
			ds_lista_seq_cpoe_w := ds_lista_seq_cpoe_w || ',';

			if ((coalesce(current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5), 'XPTO') <> 'XPTO') and (current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5) = '  :  ')) then
				PERFORM set_config('cpoe_gerar_registro_json_pck.hr_prim_horario_w', '', false);
			end if;

			ds_item_fun_w := current_setting('cpoe_gerar_registro_json_pck.ds_item_w')::varchar(1000);

			CALL cpoe_gerar_registro_json_pck.cpoe_limpar_valores_horas();

			select count(*)
			into STRICT   current_setting('cpoe_gerar_registro_json_pck.count_cpoe_material_w')::integer
			from   cpoe_material
			where  nr_sequencia = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type;

			PERFORM set_config('cpoe_gerar_registro_json_pck.dt_fim_w', '', false);
			PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_w', current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp, false);
			PERFORM set_config('cpoe_gerar_registro_json_pck.ie_duracao_w', '', false);
			PERFORM set_config('cpoe_gerar_registro_json_pck.ie_administracao_w', 'P', false);
			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_materiais_w', '', false);


			if (current_setting('cpoe_gerar_registro_json_pck.ie_se_necessario_w')::varchar(1) = 'S') then
				PERFORM set_config('cpoe_gerar_registro_json_pck.ie_administracao_w', 'N', false);
			elsif (current_setting('cpoe_gerar_registro_json_pck.ie_acm_w')::varchar(1) = 'S') then
				PERFORM set_config('cpoe_gerar_registro_json_pck.ie_administracao_w', 'C', false);
			end if;

			if (current_setting('cpoe_gerar_registro_json_pck.count_cpoe_material_w')::integer > 0) then
				begin
					select	dt_fim,
						dt_inicio,
						ie_duracao,
						ie_administracao,
						ie_evento_unico,
						dt_liberacao,
						cpoe_gerar_registro_json_pck.remove_aspas(CPOE_obter_desc_info_material(cd_material,cd_mat_comp1,qt_dose_comp1,cd_unid_med_dose_comp1,cd_mat_comp2,qt_dose_comp2,cd_unid_med_dose_comp2,cd_mat_comp3,qt_dose_comp3,cd_unid_med_dose_comp3,
						cd_mat_dil,qt_dose_dil,cd_unid_med_dose_dil,cd_mat_red,qt_dose_red,cd_unid_med_dose_red,dt_liberacao,qt_dose,cd_unidade_medida,ie_via_aplicacao,cd_intervalo,cpoe_gerar_registro_json_pck.regra_data_susp(dt_lib_suspensao),
						cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao),ie_administracao,nr_seq_ataque,nr_seq_procedimento,nr_seq_adicional,nr_seq_hemoterapia,ds_dose_diferenciada,ds_dose_diferenciada_dil,ds_dose_diferenciada_red,
						ds_dose_diferenciada_comp1,ds_dose_diferenciada_comp2,ds_dose_diferenciada_comp3,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,
						null,null,ie_oncologia,cd_mat_recons,qt_dose_recons,cd_unid_med_dose_recons,ds_dose_diferenciada_rec,ds_solucao,ie_duracao,ie_ref_calculo,nr_etapas,ie_controle_tempo,qt_dias_solicitado,qt_dias_liberado,nr_atendimento,ie_baixado_por_alta,dt_alta_medico,
						substr(cpoe_if_item_allowed(wheb_usuario_pck.get_cd_perfil,'DR'),1,80),'N',null,obter_horarios_regra(ds_horarios))),
						cpoe_gerar_registro_json_pck.regra_data_susp(dt_lib_suspensao),
						dt_liberacao_enf dt_liberacao_enfermagem,
						dt_liberacao_farm dt_liberacao_farmacia,
						nm_usuario_lib_enf nm_usuario_lib_enfermagem,
						nm_usuario_lib_farm nm_usuario_lib_farmacia,
						substr(obter_initcap(obter_nome_medico(obter_pf_usuario(nm_usuario_nrec,'C'),'PMS')),1,255),
						cpoe_obter_tempo_prescrito(coalesce(dt_atualizacao_nrec, dt_inicio)),
						cpoe_get_prior_prescriber(nr_seq_cpoe_anterior, 'CPOE_MATERIAL', 'N'),
						cpoe_get_prior_prescriber(nr_seq_cpoe_anterior, 'CPOE_MATERIAL', 'D'),
						obter_nome_medico(obter_pf_usuario(nm_usuario_ciencia,'C'),'PMS'),
						cpoe_get_approval_time(dt_ciencia_medico),
						substr(obter_dados_pf(obter_pf_usuario(nm_usuario_nrec,'C'),'COPR'),1,255) ds_conselho,
						substr(obter_nome_pf(obter_pf_usuario(nm_usuario_nrec,'C')),1,255) ds_prescritor_grid,
						CASE WHEN coalesce(cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao)::text, '') = '' THEN  null  ELSE nm_usuario_susp END ,
						CASE WHEN coalesce(cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao)::text, '') = '' THEN  null  ELSE cpoe_obter_info_suspensao(nr_sequencia,'M','N') END  nm_usuario_descontinuacao,
						nr_agrupamento,
						cpoe_gerar_registro_json_pck.remove_aspas(cpoe_obter_dias_semana(nr_sequencia, 'M')),
						obter_data_assinatura_digital(nr_seq_assinatura),
						obter_data_assinatura_digital(nr_seq_assinatura_susp),
						obter_pf_usuario(coalesce(nm_usuario, nm_usuario_nrec),'N') ds_prescritor_reval
				into STRICT	current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type,
						current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type,
						current_setting('cpoe_gerar_registro_json_pck.ie_duracao_w')::cpoe_dieta.ie_duracao%type,
						current_setting('cpoe_gerar_registro_json_pck.ie_administracao_w')::cpoe_dieta.ie_administracao%type,
						current_setting('cpoe_gerar_registro_json_pck.ie_evento_unico_w')::cpoe_dieta.ie_evento_unico%type,
						current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type,
						current_setting('cpoe_gerar_registro_json_pck.ds_item_w')::varchar(1000),
						current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_w')::cpoe_dieta.dt_lib_suspensao%type,
						current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type,
						current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type,
						current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.dt_prescrito_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.ds_ciencia_detalhe_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.dt_ciencia_detalhe_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255),
						current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type,
						current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255),
						nr_agrupamento_w,
						ds_dias_semana_w,
						current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type,
						current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_dig_susp_w')::tasy_assinatura_digital.dt_assinatura%type,
						current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)
				from	cpoe_material
				where	nr_sequencia = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type;

				select	max(dt_fim_horario)
				into STRICT	current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type
				from (SELECT	max(dt_horario) dt_fim_horario
						from	prescr_medica a,
								prescr_mat_hor b,
								prescr_material c,
								cpoe_material d
						where	a.nr_atendimento	= nr_atendimento_p
						and		a.nr_prescricao		= b.nr_prescricao
						and		b.nr_prescricao 	= c.nr_prescricao
						and		b.nr_seq_material	= c.nr_sequencia
						and		b.dt_horario between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp
						and 	c.nr_seq_mat_cpoe 	= d.nr_sequencia
						and		d.dt_fim			< b.dt_horario
						and		(d.dt_fim IS NOT NULL AND d.dt_fim::text <> '')
						and     (coalesce(a.dt_liberacao_medico, a.dt_liberacao) IS NOT NULL AND (coalesce(a.dt_liberacao_medico, a.dt_liberacao))::text <> '')
						and     c.ie_agrupador 		= 1
						and		d.nr_sequencia 		= current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
						
union	all

						PERFORM	max(dt_fim) dt_fim_horario
						from	cpoe_material
						where	nr_atendimento	= nr_atendimento_p
						and		nr_sequencia	= current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
						and		(dt_fim IS NOT NULL AND dt_fim::text <> '')) alias14;
				end;
			end if;

			select 	max(nr_prescricao)
			into STRICT	current_setting('cpoe_gerar_registro_json_pck.nr_prescricao_w')::prescr_material.nr_prescricao%type
			from	prescr_material
			where	nr_seq_mat_cpoe = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type;

			open current_setting('cpoe_gerar_registro_json_pck.c03')::CURSOR;
				loop
				fetch current_setting('cpoe_gerar_registro_json_pck.c03')::into CURSOR
					cd_mat_comp_w,
					qt_dose_comp_w,
					cd_unid_med_dose_comp_w,
					qt_dose_correcao_w,
					ds_dose_diferenciada_comp_w,
					current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer;
				EXIT WHEN NOT FOUND; /* apply on current_setting('cpoe_gerar_registro_json_pck.c03')::CURSOR */					
					PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_materiais_w', current_setting('cpoe_gerar_registro_json_pck.ds_json_materiais_w')::text || '{' ||  	format_array_json('CD_MAT_COMP'||current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer, cd_mat_comp_w,1)  ||
																			format_array_json('QT_DOSE_COMP'||current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer, qt_dose_comp_w,1) ||
																			format_array_json('DS_DOSE_DIFERENCIADA_COMP'||current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer, ds_dose_diferenciada_comp_w,1) ||
																			format_array_json('CD_UNID_MED_DOSE_COMP'||current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer, cd_unid_med_dose_comp_w,1) ||
																			format_array_json('QT_DOSE_CORRECAO'||current_setting('cpoe_gerar_registro_json_pck.seq_w')::integer, qt_dose_correcao_w,1), false);

					PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_materiais_w', substr(current_setting('cpoe_gerar_registro_json_pck.ds_json_materiais_w')::text,1,length(current_setting('cpoe_gerar_registro_json_pck.ds_json_materiais_w')::text)-2) || '},', false);
				end loop;
			close current_setting('cpoe_gerar_registro_json_pck.c03')::CURSOR;

			open current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR;
			loop
			fetch current_setting('cpoe_gerar_registro_json_pck.c02')::into CURSOR
				current_setting('cpoe_gerar_registro_json_pck.dt_horario_w')::prescr_mat_hor.dt_horario%type,
				current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20),
				current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20),
				dt_recusa_w,
				current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type,
				current_setting('cpoe_gerar_registro_json_pck.nr_prescricao_w')::prescr_material.nr_prescricao%type,
				current_setting('cpoe_gerar_registro_json_pck.nr_seq_material_w')::prescr_material.nr_sequencia%type;
			EXIT WHEN NOT FOUND; /* apply on current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR */
				PERFORM set_config('cpoe_gerar_registro_json_pck.nr_hora_w', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type,'hh24'), false);
				PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'P', false);

				if (current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20) <> 'null') then
					PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'S', false);
				end if;	

				if	((current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20)	<> 'null')
					or (dt_recusa_w <> 'null')) then
					PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'N', false);
				end if;
				CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_horario(current_setting('cpoe_gerar_registro_json_pck.nr_hora_w')::integer, current_setting('cpoe_gerar_registro_json_pck.ds_hora_w')::varchar(255));

				if (current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%(type IS NOT NULL AND type::text <> '') and (current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp)) then
					begin
					CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_fim_validade(current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type);
					end;
				end if;

			end loop;
			close current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR;

			select 	max(a.dt_prescricao),
					max(b.dt_inicio_medic),
					max(ds_horarios)
			into STRICT	dt_prescricao_w,
					dt_inicio_medic_w,
					ds_horarios_rep_w
			from	prescr_medica a,
					prescr_material b
			where	a.nr_prescricao = b.nr_prescricao
			and b.nr_seq_mat_cpoe = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
			and	b.cd_material = current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type
			and	a.nr_prescricao = (	SELECT min(x.nr_prescricao)
									from prescr_material x 
									where x.nr_seq_mat_cpoe = current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type
									and	x.cd_material = current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type);

			ds_prim_dshorario_w := coalesce(Obter_prim_DsHorarios(ds_horarios_rep_w), '00:00');			

			if ((dt_prescricao_w IS NOT NULL AND dt_prescricao_w::text <> '') or (dt_inicio_medic_w IS NOT NULL AND dt_inicio_medic_w::text <> '')) then
				PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_w', to_date(to_char(coalesce(dt_inicio_medic_w, dt_prescricao_w), 'dd/mm/yyyy') || ' ' || ds_prim_dshorario_w, 'dd/mm/yyyy hh24:mi:ss'), false);
				PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_grid_w', current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type, false);
			end if;					

			if (current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%(type IS NOT NULL AND type::text <> '') and (current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp)) then
				begin
				CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_ini_validade(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type);
				end;
			end if;

			if (current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_w')::cpoe_dieta.dt_lib_suspensao%coalesce(type::text, '') = '')  then
				PERFORM set_config('cpoe_gerar_registro_json_pck.dt_suspensao_item_w', null, false);
			end if;

			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_mat_w', current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text || '{' ||
							format_array_json('CD_MATERIAL',current_setting('cpoe_gerar_registro_json_pck.cd_material_w')::cpoe_material.cd_material%type,1)  ||
							format_array_json('DS_MATERIAL',current_setting('cpoe_gerar_registro_json_pck.ds_item_w')::varchar(1000),1)  ||
							format_array_json('DS_ITEM',ds_item_fun_w,1)  ||
							format_array_json('CD_MAT_DIL',current_setting('cpoe_gerar_registro_json_pck.cd_mat_dil_w')::prescr_material.cd_material%type,1)  ||
							format_array_json('QT_DOSE_DIL', current_setting('cpoe_gerar_registro_json_pck.qt_dose_dil_w')::prescr_material.qt_dose%type,1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_DIL', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_dil_w')::cpoe_material.ds_dose_diferenciada_dil%type,1) ||
							format_array_json('CD_UNID_MED_DOSE_DIL', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_dil_w')::cpoe_material.cd_unid_med_dose_dil%type,1) ||								
							format_array_json('CD_MAT_RED',current_setting('cpoe_gerar_registro_json_pck.cd_mat_red_w')::cpoe_material.cd_mat_red%type,1)  ||
							format_array_json('QT_DOSE_RED', current_setting('cpoe_gerar_registro_json_pck.qt_dose_red_w')::cpoe_material.qt_dose_red%type,1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_RED', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_red_w')::cpoe_material.ds_dose_diferenciada_red%type,1) ||
							format_array_json('CD_UNID_MED_DOSE_RED', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_red_w')::cpoe_material.cd_unid_med_dose_red%type,1) ||
							format_array_json('QT_SOLUCAO_RED', qt_solucao_red_w,1) ||								
							format_array_json('CD_MAT_RECONS',cd_mat_recons_w,1)  ||
							format_array_json('QT_DOSE_RECONS', qt_dose_recons_w,1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC', ds_dose_diferenciada_rec_w, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS', cd_unid_med_dose_recons_w,1) ||
							format_array_json('CD_INTERVALO',current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type,1)  ||
							format_array_json('IE_CONTROLE_TEMPO', 'N',1) ||
							format_array_json('NR_ATENDIMENTO', nr_atendimento_p,1) ||
							format_array_json('NR_SEQUENCIA', current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type,1) ||
							format_array_json('NR_SEQ_MAT_MED', current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type,1) ||
							format_array_json('NR_SEQ_MAT_CPOE', current_setting('cpoe_gerar_registro_json_pck.nr_seq_mat_cpoe_w')::cpoe_material.nr_sequencia%type,1) ||
							format_array_json('DS_HORARIOS', current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type,1) ||
							format_array_json('IE_ACM', current_setting('cpoe_gerar_registro_json_pck.ie_acm_w')::varchar(1),1) ||
							format_array_json('IE_URGENCIA', current_setting('cpoe_gerar_registro_json_pck.ie_urgencia_w')::varchar(1),1) ||
							format_array_json('IE_SE_NECESSARIO', current_setting('cpoe_gerar_registro_json_pck.ie_se_necessario_w')::varchar(1),1) ||
							format_array_json('IE_ADMINISTRACAO', current_setting('cpoe_gerar_registro_json_pck.ie_administracao_w')::cpoe_dieta.ie_administracao%type,1)		||
							format_array_json('IE_EVENTO_UNICO', current_setting('cpoe_gerar_registro_json_pck.ie_evento_unico_w')::cpoe_dieta.ie_evento_unico%type,1) 		||
							format_array_json('HR_PRIM_HORARIO', current_setting('cpoe_gerar_registro_json_pck.hr_prim_horario_w')::varchar(5),1) ||
							format_array_json('QT_DOSE', current_setting('cpoe_gerar_registro_json_pck.qt_dose_w')::cpoe_material.qt_dose%type,1) ||
							format_array_json('DS_DOSE_DIFERENCIADA', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_w')::cpoe_material.ds_dose_diferenciada%type,1) ||
							format_array_json('CD_UNIDADE_MEDIDA', current_setting('cpoe_gerar_registro_json_pck.cd_unidade_medida_w')::cpoe_material.cd_unidade_medida%type,1) ||
							format_array_json('DS_OBSERVACAO', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type),1) ||
							format_array_json('DS_JUSTIFICATIVA', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type),1) ||
							format_array_json('DS_ORIENTACAO_PREPARO',cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_orientacao_w')::prescr_solucao.ds_orientacao%type),1)  ||
							format_array_json('NM_USUARIO', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type,1) ||
							format_array_json('NM_USUARIO_NREC', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type,1) ||
							format_array_json('DT_ATUALIZACAO', current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type,1) ||
							format_array_json('DT_ATUALIZACAO_NREC', current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type,1) ||
							format_array_json('NR_OCORRENCIA', current_setting('cpoe_gerar_registro_json_pck.nr_ocorrencia_w')::cpoe_gasoterapia.nr_ocorrencia%type,1) ||
							format_array_json('IE_VIA_APLICACAO',current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type,1) ||
							format_array_json('DT_LIBERACAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_LIBERACAO_ENFERMAGEM', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_LIBERACAO_FARMACIA', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('NM_USUARIO_LIB_ENFERMAGEM', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255),1) ||
							format_array_json('NM_USUARIO_LIB_FARMACIA', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255),1) ||
							format_array_json('IE_MOMENTO_LOTE', current_setting('cpoe_gerar_registro_json_pck.ie_momento_lote_w')::regra_disp_lote_farm.ie_momento_lote%type,1) ||
							format_array_json('QT_DOSE_ATAQUE', current_setting('cpoe_gerar_registro_json_pck.qt_dose_w')::cpoe_material.qt_dose%type,1) ||
							format_array_json('DS_PRESCRITOR_DETALHE', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_w')::varchar(255)),1) ||
							format_array_json('DT_PRESCRITA_DETALHE', current_setting('cpoe_gerar_registro_json_pck.dt_prescrito_w')::varchar(255),1) ||
							format_array_json('DS_PREVIOUS_PRESCRIBER', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255)),1) ||
							format_array_json('DT_PREVIOUS_PRESCRIBER', current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255),1) ||
							format_array_json('DS_CIENCIA_DETALHE', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_ciencia_detalhe_w')::varchar(255)),1) ||
							format_array_json('DT_CIENCIA_DETALHE', current_setting('cpoe_gerar_registro_json_pck.dt_ciencia_detalhe_w')::varchar(255),1) ||
							format_array_json('DS_CONSELHO', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255)),1) ||	
							format_array_json('DS_PRESCRITOR', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255)),1) ||
							format_array_json('DS_PRESCRITOR_REVAL', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)),1) ||
							format_array_json('DS_VIA_APLICACAO', cpoe_gerar_registro_json_pck.remove_aspas(ds_via_aplicacao_w),1) ||
							format_array_json('IE_LADO', ie_lado_w,1) ||
							format_array_json('IE_BOMBA_INFUSAO', current_setting('cpoe_gerar_registro_json_pck.ie_bomba_infusao_w')::cpoe_material.ie_bomba_infusao%type,1) ||
							format_array_json('QT_VOLUME', current_setting('cpoe_gerar_registro_json_pck.qt_volume_w')::cpoe_material.qt_volume%type,1) ||								
							format_array_json('DS_MATERIAIS',obter_array_json('DS_MATERIAIS', current_setting('cpoe_gerar_registro_json_pck.ds_json_materiais_w')::text),2) ||
							format_array_json('DT_FIM', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_INICIO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_INICIO_GRID', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_SUSPENSAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_DESCONTINUACAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_LIB_SUSPENSAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_w')::cpoe_dieta.dt_lib_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('NM_USUARIO_SUSP', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type,1) ||
							format_array_json('NM_USUARIO_DESCONTINUACAO',current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255) ,1) ||
							format_array_json('DS_PRINCIPIO_ATIVO', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_principio_ativo_w')::varchar(255)), 1) ||
							format_array_json('IE_DURACAO', current_setting('cpoe_gerar_registro_json_pck.ie_duracao_w')::cpoe_dieta.ie_duracao%type,1) ||
							format_array_json('IE_OBJETIVO', current_setting('cpoe_gerar_registro_json_pck.ie_objetivo_w')::cpoe_material.ie_objetivo%type,1) ||
							format_array_json('IE_INDICACAO', current_setting('cpoe_gerar_registro_json_pck.ie_indicacao_w')::cpoe_material.ie_indicacao%type,1) ||
							format_array_json('NR_DIA_UTIL', current_setting('cpoe_gerar_registro_json_pck.nr_dia_util_w')::cpoe_material.nr_dia_util%type,1) ||
							format_array_json('QT_DIAS_SOLICITADO', current_setting('cpoe_gerar_registro_json_pck.qt_dias_solicitado_w')::cpoe_material.qt_dias_liberado%type,1) ||
							format_array_json('QT_DIAS_LIBERADO', current_setting('cpoe_gerar_registro_json_pck.qt_dias_liberado_w')::cpoe_material.qt_dias_liberado%type,1) ||
							format_array_json('DT_INICIO_CIH', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_cih_w')::timestamp, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_FIM_CIH', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_fim_cih_w')::cpoe_material.dt_fim_cih%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('IE_ANTIBIOTICO', current_setting('cpoe_gerar_registro_json_pck.ie_antibiotico_w')::cpoe_material.ie_antibiotico%type,1) ||
							format_array_json('IE_ORIGEM_INFECCAO', current_setting('cpoe_gerar_registro_json_pck.ie_origem_infeccao_w')::cpoe_material.ie_origem_infeccao%type,1) ||
							format_array_json('CD_AMOSTRA_CIH', current_setting('cpoe_gerar_registro_json_pck.cd_amostra_cih_w')::cpoe_material.cd_amostra_cih%type,1) ||
							format_array_json('CD_TOPOGRAFIA_CIH', current_setting('cpoe_gerar_registro_json_pck.cd_topografia_cih_w')::cpoe_material.cd_topografia_cih%type,1) ||
							format_array_json('CD_MICROORGANISMO_CIH', current_setting('cpoe_gerar_registro_json_pck.cd_microorganismo_cih_w')::cpoe_material.cd_microorganismo_cih%type,1) ||
							format_array_json('IE_MEDICACAO_PACIENTE', current_setting('cpoe_gerar_registro_json_pck.ie_medicacao_paciente_w')::cpoe_material.ie_medicacao_paciente%type,1) ||
							format_array_json('NR_SEQ_VISAO', 21655,1) ||
							format_array_json('DS_HORA_00',current_setting('cpoe_gerar_registro_json_pck.ds_hora_00_w')::varchar(50),1)	||
							format_array_json('DS_HORA_01',current_setting('cpoe_gerar_registro_json_pck.ds_hora_01_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_02',current_setting('cpoe_gerar_registro_json_pck.ds_hora_02_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_03',current_setting('cpoe_gerar_registro_json_pck.ds_hora_03_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_04',current_setting('cpoe_gerar_registro_json_pck.ds_hora_04_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_05',current_setting('cpoe_gerar_registro_json_pck.ds_hora_05_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_06',current_setting('cpoe_gerar_registro_json_pck.ds_hora_06_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_07',current_setting('cpoe_gerar_registro_json_pck.ds_hora_07_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_08',current_setting('cpoe_gerar_registro_json_pck.ds_hora_08_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_09',current_setting('cpoe_gerar_registro_json_pck.ds_hora_09_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_10',current_setting('cpoe_gerar_registro_json_pck.ds_hora_10_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_11',current_setting('cpoe_gerar_registro_json_pck.ds_hora_11_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_12',current_setting('cpoe_gerar_registro_json_pck.ds_hora_12_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_13',current_setting('cpoe_gerar_registro_json_pck.ds_hora_13_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_14',current_setting('cpoe_gerar_registro_json_pck.ds_hora_14_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_15',current_setting('cpoe_gerar_registro_json_pck.ds_hora_15_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_16',current_setting('cpoe_gerar_registro_json_pck.ds_hora_16_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_17',current_setting('cpoe_gerar_registro_json_pck.ds_hora_17_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_18',current_setting('cpoe_gerar_registro_json_pck.ds_hora_18_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_19',current_setting('cpoe_gerar_registro_json_pck.ds_hora_19_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_20',current_setting('cpoe_gerar_registro_json_pck.ds_hora_20_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_21',current_setting('cpoe_gerar_registro_json_pck.ds_hora_21_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_22',current_setting('cpoe_gerar_registro_json_pck.ds_hora_22_w')::varchar(50),1)  ||
							format_array_json('DS_HORA_23',current_setting('cpoe_gerar_registro_json_pck.ds_hora_23_w')::varchar(50),1)  ||
							format_array_json('QT_DIA_UTIL_ALB',qt_dia_util_alb_w,1)  ||
							format_array_json('QT_CONCENTRACAO_ALB',qt_concentracao_alb_w,1)  ||
							format_array_json('IE_BASE_DOSE_ALBUMINA',ie_base_dose_albumina_w,1)  ||
							format_array_json('NR_SEQ_GRUPO_INDIC_ALB1',nr_seq_grupo_indic_alb1_w,1)  ||
							format_array_json('NR_SEQ_INDICACAO_ALB1',nr_seq_indicacao_alb1_w,1)  ||
							format_array_json('DS_OBSERVACAO_ALB1',ds_observacao_alb1_w,1)  ||
							format_array_json('NR_SEQ_GRUPO_INDIC_ALB2',nr_seq_grupo_indic_alb2_w,1)  ||
							format_array_json('NR_SEQ_INDICACAO_ALB2',nr_seq_indicacao_alb2_w,1)  ||
							format_array_json('DS_OBSERVACAO_ALB2',ds_observacao_alb2_w,1)  ||
							format_array_json('NR_SEQ_GRUPO_INDIC_ALB3',nr_seq_grupo_indic_alb3_w,1)  ||
							format_array_json('NR_SEQ_INDICACAO_ALB3',nr_seq_indicacao_alb3_w,1)  ||
							format_array_json('DS_OBSERVACAO_ALB3',ds_observacao_alb3_w,1)  ||
							format_array_json('NR_SEQ_RECEITA_AMB',nr_seq_receita_amb_w,1)  ||
							format_array_json('DT_INICIO_RECEITA', to_char(dt_inicio_receita_w, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('DT_FIM_RECEITA', to_char(dt_fim_receita_w, 'dd/mm/yyyy hh24:mi:ss'),1) ||
							format_array_json('NR_AGRUPAMENTO',nr_agrupamento_w,1) ||
							format_array_json('QT_SOLUCAO', qt_solucao_w, 1) || 
							format_array_json('QT_DOSAGEM', current_setting('cpoe_gerar_registro_json_pck.qt_dosagem_w')::cpoe_material.qt_dosagem%type, 1) || 
							format_array_json('IE_APLIC_LENTA', ie_aplic_lenta_w, 1) || 
							format_array_json('IE_TIPO_DOSAGEM', current_setting('cpoe_gerar_registro_json_pck.ie_tipo_dosagem_w')::cpoe_material.ie_tipo_dosagem%type, 1) || 
							format_array_json('HR_MIN_APLICACAO', hr_min_aplicacao_w, 1) || 
							format_array_json('IE_APLIC_BOLUS', ie_aplic_bolus_w, 1) || 
							format_array_json('IE_TIPO_SOLUCAO', current_setting('cpoe_gerar_registro_json_pck.ie_tipo_solucao_w')::cpoe_material.ie_tipo_solucao%type, 1) ||
							format_array_json('IE_MATERIAL', ie_material_w, 1) ||
							format_array_json('DS_DIAS_SEMANA', ds_dias_semana_w, 1) ||
							format_array_json('IE_SEGUNDA', ie_segunda_w, 1) ||
							format_array_json('IE_TERCA', ie_terca_w, 1) ||
							format_array_json('IE_QUARTA', ie_quarta_w, 1) ||
							format_array_json('IE_QUINTA', ie_quinta_w, 1) ||
							format_array_json('IE_SEXTA', ie_sexta_w, 1) ||
							format_array_json('IE_SABADO', ie_sabado_w, 1) ||
							format_array_json('IE_DOMINGO', ie_domingo_w, 1) ||
							format_array_json('CD_MAT_RECONS1', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type, 1) ||
							format_array_json('QT_DOSE_RECONS1', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons1_w')::cpoe_material.qt_dose_recons1%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC1', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec1_w')::cpoe_material.ds_dose_diferenciada_rec1%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS1', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons1_w')::cpoe_material.cd_unid_med_dose_recons1%type, 1) ||
							format_array_json('CD_MAT_RECONS2', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type, 1) ||
							format_array_json('QT_DOSE_RECONS2', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons2_w')::cpoe_material.qt_dose_recons2%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC2', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec2_w')::cpoe_material.ds_dose_diferenciada_rec2%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS2', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons2_w')::cpoe_material.cd_unid_med_dose_recons2%type, 1) ||
							format_array_json('CD_MAT_RECONS3', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type, 1) ||
							format_array_json('QT_DOSE_RECONS3', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons3_w')::cpoe_material.qt_dose_recons3%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC3', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec3_w')::cpoe_material.ds_dose_diferenciada_rec3%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS3', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons3_w')::cpoe_material.cd_unid_med_dose_recons3%type, 1) ||
							format_array_json('CD_MAT_RECONS4', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type, 1) ||
							format_array_json('QT_DOSE_RECONS4', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons4_w')::cpoe_material.qt_dose_recons4%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC4', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec4_w')::cpoe_material.ds_dose_diferenciada_rec4%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS4', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons4_w')::cpoe_material.cd_unid_med_dose_recons4%type, 1) ||
							format_array_json('CD_MAT_RECONS5', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type, 1) ||
							format_array_json('QT_DOSE_RECONS5', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons5_w')::cpoe_material.qt_dose_recons5%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC5', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec5_w')::cpoe_material.ds_dose_diferenciada_rec5%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS5', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons5_w')::cpoe_material.cd_unid_med_dose_recons5%type, 1) ||
							format_array_json('CD_MAT_RECONS6', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons6_w')::cpoe_material.cd_mat_recons6%type, 1) ||
							format_array_json('QT_DOSE_RECONS6', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons6_w')::cpoe_material.qt_dose_recons6%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC6', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec6_w')::cpoe_material.ds_dose_diferenciada_rec6%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS6', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons6_w')::cpoe_material.cd_unid_med_dose_recons6%type, 1) ||
							format_array_json('CD_MAT_RECONS7', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons7_w')::cpoe_material.cd_mat_recons7%type, 1) ||
							format_array_json('QT_DOSE_RECONS7', current_setting('cpoe_gerar_registro_json_pck.qt_dose_recons7_w')::cpoe_material.qt_dose_recons7%type, 1) ||
							format_array_json('DS_DOSE_DIFERENCIADA_REC7', current_setting('cpoe_gerar_registro_json_pck.ds_dose_diferenciada_rec7_w')::cpoe_material.ds_dose_diferenciada_rec7%type, 1) ||
							format_array_json('CD_UNID_MED_DOSE_RECONS7', current_setting('cpoe_gerar_registro_json_pck.cd_unid_med_dose_recons7_w')::cpoe_material.cd_unid_med_dose_recons7%type, 1) ||
							format_array_json('NR_SEQ_ASSINATURA', current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type, 1) ||
							format_array_json('NR_SEQ_ASSINATURA_SUSP', current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_susp_w')::cpoe_material.nr_seq_assinatura_susp%type, 1) ||
							format_array_json('DT_ASSINATURA_DIGITAL', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type, 'dd/mm/yyyy hh24:mi:ss'), 1) ||
							format_array_json('DT_ASSINATURA_DIG_SUSP', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_dig_susp_w')::tasy_assinatura_digital.dt_assinatura%type, 'dd/mm/yyyy hh24:mi:ss'), 1) ||
							format_array_json('NR_SEQ_CPOE_ORDER_UNIT', current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type, 1) || 
                            format_array_json('NR_SEQ_CPOE_RP', nr_seq_cpoe_rp_w, 1), false);

			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_mat_w', substr(current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text,1,length(current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text)-2) || '},', false);
		end if;

		end loop;
		close current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR;

		CPOE_Gerar_Registro_Sol_Json( nr_atendimento_p, dt_referencia_p, nm_usuario_p, ds_json_sol_ret_w, nr_prescricao_p);

		if (ds_json_sol_ret_w IS NOT NULL AND ds_json_sol_ret_w::text <> '') then
			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_json_mat_w', current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text || ds_json_sol_ret_w, false);			
		end if;

		if (current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::(text IS NOT NULL AND text::text <> '')) then
			begin
			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_registro_w', format_json('DS_MATERIAL', current_setting('cpoe_gerar_registro_json_pck.ds_json_mat_w')::text), false);


			CALL cpoe_gerar_registro_json_pck.cpoe_salvar_json( 	nr_atendimento_p,
								dt_referencia_p,
								nm_usuario_p,
								'M',
								current_setting('cpoe_gerar_registro_json_pck.ds_registro_w')::text);						
			end;
		end if;

	commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gerar_registro_json_pck.cpoe_gerar_registro_med_json ( nr_atendimento_p bigint, dt_referencia_p timestamp, nm_usuario_p text, nr_prescricao_p bigint default null) FROM PUBLIC;
