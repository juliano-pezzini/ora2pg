-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE cpoe_gerar_registro_json_pck.cpoe_gerar_registro_hemo_json ( nr_atendimento_p bigint, nm_usuario_p text, dt_referencia_p timestamp, nr_prescricao_p bigint default null) AS $body$
DECLARE


current_setting('cpoe_gerar_registro_json_pck.ds_registro_w')::text				text;
ds_json_hemo_w				text;
ds_node_horarios_w			text;
ds_item_w					varchar(255);
current_setting('cpoe_gerar_registro_json_pck.ds_item_ww')::varchar(1000)					varchar(255);
ds_intervalo_w				varchar(255);
current_setting('cpoe_gerar_registro_json_pck.dt_horario_w')::prescr_mat_hor.dt_horario%type				varchar(20);
current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20)			varchar(20);
current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20)				varchar(20);
current_setting('cpoe_gerar_registro_json_pck.ds_hora_w')::varchar(255)					varchar(255);
current_setting('cpoe_gerar_registro_json_pck.nr_hora_w')::integer					bigint;
count_cpoe_hemoretapia_w 	bigint;

ds_prescritor_detalhe_w		varchar(255);
current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255)	varchar(255);
dt_prescrita_detalhe_w		varchar(255);
ds_hemoterapia_w			varchar(255);
ds_unidade_produto_w		varchar(255);
current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255)				varchar(255);
current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255)		varchar(255);
current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)		varchar(255);
current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp			timestamp;

current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type				prescr_proc_hor.dt_horario%type;
current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type			prescr_proc_hor.dt_horario%type;

current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type				prescr_solic_bco_sangue.nm_usuario%type;
current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type			prescr_solic_bco_sangue.nm_usuario_nrec%type;
current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type			prescr_solic_bco_sangue.dt_atualizacao%type;
current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type 		prescr_solic_bco_sangue.dt_atualizacao_nrec%type;

current_setting('cpoe_gerar_registro_json_pck.nr_ocorrencia_w')::cpoe_gasoterapia.nr_ocorrencia%type             cpoe_hemoterapia.nr_ocorrencia%type;
current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type					cpoe_hemoterapia.dt_fim%type;
current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type					cpoe_hemoterapia.dt_inicio%type;
nr_cirurgia_w  				cpoe_hemoterapia.nr_cirurgia%type;
qt_hora_min_infusao_w  		cpoe_hemoterapia.qt_hora_min_infusao%type;	
nr_seq_indicacao1_w			cpoe_hemoterapia.nr_seq_indicacao1%type;
nr_seq_indicacao2_w			cpoe_hemoterapia.nr_seq_indicacao2%type;

current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type				cpoe_hemoterapia.dt_liberacao%type;
current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type	prescr_medica.dt_liberacao%type;
current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type		prescr_medica.dt_liberacao_farmacia%type;		
current_setting('cpoe_gerar_registro_json_pck.ie_momento_lote_w')::regra_disp_lote_farm.ie_momento_lote%type			regra_disp_lote_farm.ie_momento_lote%type;
current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255)	varchar(255);
current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255)	varchar(255);
current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255)	varchar(255);
current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255)	varchar(255);

nr_sequencia_w				cpoe_hemoterapia.nr_sequencia%type;
ie_tipo_hemoterap_w			cpoe_hemoterapia.ie_tipo_hemoterap%type;
ie_reserva_w				cpoe_hemoterapia.ie_reserva%type;
cd_mat_hem1_w				cpoe_hemoterapia.cd_mat_hem1%type;
ie_via_mat_hem1_w			cpoe_hemoterapia.ie_via_mat_hem1%type;
qt_dose_hem1_w				cpoe_hemoterapia.qt_dose_hem1%type;
dt_inicio_hem1_w			cpoe_hemoterapia.dt_inicio_hem1%type;
cd_interv_hem1_w			cpoe_hemoterapia.cd_interv_hem1%type;
cd_unid_medida_dose_hem1_w	cpoe_hemoterapia.cd_unid_medida_dose_hem1%type;
ie_adm_mat_hem1_w			cpoe_hemoterapia.ie_adm_mat_hem1%type;
ds_observacao_mat1_w		cpoe_hemoterapia.ds_observacao_mat1%type;
cd_mat_hem2_w				cpoe_hemoterapia.cd_mat_hem2%type;
ie_via_mat_hem2_w			cpoe_hemoterapia.ie_via_mat_hem2%type;
qt_dose_hem2_w				cpoe_hemoterapia.qt_dose_hem2%type;
dt_inicio_hem2_w			cpoe_hemoterapia.dt_inicio_hem2%type;
cd_interv_hem2_w			cpoe_hemoterapia.cd_interv_hem2%type;
cd_unid_medida_dose_hem2_w	cpoe_hemoterapia.cd_unid_medida_dose_hem2%type;
ie_adm_mat_hem2_w			cpoe_hemoterapia.ie_adm_mat_hem2%type;
ds_observacao_mat2_w		cpoe_hemoterapia.ds_observacao_mat2%type;
cd_mat_hem3_w				cpoe_hemoterapia.cd_mat_hem3%type;
ie_via_mat_hem3_w			cpoe_hemoterapia.ie_via_mat_hem3%type;
qt_dose_hem3_w				cpoe_hemoterapia.qt_dose_hem3%type;
dt_inicio_hem3_w			cpoe_hemoterapia.dt_inicio_hem3%type;
cd_interv_hem3_w			cpoe_hemoterapia.cd_interv_hem3%type;
cd_unid_medida_dose_hem3_w	cpoe_hemoterapia.cd_unid_medida_dose_hem3%type;
ie_adm_mat_hem3_w			cpoe_hemoterapia.ie_adm_mat_hem3%type;
ds_observacao_mat3_w		cpoe_hemoterapia.ds_observacao_mat3%type;
cd_mat_hem4_w				cpoe_hemoterapia.cd_mat_hem4%type;
ie_via_mat_hem4_w			cpoe_hemoterapia.ie_via_mat_hem4%type;
qt_dose_hem4_w				cpoe_hemoterapia.qt_dose_hem4%type;
dt_inicio_hem4_w			cpoe_hemoterapia.dt_inicio_hem4%type;
cd_interv_hem4_w			cpoe_hemoterapia.cd_interv_hem4%type;
cd_unid_medida_dose_hem4_w	cpoe_hemoterapia.cd_unid_medida_dose_hem4%type;
ie_adm_mat_hem4_w			cpoe_hemoterapia.ie_adm_mat_hem4%type;
ds_observacao_mat4_w		cpoe_hemoterapia.ds_observacao_mat4%type;
cd_mat_hem5_w				cpoe_hemoterapia.cd_mat_hem5%type;
ie_via_mat_hem5_w			cpoe_hemoterapia.ie_via_mat_hem5%type;
qt_dose_hem5_w				cpoe_hemoterapia.qt_dose_hem5%type;
dt_inicio_hem5_w			cpoe_hemoterapia.dt_inicio_hem5%type;
cd_interv_hem5_w			cpoe_hemoterapia.cd_interv_hem5%type;
cd_unid_medida_dose_hem5_w	cpoe_hemoterapia.cd_unid_medida_dose_hem5%type;
ie_adm_mat_hem5_w			cpoe_hemoterapia.ie_adm_mat_hem5%type;
ds_observacao_mat5_w		cpoe_hemoterapia.ds_observacao_mat5%type;
cd_mat_dil1_w				cpoe_hemoterapia.cd_mat_dil1%type;
qt_dose_dil1_w				cpoe_hemoterapia.qt_dose_dil1%type;
cd_unid_med_dose_dil1_w		cpoe_hemoterapia.cd_unid_med_dose_dil1%type;
cd_mat_dil2_w				cpoe_hemoterapia.cd_mat_dil2%type;
qt_dose_dil2_w				cpoe_hemoterapia.qt_dose_dil2%type;
cd_unid_med_dose_dil2_w		cpoe_hemoterapia.cd_unid_med_dose_dil2%type;
cd_mat_dil3_w				cpoe_hemoterapia.cd_mat_dil3%type;
qt_dose_dil3_w				cpoe_hemoterapia.qt_dose_dil3%type;
cd_unid_med_dose_dil3_w		cpoe_hemoterapia.cd_unid_med_dose_dil3%type;
cd_mat_dil4_w				cpoe_hemoterapia.cd_mat_dil4%type;
qt_dose_dil4_w				cpoe_hemoterapia.qt_dose_dil4%type;
cd_unid_med_dose_dil4_w		cpoe_hemoterapia.cd_unid_med_dose_dil4%type;
cd_mat_dil5_w				cpoe_hemoterapia.cd_mat_dil5%type;
qt_dose_dil5_w				cpoe_hemoterapia.qt_dose_dil5%type;
cd_unid_med_dose_dil5_w		cpoe_hemoterapia.cd_unid_med_dose_dil5%type;
current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type			cpoe_hemoterapia.cd_mat_recons1%type;
qt_dose_rec1_w				cpoe_hemoterapia.qt_dose_rec1%type;
cd_unid_med_rec1_w			cpoe_hemoterapia.cd_unid_med_rec1%type;
current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type			cpoe_hemoterapia.cd_mat_recons2%type;
qt_dose_rec2_w				cpoe_hemoterapia.qt_dose_rec2%type;
cd_unid_med_rec2_w			cpoe_hemoterapia.cd_unid_med_rec2%type;
current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type			cpoe_hemoterapia.cd_mat_recons3%type;
qt_dose_rec3_w				cpoe_hemoterapia.qt_dose_rec3%type;
cd_unid_med_rec3_w			cpoe_hemoterapia.cd_unid_med_rec3%type;
current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type			cpoe_hemoterapia.cd_mat_recons4%type;
qt_dose_rec4_w				cpoe_hemoterapia.qt_dose_rec4%type;
cd_unid_med_rec4_w			cpoe_hemoterapia.cd_unid_med_rec4%type;
current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type			cpoe_hemoterapia.cd_mat_recons5%type;
qt_dose_rec5_w				cpoe_hemoterapia.qt_dose_rec5%type;
cd_unid_med_rec5_w			cpoe_hemoterapia.cd_unid_med_rec5%type;
cd_mat_red1_w				cpoe_hemoterapia.cd_mat_red1%type;
qt_dose_red1_w				cpoe_hemoterapia.qt_dose_red1%type;
cd_unid_med_dose_red1_w		cpoe_hemoterapia.cd_unid_med_dose_red1%type;
cd_mat_red2_w				cpoe_hemoterapia.cd_mat_red2%type;
qt_dose_red2_w				cpoe_hemoterapia.qt_dose_red2%type;
cd_unid_med_dose_red2_w		cpoe_hemoterapia.cd_unid_med_dose_red2%type;
cd_mat_red3_w				cpoe_hemoterapia.cd_mat_red3%type;
qt_dose_red3_w				cpoe_hemoterapia.qt_dose_red3%type;
cd_unid_med_dose_red3_w		cpoe_hemoterapia.cd_unid_med_dose_red3%type;
cd_mat_red4_w				cpoe_hemoterapia.cd_mat_red4%type;
qt_dose_red4_w				cpoe_hemoterapia.qt_dose_red4%type;
cd_unid_med_dose_red4_w		cpoe_hemoterapia.cd_unid_med_dose_red4%type;
cd_mat_red5_w				cpoe_hemoterapia.cd_mat_red5%type;
qt_dose_red5_w				cpoe_hemoterapia.qt_dose_red5%type;
cd_unid_med_dose_red5_w		cpoe_hemoterapia.cd_unid_med_dose_red5%type;
hr_prim_hor_hem1_w			cpoe_hemoterapia.hr_prim_hor_hem1%type;
hr_prim_hor_hem2_w			cpoe_hemoterapia.hr_prim_hor_hem2%type;
hr_prim_hor_hem3_w			cpoe_hemoterapia.hr_prim_hor_hem3%type;
hr_prim_hor_hem4_w			cpoe_hemoterapia.hr_prim_hor_hem4%type;
hr_prim_hor_hem5_w			cpoe_hemoterapia.hr_prim_hor_hem5%type;
ie_urgencia_mat_hem1_w		cpoe_hemoterapia.ie_urgencia_mat_hem1%type;
ie_urgencia_mat_hem2_w		cpoe_hemoterapia.ie_urgencia_mat_hem2%type;
ie_urgencia_mat_hem3_w		cpoe_hemoterapia.ie_urgencia_mat_hem3%type;
ie_urgencia_mat_hem4_w		cpoe_hemoterapia.ie_urgencia_mat_hem4%type;
ie_urgencia_mat_hem5_w		cpoe_hemoterapia.ie_urgencia_mat_hem5%type;
ds_hor_hem1_w				cpoe_hemoterapia.ds_hor_hem1%type;
ds_hor_hem2_w				cpoe_hemoterapia.ds_hor_hem2%type;
ds_hor_hem3_w				cpoe_hemoterapia.ds_hor_hem3%type;
ds_hor_hem4_w				cpoe_hemoterapia.ds_hor_hem4%type;
ds_hor_hem5_w				cpoe_hemoterapia.ds_hor_hem5%type;
current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type			cpoe_hemoterapia.nm_usuario_susp%type;
current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w')::cpoe_gasoterapia.dt_lib_suspensao%type		cpoe_hemoterapia.dt_lib_suspensao%type;
nr_seq_proc_interno_w		cpoe_hemoterapia.nr_seq_proc_interno%type;
current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type			cpoe_hemoterapia.nr_seq_assinatura%type;
qt_tempo_inf_etapa_w		cpoe_hemoterapia.qt_tempo_inf_etapa%type;
current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type		tasy_assinatura_digital.dt_assinatura%type;

cd_doenca_cid_w  			prescr_solic_bco_sangue.cd_doenca_cid%type;
ie_tipo_paciente_w			prescr_solic_bco_sangue.ie_tipo_paciente%type;
ie_porte_cirurgico_w		prescr_solic_bco_sangue.ie_porte_cirurgico%type;
ie_tipo_w					prescr_solic_bco_sangue.ie_tipo%type;
dt_programada_w				prescr_solic_bco_sangue.dt_programada%type;
ie_trans_anterior_w			prescr_solic_bco_sangue.ie_trans_anterior%type;
qt_transf_anterior_w		prescr_solic_bco_sangue.qt_transf_anterior%type;
dt_ultima_transf_w			prescr_solic_bco_sangue.dt_ultima_transf%type;
nr_seq_reacao_w				prescr_solic_bco_sangue.nr_seq_reacao%type;
ds_hemocomp_reacao_w		prescr_solic_bco_sangue.ds_hemocomp_reacao%type;
ie_gravidez_w				prescr_solic_bco_sangue.ie_gravidez%type;
qt_gravidez_w				prescr_solic_bco_sangue.qt_gravidez%type;
qt_aborto_w					prescr_solic_bco_sangue.qt_aborto%type;
qt_hemoglobina_w			prescr_solic_bco_sangue.qt_hemoglobina%type;	
qt_hematocrito_w			prescr_solic_bco_sangue.qt_hematocrito%type;
qt_plaqueta_w				prescr_solic_bco_sangue.qt_plaqueta%type;
qt_tap_w					prescr_solic_bco_sangue.qt_tap%type;
qt_tap_inr_w				prescr_solic_bco_sangue.qt_tap_inr%type;
qt_ttpa_w					prescr_solic_bco_sangue.qt_ttpa%type;
qt_ttpa_rel_w				prescr_solic_bco_sangue.qt_ttpa_rel%type;
qt_fibrinogenio_w			prescr_solic_bco_sangue.qt_fibrinogenio%type;
current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type				prescr_solic_bco_sangue.ds_observacao%type;
dt_cirurgia_w				prescr_solic_bco_sangue.dt_cirurgia%type;
ds_cirurgia_w				prescr_solic_bco_sangue.ds_cirurgia%type;
nr_seq_hemo_cpoe_w			prescr_solic_bco_sangue.nr_seq_hemo_cpoe%type;
nr_seq_derivado_w			prescr_procedimento.nr_seq_derivado%type;	
current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type			prescr_procedimento.ie_via_aplicacao%type;
ie_aliquotado_w				prescr_procedimento.ie_aliquotado%type;
ie_filtrado_w				prescr_procedimento.ie_filtrado%type;
ie_irradiado_w				prescr_procedimento.ie_irradiado%type;
ie_lavado_w					prescr_procedimento.ie_lavado%type;
qt_procedimento_w			prescr_procedimento.qt_procedimento%type;	
qt_vol_hemocomp_w			prescr_procedimento.qt_vol_hemocomp%type;	
current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type				prescr_procedimento.cd_intervalo%type;	
current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type				prescr_procedimento.ds_horarios%type;	
qt_veloc_inf_hemo_w			prescr_procedimento.qt_veloc_inf_hemo%type;	
ie_unid_med_hemo_w			prescr_procedimento.ie_unid_med_hemo%type;	
qt_hora_infusao_w			prescr_procedimento.qt_hora_infusao%type;
qt_tempo_infusao_w			prescr_procedimento.qt_tempo_infusao%type;
current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type			prescr_procedimento.ds_justificativa%type;
cd_procedimento_w			prescr_procedimento.cd_procedimento%type;
current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type			prescr_procedimento.dt_suspensao%type;
nr_seq_procedimento_w		prescr_proc_hor.nr_seq_procedimento%type;
nr_prescricao_w				prescr_medica.nr_prescricao%type;
ie_fenotipado_w				prescr_procedimento.ie_fenotipado%type;
current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type        cpoe_order_unit.nr_sequencia%type;

current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR CURSOR FOR
	SELECT	distinct a.cd_doenca_cid,
		a.nr_sequencia,
		CASE WHEN a.ie_tipo_paciente='CL' THEN  'C'  ELSE 'I' END ,
		a.ie_porte_cirurgico,
		a.ie_tipo,
		a.dt_programada,
		a.ie_trans_anterior,
		a.dt_ultima_transf,
		a.nr_seq_reacao,
		a.ie_gravidez,
		a.qt_gravidez,
		a.qt_aborto,
		a.qt_hemoglobina,
		a.qt_hematocrito,
		a.qt_plaqueta,
		a.qt_tap,
		a.qt_tap_inr,
		a.qt_ttpa,
		a.qt_ttpa_rel,
		a.qt_fibrinogenio,
		a.ds_observacao,
		a.dt_cirurgia,
		a.nr_seq_derivado,
		CASE WHEN coalesce(a.nr_seq_derivado,0)=0 THEN  '1'  ELSE '0' END ,
		a.ie_via_aplicacao,
		a.ie_aliquotado,
		a.ie_filtrado,
		a.ie_irradiado,
		a.ie_lavado,
		a.ie_fenotipado,
		a.qt_procedimento,
		a.qt_vol_hemocomp,
		a.cd_intervalo,
		a.ds_horarios,
		a.qt_veloc_inf_hemo,
		a.ie_unid_med_hemo,
		a.qt_hora_min_infusao,
		a.qt_tempo_inf_etapa,
		a.ds_justificativa,
		a.cd_procedimento,
		a.nm_usuario,
		a.nm_usuario_nrec,
		a.dt_atualizacao,
		a.dt_atualizacao_nrec,
		a.cd_mat_hem1,
		a.ie_via_mat_hem1,
		a.qt_dose_hem1,
		a.dt_inicio_hem1,
		a.cd_interv_hem1,
		a.cd_unid_medida_dose_hem1,
		a.ie_adm_mat_hem1,
		a.ds_observacao_mat1,
		a.cd_mat_hem2,
		a.ie_via_mat_hem2,
		a.qt_dose_hem2,
		a.dt_inicio_hem2,
		a.cd_interv_hem2,
		a.cd_unid_medida_dose_hem2,
		a.ie_adm_mat_hem2,
		a.ds_observacao_mat2,
		a.cd_mat_hem3,
		a.ie_via_mat_hem3,
		a.qt_dose_hem3,
		a.dt_inicio_hem3,
		a.cd_interv_hem3,
		a.cd_unid_medida_dose_hem3,
		a.ie_adm_mat_hem3,
		a.ds_observacao_mat3,
		a.cd_mat_hem4,
		a.ie_via_mat_hem4,
		a.qt_dose_hem4,
		a.dt_inicio_hem4,
		a.cd_interv_hem4,
		a.cd_unid_medida_dose_hem4,
		a.ie_adm_mat_hem4,
		a.ds_observacao_mat4,
		a.cd_mat_hem5,
		a.ie_via_mat_hem5,
		a.qt_dose_hem5,
		a.dt_inicio_hem5,
		a.cd_interv_hem5,
		a.cd_unid_medida_dose_hem5,
		a.ie_adm_mat_hem5,
		a.ds_observacao_mat5,
		a.cd_mat_dil1,
		a.qt_dose_dil1,
		a.cd_unid_med_dose_dil1,
		a.cd_mat_dil2,
		a.qt_dose_dil2,
		a.cd_unid_med_dose_dil2,
		a.cd_mat_dil3,
		a.qt_dose_dil3,
		a.cd_unid_med_dose_dil3,
		a.cd_mat_dil4,
		a.qt_dose_dil4,
		a.cd_unid_med_dose_dil4,
		a.cd_mat_dil5,
		a.qt_dose_dil5,
		a.cd_unid_med_dose_dil5,
		a.cd_mat_recons1,
		a.qt_dose_rec1,
		a.cd_unid_med_rec1,
		a.cd_mat_recons2,
		a.qt_dose_rec2,
		a.cd_unid_med_rec2,
		a.cd_mat_recons3,
		a.qt_dose_rec3,
		a.cd_unid_med_rec3,
		a.cd_mat_recons4,
		a.qt_dose_rec4,
		a.cd_unid_med_rec4,
		a.cd_mat_recons5,
		a.qt_dose_rec5,
		a.cd_unid_med_rec5,
		a.cd_mat_red1,
		a.qt_dose_red1,
		a.cd_unid_med_dose_red1,
		a.cd_mat_red2,
		a.qt_dose_red2,
		a.cd_unid_med_dose_red2,
		a.cd_mat_red3,
		a.qt_dose_red3,
		a.cd_unid_med_dose_red3,
		a.cd_mat_red4,
		a.qt_dose_red4,
		a.cd_unid_med_dose_red4,
		a.cd_mat_red5,
		a.qt_dose_red5,
		a.cd_unid_med_dose_red5,
		a.hr_prim_hor_hem1,
		a.hr_prim_hor_hem2,
		a.hr_prim_hor_hem3,
		a.hr_prim_hor_hem4,
		a.hr_prim_hor_hem5,
		a.ie_urgencia_mat_hem1,
		a.ie_urgencia_mat_hem2,
		a.ie_urgencia_mat_hem3,
		a.ie_urgencia_mat_hem4,
		a.ie_urgencia_mat_hem5,
		a.ds_hor_hem1,
		a.ds_hor_hem2,
		a.ds_hor_hem3,
		a.ds_hor_hem4,
		a.ds_hor_hem5,
		a.dt_liberacao,
		a.dt_suspensao,
		a.dt_lib_suspensao,
		a.ie_reserva,
		a.nr_seq_proc_interno,
		a.nr_seq_assinatura,
		a.nr_seq_cpoe_order_unit
	from	cpoe_hemoterapia a,
		prescr_proc_hor c,
		prescr_procedimento e,
		prescr_medica d
	where	a.nr_atendimento = nr_atendimento_p
	and	a.dt_prox_geracao > current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp - 1
	and	(a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
	and	a.nr_sequencia = e.nr_seq_proc_cpoe
	and	e.nr_prescricao = c.nr_prescricao
	and	e.nr_sequencia = c.nr_seq_procedimento
	and	d.nr_prescricao = e.nr_prescricao
	and	(e.nr_seq_solic_sangue IS NOT NULL AND e.nr_seq_solic_sangue::text <> '')
	and	((coalesce(nr_prescricao_p,0) = 0) or (e.nr_prescricao = nr_prescricao_p))
	and	((ie_tipo_hemoterap = 1
			and ((obter_se_exibe_proced(e.nr_prescricao,e.nr_sequencia,e.ie_tipo_proced,'BSHE') = 'S') or (obter_se_exibe_proced(e.nr_prescricao,e.nr_sequencia,e.ie_tipo_proced,'AT') = 'S') or (obter_se_exibe_proced(e.nr_prescricao,e.nr_sequencia,e.ie_tipo_proced,'BS') = 'S')))
		or (ie_tipo_hemoterap = 0))
	and	(((cpoe_reg_valido_ativacao(CASE WHEN coalesce(a.dt_lib_suspensao::text, '') = '' THEN  a.dt_fim  ELSE coalesce(a.dt_suspensao,a.dt_fim) END , a.dt_inicio, current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp, null, a.cd_perfil_ativo, a.ie_retrogrado, a.dt_liberacao, 'N', a.ie_futuro, a.dt_liberacao_fut) = 'S') and (current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp > a.dt_inicio)) or (c.dt_horario between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp and current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp));

current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR CURSOR FOR
	SELECT	coalesce(to_char(c.dt_horario,'dd/mm/yyyy hh24:mi'),'null'),
			coalesce(to_char(c.dt_fim_horario,'dd/mm/yyyy hh24:mi'),'null'),
			coalesce(to_char(c.dt_suspensao,'dd/mm/yyyy hh24:mi'),'null'),
			c.dt_horario,
			a.nr_sequencia
	from	prescr_solic_bco_sangue a,
			cpoe_hemoterapia b,
			prescr_proc_hor c,
			prescr_procedimento d
	where	c.nr_prescricao = d.nr_prescricao
	and		c.nr_seq_procedimento = d.nr_sequencia
	and		d.nr_seq_solic_sangue = a.nr_sequencia
	and		d.nr_prescricao	= a.nr_prescricao
	and		a.nr_seq_hemo_cpoe = b.nr_sequencia
	and		b.nr_sequencia	= nr_seq_hemo_cpoe_w
	and		(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '')
	and		((obter_se_exibe_proced(d.nr_prescricao,d.nr_sequencia,d.ie_tipo_proced,'BSHE') = 'S') or (obter_se_exibe_proced(d.nr_prescricao,d.nr_sequencia,d.ie_tipo_proced,'AT') = 'S') or (obter_se_exibe_proced(d.nr_prescricao,d.nr_sequencia,d.ie_tipo_proced,'BS') = 'S'))
	and		c.dt_horario between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp;


BEGIN

open current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR;
loop
fetch current_setting('cpoe_gerar_registro_json_pck.c01')::into CURSOR
	cd_doenca_cid_w,
	nr_seq_hemo_cpoe_w,
	ie_tipo_paciente_w,
	ie_porte_cirurgico_w,
	ie_tipo_w,
	dt_programada_w,
	ie_trans_anterior_w,
	dt_ultima_transf_w,
	nr_seq_reacao_w,
	ie_gravidez_w,
	qt_gravidez_w,
	qt_aborto_w,
	qt_hemoglobina_w,
	qt_hematocrito_w,
	qt_plaqueta_w,
	qt_tap_w,
	qt_tap_inr_w,
	qt_ttpa_w,
	qt_ttpa_rel_w,
	qt_fibrinogenio_w,
	current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type,
	dt_cirurgia_w,
	nr_seq_derivado_w,
	ie_tipo_hemoterap_w,
	current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type,
	ie_aliquotado_w,
	ie_filtrado_w,
	ie_irradiado_w,
	ie_lavado_w,
	ie_fenotipado_w,
	qt_procedimento_w,
	qt_vol_hemocomp_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type,
	current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type,
	qt_veloc_inf_hemo_w,
	ie_unid_med_hemo_w,
	qt_hora_min_infusao_w,
	qt_tempo_inf_etapa_w,
	current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type,
	cd_procedimento_w,
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type,
	current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type,
	current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type,
	current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type,
	cd_mat_hem1_w,
	ie_via_mat_hem1_w,
	qt_dose_hem1_w,
	dt_inicio_hem1_w,
	cd_interv_hem1_w,
	cd_unid_medida_dose_hem1_w,
	ie_adm_mat_hem1_w,
	ds_observacao_mat1_w,
	cd_mat_hem2_w,
	ie_via_mat_hem2_w,
	qt_dose_hem2_w,
	dt_inicio_hem2_w,
	cd_interv_hem2_w,
	cd_unid_medida_dose_hem2_w,
	ie_adm_mat_hem2_w,
	ds_observacao_mat2_w,
	cd_mat_hem3_w,
	ie_via_mat_hem3_w,
	qt_dose_hem3_w,
	dt_inicio_hem3_w,
	cd_interv_hem3_w,
	cd_unid_medida_dose_hem3_w,
	ie_adm_mat_hem3_w,
	ds_observacao_mat3_w,
	cd_mat_hem4_w,
	ie_via_mat_hem4_w,
	qt_dose_hem4_w,
	dt_inicio_hem4_w,
	cd_interv_hem4_w,
	cd_unid_medida_dose_hem4_w,
	ie_adm_mat_hem4_w,
	ds_observacao_mat4_w,
	cd_mat_hem5_w,
	ie_via_mat_hem5_w,
	qt_dose_hem5_w,
	dt_inicio_hem5_w,
	cd_interv_hem5_w,
	cd_unid_medida_dose_hem5_w,
	ie_adm_mat_hem5_w,
	ds_observacao_mat5_w,
	cd_mat_dil1_w,
	qt_dose_dil1_w,
	cd_unid_med_dose_dil1_w,
	cd_mat_dil2_w,
	qt_dose_dil2_w,
	cd_unid_med_dose_dil2_w,
	cd_mat_dil3_w,
	qt_dose_dil3_w,
	cd_unid_med_dose_dil3_w,
	cd_mat_dil4_w,
	qt_dose_dil4_w,
	cd_unid_med_dose_dil4_w,
	cd_mat_dil5_w,
	qt_dose_dil5_w,
	cd_unid_med_dose_dil5_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type,
	qt_dose_rec1_w,
	cd_unid_med_rec1_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type,
	qt_dose_rec2_w,
	cd_unid_med_rec2_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type,
	qt_dose_rec3_w,
	cd_unid_med_rec3_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type,
	qt_dose_rec4_w,
	cd_unid_med_rec4_w,
	current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type,
	qt_dose_rec5_w,
	cd_unid_med_rec5_w,
	cd_mat_red1_w,
	qt_dose_red1_w,
	cd_unid_med_dose_red1_w,
	cd_mat_red2_w,
	qt_dose_red2_w,
	cd_unid_med_dose_red2_w,
	cd_mat_red3_w,
	qt_dose_red3_w,
	cd_unid_med_dose_red3_w,
	cd_mat_red4_w,
	qt_dose_red4_w,
	cd_unid_med_dose_red4_w,
	cd_mat_red5_w,
	qt_dose_red5_w,
	cd_unid_med_dose_red5_w,
	hr_prim_hor_hem1_w,
	hr_prim_hor_hem2_w,
	hr_prim_hor_hem3_w,
	hr_prim_hor_hem4_w,
	hr_prim_hor_hem5_w,
	ie_urgencia_mat_hem1_w,
	ie_urgencia_mat_hem2_w,
	ie_urgencia_mat_hem3_w,
	ie_urgencia_mat_hem4_w,
	ie_urgencia_mat_hem5_w,
	ds_hor_hem1_w,
	ds_hor_hem2_w,
	ds_hor_hem3_w,
	ds_hor_hem4_w,
	ds_hor_hem5_w,
	current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type,
	current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type,
	current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w')::cpoe_gasoterapia.dt_lib_suspensao%type,
	ie_reserva_w,
	nr_seq_proc_interno_w,
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type,
	current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type;
EXIT WHEN NOT FOUND; /* apply on current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR */

	CALL cpoe_gerar_registro_json_pck.cpoe_limpar_valores_horas();

	PERFORM set_config('cpoe_gerar_registro_json_pck.dt_suspensao_item_w', cpoe_gerar_registro_json_pck.regra_data_susp(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type), false);
	PERFORM set_config('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w', cpoe_gerar_registro_json_pck.regra_data_susp(current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w')::cpoe_gasoterapia.dt_lib_suspensao%type), false);

	select count(*)
	into STRICT   count_cpoe_hemoretapia_w
	from   cpoe_hemoterapia
	where  nr_sequencia = nr_seq_hemo_cpoe_w;

	PERFORM set_config('cpoe_gerar_registro_json_pck.dt_fim_w', '', false);
	PERFORM set_config('cpoe_gerar_registro_json_pck.dt_inicio_w', dt_programada_w, false);

	if (count_cpoe_hemoretapia_w > 0) then
		begin

		select	dt_fim,
			dt_programada,
			substr(cpoe_obter_ds_hemoterapia(NR_SEQUENCIA, dt_liberacao,'S', cpoe_gerar_registro_json_pck.regra_data_susp(dt_lib_suspensao),cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao),null,null,'N',null,null,'N',obter_horarios_regra(ds_horarios)),1,255),
			dt_liberacao,
			obter_initcap(obter_nome_medico(obter_pf_usuario(nm_usuario_nrec,'C'),'PMS')),
			cpoe_obter_tempo_prescrito(coalesce(dt_atualizacao_nrec, dt_programada)),
			cpoe_get_prior_prescriber(nr_seq_cpoe_anterior, 'CPOE_HEMOTERAPIA', 'N'),
			cpoe_get_prior_prescriber(nr_seq_cpoe_anterior, 'CPOE_HEMOTERAPIA', 'D'),
			cpoe_obter_data_hora_form(dt_programada,TO_CHAR(dt_programada,'hh24:mi:ss')) dt_inicio_grid,
			substr(obter_dados_pf(obter_pf_usuario(nm_usuario_nrec,'C'),'COPR'),1,255) ds_conselho,
			obter_nome_pf(obter_pf_usuario(nm_usuario_nrec,'C')) ds_prescritor_grid,
			dt_liberacao_enf dt_liberacao_enfermagem,
			dt_liberacao_farm dt_liberacao_farmacia,
			nm_usuario_lib_enf nm_usuario_lib_enfermagem,
			nm_usuario_lib_farm nm_usuario_lib_farmacia,
			CASE WHEN coalesce(cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao)::text, '') = '' THEN  null  ELSE nm_usuario_susp END ,
			CASE WHEN coalesce(cpoe_gerar_registro_json_pck.regra_data_susp(dt_suspensao)::text, '') = '' THEN  null  ELSE cpoe_obter_info_suspensao(nr_sequencia,'P','N') END  nm_usuario_descontinuacao,
			cpoe_obter_desc_info_hemote(nr_sequencia) ds_item,
			cpoe_obter_momento_lote(ie_motivo_prescricao, cd_setor_atendimento, obter_estabelecimento_setor(cd_setor_atendimento), 'N') ie_momento_lote,
			obter_desc_expressao(315377,null),
			obter_data_assinatura_digital(nr_seq_assinatura),
			obter_pf_usuario(coalesce(nm_usuario, nm_usuario_nrec),'N') ds_prescritor_reval
		into STRICT	current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type,
			current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type,
			ds_hemoterapia_w,
			current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type,
			ds_prescritor_detalhe_w,
			dt_prescrita_detalhe_w,
			current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp,
			current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type,
			current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type,
			current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255),					
			current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type,
			current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255),
			current_setting('cpoe_gerar_registro_json_pck.ds_item_ww')::varchar(1000),
			current_setting('cpoe_gerar_registro_json_pck.ie_momento_lote_w')::regra_disp_lote_farm.ie_momento_lote%type,
			ds_unidade_produto_w,
			current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type,
			current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)
		from	cpoe_hemoterapia
		where	nr_sequencia = nr_seq_hemo_cpoe_w;

		select	max(dt_fim_horario)
		into STRICT	current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type
		FROM (SELECT	MAX(dt_horario) dt_fim_horario
				FROM	prescr_recomendacao a,
						prescr_medica b,
						prescr_proc_hor c,
						cpoe_hemoterapia d
				WHERE	c.nr_prescricao = b.nr_prescricao
				AND		c.nr_seq_procedimento = a.nr_sequencia
				AND		a.nr_prescricao 	= b.nr_prescricao
				AND		b.nr_atendimento 	= nr_atendimento_p
				AND		c.dt_horario BETWEEN current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	AND	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp
				AND		(coalesce(b.dt_liberacao_medico, b.dt_liberacao) IS NOT NULL AND (coalesce(b.dt_liberacao_medico, b.dt_liberacao))::text <> '')
				AND 	a.nr_seq_rec_cpoe 	= d.nr_sequencia
				AND		d.dt_fim			< c.dt_horario
				AND		(d.dt_fim IS NOT NULL AND d.dt_fim::text <> '')
				AND		d.nr_sequencia 		= nr_seq_hemo_cpoe_w
				
UNION	ALL

				PERFORM	MAX(dt_fim) dt_fim_horario
				FROM	cpoe_hemoterapia
				WHERE	nr_atendimento	= nr_atendimento_p
				AND		nr_sequencia	= nr_seq_hemo_cpoe_w
				AND		(dt_fim IS NOT NULL AND dt_fim::text <> '')) alias12;
		end;
	end if;

	open current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR;
		loop
		fetch current_setting('cpoe_gerar_registro_json_pck.c02')::into CURSOR
			current_setting('cpoe_gerar_registro_json_pck.dt_horario_w')::prescr_mat_hor.dt_horario%type,
			current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20),
			current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20),
			current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type,
			nr_sequencia_w;
		EXIT WHEN NOT FOUND; /* apply on current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR */

			select 	max(nr_seq_indicacao)
			into STRICT	nr_seq_indicacao1_w
			from   	prescr_sol_bs_indicacao
			where  	nr_seq_solic_bs = nr_sequencia_w;

			select 	max(nr_seq_indicacao)
			into STRICT	nr_seq_indicacao2_w
			from   	prescr_sol_bs_indicacao
			where  	nr_seq_solic_bs = nr_sequencia_w
			and		nr_seq_indicacao <> nr_seq_indicacao1_w;				

			PERFORM set_config('cpoe_gerar_registro_json_pck.nr_hora_w', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_horario_ww')::prescr_gasoterapia_hor.dt_horario%type,'hh24'), false);
			PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'P', false);

			if (current_setting('cpoe_gerar_registro_json_pck.dt_fim_horario_w')::varchar(20) <> 'null') then
				PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'S', false);
			end if;	

			if (current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_w')::varchar(20)	<> 'null') then
				PERFORM set_config('cpoe_gerar_registro_json_pck.ds_hora_w', 'N', false);
			end if;

			CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_horario(current_setting('cpoe_gerar_registro_json_pck.nr_hora_w')::integer, current_setting('cpoe_gerar_registro_json_pck.ds_hora_w')::varchar(255));

			if (current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%(type IS NOT NULL AND type::text <> '') and (current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp)) then
				begin
				CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_fim_validade(current_setting('cpoe_gerar_registro_json_pck.dt_horario_fim_w')::cpoe_dieta.dt_fim%type);
				end;
			end if;

		end loop;
		close current_setting('cpoe_gerar_registro_json_pck.c02')::CURSOR;

		if (current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%(type IS NOT NULL AND type::text <> '') and (current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type between current_setting('cpoe_gerar_registro_json_pck.dt_hora_formatada_w')::timestamp	and	current_setting('cpoe_gerar_registro_json_pck.dt_hora_fim_formatada_w')::timestamp)) then
			begin
			CALL cpoe_gerar_registro_json_pck.cpoe_seta_status_ini_validade(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type);
			end;
		end if;

		if (current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w')::cpoe_gasoterapia.dt_lib_suspensao%coalesce(type::text, '') = '')  then
			PERFORM set_config('cpoe_gerar_registro_json_pck.dt_suspensao_item_w', null, false);
		end if;

			ds_json_hemo_w := ds_json_hemo_w || '{' ||
						format_array_json('DS_PRESCRITOR_DETALHE',cpoe_gerar_registro_json_pck.remove_aspas(ds_prescritor_detalhe_w),1)  ||
						format_array_json('DT_PRESCRITA_DETALHE',dt_prescrita_detalhe_w,1)  ||
						format_array_json('DS_PREVIOUS_PRESCRIBER',cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_previous_prescriber_w')::varchar(255)),1)  ||
						format_array_json('DT_PREVIOUS_PRESCRIBER',current_setting('cpoe_gerar_registro_json_pck.dt_previous_prescriber_w')::varchar(255),1)  ||
						format_array_json('DS_CONSELHO', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_conselho_w')::varchar(255)),1) ||	
						format_array_json('DS_PRESCRITOR', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_grid_w')::varchar(255)),1) ||
						format_array_json('DS_PRESCRITOR_REVAL', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_prescritor_reval_w')::varchar(255)),1) ||
						format_array_json('DS_HEMOTERAPIA',cpoe_gerar_registro_json_pck.remove_aspas(ds_hemoterapia_w),1)  ||
						format_array_json('DS_ITEM',current_setting('cpoe_gerar_registro_json_pck.ds_item_ww')::varchar(1000),1)  ||
						format_array_json('CD_DOENCA_CID',cd_doenca_cid_w,1)  ||
						format_array_json('IE_TRANS_ANTERIOR',ie_trans_anterior_w,1)  ||
						format_array_json('DT_ULTIMA_TRANSF', dt_ultima_transf_w,1) ||
						format_array_json('NR_SEQ_REACAO', nr_seq_reacao_w,1) ||
						format_array_json('NR_SEQ_DERIVADO_REAC', ds_hemocomp_reacao_w,1)   ||
						format_array_json('IE_GRAVIDEZ',ie_gravidez_w,1)  ||
						format_array_json('QT_GRAVIDEZ', qt_gravidez_w,1) ||
						format_array_json('QT_ABORTO', qt_aborto_w,1) ||
						format_array_json('IE_TIPO_PACIENTE', ie_tipo_paciente_w,1) ||
						format_array_json('IE_PORTE_CIRURGICO', ie_porte_cirurgico_w,1) ||
						format_array_json('NR_CIRURGIA', nr_cirurgia_w,1) ||
						format_array_json('DT_CIRURGIA', dt_cirurgia_w,1) ||
						format_array_json('QT_HEMOGLOBINA', qt_hemoglobina_w,1) ||
						format_array_json('QT_HEMATOCRITO', qt_hematocrito_w,1) ||
						format_array_json('QT_PLAQUETA', qt_plaqueta_w,1) ||
						format_array_json('QT_TAP', qt_tap_w,1) ||
						format_array_json('QT_TAP_INR', qt_tap_inr_w,1) ||
						format_array_json('QT_TTPA', qt_ttpa_w,1) ||
						format_array_json('QT_TTPA_REL', qt_ttpa_rel_w,1) ||
						format_array_json('QT_FIBRINOGENIO', qt_fibrinogenio_w,1) ||
						format_array_json('IE_TIPO_HEMOTERAP', ie_tipo_hemoterap_w,1) ||
						format_array_json('NR_SEQ_DERIVADO', nr_seq_derivado_w,1) ||
						format_array_json('IE_VIA_APLICACAO', current_setting('cpoe_gerar_registro_json_pck.ie_via_aplicacao_w')::cpoe_material.ie_via_aplicacao%type,1) ||
						format_array_json('QT_PROCEDIMENTO', qt_procedimento_w,1) ||
						format_array_json('DS_UNIDADE_PRODUTO', cpoe_gerar_registro_json_pck.remove_aspas(ds_unidade_produto_w),1) ||
						format_array_json('QT_VOL_HEMOCOMP', qt_vol_hemocomp_w,1) ||
						format_array_json('QT_HORA_MIN_INFUSAO', qt_hora_min_infusao_w,1) ||
						format_array_json('QT_TEMPO_INF_ETAPA', qt_tempo_inf_etapa_w,1) ||
						format_array_json('QT_VELOC_INF_HEMO', qt_veloc_inf_hemo_w,1) ||
						format_array_json('IE_UNID_MED_HEMO', ie_unid_med_hemo_w,1) ||
						format_array_json('CD_INTERVALO', current_setting('cpoe_gerar_registro_json_pck.cd_intervalo_w')::prescr_gasoterapia.cd_intervalo%type,1) ||
						format_array_json('IE_ALIQUOTADO', ie_aliquotado_w,1) ||
						format_array_json('IE_FILTRADO', ie_filtrado_w,1) ||
						format_array_json('IE_IRRADIADO', ie_irradiado_w,1) ||
						format_array_json('IE_LAVADO', ie_lavado_w,1) ||
						format_array_json('IE_FENOTIPADO', ie_fenotipado_w,1) ||
						format_array_json('DS_JUSTIFICATIVA', current_setting('cpoe_gerar_registro_json_pck.ds_justificativa_w')::cpoe_material.ds_justificativa%type,1) ||
						format_array_json('NR_SEQ_INDICACAO1', nr_seq_indicacao1_w,1) ||
						format_array_json('NR_SEQ_INDICACAO2', nr_seq_indicacao2_w,1) ||
						format_array_json('IE_TIPO', ie_tipo_w,1) ||
						format_array_json('DT_PROGRAMADA', to_char(dt_programada_w, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DS_HORARIOS', current_setting('cpoe_gerar_registro_json_pck.ds_horarios_w')::prescr_gasoterapia.ds_horarios%type,1) ||
						format_array_json('DS_OBSERVACAO', cpoe_gerar_registro_json_pck.remove_aspas(current_setting('cpoe_gerar_registro_json_pck.ds_observacao_w')::prescr_gasoterapia.ds_observacao%type),1) ||
						format_array_json('DT_FIM', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_fim_w')::cpoe_dieta.dt_fim%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_LIBERACAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_w')::prescr_medica.dt_liberacao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_LIBERACAO_ENFERMAGEM', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_enfermagem_w')::prescr_medica.dt_liberacao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_LIBERACAO_FARMACIA', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_liberacao_farmacia_w')::prescr_medica.dt_liberacao_farmacia%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('NM_USUARIO_LIB_ENFERMAGEM', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_enfermagem_w')::varchar(255),1) ||
						format_array_json('NM_USUARIO_LIB_FARMACIA', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_lib_farmacia_w')::varchar(255),1) ||
						format_array_json('IE_MOMENTO_LOTE', current_setting('cpoe_gerar_registro_json_pck.ie_momento_lote_w')::regra_disp_lote_farm.ie_momento_lote%type,1) ||
						format_array_json('DT_SUSPENSAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_LIB_SUSPENSAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_lib_suspensao_item_w')::cpoe_gasoterapia.dt_lib_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_DESCONTINUACAO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_suspensao_item_w')::prescr_gasoterapia.dt_suspensao%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('NM_USUARIO_SUSP', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_susp_w')::cpoe_dieta.nm_usuario_susp%type,1) ||
						format_array_json('NM_USUARIO_DESCONTINUACAO', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_descontinuacao_w')::varchar(255),1) ||
						format_array_json('DT_INICIO_GRID', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_grid_w')::timestamp, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('DT_INICIO', to_char(current_setting('cpoe_gerar_registro_json_pck.dt_inicio_w')::cpoe_dieta.dt_inicio%type, 'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('NR_ATENDIMENTO', nr_atendimento_p,1) ||
						format_array_json('NR_SEQ_HEMO_CPOE', nr_seq_hemo_cpoe_w,1) ||
						format_array_json('NM_USUARIO', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_w')::prescr_gasoterapia.nm_usuario%type,1) ||
						format_array_json('NM_USUARIO_NREC', current_setting('cpoe_gerar_registro_json_pck.nm_usuario_nrec_w')::prescr_gasoterapia_evento.nm_usuario_nrec%type,1) ||
						format_array_json('DT_ATUALIZACAO', current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_w')::prescr_gasoterapia.dt_atualizacao%type,1) ||
						format_array_json('DT_ATUALIZACAO_NREC', current_setting('cpoe_gerar_registro_json_pck.dt_atualizacao_nrec_w')::prescr_gasoterapia_evento.dt_atualizacao_nrec%type,1) ||
						format_array_json('CD_PROCEDIMENTO', cd_procedimento_w,1) ||
						format_array_json('NR_SEQ_PROC_INTERNO', nr_seq_proc_interno_w,1) ||
						format_array_json('NR_OCORRENCIA', current_setting('cpoe_gerar_registro_json_pck.nr_ocorrencia_w')::cpoe_gasoterapia.nr_ocorrencia%type,1) ||
						format_array_json('IE_RESERVA', ie_reserva_w,1) ||
						format_array_json('CD_MAT_HEM1', cd_mat_hem1_w,1) ||
						format_array_json('IE_VIA_MAT_HEM1', ie_via_mat_hem1_w,1) ||
						format_array_json('QT_DOSE_HEM1', qt_dose_hem1_w,1) ||	
						format_array_json('DT_INICIO_HEM1', dt_inicio_hem1_w,1) ||
						format_array_json('CD_INTERV_HEM1', cd_interv_hem1_w,1) ||
						format_array_json('CD_UNID_MEDIDA_DOSE_HEM1', cd_unid_medida_dose_hem1_w,1) ||
						format_array_json('IE_ADM_MAT_HEM1', ie_adm_mat_hem1_w,1) ||
						format_array_json('DS_OBSERVACAO_MAT1', ds_observacao_mat1_w,1) ||
						format_array_json('CD_MAT_HEM2', cd_mat_hem2_w,1) ||
						format_array_json('IE_VIA_MAT_HEM2', ie_via_mat_hem2_w,1) ||
						format_array_json('QT_DOSE_HEM2', qt_dose_hem2_w,1) ||
						format_array_json('DT_INICIO_HEM2', dt_inicio_hem2_w,1) ||
						format_array_json('CD_INTERV_HEM2', cd_interv_hem2_w,1) ||
						format_array_json('CD_UNID_MEDIDA_DOSE_HEM2', cd_unid_medida_dose_hem2_w,1) ||
						format_array_json('IE_ADM_MAT_HEM2', ie_adm_mat_hem2_w,1) ||
						format_array_json('DS_OBSERVACAO_MAT2', ds_observacao_mat2_w,1) ||
						format_array_json('CD_MAT_HEM3', cd_mat_hem3_w,1) ||
						format_array_json('IE_VIA_MAT_HEM3', ie_via_mat_hem3_w,1) ||
						format_array_json('QT_DOSE_HEM3', qt_dose_hem3_w,1) ||
						format_array_json('DT_INICIO_HEM3', dt_inicio_hem3_w,1) ||
						format_array_json('CD_INTERV_HEM3', cd_interv_hem3_w,1) ||
						format_array_json('CD_UNID_MEDIDA_DOSE_HEM3', cd_unid_medida_dose_hem3_w,1) ||
						format_array_json('IE_ADM_MAT_HEM3', ie_adm_mat_hem3_w,1) ||
						format_array_json('DS_OBSERVACAO_MAT3', ds_observacao_mat3_w,1) ||							
						format_array_json('CD_MAT_HEM4', cd_mat_hem4_w,1) ||
						format_array_json('IE_VIA_MAT_HEM4', ie_via_mat_hem4_w,1) ||
						format_array_json('QT_DOSE_HEM4', qt_dose_hem4_w,1) ||
						format_array_json('DT_INICIO_HEM4', dt_inicio_hem4_w,1) ||
						format_array_json('CD_INTERV_HEM4', cd_interv_hem4_w,1) ||
						format_array_json('CD_UNID_MEDIDA_DOSE_HEM4', cd_unid_medida_dose_hem4_w,1) ||
						format_array_json('IE_ADM_MAT_HEM4', ie_adm_mat_hem4_w,1) ||
						format_array_json('DS_OBSERVACAO_MAT4', ds_observacao_mat4_w,1) ||
						format_array_json('CD_MAT_HEM5', cd_mat_hem5_w,1) ||
						format_array_json('IE_VIA_MAT_HEM5', ie_via_mat_hem5_w,1) ||
						format_array_json('QT_DOSE_HEM5', qt_dose_hem5_w,1) ||
						format_array_json('DT_INICIO_HEM5', dt_inicio_hem5_w,1) ||
						format_array_json('CD_INTERV_HEM5', cd_interv_hem5_w,1) ||
						format_array_json('CD_UNID_MEDIDA_DOSE_HEM5', cd_unid_medida_dose_hem5_w,1) ||
						format_array_json('IE_ADM_MAT_HEM5', ie_adm_mat_hem5_w,1) ||
						format_array_json('DS_OBSERVACAO_MAT5', ds_observacao_mat5_w,1) ||
						format_array_json('CD_MAT_DIL1', cd_mat_dil1_w,1) ||
						format_array_json('QT_DOSE_DIL1', qt_dose_dil1_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_DIL1', cd_unid_med_dose_dil1_w,1) ||
						format_array_json('CD_MAT_DIL2', cd_mat_dil2_w,1) ||
						format_array_json('QT_DOSE_DIL2', qt_dose_dil2_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_DIL2', cd_unid_med_dose_dil2_w,1) ||
						format_array_json('CD_MAT_DIL3', cd_mat_dil3_w,1) ||
						format_array_json('QT_DOSE_DIL3', qt_dose_dil3_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_DIL3', cd_unid_med_dose_dil3_w,1) ||
						format_array_json('CD_MAT_DIL4', cd_mat_dil4_w,1) ||
						format_array_json('QT_DOSE_DIL4', qt_dose_dil4_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_DIL4', cd_unid_med_dose_dil4_w,1) ||
						format_array_json('CD_MAT_DIL5', cd_mat_dil5_w,1) ||
						format_array_json('QT_DOSE_DIL5', qt_dose_dil5_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_DIL5', cd_unid_med_dose_dil5_w,1) ||
						format_array_json('CD_MAT_RECONS1', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons1_w')::cpoe_material.cd_mat_recons1%type,1) ||
						format_array_json('QT_DOSE_REC1', qt_dose_rec1_w,1) ||
						format_array_json('CD_UNID_MED_REC1', cd_unid_med_rec1_w,1) ||
						format_array_json('CD_MAT_RECONS2', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons2_w')::cpoe_material.cd_mat_recons2%type,1) ||
						format_array_json('QT_DOSE_REC2', qt_dose_rec2_w,1) ||
						format_array_json('CD_UNID_MED_REC2', cd_unid_med_rec2_w,1) ||
						format_array_json('CD_MAT_RECONS3', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons3_w')::cpoe_material.cd_mat_recons3%type,1) ||
						format_array_json('QT_DOSE_REC3', qt_dose_rec3_w,1) ||
						format_array_json('CD_UNID_MED_REC3', cd_unid_med_rec3_w,1) ||
						format_array_json('CD_MAT_RECONS4', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons4_w')::cpoe_material.cd_mat_recons4%type,1) ||
						format_array_json('QT_DOSE_REC4', qt_dose_rec4_w,1) ||
						format_array_json('CD_UNID_MED_REC4', cd_unid_med_rec4_w,1) ||
						format_array_json('CD_MAT_RECONS5', current_setting('cpoe_gerar_registro_json_pck.cd_mat_recons5_w')::cpoe_material.cd_mat_recons5%type,1) ||
						format_array_json('QT_DOSE_REC5', qt_dose_rec5_w,1) ||
						format_array_json('CD_UNID_MED_REC5', cd_unid_med_rec5_w,1) ||
						format_array_json('CD_MAT_RED1', cd_mat_red1_w,1) ||
						format_array_json('QT_DOSE_RED1', qt_dose_red1_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_RED1', cd_unid_med_dose_red1_w,1) ||
						format_array_json('CD_MAT_RED2', cd_mat_red2_w,1) ||
						format_array_json('QT_DOSE_RED2', qt_dose_red2_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_RED2', cd_unid_med_dose_red2_w,1) ||
						format_array_json('CD_MAT_RED3', cd_mat_red3_w,1) ||
						format_array_json('QT_DOSE_RED3', qt_dose_red3_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_RED3', cd_unid_med_dose_red3_w,1) ||
						format_array_json('CD_MAT_RED4', cd_mat_red4_w,1) ||
						format_array_json('QT_DOSE_RED4', qt_dose_red4_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_RED4', cd_unid_med_dose_red4_w,1) ||
						format_array_json('CD_MAT_RED5', cd_mat_red5_w,1) ||
						format_array_json('QT_DOSE_RED5', qt_dose_red5_w,1) ||
						format_array_json('CD_UNID_MED_DOSE_RED5', cd_unid_med_dose_red5_w,1) ||
						format_array_json('HR_PRIM_HOR_HEM1', hr_prim_hor_hem1_w,1) ||
						format_array_json('HR_PRIM_HOR_HEM2', hr_prim_hor_hem2_w,1) ||
						format_array_json('HR_PRIM_HOR_HEM3', hr_prim_hor_hem3_w,1) ||
						format_array_json('HR_PRIM_HOR_HEM4', hr_prim_hor_hem4_w,1) ||
						format_array_json('HR_PRIM_HOR_HEM5', hr_prim_hor_hem5_w,1) ||
						format_array_json('IE_URGENCIA_MAT_HEM1', ie_urgencia_mat_hem1_w,1) ||
						format_array_json('IE_URGENCIA_MAT_HEM2', ie_urgencia_mat_hem2_w,1) ||
						format_array_json('IE_URGENCIA_MAT_HEM3', ie_urgencia_mat_hem3_w,1) ||
						format_array_json('IE_URGENCIA_MAT_HEM4', ie_urgencia_mat_hem4_w,1) ||
						format_array_json('IE_URGENCIA_MAT_HEM5', ie_urgencia_mat_hem5_w,1) ||
						format_array_json('DS_HOR_HEM1', ds_hor_hem1_w,1) ||
						format_array_json('DS_HOR_HEM2', ds_hor_hem2_w,1) ||
						format_array_json('DS_HOR_HEM3', ds_hor_hem3_w,1) ||
						format_array_json('DS_HOR_HEM4', ds_hor_hem4_w,1) ||
						format_array_json('DS_HOR_HEM5', ds_hor_hem5_w,1) ||
						format_array_json('NR_SEQ_VISAO', 25277,1) ||
						format_array_json('DS_HORA_00',current_setting('cpoe_gerar_registro_json_pck.ds_hora_00_w')::varchar(50),1)	||
						format_array_json('DS_HORA_01',current_setting('cpoe_gerar_registro_json_pck.ds_hora_01_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_02',current_setting('cpoe_gerar_registro_json_pck.ds_hora_02_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_03',current_setting('cpoe_gerar_registro_json_pck.ds_hora_03_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_04',current_setting('cpoe_gerar_registro_json_pck.ds_hora_04_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_05',current_setting('cpoe_gerar_registro_json_pck.ds_hora_05_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_06',current_setting('cpoe_gerar_registro_json_pck.ds_hora_06_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_07',current_setting('cpoe_gerar_registro_json_pck.ds_hora_07_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_08',current_setting('cpoe_gerar_registro_json_pck.ds_hora_08_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_09',current_setting('cpoe_gerar_registro_json_pck.ds_hora_09_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_10',current_setting('cpoe_gerar_registro_json_pck.ds_hora_10_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_11',current_setting('cpoe_gerar_registro_json_pck.ds_hora_11_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_12',current_setting('cpoe_gerar_registro_json_pck.ds_hora_12_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_13',current_setting('cpoe_gerar_registro_json_pck.ds_hora_13_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_14',current_setting('cpoe_gerar_registro_json_pck.ds_hora_14_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_15',current_setting('cpoe_gerar_registro_json_pck.ds_hora_15_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_16',current_setting('cpoe_gerar_registro_json_pck.ds_hora_16_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_17',current_setting('cpoe_gerar_registro_json_pck.ds_hora_17_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_18',current_setting('cpoe_gerar_registro_json_pck.ds_hora_18_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_19',current_setting('cpoe_gerar_registro_json_pck.ds_hora_19_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_20',current_setting('cpoe_gerar_registro_json_pck.ds_hora_20_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_21',current_setting('cpoe_gerar_registro_json_pck.ds_hora_21_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_22',current_setting('cpoe_gerar_registro_json_pck.ds_hora_22_w')::varchar(50),1)  ||
						format_array_json('DS_HORA_23',current_setting('cpoe_gerar_registro_json_pck.ds_hora_23_w')::varchar(50),1)	||
						format_array_json('NR_SEQ_ASSINATURA',current_setting('cpoe_gerar_registro_json_pck.nr_seq_assinatura_w')::cpoe_gasoterapia.nr_seq_assinatura%type,1) ||
						format_array_json('DT_ASSINATURA_DIGITAL',to_char(current_setting('cpoe_gerar_registro_json_pck.dt_assinatura_digital_w')::tasy_assinatura_digital.dt_assinatura%type,'dd/mm/yyyy hh24:mi:ss'),1) ||
						format_array_json('NR_SEQ_CPOE_ORDER_UNIT',current_setting('cpoe_gerar_registro_json_pck.nr_seq_cpoe_order_unit_w')::cpoe_order_unit.nr_sequencia%type, 1);

		ds_json_hemo_w := substr(ds_json_hemo_w,1,length(ds_json_hemo_w)-2) || '},';

	end loop;
	close current_setting('cpoe_gerar_registro_json_pck.c01')::CURSOR;

	if (ds_json_hemo_w IS NOT NULL AND ds_json_hemo_w::text <> '') then
		begin
		PERFORM set_config('cpoe_gerar_registro_json_pck.ds_registro_w', format_json('DS_HEMOTERAPIA', ds_json_hemo_w), false);

					CALL cpoe_gerar_registro_json_pck.cpoe_salvar_json( 	nr_atendimento_p,
							dt_referencia_p,
							nm_usuario_p,
							'H',
							current_setting('cpoe_gerar_registro_json_pck.ds_registro_w')::text);
		end;
	end if;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cpoe_gerar_registro_json_pck.cpoe_gerar_registro_hemo_json ( nr_atendimento_p bigint, nm_usuario_p text, dt_referencia_p timestamp, nr_prescricao_p bigint default null) FROM PUBLIC;
