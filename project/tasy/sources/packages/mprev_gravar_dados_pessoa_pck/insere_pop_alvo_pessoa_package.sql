-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE mprev_gravar_dados_pessoa_pck.insere_pop_alvo_pessoa ( nr_seq_populacao_p bigint, cd_pessoa_fisica_p text, nr_seq_pop_alvo_pessoa_p INOUT bigint) AS $body$
DECLARE
 			
		nr_seq_pop_alvo_pessoa_w bigint;
	
BEGIN	
		select 	nextval('mprev_pop_alvo_pessoa_seq')
		into STRICT 	nr_seq_pop_alvo_pessoa_w
		;	

		nr_seq_pop_alvo_pessoa_p := nr_seq_pop_alvo_pessoa_w;

		insert into mprev_pop_alvo_pessoa(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					nr_seq_populacao_alvo,
					cd_pessoa_fisica,
					qt_idade_anos,
					ie_partic_programa,
					ie_grupo_controle,
					nm_pessoa,
					ie_selecionada,
					ie_sexo,
					ie_sel_temp,
					nm_pessoa_pesquisa,
					cd_municipio_ibge
		) values (
					nr_seq_pop_alvo_pessoa_w,
					clock_timestamp(),
					wheb_usuario_pck.get_nm_usuario,
					clock_timestamp(),
					wheb_usuario_pck.get_nm_usuario,
					nr_seq_populacao_p,
					cd_pessoa_fisica_p, 
					obter_dados_pf(cd_pessoa_fisica_p, 'I'), 
					CASE WHEN coalesce(mprev_obter_participante(cd_pessoa_fisica_p),0)=0 THEN 'N'  ELSE 'S' END ,
					mprev_obter_se_part_grupo_cont(cd_pessoa_fisica_p,clock_timestamp()),
					obter_nome_pf(cd_pessoa_fisica_p),
					'N',
					coalesce(obter_sexo_pf(cd_pessoa_fisica_p,'C'),'I'),
					'N',
					upper(elimina_acentuacao(obter_nome_pf(cd_pessoa_fisica_p))), 
					obter_cod_ibge_pf(cd_pessoa_fisica_p)
		);
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_gravar_dados_pessoa_pck.insere_pop_alvo_pessoa ( nr_seq_populacao_p bigint, cd_pessoa_fisica_p text, nr_seq_pop_alvo_pessoa_p INOUT bigint) FROM PUBLIC;
