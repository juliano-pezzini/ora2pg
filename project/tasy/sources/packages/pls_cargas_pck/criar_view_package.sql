-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Criar view para carga



CREATE OR REPLACE PROCEDURE pls_cargas_pck.criar_view () AS $body$
DECLARE


ds_sql_w		text;
ds_sql_1_w		varchar(32000);
ds_sql_2_w		varchar(32000);
ds_sql_3_w		varchar(32000);
ds_sql_4_w		varchar(32000);
ds_sql_5_w		varchar(32000);


BEGIN
-- Obter select para gerar VIEW

pls_convert_long_( 'PLS_CG_VIEW_REF', 'DS_SQL', 'WHERE NR_SEQ_REGRA = :NR_SEQ_REGRA', 'NR_SEQ_REGRA='||nr_seq_regra_w,ds_sql_w);

-- Montar VIEW

ds_sql_w := ' create or replace view '||nm_view_carga_w||' as '||ds_sql_w;

-- Feito isso porque no Oracle abaixo da versao 11 o "execute immediate" nao aceita CLOB, e no 11g o "execute immediate" usando to_char em CLOB nao da boa (UL)

ds_sql_1_w := substr(ds_sql_w,1,32000);
ds_sql_2_w := substr(ds_sql_w,32001,32000);
ds_sql_3_w := substr(ds_sql_w,64002,32000);
ds_sql_4_w := substr(ds_sql_w,96003,32000);
ds_sql_5_w := substr(ds_sql_w,128004,32000);

-- Criar VIEW

begin
EXECUTE to_char(ds_sql_1_w||ds_sql_2_w||ds_sql_3_w||ds_sql_4_w||ds_sql_5_w);
exception
when others then
	-- Falha na criacao da VIEW, favor verificar o select informado na regra do lote.

	CALL wheb_mensagem_pck.exibir_mensagem_abort(682665);
end;

END;	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_cargas_pck.criar_view () FROM PUBLIC;
