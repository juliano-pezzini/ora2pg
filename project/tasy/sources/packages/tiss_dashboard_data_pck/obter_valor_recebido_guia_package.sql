-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tiss_dashboard_data_pck.obter_valor_recebido_guia (nr_interno_conta_p convenio_retorno_item.nr_interno_conta%type, cd_autorizacao_p convenio_retorno_item.cd_autorizacao%type) RETURNS bigint AS $body$
DECLARE


vl_recebido_w double precision;


BEGIN

	begin
		select	sum(coalesce(a.vl_pago, 0))
		into STRICT	vl_recebido_w
		from	convenio_retorno_item a
		where	a.nr_interno_conta 	= nr_interno_conta_p
		and	coalesce(a.cd_autorizacao, wheb_mensagem_pck.get_texto(1097738)) 	= cd_autorizacao_p
		and	a.nr_seq_retorno 	in (	
							SELECT 	b.nr_sequencia
							from	convenio_retorno b,
								convenio_retorno_item c
							where	c.nr_seq_retorno 	= b.nr_sequencia
							and	c.nr_interno_conta 	= nr_interno_conta_p
							and	b.ie_status_retorno = 'F'
							and	coalesce(c.cd_autorizacao, wheb_mensagem_pck.get_texto(1097738)) 	= cd_autorizacao_p
						);
	exception
	when others then
		vl_recebido_w := 0;
	end;

	return coalesce(vl_recebido_w, 0);

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION tiss_dashboard_data_pck.obter_valor_recebido_guia (nr_interno_conta_p convenio_retorno_item.nr_interno_conta%type, cd_autorizacao_p convenio_retorno_item.cd_autorizacao%type) FROM PUBLIC;
