-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_simulacao_preco_pck.add_taxa_emissao_carteira ( nr_seq_simul_benef_p pls_simulpreco_individual.nr_sequencia%type, nr_seq_contrato_p pls_contrato.nr_sequencia%type, nr_seq_produto_p pls_plano.nr_sequencia%type, vl_simulacao_produto_p bigint) AS $body$
DECLARE

	nr_seq_regra_w		pls_regra_segurado_cart.nr_sequencia%type;
	vl_via_carteira_ww	pls_regra_segurado_cart.vl_via_adicional%type;
	tx_via_carteira_w	pls_regra_segurado_cart.tx_via_adicional%type;
	vl_via_carteira_w	double precision;
	
BEGIN
		pls_obter_regra_via_adic(nr_seq_contrato_p, null, nr_seq_produto_p, 1, 'N', current_setting('pls_simulacao_preco_pck.nm_usuario_w')::usuario.nm_usuario%type, current_setting('pls_simulacao_preco_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type,
						clock_timestamp(), nr_seq_regra_w, vl_via_carteira_ww, tx_via_carteira_w);
		
		if (coalesce(tx_via_carteira_w,0) <> 0) then
			vl_via_carteira_w := dividir((vl_simulacao_produto_p * tx_via_carteira_w), 100);
		elsif (coalesce(vl_via_carteira_ww,0) <> 0) then
			vl_via_carteira_w := vl_via_carteira_ww;
		end if;
		
		if (vl_via_carteira_w > 0) then
			CALL CALL pls_simulacao_preco_pck.add_item(wheb_mensagem_pck.get_texto(1128248), vl_via_carteira_w, nr_seq_simul_benef_p, null, '11');
		end if;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_simulacao_preco_pck.add_taxa_emissao_carteira ( nr_seq_simul_benef_p pls_simulpreco_individual.nr_sequencia%type, nr_seq_contrato_p pls_contrato.nr_sequencia%type, nr_seq_produto_p pls_plano.nr_sequencia%type, vl_simulacao_produto_p bigint) FROM PUBLIC;
