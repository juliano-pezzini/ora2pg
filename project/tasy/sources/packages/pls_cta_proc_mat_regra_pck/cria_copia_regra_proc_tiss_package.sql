-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_cta_proc_mat_regra_pck.cria_copia_regra_proc_tiss ( nr_seq_conta_proc_origem_p pls_conta_proc.nr_sequencia%type, nr_seq_conta_proc_destino_p pls_conta_proc.nr_sequencia%type, ie_somente_se_tiss_inf_p text, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Gera um novo registro caso o mesmo nao exista, e entao atualiza o mesmo com o sequencial tiss do
		item origem.
		
		Caso o ie_somente_se_tiss_inf_p vier como 'S', entao so sera gerado o novo registro caso o original
		tenha o sequencial tiss informado
		
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de atencao: 

Alteracoes:

------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


nr_seq_item_tiss_w		pls_conta_proc_regra.nr_seq_item_tiss%type;
nr_seq_item_tiss_vinculo_w	pls_conta_proc_regra.nr_seq_item_tiss_vinculo%type;


BEGIN

select	max(a.nr_seq_item_tiss),
	max(a.nr_seq_item_tiss_vinculo)
into STRICT	nr_seq_item_tiss_w,
	nr_seq_item_tiss_vinculo_w
from	pls_conta_proc_regra	a
where	a.nr_sequencia		= nr_seq_conta_proc_origem_p;

if	(ie_somente_se_tiss_inf_p = 'S' AND nr_seq_item_tiss_w IS NOT NULL AND nr_seq_item_tiss_w::text <> '') or (ie_somente_se_tiss_inf_p = 'N') then
	
	CALL pls_cta_proc_mat_regra_pck.cria_registro_regra_proc(nr_seq_conta_proc_destino_p, nm_usuario_p);
	CALL pls_cta_proc_mat_regra_pck.atualiza_seq_tiss_proc(nr_seq_conta_proc_destino_p, nr_seq_item_tiss_w, nr_seq_item_tiss_vinculo_w, nm_usuario_p);
	
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_cta_proc_mat_regra_pck.cria_copia_regra_proc_tiss ( nr_seq_conta_proc_origem_p pls_conta_proc.nr_sequencia%type, nr_seq_conta_proc_destino_p pls_conta_proc.nr_sequencia%type, ie_somente_se_tiss_inf_p text, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
