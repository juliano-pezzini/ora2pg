-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_cta_proc_mat_regra_pck.cria_registro_regra_mat_tb ( tb_nr_seq_conta_mat_p INOUT dbms_sql.number_table, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


tb_nr_seq_conta_mat_w	dbms_sql.number_table;

j			integer;
qt_registro_w		integer;

-- carrega os registros do vetor que ainda nao existem na tabela

/* COMPATIBILIDADE 10G 
cursor	c01(	tb_nr_seq_conta_mat_pc	dbms_sql.number_table) is
	select	distinct a.column_value,
		(select count(1) from pls_conta_mat_regra x where x.nr_sequencia = a.column_value) qt_existente
	from	table(tb_nr_seq_conta_mat_pc)	a;
*/

BEGIN

j := 0;
tb_nr_seq_conta_mat_w.delete;

for i in tb_nr_seq_conta_mat_p.first..tb_nr_seq_conta_mat_p.last loop

	-- feito a verificacao externa por conta da compatibilidade com o oracle 10g

	select	count(1)
	into STRICT	qt_registro_w
	from	pls_conta_mat_regra	a
	where	a.nr_sequencia		= tb_nr_seq_conta_mat_p(i);
	
	if (qt_registro_w = 0) then
	
		tb_nr_seq_conta_mat_w(j) := tb_nr_seq_conta_mat_p(i);
		j := j + 1;
	end if;
end loop;

if (tb_nr_seq_conta_mat_w.count > 0) then

	tb_nr_seq_conta_mat_w := pls_cta_proc_mat_regra_pck.grava_registro_regra_mat(tb_nr_seq_conta_mat_w, nm_usuario_p);
end if;


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_cta_proc_mat_regra_pck.cria_registro_regra_mat_tb ( tb_nr_seq_conta_mat_p INOUT dbms_sql.number_table, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
