-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_smp_pck.utilizar_valor_regra ( nr_seq_result_regra_p pls_smp_result_regra.nr_sequencia%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	passar a utilizar o valor da regra selecionada
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:
Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
nr_seq_smp_item_w	pls_smp_result_item.nr_sequencia%type;
vl_simulacao_w		pls_smp_result_item.vl_simulacao%type;

BEGIN

-- Apenas se tiver regra informada
if (nr_seq_result_regra_p IS NOT NULL AND nr_seq_result_regra_p::text <> '') then
	begin
		select	nr_seq_smp_result_regra,
			coalesce(vl_simulacao,0)
		into STRICT	nr_seq_smp_item_w,
			vl_simulacao_w
		from	pls_smp_result_regra
		where	nr_sequencia	= nr_seq_result_regra_p;
	exception
		when no_data_found then
			nr_seq_smp_item_w	:= null;
			vl_simulacao_w		:= null;
	end;
	
	if (nr_seq_smp_item_w IS NOT NULL AND nr_seq_smp_item_w::text <> '') and (vl_simulacao_w IS NOT NULL AND vl_simulacao_w::text <> '') then
		update	pls_smp_result_item
		set	vl_simulacao	= vl_simulacao_w * coalesce(qt_item,0)
		where	nr_sequencia	= nr_seq_smp_item_w;
		commit;
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_smp_pck.utilizar_valor_regra ( nr_seq_result_regra_p pls_smp_result_regra.nr_sequencia%type) FROM PUBLIC;
