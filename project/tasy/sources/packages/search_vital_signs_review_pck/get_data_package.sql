-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION search_vital_signs_review_pck.get_data ( nr_cirurgia_p bigint, nr_seq_pepo_p bigint, ie_integracao_p text, ie_tipo_sinal_p text, nm_campo_p text, nm_usuario_integracao_p text, ie_situacao_p text default 'T') RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE

							
t_objeto_row_w		t_objeto_row;
nr_seq_pepo_ww		bigint;
dt_inicio_cirurgia_w 	timestamp;
dt_fim_cirurgia_w 		timestamp;
dt_horario_livre_w 		timestamp;
insert_row boolean;


c_vital_signs CURSOR FOR
SELECT  DT_SINAL_VITAL DT_SINAL,		
	    0 QT_VMIN,
        0 QT_VCI,  
        0 QT_SAT_VENOSA_O2, 
        0 QT_PIP, 
        0 QT_PEEP, 
        0 QT_OXIG_INS, 
        0 QT_OXIDO_NITROSO_INSP,  
        0 QT_HALOG_INS, 
        0 QT_HALOG_EXP, 
        0 QT_FREQ_VENT,  
        0 QT_FIO2,  
        0 QT_CO2, 
        0 QT_CAM, 
        null IE_RESPIRACAO,  
        0 IE_HALOG_TIPO,
        null CD_MOD_VENT,         
        QT_TOF_BLOQ_NEURO_MUSC, 
        QT_TEMP, 
        QT_SPO2R, 
        QT_SEGMENTO_ST,  
        QT_SATURACAO_O2,
        QT_PVC,
        QT_PRESSAO_INTRA_CRANIO,
        QT_PRESSAO_INTRA_ABD,        
        QT_PA_SISTOLICA,
        QT_PAM,
        QT_PAE,
        QT_PA_DIASTOLICA,
        QT_MAEC,
        QT_GLICEMIA_MMOL,
        QT_GLICEMIA_CAPILAR,
        QT_FREQ_RESP,
        QT_FREQ_CARD_MONIT,
        QT_FREQ_CARDIACA,
        QT_ESCALA_DOR,
        QT_BCF,
        IE_SITIO,
        IE_RITMO_ECG,
        IE_APARELHO_PA,        
        0 QT_VVS,
        0 QT_VOLUME_SIST, 
        0 QT_SPHB, 
        0 QT_PVI,  
        0 QT_PA_SIST_AP, 
        0 QT_PA_OCLUIDA_AP, 
        0 QT_PA_DIAST_AP,
        0 QT_DELTA_PP, 
        0 QT_DEBITO_CARD,
		0 QT_BE,      
		0 QT_CA,      
		0 QT_CLORO,   
		0 QT_CO2_BIOQ,
		0 QT_GLICOSE, 
		0 QT_HB,      
		0 QT_HCO3,    
		0 QT_HT,      
		0 QT_K,       
		0 QT_LACTATO, 
		0 QT_MG,      
		0 QT_NA,      
		0 QT_PCO2,   
		0 QT_PH,      
		0 QT_PO2,     
		0 QT_SATO2,   
		0 QT_TCA,
		0 QT_BIS_L,  
		0 QT_BIS_R,  
		0 QT_SQI_L,  
		0 QT_SQI_R,  
		0 QT_EMG_L,  
		0 QT_EMG_R,  
		0 QT_SR_L,  
		0 QT_SR_R,   
		0 QT_SEF_L,  
		0 QT_SEF_R, 
		0 QT_TP_L,   
		0 QT_TP_R,   
		0 QT_BURST_L,
		0 QT_BURST_R,		
	NM_USUARIO,
	NR_SEQUENCIA NR_SEQ_SINAL_VITAL,
	0 NR_SEQ_MONIT_RESP,
	0 NR_SEQ_MONIT_HEMOD,
	0 NR_SEQ_ANAL_BIOQ,
	0 NR_SEQ_AVAL_ANAL,	
	IE_INTEGRACAO,
	CASE IE_INTEGRACAO WHEN 'S' THEN OBTER_DESC_EXPRESSAO(289356)||'  '|| NM_USUARIO ELSE OBTER_DESC_EXPRESSAO(304945) END  AS
	IE_TIPO_LANCAMENTO,
	'S' as IE_TIPO_SINAL,
	a.DT_LIBERACAO,
	a.IE_SITUACAO
FROM ATENDIMENTO_SINAL_VITAL a
where ((ie_situacao_p = 'L' and coalesce(a.dt_liberacao::text, '') = '' and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'I' and (a.dt_inativacao IS NOT NULL AND a.dt_inativacao::text <> '')) or (ie_situacao_p = 'V' and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'T'))
 and ((ie_integracao_p = 'A')
		or (ie_integracao_p = 'N' and coalesce(a.ie_integracao, 'N') = 'N')
        or (ie_integracao_p = 'S' and coalesce(a.ie_integracao, 'N') = 'S'))
	  and	(((coalesce(nr_cirurgia_p,0) > 0) and (a.nr_cirurgia = nr_cirurgia_p)) 
	  or	((coalesce(nr_seq_pepo_p,0) > 0)  and (a.nr_seq_pepo = nr_seq_pepo_p)) 
	  or	((coalesce(nr_seq_pepo_ww,0) > 0) and (a.nr_seq_pepo = nr_seq_pepo_ww)))
          and (coalesce(nm_usuario_integracao_p::text, '') = '' or nm_usuario_integracao_p = a.nm_usuario)
	  and ('S' = ie_tipo_sinal_p)

UNION
       
SELECT  DT_MONITORIZACAO DT_SINAL,
		QT_VMIN, 
        QT_VCI,  
        QT_SAT_VENOSA_O2, 
        QT_PIP, 
        QT_PEEP, 
        QT_OXIG_INS, 
        QT_OXIDO_NITROSO_INSP,  
        QT_HALOG_INS, 
        QT_HALOG_EXP, 
        QT_FREQ_VENT,  
        QT_FIO2,  
        QT_CO2, 
        QT_CAM, 
        IE_RESPIRACAO,  
        IE_HALOG_TIPO,
        CD_MOD_VENT,        
        0 QT_TOF_BLOQ_NEURO_MUSC, 
        0 QT_TEMP, 
        0 QT_SPO2R, 
        0 QT_SEGMENTO_ST,  
        0 QT_SATURACAO_O2, 
        0 QT_PVC, 
        0 QT_PRESSAO_INTRA_CRANIO, 
        0 QT_PRESSAO_INTRA_ABD, 
        0 QT_PA_SISTOLICA, 
        0 QT_PAM,
        0 QT_PAE,
        0 QT_PA_DIASTOLICA, 
        0 QT_MAEC, 
        0 QT_GLICEMIA_MMOL, 
        0 QT_GLICEMIA_CAPILAR, 
        0 QT_FREQ_RESP, 
        0 QT_FREQ_CARD_MONIT, 
        0 QT_FREQ_CARDIACA, 
        0 QT_ESCALA_DOR, 
        0 QT_BCF, 
        0 IE_SITIO, 
        null IE_RITMO_ECG, 
        null IE_APARELHO_PA,         
        0 QT_VVS,
        0 QT_VOLUME_SIST, 
        0 QT_SPHB, 
        0 QT_PVI,  
        0 QT_PA_SIST_AP, 
        0 QT_PA_OCLUIDA_AP, 
        0 QT_PA_DIAST_AP,
        0 QT_DELTA_PP, 
        0 QT_DEBITO_CARD,
		0 QT_BE,      
		0 QT_CA,      
		0 QT_CLORO,   
		0 QT_CO2_BIOQ,
		0 QT_GLICOSE, 
		0 QT_HB,      
		0 QT_HCO3,    
		0 QT_HT,      
		0 QT_K,       
		0 QT_LACTATO, 
		0 QT_MG,      
		0 QT_NA,      
		0 QT_PCO2,   
		0 QT_PH,      
		0 QT_PO2,     
		0 QT_SATO2,   
		0 QT_TCA,
		0 QT_BIS_L,  
		0 QT_BIS_R,  
		0 QT_SQI_L,  
		0 QT_SQI_R,  
		0 QT_EMG_L,  
		0 QT_EMG_R,  
		0 QT_SR_L,  
		0 QT_SR_R,   
		0 QT_SEF_L,  
		0 QT_SEF_R, 
		0 QT_TP_L,   
		0 QT_TP_R,   
		0 QT_BURST_L,
		0 QT_BURST_R,		
	NM_USUARIO,
	0 NR_SEQ_SINAL_VITAL,
	NR_SEQUENCIA  NR_SEQ_MONIT_RESP,
	0 NR_SEQ_MONIT_HEMOD,
	0 NR_SEQ_ANAL_BIOQ,
	0 NR_SEQ_AVAL_ANAL,
	IE_INTEGRACAO,
	CASE IE_INTEGRACAO WHEN 'S' THEN OBTER_DESC_EXPRESSAO(289356)||'  '|| NM_USUARIO ELSE OBTER_DESC_EXPRESSAO(304945) END  AS IE_TIPO_LANCAMENTO,
	'R' as IE_TIPO_SINAL,
	a.DT_LIBERACAO,
	a.IE_SITUACAO	
FROM ATENDIMENTO_MONIT_RESP a
where ((ie_situacao_p = 'L' and coalesce(a.dt_liberacao::text, '') = '' and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'I' and (a.dt_inativacao IS NOT NULL AND a.dt_inativacao::text <> '')) or (ie_situacao_p = 'V' and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'T'))
	  and   ((ie_integracao_p = 'A')
          or (ie_integracao_p = 'N' and coalesce(a.ie_integracao, 'N') = 'N')
          or (ie_integracao_p = 'S' and coalesce(a.ie_integracao, 'N') = 'S'))
	  and	(((coalesce(nr_cirurgia_p,0) > 0) and (a.nr_cirurgia = nr_cirurgia_p)) 
	  or	((coalesce(nr_seq_pepo_p,0) > 0)  and (a.nr_seq_pepo = nr_seq_pepo_p)) 
		or	((coalesce(nr_seq_pepo_ww,0) > 0) and (a.nr_seq_pepo = nr_seq_pepo_ww)))
	  and (coalesce(nm_usuario_integracao_p::text, '') = '' or nm_usuario_integracao_p = a.nm_usuario)
	  and ('R' = ie_tipo_sinal_p)

UNION

SELECT  DT_MONITORACAO DT_SINAL,
		0 QT_VMIN, 
        0 QT_VCI,  
        0 QT_SAT_VENOSA_O2, 
        0 QT_PIP, 
        0 QT_PEEP, 
        0 QT_OXIG_INS, 
        0 QT_OXIDO_NITROSO_INSP,  
        0 QT_HALOG_INS, 
        0 QT_HALOG_EXP, 
        0 QT_FREQ_VENT,  
        0 QT_FIO2,  
        0 QT_CO2, 
        0 QT_CAM, 
        null IE_RESPIRACAO,  
        0 IE_HALOG_TIPO,
        null CD_MOD_VENT,       
        0 QT_TOF_BLOQ_NEURO_MUSC, 
        0 QT_TEMP, 
        0 QT_SPO2R, 
        0 QT_SEGMENTO_ST,  
        0 QT_SATURACAO_O2, 
        0 QT_PVC, 
        0 QT_PRESSAO_INTRA_CRANIO, 
        0 QT_PRESSAO_INTRA_ABD, 
        0 QT_PA_SISTOLICA, 
        0 QT_PAM,
        0 QT_PAE,
        0 QT_PA_DIASTOLICA, 
        0 QT_MAEC, 
        0 QT_GLICEMIA_MMOL, 
        0 QT_GLICEMIA_CAPILAR, 
        0 QT_FREQ_RESP, 
        0 QT_FREQ_CARD_MONIT, 
        0 QT_FREQ_CARDIACA, 
        0 QT_ESCALA_DOR, 
        0 QT_BCF, 
        0 IE_SITIO, 
        null IE_RITMO_ECG, 
        null IE_APARELHO_PA,         
        QT_VVS,
        QT_VOLUME_SIST, 
        QT_SPHB, 
        QT_PVI,  
        QT_PA_SIST_AP, 
        QT_PA_OCLUIDA_AP, 
        QT_PA_DIAST_AP,
        QT_DELTA_PP, 
        QT_DEBITO_CARD,
		0 QT_BE,      
		0 QT_CA,      
		0 QT_CLORO,   
		0 QT_CO2_BIOQ,
		0 QT_GLICOSE, 
		0 QT_HB,      
		0 QT_HCO3,    
		0 QT_HT,      
		0 QT_K,       
		0 QT_LACTATO, 
		0 QT_MG,      
		0 QT_NA,      
		0 QT_PCO2,   
		0 QT_PH,      
		0 QT_PO2,     
		0 QT_SATO2,   
		0 QT_TCA,
		0 QT_BIS_L,  
		0 QT_BIS_R,  
		0 QT_SQI_L,  
		0 QT_SQI_R,  
		0 QT_EMG_L,  
		0 QT_EMG_R,  
		0 QT_SR_L,  
		0 QT_SR_R,   
		0 QT_SEF_L,  
		0 QT_SEF_R, 
		0 QT_TP_L,   
		0 QT_TP_R,   
		0 QT_BURST_L,
		0 QT_BURST_R,		
	NM_USUARIO,
	0 NR_SEQ_SINAL_VITAL,
	0  NR_SEQ_MONIT_RESP,
	NR_SEQUENCIA NR_SEQ_MONIT_HEMOD,
	0 NR_SEQ_ANAL_BIOQ,
	0 NR_SEQ_AVAL_ANAL,
	IE_INTEGRACAO,
	CASE IE_INTEGRACAO WHEN 'S' THEN OBTER_DESC_EXPRESSAO(289356)||'  '|| NM_USUARIO ELSE OBTER_DESC_EXPRESSAO(304945) END  AS IE_TIPO_LANCAMENTO,
	'H' as IE_TIPO_SINAL,
	a.DT_LIBERACAO,
	a.IE_SITUACAO	
FROM ATEND_MONIT_HEMOD a
where ((ie_situacao_p = 'L' and coalesce(a.dt_liberacao::text, '') = '' and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'I' and (a.dt_inativacao IS NOT NULL AND a.dt_inativacao::text <> '')) or (ie_situacao_p = 'V' and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'T'))
	  and   ((ie_integracao_p = 'A')
          or (ie_integracao_p = 'N' and coalesce(a.ie_integracao, 'N') = 'N')
          or (ie_integracao_p = 'S' and coalesce(a.ie_integracao, 'N') = 'S'))
	  and	(((coalesce(nr_cirurgia_p,0) > 0) and (a.nr_cirurgia = nr_cirurgia_p)) 
	  or	((coalesce(nr_seq_pepo_p,0) > 0)  and (a.nr_seq_pepo = nr_seq_pepo_p)) 
	  or	((coalesce(nr_seq_pepo_ww,0) > 0) and (a.nr_seq_pepo = nr_seq_pepo_ww)))
          and (coalesce(nm_usuario_integracao_p::text, '') = '' or nm_usuario_integracao_p = a.nm_usuario)
	  and ('H' = ie_tipo_sinal_p)

union

SELECT  DT_ANALISE DT_SINAL,
		0 QT_VMIN, 
        0 QT_VCI,  
        0 QT_SAT_VENOSA_O2, 
        0 QT_PIP, 
        0 QT_PEEP, 
        0 QT_OXIG_INS, 
        0 QT_OXIDO_NITROSO_INSP,  
        0 QT_HALOG_INS, 
        0 QT_HALOG_EXP, 
        0 QT_FREQ_VENT,  
        0 QT_FIO2,  
        0 QT_CO2, 
        0 QT_CAM, 
        null IE_RESPIRACAO,  
        0 IE_HALOG_TIPO,
        null CD_MOD_VENT,       
        0 QT_TOF_BLOQ_NEURO_MUSC, 
        0 QT_TEMP, 
        0 QT_SPO2R, 
        0 QT_SEGMENTO_ST,  
        0 QT_SATURACAO_O2, 
        0 QT_PVC, 
        0 QT_PRESSAO_INTRA_CRANIO, 
        0 QT_PRESSAO_INTRA_ABD, 
        0 QT_PA_SISTOLICA, 
        0 QT_PAM,
        0 QT_PAE,
        0 QT_PA_DIASTOLICA, 
        0 QT_MAEC, 
        0 QT_GLICEMIA_MMOL, 
        0 QT_GLICEMIA_CAPILAR, 
        0 QT_FREQ_RESP, 
        0 QT_FREQ_CARD_MONIT, 
        0 QT_FREQ_CARDIACA, 
        0 QT_ESCALA_DOR, 
        0 QT_BCF, 
        0 IE_SITIO, 
        null IE_RITMO_ECG, 
        null IE_APARELHO_PA,         
        0 QT_VVS,
        0 QT_VOLUME_SIST, 
        0 QT_SPHB, 
        0 QT_PVI,  
        0 QT_PA_SIST_AP, 
        0 QT_PA_OCLUIDA_AP, 
        0 QT_PA_DIAST_AP,
        0 QT_DELTA_PP, 
        0 QT_DEBITO_CARD,
		QT_BE,      
		QT_CA,      
		QT_CLORO,   
		QT_CO2 QT_CO2_BIOQ,
		QT_GLICOSE, 
		QT_HB,      
		QT_HCO3,    
		QT_HT,      
		QT_K,       
		QT_LACTATO, 
		QT_MG,      
		QT_NA,      
		QT_PCO2,   
		QT_PH,      
		QT_PO2,     
		QT_SATO2,   
		QT_TCA, 
		0 QT_BIS_L,  
		0 QT_BIS_R,  
		0 QT_SQI_L,  
		0 QT_SQI_R,  
		0 QT_EMG_L,  
		0 QT_EMG_R,  
		0 QT_SR_L,  
		0 QT_SR_R,   
		0 QT_SEF_L,  
		0 QT_SEF_R, 
		0 QT_TP_L,   
		0 QT_TP_R,   
		0 QT_BURST_L,
		0 QT_BURST_R,
	NM_USUARIO,
	0 NR_SEQ_SINAL_VITAL,
	0 NR_SEQ_MONIT_RESP,
	0 NR_SEQ_MONIT_HEMOD,
	NR_SEQUENCIA NR_SEQ_ANAL_BIOQ,
	0 NR_SEQ_AVAL_ANAL,
	null IE_INTEGRACAO,
	OBTER_DESC_EXPRESSAO(304945) AS IE_TIPO_LANCAMENTO,
	'B' as IE_TIPO_SINAL,
	a.DT_LIBERACAO,
	a.IE_SITUACAO	
FROM ATEND_ANAL_BIOQ_PORT a
where ((ie_situacao_p = 'L' and coalesce(a.dt_liberacao::text, '') = '' and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'I' and (a.dt_inativacao IS NOT NULL AND a.dt_inativacao::text <> '')) or (ie_situacao_p = 'V' and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'T'))
	  and	(((coalesce(nr_cirurgia_p,0) > 0) and (a.nr_cirurgia = nr_cirurgia_p)) 
	  or	((coalesce(nr_seq_pepo_p,0) > 0)  and (a.nr_seq_pepo = nr_seq_pepo_p)) 
	  or	((coalesce(nr_seq_pepo_ww,0) > 0) and (a.nr_seq_pepo = nr_seq_pepo_ww)))
          and (coalesce(nm_usuario_integracao_p::text, '') = '' or nm_usuario_integracao_p = a.nm_usuario)
	  and ('B' = ie_tipo_sinal_p)

union

SELECT  DT_AVALIACAO DT_SINAL,
		0 QT_VMIN, 
        0 QT_VCI,  
        0 QT_SAT_VENOSA_O2, 
        0 QT_PIP, 
        0 QT_PEEP, 
        0 QT_OXIG_INS, 
        0 QT_OXIDO_NITROSO_INSP,  
        0 QT_HALOG_INS, 
        0 QT_HALOG_EXP, 
        0 QT_FREQ_VENT,  
        0 QT_FIO2,  
        0 QT_CO2, 
        0 QT_CAM, 
        null IE_RESPIRACAO,  
        0 IE_HALOG_TIPO,
        null CD_MOD_VENT,       
        0 QT_TOF_BLOQ_NEURO_MUSC, 
        0 QT_TEMP, 
        0 QT_SPO2R, 
        0 QT_SEGMENTO_ST,  
        0 QT_SATURACAO_O2, 
        0 QT_PVC, 
        0 QT_PRESSAO_INTRA_CRANIO, 
        0 QT_PRESSAO_INTRA_ABD, 
        0 QT_PA_SISTOLICA, 
        0 QT_PAM,
        0 QT_PAE,
        0 QT_PA_DIASTOLICA, 
        0 QT_MAEC, 
        0 QT_GLICEMIA_MMOL, 
        0 QT_GLICEMIA_CAPILAR, 
        0 QT_FREQ_RESP, 
        0 QT_FREQ_CARD_MONIT, 
        0 QT_FREQ_CARDIACA, 
        0 QT_ESCALA_DOR, 
        0 QT_BCF, 
        0 IE_SITIO, 
        null IE_RITMO_ECG, 
        null IE_APARELHO_PA,         
        0 QT_VVS,
        0 QT_VOLUME_SIST, 
        0 QT_SPHB, 
        0 QT_PVI,  
        0 QT_PA_SIST_AP, 
        0 QT_PA_OCLUIDA_AP, 
        0 QT_PA_DIAST_AP,
        0 QT_DELTA_PP, 
        0 QT_DEBITO_CARD,
		0 QT_BE,      
		0 QT_CA,      
		0 QT_CLORO,   
		0 QT_CO2_BIOQ,
		0 QT_GLICOSE, 
		0 QT_HB,      
		0 QT_HCO3,    
		0 QT_HT,      
		0 QT_K,       
		0 QT_LACTATO, 
		0 QT_MG,      
		0 QT_NA,      
		0 QT_PCO2,   
		0 QT_PH,      
		0 QT_PO2,     
		0 QT_SATO2,   
		0 QT_TCA,
		QT_BIS_L,  
		QT_BIS_R,  
		QT_SQI_L,  
		QT_SQI_R,  
		QT_EMG_L,  
		QT_EMG_R,  
		QT_SR_L,  
		QT_SR_R,   
		QT_SEF_L,  
		QT_SEF_R, 
		QT_TP_L,   
		QT_TP_R,   
		QT_BURST_L,
		QT_BURST_R,
	NM_USUARIO,
	0 NR_SEQ_SINAL_VITAL,
	0 NR_SEQ_MONIT_RESP,
	0 NR_SEQ_MONIT_HEMOD,
	0 NR_SEQ_ANAL_BIOQ,
	NR_SEQUENCIA NR_SEQ_AVAL_ANAL,
	IE_INTEGRACAO,
	CASE IE_INTEGRACAO WHEN 'S' THEN OBTER_DESC_EXPRESSAO(289356)||'  '|| NM_USUARIO ELSE OBTER_DESC_EXPRESSAO(304945) END AS IE_TIPO_LANCAMENTO,
	'A' as IE_TIPO_SINAL,
	a.DT_LIBERACAO,
	a.IE_SITUACAO		
FROM ATEND_AVAL_ANALGESIA a
where ((ie_situacao_p = 'L' and coalesce(a.dt_liberacao::text, '') = '' and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'I' and (a.dt_inativacao IS NOT NULL AND a.dt_inativacao::text <> '')) or (ie_situacao_p = 'V' and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') and coalesce(a.dt_inativacao::text, '') = '') or (ie_situacao_p = 'T')) 
	and   ((ie_integracao_p = 'A')
      or (ie_integracao_p = 'N' and coalesce(a.ie_integracao, 'N') = 'N')
      or (ie_integracao_p = 'S' and coalesce(a.ie_integracao, 'N') = 'S'))
	  and	(((coalesce(nr_cirurgia_p,0) > 0) and ((a.nr_atendimento = (select nr_atendimento from cirurgia where nr_cirurgia = nr_cirurgia_p)))) 
	  or	((coalesce(nr_seq_pepo_p,0) > 0)  and (a.nr_seq_pepo = nr_seq_pepo_p)) 
	  or	((coalesce(nr_seq_pepo_ww,0) > 0) and (a.nr_seq_pepo = nr_seq_pepo_ww)))
          and (coalesce(nm_usuario_integracao_p::text, '') = '' or nm_usuario_integracao_p = a.nm_usuario)
	  and ('A' = ie_tipo_sinal_p);	
BEGIN
if (coalesce(nr_cirurgia_p,0) > 0) and (coalesce(nr_seq_pepo_p,0) = 0) then
	select	max(nr_seq_pepo)
	into STRICT	nr_seq_pepo_ww
	from	cirurgia
	where	nr_cirurgia = nr_cirurgia_p;
end if;	


<<montar_lista>>
for r_vital_signs in c_vital_signs
	loop
	insert_row := false;
	if (coalesce(nm_campo_p::text, '') = '')then
		insert_row :=true;
	elsif ( nm_campo_p ='CD_MOD_VENT') and (r_vital_signs.CD_MOD_VENT IS NOT NULL AND r_vital_signs.CD_MOD_VENT::text <> '') then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_CAM') and (r_vital_signs.QT_CAM > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_CO2') and (r_vital_signs.QT_CO2 > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_FIO2') and (r_vital_signs.QT_FIO2 > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_FREQ_VENT') and (r_vital_signs.QT_FREQ_VENT > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_HALOG_EXP') and (r_vital_signs.QT_HALOG_EXP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_HALOG_INS') and (r_vital_signs.QT_HALOG_INS > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_OXIDO_NITROSO_INSP') and (r_vital_signs.QT_OXIDO_NITROSO_INSP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_OXIG_INS') and (r_vital_signs.QT_OXIG_INS > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PEEP') and (r_vital_signs.QT_PEEP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PIP') and (r_vital_signs.QT_PIP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SAT_VENOSA_O2') and (r_vital_signs.QT_SAT_VENOSA_O2 > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_VCI') and (r_vital_signs.QT_VCI > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_VMIN') and (r_vital_signs.QT_VMIN > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='DT_SINAL') and (r_vital_signs.DT_SINAL IS NOT NULL AND r_vital_signs.DT_SINAL::text <> '') then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_BCF') and (r_vital_signs.QT_BCF > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_ESCALA_DOR') and (r_vital_signs.QT_ESCALA_DOR > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_FREQ_CARDIACA') and (r_vital_signs.QT_FREQ_CARDIACA > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_FREQ_CARD_MONIT') and (r_vital_signs.QT_FREQ_CARD_MONIT > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_FREQ_RESP') and (r_vital_signs.QT_FREQ_RESP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_GLICEMIA_CAPILAR') and (r_vital_signs.QT_GLICEMIA_CAPILAR > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_GLICEMIA_MMOL') and (r_vital_signs.QT_GLICEMIA_MMOL > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_MAEC') and (r_vital_signs.QT_MAEC > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PAE') and (r_vital_signs.QT_PAE > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PAM') and (r_vital_signs.QT_PAM > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PA_DIASTOLICA') and (r_vital_signs.QT_PA_DIASTOLICA > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PA_SISTOLICA') and (r_vital_signs.QT_PA_SISTOLICA > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PRESSAO_INTRA_ABD') and (r_vital_signs.QT_PRESSAO_INTRA_ABD > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PRESSAO_INTRA_CRANIO') and (r_vital_signs.QT_PRESSAO_INTRA_CRANIO > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PVC') and (r_vital_signs.QT_PVC > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SATURACAO_O2') and (r_vital_signs.QT_SATURACAO_O2 > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SEGMENTO_ST') and (r_vital_signs.QT_SEGMENTO_ST > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SPO2R') and (r_vital_signs.QT_SPO2R > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_TEMP') and (r_vital_signs.QT_TEMP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_TOF_BLOQ_NEURO_MUSC') and (r_vital_signs.QT_TOF_BLOQ_NEURO_MUSC > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_DEBITO_CARD') and (r_vital_signs.QT_DEBITO_CARD > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_DELTA_PP') and (r_vital_signs.QT_DELTA_PP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PA_DIAST_AP') and (r_vital_signs.QT_PA_DIAST_AP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PA_OCLUIDA_AP') and (r_vital_signs.QT_PA_OCLUIDA_AP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PA_SIST_AP') and (r_vital_signs.QT_PA_SIST_AP > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PVI') and (r_vital_signs.QT_PVI > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SPHB') and (r_vital_signs.QT_SPHB > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_VOLUME_SIST') and (r_vital_signs.QT_VOLUME_SIST > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p = 'IE_HALOG_TIPO') and (r_vital_signs.IE_HALOG_TIPO > 0 ) then
		insert_row := true;
	elsif ( nm_campo_p = 'IE_RESPIRACAO') and (r_vital_signs.IE_RESPIRACAO IS NOT NULL AND r_vital_signs.IE_RESPIRACAO::text <> '')then
		insert_row := true;
	elsif ( nm_campo_p = 'IE_APARELHO_PA') and (r_vital_signs.IE_APARELHO_PA IS NOT NULL AND r_vital_signs.IE_APARELHO_PA::text <> '')then
		insert_row := true;
	elsif ( nm_campo_p = 'IE_RITMO_ECG') and (r_vital_signs.IE_RITMO_ECG IS NOT NULL AND r_vital_signs.IE_RITMO_ECG::text <> '')then
		insert_row := true;
	elsif ( nm_campo_p = 'IE_SITIO') and (r_vital_signs.IE_SITIO IS NOT NULL AND r_vital_signs.IE_SITIO::text <> '')then
		insert_row := true;		
	elsif ( nm_campo_p ='QT_VVS') and (r_vital_signs.QT_VVS > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_VVS') and (r_vital_signs.QT_VVS > 0 ) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_BE') and (r_vital_signs.QT_BE > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_CA') and (r_vital_signs.QT_CA > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_CLORO') and (r_vital_signs.QT_CLORO > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_CO2') and (r_vital_signs.QT_CO2_BIOQ > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_GLICOSE') and (r_vital_signs.QT_GLICOSE > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_HB') and (r_vital_signs.QT_HB > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_HCO3') and (r_vital_signs.QT_HCO3 > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_HT') and (r_vital_signs.QT_HT > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_K') and (r_vital_signs.QT_K > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_LACTATO') and (r_vital_signs.QT_LACTATO > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_MG') and (r_vital_signs.QT_MG > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_NA') and (r_vital_signs.QT_NA > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PCO2') and (r_vital_signs.QT_PCO2 > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PH') and (r_vital_signs.QT_PH > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_PO2') and (r_vital_signs.QT_PO2 > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SATO2') and (r_vital_signs.QT_SATO2 > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_TCA') and (r_vital_signs.QT_TCA > 0) then
		insert_row :=true;
	
	elsif ( nm_campo_p ='QT_BIS_L') and (r_vital_signs.QT_BIS_L > 0) then
		insert_row :=true;	
	elsif ( nm_campo_p ='QT_BIS_R') and (r_vital_signs.QT_BIS_R > 0) then
		insert_row :=true;	
	elsif ( nm_campo_p ='QT_SQI_L') and (r_vital_signs.QT_SQI_L > 0) then
		insert_row :=true;	
	elsif ( nm_campo_p ='QT_SQI_R') and (r_vital_signs.QT_SQI_R > 0) then
		insert_row :=true;	
	elsif ( nm_campo_p ='QT_EMG_L') and (r_vital_signs.QT_EMG_L > 0) then
		insert_row :=true;	
	elsif ( nm_campo_p ='QT_EMG_R') and (r_vital_signs.QT_EMG_R > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SR_L') and (r_vital_signs.QT_SR_L > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SR_R') and (r_vital_signs.QT_SR_R > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SEF_L') and (r_vital_signs.QT_SEF_L > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_SEF_R') and (r_vital_signs.QT_SEF_R > 0) then
		insert_row :=true;
	elsif ( nm_campo_p ='QT_TP_L') and (r_vital_signs.QT_TP_L > 0) then
		insert_row :=true;		
	elsif ( nm_campo_p ='QT_TP_R') and (r_vital_signs.QT_TP_R > 0) then 
		insert_row :=true;
	elsif ( nm_campo_p ='QT_BURST_L') and (r_vital_signs.QT_BURST_L > 0) then 
		insert_row :=true;		
	elsif ( nm_campo_p ='QT_BURST_R') and (r_vital_signs.QT_BURST_R > 0) then 
		insert_row :=true;
	end if;	
	if (insert_row) then
		t_objeto_row_w.DT_SINAL:= r_vital_signs.DT_SINAL;	
		t_objeto_row_w.QT_TCA := r_vital_signs.QT_TCA;
		t_objeto_row_w.QT_VMIN := r_vital_signs.QT_VMIN;
		t_objeto_row_w.QT_VCI := r_vital_signs.QT_VCI;
		t_objeto_row_w.QT_SAT_VENOSA_O2 := r_vital_signs.QT_SAT_VENOSA_O2;
		t_objeto_row_w.QT_PIP := r_vital_signs.QT_PIP;
		t_objeto_row_w.QT_PEEP := r_vital_signs.QT_PEEP;
		t_objeto_row_w.QT_OXIG_INS := r_vital_signs.QT_OXIG_INS;
		t_objeto_row_w.QT_OXIDO_NITROSO_INSP := r_vital_signs.QT_OXIDO_NITROSO_INSP;
		t_objeto_row_w.QT_HALOG_INS := r_vital_signs.QT_HALOG_INS;
		t_objeto_row_w.QT_HALOG_EXP := r_vital_signs.QT_HALOG_EXP;
		t_objeto_row_w.QT_FREQ_VENT := r_vital_signs.QT_FREQ_VENT;
		t_objeto_row_w.QT_FIO2 := r_vital_signs.QT_FIO2;
		t_objeto_row_w.QT_CO2 := r_vital_signs.QT_CO2;
		t_objeto_row_w.QT_CAM := r_vital_signs.QT_CAM;
		t_objeto_row_w.IE_RESPIRACAO := substr(Obter_Valor_Dominio(1299, r_vital_signs.IE_RESPIRACAO),1,255);
		t_objeto_row_w.IE_HALOG_TIPO := substr(Obter_Valor_Dominio(1559, r_vital_signs.IE_HALOG_TIPO),1,255);
		select 	substr(max(ds_modalidade),1,255)
		into STRICT 	t_objeto_row_w.CD_MOD_VENT
		from  	modalidade_ventilatoria
		where   cd_modalidade = r_vital_signs.CD_MOD_VENT;
		t_objeto_row_w.QT_TOF_BLOQ_NEURO_MUSC := r_vital_signs.QT_TOF_BLOQ_NEURO_MUSC;
		t_objeto_row_w.QT_TEMP := r_vital_signs.QT_TEMP;
		t_objeto_row_w.QT_SPO2R := r_vital_signs.QT_SPO2R;
		t_objeto_row_w.QT_SEGMENTO_ST := r_vital_signs.QT_SEGMENTO_ST;
		t_objeto_row_w.QT_SATURACAO_O2 := r_vital_signs.QT_SATURACAO_O2;
		t_objeto_row_w.QT_PVC := r_vital_signs.QT_PVC;
		t_objeto_row_w.QT_PRESSAO_INTRA_CRANIO := r_vital_signs.QT_PRESSAO_INTRA_CRANIO;
		t_objeto_row_w.QT_PRESSAO_INTRA_ABD := r_vital_signs.QT_PRESSAO_INTRA_ABD;
		t_objeto_row_w.QT_PA_SISTOLICA := r_vital_signs.QT_PA_SISTOLICA;
		t_objeto_row_w.QT_PAM := r_vital_signs.QT_PAM;
		t_objeto_row_w.QT_PAE := r_vital_signs.QT_PAE;
		t_objeto_row_w.QT_PA_DIASTOLICA := r_vital_signs.QT_PA_DIASTOLICA;
		t_objeto_row_w.QT_MAEC := r_vital_signs.QT_MAEC;
		t_objeto_row_w.QT_GLICEMIA_MMOL := r_vital_signs.QT_GLICEMIA_MMOL;
		t_objeto_row_w.QT_GLICEMIA_CAPILAR := r_vital_signs.QT_GLICEMIA_CAPILAR;
		t_objeto_row_w.QT_FREQ_RESP := r_vital_signs.QT_FREQ_RESP;
		t_objeto_row_w.QT_FREQ_CARD_MONIT := r_vital_signs.QT_FREQ_CARD_MONIT;
		t_objeto_row_w.QT_FREQ_CARDIACA := r_vital_signs.QT_FREQ_CARDIACA;
		t_objeto_row_w.QT_ESCALA_DOR := r_vital_signs.QT_ESCALA_DOR;
		t_objeto_row_w.QT_BCF := r_vital_signs.QT_BCF;
		t_objeto_row_w.IE_SITIO := substr(Obter_Valor_Dominio(1558, r_vital_signs.IE_SITIO),1,255);
		t_objeto_row_w.IE_RITMO_ECG := substr(Obter_Valor_Dominio(1557, r_vital_signs.IE_RITMO_ECG),1,255);
		t_objeto_row_w.IE_APARELHO_PA := substr(Obter_Valor_Dominio(1306, r_vital_signs.IE_APARELHO_PA),1,255);
		t_objeto_row_w.QT_VVS := r_vital_signs.QT_VVS;
		t_objeto_row_w.QT_VOLUME_SIST := r_vital_signs.QT_VOLUME_SIST;
		t_objeto_row_w.QT_SPHB := r_vital_signs.QT_SPHB;
		t_objeto_row_w.QT_PVI := r_vital_signs.QT_PVI;
		t_objeto_row_w.QT_PA_SIST_AP := r_vital_signs.QT_PA_SIST_AP;
		t_objeto_row_w.QT_PA_OCLUIDA_AP := r_vital_signs.QT_PA_OCLUIDA_AP;
		t_objeto_row_w.QT_PA_DIAST_AP := r_vital_signs.QT_PA_DIAST_AP;
		t_objeto_row_w.QT_DELTA_PP := r_vital_signs.QT_DELTA_PP; 		
		t_objeto_row_w.QT_DEBITO_CARD := r_vital_signs.QT_DEBITO_CARD;
		t_objeto_row_w.NR_SEQ_SINAL_VITAL := r_vital_signs.NR_SEQ_SINAL_VITAL;
		t_objeto_row_w.NR_SEQ_MONIT_RESP := r_vital_signs.NR_SEQ_MONIT_RESP;
		t_objeto_row_w.NR_SEQ_MONIT_HEMOD := r_vital_signs.NR_SEQ_MONIT_HEMOD;
		t_objeto_row_w.NM_USUARIO := r_vital_signs.NM_USUARIO;
		t_objeto_row_w.IE_INTEGRACAO := r_vital_signs.IE_INTEGRACAO;
		t_objeto_row_w.IE_TIPO_LANCAMENTO := r_vital_signs.IE_TIPO_LANCAMENTO;
		t_objeto_row_w.IE_TIPO_SINAL := r_vital_signs.IE_TIPO_SINAL;
		t_objeto_row_w.QT_BE            := r_vital_signs.QT_BE;
		t_objeto_row_w.QT_CA            := r_vital_signs.QT_CA;
		t_objeto_row_w.QT_CLORO         := r_vital_signs.QT_CLORO;
		t_objeto_row_w.QT_CO2_BIOQ      := r_vital_signs.QT_CO2_BIOQ;
		t_objeto_row_w.QT_GLICOSE       := r_vital_signs.QT_GLICOSE;
		t_objeto_row_w.QT_HB            := r_vital_signs.QT_HB;
		t_objeto_row_w.QT_HCO3          := r_vital_signs.QT_HCO3;
		t_objeto_row_w.QT_HT            := r_vital_signs.QT_HT;
		t_objeto_row_w.QT_K             := r_vital_signs.QT_K;
		t_objeto_row_w.QT_LACTATO       := r_vital_signs.QT_LACTATO;
		t_objeto_row_w.QT_MG            := r_vital_signs.QT_MG;
		t_objeto_row_w.QT_NA            := r_vital_signs.QT_NA;
		t_objeto_row_w.QT_PCO2          := r_vital_signs.QT_PCO2;
		t_objeto_row_w.QT_PH            := r_vital_signs.QT_PH;
		t_objeto_row_w.QT_PO2           := r_vital_signs.QT_PO2;
		t_objeto_row_w.QT_SATO2         := r_vital_signs.QT_SATO2;
		t_objeto_row_w.QT_TCA           := r_vital_signs.QT_TCA;
		t_objeto_row_w.NR_SEQ_ANAL_BIOQ := r_vital_signs.NR_SEQ_ANAL_BIOQ;
		t_objeto_row_w.QT_BIS_L   := r_vital_signs.QT_BIS_L;
		t_objeto_row_w.QT_BIS_R   := r_vital_signs.QT_BIS_R;
		t_objeto_row_w.QT_SQI_L   := r_vital_signs.QT_SQI_L;
		t_objeto_row_w.QT_SQI_R   := r_vital_signs.QT_SQI_R;
		t_objeto_row_w.QT_EMG_L   := r_vital_signs.QT_EMG_L;
		t_objeto_row_w.QT_EMG_R   := r_vital_signs.QT_EMG_R;
		t_objeto_row_w.QT_SR_L    := r_vital_signs.QT_SR_L;
		t_objeto_row_w.QT_SR_R    := r_vital_signs.QT_SR_R;
		t_objeto_row_w.QT_SEF_L   := r_vital_signs.QT_SEF_L;
		t_objeto_row_w.QT_SEF_R   := r_vital_signs.QT_SEF_R;
		t_objeto_row_w.QT_TP_L    := r_vital_signs.QT_TP_L;
		t_objeto_row_w.QT_TP_R    := r_vital_signs.QT_TP_R;
		t_objeto_row_w.QT_BURST_L := r_vital_signs.QT_BURST_L;
		t_objeto_row_w.QT_BURST_R := r_vital_signs.QT_BURST_R;
		t_objeto_row_w.NR_SEQ_AVAL_ANAL := r_vital_signs.NR_SEQ_AVAL_ANAL;		
		t_objeto_row_w.DT_LIBERACAO := r_vital_signs.DT_LIBERACAO;
		t_objeto_row_w.IE_SITUACAO := r_vital_signs.IE_SITUACAO;
		RETURN NEXT t_objeto_row_w;
	end if;
end loop montar_lista;


RETURN;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION search_vital_signs_review_pck.get_data ( nr_cirurgia_p bigint, nr_seq_pepo_p bigint, ie_integracao_p text, ie_tipo_sinal_p text, nm_campo_p text, nm_usuario_integracao_p text, ie_situacao_p text default 'T') FROM PUBLIC;
