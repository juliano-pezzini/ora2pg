-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------





-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------




CREATE OR REPLACE PROCEDURE pls_gerenciar_reembolso_pck.gerencia_selecao ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, nr_seq_conta_proc_p pls_def_reemb_selecao.nr_seq_conta_proc%type, nr_seq_conta_mat_p pls_def_reemb_selecao.nr_seq_conta_mat%type, ie_valido_p pls_def_reemb_selecao.ie_valido%type, nm_usuario_p usuario.nm_usuario%type, ie_acao_p text, dados_filtro_p dados_filtro) AS $body$
BEGIN

-- Deve ter informacao da transacao para executar alguma alteracao.

if (nr_id_transacao_p IS NOT NULL AND nr_id_transacao_p::text <> '') then
	if (ie_acao_p = '1') then
		insert into pls_def_reemb_selecao(nr_sequencia,
			nm_usuario,
			dt_atualizacao,
			nm_usuario_nrec,
			dt_atualizacao_nrec,
			nr_id_transacao,
			nr_seq_conta_proc,
			nr_seq_conta_mat,
			ie_valido,
			ie_valido_temp,
			nr_seq_filtro)
		values (nr_id_transacao_p,
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nr_id_transacao_p,
			nr_seq_conta_proc_p,
			nr_seq_conta_mat_p,
			'N',
			'S',
			dados_filtro_p.nr_sequencia);
	elsif (ie_acao_p = '2') then
		update	pls_def_reemb_selecao
		set	ie_valido_temp = 'N'
		where	nr_id_transacao = nr_id_transacao_p
		and	nr_seq_filtro = dados_filtro_p.nr_sequencia;
	elsif (ie_acao_p = '3') then
		update	pls_def_reemb_selecao
		set	ie_valido = 'S'
		where	nr_id_transacao = nr_id_transacao_p
		and	ie_valido_temp = 'S';
		
		delete 	from pls_def_reemb_selecao
		where	nr_id_transacao = nr_id_transacao_p
		and	ie_valido_temp = 'N';
	end if;
end if;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerenciar_reembolso_pck.gerencia_selecao ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, nr_seq_conta_proc_p pls_def_reemb_selecao.nr_seq_conta_proc%type, nr_seq_conta_mat_p pls_def_reemb_selecao.nr_seq_conta_mat%type, ie_valido_p pls_def_reemb_selecao.ie_valido%type, nm_usuario_p usuario.nm_usuario%type, ie_acao_p text, dados_filtro_p dados_filtro) FROM PUBLIC;
