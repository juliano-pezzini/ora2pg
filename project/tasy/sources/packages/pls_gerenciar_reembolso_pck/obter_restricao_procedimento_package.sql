-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------




CREATE OR REPLACE FUNCTION pls_gerenciar_reembolso_pck.obter_restricao_procedimento ( dados_filtro_proc_p pls_gerenciar_reembolso_pck.dados_filtro_proc, valor_bind_p INOUT sql_pck.t_dado_bind) AS $body$
DECLARE
			
/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: Montar as restricoes e binds dos campos de filtro de procedimento.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


dados_restricao_w	pls_gerenciar_reembolso_pck.dados_select;

ds_filtro_w		varchar(2000);
ds_alias_w		varchar(6);


BEGIN

-- Inicializar o retorno

dados_restricao_w.ds_restricao	:= null;
ds_filtro_w 	:= null;
ds_alias_w  	:= 'a';

-- Procedimento - CD_PROCEDIMENTO

if (dados_filtro_proc_p.cd_procedimento IS NOT NULL AND dados_filtro_proc_p.cd_procedimento::text <> '') then
	ds_filtro_w := 	ds_filtro_w || pls_util_pck.enter_w || 
			'and ' || ds_alias_w || '.cd_procedimento = :cd_procedimento ';
	
	valor_bind_p := sql_pck.bind_variable(':cd_procedimento', dados_filtro_proc_p.cd_procedimento, valor_bind_p);
end if;

-- Grupo proc - CD_GRUPO_PROC

if (dados_filtro_proc_p.cd_grupo_proc IS NOT NULL AND dados_filtro_proc_p.cd_grupo_proc::text <> '') then
	ds_filtro_w := 	ds_filtro_w || pls_util_pck.enter_w ||
			'and ' || ds_alias_w || '.cd_grupo_proc = :cd_grupo_proc ';
	
	valor_bind_p := sql_pck.bind_variable(':cd_grupo_proc', dados_filtro_proc_p.cd_grupo_proc, valor_bind_p);
end if;

-- Especialidade - CD_ESPECIALIDADE

if (dados_filtro_proc_p.cd_especialidade IS NOT NULL AND dados_filtro_proc_p.cd_especialidade::text <> '') then
	ds_filtro_w := 	ds_filtro_w || pls_util_pck.enter_w ||
			'and ' || ds_alias_w || '.cd_especialidade = :cd_especialidade ';
	
	valor_bind_p := sql_pck.bind_variable(':cd_especialidade', dados_filtro_proc_p.cd_especialidade, valor_bind_p);
end if;

-- Area proc - CD_AREA_PROCEDIMENTO

if (dados_filtro_proc_p.cd_area_procedimento IS NOT NULL AND dados_filtro_proc_p.cd_area_procedimento::text <> '') then
	ds_filtro_w := 	ds_filtro_w || pls_util_pck.enter_w ||
			'and ' || ds_alias_w || '.cd_area_procedimento = :cd_area_procedimento ';
	
	valor_bind_p := sql_pck.bind_variable(':cd_area_procedimento', dados_filtro_proc_p.cd_area_procedimento, valor_bind_p);
end if;	

-- Grupo de servico - NR_SEQ_GRUPO_SERVICO

if (dados_filtro_proc_p.nr_seq_grupo_servico IS NOT NULL AND dados_filtro_proc_p.nr_seq_grupo_servico::text <> '') then
	ds_filtro_w := 	ds_filtro_w || pls_util_pck.enter_w ||
			'and ' || ds_alias_w || '.nr_seq_grupo_serv = :nr_seq_grupo_serv ';
	
	valor_bind_p := sql_pck.bind_variable(':nr_seq_grupo_serv', dados_filtro_proc_p.nr_seq_grupo_servico, valor_bind_p);
end if;	

if (ds_filtro_w IS NOT NULL AND ds_filtro_w::text <> '') then
	dados_restricao_w.ds_restricao := ds_filtro_w;
end if;

return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_gerenciar_reembolso_pck.obter_restricao_procedimento ( dados_filtro_proc_p pls_gerenciar_reembolso_pck.dados_filtro_proc, valor_bind_p INOUT sql_pck.t_dado_bind) FROM PUBLIC;
