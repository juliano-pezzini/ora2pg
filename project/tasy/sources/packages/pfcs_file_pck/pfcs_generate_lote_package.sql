-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pfcs_file_pck.pfcs_generate_lote () AS $body$
DECLARE


	ds_err_w				varchar(255);
	ds_directory_w				varchar(255);
	ds_file_w				utl_file.file_type;
	nm_file_w				varchar(255);

	
BEGIN

	nm_file_w	:= 'PFCS_LOTE_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.lote';

	obter_evento_utl_file(34, null, ds_directory_w, ds_err_w);

	ds_file_w := utl_file.fopen(ds_directory_w, nm_file_w, 'W');

	utl_file.put_line(ds_file_w, 'PFCS_PANEL_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.put_line(ds_file_w, 'PFCS_PANEL_DETAIL_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.put_line(ds_file_w, 'PFCS_DETAIL_PATIENT_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.put_line(ds_file_w, 'PFCS_DETAIL_BED_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.put_line(ds_file_w, 'PFCS_DETAIL_EMPLOYEE_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.put_line(ds_file_w, 'PFCS_DETAIL_EXAM_LAB_' || current_setting('pfcs_file_pck.ds_time_w')::varchar(255) || '.csv');
	utl_file.fflush(ds_file_w);
    utl_file.fclose(ds_file_w);
     EXCEPTION
         WHEN OTHERS
         THEN
           IF UTL_FILE.is_open(ds_file_w)
           THEN
              UTL_FILE.fclose(ds_file_w);
           END IF;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pfcs_file_pck.pfcs_generate_lote () FROM PUBLIC;
