-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE configura_psa_tws_pack.configure_psa_tws_patient ( nm_attempts datasource.vl_allowed_login_attempts%type, nm_email_admin subject.ds_email%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
id_application      	application.id%type;
id_datasource       	datasource.id%type;

ds_role_unlinked    	role.ds_role%TYPE := 'UnlinkedUser';
nm_role_unlinked	role.nm_role%TYPE := 'unlinkedUser';
ds_role_linked          role.ds_role%TYPE := 'LinkedUser';
nm_role_linked          role.nm_role%TYPE := 'linkedUser';
ds_role_patient         role.ds_role%TYPE := 'Patient';
nm_role_patient         role.nm_role%TYPE := 'patient';
ds_role_guest           role.ds_role%TYPE := 'Guest';
nm_role_guest           role.nm_role%TYPE := 'guest';


BEGIN

--create application and datasouce
SELECT * FROM configura_psa_tws_pack.create_application_datasouce( nm_attempts, nm_email_admin, 'WEBSUITE', 'websuite', id_application, id_datasource ) INTO STRICT id_application, id_datasource;

--Insert UNLIKEDUSER profile permissions to application
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_schematic_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_schematic_tag')::permission.ds_tag%TYPE, ds_role_unlinked, nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_schedule_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_schedule_tag')::permission.ds_tag%TYPE, ds_role_unlinked, nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_email_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_email_tag')::permission.ds_tag%TYPE, ds_role_unlinked, nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_entity_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_entity_tag')::permission.ds_tag%TYPE, ds_role_unlinked, nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_professional_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_professional_tag')::permission.ds_tag%TYPE, ds_role_unlinked,  nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_utils_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_utils_tag')::permission.ds_tag%TYPE, ds_role_unlinked,  nm_role_unlinked, id_datasource, id_application, 'S');
CALL CALL configura_psa_tws_pack.create_permission_role(current_setting('configura_psa_tws_pack.permission_person_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_person_tag')::permission.ds_tag%TYPE, ds_role_unlinked,  nm_role_unlinked, id_datasource, id_application, 'S');

--Insert LinkedUser profile permissions to application
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_exams_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_exams_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_reports_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_reports_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_notification_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_notification_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_person_cont_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_person_cont_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_pci_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_pci_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_location_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_location_tag')::permission.ds_tag%TYPE, ds_role_linked, nm_role_linked, id_datasource, id_application, 'N' );

--Insert Patient profile permissions to application
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_person_adm_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_person_adm_tag')::permission.ds_tag%TYPE, ds_role_patient, nm_role_patient, id_datasource, id_application, 'N' );

--Insert Guest profile permissions to application
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_subj_create_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_subj_create_tag')::permission.ds_tag%TYPE, ds_role_guest, nm_role_guest, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_subj_retrie_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_subj_retrie_tag')::permission.ds_tag%TYPE, ds_role_guest, nm_role_guest, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_subj_cons_give_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_subj_cons_give_tag')::permission.ds_tag%TYPE, ds_role_guest, nm_role_guest, id_datasource, id_application, 'N' );
CALL CALL configura_psa_tws_pack.create_permission_role( current_setting('configura_psa_tws_pack.permission_subj_acti_stat_desc')::permission.ds_tag%TYPE, current_setting('configura_psa_tws_pack.permission_subj_acti_stat_tag')::permission.ds_tag%TYPE, ds_role_guest, nm_role_guest, id_datasource, id_application, 'N' );

--Create user DEAFAULT
CALL configura_psa_tws_pack.create_subject_default(id_datasource, id_application);

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE configura_psa_tws_pack.configure_psa_tws_patient ( nm_attempts datasource.vl_allowed_login_attempts%type, nm_email_admin subject.ds_email%type) FROM PUBLIC;
