-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



/*Essa function ira buscar qual dos itens estao sendo tratado no momento
C	= CONTA
P  	= PROCEDIMENTO
M 	= MATERIAL
R	= PARTICIPANTE
*/


-- essa function devera ser excluida no futuro quando o processo de buscar grupos pela tabela TM estiver 100% homologado

-- ela foi criada apenas por seguranca, pois se der problema e so alimentar o campo corretamente na tabela



CREATE OR REPLACE FUNCTION pls_util_cta_pck.usar_novo_agrup () RETURNS varchar AS $body$
BEGIN

if (current_setting('pls_util_cta_pck.ie_usa_nv_grup_serv_w')::coalesce(varchar(1)::text, '') = '') then

	select	coalesce(max(ie_novo_grupo_servico), 'N')
	into STRICT	current_setting('pls_util_cta_pck.ie_usa_nv_grup_serv_w')::varchar(1)
	from	pls_visible_false;

	-- se n?o tiver valor retorna N

	if (current_setting('pls_util_cta_pck.ie_usa_nv_grup_serv_w')::coalesce(varchar(1)::text, '') = '') then
		PERFORM set_config('pls_util_cta_pck.ie_usa_nv_grup_serv_w', 'N', false);
	end if;
end if;

return current_setting('pls_util_cta_pck.ie_usa_nv_grup_serv_w')::varchar(1);

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_util_cta_pck.usar_novo_agrup () FROM PUBLIC;
