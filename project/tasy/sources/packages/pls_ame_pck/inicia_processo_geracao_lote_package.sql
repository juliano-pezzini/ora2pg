-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_ame_pck.inicia_processo_geracao_lote ( nr_seq_lote_rem_p pls_ame_lote_remessa.nr_sequencia%type) AS $body$
DECLARE


qt_destinos_arquivo_w	integer;

BEGIN
	CALL pls_ame_pck.carrega_dados_lote_regra_lote(nr_seq_lote_rem_p);
	CALL pls_ame_pck.consistir_regra_geracao_lote();
	CALL pls_ame_pck.gerar_destinos_regra();
	ajustar_valores_totais_lote;

	select	count(1)
	into STRICT	qt_destinos_arquivo_w
	from	pls_ame_lote_rem_destino
	where	nr_seq_lote_rem = nr_seq_lote_rem_p;

	if (qt_destinos_arquivo_w <> 0) then
		update	pls_ame_lote_remessa
		set	dt_geracao_lote	= clock_timestamp()
		where	nr_sequencia	= nr_seq_lote_rem_p;
	end if;

	commit;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ame_pck.inicia_processo_geracao_lote ( nr_seq_lote_rem_p pls_ame_lote_remessa.nr_sequencia%type) FROM PUBLIC;
