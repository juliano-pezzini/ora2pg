-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_ame_pck.desfazer_importacao_arquivo ( nr_seq_lote_retorno_p pls_ame_lote_retorno.nr_sequencia%type) AS $body$
DECLARE

valores_lote_c CURSOR FOR
	SELECT	nr_sequencia
	from	pls_ame_lote_ret_valor
	where	nr_seq_lote_ret = nr_seq_lote_retorno_p;

type valores_lote_type is table of valores_lote_c%rowtype;

valores_lote_table valores_lote_type;
BEGIN

open valores_lote_c;
fetch valores_lote_c bulk collect into valores_lote_table;
close valores_lote_c;

if (valores_lote_table.count > 0) then
	for i in valores_lote_table.first .. valores_lote_table.last loop
		delete	FROM pls_ame_lote_ret_valor_det
		where	nr_seq_lote_ret_valor = valores_lote_table[i].nr_sequencia;
	end loop;
end if;

delete	FROM pls_ame_lote_ret_valor
where	nr_seq_lote_ret = nr_seq_lote_retorno_p;

delete	FROM pls_ame_retorno_log_erro
where	nr_seq_lote_ret = nr_seq_lote_retorno_p;

delete	FROM pls_ame_lote_retorno
where	nr_sequencia	= nr_seq_lote_retorno_p;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ame_pck.desfazer_importacao_arquivo ( nr_seq_lote_retorno_p pls_ame_lote_retorno.nr_sequencia%type) FROM PUBLIC;
