-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



-- controle para decidir quando o select para obtencao dos valores dos parametros deve ser executado novamente




CREATE OR REPLACE PROCEDURE pls_filtro_regra_event_rgl_pck.carrega_parametros (cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN

-- se a data da ultima solicitacao nao estiver registrada ou 

-- se ja se passou 67 segundos deste a ultima solicitacao ou

-- se a origem for diferente da ultima solicitada ou

-- se o estabelecimento anterior for diferente do ultimo solicitado

-- executa o comando para preencher os valores dos parametros

if	((current_setting('pls_filtro_regra_event_rgl_pck.dt_solicitacao_ult_w')::coalesce(timestamp::text, '') = '') or
	(current_setting('pls_filtro_regra_event_rgl_pck.dt_solicitacao_ult_w')::timestamp <= (clock_timestamp() - interval '67 seconds')) or (coalesce(current_setting('pls_filtro_regra_event_rgl_pck.cd_estabelecimento_ult_w')::estabelecimento.cd_estabelecimento%type, -1) != coalesce(cd_estabelecimento_p, -2))) then
	
	PERFORM set_config('pls_filtro_regra_event_rgl_pck.cd_estabelecimento_ult_w', cd_estabelecimento_p, false);
	PERFORM set_config('pls_filtro_regra_event_rgl_pck.dt_solicitacao_ult_w', clock_timestamp(), false);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_filtro_regra_event_rgl_pck.carrega_parametros (cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
