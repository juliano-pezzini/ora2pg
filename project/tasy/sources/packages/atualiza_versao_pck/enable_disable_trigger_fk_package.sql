-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.enable_disable_trigger_fk () AS $body$
DECLARE


  c RECORD;
  trg RECORD;

BEGIN
    for c in (SELECT /*+ NO_PARALLEL */               'alter table ' || ac.TABLE_NAME || ' disable constraint ' ||
               ac.CONSTRAINT_NAME DISABLE_FK,
               'alter table ' || ac.TABLE_NAME ||
               ' enable novalidate constraint ' || ac.CONSTRAINT_NAME ENABLE_FK,
               ac.CONSTRAINT_NAME
                FROM USER_CONSTRAINTS           ac,
                     user_constraints           ac_pk,
                     tasy_versao.tasy_exptables t
               WHERE ac.CONSTRAINT_TYPE = 'R'
                 AND ac.R_CONSTRAINT_NAME = ac_pk.constraint_name
                 and ac_pk.constraint_type = 'P'
                 and ac_pk.table_name = t.table_name

              ) loop
      CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'UPDATE DICTIONARY TABLES - DISABLE FKS AND TRIGGERS',
                 p_cmd         => c.disable_fk,
                 p_object_name => c.constraint_name);
      CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'UPDATE DICTIONARY TABLES - ENABLE FKS AND TRIGGERS',
                 p_cmd         => c.enable_fk,
                 p_object_name => c.constraint_name);

    end loop;

    for trg in (SELECT /*+ NO_PARALLEL */                 'alter trigger ' || trigger_name || ' disable' disable_trigger,
                 'alter trigger ' || trigger_name || ' enable' enable_trigger,
                 trigger_name
                  from user_triggers
                 where table_name in (select table_name from tasy_versao.tasy_exptables)) loop
      CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'UPDATE DICTIONARY TABLES - DISABLE FKS AND TRIGGERS',
                 p_cmd         => trg.disable_trigger,
                 p_object_name => trg.trigger_name);
      CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'UPDATE DICTIONARY TABLES - ENABLE FKS AND TRIGGERS',
                 p_cmd         => trg.enable_trigger,
                 p_object_name => trg.trigger_name);
    end loop;
    commit;
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria a instrução para atualizar a tabela TASY_PADRAO_IMAGEM. Esta tabela é
  -- atualizada com um bloco anônimo de PLSQL
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.enable_disable_trigger_fk () FROM PUBLIC;
