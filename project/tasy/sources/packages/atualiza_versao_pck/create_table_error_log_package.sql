-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.create_table_error_log () AS $body$
DECLARE

    v_cmd varchar(32000);

  r RECORD;

BEGIN
    v_cmd := 'create table log_error_exp_tables ( ';
    v_cmd := v_cmd || 'ora_err_number$          number,';
    v_cmd := v_cmd || 'ora_err_mesg$            varchar2(2000),';
    v_cmd := v_cmd || 'ora_err_rowid$           urowid(4000),';
    v_cmd := v_cmd || 'ora_err_optyp$           varchar2(2),';
    v_cmd := v_cmd || 'ora_err_tag$             varchar2(2000) ';

    for r in (SELECT distinct ia.nm_atributo
                from tasy_versao.indice          i,
                     tasy_versao.indice_atributo ia,
                     tasy_versao.tasy_exptables  et,
                     tasy_versao.tabela_atributo ta
               where i.nm_tabela = ia.nm_tabela
                 and i.nm_indice = ia.nm_indice
                 and et.table_name = ia.nm_tabela
                 and ta.nm_tabela = ia.nm_tabela
                 and ta.nm_atributo = ia.nm_atributo
                 and i.ie_tipo = 'PK'
               order by CASE WHEN ia.nm_atributo='NR_SEQUENCIA' THEN                                1 WHEN ia.nm_atributo='CD_EXPRESSAO' THEN                                2  ELSE 3 END ) loop
      v_cmd := v_cmd || ',' || r.nm_atributo || ' VARCHAR2(4000)';
    end loop;
    v_cmd := v_cmd || ')';

    begin
      EXECUTE 'drop table log_error_exp_tables';
    exception
      when others then
        null;
    end;

    begin
      EXECUTE v_cmd;
    exception
      when others then
        null;
    end;

  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria as instruções para UPDATE das tabela de dicionário
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.create_table_error_log () FROM PUBLIC;
