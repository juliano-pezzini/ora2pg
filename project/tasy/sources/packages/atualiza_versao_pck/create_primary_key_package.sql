-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.create_primary_key () AS $body$
DECLARE

    v_cmd      varchar(32000);
    v_operacao varchar(200);

BEGIN
    for i in c_create_primary_key_01 loop
      v_cmd := null;
      for ic in c_create_constraint_02(i.nm_tabela, i.nm_indice) loop
        v_cmd := v_cmd || ',' || ic.nm_atributo;
      end loop;

      v_cmd := 'alter table ' || i.nm_tabela || ' add constraint ' ||
               i.nm_indice || ' primary key ( ' || trim(both ',' from v_cmd) || ')';

      v_operacao := 'CREATE PRIMARY KEY';

      CALL atualiza_versao_pck.insert_cmd(p_operacao    => v_operacao,
                 p_cmd         => v_cmd,
                 p_object_name => i.nm_indice);

    end loop;
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria as instruções ALTER TABLE ADD UNIQUE KEY para a atualização.
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.create_primary_key () FROM PUBLIC;
