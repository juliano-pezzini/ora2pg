-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.alter_table_modify_column () AS $body$
DECLARE

    v_cmd      varchar(32000);
    v_operacao varchar(5000) := 'ALTER TABLE MODIFY COLUMN';

BEGIN
    -- Tipo de dado diferente
    for t in current_setting('atualiza_versao_pck.c_mod_col_01')::loop CURSOR
      v_cmd := null;
      for c in current_setting('atualiza_versao_pck.c_mod_col_02')::CURSOR(p_nm_tabela(t.nm_tabela) loop
        v_cmd := v_cmd || ',' || c.nm_atributo || ' ' ||
                 atualiza_versao_pck.format_data_type(c.ie_tipo_atributo,
                                  c.qt_tamanho,
                                  c.qt_decimais);
      end loop;
      v_cmd := 'alter table ' || t.nm_tabela || ' modify (' ||
               trim(both ',' from v_cmd) || ')';

      v_operacao := 'ALTER TABLE MODIFY COLUMN';

      CALL atualiza_versao_pck.insert_cmd(p_operacao    => v_operacao,
                 p_cmd         => v_cmd,
                 p_object_name => t.nm_tabela);
    end loop;

    -- Tamanho de tipo de dado diferente
    for t in current_setting('atualiza_versao_pck.c_mod_col_03')::loop CURSOR
      v_cmd := null;
      for c in current_setting('atualiza_versao_pck.c_mod_col_04')::CURSOR(p_nm_tabela(t.nm_tabela) loop
        v_cmd := v_cmd || ',' || c.nm_atributo || ' ' ||
                 atualiza_versao_pck.format_data_type(c.ie_tipo_atributo,
                                  c.qt_tamanho,
                                  c.qt_decimais);
      end loop;

      v_operacao := 'ALTER TABLE MODIFY COLUMN';

      v_cmd := 'alter table ' || t.nm_tabela || ' modify (' ||
               trim(both ',' from v_cmd) || ')';

      CALL atualiza_versao_pck.insert_cmd(p_operacao    => v_operacao,
                 p_cmd         => v_cmd,
                 p_object_name => t.nm_tabela);
    end loop;
  end;

  --###############################
  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria as instruções CREATE TABLE para a atualização
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.alter_table_modify_column () FROM PUBLIC;
