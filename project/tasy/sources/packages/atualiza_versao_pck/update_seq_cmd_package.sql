-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.update_seq_cmd () AS $body$
DECLARE

    v_seq bigint;

  r RECORD;

BEGIN
    v_seq := 0;

    for r in (SELECT rowid rid, ds_operacao
                from atualiza_versao_cmd
               order by nr_fase,
                        qt_reg_exp_table desc,
                        nr_service_pack,
                        nr_release_sp,
                        nr_ordem_sp,
                        nr_sequencia_sp,
                        nr_seq) loop
      v_seq := v_seq + 1;
      if r.ds_operacao = 'CONTROL' then
        v_seq := 0;
      end if;
      update atualiza_versao_cmd
         set nr_seq = v_seq, fl_ready_to_upg = 'S'
       where rowid = r.rid;
    end loop;
    commit;
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria índices auxiliares para otimizar o tempo na criação de instruções. Os
  -- índices são criados nas tabelas do schema TASY_VERSAO.
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.update_seq_cmd () FROM PUBLIC;
