-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.after_update_exp_tables () AS $body$
BEGIN
    CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'AFTER UPDATE DICTIONARY TABLES',
               p_cmd         => 'delete from VALOR_DOMINIO a where not exists ( select 1 from DOMINIO b where 1 = 1 and a.CD_DOMINIO = b.CD_DOMINIO) and a.CD_DOMINIO is not null',
               p_object_name => 'VALOR_DOMINIO');

    CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'AFTER UPDATE DICTIONARY TABLES',
               p_cmd         => 'update valor_dominio a set a.CD_EXP_VALOR_DOMINIO = (select b.CD_EXP_VALOR_DOMINIO from tasy_versao.valor_dominio b where b.cd_dominio = a.cd_dominio and b.vl_dominio = a.vl_dominio)  where exists (select 1 from tasy_versao.valor_dominio c where c.cd_dominio = a.cd_dominio and c.vl_dominio = a.vl_dominio and nvl(c.CD_EXP_VALOR_DOMINIO,0) <> nvl(a.CD_EXP_VALOR_DOMINIO,0) and c.dt_Atualizacao > a.dt_atualizacao)',
               p_object_name => 'VALOR_DOMINIO');

    CALL atualiza_versao_pck.insert_cmd(p_operacao    => 'AFTER UPDATE DICTIONARY TABLES',
               p_cmd         => 'alter table pls_glosa_evento enable constraint PLSGLEV_TISSMGL_FK',
               p_object_name => 'PLS_GLOSA_EVENTO');
  end;

  --------------------------------------------------------------------------------------
  --
  --
  -- rules devem ser programadas para condição de não atualizar
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.after_update_exp_tables () FROM PUBLIC;
