-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.create_control_record (p_cd_versao_destino text, p_nr_service_pack bigint, p_fl_send_traceability text) AS $body$
DECLARE

    v_cd_versao_origem varchar(100);

BEGIN
  
    select cd_versao_atual
      into STRICT v_cd_versao_origem
      from aplicacao_tasy
     where cd_aplicacao_tasy = 'Tasy';

    CALL atualiza_versao_pck.insert_cmd(p_operacao => 'CONTROL', p_cmd => 'begin null; end;');

    update atualiza_versao_cmd
       set fl_update_running    = 'N',
           cd_versao_origem     = v_cd_versao_origem,
           cd_versao_destino    = p_cd_versao_destino,
           nr_sp_informado      = p_nr_service_pack,
           fl_send_traceability = p_fl_send_traceability
     where ds_operacao = 'CONTROL';
    commit;
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Cria as operações que executam procedures ou ações não programadas nesta package.
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.create_control_record (p_cd_versao_destino text, p_nr_service_pack bigint, p_fl_send_traceability text) FROM PUBLIC;
