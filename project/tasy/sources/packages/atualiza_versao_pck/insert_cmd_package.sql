-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.insert_cmd (p_operacao text, p_cmd text, p_object_name text default null, p_nm_tabela text default null, p_object_type text default null, p_tablespace text default null, p_qt_reg_exp_table bigint default null, p_nr_service_pack bigint default null, p_nr_release_sp bigint default null, p_nr_ordem_sp bigint default null, p_nr_sequencia_sp bigint default null) AS $body$
DECLARE

    v_nr_fase  bigint;
    v_phase    varchar(20);
    v_operacao varchar(128);

BEGIN
    v_operacao := p_operacao;
    v_phase    := 'OFFLINE';

    case p_operacao
      when 'CONTROL' then
        v_nr_fase := 0;
      when 'DISABLE APPLICATION' then
        v_nr_fase := 10;
      when 'CLOSE CONNECTIONS' then
        v_nr_fase := 20;
      when 'CREATE BACKUP OF EXPORTED TABLES' then
        v_nr_fase := 21;
      when 'BEFORE DATABASE UPDATE SCRIPTS (PREPARA)' then
        v_nr_fase := 30;
      when 'CREATE TABLE' then
        v_nr_fase := 40;
      when 'CREATE GLOBAL TEMPORARY TABLE' then
        v_nr_fase := 50;
      when 'CREATE SEQUENCE' then
        v_nr_fase := 60;
      when 'ALTER TABLE ADD COLUMN' then
        v_nr_fase := 70;
      when 'ALTER TABLE MODIFY COLUMN' then
        v_nr_fase := 80;
      when 'CREATE INDEX (NEW TABLES)' then
        v_nr_fase := 90;
      when 'CREATE INDEX' then
        v_nr_fase := 100;
      when 'UPDATE DICTIONARY TABLES - DISABLE FKS AND TRIGGERS' then
        v_nr_fase := 110;
      when 'BEFORE UPDATE DICTIONARY TABLES' then
        v_nr_fase := 115;
      when 'DELETE RECORDS FROM DICTIONARY TABLES' then
        v_nr_fase := 120;
      when 'UPDATE RECORDS ON DICTIONARY TABLES' then
        v_nr_fase := 130;
      when 'INSERT NEW RECORDS ON DICTIONARY TABLES' then
        v_nr_fase := 140;
      when 'AFTER UPDATE DICTIONARY TABLES' then
        v_nr_fase := 145;
      when 'ELIMINAR_FUNCAO' then
        v_nr_fase := 146;
      when 'UPDATE TABLE PADRAO IMAGEM' then
        v_nr_fase := 150;
      when 'UPDATE MANDATORY COLUMNS' then
        v_nr_fase := 155;
      when 'UPDATE DATABASE OBJECTS' then
        v_nr_fase := 160;
      when 'CREATE FUNCTION BASED INDEX'
 then
        v_nr_fase := 170;
      when 'CREATE UNIQUE INDEX' then
        v_nr_fase := 180;
      when 'CREATE UNIQUE KEY' then
        v_nr_fase := 190;
      when 'CREATE PRIMARY KEY' then
        v_nr_fase := 200;
      when 'CREATE FOREIGN KEY' then
        v_nr_fase := 210;
      when 'DISABLE TABLE PARALLELISM' then
        v_nr_fase := 220;
      when 'DISABLE INDEX PARALLELISM' then
        v_nr_fase := 230;
      when 'ENABLE INDEX LOGGING' then
        v_nr_fase := 240;
      when 'SERVICE PACK UPDATE' then
        v_nr_fase := 250;
      when 'AFTER DATABASE UPDATE SCRIPTS (AJUSTE)' then
        v_nr_fase := 260;
      when 'UPDATE DICTIONARY TABLES - ENABLE FKS AND TRIGGERS' then
        v_nr_fase := 270;
      when 'RECOMPILE PLSQL OBJECTS' then
        v_nr_fase := 280;
      when 'ATUALIZAR_INDICADOR' then
        v_nr_fase := 300;
      when 'AJUSTAR_BASE_RELATORIO' then
        v_nr_fase := 305;
      when 'ATUALIZAR_BASE_RELATORIO' then
        v_nr_fase := 310;
      when 'ENABLE APPLICATION' then
        v_nr_fase := 320;
      when 'CREATE BACKUP OF DTR TABLES' then
        v_nr_fase := 400;
      else
        v_nr_fase := 999;
    end case;

    g_seq := g_seq + 1;

    insert into atualiza_versao_cmd(nr_seq,
       ds_comando,
       nr_fase,
       fl_execucao,
       ds_operacao,
       nm_tablespace,
       nm_objeto,
       ds_fase,
       tipo_objeto,
       qt_reg_exp_table,
       nr_service_pack,
       nr_ordem_sp,
       --nr_fase_sp,
       nr_release_sp,
       nr_sequencia_sp,
       nm_tabela,
       fl_ready_to_upg)
    values (g_seq,
       p_cmd,
       v_nr_fase,
       'WAITING',
       v_operacao,
       p_tablespace,
       p_object_name,
       v_phase,
       p_object_type,
       p_qt_reg_exp_table,
       p_nr_service_pack,
       p_nr_ordem_sp,
       --p_nr_fase_sp,
       p_nr_release_sp,
       p_nr_sequencia_sp,
       p_nm_tabela,
       'N');
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Formata o tipo de dado utilizado na criação e alteração de tabelas
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.insert_cmd (p_operacao text, p_cmd text, p_object_name text default null, p_nm_tabela text default null, p_object_type text default null, p_tablespace text default null, p_qt_reg_exp_table bigint default null, p_nr_service_pack bigint default null, p_nr_release_sp bigint default null, p_nr_ordem_sp bigint default null, p_nr_sequencia_sp bigint default null) FROM PUBLIC;
