-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.update_exp_tables () AS $body$
DECLARE

    v_reg_count           bigint;
    v_atualiza_exp_tables varchar(1);

  tep RECORD;

BEGIN
    CALL atualiza_versao_pck.before_update_exp_tables();
    for tep in (SELECT te.*
                  from tasy_versao.tasy_exptables te, all_tables at
                 where te.table_name = at.table_name
                   and at.owner = 'TASY_VERSAO'
                   and te.table_name not in ('APLICACAO_TASY_VERSAO', 'APLICACAO_TASY')
                   and te.ie_tipo_tabela in ('T', 'D')
                 order by te.table_name) loop

      v_reg_count           := atualiza_versao_pck.get_table_record_count('TASY_VERSAO',
                                                      tep.table_name);
      v_atualiza_exp_tables := 'S';

      if v_atualiza_exp_tables = 'S' then
        v_atualiza_exp_tables := atualiza_versao_pck.exp_tables_rule_001(tep.table_name);
      end if;

      if v_atualiza_exp_tables = 'S' then
        v_atualiza_exp_tables := atualiza_versao_pck.exp_tables_rule_002(tep.table_name);
      end if;

      if v_atualiza_exp_tables = 'S' then
        v_atualiza_exp_tables := atualiza_versao_pck.exp_tables_rule_003(tep.table_name);
      end if;

      if v_atualiza_exp_tables = 'S' then
        if tep.ie_atualizar = 'S' then
          CALL atualiza_versao_pck.gen_update_records(tep.table_name,
                             tep.ds_campo_atualizacao,
                             v_reg_count);
        end if;

        if tep.ie_copiar = 'S' then
          CALL atualiza_versao_pck.gen_insert_records(tep.table_name,
                             tep.ds_campo_copia,
                             v_reg_count);
        end if;

        if tep.ie_excluir = 'S' then
          CALL atualiza_versao_pck.gen_delete_records(tep.table_name,
                             tep.ds_campo_exclusao,
                             v_reg_count);
        end if;
      end if;
    end loop;
    CALL atualiza_versao_pck.after_update_exp_tables();
    commit;
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Prepara os objetos PLSQL e cria os registros para atualização dos objetos
  -- no banco de dados.
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.update_exp_tables () FROM PUBLIC;
