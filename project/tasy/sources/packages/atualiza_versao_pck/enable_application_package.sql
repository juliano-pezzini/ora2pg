-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE atualiza_versao_pck.enable_application (p_cd_versao_destino text) AS $body$
DECLARE

    v_cmd text;

BEGIN
    v_cmd := '
declare
  v_exists number;
begin
  tasy_alterar_versao_tasy(''' || p_cd_versao_destino ||
             ''', ''atualizacao'');

  update aplicacao_tasy
     set ie_status_aplicacao = ''A''
   where cd_aplicacao_tasy = ''Tasy'';

  select count(1)
    into v_exists
    from aplicacao_tasy_versao
   where cd_versao = ''' || p_cd_versao_destino || '''
     and cd_aplicacao_tasy = ''Tasy'';

  if v_exists = 0 then
    atualiza_versao_tasy(''Tasy'', ''' || p_cd_versao_destino ||
             ''', ''atualizacao'', ''S'');
  end if;

  commit;
end;
';
    CALL atualiza_versao_pck.insert_cmd(p_operacao => 'ENABLE APPLICATION', p_cmd => v_cmd);
  end;

  --------------------------------------------------------------------------------------
  --                                                                                 
  -- Atualiza a tabela de instruções com os comandos para atualização da base.
  --                                                                                 
  --------------------------------------------------------------------------------------
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE atualiza_versao_pck.enable_application (p_cd_versao_destino text) FROM PUBLIC;
