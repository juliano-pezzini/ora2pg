-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE grava_dados_api_cnes_pck.consultar_cnes ( cd_cnes_p cnes_api_estabelecimento.cd_cnes%type, ie_origem_consulta_p cnes_api_estabelecimento.ie_origem_consulta%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

nr_seq_estabelecimento_w	cnes_api_estabelecimento.nr_sequencia%type;
json_w				philips_json;
json_data_w			text;

BEGIN

insert	into	cnes_api_estabelecimento(	nr_sequencia, cd_cnes, dt_atualizacao,
		nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		ie_status, ie_origem_consulta )
	values (nextval('cnes_api_estabelecimento_seq'), cd_cnes_p, clock_timestamp(),
		nm_usuario_p, clock_timestamp(), nm_usuario_p,
		1, ie_origem_consulta_p )
	returning nr_sequencia into nr_seq_estabelecimento_w;

commit;

json_w := philips_json();
json_w.put('estabelecimento', to_char(nr_seq_estabelecimento_w));
json_w.put('codigo', cd_cnes_p);
dbms_lob.createtemporary(json_data_w, TRUE);
json_w.(json_data_w);

json_data_w := bifrost.send_integration_content('cnes.querydata.request.execute',
						json_data_w,
						'WebServiceTIE');

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE grava_dados_api_cnes_pck.consultar_cnes ( cd_cnes_p cnes_api_estabelecimento.cd_cnes%type, ie_origem_consulta_p cnes_api_estabelecimento.ie_origem_consulta%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
