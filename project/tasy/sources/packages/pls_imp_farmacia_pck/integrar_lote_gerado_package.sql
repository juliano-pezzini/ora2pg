-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_imp_farmacia_pck.integrar_lote_gerado ( nr_seq_lote_p pls_lote_protocolo_conta.nr_sequencia%type, nr_seq_tipo_conta_p pls_conta.nr_seq_tipo_conta%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
DECLARE

				
current_setting('pls_imp_farmacia_pck.nr_seq_protocolo_w')::pls_protocolo_conta.nr_sequencia%type      pls_protocolo_conta.nr_sequencia%type;

BEGIN

  select	max(nr_sequencia)
  into STRICT	current_setting('pls_imp_farmacia_pck.nr_seq_protocolo_w')::pls_protocolo_conta.nr_sequencia%type
  from	pls_protocolo_conta
  where	nr_seq_lote_conta = nr_seq_lote_p;

  update   pls_protocolo_conta
  set    dt_integracao = clock_timestamp(),
      ie_situacao  ='T',
      nm_usuario = nm_usuario_p,
      dt_atualizacao = clock_timestamp()
  where   nr_seq_lote_conta = nr_seq_lote_p;

   commit;

  if (current_setting('pls_imp_farmacia_pck.nr_seq_protocolo_w')::pls_protocolo_conta.nr_sequencia%(type IS NOT NULL AND type::text <> '')) then
		update	pls_conta
		set		nr_seq_tipo_conta = nr_seq_tipo_conta_p
		where	nr_seq_protocolo = current_setting('pls_imp_farmacia_pck.nr_seq_protocolo_w')::pls_protocolo_conta.nr_sequencia%type
		and		coalesce(nr_seq_tipo_conta::text, '') = '';
		
		commit;
  end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_farmacia_pck.integrar_lote_gerado ( nr_seq_lote_p pls_lote_protocolo_conta.nr_sequencia%type, nr_seq_tipo_conta_p pls_conta.nr_seq_tipo_conta%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
