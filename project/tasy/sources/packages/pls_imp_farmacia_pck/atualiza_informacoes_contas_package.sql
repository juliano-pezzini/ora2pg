-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_imp_farmacia_pck.atualiza_informacoes_contas ( nr_seq_protocolo_p pls_conta.nr_seq_protocolo%type) AS $body$
DECLARE


C01 CURSOR FOR
  SELECT  a.nr_sequencia,
    a.nm_usuario,
      (SELECT sum(vl_material) from pls_conta_mat where nr_seq_conta = a.nr_sequencia) vl_total_materiais
  from  pls_conta a
  where  a.nr_seq_protocolo = nr_seq_protocolo_p;

BEGIN

  for r_c01_w in C01 loop

    update   pls_conta
    set   vl_total = r_c01_w.vl_total_materiais,
        vl_total_imp = r_c01_w.vl_total_materiais
    where   nr_sequencia = r_c01_w.nr_sequencia;

    CALL pls_cta_proc_mat_regra_pck.gera_seq_tiss_conta_proc(r_c01_w.nr_sequencia, r_c01_w.nm_usuario);
    CALL pls_cta_proc_mat_regra_pck.gera_seq_tiss_conta_mat(r_c01_w.nr_sequencia, r_c01_w.nm_usuario);

  end loop;


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_imp_farmacia_pck.atualiza_informacoes_contas ( nr_seq_protocolo_p pls_conta.nr_seq_protocolo%type) FROM PUBLIC;
