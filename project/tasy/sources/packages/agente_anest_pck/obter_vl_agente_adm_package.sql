-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION agente_anest_pck.obter_vl_agente_adm ( ie_tipo_agente_p bigint, nr_cirurgia_p bigint, cd_estabelecimento_p bigint, ie_tipo_Halogenado_p bigint default null) RETURNS varchar AS $body$
DECLARE

		
	nr_seq_agente_anest_w  		bigint;
	nr_sequencia_ww			bigint;
	qt_velocidade_w			varchar(10);
	
BEGIN

	nr_seq_agente_anest_w		:= agente_anest_pck.obter_agente_anestesico(	ie_tipo_agente_p,
									cd_estabelecimento_p,
									ie_tipo_Halogenado_p);
	select 	max(nr_sequencia)
	into STRICT	nr_sequencia_ww
	from	cirurgia_agente_anestesico
	where 	nr_seq_agente 		= nr_seq_agente_anest_w
	and	nr_cirurgia		= nr_cirurgia_p;
	
	select 	max(qt_velocidade_inf)
	into STRICT	qt_velocidade_w
	from	cirurgia_agente_anest_ocor
	where	nr_seq_cirur_agente = nr_sequencia_ww
	and	coalesce(dt_final_adm::text, '') = '';
	
	return 	coalesce(qt_velocidade_w,0);
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION agente_anest_pck.obter_vl_agente_adm ( ie_tipo_agente_p bigint, nr_cirurgia_p bigint, cd_estabelecimento_p bigint, ie_tipo_Halogenado_p bigint default null) FROM PUBLIC;
