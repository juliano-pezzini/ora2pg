-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_online_pck.get_agrup_sequencial (cd_empresa_p bigint, dt_referencia_p timestamp) RETURNS bigint AS $body$
DECLARE


nr_seq_agrupamento_w ctb_movimento.nr_seq_agrupamento%type;


BEGIN

  select max(a.nr_seq_agrupamento)
  into STRICT   nr_seq_agrupamento_w
  from   ctb_movimento a,
          ctb_mes_ref   b
  where  a.nr_Seq_mes_ref = b.nr_sequencia
  and    b.cd_empresa = cd_empresa_p
  and    trunc(b.dt_referencia,'yyyy') = trunc(dt_referencia_p,'yyyy');

  return nr_seq_agrupamento_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_online_pck.get_agrup_sequencial (cd_empresa_p bigint, dt_referencia_p timestamp) FROM PUBLIC;
