-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tax_reinf_data_pck.get_data_r2098 (batch_code_p text) RETURNS SETOF R2098_TABLE_W AS $body$
DECLARE

    r2098_data_w    r2098_record_w;

    c_r2098 CURSOR FOR
      SELECT  tax_reinf_data_pck.get_event_id(e.cd_cgc, rownum) identification,
              f.ie_tipo_ambiente  environment_type,
              '1' emission,	   
              '1' subscription_type,
              substr(e.cd_cgc, 1, 8) subscription, 
              to_char(f.dt_apuracao, 'rrrr-mm') calculation_period
      from    estabelecimento e,
              fis_reinf_r2098 f
      where   e.cd_estabelecimento = f.cd_estabelecimento
      and     f.nr_sequencia = batch_code_p;

BEGIN
    for r2098_row in c_r2098 loop
      begin
        r2098_data_w.identification       := r2098_row.identification;
        r2098_data_w.environment_type     := r2098_row.environment_type;
        r2098_data_w.emission             := r2098_row.emission;
        r2098_data_w.subscription_type    := r2098_row.subscription_type;
        r2098_data_w.subscription         := r2098_row.subscription;
        r2098_data_w.calculation_period   := r2098_row.calculation_period;
        RETURN NEXT r2098_data_w;
      end;
    end loop;
    return;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tax_reinf_data_pck.get_data_r2098 (batch_code_p text) FROM PUBLIC;
