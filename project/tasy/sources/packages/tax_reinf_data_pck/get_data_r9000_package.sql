-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tax_reinf_data_pck.get_data_r9000 (batch_code_p text) RETURNS SETOF R9000_TABLE_W AS $body$
DECLARE

    r9000_data_w    r9000_record_w;

    c_r9000 CURSOR FOR
      SELECT  tax_reinf_data_pck.get_event_id(e.cd_cgc, rownum) identification,
              f.ie_ambiente  environment_type,
              '1' emission,	   
              '1' subscription_type,
              substr(e.cd_cgc, 1, 8) subscription, 
              f.ie_tipo_evento deletion_event,
              f.nr_recibo event_receipt,
              to_char(f.dt_apuracao, 'rrrr-mm') calculation_period
      from    estabelecimento e,
              fis_reinf_r9000 f
      where   e.cd_estabelecimento = f.cd_estabelecimento
      and     f.nr_sequencia = batch_code_p;

BEGIN
    for r9000_row in c_r9000 loop
      begin
        r9000_data_w.identification       := r9000_row.identification;
        r9000_data_w.environment_type     := r9000_row.environment_type;
        r9000_data_w.emission             := r9000_row.emission;
        r9000_data_w.subscription_type    := r9000_row.subscription_type;
        r9000_data_w.subscription         := r9000_row.subscription;
        r9000_data_w.deletion_event       := r9000_row.deletion_event;
        r9000_data_w.event_receipt        := r9000_row.event_receipt;
        r9000_data_w.calculation_period   := r9000_row.calculation_period;
        RETURN NEXT r9000_data_w;
      end;
    end loop;
    return;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tax_reinf_data_pck.get_data_r9000 (batch_code_p text) FROM PUBLIC;
