-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tax_reinf_data_pck.get_data_r5011 (batch_code_p text) RETURNS SETOF R5011_TABLE_W AS $body$
DECLARE

    r5011_data_w    r5011_record_w;

  c_5011 CURSOR FOR
    SELECT  '1' subscription_type,
            substr(e.cd_cgc, 1, 8)  subscription, 
            f.ds_protocolo protocol
    from    estabelecimento e,
            fis_reinf_r2099 f
    where   e.cd_estabelecimento = f.cd_estabelecimento
    and     f.nr_sequencia = batch_code_p;

BEGIN
    for r5011_row in c_5011 loop
      begin
        r5011_data_w.subscription_type    := r5011_row.subscription_type;
        r5011_data_w.subscription         := r5011_row.subscription;
        r5011_data_w.protocol             := r5011_row.protocol;
        RETURN NEXT r5011_data_w;
      end;
    end loop;
    return;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tax_reinf_data_pck.get_data_r5011 (batch_code_p text) FROM PUBLIC;
