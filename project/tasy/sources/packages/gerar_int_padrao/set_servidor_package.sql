-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE gerar_int_padrao.set_servidor ( nr_seq_servidor_p servidor_integracao.nr_sequencia%type, ie_pool_p text, ie_incrementar_p text, ie_limpar_p text default 'N') AS $body$
DECLARE

		
i			integer;
ie_achou_w		varchar(1) := 'N';
qt_processando_w	bigint;


BEGIN
if (ie_limpar_p = 'S') then
	current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg.delete;
end if;

if (nr_seq_servidor_p > 0) then
	begin
	for i in 0..v_serv_reg_w.count-1 loop
		begin
		if (current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].nr_seq_servidor = nr_seq_servidor_p) then
			begin
			if (ie_incrementar_p = 'S') then
				current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].qt_processando	:=	current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].qt_processando + 1;
			end if;
			
			current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].ie_pool		:=	coalesce(ie_pool_p, current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].ie_pool);
			ie_achou_w	:=	'S';
			end;
		end if;
		end;
	end loop;

	if (ie_achou_w = 'N') then
		begin
		i	:=	current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg.count;
		current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].nr_seq_servidor	:=	nr_seq_servidor_p;
		
		select	count(1)
		into STRICT	qt_processando_w
		from	intpd_fila_transmissao
		where	nr_seq_servidor = nr_seq_servidor_p
		and	ie_envio_recebe in ('E', 'C')
		and	ie_status = 'R';
			
		current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].qt_processando	:=	qt_processando_w;
		current_setting('gerar_int_padrao.v_serv_reg_w')::v_serv_reg[i].ie_pool		:=	ie_pool_p;
		end;
	end if;
	end;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_int_padrao.set_servidor ( nr_seq_servidor_p servidor_integracao.nr_sequencia%type, ie_pool_p text, ie_incrementar_p text, ie_limpar_p text default 'N') FROM PUBLIC;
