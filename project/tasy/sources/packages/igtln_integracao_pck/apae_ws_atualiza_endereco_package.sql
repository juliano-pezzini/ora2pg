-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


	-- Atualiza dados endere√ßo
CREATE OR REPLACE PROCEDURE igtln_integracao_pck.apae_ws_atualiza_endereco ( cd_pessoa_fisica_p text, nm_usuario_p text, ds_endereco_p text, nr_endereco_p text, ds_bairro_p text, ds_municipio_p text, sg_estado_p text, cd_cep_p text) AS $body$
DECLARE

	nr_sequencia_w	bigint;
	tag_pais_w	varchar(15);
	
BEGIN
		select	max(ds_locale)
		into STRICT	tag_pais_w
		from	user_locale
		where	nm_user = nm_usuario_p;

		select	max(nr_sequencia)
		into STRICT 	nr_sequencia_w
		from	compl_pessoa_fisica
		where	ie_tipo_complemento = 1
		and 	cd_pessoa_fisica = cd_pessoa_fisica_p;

		if (coalesce(nr_sequencia_w::text, '') = '') then
			select	coalesce(max(nr_sequencia),0) + 1
			into STRICT	nr_sequencia_w
			from	compl_pessoa_fisica
			where	cd_pessoa_fisica = cd_pessoa_fisica_p;

			if (tag_pais_w = 'de_DE')then
				insert into compl_pessoa_fisica(
					nr_sequencia,
					cd_pessoa_fisica,
					ie_tipo_complemento,
					dt_atualizacao,
					nm_usuario,
					ds_endereco,
					ds_compl_end,
					ds_bairro,
					ds_municipio,
					sg_estado,
					cd_cep
				) values (
					nr_sequencia_w,
					cd_pessoa_fisica_p,
					1,
					clock_timestamp(),
					nm_usuario_p,
					ds_endereco_p,
					nr_endereco_p,
					ds_bairro_p,
					ds_municipio_p,
					sg_estado_p,
					cd_cep_p
				);
			else
				insert into compl_pessoa_fisica(
					nr_sequencia,
					cd_pessoa_fisica,
					ie_tipo_complemento,
					dt_atualizacao,
					nm_usuario,
					ds_endereco,
					nr_endereco,
					ds_bairro,
					ds_municipio,
					sg_estado,
					cd_cep
				) values (
					nr_sequencia_w,
					cd_pessoa_fisica_p,
					1,
					clock_timestamp(),
					nm_usuario_p,
					ds_endereco_p,
					nr_endereco_p,
					ds_bairro_p,
					ds_municipio_p,
					sg_estado_p,
					cd_cep_p
				);
			end if;
		else
			if (tag_pais_w = 'de_DE')then
				update	compl_pessoa_fisica
				set	dt_atualizacao = clock_timestamp(),
					nm_usuario = nm_usuario_p,
					ds_endereco = ds_endereco_p,
					ds_compl_end = nr_endereco_p,
					ds_bairro = ds_bairro_p,
					ds_municipio = ds_municipio_p,
					sg_estado = sg_estado_p,
					cd_cep = cd_cep_p
				where	nr_sequencia = nr_sequencia_w
				and		ie_tipo_complemento = 1
				and		cd_pessoa_fisica = cd_pessoa_fisica_p;
			else
				update	compl_pessoa_fisica
				set	dt_atualizacao = clock_timestamp(),
					nm_usuario = nm_usuario_p,
					ds_endereco = ds_endereco_p,
					nr_endereco = nr_endereco_p,
					ds_bairro = ds_bairro_p,
					ds_municipio = ds_municipio_p,
					sg_estado = sg_estado_p,
					cd_cep = cd_cep_p
				where	nr_sequencia = nr_sequencia_w
				and		ie_tipo_complemento = 1
				and		cd_pessoa_fisica = cd_pessoa_fisica_p;
			end if;
		end if;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE igtln_integracao_pck.apae_ws_atualiza_endereco ( cd_pessoa_fisica_p text, nm_usuario_p text, ds_endereco_p text, nr_endereco_p text, ds_bairro_p text, ds_municipio_p text, sg_estado_p text, cd_cep_p text) FROM PUBLIC;
