-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


	-- Grava ficha paciente
CREATE OR REPLACE PROCEDURE igtln_integracao_pck.apae_ws_grava_ficha ( nr_sequencia_sec_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, cd_prontuario_f_p text, cd_barras_p text, cd_dnv_f_p text, nr_cartao_nac_sus_p text, dt_nascimento_f_p text, hr_nascimento_f_p text, ie_periodo_nasc_f_p text, qt_peso_f_p bigint, ie_sexo_f_p text, ie_cor_pf_f_p text, nr_idade_gest_f_p bigint, dt_coleta_ficha_f_p text, hr_coleta_f_p text, ie_periodo_col_f_p text, ie_npp_f_p text, ie_amamentado_f_p text, ie_alim_leite_f_p text, ie_premat_s_f_p text, ie_transfusao_f_p text, dt_transf_f_p text, ie_ictericia_f_p text, ie_susp_am_inad_p text, ie_amostra_p text, nr_seq_grau_parentesco_p bigint, nm_mae_f_p text, ie_gemelar_f_p text, ie_corticoide_f_p text, ie_mae_veg_f_p text, dt_ult_menst_p text, qt_gest_f_p text, ie_tipo_parto_p text, ie_aborto_p text, qt_aborto_p text, nr_sisprenatal_p text, nr_prontuario_ex_p text, nr_ficha_ext_p text, cd_usuario_conv_ext_p text, cd_lote_f_p text, cd_pessoa_externa_p text, ds_observacao_p text, ie_ficha_urg_p text, nr_seq_tipo_mat_lote_p text, dt_fabricacao_p text, dt_validade_p text, nr_sequencia_out_p INOUT bigint) AS $body$
DECLARE

	nr_sequencia_w	bigint;
	
BEGIN
		if (nr_sequencia_sec_p IS NOT NULL AND nr_sequencia_sec_p::text <> '') then
			select	nextval('lote_ent_sec_ficha_seq')
			into STRICT	nr_sequencia_w
			;

			insert into lote_ent_sec_ficha(
				nr_sequencia,
				nr_seq_lote_sec,
				dt_atualizacao,
				nm_usuario,
				cd_pessoa_fisica,
				cd_prontuario_f,
				cd_barras,
				cd_dnv_f,
				nr_cartao_nac_sus,
				dt_nascimento_f,
				hr_nascimento_f,
				ie_periodo_nasc_f,
				qt_peso_f,
				ie_sexo_f,
				ie_cor_pf_f,
				nr_idade_gest_f,
				dt_coleta_ficha_f,
				hr_coleta_f,
				ie_periodo_col_f,
				ie_npp_f,
				ie_amamentado_f,
				ie_alim_leite_f,
				ie_premat_s_f,
				ie_transfusao_f,
				dt_transf_f,
				ie_ictericia_f,
				ie_susp_am_inad,
				ie_amostra,
				nr_seq_grau_parentesco,
				nm_mae_f,
				ie_gemelar_f,
				ie_corticoide_f,
				ie_mae_veg_f,
				dt_ult_menst,
				qt_gest_f,
				ie_tipo_parto,
				ie_aborto,
				qt_aborto,
				nr_sisprenatal,
				nr_prontuario_ex,
				nr_ficha_ext,
				cd_usuario_conv_ext,
				cd_lote_f,
				cd_pessoa_externa,
				ds_observacao,
				ie_ficha_urg,
				ie_ficha_adicional,
				nr_seq_tipo_mat_lote,
				dt_fabricacao,
				dt_validade
			) values (
				nr_sequencia_w,
				nr_sequencia_sec_p,
				clock_timestamp(),
				nm_usuario_p,
				cd_pessoa_fisica_p,
				cd_prontuario_f_p,
				cd_barras_p,
				cd_dnv_f_p,
				nr_cartao_nac_sus_p,
				TO_DATE(dt_nascimento_f_p,'dd-mm-yyyy'),
				TO_DATE(hr_nascimento_f_p, 'hh24:mi'),
				ie_periodo_nasc_f_p,
				qt_peso_f_p,
				ie_sexo_f_p,
				ie_cor_pf_f_p,
				nr_idade_gest_f_p,
				TO_DATE(dt_coleta_ficha_f_p,'dd-mm-yyyy'),
				TO_DATE(hr_coleta_f_p, 'hh24:mi'),
				ie_periodo_col_f_p,
				ie_npp_f_p,
				ie_amamentado_f_p,
				ie_alim_leite_f_p,
				ie_premat_s_f_p,
				ie_transfusao_f_p,
				TO_DATE(dt_transf_f_p,'dd-mm-yyyy'),
				ie_ictericia_f_p,
				coalesce(ie_susp_am_inad_p, 'I'),
				ie_amostra_p,
				nr_seq_grau_parentesco_p,
				nm_mae_f_p,
				ie_gemelar_f_p,
				ie_corticoide_f_p,
				ie_mae_veg_f_p,
				TO_DATE(dt_ult_menst_p,'dd-mm-yyyy'),
				qt_gest_f_p,
				ie_tipo_parto_p,
				ie_aborto_p,
				qt_aborto_p,
				nr_sisprenatal_p,
				nr_prontuario_ex_p,
				nr_ficha_ext_p,
				cd_usuario_conv_ext_p,
				cd_lote_f_p,
				cd_pessoa_externa_p,
				ds_observacao_p,
				ie_ficha_urg_p,
				'N',
				nr_seq_tipo_mat_lote_p,
				TO_DATE(dt_fabricacao_p,'dd-mm-yyyy'),
				TO_DATE(dt_validade_p,'dd-mm-yyyy')
				);
		end if;

	nr_sequencia_out_p := nr_sequencia_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE igtln_integracao_pck.apae_ws_grava_ficha ( nr_sequencia_sec_p bigint, nm_usuario_p text, cd_pessoa_fisica_p text, cd_prontuario_f_p text, cd_barras_p text, cd_dnv_f_p text, nr_cartao_nac_sus_p text, dt_nascimento_f_p text, hr_nascimento_f_p text, ie_periodo_nasc_f_p text, qt_peso_f_p bigint, ie_sexo_f_p text, ie_cor_pf_f_p text, nr_idade_gest_f_p bigint, dt_coleta_ficha_f_p text, hr_coleta_f_p text, ie_periodo_col_f_p text, ie_npp_f_p text, ie_amamentado_f_p text, ie_alim_leite_f_p text, ie_premat_s_f_p text, ie_transfusao_f_p text, dt_transf_f_p text, ie_ictericia_f_p text, ie_susp_am_inad_p text, ie_amostra_p text, nr_seq_grau_parentesco_p bigint, nm_mae_f_p text, ie_gemelar_f_p text, ie_corticoide_f_p text, ie_mae_veg_f_p text, dt_ult_menst_p text, qt_gest_f_p text, ie_tipo_parto_p text, ie_aborto_p text, qt_aborto_p text, nr_sisprenatal_p text, nr_prontuario_ex_p text, nr_ficha_ext_p text, cd_usuario_conv_ext_p text, cd_lote_f_p text, cd_pessoa_externa_p text, ds_observacao_p text, ie_ficha_urg_p text, nr_seq_tipo_mat_lote_p text, dt_fabricacao_p text, dt_validade_p text, nr_sequencia_out_p INOUT bigint) FROM PUBLIC;
