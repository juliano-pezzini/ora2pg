-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE fis_invoice_cancel_integ_mx.send_integration ( nr_seq_nota_p nota_fiscal.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tie_p boolean) AS $body$
DECLARE

	
		nr_seq_transmissao_w	nfe_transmissao.nr_sequencia%type;
		nr_seq_log_integracao_w	varchar(100);
		json_w 					text;
		ds_evento_w				varchar(15) := 'invoice_cancel';
		ds_java_class_w			varchar(70) := 'com.philips.tasy.integration.invoice.callback.CancelInvoiceCallback';
		result_int_w            varchar(100);
	
BEGIN
		
		SELECT * FROM fis_invoice_cancel_integ_mx.generate_invoice_logs(	nr_seq_nota_p			=>	nr_seq_nota_p, nm_usuario_p			=>	nm_usuario_p, cd_estabelecimento_p	=>	cd_estabelecimento_p, nr_seq_transmissao_p	=>	nr_seq_transmissao_w, nr_seq_log_integracao_p	=>	nr_seq_log_integracao_w, ie_tie_p				=>	ie_tie_p) INTO STRICT nr_seq_transmissao_p	=>	nr_seq_transmissao_w, nr_seq_log_integracao_p	=>	nr_seq_log_integracao_w;
		if (ie_tie_p) then
			json_p					=> 	json_w := fis_invoice_cancel_integ_mx.generate_json(	nr_seq_nota_p			=>	nr_seq_nota_p, nm_usuario_p			=>	nm_usuario_p, cd_estabelecimento_p	=>	cd_estabelecimento_p, nr_seq_transmissao_p	=>	nr_seq_transmissao_w, nr_seq_log_integracao_p	=>	nr_seq_log_integracao_w, json_p					=> 	json_w);
		
		
			result_int_w := bifrost_invoice_integration(	ds_event_p		=>	ds_evento_w,
								ds_java_class_p =>	ds_java_class_w,
								ds_parameters_p =>	json_w,
								ds_user_p		=>	nm_usuario_p,
								nr_seq_log_p	=>	nr_seq_log_integracao_w,
								nr_evento_p		=>	'168',
								cd_estabelecimento_p	=>	cd_estabelecimento_p);
		end if;

	end;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_invoice_cancel_integ_mx.send_integration ( nr_seq_nota_p nota_fiscal.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, ie_tie_p boolean) FROM PUBLIC;
