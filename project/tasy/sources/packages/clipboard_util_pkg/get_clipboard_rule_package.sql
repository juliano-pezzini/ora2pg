-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clipboard_util_pkg.get_clipboard_rule ( ie_record_type_p text ) RETURNS SETOF T_CLIPBOARD_RULE AS $body$
DECLARE


        r_rule_row_w   t_clipboard_rule_row;
        nr_seq_w       bigint;
        c01 CURSOR FOR
        SELECT DISTINCT
            z.ie_field,
            z.nm_field,
            z.ds_expressao,
            z.nr_seq,
            z.nr_seq_display
        FROM (
                SELECT
                    a.nr_sequencia      nr_seq,
                    b.ie_field,
                    b.nm_field,
                    coalesce(b.nr_seq_display, 0) nr_seq_display,
                    get_clipboard_field_desc(b.ie_field, a.ie_med_rec_type) ds_expressao,
                    a.ie_med_rec_type   ie_med_rec_type
                FROM
                    clinical_note_settings   a,
                    clinical_note_fields     b
                WHERE
                    a.nr_sequencia = b.nr_seq_settings
                    AND a.ie_situacao = 'A'
                    AND a.ie_med_rec_type = ie_record_type_p
                    AND a.ie_data_type = 'CLIPBOARD'
                    AND b.ie_copy_field = 'S'
                ORDER BY
                    coalesce(b.nr_seq_display, 0)
            ) z;


BEGIN
        FOR r_c01 IN c01 LOOP BEGIN
            r_rule_row_w.ie_field := r_c01.ie_field;
            r_rule_row_w.nm_field := r_c01.nm_field;
            r_rule_row_w.ds_expressao := r_c01.ds_expressao;
            r_rule_row_w.nr_seq := r_c01.nr_seq;
            r_rule_row_w.nr_seq_display := r_c01.nr_seq_display;
            RETURN NEXT  r_rule_row_w;
        END;
        END LOOP;

        return;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION clipboard_util_pkg.get_clipboard_rule ( ie_record_type_p text ) FROM PUBLIC;
