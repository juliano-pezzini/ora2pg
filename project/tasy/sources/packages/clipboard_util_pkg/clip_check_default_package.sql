-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE clipboard_util_pkg.clip_check_default ( record_type_p text, nr_sequence_p bigint ) AS $body$
DECLARE

        def_cnt_w     bigint;
        is_seq_pr_w   bigint;

BEGIN
        SELECT
            COUNT(1)
        INTO STRICT def_cnt_w
        FROM
            clinical_note_settings
        WHERE
            ie_data_type = 'CLIPBOARD'
            AND ie_med_rec_type = record_type_p
            AND ie_default_rule = 'S'
            AND ie_situacao = 'A';

        SELECT
            COUNT(*)
        INTO STRICT is_seq_pr_w
        FROM
            clinical_note_settings
        WHERE
            nr_sequencia = nr_sequence_p;

        IF ( def_cnt_w = 0 AND is_seq_pr_w > 0 ) THEN
            UPDATE clinical_note_settings
            SET
                ie_default_rule = 'S'
            WHERE
                ie_data_type = 'CLIPBOARD'
                AND ie_med_rec_type = record_type_p
                AND nr_sequencia = nr_sequence_p;

        ELSE
            CALL wheb_mensagem_pck.exibir_mensagem_abort(1146821);
        END IF;

    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE clipboard_util_pkg.clip_check_default ( record_type_p text, nr_sequence_p bigint ) FROM PUBLIC;
