-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clipboard_util_pkg.get_content_clinc_stf ( nr_atendimento_p bigint, nr_sequencia_p text, ie_record_type_p text, config_option_p bigint ) RETURNS varchar AS $body$
DECLARE


        ds_content_w   varchar(32000);
        att_phy_w      varchar(1000);
        pri_nur_w      varchar(1000);
        asist_phy_w    varchar(1000);
        sec_nur_w      varchar(1000);
        c01 CURSOR FOR
        SELECT
            *
        FROM
            TABLE( clipboard_util_pkg.get_clipboard_rule(ie_record_type_p) )
        WHERE
            nr_seq = config_option_p
        ORDER BY
            nr_seq_display ASC;


BEGIN

            SELECT DISTINCT
                obter_clinical_staff(nr_atendimento_p, 1),
                obter_clinical_staff(nr_atendimento_p, 2),
                obter_clinical_staff(nr_atendimento_p, 3),
                obter_clinical_staff(nr_atendimento_p, 4)
            INTO STRICT
                att_phy_w,
                pri_nur_w,
                asist_phy_w,
                sec_nur_w
            FROM atendimento_paciente x, funcao_medico b, atend_paciente_medico a, pessoa_fisica c
LEFT OUTER JOIN usuario u ON (c.cd_pessoa_fisica = u.cd_pessoa_fisica)
WHERE x.nr_atendimento = a.nr_atendimento and a.nr_seq_func_medico = b.cd_funcao AND a.cd_profissional = c.cd_pessoa_fisica  AND x.nr_atendimento = nr_atendimento_p;

            FOR r_c01 IN c01 LOOP IF ( ie_record_type_p = 'CLINIC_STAFF' ) THEN
                IF ( r_c01.ie_field = 'ATT_PHY' ) THEN
                    IF (att_phy_w IS NOT NULL AND att_phy_w::text <> '') THEN
                        ds_content_w := ds_content_w
                                        || '</br>'
                                        || coalesce(r_c01.nm_field, r_c01.ds_expressao)
                                        || ' - '
                                        || att_phy_w;

                    END IF;
                END IF;

                IF ( r_c01.ie_field = 'PRI_NUR' ) THEN
                    IF (pri_nur_w IS NOT NULL AND pri_nur_w::text <> '') THEN
                        ds_content_w := ds_content_w
                                        || '</br>'
                                        || coalesce(r_c01.nm_field, r_c01.ds_expressao)
                                        || ' - '
                                        || pri_nur_w;

                    END IF;

                END IF;

                IF ( r_c01.ie_field = 'SEC_PHY' ) THEN
                    IF (asist_phy_w IS NOT NULL AND asist_phy_w::text <> '') THEN
                        ds_content_w := ds_content_w
                                        || '</br>'
                                        || coalesce(r_c01.nm_field, r_c01.ds_expressao)
                                        || ' - '
                                        || asist_phy_w;

                    END IF;
                END IF;

                IF ( r_c01.ie_field = 'SEC_NURSE' ) THEN
                    IF (sec_nur_w IS NOT NULL AND sec_nur_w::text <> '') THEN
                        ds_content_w := ds_content_w
                                        || '</br>'
                                        || coalesce(r_c01.nm_field, r_c01.ds_expressao)
                                        || ' - '
                                        || sec_nur_w;

                    END IF;
                END IF;

            END IF;
            END LOOP;

            ds_content_w := ds_content_w || '</br>';

        RETURN ds_content_w;
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION clipboard_util_pkg.get_content_clinc_stf ( nr_atendimento_p bigint, nr_sequencia_p text, ie_record_type_p text, config_option_p bigint ) FROM PUBLIC;
