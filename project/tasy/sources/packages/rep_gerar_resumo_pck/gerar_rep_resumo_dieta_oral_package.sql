-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE rep_gerar_resumo_pck.gerar_rep_resumo_dieta_oral () AS $body$
DECLARE

	
	nm_dieta_w		varchar(80);
	qt_parametro_w		double precision;
	ds_unidade_medida_w	varchar(20);
	ds_observacao_w		varchar(255);
	ds_justificativa_w	varchar(255);
	ie_suspenso_w		varchar(1);
	ds_horarios_w		varchar(2000);
	
	C01 CURSOR FOR
	SELECT	b.nm_dieta,
		a.qt_parametro,
		b.ds_unidade_medida,
		substr(a.ds_observacao,1,255),
		substr(a.ds_justificativa,1,255),
		a.ie_suspenso,
		a.ds_horarios
	from	dieta b,
		prescr_dieta a
	where	a.cd_dieta	= b.cd_dieta
	and	a.nr_prescricao	= nr_prescricao_w;
	
	
BEGIN
	PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', '', false);
	open C01;
	loop
	fetch C01 into	
		nm_dieta_w,
		qt_parametro_w,
		ds_unidade_medida_w,
		ds_observacao_w,
		ds_justificativa_w,
		ie_suspenso_w,
		ds_horarios_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin

		if (current_setting('rep_gerar_resumo_pck.ie_rtf_w')::varchar(1) = 'N') then
			PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text ||
					rep_gerar_resumo_pck.get_tr_html(nm_dieta_w, to_char(qt_parametro_w) , ds_unidade_medida_w, null,
							null, null, ds_horarios_w, ie_suspenso_w, 7),1,30000), false);
			
			if (ds_observacao_w IS NOT NULL AND ds_observacao_w::text <> '') then
				PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text || rep_gerar_resumo_pck.get_tr_html_obs(ds_observacao_w),1,30000), false);
			end if;
			
			if (ds_justificativa_w IS NOT NULL AND ds_justificativa_w::text <> '') then
				PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text || rep_gerar_resumo_pck.get_tr_html_justif(ds_justificativa_w),1,30000), false);
			end if;
			
		else
			PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text ||
					rep_gerar_resumo_pck.get_tr_rtf(nm_dieta_w, to_char(qt_parametro_w) , ds_unidade_medida_w, null,
							null, ds_observacao_w, ds_horarios_w, 7),1,30000), false);
		end if;
		
		end;
	end loop;
	close C01;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rep_gerar_resumo_pck.gerar_rep_resumo_dieta_oral () FROM PUBLIC;
