-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE rep_gerar_resumo_pck.gerar_rep_resumo_opm () AS $body$
DECLARE


	ds_procedimento_w		varchar(255);
	ds_observacao_w			varchar(2000);

	C01 CURSOR FOR
	SELECT	substr(Obter_Desc_Prescr_Proc(cd_procedimento, ie_origem_proced, null),1,255),
		substr(a.ds_observacao,1,2000)
	from	prescr_opme a
	where	a.nr_prescricao	= nr_prescricao_w
	and	(a.cd_procedimento IS NOT NULL AND a.cd_procedimento::text <> '')
	
union all

	SELECT	substr(Obter_Desc_Prescr_Proc(cd_procedimento, ie_origem_proced, null),1,255),
		substr(a.ds_observacao,1,2000)
	from	prescr_protese_ms a
	where	a.nr_prescricao	= nr_prescricao_w
	and	(a.cd_procedimento IS NOT NULL AND a.cd_procedimento::text <> '')
	
union all

	select	substr(Obter_Desc_Prescr_Proc(cd_procedimento, ie_origem_proced, null),1,255),
		substr(a.ds_observacao,1,2000)
	from	prescr_protese_mi a
	where	a.nr_prescricao	= nr_prescricao_w
	and	(a.cd_procedimento IS NOT NULL AND a.cd_procedimento::text <> '')
	
union all

	select	substr(Obter_Desc_Prescr_Proc(cd_procedimento, ie_origem_proced, null),1,255),
		substr(a.ds_observacao,1,2000)
	from	prescr_meio_locomocao a
	where	a.nr_prescricao	= nr_prescricao_w
	and	(a.cd_procedimento IS NOT NULL AND a.cd_procedimento::text <> '')
	
union all

	select	substr(Obter_Desc_Prescr_Proc(cd_procedimento, ie_origem_proced, null),1,255),
		substr(a.ds_observacao,1,2000)
	from	prescr_ortese_coluna a
	where	a.nr_prescricao	= nr_prescricao_w
	and	(a.cd_procedimento IS NOT NULL AND a.cd_procedimento::text <> '');
	
	
BEGIN
	PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', '', false);
	open C01;
	loop
	fetch C01 into	
		ds_procedimento_w,
		ds_observacao_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		begin
		
		if (current_setting('rep_gerar_resumo_pck.ie_rtf_w')::varchar(1) = 'N') then
			PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text ||
					rep_gerar_resumo_pck.get_tr_html(ds_procedimento_w, ds_observacao_w, null, 
							null, null, null, null, null, 2),1,30000), false);
		else
			PERFORM set_config('rep_gerar_resumo_pck.ds_resumo_w', substr(current_setting('rep_gerar_resumo_pck.ds_resumo_w')::text ||
					rep_gerar_resumo_pck.get_tr_rtf(ds_procedimento_w, ds_observacao_w, null, 
							null, null, null, null, 2),1,30000), false);

		end if;
		
		end;
	end loop;
	close C01;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE rep_gerar_resumo_pck.gerar_rep_resumo_opm () FROM PUBLIC;
