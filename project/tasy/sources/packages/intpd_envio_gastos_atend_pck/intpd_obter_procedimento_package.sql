-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION intpd_envio_gastos_atend_pck.intpd_obter_procedimento (nr_sequencia_p bigint, nr_seq_item_p bigint) RETURNS SETOF T_PROCEDURE AS $body$
DECLARE

    r_procedure_row_w r_procedure_row;

    c01 CURSOR FOR
        SELECT pp.cd_acao
               , pp.cd_categoria
               , pp.cd_setor_atendimento
               , pp.cd_setor_paciente
               , pp.cd_convenio
               , pp.cd_medico_autenticacao
               , pp.cd_medico_executor
               , pp.cd_procedimento
               , p.cd_sistema_ant
               , pp.cd_motivo_exc_conta
               , pp.cd_motivo_devolucao
               , pp.ds_observacao
               , pp.dt_conta
               , pp.dt_entrada_unidade
               , pp.dt_procedimento
               , pp.dt_atualizacao
               , pp.ie_auditoria
               , pp.ie_origem_proced
               , pp.ie_valor_informado
               , pp.nm_usuario
               , pp.nr_interno_conta
               , pp.nr_sequencia
               , pp.qt_procedimento
               , pp.qt_devolvida
               , pp.vl_anestesista
               , pp.vl_auxiliares
               , pp.vl_materiais
               , pp.vl_custo_operacional
               , pp.vl_medico
               , pp.vl_procedimento
        FROM   procedimento_paciente pp
               JOIN procedimento p ON pp.cd_procedimento = p.cd_procedimento AND pp.ie_origem_proced = p.ie_origem_proced
        WHERE  pp.nr_sequencia = nr_sequencia_p;


BEGIN
      IF (nr_seq_item_p = 2 AND coalesce(nr_sequencia_p, 0) > 0) THEN
        FOR t1 IN c01 LOOP
            r_procedure_row_w.CD_ACAO := t1.CD_ACAO;
            r_procedure_row_w.CD_CATEGORIA :=    t1.CD_CATEGORIA;
            r_procedure_row_w.CD_SETOR_ATENDIMENTO :=    t1.CD_SETOR_ATENDIMENTO;
            r_procedure_row_w.CD_SETOR_PACIENTE :=   t1.CD_SETOR_PACIENTE;
            r_procedure_row_w.CD_CONVENIO := t1.CD_CONVENIO;
            r_procedure_row_w.CD_MEDICO_AUTENTICACAO :=  t1.CD_MEDICO_AUTENTICACAO;
            r_procedure_row_w.CD_MEDICO_EXECUTOR :=  t1.CD_MEDICO_EXECUTOR;
            r_procedure_row_w.CD_PROCEDIMENTO := t1.CD_PROCEDIMENTO;
            r_procedure_row_w.CD_SISTEMA_ANT :=  t1.CD_SISTEMA_ANT;
            r_procedure_row_w.CD_MOTIVO_EXC_CONTA := t1.CD_MOTIVO_EXC_CONTA;
            r_procedure_row_w.CD_MOTIVO_DEVOLUCAO := t1.CD_MOTIVO_DEVOLUCAO;
            r_procedure_row_w.DS_OBSERVACAO :=   t1.DS_OBSERVACAO;
            r_procedure_row_w.DT_CONTA :=    t1.DT_CONTA;
            r_procedure_row_w.DT_ENTRADA_UNIDADE :=  t1.DT_ENTRADA_UNIDADE;
            r_procedure_row_w.DT_PROCEDIMENTO := t1.DT_PROCEDIMENTO;
            r_procedure_row_w.DT_ATUALIZACAO :=  t1.DT_ATUALIZACAO;
            r_procedure_row_w.IE_AUDITORIA :=    t1.IE_AUDITORIA;
            r_procedure_row_w.IE_ORIGEM_PROCED :=    t1.IE_ORIGEM_PROCED;
            r_procedure_row_w.IE_VALOR_INFORMADO :=  t1.IE_VALOR_INFORMADO;
            r_procedure_row_w.NM_USUARIO :=  t1.NM_USUARIO;
            r_procedure_row_w.NR_INTERNO_CONTA :=    t1.NR_INTERNO_CONTA;
            r_procedure_row_w.NR_SEQUENCIA :=    t1.NR_SEQUENCIA;
            r_procedure_row_w.QT_PROCEDIMENTO := t1.QT_PROCEDIMENTO;
            r_procedure_row_w.QT_DEVOLVIDA :=    t1.QT_DEVOLVIDA;
            r_procedure_row_w.VL_ANESTESISTA :=  t1.VL_ANESTESISTA;
            r_procedure_row_w.VL_AUXILIARES :=   t1.VL_AUXILIARES;
            r_procedure_row_w.VL_MATERIAIS :=    t1.VL_MATERIAIS;
            r_procedure_row_w.VL_CUSTO_OPERACIONAL :=    t1.VL_CUSTO_OPERACIONAL;
            r_procedure_row_w.VL_MEDICO :=   t1.VL_MEDICO;
            r_procedure_row_w.VL_PROCEDIMENTO := t1.VL_PROCEDIMENTO;

            RETURN NEXT r_procedure_row_w;
        END LOOP;
      END IF;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION intpd_envio_gastos_atend_pck.intpd_obter_procedimento (nr_sequencia_p bigint, nr_seq_item_p bigint) FROM PUBLIC;
