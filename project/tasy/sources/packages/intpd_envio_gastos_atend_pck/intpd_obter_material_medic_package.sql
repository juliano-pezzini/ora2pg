-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION intpd_envio_gastos_atend_pck.intpd_obter_material_medic (nr_sequencia_p bigint, nr_seq_item_p bigint) RETURNS SETOF T_MATERIAL_MEDICINE AS $body$
DECLARE

    r_material_medicine_row_w r_material_medicine_row;

    c01 CURSOR FOR
        SELECT map.cd_acao
               , map.cd_categoria
               , map.cd_setor_atendimento
               , map.cd_setor_paciente
               , map.cd_convenio
               , map.cd_material
               , m.cd_sistema_ant
               , map.cd_medico_autenticacao
               , map.cd_medico_prescritor
               , map.cd_material_exec
               , map.cd_motivo_exc_conta
               , map.cd_motivo_devolucao
               , map.cd_local_estoque
               , map.cd_unidade_medida
               , map.ds_observacao
               , map.dt_conta
               , map.dt_atendimento
               , map.dt_entrada_unidade
               , map.dt_atualizacao
               , map.ie_auditoria
               , map.ie_via_aplicacao
               , map.ie_valor_informado
               , map.nm_usuario
               , map.nr_interno_conta
               , map.nr_sequencia
               , map.qt_executada
               , map.qt_material
               , map.qt_devolvida
               , map.vl_material
               , map.vl_unitario
        FROM   material_atend_paciente map
               JOIN material m ON map.cd_material = m.cd_material
        WHERE map.nr_sequencia = nr_sequencia_p;

BEGIN
      IF (nr_seq_item_p = 1 AND coalesce(nr_sequencia_p, 0) > 0) THEN
        FOR t1 IN c01 LOOP
            r_material_medicine_row_w.cd_acao := t1.cd_acao;
            r_material_medicine_row_w.cd_categoria :=    t1.cd_categoria;
            r_material_medicine_row_w.cd_setor_atendimento :=    t1.cd_setor_atendimento;
            r_material_medicine_row_w.cd_setor_paciente :=   t1.cd_setor_paciente;
            r_material_medicine_row_w.cd_convenio := t1.cd_convenio;
            r_material_medicine_row_w.cd_material := t1.cd_material;
            r_material_medicine_row_w.cd_sistema_ant :=  t1.cd_sistema_ant;
            r_material_medicine_row_w.cd_medico_autenticacao :=  t1.cd_medico_autenticacao;
            r_material_medicine_row_w.cd_medico_prescritor :=    t1.cd_medico_prescritor;
            r_material_medicine_row_w.cd_material_exec :=    t1.cd_material_exec;
            r_material_medicine_row_w.cd_motivo_exc_conta := t1.cd_motivo_exc_conta;
            r_material_medicine_row_w.cd_motivo_devolucao := t1.cd_motivo_devolucao;
            r_material_medicine_row_w.cd_local_estoque :=    t1.cd_local_estoque;
            r_material_medicine_row_w.cd_unidade_medida :=   t1.cd_unidade_medida;
            r_material_medicine_row_w.ds_observacao :=   t1.ds_observacao;
            r_material_medicine_row_w.dt_conta :=    t1.dt_conta;
            r_material_medicine_row_w.dt_atendimento :=  t1.dt_atendimento;
            r_material_medicine_row_w.dt_entrada_unidade :=  t1.dt_entrada_unidade;
            r_material_medicine_row_w.dt_atualizacao :=  t1.dt_atualizacao;
            r_material_medicine_row_w.ie_auditoria :=    t1.ie_auditoria;
            r_material_medicine_row_w.ie_via_aplicacao :=    t1.ie_via_aplicacao;
            r_material_medicine_row_w.ie_valor_informado :=  t1.ie_valor_informado;
            r_material_medicine_row_w.nm_usuario :=  t1.nm_usuario;
            r_material_medicine_row_w.nr_interno_conta :=    t1.nr_interno_conta;
            r_material_medicine_row_w.nr_sequencia :=    t1.nr_sequencia;
            r_material_medicine_row_w.qt_executada :=    t1.qt_executada;
            r_material_medicine_row_w.qt_material := t1.qt_material;
            r_material_medicine_row_w.qt_devolvida :=    t1.qt_devolvida;
            r_material_medicine_row_w.vl_material := t1.vl_material;
            r_material_medicine_row_w.vl_unitario := t1.vl_unitario;


            RETURN NEXT r_material_medicine_row_w;
        END LOOP;
      END IF;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION intpd_envio_gastos_atend_pck.intpd_obter_material_medic (nr_sequencia_p bigint, nr_seq_item_p bigint) FROM PUBLIC;
