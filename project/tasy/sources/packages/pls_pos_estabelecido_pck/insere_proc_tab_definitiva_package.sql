-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--Faz apenas o insert na tabela  definitiva de procedimentos com utilizacao de forall



CREATE OR REPLACE PROCEDURE pls_pos_estabelecido_pck.insere_proc_tab_definitiva ( result_cursor_p INOUT table_dados_proc_persistir, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN

	if ( result_cursor_p.cd_procedimento.count > 0) then
	
		forall i in result_cursor_p.cd_procedimento.first..result_cursor_p.cd_procedimento.last
			insert into pls_conta_pos_proc(cd_procedimento, dt_item, ie_origem_proced,
			 nr_seq_cabecalho, nr_seq_conta, nr_seq_conta_proc,
			 nr_seq_regra_horario,  qt_filme_tab,
			 qt_item, tx_administracao, tx_item,
			 vl_cotacao_moeda, vl_custo_operacional, vl_custo_operacional_calc,
			 vl_custo_operacional_tab, vl_liberado_co_fat, vl_liberado_hi_fat,
			 vl_liberado_material_fat, vl_lib_taxa_co, vl_lib_taxa_material,
			 vl_lib_taxa_servico, vl_materiais, vl_materiais_calc,
			 vl_material_tab, vl_medico, vl_medico_calc,
			 vl_provisao, vl_tabela_preco, vl_taxa_co,
			 vl_taxa_material, vl_taxa_servico, dt_atualizacao_nrec,
			 nm_usuario, nm_usuario_nrec, dt_atualizacao,
			 nr_seq_regra_preco, cd_procedimento_conv, nr_seq_regra_co_filme,
			 ie_origem_proced_conv, cd_procedimento_conv_xml, nr_seq_regra_conv_xml,
			 ie_origem_conv_xml, nr_seq_regra_conv, dt_inicio_item,
			 dt_fim_item, nr_sequencia, ie_origem_conta,
			 nr_seq_pagador, nr_seq_segurado, ie_status_faturamento
			 )
			values (result_cursor_p.cd_procedimento(i), result_cursor_p.dt_item(i), result_cursor_p.ie_origem_proced(i),
			 result_cursor_p.nr_seq_cabecalho(i), result_cursor_p.nr_seq_conta(i), result_cursor_p.nr_seq_conta_proc(i),
			 result_cursor_p.nr_seq_regra_horario(i), result_cursor_p.qt_filme_tab(i),
			 result_cursor_p.qt_item(i), result_cursor_p.tx_administracao(i), result_cursor_p.tx_item(i),
			 result_cursor_p.vl_cotacao_moeda(i), result_cursor_p.vl_custo_operacional(i), result_cursor_p.vl_custo_operacional_calc(i),
			 result_cursor_p.vl_custo_operacional_tab(i), result_cursor_p.vl_liberado_co_fat(i), result_cursor_p.vl_liberado_hi_fat(i),
			 result_cursor_p.vl_liberado_material_fat(i), result_cursor_p.vl_lib_taxa_co(i), result_cursor_p.vl_lib_taxa_material(i),
			 result_cursor_p.vl_lib_taxa_servico(i), result_cursor_p.vl_materiais(i), result_cursor_p.vl_materiais_calc(i),
			 result_cursor_p.vl_material_tab(i), result_cursor_p.vl_medico(i), result_cursor_p.vl_medico_calc(i),
			 result_cursor_p.vl_provisao(i), result_cursor_p.vl_tabela_preco(i), result_cursor_p.vl_taxa_co(i),
			result_cursor_p.vl_taxa_material(i), result_cursor_p.vl_taxa_servico(i), clock_timestamp(),
			 nm_usuario_p, nm_usuario_p, clock_timestamp(),
			 result_cursor_p.nr_seq_regra_preco(i), result_cursor_p.cd_procedimento_conv(i), result_cursor_p.nr_seq_regra_co_filme(i),
			 result_cursor_p.ie_origem_proced_conv(i), result_cursor_p.cd_procedimento_conv_xml(i), result_cursor_p.nr_seq_regra_conv_xml(i),     
			 result_cursor_p.ie_origem_conv_xml(i), result_cursor_p.nr_seq_regra_conv(i), result_cursor_p.dt_inicio_item(i),
			 result_cursor_p.dt_fim_item(i), result_cursor_p.nr_sequencia(i), result_cursor_p.ie_origem_conta(i),
			 result_cursor_p.nr_seq_pagador(i), result_cursor_p.nr_seq_segurado(i), CASE WHEN current_setting('pls_pos_estabelecido_pck.ie_controle_pos_estabelecido_w')::pls_parametros.ie_controle_pos_estabelecido%type='S' THEN 'P'  ELSE 'L' END 
			 );
	end if;
	
	result_cursor_p.nr_sequencia.delete;
	result_cursor_p.cd_procedimento.delete;
	result_cursor_p.dt_item.delete;
	result_cursor_p.ie_origem_proced.delete;
	result_cursor_p.nr_seq_cabecalho.delete;
	result_cursor_p.nr_seq_conta.delete;
	result_cursor_p.nr_seq_conta_proc.delete;
	result_cursor_p.nr_seq_regra_horario.delete;
	result_cursor_p.qt_filme_tab.delete;
	result_cursor_p.qt_item.delete;
	result_cursor_p.tx_administracao.delete;
	result_cursor_p.tx_item.delete;
	result_cursor_p.vl_cotacao_moeda.delete;
	result_cursor_p.vl_custo_operacional.delete;
	result_cursor_p.vl_custo_operacional_calc.delete;
	result_cursor_p.vl_custo_operacional_tab.delete;
	result_cursor_p.vl_liberado_co_fat.delete;
	result_cursor_p.vl_liberado_hi_fat.delete;
	result_cursor_p.vl_liberado_material_fat.delete;
	result_cursor_p.vl_lib_taxa_co.delete;
	result_cursor_p.vl_lib_taxa_material.delete;
	result_cursor_p.vl_lib_taxa_servico.delete;
	result_cursor_p.vl_materiais.delete;
	result_cursor_p.vl_materiais_calc.delete;
	result_cursor_p.vl_material_tab.delete;
	result_cursor_p.vl_medico.delete;
	result_cursor_p.vl_medico_calc.delete;
	result_cursor_p.vl_provisao.delete;
	result_cursor_p.vl_tabela_preco.delete;
	result_cursor_p.vl_taxa_co.delete;
	result_cursor_p.vl_taxa_material.delete;
	result_cursor_p.vl_taxa_servico.delete;
	result_cursor_p.nr_seq_regra_preco.delete;
	result_cursor_p.cd_procedimento_conv.delete;
	result_cursor_p.nr_seq_regra_co_filme.delete;
	result_cursor_p.ie_origem_proced_conv.delete;
	result_cursor_p.cd_procedimento_conv_xml.delete;
	result_cursor_p.nr_seq_regra_conv_xml.delete;
	result_cursor_p.ie_origem_conv_xml.delete;
	result_cursor_p.nr_seq_regra_conv.delete;
	result_cursor_p.dt_inicio_item.delete;
	result_cursor_p.dt_fim_item.delete;
	result_cursor_p.ie_origem_conta.delete;
	result_cursor_p.nr_seq_pagador.delete;
	result_cursor_p.nr_seq_segurado.delete;
	
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_pos_estabelecido_pck.insere_proc_tab_definitiva ( result_cursor_p INOUT table_dados_proc_persistir, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
