-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--Procedure utilizada para atualizacao de um determinado campo nos registros cont_beis. Necess_rio pois

--Ao ajustar diferen_as de arredondamento, pode existir mais de um registro contabil para um unico de p_s-estabelecido

--e n_o se pode apontar que o ajuste em todos os campos ser_ exatamente para o mesmo registro cont_bil.



CREATE OR REPLACE PROCEDURE pls_pos_estabelecido_pck.upd_campo_reg_contab ( tb_seq_p INOUT pls_util_cta_pck.t_number_table, tb_valor_p INOUT pls_util_cta_pck.t_number_table, ie_campo_p text) AS $body$
BEGIN

	if (tb_seq_p.count > 0) then
	
		if (ie_campo_p = 'VL_CO') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_custo_operacional 	= vl_custo_operacional + tb_valor_p(i),
					vl_pos_estabelecido 	= vl_pos_estabelecido + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
		
		elsif (ie_campo_p = 'TX_CO') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_lib_taxa_co = vl_lib_taxa_co + tb_valor_p(i),
					vl_administracao = vl_administracao + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
			
		elsif (ie_campo_p = 'TX_MAT') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_lib_taxa_material = vl_lib_taxa_material + tb_valor_p(i),
					vl_administracao = vl_administracao + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
		
		elsif (ie_campo_p = 'VL_MAT') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_materiais = vl_materiais + tb_valor_p(i),
					vl_pos_estabelecido = vl_pos_estabelecido + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
		
		elsif (ie_campo_p = 'TX_MED') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_lib_taxa_servico = vl_lib_taxa_servico + tb_valor_p(i),
					vl_administracao = vl_administracao + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
		
		elsif (ie_campo_p = 'VL_MED') then
		
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_medico = vl_medico + tb_valor_p(i),
					vl_pos_estabelecido = vl_pos_estabelecido + tb_valor_p(i)
				where 	nr_sequencia = tb_seq_p(i);
		elsif (ie_campo_p = 'VL_PROV') then
	
			forall i in tb_seq_p.first..tb_seq_p.last
				update	pls_conta_pos_proc_contab
				set	vl_provisao = vl_pos_estabelecido + vl_administracao
				where 	nr_sequencia = tb_seq_p(i);
		end if;
	
	end if;
	
	tb_seq_p.delete;
	tb_valor_p.delete;

end;

--Faz verificacaes e eventuais ajustes em diverg_ncias de valores cont_beis.


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_pos_estabelecido_pck.upd_campo_reg_contab ( tb_seq_p INOUT pls_util_cta_pck.t_number_table, tb_valor_p INOUT pls_util_cta_pck.t_number_table, ie_campo_p text) FROM PUBLIC;
