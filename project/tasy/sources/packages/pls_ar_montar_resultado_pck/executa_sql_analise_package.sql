-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- EXECUTA_SQL_ANALISE



CREATE OR REPLACE PROCEDURE pls_ar_montar_resultado_pck.executa_sql_analise ( dados_filtro_p tb_filtros_analise_resultado, nm_usuario_p text) AS $body$
DECLARE


valor_bind_w		sql_pck.t_dado_bind;
ds_dimensao_w		varchar(255);
ds_dimensao_sup_w	varchar(255);

BEGIN

-- Gera os dados para a dimensao um

if ((pls_ar_montar_resultado_pck.obter_campo_dimensao(dados_filtro_p.ds_dimensao_um) IS NOT NULL AND (pls_ar_montar_resultado_pck.obter_campo_dimensao(dados_filtro_p.ds_dimensao_um))::text <> '')) then
	ds_dimensao_w		:= pls_ar_montar_resultado_pck.obter_campo_dimensao(dados_filtro_p.ds_dimensao_um);
	CALL pls_ar_montar_resultado_pck.insere_dimensao_analise('1', dados_filtro_p.ds_dimensao_um, ds_dimensao_w, 'null', '', dados_filtro_p, valor_bind_w, nm_usuario_p);
end if;

-- Gera os dados para a dimensao dois

if (dados_filtro_p.ds_dimensao_dois IS NOT NULL AND dados_filtro_p.ds_dimensao_dois::text <> '') then
	ds_dimensao_sup_w	:= ds_dimensao_w;
	ds_dimensao_w		:= pls_ar_montar_resultado_pck.obter_campo_dimensao(dados_filtro_p.ds_dimensao_dois);
	CALL pls_ar_montar_resultado_pck.insere_dimensao_analise('2', dados_filtro_p.ds_dimensao_dois, ds_dimensao_w, coalesce(ds_dimensao_sup_w, 'null'), '', dados_filtro_p, valor_bind_w, nm_usuario_p);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ar_montar_resultado_pck.executa_sql_analise ( dados_filtro_p tb_filtros_analise_resultado, nm_usuario_p text) FROM PUBLIC;
