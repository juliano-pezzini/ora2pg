-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ptu_batch_xml_pck.obter_projeto_xml ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_congenere_p pls_congenere.nr_sequencia%type, cd_cooperativa_p pls_congenere.cd_cooperativa%type, dt_referencia_p timestamp, ie_tipo_ptu_p text ) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(255);
cd_versao_ptu_xml_w	ptu_regra_interface.cd_versao_ptu_xml%type;
cd_interface_w		ptu_regra_interface.cd_interface%type;
nr_seq_congenere_w	pls_congenere.nr_sequencia%type;


BEGIN
cd_versao_ptu_xml_w := ptu_batch_xml_pck.obter_versao_dominio( cd_estabelecimento_p, nr_seq_congenere_p, cd_cooperativa_p, dt_referencia_p, ie_tipo_ptu_p);

	-- A410  Classificao de Rede

	if (ie_tipo_ptu_p = 'A410') then
	
		nr_seq_congenere_w := nr_seq_congenere_p;
	
		if (coalesce(nr_seq_congenere_w::text, '') = '') and (cd_cooperativa_p IS NOT NULL AND cd_cooperativa_p::text <> '') then
			nr_seq_congenere_w := somente_numero(substr(pls_obter_seq_cod_cooperativa(lpad(cd_cooperativa_p,4,0),null),1,255));
		end if;
	
		cd_interface_w := substr(pls_obter_interf_ptu(cd_estabelecimento_p, nr_seq_congenere_w,dt_referencia_p,ie_tipo_ptu_p),1,255);
		
		if (cd_interface_w = 3084) then
			ds_retorno_w := 102589;
		elsif (cd_interface_w = 3085) then
			ds_retorno_w := 102900;
		end if;
		
	-- A500 - Notas de Fatura em Intercmbio

	elsif (ie_tipo_ptu_p = 'A500') then
		if (cd_versao_ptu_xml_w = '1.0') then
			ds_retorno_w := 102592;
			
		elsif (cd_versao_ptu_xml_w = '1.1') then
			ds_retorno_w := 103242;
			
		elsif (cd_versao_ptu_xml_w = '2.0') then
			ds_retorno_w := 103236;
		end if;
		
	-- A550 - Questionamentos da cmara de contestao

	elsif (ie_tipo_ptu_p = 'A550') then
		if (cd_versao_ptu_xml_w = '1.0') then
			ds_retorno_w := 102747;
			
		elsif (cd_versao_ptu_xml_w= '1.1') then
			ds_retorno_w := 103224;
			
		elsif (cd_versao_ptu_xml_w = '2.0') then
			ds_retorno_w := 103237;
		end if;		
	-- A100 - Simplificado	

	elsif (ie_tipo_ptu_p = 'A100') then
		ds_retorno_w := 102594;
	-- A200 - Retorno da movimentao cadastral

	elsif (ie_tipo_ptu_p = 'A200') then
		ds_retorno_w := 102636;
	-- A1300 - Cadastro Nacional de Beneficirios

	elsif (ie_tipo_ptu_p = 'A1300') then
		ds_retorno_w := 102641;
	-- A1200 - Gesto de Pacotes

	elsif (ie_tipo_ptu_p = 'A1200') then
		ds_retorno_w := 102819;
	-- A700 - Servios prestados em pr-pagamento

	elsif (ie_tipo_ptu_p = 'A700') then
		ds_retorno_w := 102832;
	-- A560 - Carga para Nota de Dbito

	elsif (ie_tipo_ptu_p = 'A560') then
		if (cd_versao_ptu_xml_w = '1.0') then
			ds_retorno_w := 102837;
		elsif (cd_versao_ptu_xml_w= '1.1') then
			ds_retorno_w := 103225;
		end if;	
	-- A300 - Movimentacao Cadastral de Beneficiario - Produtos

	elsif (ie_tipo_ptu_p = 'A300') then
		ds_retorno_w := 102826;
	end if;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION ptu_batch_xml_pck.obter_projeto_xml ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_seq_congenere_p pls_congenere.nr_sequencia%type, cd_cooperativa_p pls_congenere.cd_cooperativa%type, dt_referencia_p timestamp, ie_tipo_ptu_p text ) FROM PUBLIC;
