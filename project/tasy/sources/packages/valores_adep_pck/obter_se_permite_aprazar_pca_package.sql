-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION valores_adep_pck.obter_se_permite_aprazar_pca (nr_prescricao_p prescr_medica.nr_prescricao%type, nr_seq_solucao_p prescr_solucao_evento.nr_seq_solucao%type) RETURNS varchar AS $body$
DECLARE


    ie_permite_w		prescr_solucao_evento.ie_evento_valido%type;
	ie_existe_eventos_w	prescr_solucao_evento.ie_evento_valido%type;


BEGIN
	
	if (nr_prescricao_p IS NOT NULL AND nr_prescricao_p::text <> '' AND nr_seq_solucao_p IS NOT NULL AND nr_seq_solucao_p::text <> '') then
		select	coalesce(max('S'), 'N')
		into STRICT	ie_existe_eventos_w
		from	prescr_solucao_evento a, prescr_mat_hor b
		where	a.nr_prescricao = nr_prescricao_p
		and		a.nr_seq_solucao = nr_seq_solucao_p
		and     b.nr_prescricao = a.nr_prescricao
		and     b.nr_seq_solucao = a.nr_seq_solucao
		and     b.ie_agrupador = 4
		and     b.ie_aprazado = 'S'
		and     coalesce(b.dt_suspensao::text, '') = ''
		and		a.ie_alteracao = 16
		and		a.ie_evento_valido = 'S';
	end if;
	
	if (ie_existe_eventos_w = 'N') then
		ie_permite_w	:= 'S';
	else
		ie_permite_w	:= 'N';
	end if;
	
    return	ie_permite_w;
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION valores_adep_pck.obter_se_permite_aprazar_pca (nr_prescricao_p prescr_medica.nr_prescricao%type, nr_seq_solucao_p prescr_solucao_evento.nr_seq_solucao%type) FROM PUBLIC;
