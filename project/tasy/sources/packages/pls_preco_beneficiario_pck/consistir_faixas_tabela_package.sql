-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_preco_beneficiario_pck.consistir_faixas_tabela ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_tabela_p pls_tabela_preco.nr_sequencia%type, ie_preco_vidas_contrato_p pls_tabela_preco.ie_preco_vidas_contrato%type) AS $body$
DECLARE

qt_erro_fx_w	integer;

BEGIN

--Select para buscar faixa etaria cruzada. Ex: 54 a 58 e outra com 53 a 58

select	sum((	select	count(1)
		from	pls_plano_preco x
		where	x.nr_seq_tabela = nr_seq_tabela_p
		and	x.nr_sequencia <> a.nr_sequencia
		and	a.qt_idade_inicial between x.qt_idade_inicial and x.qt_idade_final
		and	a.qt_idade_inicial <> x.qt_idade_inicial
		and	coalesce(a.ie_grau_titularidade, 'X') = coalesce(x.ie_grau_titularidade, 'X'))) qt
into STRICT	qt_erro_fx_w
from	pls_plano_preco a
where	a.nr_seq_tabela	= nr_seq_tabela_p;

if (qt_erro_fx_w > 0) then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(994259,'BENEFICIARIO='||pls_obter_dados_segurado(nr_seq_segurado_p,'N')); --Problema com a faixa etaria da tabela de preco do beneficiario #@BENEFICIARIO#@. Verifique.
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_preco_beneficiario_pck.consistir_faixas_tabela ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_tabela_p pls_tabela_preco.nr_sequencia%type, ie_preco_vidas_contrato_p pls_tabela_preco.ie_preco_vidas_contrato%type) FROM PUBLIC;
