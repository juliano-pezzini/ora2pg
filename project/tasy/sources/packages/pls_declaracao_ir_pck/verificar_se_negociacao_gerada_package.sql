-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_declaracao_ir_pck.verificar_se_negociacao_gerada (nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_baixa_p titulo_receber_liq.nr_sequencia%type, nr_titulo_p titulo_receber.nr_titulo%type, nr_seq_lote_p pls_lote_mens_ir.nr_sequencia%type) RETURNS varchar AS $body$
DECLARE

	
qt_negociacao_gerada_w		bigint;
	
BEGIN

select	count(1)
into STRICT	qt_negociacao_gerada_w
from	pls_lote_mens_ir a,
	pls_mens_pagador_ir b,
	pls_mens_beneficiario_ir c,
	pls_mens_detalhe_ir d
where	a.nr_sequencia = b.nr_seq_lote
and	b.nr_sequencia = c.nr_seq_pagador_ir
and	c.nr_sequencia = d.nr_seq_beneficiario_ir
and	a.nr_sequencia = nr_seq_lote_p
and	d.nr_seq_baixa_tit_rec = nr_seq_baixa_p
and	c.nr_seq_segurado = nr_seq_segurado_p
and	d.nr_titulo_rec = nr_titulo_p;

if (qt_negociacao_gerada_w = 0) then
	if (tb_nr_seq_segurado_ir_w.count > 0) then
		for i in tb_nr_seq_segurado_ir_w.first..tb_nr_seq_segurado_ir_w.last loop
			if (tb_nr_titulo_rec_w(i) = nr_titulo_p) and (tb_nr_seq_baixa_tit_rec_w(i) = nr_seq_baixa_p) and (tb_nr_seq_segurado_w(i) = nr_seq_segurado_p) then
				return 'S';
			end if;
		end loop;
	end if;
else
	return 'S';
end if;

return 'N';

END;	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_declaracao_ir_pck.verificar_se_negociacao_gerada (nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_baixa_p titulo_receber_liq.nr_sequencia%type, nr_titulo_p titulo_receber.nr_titulo%type, nr_seq_lote_p pls_lote_mens_ir.nr_sequencia%type) FROM PUBLIC;
