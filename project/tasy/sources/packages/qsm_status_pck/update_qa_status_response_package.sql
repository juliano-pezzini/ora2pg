-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE qsm_status_pck.update_qa_status_response ( ds_client_id_p episodio_pac_document.ds_client_id%type, nr_seq_episodio_p episodio_pac_document.nr_seq_episodio%type, ds_module_id_p episodio_pac_document.ds_module_id%type, ds_role_p episodio_pac_doc_status.ds_role%type, ie_status_p episodio_pac_doc_status.ie_status%type) AS $body$
DECLARE


ora2pg_rowcount int;
nr_seq_doc_w 		episodio_pac_document.nr_sequencia%type;


BEGIN
select	nr_sequencia
into STRICT	nr_seq_doc_w
from	episodio_pac_document
where	ds_client_id	= ds_client_id_p
and	nr_seq_episodio	= nr_seq_episodio_p
and	ds_module_id	= ds_module_id_p;

if (nr_seq_doc_w IS NOT NULL AND nr_seq_doc_w::text <> '') then

	update	episodio_pac_doc_status
	set	nm_usuario	= wheb_usuario_pck.get_nm_usuario,
		dt_atualizacao	= clock_timestamp(),
		ie_status	= ie_status_p
	where	nr_seq_document	= nr_seq_doc_w
	and	ds_role		= ds_role_p;

	GET DIAGNOSTICS ora2pg_rowcount = ROW_COUNT;


	if ( ora2pg_rowcount < 1) then

		insert into episodio_pac_doc_status(
			nr_sequencia, nm_usuario, dt_atualizacao,
			nm_usuario_nrec, dt_atualizacao_nrec, nr_seq_document,
			ie_status, ds_role)
		values (
			nextval('episodio_pac_doc_status_seq'), wheb_usuario_pck.get_nm_usuario, clock_timestamp(),
			wheb_usuario_pck.get_nm_usuario, clock_timestamp(), nr_seq_doc_w,
			ie_status_p, ds_role_p);
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE qsm_status_pck.update_qa_status_response ( ds_client_id_p episodio_pac_document.ds_client_id%type, nr_seq_episodio_p episodio_pac_document.nr_seq_episodio%type, ds_module_id_p episodio_pac_document.ds_module_id%type, ds_role_p episodio_pac_doc_status.ds_role%type, ie_status_p episodio_pac_doc_status.ie_status%type) FROM PUBLIC;
