-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION peso_parte_pck_md.calcular_peso_parte_md (pr_proporcao_list_p text, qt_peso_list_p text, ds_delimitador_p text) RETURNS bigint AS $body$
DECLARE

    /*Variaveis para controle da lista do parametro pr_proporcao*/

    nr_posicao_w         integer;
    nr_pos_inicial_w     integer;
    nr_pos_final_w       integer;
    nr_tam_delimitador_w integer;

	/*Variaveis para controle da lista do parametro qt_peso*/

	nr_pos_peso_w        integer;
    nr_pos_ini_peso_w    integer;
    nr_pos_final_peso_w  integer;
    nr_tam_delimi_peso_w integer;
	
	pr_proporcao_w       varchar(200);
	qt_peso_w            varchar(200);
    qt_soma_w            double precision := 0;

BEGIN
    if length(pr_proporcao_list_p) > 0 then
      nr_posicao_w := 1;
	  nr_pos_peso_w := 1;
	
      nr_pos_final_w := length(pr_proporcao_list_p) + 1;
	  nr_pos_final_peso_w := length(qt_peso_list_p) + 1;
	
      nr_tam_delimitador_w := length(ds_delimitador_p);
	  nr_tam_delimi_peso_w := length(ds_delimitador_p);
	
      loop
        nr_pos_inicial_w := instr(pr_proporcao_list_p, ds_delimitador_p, nr_posicao_w);
		nr_pos_ini_peso_w := instr(qt_peso_list_p, ds_delimitador_p, nr_pos_peso_w);
		
        if nr_pos_inicial_w = 0 then
          nr_pos_inicial_w := nr_pos_final_w;
        end if;
		
		if nr_pos_ini_peso_w = 0 then
          nr_pos_ini_peso_w := nr_pos_final_peso_w;
        end if;
		
        pr_proporcao_w := substr(pr_proporcao_list_p, nr_posicao_w, nr_pos_inicial_w - nr_posicao_w);
		qt_peso_w := substr(qt_peso_list_p, nr_pos_peso_w, nr_pos_ini_peso_w - nr_pos_peso_w);
		
        qt_soma_w := qt_soma_w + (dividir_md(pr_proporcao_w, 100) * coalesce(qt_peso_w, 0));
		
        exit when nr_pos_inicial_w = nr_pos_final_w and nr_pos_ini_peso_w = nr_pos_final_peso_w;
		
        nr_posicao_w := nr_pos_inicial_w + nr_tam_delimitador_w;
		nr_pos_peso_w := nr_pos_ini_peso_w + nr_tam_delimi_peso_w;
		
      end loop;
    end if;
	
    return qt_soma_w;
	
  end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION peso_parte_pck_md.calcular_peso_parte_md (pr_proporcao_list_p text, qt_peso_list_p text, ds_delimitador_p text) FROM PUBLIC;
