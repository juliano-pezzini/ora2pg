-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION philips_param_pck.get_param_funcao_usuario_lista ( cd_funcao_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ds_Lista_Param_p text) RETURNS varchar AS $body$
DECLARE



	ds_lista_param_w		varchar(32000);
	vl_parametro_w		varchar(4000);
	nr_sequencia_w		bigint;
	nr_seq_max_w		bigint;
	i			integer;
	
BEGIN
	PERFORM set_config('philips_param_pck.vl_parametros_w', null, false);
	SELECT 	coalesce(max(NR_SEQUENCIA),0)
	into STRICT	nr_seq_max_w
	FROM 	FUNCAO_PARAMETRO
	WHERE 	CD_FUNCAO = cd_funcao_p;


	ds_lista_param_w	:= ds_Lista_Param_p;
	i	:= 0;
	current_setting('philips_param_pck.vetor_w')::Vetor.delete;
	while(length(ds_lista_param_w) > 0) loop
		begin
		i	:= i+1;
		current_setting('philips_param_pck.vetor_w')::Vetor[i].cd_funcao := cd_funcao_p;
		if (position(',' in ds_lista_param_w) > 0)  then
			current_setting('philips_param_pck.vetor_w')::Vetor[i].nr_sequencia	:= substr(ds_lista_param_w,1,position(',' in ds_lista_param_w)-1 );
			ds_lista_param_w	:= substr(ds_lista_param_w,position(',' in ds_lista_param_w)+1,40000);

		else
			current_setting('philips_param_pck.vetor_w')::Vetor[i].nr_sequencia	:=substr(ds_lista_param_w,1,length(ds_lista_param_w) - 1);
			ds_lista_param_w	:= null;
		end if;

		end;
	end loop;

	nr_sequencia_w	:= 0;

	FOR I IN 1 .. nr_seq_max_w LOOP
		begin
		nr_sequencia_w		:= nr_sequencia_w + 1;

		if (philips_param_pck.obter_se_param_lista(cd_funcao_p,nr_sequencia_w) = 'S') then
			obter_param_usuario(	cd_funcao_p,
						nr_sequencia_w,
						cd_perfil_p,
						nm_usuario_p,
						cd_estabelecimento_p,
						vl_parametro_w);
		else
			vl_parametro_w	:= '';
		end if;

		PERFORM set_config('philips_param_pck.vl_parametros_w', current_setting('philips_param_pck.vl_parametros_w')::varchar(32000) || vl_parametro_w || '#@', false);
		end;
	END LOOP;

	return current_setting('philips_param_pck.vl_parametros_w')::varchar(32000);

	end;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION philips_param_pck.get_param_funcao_usuario_lista ( cd_funcao_p bigint, cd_perfil_p bigint, nm_usuario_p text, cd_estabelecimento_p bigint, ds_Lista_Param_p text) FROM PUBLIC;
