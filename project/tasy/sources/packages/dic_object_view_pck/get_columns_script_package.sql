-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION dic_object_view_pck.get_columns_script (NR_SEQ_SCRIPT bigint) RETURNS SETOF T_COLUMN_CONSULT AS $body$
DECLARE

        SCRIPT_SQL_W varchar(4000) := '';
        row_w       t_column_row;
        v_cursor_id integer;
        v_col_cnt integer;
        v_columns dbms_sql.desc_tab;

BEGIN
        SELECT MAX(DS_SQL) INTO STRICT SCRIPT_SQL_W FROM DIC_OBJETO WHERE NR_SEQUENCIA = NR_SEQ_SCRIPT AND IE_TIPO_OBJETO = 'SQL';
        IF (SCRIPT_SQL_W IS NOT NULL AND SCRIPT_SQL_W::text <> '') THEN

            v_cursor_id := DBMS_SQL.OPEN_CURSOR;
            dbms_sql.parse(v_cursor_id, SCRIPT_SQL_W, dbms_sql.native);
            dbms_sql.describe_columns(v_cursor_id, v_col_cnt, v_columns);

            for i in 1 .. v_columns.count loop
                row_w.COLUMN_NAME:= v_columns[i].col_name;
                RETURN NEXT row_w;
            end loop;

            DBMS_SQL.CLOSE_CURSOR(v_cursor_id);
        END IF;

        RETURN;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION dic_object_view_pck.get_columns_script (NR_SEQ_SCRIPT bigint) FROM PUBLIC;
