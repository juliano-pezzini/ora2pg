-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tax_invoice_data_pck.get_environment (profile_code_p bigint, username_p text, establishment_p bigint) RETURNS SETOF TAX_INVOICE_ENV_TABLE_W AS $body$
DECLARE


    config_data_w     tax_invoice_env_record;

    c_config CURSOR FOR
      SELECT  coalesce(obter_valor_param_usuario(40, 191, profile_code_p, username_p, r.cd_estabelecimento), 2) environment_code,
              obter_valor_param_usuario(9041, 11, profile_code_p, username_p, r.cd_estabelecimento) tasy_interface_host, 
              r.ie_municipio_homologacao test_city_code, 
              r.ie_municipio_producao production_city_code 
      from    nfse_regra r 
      where   r.cd_estabelecimento = establishment_p;


BEGIN
    for row_data_w in c_config loop
      begin
        config_data_w.environment_code      := row_data_w.environment_code;
        config_data_w.tasy_interface_host   := row_data_w.tasy_interface_host;
        config_data_w.test_city_code        := row_data_w.test_city_code;
        config_data_w.production_city_code  := row_data_w.production_city_code;
        RETURN NEXT config_data_w;
      end;
    end loop;
    return;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION tax_invoice_data_pck.get_environment (profile_code_p bigint, username_p text, establishment_p bigint) FROM PUBLIC;
