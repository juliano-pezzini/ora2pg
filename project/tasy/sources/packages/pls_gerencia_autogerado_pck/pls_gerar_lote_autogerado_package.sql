-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerencia_autogerado_pck.pls_gerar_lote_autogerado ( nr_seq_lote_p pls_lote_auto_gerado.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p text) AS $body$
DECLARE


nr_seq_prestador_w	pls_lote_auto_gerado.nr_seq_prestador%type;
dt_inicio_w		pls_lote_auto_gerado.dt_inicio%type;
dt_fim_w		pls_lote_auto_gerado.dt_fim%type;
					

BEGIN

select	max(dt_inicio),
	max(dt_fim),
	max(nr_seq_prestador)
into STRICT	dt_inicio_w,
	dt_fim_w,
	nr_seq_prestador_w
from	pls_lote_auto_gerado
where	nr_sequencia = nr_seq_lote_p;

if (dt_inicio_w IS NOT NULL AND dt_inicio_w::text <> '' AND dt_fim_w IS NOT NULL AND dt_fim_w::text <> '') then

	CALL pls_gerencia_autogerado_pck.pls_atualiza_itens_autogerado(	nr_seq_lote_p, nr_seq_prestador_w, dt_inicio_w,
					dt_fim_w, cd_estabelecimento_p, nm_usuario_p);
					
	CALL pls_gerencia_autogerado_pck.pls_atualiza_status_lote_auto(nr_seq_lote_p,'F',nm_usuario_p);

	commit;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerencia_autogerado_pck.pls_gerar_lote_autogerado ( nr_seq_lote_p pls_lote_auto_gerado.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p text) FROM PUBLIC;
