-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_contr_patrimonio_bolivia.obter_dados_conta_contabil ( nr_seq_regra_conta_p PAT_CONTA_CONTABIL.NR_SEQUENCIA%type, cd_estabelecimento_p PAT_CONTA_CONTABIL.CD_ESTABELECIMENTO%type default null, cd_conta_contabil_p PAT_CONTA_CONTABIL.CD_CONTA_CONTABIL%type default null, cd_empresa_p PAT_CONTA_CONTABIL.CD_EMPRESA%type default null, dt_referencia_p PAT_CONTA_CONTABIL.DT_VIGENCIA%type default null) RETURNS TB_DADOS_CONTA AS $body$
DECLARE

	tb_dados_conta_w       		tb_dados_conta;
	nr_sequencia_w			PAT_CONTA_CONTABIL.NR_SEQUENCIA%type;

BEGIN
	nr_sequencia_w := nr_seq_regra_conta_p;

	IF coalesce(nr_sequencia_w::text, '') = '' THEN
		SELECT	MIN(a.NR_SEQUENCIA)
		INTO STRICT	nr_sequencia_w
		FROM	PAT_CONTA_CONTABIL a
		WHERE	coalesce(a.CD_ESTABELECIMENTO,cd_estabelecimento_p)	= cd_estabelecimento_p
		AND	a.CD_CONTA_CONTABIL				= cd_conta_contabil_p
		AND	coalesce(a.CD_EMPRESA,cd_empresa_p)			= cd_empresa_p
		AND	a.DT_VIGENCIA 					<= dt_referencia_p
		AND	a.IE_SITUACAO 					= 'A';
	END IF;

	EXECUTE	'SELECT	CD_CONTA_ATIVO_AITB, '	||
				'CD_CONTA_PASSIVO_AITB, '	||
				'CD_CONTA_DEPREC_ACUM, '	||
				'CD_CONTA_DEPREC_RES, '		||
				'CD_HISTORICO '			||
				'FROM	PAT_CONTA_CONTABIL a '	||
				'WHERE	a.NR_SEQUENCIA	= :1 '	||
				'AND	a.IE_SITUACAO   = :2'
	BULK COLLECT INTO STRICT tb_dados_conta_w
	USING nr_sequencia_w, 'A';

	RETURN tb_dados_conta_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_contr_patrimonio_bolivia.obter_dados_conta_contabil ( nr_seq_regra_conta_p PAT_CONTA_CONTABIL.NR_SEQUENCIA%type, cd_estabelecimento_p PAT_CONTA_CONTABIL.CD_ESTABELECIMENTO%type default null, cd_conta_contabil_p PAT_CONTA_CONTABIL.CD_CONTA_CONTABIL%type default null, cd_empresa_p PAT_CONTA_CONTABIL.CD_EMPRESA%type default null, dt_referencia_p PAT_CONTA_CONTABIL.DT_VIGENCIA%type default null) FROM PUBLIC;
