-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE mipres_item_data_pck.set_quimio_pendency () AS $body$
BEGIN

				ds_sql_cursor_w :=
					   'select  pm.nr_atendimento nr_encounter, '
					|| '        ppm.dt_atualizacao, '
					|| '        (SELECT COUNT(regexp_substr(ds_dias_aplicacao,''[^,]+'', 1, LEVEL)) '
					|| '        FROM dual CONNECT BY '
					|| '        regexp_substr(ds_dias_aplicacao, ''[^,]+'', 1, LEVEL) IS NOT NULL '
					|| '        )*ppm.qt_dose, '
					|| '        ppm.cd_unidade_medida, '
					|| '        ppm.ie_via_aplicacao, '
					|| '        ppm.cd_intervalo, '
					|| '        null cd_medico, '
					|| '        null cd_resident, '
					|| '        null dt_suspensao, '
					|| '        substr(m.ds_material, 1, 255) ds_item, '
					|| '        m.cd_cum item_code, ' 
					|| '        m.ie_conselho_medico, '
					|| '        nvl(m.ie_med_unirs, ''N'') ie_med_unirs, '
					|| '        null dt_item_prescription, '
					|| '        null cd_item_prescriber '
					|| 'from    paciente_protocolo_medic ppm, '
					|| '        prescr_mipres pm, '
					|| '        material m '
					|| 'where   ppm.nr_seq_prescr_mipres = pm.nr_sequencia '
					|| 'and     ppm.cd_material = m.cd_material '
					|| 'and     pm.nr_sequencia = :nr_seq_prescr_mipres_p '
					|| 'union '
					|| 'select  pm.nr_atendimento nr_encounter, '
					|| '        ppp.dt_atualizacao dt_atualizacao, '
					|| '        ppp.qt_procedimento qt_dose, '
					|| '        null cd_unidade_medida, '
					|| '        null ie_via_aplicacao, '
					|| '        ppp.cd_intervalo cd_intervalo, '
					|| '        null cd_medico, '
					|| '        null cd_resident, '
					|| '        null dt_suspensao, '
					|| '        substr(p.ds_procedimento, 1, 255) ds_item, '
					|| '        p.cd_procedimento_loc item_code, '
					|| '        p.ie_conselho_medico ie_conselho_medico, '
					|| '        null ie_med_unirs, '
					|| '        null dt_item_prescription, '
					|| '        null cd_item_prescriber '
					|| 'from    paciente_protocolo_proc ppp, '
					|| '        prescr_mipres pm, '
					|| '        proc_interno pi, '
					|| '        procedimento p '
					|| 'where   ppp.nr_seq_prescr_mipres = pm.nr_sequencia '
					|| 'and     ppp.nr_seq_proc_interno = pi.nr_sequencia '
					|| 'and     pi.cd_procedimento = p.cd_procedimento '
					|| 'and     pi.ie_origem_proced = p.ie_origem_proced '
					|| 'and     pm.nr_sequencia = :nr_seq_prescr_mipres_p ';

				ds_bind_cCursor_w := sql_pck.bind_variable(':nr_seq_prescr_mipres_p', nr_seq_prescr_mipres_p, ds_bind_cCursor_w);

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mipres_item_data_pck.set_quimio_pendency () FROM PUBLIC;
