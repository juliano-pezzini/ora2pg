-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


    /** 
	+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	Delete the file from Error folder for outbound message
    Usage of this function:- while resending the message delete the file from error folder and after correction sent back to main folder
	+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    **/
CREATE OR REPLACE PROCEDURE tosho_pck.delete_error_file (ds_file_p text, log_file_name_w text, message_type_p text) AS $body$
DECLARE

    cd_event_w philips_json;

BEGIN
        cd_event_w := tosho_pck.get_directory_event_code(message_type_p);

        CALL pls_utl_file_pck.excluir_arquivo(cd_event_w.get['cd_event_index_error'].value_of(),ds_file_p); -- delete the file from index_error_folder
        CALL pls_utl_file_pck.excluir_arquivo(cd_event_w.get['cd_event_data_error'].value_of(),ds_file_p); -- delete the file from data_error_folder
        PERFORM set_config('tosho_pck.ds_log_message_w', 'Successfully created and moved the file from error folder: '||ds_file_p||', '||'Time of Transmission = '||to_char(clock_timestamp(),'hh24:mi:ss'), false);
        CALL CALL tosho_pck.save_log(cd_event_w.get['cd_event_log'].value_of(), current_setting('tosho_pck.log_file_name_w')::varchar(100), current_setting('tosho_pck.ds_log_message_w')::varchar(32767)); -- updating log file
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tosho_pck.delete_error_file (ds_file_p text, log_file_name_w text, message_type_p text) FROM PUBLIC;
