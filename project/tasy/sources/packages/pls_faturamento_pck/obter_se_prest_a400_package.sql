-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Obter se deve consistir o prestador
CREATE OR REPLACE FUNCTION pls_faturamento_pck.obter_se_prest_a400 ( nr_seq_prestador_exec_p pls_prestador.nr_sequencia%type, ie_consiste_p pls_parametros.ie_consiste_prest_envio_a500%type ) RETURNS varchar AS $body$
DECLARE


qt_prestador_a400_w	integer;
ie_envia_w		varchar(1) := 'S';


BEGIN
if (nr_seq_prestador_exec_p IS NOT NULL AND nr_seq_prestador_exec_p::text <> '') and (ie_consiste_p = 'S') then
	select	count(1)
	into STRICT	qt_prestador_a400_w
	from	ptu_movimento_prestador c,
		ptu_prestador b
	where	b.nr_seq_prestador	= nr_seq_prestador_exec_p
	and	c.nr_sequencia		= b.nr_seq_movimento
	and	(c.dt_liberacao IS NOT NULL AND c.dt_liberacao::text <> '')  LIMIT 1;

	if (qt_prestador_a400_w = 0) then
		ie_envia_w := 'N'; --Motivo: Prestador nao enviado no A400
	end if;	
end if;

return ie_envia_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_faturamento_pck.obter_se_prest_a400 ( nr_seq_prestador_exec_p pls_prestador.nr_sequencia%type, ie_consiste_p pls_parametros.ie_consiste_prest_envio_a500%type ) FROM PUBLIC;
