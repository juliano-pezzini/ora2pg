-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_faturamento_pck.gera_sql_div_fat_contas ( nr_seq_evento_p pls_lote_faturamento.nr_sequencia%type, ie_tipo_protocolo_p pls_regra_divisao_fat_prot.ie_tipo_protocolo%type, bind_dados_p out sql_pck.t_dado_bind) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Gera o sql para buscar as contas que se encaixarem na regra

-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[  ]  Objetos do dicionario [X] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

Alteracoes:

-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w	varchar(32000);

BEGIN

ds_retorno_w :=	'select	c.nr_sequencia ' || pls_util_pck.enter_w ||
		'from	pls_fatura_evento	b, ' || pls_util_pck.enter_w ||
		'	pls_fatura_conta	c, ' || pls_util_pck.enter_w ||
		'	pls_conta		d, ' || pls_util_pck.enter_w ||
		'	pls_protocolo_conta	e ' || pls_util_pck.enter_w ||
		'where	c.nr_seq_fatura_evento	= b.nr_sequencia ' || pls_util_pck.enter_w ||
		'and	d.nr_sequencia		= c.nr_seq_conta ' || pls_util_pck.enter_w ||
		'and	e.nr_sequencia		= d.nr_seq_protocolo ' || pls_util_pck.enter_w ||
		'and	b.nr_sequencia		= :nr_seq_evento_p ' || pls_util_pck.enter_w;
if (ie_tipo_protocolo_p IS NOT NULL AND ie_tipo_protocolo_p::text <> '') then

	ds_retorno_w := ds_retorno_w ||'			and	e.ie_tipo_protocolo	= :ie_tipo_protocolo ';
	bind_dados_p := sql_pck.bind_variable(':ie_tipo_protocolo', ie_tipo_protocolo_p, bind_dados_p);
end if;

bind_dados_p := sql_pck.bind_variable(':nr_seq_evento_p', nr_seq_evento_p, bind_dados_p);


return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_faturamento_pck.gera_sql_div_fat_contas ( nr_seq_evento_p pls_lote_faturamento.nr_sequencia%type, ie_tipo_protocolo_p pls_regra_divisao_fat_prot.ie_tipo_protocolo%type, bind_dados_p out sql_pck.t_dado_bind) FROM PUBLIC;
