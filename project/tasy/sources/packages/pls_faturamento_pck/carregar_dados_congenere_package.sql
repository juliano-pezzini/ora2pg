-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_faturamento_pck.carregar_dados_congenere ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, tb_sg_estado_cong_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_tipo_congenere_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_nacional_cong_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_fatura_congenere_coop_p INOUT pls_util_cta_pck.t_varchar2_table_10, tb_nr_seq_camara_cong_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_pagador_cong_p INOUT pls_util_cta_pck.t_number_table) AS $body$
DECLARE


c01 CURSOR(cd_estabelecimento_pc	estabelecimento.cd_estabelecimento%type) FOR
	SELECT	b.nr_sequencia,
		coalesce(a.sg_estado,'X') sg_estado,
		b.ie_tipo_congenere,
		coalesce(b.ie_nacional,'N') ie_nacional,
		coalesce(b.ie_fatura_congenere_coop,'A') ie_fatura_congenere_coop,
		(SELECT	max(x.nr_seq_camara)
		from	pls_congenere_camara x
		where	x.nr_seq_congenere	= b.nr_sequencia
		and	clock_timestamp() between x.dt_inicio_vigencia_ref and x.dt_fim_vigencia_ref) nr_seq_camara,
		(select	max(x.nr_sequencia)
		from	pls_contrato_pagador	x
		where	x.nr_seq_congenere	= b.nr_sequencia
		and	coalesce(x.dt_rescisao::text, '') = '') nr_seq_pagador
	from	pessoa_juridica	a,
		pls_congenere	b
	where	a.cd_cgc		= b.cd_cgc
	and	b.cd_estabelecimento	= cd_estabelecimento_pc;

BEGIN
for r_c01_w in c01( cd_estabelecimento_p ) loop
	tb_sg_estado_cong_p(r_c01_w.nr_sequencia)		:= r_c01_w.sg_estado;
	tb_ie_tipo_congenere_p(r_c01_w.nr_sequencia)		:= r_c01_w.ie_tipo_congenere;
	tb_ie_nacional_cong_p(r_c01_w.nr_sequencia)		:= r_c01_w.ie_nacional;
	tb_ie_fatura_congenere_coop_p(r_c01_w.nr_sequencia)	:= r_c01_w.ie_fatura_congenere_coop;
	tb_nr_seq_camara_cong_p(r_c01_w.nr_sequencia)		:= r_c01_w.nr_seq_camara;
	tb_nr_seq_pagador_cong_p(r_c01_w.nr_sequencia)		:= r_c01_w.nr_seq_pagador;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_faturamento_pck.carregar_dados_congenere ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, tb_sg_estado_cong_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_tipo_congenere_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_nacional_cong_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_fatura_congenere_coop_p INOUT pls_util_cta_pck.t_varchar2_table_10, tb_nr_seq_camara_cong_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_pagador_cong_p INOUT pls_util_cta_pck.t_number_table) FROM PUBLIC;
