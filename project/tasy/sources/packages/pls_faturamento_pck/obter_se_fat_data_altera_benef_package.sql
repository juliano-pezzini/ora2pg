-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Verificar se o beneficiario pre teve antes ou depois da alteracao
CREATE OR REPLACE FUNCTION pls_faturamento_pck.obter_se_fat_data_altera_benef ( dt_atendimento_p timestamp, dt_alteracao_p timestamp, dt_rescisao_p timestamp, ie_pos_estab_fat_resc_p text, ie_preco_p pls_plano.ie_preco%type) RETURNS varchar AS $body$
DECLARE


ie_fatura_w		varchar(2) := 'S';
dt_alteracao_w		timestamp := coalesce(dt_alteracao_p,dt_atendimento_p-1);
						

BEGIN
if (trunc(dt_atendimento_p) < trunc(dt_alteracao_w)) then
	ie_fatura_w := 'N';
end if;	

-- se tem data de rescisao, e pre, e parametro cobra em mensalidade
if (dt_rescisao_p IS NOT NULL AND dt_rescisao_p::text <> '') and (ie_pos_estab_fat_resc_p = 'M') and (ie_preco_p = '1') then
	ie_fatura_w := 'N';
end if;

return ie_fatura_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_faturamento_pck.obter_se_fat_data_altera_benef ( dt_atendimento_p timestamp, dt_alteracao_p timestamp, dt_rescisao_p timestamp, ie_pos_estab_fat_resc_p text, ie_preco_p pls_plano.ie_preco%type) FROM PUBLIC;
