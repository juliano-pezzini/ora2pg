-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_gerencia_dados_ocor_pck.obter_forma_inativacao_ocor ( ie_situacao_gravar_p pls_ocorrencia_benef.ie_situacao%type, ie_forma_inat_atual_p pls_ocorrencia_benef.ie_forma_inativacao%type, ie_opcao_p text) RETURNS PLS_OCORRENCIA_BENEF.IE_FORMA_INATIVACAO%TYPE AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
Finalidade:	Obter a forma de inativação que será gravada na ocorrência ou na glosa a qual está sendo 
	alterada a situação para A - Ativa ou I - Inativa. 
------------------------------------------------------------------------------------------------------------------- 
Locais de chamada direta: 
[ ] Objetos do dicionário [ ] Tasy (Delphi/Java) [ ] Portal [ ] Relatórios [ X] Outros: É privada desta package apenas. 
------------------------------------------------------------------------------------------------------------------- 
Pontos de atenção: 
 
Alterações: 
------------------------------------------------------------------------------------------------------------------ 
jjung OS 642961 02/10/2013 - Criação da function. 
------------------------------------------------------------------------------------------------------------------ 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 

BEGIN 
 
-- se for para ativar, a forma de inativação deve ficar como null 
if ( ie_situacao_gravar_p = 'A' ) then 
	 
	return null;
else 
	if (ie_opcao_p	= 'S') then 
		-- Na primeira vez que a ação é executada, o sistema inativa todas as ocorrências, portanto deve ficar como inativo pelo 
		-- sistema. 
		if ( coalesce(ie_forma_inat_atual_p::text, '') = '' ) then 
			 
			return 'S';
			 
		-- Quando o sistema já havia inativado, então quer dizer que o usuário também está inativando e confirmando a ação do sistema. 
		elsif ( ie_forma_inat_atual_p = 'U' ) then 
			 
			return 'US';
			 
		-- Quando o usuário e o sistema inativaram então sempre se manterá esta forma de inativação. 
		elsif ( ie_forma_inat_atual_p = 'US' ) then 
		 
			return 'US';
			 
		-- Caso contrário assume-se que é o apenas o usuário que está inativando, quando é tomada a ação de liberar o item. 
		else 
			return 'S';
		end if;
	else 
		if ( coalesce(ie_forma_inat_atual_p::text, '') = '' ) then 
			 
			return 'U';
			 
		-- Quando o sistema já havia inativado, então quer dizer que o usuário também está inativando e confirmando a ação do sistema. 
		elsif ( ie_forma_inat_atual_p = 'S' ) then 
			 
			return 'US';
			 
		-- Quando o usuário e o sistema inativaram então sempre se manterá esta forma de inativação. 
		elsif ( ie_forma_inat_atual_p = 'US' ) then 
		 
			return 'US';
			 
		-- Caso contrário assume-se que é o apenas o usuário que está inativando, quando é tomada a ação de liberar o item. 
		else 
			return 'U';
		end if;
	end if;
end if;
 
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_gerencia_dados_ocor_pck.obter_forma_inativacao_ocor ( ie_situacao_gravar_p pls_ocorrencia_benef.ie_situacao%type, ie_forma_inat_atual_p pls_ocorrencia_benef.ie_forma_inativacao%type, ie_opcao_p text) FROM PUBLIC;
