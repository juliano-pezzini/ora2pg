-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerencia_dados_ocor_pck.inativar_ocor_combinadas ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_conta_proc_p pls_conta_proc.nr_sequencia%type, nr_seq_conta_mat_p pls_conta_mat.nr_sequencia%type, nr_seq_proc_partic_p pls_proc_participante.nr_sequencia%type, cd_acao_analise_p pls_acao_analise.cd_acao%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

/*Atualizar a variavel, e chamar a function*/
 
ie_tipo_item_w	varchar(2);

ds_restricao_w		varchar(4000);
ds_sql_w		varchar(4000);

dados_consistencia_w	pls_tipos_ocor_pck.dados_consistencia;
ret_null_w		varchar(1);

nr_seq_ocor_benef_w	pls_ocorrencia_benef.nr_sequencia%type;

var_cur_w 		integer;
var_exec_w		integer;
var_retorno_w		integer;
		
 

BEGIN 
 
dados_consistencia_w.nr_seq_conta		:= nr_seq_conta_p;
dados_consistencia_w.nr_seq_conta_proc		:= nr_seq_conta_proc_p;
dados_consistencia_w.nr_seq_conta_mat		:= nr_seq_conta_mat_p;
dados_consistencia_w.nr_seq_participante	:= nr_seq_proc_partic_p;
 
ie_tipo_item_w	:= pls_util_cta_pck.pls_obter_tipo_item_atend(nr_seq_conta_p, nr_seq_conta_proc_p, nr_seq_conta_mat_p, nr_seq_proc_partic_p);
 
ds_sql_w	:= 	'select ocor_benef_v.nr_sequencia'	||pls_tipos_ocor_pck.enter_w|| 
			'from	pls_ocorrencia_benef_v	ocor_benef_v'||pls_tipos_ocor_pck.enter_w|| 
			'where	1 = 1';
			 
ds_restricao_w	:= pls_gerencia_dados_ocor_pck.obter_restricao_inat_comb('RESTRICAO', null, dados_consistencia_w, cd_acao_analise_p ,ie_tipo_item_w);			
 
ds_sql_w	:= ds_sql_w||pls_tipos_ocor_pck.enter_w||ds_restricao_w;
var_cur_w := dbms_sql.open_cursor;
dbms_sql.parse(var_cur_w,ds_sql_w,1);
begin 
ret_null_w	:= pls_gerencia_dados_ocor_pck.obter_restricao_inat_comb('BINDS', var_cur_w, dados_consistencia_w, cd_acao_analise_p,ie_tipo_item_w);
dbms_sql.define_column(var_cur_w, 1, nr_seq_ocor_benef_w);
var_exec_w	:= dbms_sql.execute(var_cur_w);
loop 
	var_retorno_w := dbms_sql.fetch_rows(var_cur_w);
	exit when var_retorno_w = 0;
		-- Atualiza a variável com o resultado do select 
		dbms_sql.column_value(var_cur_w, 1, nr_seq_ocor_benef_w);
		-- drquadros e jjung 29/07/2013, Deverá passar IE_FORMA_INATIVACAO como nulo, para fazer a correta ativação na reconsistencia da ocorrência 
		CALL pls_gerencia_dados_ocor_pck.controla_situacao_ocorrencia(nr_seq_ocor_benef_w,'I',nm_usuario_p);
end loop; -- Contas filtradas 
	dbms_sql.close_cursor(var_cur_w);
	 
exception 
when others then 
	CALL wheb_mensagem_pck.exibir_mensagem_abort(253166);
end;	
 
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerencia_dados_ocor_pck.inativar_ocor_combinadas ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_conta_proc_p pls_conta_proc.nr_sequencia%type, nr_seq_conta_mat_p pls_conta_mat.nr_sequencia%type, nr_seq_proc_partic_p pls_proc_participante.nr_sequencia%type, cd_acao_analise_p pls_acao_analise.cd_acao%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
