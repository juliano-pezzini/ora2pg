-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pkg_tie_account_batch.excluir_lote_contabil ( cd_estabelecimento_p lote_contabil.cd_estabelecimento%TYPE, nr_lote_contabil_p lote_contabil.nr_lote_contabil%TYPE, nr_lote_externo_p lote_contabil.nr_lote_externo%TYPE, ds_erro_p INOUT text ) AS $body$
BEGIN
        ds_erro_p := pkg_tie_account_batch.get_validations(nr_lote_contabil_p, nr_lote_externo_p, cd_estabelecimento_p, 1);
        IF coalesce(ds_erro_p::text, '') = '' THEN
            BEGIN
                CALL ctb_excluir_lote(current_setting('pkg_tie_account_batch.nr_lote_contabil_w')::lote_contabil.nr_lote_contabil%TYPE, current_setting('pkg_tie_account_batch.nm_usuario_p')::lote_contabil.nm_usuario%TYPE);
                ds_erro_p := 'Successful';
            EXCEPTION
                WHEN OTHERS THEN
                    ds_erro_p := substr('Erro ao excluir o lote: '
                                        || nr_lote_contabil_p
                                        || ' - '
                                        || sqlerrm(SQLSTATE), 1, 255);
            END;

        END IF;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pkg_tie_account_batch.excluir_lote_contabil ( cd_estabelecimento_p lote_contabil.cd_estabelecimento%TYPE, nr_lote_contabil_p lote_contabil.nr_lote_contabil%TYPE, nr_lote_externo_p lote_contabil.nr_lote_externo%TYPE, ds_erro_p INOUT text ) FROM PUBLIC;
