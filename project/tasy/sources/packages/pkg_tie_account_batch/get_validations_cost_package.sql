-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pkg_tie_account_batch.get_validations_cost ( cd_estabelecimento_p ctb_movimento.cd_estabelecimento%TYPE, cd_centro_custo_p ctb_movto_centro_custo.cd_centro_custo%TYPE, vl_movimento_mvto_p ctb_movto_centro_custo.vl_movimento%TYPE ) RETURNS varchar AS $body$
DECLARE

        ds_erro_w           varchar(5000);
        cd_centro_custo_w   ctb_movto_centro_custo.cd_centro_custo%TYPE;

BEGIN
        IF ( coalesce(cd_centro_custo_p::text, '') = '' AND (vl_movimento_mvto_p IS NOT NULL AND vl_movimento_mvto_p::text <> '') ) THEN
            ds_erro_w := 'Cost center is a mandatory field.';
        ELSIF ( coalesce(vl_movimento_mvto_p::text, '') = '' AND (cd_centro_custo_p IS NOT NULL AND cd_centro_custo_p::text <> '') ) THEN
            ds_erro_w := 'The cost center movement amount is a required field.';
        END IF;

        IF (cd_centro_custo_p IS NOT NULL AND cd_centro_custo_p::text <> '') AND (vl_movimento_mvto_p IS NOT NULL AND vl_movimento_mvto_p::text <> '') THEN
            SELECT
                coalesce(MAX(cd_centro_custo), NULL)
            INTO STRICT cd_centro_custo_w
            FROM
                centro_custo
            WHERE
                cd_estabelecimento = cd_estabelecimento_p
                AND cd_centro_custo = cd_centro_custo_p;

            IF coalesce(cd_centro_custo_w::text, '') = '' THEN
                ds_erro_w := substr('There is no cost center '
                                    || cd_centro_custo_p
                                    || ' registered in Tasy.', 1, 255);
            END IF;

        END IF;

        RETURN ds_erro_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pkg_tie_account_batch.get_validations_cost ( cd_estabelecimento_p ctb_movimento.cd_estabelecimento%TYPE, cd_centro_custo_p ctb_movto_centro_custo.cd_centro_custo%TYPE, vl_movimento_mvto_p ctb_movto_centro_custo.vl_movimento%TYPE ) FROM PUBLIC;
