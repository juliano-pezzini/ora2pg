-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

  
-- Esta function serve somente para retornar se os dados que est?o na mem?ria devem ou
-- n?o ser atualizados com os que est?o na tabela
CREATE OR REPLACE FUNCTION pls_parametros_pck.f_carrega_info_bd ( cd_estabelecimento_p pls_parametros.cd_estabelecimento%type) RETURNS boolean AS $body$
DECLARE

result_w boolean;

BEGIN

-- se a data do ?ltimo carregamento n?o estiver registrada ou 
-- se j? se passou 67 segundos ou
-- se foi pedido um refor?o de atualiza??o manda atualizar ou
-- se o estabelecimento anterior for diferente do ?ltimo solicitado
-- se da ?ltima vez que executou o comando n?o retornou registro tem que executar de novo sempre
if	((current_setting('pls_parametros_pck.dt_ultimo_carregamento')::coalesce(timestamp::text, '') = '') or
	(current_setting('pls_parametros_pck.dt_ultimo_carregamento')::timestamp <= (clock_timestamp() - interval '67 seconds')) or (current_setting('pls_parametros_pck.forca_atualizacao')::boolean = true) or (current_setting('pls_parametros_pck.cd_estabelecimento_anterior')::pls_parametros.cd_estabelecimento%coalesce(type::text, '') = '') or (coalesce(current_setting('pls_parametros_pck.cd_estabelecimento_anterior')::pls_parametros.cd_estabelecimento%type, -1) != coalesce(cd_estabelecimento_p, -2)) or (current_setting('pls_parametros_pck.ie_sem_retorno_w')::boolean = true)) then
	
	result_w := true;
	PERFORM set_config('pls_parametros_pck.dt_ultimo_carregamento', clock_timestamp(), false);
	PERFORM set_config('pls_parametros_pck.forca_atualizacao', false, false);
	PERFORM set_config('pls_parametros_pck.cd_estabelecimento_anterior', cd_estabelecimento_p, false);
else
	result_w := false;
end if;

return result_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_parametros_pck.f_carrega_info_bd ( cd_estabelecimento_p pls_parametros.cd_estabelecimento%type) FROM PUBLIC;
