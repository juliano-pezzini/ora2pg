-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Lançamento/cancelamento automático de itens
CREATE OR REPLACE PROCEDURE pls_cta_processo_pck.executa_processo_7 ( nr_seq_lote_conta_p pls_lote_protocolo_conta.nr_sequencia%type, nr_seq_protocolo_p pls_protocolo_conta.nr_sequencia%type, nr_seq_lote_processo_p pls_cta_lote_processo.nr_sequencia%type, nr_seq_conta_p pls_conta.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN

for r_contas_w in current_setting('pls_cta_processo_pck.c_contas')::CURSOR((	nr_seq_lote_conta_p, nr_seq_protocolo_p, nr_seq_lote_processo_p, nr_seq_conta_p) loop

	-- Executar a regra de itens de lançamento automático
	CALL pls_lanc_auto_item_consist(	r_contas_w.nr_seq_conta, cd_estabelecimento_p, nm_usuario_p);
	commit;

	--Diego - OS 336653 - Geração de procedimentos e materiais automáticos.
	CALL pls_lanc_consiste_conta(	r_contas_w.nr_seq_conta, cd_estabelecimento_p, nm_usuario_p);
	commit;

	-- Diego - OS 351451 - Cancelar solicitação de mat/med especiais que não estão liberados
	CALL pls_canc_solic_matmed_conta(	r_contas_w.nr_seq_conta, cd_estabelecimento_p, nm_usuario_p);
	commit;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_cta_processo_pck.executa_processo_7 ( nr_seq_lote_conta_p pls_lote_protocolo_conta.nr_sequencia%type, nr_seq_protocolo_p pls_protocolo_conta.nr_sequencia%type, nr_seq_lote_processo_p pls_cta_lote_processo.nr_sequencia%type, nr_seq_conta_p pls_conta.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
