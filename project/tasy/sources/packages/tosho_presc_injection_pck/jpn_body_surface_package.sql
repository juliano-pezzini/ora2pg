-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tosho_presc_injection_pck.jpn_body_surface (NR_PRESCRICAO_P bigint) RETURNS bigint AS $body$
DECLARE


			QT_BODY_SURFACE_W real;

			
BEGIN

			SELECT QT_BODY_SURFACE
			  INTO STRICT QT_BODY_SURFACE_W
			  FROM AVAL_NUTRICAO
			 WHERE (DT_LIBERACAO IS NOT NULL AND DT_LIBERACAO::text <> '')
			   AND IE_SITUACAO = 'A'
			   AND coalesce(DT_INATIVACAO::text, '') = ''
			   AND NR_SEQUENCIA IN (SELECT MAX(Z.NR_SEQUENCIA)
			   						  FROM AVAL_NUTRICAO Z
			   						 WHERE (Z.QT_BODY_SURFACE IS NOT NULL AND Z.QT_BODY_SURFACE::text <> '')
			                           AND Z.NR_ATENDIMENTO = (SELECT NR_ATENDIMENTO
			   						 							 FROM PRESCR_MEDICA
			   						 							WHERE NR_PRESCRICAO = NR_PRESCRICAO_P));

			RETURN QT_BODY_SURFACE_W;

			END;	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tosho_presc_injection_pck.jpn_body_surface (NR_PRESCRICAO_P bigint) FROM PUBLIC;
