-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tosho_presc_injection_pck.jpn_for_injection_info (NR_PRESCRICAO_P bigint) AS $body$
DECLARE


			NR_SEQ_MOTIVO_SUSP_W bigint;
			SI_TYPE_OF_PRESCRIPTION_W varchar(10);
			NR_ATENDIMENTO_W bigint;
			IE_URGENCIA_W varchar(10);
			IE_MEDICACAO_PACIENTE_W varchar(10);

			COUNTER_LOOP_C01 bigint := 0;
			QTD_MEDIC_SOLIC bigint := 0;
			QTD_EOF_KBN bigint := 0;
			SYORI_KBN_W varchar(1);
			NYUGAI_KBN_W varchar(1);
			REC_KBN_W varchar(1);
			SEND_KBN_W varchar(1);
			XX_SYBT_W varchar(3);
			IRAI_KBN_W varchar(1);
			CD_PESSOA_FISICA_W varchar(10);
			CD_PF_TRIAL_W varchar(10);
			ORDER_NO_W varchar(200);
			CONTADOR_H0_W bigint;
			CONTADOR_H1_W bigint;
			CONTADOR_H2_W bigint;
			CONTADOR_H3_W bigint;
			CONTADOR_H4_W bigint;
			CONTADOR_H9_W bigint;
			CONTADOR_HJ_W bigint;
			CHICKEN_FLG_W varchar(1);
			CD_MATERIAL_W varchar(20);
			EOF_KBN_W varchar(1);
			DT_ATUALIZACAO_W timestamp;
			CONTADOR_FOR bigint := 0;
			DATA_NOME_ARQUIVO varchar(40);
			DATA_NOME_ARQUIVO_LOG varchar(40);
			NR_SEQ_CR_W bigint;
			IE_ALTA_VIGILANCIA_W varchar(1);
			IE_ALTA_VIGILANCIA_X varchar(1);
			IE_ALTO_RISCO_W varchar(1);
			IE_ALTO_RISCO_X varchar(1);
			RP_SUM_W bigint := 0;
			REPORT_KBN_W varchar(1);

			NR_SEQUENCIA_CO bigint;
			NR_CONTAGEM_A bigint;
			NR_CHAVE_W bigint;


			NR_SEQUENCIA_W bigint;
			CONTADOR_H_W varchar(100);
			TESTE_AA_W bigint;
			TESTE_BB_W bigint;


			SEQUENCIAL_W bigint;
			NM_USUARIO_MEDIC_W varchar(100);


			DS_SCRIPT_RESEND_ERROR varchar(500);
			DS_LOG_MESSAGE varchar(500);
			LOG_SEQUENCE_NUMBER_W bigint;
			DS_ARQ_LOG_MESSAGE varchar(500);

			JPN_PRESCR_INJECTION_CHK_W varchar(1);
			JPN_BODY_SURFACE_W real;

			STRING_INJECTION text;
			STRING_FINAL text;

			GENERATED_FILE UTL_FILE.FILE_TYPE;			

			C01 CURSOR FOR  SELECT '12' AS MESSAGE_CLASSIFICATION,
								  TO_CHAR(clock_timestamp(), 'YYYYMMDD') AS CREATION_DATE1,
								  TO_CHAR(clock_timestamp(), 'HH24MISS') AS CREATION_TIME1,
								  'BI' AS SENDOR_SYSTEM_CODE,
								  'AB' AS RECEIVER_SIDE_SYSTEM_CODE,
								  '00000001' AS NUMBER_COMMON_READERS,
								  --END OF COMMON HEADER
								  --COMMON HEADER BETWEEN THE SYSTEMS
								  SYORI_KBN_W AS SYORI_KBN,
								  TO_CHAR(clock_timestamp(), 'YYYYMMDD') AS CREATION_DATE2,
								  TO_CHAR(clock_timestamp(), 'HH24MISS') AS CREATION_TIME2,
								  NYUGAI_KBN_W AS NYUGAI_KBN1,
								  tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A') AS KA_CD1,
								  SUBSTR(OBTER_DESC_SETOR_ATEND(tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A')),1,20) AS KA_NAME1,
								  tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A') AS BYOTO_CD1,
								  SUBSTR(OBTER_DESC_SETOR_ATEND(tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A')),1,20) AS BYOTO_NAME1,
								  AP1.CD_MEDICO_RESP AS DR_ID1,
								  '                    ' AS SH_KANA_NAME,
								  SUBSTR(OBTER_NOME_MEDICO(AP1.CD_MEDICO_RESP, 'N'),1,20) AS SH_NAME,
								  TO_CHAR(DT_ATUALIZACAO_W, 'YYYYMMDD') AS IN_DATE1,
								  TO_CHAR(CR1.DT_FIM, 'YYYYMMDD') AS STOP_DATE1,
								  '1' AS STOP_RSN_FLG,

								  PF1.NR_PRONTUARIO AS PT_ID1,

								  (SELECT B.DS_GIVEN_NAME || ' ' || B.DS_FAMILY_NAME
								     FROM PERSON_NAME B
								    WHERE B.NR_SEQUENCIA = PF1.NR_SEQ_PERSON_NAME
								      AND UPPER(B.DS_TYPE) = 'SOCIAL') AS PT_KN_NAME1,

								  (SELECT B.DS_GIVEN_NAME || ' ' || B.DS_FAMILY_NAME
								     FROM PERSON_NAME B
								    WHERE B.NR_SEQUENCIA = PF1.NR_SEQ_PERSON_NAME
								      AND UPPER(B.DS_TYPE) = 'MAIN') AS PT_KJ_NAME1,

								  PF1.IE_SEXO AS PT_SEX1,
								  TO_CHAR(PF1.DT_NASCIMENTO, 'YYYYMMDD') AS PT_BIRTH1,
								  ' ' AS PT_STATUS,
								  BEV.ROOM_ID AS ROOM_CD1,
								  OBTER_LEITO_ATUAL_PAC(AP1.NR_ATENDIMENTO) AS ROOM_NAME1,
								  '00000001' AS KOBETU_CNT,
								  --END OF COMMON HEADER BETWEEN THE SYSTEMS
								  --INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) COMMON INFORMATIONS
								  '22' AS FORMAT_KBN,
								  REC_KBN_W AS REC_KBN,
								  '00001' AS SEQ_NO,
								  'E' AS EOF_KBN,  
								  '00000' AS RECORD_LEN,
								  '   ' AS RECORD_NUM, --FIXED
								  TO_CHAR(clock_timestamp(), 'YYYYMMDD') || TO_CHAR(clock_timestamp(), 'HH24MISS') AS TIMESTAMP1,
								  '0' AS PICKING, 
								  SEND_KBN_W AS SEND_KBN,	
								  '1' AS OUTPUT_MODE, 
								  '0000000000'AS RESERVE, --NOT USED
								  PF1.NR_PRONTUARIO AS PT_ID2,

								  (SELECT B.DS_GIVEN_NAME || ' ' || B.DS_FAMILY_NAME
								     FROM PERSON_NAME B
								    WHERE B.NR_SEQUENCIA = PF1.NR_SEQ_PERSON_NAME
								      AND UPPER(B.DS_TYPE) = 'SOCIAL') AS PT_KN_NAME2,

								  (SELECT B.DS_GIVEN_NAME || ' ' || B.DS_FAMILY_NAME
								     FROM PERSON_NAME B
								    WHERE B.NR_SEQUENCIA = PF1.NR_SEQ_PERSON_NAME
								      AND UPPER(B.DS_TYPE) = 'MAIN') AS PT_KJ_NAME2,	

								  PF1.IE_SEXO AS PT_SEX2,
								  TO_CHAR(PF1.DT_NASCIMENTO, 'YYYYMMDD') AS PT_BIRTH2,
								  OBTER_IDADE_PF(PF1.CD_PESSOA_FISICA, clock_timestamp(), 'AM') AS PT_AGE, --ALTERAR FUNCTION: TROCAR A POR YEARS E D POR DAYS
								  PF1.QT_ALTURA_CM AS PT_HEIGHT,
								  PF1.QT_PESO AS PT_WEIGHT, 
								  'KG' AS PT_WEIGHT_TANI,

								  tosho_presc_injection_pck.jpn_body_surface(NR_PRESCRICAO_P) AS PT_TAIHYO, --BODY SURFACE AREA JRS 756
								  '        ' AS PT_CCR, --NOT USED
								  ' ' AS PT_FLG1, --NOT USED
								  ' ' AS PT_FLG2, --NOT USED
								  ' ' AS PT_FLG5, --NOT USED
								  SUBSTR(OBTER_ENDERECO_PF(PF1.CD_PESSOA_FISICA, 'END'),1,80) AS PT_ADDR,
								  OBTER_ENDERECO_PF(PF1.CD_PESSOA_FISICA, 'CEP') AS PT_ZIP,
								  OBTER_TELEFONE_PF(PF1.CD_PESSOA_FISICA, '1') AS PT_TEL,

								  XX_SYBT_W AS XX_SYBT,
								  IRAI_KBN_W AS IRAI_KBN,
								  TO_CHAR(clock_timestamp(), 'YYYYMMDD') || SUBSTR(TO_CHAR(CM1.NR_SEQUENCIA),5,10) AS BUMON_NO,
								  NYUGAI_KBN_W AS NYUGAI_KBN2,
								  '1' AS HD_PLACE_FLG, --CAMPO SHIPPING_DESTINATION_FLAG JRS 376
								  CM1.CD_SETOR_ATENDIMENTO AS HD_PLACE_CD,
								  OBTER_DESC_SETOR_ATEND(CM1.CD_SETOR_ATENDIMENTO) AS HD_PLACE_NAME,
								  OBTER_DESC_SETOR_ATEND(CM1.CD_SETOR_ATENDIMENTO) AS JISSI_PLACE,
								  tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A') AS KA_CD2,
								  SUBSTR(OBTER_DESC_SETOR_ATEND(tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A')),1,20) AS KA_NAME2,
								  OBTER_INICIAIS_SETOR(OBTER_DESC_SETOR_ATEND(tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A'))) AS KA_NAME_R2,
								  tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A') AS BYOTO_CD2,
								  SUBSTR(OBTER_DESC_SETOR_ATEND(tosho_presc_injection_pck.obter_set_atend_unidade(AP1.NR_ATENDIMENTO, 'A')),1,20) AS BYOTO_NAME2,
								  BEV.ROOM_ID AS ROOM_CD2,
								  OBTER_LEITO_ATUAL_PAC(AP1.NR_ATENDIMENTO) AS ROOM_NAME2,
								  OBTER_CODIGO_USUARIO(CM1.NM_USUARIO) AS DR_ID2,
								  OBTER_NOME_MEDICO(OBTER_CODIGO_USUARIO(CM1.NM_USUARIO), 'PS') AS DR_NAME,
								  OBTER_CODIGO_USUARIO(CM1.NM_USUARIO_LIB_FARM) AS OP_ID, --USUARIO LIBERACAO FARMACIA
								  OBTER_NOME_USUARIO(CM1.NM_USUARIO_LIB_FARM) AS OP_NAME, --USUARIO LIBERACAO FARMACIA
								  PD1.NR_DOCUMENT AS MAYAK_NO,
								  TO_CHAR(PD1.DT_START, 'YYYYMMDD') AS MAYAK_ST_DATE,	   
								  TO_CHAR(PD1.DT_VALIDADE, 'YYYYMMDD') AS MAYAK_ED_DATE,
								  TO_CHAR(CR1.DT_INICIO, 'YYYYMMDD') AS IN_DATE2,
								  TO_CHAR(CR1.DT_INICIO, 'HH24MISS') AS IN_TIME,
								  TO_CHAR(CM1.DT_INICIO, 'YYYYMMDD') AS START_DATE1,
								  TO_CHAR(CM1.DT_FIM, 'YYYYMMDD') AS END_DATE1,
								  '        ' AS STOP_DATE2, --NOT USED
								  ' ' AS STOP_COMMENT, --NOT USED
								  ' ' AS IVH_MUKIN, --NOT USED
								  CHICKEN_FLG_W AS CHICKEN_FLG,
								  '                                                                     ' AS CHIKEN_NAME,
								  '        ' AS LAST_DR_ID, --NOT USED
								  '        ' AS LAST_NS_ID, --NOT USED
								  '        ' AS LAST_OP_ID, --NOT USED
								  TO_CHAR(CR1.DT_ATUALIZACAO, 'YYYYMMDD') AS LAST_DATE,
								  TO_CHAR(CR1.DT_ATUALIZACAO, 'HH24MISS') AS LAST_TIME,

								  RP_SUM_W AS RP_SUM,

								  --INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) END OF COMMON INFORMATIONS
								  --INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) MEDICINES INFORMATIONS
								  '1' AS RP_REC_KBN, --VALIDAR COM O THIAGO
								  ' ' AS CHG_KBN, --NOT USED
								  LPAD(CR1.NR_SEQUENCIA_RP, 3, '0') AS RP_NUM,
								  LPAD(CR1.NR_SEQUENCIA, 5, '0') AS RP_SEQ1,
								  '   ' AS SET_CD1, --NOT USED
								  '   ' AS SET_CD_2, --NOT USED
								  '   ' AS SET_KBN, 
								  '                                        ' AS SET_NAME,
								  TO_CHAR(CR1.DT_INICIO, 'YYYYMMDD') AS DAY_XX, 
								  ' ' AS STATUS1, --NOT USED
								  ' ' AS BUMON_FLG1, --FIXO
								  ' ' AS MIX_SIJI, --FIXO
								  ' ' AS MIX, --FIXO
								  ' ' AS IVH_SIJI, --FIXO
								  ' ' AS IVH, --FIXO
								  LPAD(CM1.CD_MATERIAL, 5, 0) AS YKH_NO, --MEDICINE NUMBER (COD) (JRS 330)
								  CM1.IE_DRIP_SHOT AS SYUGI_KBN, --(JRS 378)
								  CM1.IE_VIA_APLICACAO AS SYUGI_CD, --PENDENTE DO CAMPO (JRS 378)
								  (SELECT DS_VIA_APLICACAO
								     FROM VIA_APLICACAO
								    WHERE IE_VIA_APLICACAO = CM1.IE_VIA_APLICACAO) AS SYUGI_NAME, --(JRS 378)
								  (SELECT DS_VIA_APLICACAO
								     FROM VIA_APLICACAO
								    WHERE IE_VIA_APLICACAO = CM1.IE_VIA_APLICACAO) AS ROOT_NAME, --(JRS 378)
								  ' ' AS YOHO_DSP_NAME, --WAITING IBM 
								  TO_CHAR(CR1.DT_INICIO, 'YYYYMMDD') AS START_DATE2,
								  TO_CHAR(CR1.DT_FIM, 'YYYYMMDD') AS END_DATE2,
								  '1' AS TIMING_TYPE, --WAITING IBM
								  '                                                                                                    ' AS JISSI_TIMING, --WAITING IBM
								  '   ' AS JISSI_SUM, --WAITING IBM
								  TO_CHAR(CM1.DT_FIM, 'YYYYMMDD HH24MISS') AS TON_KIGEN,
								  CR1.QT_OPERACAO AS YOHO_NAI,
								  '  ' AS HKN_SIJI, --NOT USED
								  ' ' AS SEIMITU_FLG, --NOT USED
								  ' ' AS MUKIN_TGT_FLG, --NOT USED
								  ' ' AS MUKIN_FLG, --NOT USED
								  '          ' AS YOBI_FLG1, --NOT USED
								  '        ' AS YKH_START, --FIXED
								  LPAD(CR1.NR_SEQUENCIA, 5, '0') AS RP_SEQ2,   
								  LPAD(CR1.NR_SEQUENCIA_RP, 3, '0') AS YKH_NUM,
								  CM1.CD_MATERIAL AS YKH_ID,
								  MA1.DS_MATERIAL AS YHK_NAME,
								  '                                                ' AS YHK_NAME_NL, --FIXED
								  '                                                                  ' AS YHK_INF_J, --FIXED
								  CM1.QT_DOSAGEM AS YOURYO,
								  CM1.IE_TIPO_DOSAGEM AS TANI_CD,
								  OBTER_VALOR_DOMINIO(1591,CM1.IE_TIPO_DOSAGEM) AS TANI_NAME,
								  ' ' AS SELECT_TANI, --PENDENTE DO CAMPO
								  '        ' AS HD_YKH_ID1,
								  '                                                ' AS HD_YKH1_NAME,
								  '            ' AS HD_YOURYO1,
								  '  ' AS HD_TANI1,
								  '    ' AS HD_TANI1_NAME,
								  '        ' AS HD_YKH_ID2,
								  '                                                ' AS HD_YKH2_NAME,
								  '            ' AS HD_YOURYO2,
								  '  ' AS HD_TANI2,
								  '    ' AS HD_TANI2_NAME,
								  '        ' AS HD_YKH_ID3,
								  '                                                ' AS HD_YKH3_NAME,
								  '            ' AS HD_YOURYO3,
								  '  ' AS HD_TANI3,
								  '    ' AS HD_TANI3_NAME,
								  '        ' AS HD_YKH_ID4,
								  '                                                ' AS HD_YKH4_NAME,
								  '            ' AS HD_YOURYO4,
								  '  ' AS HD_TANI4,
								  '    ' AS HD_TANI4_NAME,
								  '        ' AS HD_YKH_ID5,
								  '                                                ' AS HD_YKH5_NAME,
								  '            ' AS HD_YOURYO5,
								  '  ' AS HD_TANI5,
								  '    ' AS HD_TANI5_NAME,
								  ' ' AS HARAIDASI_FLG,
								  '    ' AS YAKKOU_CD,
								  IP1.CD_INTERVALO AS ZAIKEI_CD, --PENDENTE DO CAMPO
								  ' ' AS MAIAKU_FLG, --PENDENTE DO CAMPO
								  ' ' AS KONCYU_FLG,
								  ' ' AS PICK_FLG,
								  ' ' AS COOL_FLG,
								  '        ' AS WARN_FLG,
								  '  ' AS TOKU_SJI,
								  ' ' AS JYOBI_FLG,
								  ' ' AS REPORT_PRT,
								  '        ' AS YOBI_FLG2,
								  '      ' AS HOKAN_PLS_CD1,
								  '      ' AS HOKAN_PLS_CD2, 
							      --INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) END OF MEDICINES INFORMATIONS
							      
							      tosho_presc_injection_pck.obter_obs_order_unity(CO1.NR_SEQUENCIA) AS OBS_ORDER_UNITY
							      
							 FROM PESSOA_FISICA PF1
							 JOIN ATENDIMENTO_PACIENTE AP1 ON (PF1.CD_PESSOA_FISICA = AP1.CD_PESSOA_FISICA)
							 LEFT JOIN PESSOA_DOCUMENTACAO PD1 ON (PF1.CD_PESSOA_FISICA = PD1.CD_PESSOA_FISICA)
							 LEFT JOIN MEDICO MD1 ON (PD1.CD_PESSOA_FISICA = MD1.CD_PESSOA_FISICA)

							 JOIN CPOE_MATERIAL CM1 ON (AP1.NR_ATENDIMENTO = CM1.NR_ATENDIMENTO AND	
							 							CM1.NR_SEQUENCIA = (SELECT O.NR_SEQ_MAT_CPOE
							 							 					  FROM PRESCR_MATERIAL O
							 				 WHERE O.NR_PRESCRICAO = NR_PRESCRICAO_P))  

							 JOIN CPOE_ORDER_UNIT CO1 ON (CM1.NR_SEQ_CPOE_ORDER_UNIT = CO1.NR_SEQUENCIA)
							 JOIN CPOE_RP CR1 ON (CO1.NR_SEQUENCIA = CR1.NR_SEQ_CPOE_ORDER_UNIT)
						     JOIN CPOE_TIPO_PEDIDO CT1 ON (CO1.NR_SEQ_CPOE_TIPO_PEDIDO = CT1.NR_SEQUENCIA 
						                                   AND CT1.NR_SEQ_SUB_GRP = 'I')				     
						     LEFT JOIN CPOE_COMMENT_LINKAGE CML1 ON (CM1.NR_SEQUENCIA = CML1.NR_SEQ_CPOE_MATERIAL)

						     JOIN MATERIAL MA1 ON (CM1.CD_MATERIAL = MA1.CD_MATERIAL)

			            	 LEFT JOIN INTERVALO_PRESCRICAO IP1 ON (CM1.CD_INTERVALO = IP1.CD_INTERVALO)

							 JOIN BFT_ENCOUNTER_V BEV ON (AP1.NR_ATENDIMENTO = BEV.NR_ATENDIMENTO)

							 JOIN PRESCR_MATERIAL PMAT ON (CM1.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE AND
							 							   CM1.CD_MATERIAL = PMAT.CD_MATERIAL)



					        WHERE PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P
					          AND CR1.NR_SEQUENCIA = NR_CHAVE_W;




			C03 CURSOR FOR  SELECT CM2.CD_MATERIAL,
								  CR2.NR_SEQUENCIA
							 FROM CPOE_MATERIAL CM2
							 JOIN CPOE_ORDER_UNIT CO2 ON (CM2.NR_ATENDIMENTO = CO2.NR_ATENDIMENTO AND
							 							  CO2.NR_SEQ_CPOE_TIPO_PEDIDO = 138)
							 JOIN CPOE_RP CR2 ON (CO2.NR_SEQUENCIA = CR2.NR_SEQ_CPOE_ORDER_UNIT AND
							 					  CM2.NR_SEQ_CPOE_RP = CR2.NR_SEQUENCIA)
							 JOIN MATERIAL MA2 ON (CM2.CD_MATERIAL = MA2.CD_MATERIAL)
							 JOIN PRESCR_MATERIAL PMAT ON (CM2.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE)
						    WHERE PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P;


			C04 CURSOR FOR  SELECT CM1.DT_ATUALIZACAO,
								  CM1.NR_SEQ_MOTIVO_SUSP,
								  CO1.SI_TYPE_OF_PRESCRIPTION,
								  AP1.NR_ATENDIMENTO,
								  CM1.IE_URGENCIA,
								  PF1.CD_PESSOA_FISICA,
								  CM1.CD_MATERIAL,
								  CO1.NR_SEQUENCIA,
								  CR1.NR_SEQUENCIA,
								  MA1.IE_ALTA_VIGILANCIA,
								  MA1.IE_ALTO_RISCO,
								  CM1.NM_USUARIO
							 FROM PESSOA_FISICA PF1
							 JOIN ATENDIMENTO_PACIENTE AP1 ON (PF1.CD_PESSOA_FISICA = AP1.CD_PESSOA_FISICA)
							 JOIN CPOE_MATERIAL CM1 ON (AP1.NR_ATENDIMENTO = CM1.NR_ATENDIMENTO)  
							 JOIN CPOE_ORDER_UNIT CO1 ON (CM1.NR_SEQ_CPOE_ORDER_UNIT = CO1.NR_SEQUENCIA)
							 JOIN CPOE_RP CR1 ON (CO1.NR_SEQUENCIA = CR1.NR_SEQ_CPOE_ORDER_UNIT)
							 JOIN MATERIAL MA1 ON (CM1.CD_MATERIAL = MA1.CD_MATERIAL)
							 JOIN PRESCR_MATERIAL PMAT ON (CM1.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE)
					        WHERE (CO1.SI_TYPE_OF_PRESCRIPTION IS NOT NULL AND CO1.SI_TYPE_OF_PRESCRIPTION::text <> '') 
					          AND PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P;


			
BEGIN

				JPN_PRESCR_INJECTION_CHK_W := tosho_presc_injection_pck.jpn_injection_chk(NR_PRESCRICAO_P);

				IF (JPN_PRESCR_INJECTION_CHK_W = 'N')
				THEN RETURN;
				ELSIF (JPN_PRESCR_INJECTION_CHK_W = 'S')
				THEN


			    SELECT DISTINCT CM1.NM_USUARIO
				  INTO STRICT NM_USUARIO_MEDIC_W
				  FROM PESSOA_FISICA PF1
				  JOIN ATENDIMENTO_PACIENTE AP1 ON (PF1.CD_PESSOA_FISICA = AP1.CD_PESSOA_FISICA)
				  JOIN CPOE_MATERIAL CM1 ON (AP1.NR_ATENDIMENTO = CM1.NR_ATENDIMENTO)  
				  JOIN CPOE_ORDER_UNIT CO1 ON (CM1.NR_SEQ_CPOE_ORDER_UNIT = CO1.NR_SEQUENCIA)
				  JOIN CPOE_RP CR1 ON (CO1.NR_SEQUENCIA = CR1.NR_SEQ_CPOE_ORDER_UNIT)
				  JOIN MATERIAL MA1 ON (CM1.CD_MATERIAL = MA1.CD_MATERIAL)
				  JOIN PRESCR_MATERIAL PMAT ON (CM1.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE)
				 WHERE (CO1.SI_TYPE_OF_PRESCRIPTION IS NOT NULL AND CO1.SI_TYPE_OF_PRESCRIPTION::text <> '') 
				   AND PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P;


			    GENERATE_INT_SERIAL_NUMBER(0, 'TOSHO_PDATA', OBTER_ESTAB_USUARIO(NM_USUARIO_MEDIC_W), NM_USUARIO_MEDIC_W, SEQUENCIAL_W, 954);					

				OPEN C04;
				LOOP
				FETCH C04 INTO DT_ATUALIZACAO_W,
							   NR_SEQ_MOTIVO_SUSP_W,
							   SI_TYPE_OF_PRESCRIPTION_W,
							   NR_ATENDIMENTO_W,
							   IE_URGENCIA_W,
							   CD_PESSOA_FISICA_W,
							   CD_MATERIAL_W,
							   NR_SEQ_CR_W,
							   NR_CHAVE_W,
							   IE_ALTA_VIGILANCIA_W,
							   IE_ALTO_RISCO_W,
							   NM_USUARIO_MEDIC_W;
				EXIT WHEN NOT FOUND; /* apply on C04 */


				/*PROCESSING CLASSIFICATION*/

				IF (coalesce(DT_ATUALIZACAO_W::text, '') = '' AND coalesce(NR_SEQ_MOTIVO_SUSP_W::text, '') = '')
				THEN SYORI_KBN_W := '1';
				ELSIF ((DT_ATUALIZACAO_W IS NOT NULL AND DT_ATUALIZACAO_W::text <> '') AND coalesce(NR_SEQ_MOTIVO_SUSP_W::text, '') = '')
				THEN SYORI_KBN_W := '2';
				ELSIF (NR_SEQ_MOTIVO_SUSP_W IS NOT NULL AND NR_SEQ_MOTIVO_SUSP_W::text <> '')
				THEN SYORI_KBN_W := '3';
				END IF;

				--PROCESSING DATE
				IF (coalesce(DT_ATUALIZACAO_W::text, '') = '')
				THEN DT_ATUALIZACAO_W := clock_timestamp();
				END IF;

				--PATIENT TYPE (NEED TO FIND THE OTHERS CODES IN THE JAPAN/INDIA DATABASE
				IF (SI_TYPE_OF_PRESCRIPTION_W = 'INTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'IPSI' OR SI_TYPE_OF_PRESCRIPTION_W = 'NINJ')
				THEN NYUGAI_KBN_W := '2';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W = 'OPTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'OPSI')
				THEN NYUGAI_KBN_W := '1';
				END IF;


			    /*INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) - THESE FIELDS DON'T CHANGE EACH LINE*/

				IF (coalesce(DT_ATUALIZACAO_W::text, '') = '' AND coalesce(NR_SEQ_MOTIVO_SUSP_W::text, '') = '')
				THEN REC_KBN_W := '1';
				ELSIF ((DT_ATUALIZACAO_W IS NOT NULL AND DT_ATUALIZACAO_W::text <> '') AND coalesce(NR_SEQ_MOTIVO_SUSP_W::text, '') = '')
				THEN REC_KBN_W := '2';
				ELSIF (NR_SEQ_MOTIVO_SUSP_W IS NOT NULL AND NR_SEQ_MOTIVO_SUSP_W::text <> '')
				THEN REC_KBN_W := '3';
				END IF;

				IF (coalesce(DT_ATUALIZACAO_W::text, '') = '' AND coalesce(NR_SEQ_MOTIVO_SUSP_W::text, '') = '')
				THEN SEND_KBN_W := '0';
				ELSIF (DT_ATUALIZACAO_W IS NOT NULL AND DT_ATUALIZACAO_W::text <> '')
				THEN SEND_KBN_W := '1';
				END IF;

				IF (IE_ALTO_RISCO_W = 'S')
				THEN IE_ALTO_RISCO_X := '1';
				ELSE IE_ALTO_RISCO_X := '0';
				END IF;

				IF (IE_ALTA_VIGILANCIA_W = 'S')
				THEN IE_ALTA_VIGILANCIA_X := '1';
				ELSE IE_ALTA_VIGILANCIA_X := '0';
				END IF;	


				IF (SI_TYPE_OF_PRESCRIPTION_W = 'INTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'NINJ' AND IE_ALTO_RISCO_X = '0')
				THEN XX_SYBT_W := '420';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W = 'INTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'NINJ' AND IE_ALTO_RISCO_X = '1')
				THEN XX_SYBT_W := '421';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'OPTI' AND IE_ALTO_RISCO_X = '0')
				THEN XX_SYBT_W := '320';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'OPTI' AND IE_ALTO_RISCO_X = '1')
				THEN XX_SYBT_W := '321';	
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'IPSI' AND IE_ALTO_RISCO_X = '0')
				THEN XX_SYBT_W := '410';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'IPSI' AND IE_ALTO_RISCO_X = '1')
				THEN XX_SYBT_W := '411';	
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'OPSI' AND IE_ALTO_RISCO_X = '0')
				THEN XX_SYBT_W := '310';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W  = 'OPSI' AND IE_ALTO_RISCO_X = '0')
				THEN XX_SYBT_W := '311';	
				END IF;


				IF (IE_URGENCIA_W = '0')
				THEN IRAI_KBN_W := '3';
				ELSIF ((IE_URGENCIA_W IS NOT NULL AND IE_URGENCIA_W::text <> '') AND IE_URGENCIA_W != '0' OR coalesce(IE_URGENCIA_W::text, '') = '')
				THEN IRAI_KBN_W := '1';
				ELSIF (IE_MEDICACAO_PACIENTE_W = 'S' AND IE_URGENCIA_W != '0')
				THEN IRAI_KBN_W := 'J';
				END IF;

				IF (SI_TYPE_OF_PRESCRIPTION_W = 'OPSI' OR SI_TYPE_OF_PRESCRIPTION_W = 'OPTI')
				THEN NYUGAI_KBN_W := '1';
				ELSIF (SI_TYPE_OF_PRESCRIPTION_W = 'IPSI' OR SI_TYPE_OF_PRESCRIPTION_W = 'INTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'NINJ')
				THEN NYUGAI_KBN_W := '2';
				END IF;



				--INDIVIDUAL ITEM1 (INJECTION ORDER INFORMATION) - THESE FIELDS CHANGE EACH LINE
				SELECT COUNT(AUX1.CD_MATERIAL)
				  INTO STRICT QTD_MEDIC_SOLIC
				  FROM CPOE_MATERIAL AUX1
				  JOIN PRESCR_MATERIAL PMAT ON (AUX1.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE)
				 WHERE PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P;


			    SELECT COUNT(CR2.NR_SEQUENCIA)
			      INTO STRICT QTD_EOF_KBN
				  FROM CPOE_MATERIAL CM2
				  JOIN CPOE_ORDER_UNIT CO2 ON (CM2.NR_ATENDIMENTO = CO2.NR_ATENDIMENTO)
				  JOIN CPOE_RP CR2 ON (CO2.NR_SEQUENCIA = CR2.NR_SEQ_CPOE_ORDER_UNIT)
				  JOIN PRESCR_MATERIAL PMAT ON (CM2.NR_SEQUENCIA = PMAT.NR_SEQ_MAT_CPOE)
				 WHERE PMAT.NR_PRESCRICAO = NR_PRESCRICAO_P;


			    CONTADOR_H0_W := 0;
				CONTADOR_H1_W := 0;
				CONTADOR_H2_W := 0;
				CONTADOR_H4_W := 0;
				CONTADOR_HJ_W := 0;

				EOF_KBN_W := ' ';

				COUNTER_LOOP_C01 := 0;		

				OPEN C03;
				LOOP
				FETCH C03 INTO CD_MATERIAL_W,
							   NR_SEQ_CR_W;
				EXIT WHEN NOT FOUND; /* apply on C03 */

				RP_SUM_W := RP_SUM_W + 1;

				END LOOP;
				CLOSE C03;


				IF (SI_TYPE_OF_PRESCRIPTION_W = 'IPSI' OR SI_TYPE_OF_PRESCRIPTION_W = 'INTI' OR SI_TYPE_OF_PRESCRIPTION_W = 'NINJ')
				THEN 

				DATA_NOME_ARQUIVO := 'H'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||SEQUENCIAL_W||XX_SYBT_W||TO_CHAR(DT_ATUALIZACAO_W, 'MMDD-YYYY')||'1'||'.dat';

				FOR R_C01 IN C01 LOOP BEGIN
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MESSAGE_CLASSIFICATION, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_TIME1, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SENDOR_SYSTEM_CODE, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECEIVER_SIDE_SYSTEM_CODE, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NUMBER_COMMON_READERS, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYORI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_TIME2, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NYUGAI_KBN1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_ID1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SH_KANA_NAME, 20, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SH_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_DATE1, 8, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_RSN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ID1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KN_NAME1, 23, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KJ_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_SEX1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_BIRTH1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_STATUS, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_CD1, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KOBETU_CNT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.FORMAT_KBN, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.REC_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEQ_NO, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.EOF_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECORD_LEN, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECORD_NUM, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TIMESTAMP1, 14, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PICKING, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEND_KBN, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OUTPUT_MODE, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RESERVE, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ID2, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KN_NAME2, 23, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KJ_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_SEX2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_BIRTH2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_AGE, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_HEIGHT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_WEIGHT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_WEIGHT_TANI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_TAIHYO, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_CCR, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG5, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ADDR, 80, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ZIP, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_TEL, 15, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.XX_SYBT, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IRAI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 13, 'R'); --AS ORDER_NO
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BUMON_NO, 13, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NYUGAI_KBN2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_CD, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_PLACE, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_CD2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME_R2, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_CD2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_CD2, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_ID2, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OP_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OP_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_NO, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_ST_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_ED_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_TIME, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.START_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.END_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_COMMENT, 50, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH_MUKIN, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHICKEN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHIKEN_NAME, 69, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_DR_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_NS_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_OP_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_TIME, 6, 'R');
					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OBS_ORDER_UNITY, 535, 'R'); --OBS ORDER UNITY PRS 801
					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SUM, 3, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_REC_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHG_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_NUM, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SEQ1, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_CD_2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_KBN, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_NAME, 40, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DAY_XX, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STATUS1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BUMON_FLG1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MIX_SIJI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MIX, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH_SIJI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_NO, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_CD, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_NAME, 16, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOT_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOHO_DSP_NAME, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.START_DATE2, 8, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.END_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TIMING_TYPE, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_TIMING, 100, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_SUM, 3, 'R');

					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 8, 'R'); --AS INTERVAL_CD
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 60, 'R'); --AS INTERVAL
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TON_KIGEN, 60, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOHO_NAI, 60, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HKN_SIJI, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEIMITU_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MUKIN_TGT_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MUKIN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOBI_FLG1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_START, 9, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SEQ2, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_NUM, 5, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_ID, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_NAME_NL, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_INF_J, 66, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOURYO, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TANI_CD, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TANI_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SELECT_TANI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH1_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO1, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI1, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI1_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH2_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO2, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI2, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI2_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID3, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH3_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO3, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI3, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI3_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID4, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH4_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO4, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI4, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI4_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID5, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH5_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO5, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI5, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI5_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HARAIDASI_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YAKKOU_CD, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ZAIKEI_CD, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAIAKU_FLG, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KONCYU_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PICK_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.COOL_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.WARN_FLG, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TOKU_SJI, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JYOBI_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.REPORT_PRT, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOBI_FLG2, 9, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HOKAN_PLS_CD1, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HOKAN_PLS_CD2, 6, 'R');


				    PERFORM set_config('tosho_presc_injection_pck.ds_line2_w', current_setting('tosho_presc_injection_pck.ds_line2_w')::varchar(32767) || current_setting('tosho_presc_injection_pck.ds_line_w')::varchar(32767) || CHR(13), false);

					 --GENERATE LOG FILE
	                 DATA_NOME_ARQUIVO_LOG := 'H'||'S'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||'.log';

				     CALL PLS_UTL_FILE_PCK.NOVA_LEITURA('142', DATA_NOME_ARQUIVO_LOG, 'A');

				     DS_ARQ_LOG_MESSAGE := 'File successfully uploaded for Injection Order Info ' || DATA_NOME_ARQUIVO || ', ' || 'Time of Transmission: ' || TO_CHAR(clock_timestamp(), 'YYYYMMDD HH24MISS');				

					 CALL PLS_UTL_FILE_PCK.ESCREVER(DS_ARQ_LOG_MESSAGE);
					 CALL PLS_UTL_FILE_PCK.FECHAR_ARQUIVO();								

					END;
					END LOOP;


				CALL CALL CALL tosho_presc_injection_pck.generate_file(147, DATA_NOME_ARQUIVO, current_setting('tosho_presc_injection_pck.ds_line2_w')::varchar(32767));


				ELSIF (SI_TYPE_OF_PRESCRIPTION_W = 'OPSI' OR SI_TYPE_OF_PRESCRIPTION_W = 'OPTI')
				THEN 				


				DATA_NOME_ARQUIVO := 'H'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||SEQUENCIAL_W||XX_SYBT_W||TO_CHAR(DT_ATUALIZACAO_W, 'MMDD-YYYY')||'1'||'.dat';			    		    		


				FOR R_C01 IN C01 LOOP BEGIN
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MESSAGE_CLASSIFICATION, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_TIME1, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SENDOR_SYSTEM_CODE, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECEIVER_SIDE_SYSTEM_CODE, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NUMBER_COMMON_READERS, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYORI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CREATION_TIME2, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NYUGAI_KBN1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_ID1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SH_KANA_NAME, 20, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SH_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_DATE1, 8, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_RSN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ID1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KN_NAME1, 23, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KJ_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_SEX1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_BIRTH1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_STATUS, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_CD1, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_NAME1, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KOBETU_CNT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.FORMAT_KBN, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.REC_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEQ_NO, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.EOF_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECORD_LEN, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RECORD_NUM, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TIMESTAMP1, 14, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PICKING, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEND_KBN, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OUTPUT_MODE, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RESERVE, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ID2, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KN_NAME2, 23, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_KJ_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_SEX2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_BIRTH2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_AGE, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_HEIGHT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_WEIGHT, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_WEIGHT_TANI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_TAIHYO, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_CCR, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_FLG5, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ADDR, 80, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_ZIP, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PT_TEL, 15, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.XX_SYBT, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IRAI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 13, 'R'); --AS ORDER_NO
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BUMON_NO, 13, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.NYUGAI_KBN2, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_CD, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_PLACE_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_PLACE, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_CD2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KA_NAME_R2, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_CD2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BYOTO_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_CD2, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOM_NAME2, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_ID2, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DR_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OP_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OP_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_NO, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_ST_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAYAK_ED_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IN_TIME, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.START_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.END_DATE1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STOP_COMMENT, 50, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH_MUKIN, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHICKEN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHIKEN_NAME, 69, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_DR_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_NS_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_OP_ID, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_DATE, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.LAST_TIME, 6, 'R');
					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.OBS_ORDER_UNITY, 535, 'R'); --OBS ORDER UNITY PRS 801
					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SUM, 3, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_REC_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.CHG_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_NUM, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SEQ1, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_CD1, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_CD_2, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_KBN, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SET_NAME, 40, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.DAY_XX, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.STATUS1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.BUMON_FLG1, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MIX_SIJI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MIX, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH_SIJI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.IVH, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_NO, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_KBN, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_CD, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SYUGI_NAME, 16, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ROOT_NAME, 20, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOHO_DSP_NAME, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.START_DATE2, 8, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.END_DATE2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TIMING_TYPE, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_TIMING, 100, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JISSI_SUM, 3, 'R');

					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 8, 'R'); --AS INTERVAL_CD
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(' ', 60, 'R'); --AS INTERVAL
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TON_KIGEN, 60, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOHO_NAI, 60, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HKN_SIJI, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SEIMITU_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MUKIN_TGT_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MUKIN_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOBI_FLG1, 10, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_START, 9, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.RP_SEQ2, 5, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_NUM, 5, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YKH_ID, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_NAME_NL, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YHK_INF_J, 66, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOURYO, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TANI_CD, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TANI_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.SELECT_TANI, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID1, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH1_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO1, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI1, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI1_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID2, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH2_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO2, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI2, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI2_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID3, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH3_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO3, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI3, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI3_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID4, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH4_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO4, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI4, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI4_NAME, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH_ID5, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YKH5_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_YOURYO5, 12, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI5, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HD_TANI5_NAME, 32, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HARAIDASI_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YAKKOU_CD, 4, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.ZAIKEI_CD, 3, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.MAIAKU_FLG, 1, 'R');					
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.KONCYU_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.PICK_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.COOL_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.WARN_FLG, 8, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.TOKU_SJI, 2, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.JYOBI_FLG, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.REPORT_PRT, 1, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.YOBI_FLG2, 9, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HOKAN_PLS_CD1, 6, 'R');
					CALL CALL CALL CALL CALL CALL CALL CALL CALL CALL tosho_presc_injection_pck.append_text(R_C01.HOKAN_PLS_CD2, 6, 'R');



				    PERFORM set_config('tosho_presc_injection_pck.ds_line2_w', current_setting('tosho_presc_injection_pck.ds_line2_w')::varchar(32767) || current_setting('tosho_presc_injection_pck.ds_line_w')::varchar(32767) || CHR(13), false);


					 --GENERATE LOG FILE
	                 DATA_NOME_ARQUIVO_LOG := 'H'||'S'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||'.log';

				     CALL PLS_UTL_FILE_PCK.NOVA_LEITURA('142', DATA_NOME_ARQUIVO_LOG, 'A');

				     DS_ARQ_LOG_MESSAGE := 'File successfully uploaded for Injection Order Info ' || DATA_NOME_ARQUIVO || ', ' || 'Time of Transmission: ' || TO_CHAR(clock_timestamp(), 'YYYYMMDD HH24MISS');				

					 CALL PLS_UTL_FILE_PCK.ESCREVER(DS_ARQ_LOG_MESSAGE);
					 CALL PLS_UTL_FILE_PCK.FECHAR_ARQUIVO('T');								

				END;
				END LOOP;	


				CALL CALL CALL tosho_presc_injection_pck.generate_file(141, DATA_NOME_ARQUIVO, current_setting('tosho_presc_injection_pck.ds_line2_w')::varchar(32767));


				END IF;

				END LOOP;
				CLOSE C04;




                DATA_NOME_ARQUIVO_LOG := 'H'||'S'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||'.log';

			    CALL PLS_UTL_FILE_PCK.NOVA_LEITURA('142', DATA_NOME_ARQUIVO_LOG, 'A');

			    DS_ARQ_LOG_MESSAGE := 'File successfully uploaded for Injection Info ' || DATA_NOME_ARQUIVO || ', ' || 'Time of Transmission: ' || TO_CHAR(clock_timestamp(), 'YYYYMMDD HH24MISS');				

				CALL PLS_UTL_FILE_PCK.ESCREVER(DS_ARQ_LOG_MESSAGE);
				CALL PLS_UTL_FILE_PCK.FECHAR_ARQUIVO('T');


		        DS_LOG_MESSAGE := 'File successfully uploaded for Injection Info '
				                  || CHR(13)
								  || 'Prescription Number: ' || NR_PRESCRICAO_P
								  || CHR(13)
								  || ' Date of upload: ' || TO_CHAR(clock_timestamp(), 'YYYYMMDD HH24MISS');

				RECORD_INTEGRATION_CALL_LOG(NM_USUARIO_MEDIC_W, NM_USUARIO_MEDIC_W, clock_timestamp(), 'JAPAN_TOSHO_PDATA',
											'INJECTION INFO', 'T', 'E', NULL, DS_LOG_MESSAGE, 
											NULL, DS_LOG_MESSAGE, DATA_NOME_ARQUIVO, LOG_SEQUENCE_NUMBER_W, 
											NR_PRESCRICAO_P, 954);	


				END IF;													

			EXCEPTION
			WHEN OTHERS THEN

				DS_SCRIPT_RESEND_ERROR := 'TOSHO_PRESC_INJECTION_PCK.JPN_FOR_INJECTION_INFO ('
										  || NR_PRESCRICAO_P
										  || ');';

				DS_LOG_MESSAGE := 'Error occured while sending the integration message for Injection Info'
								  || CHR(13)
								  || 'Prescription Number: ' || NR_PRESCRICAO_P
								  || CHR(13)
								  || 'Time of Failure: ' || clock_timestamp();

				RECORD_INTEGRATION_CALL_LOG(NM_USUARIO_MEDIC_W, NM_USUARIO_MEDIC_W, clock_timestamp(), 'JAPAN_TOSHO_PDATA',
											'INJECTION ORDER INFO', 'F', 'E', DS_SCRIPT_RESEND_ERROR, 
											DS_LOG_MESSAGE, NULL, DS_LOG_MESSAGE, DATA_NOME_ARQUIVO, 
											LOG_SEQUENCE_NUMBER_W, NR_PRESCRICAO_P, 954);


				DATA_NOME_ARQUIVO_LOG := 'H'||'S'||'BI'||'AB'||TO_CHAR(clock_timestamp(), 'YYYYMMDD')||'.log';
				DS_ARQ_LOG_MESSAGE := TO_CHAR(clock_timestamp(), 'YYYYMMDD HH24MISS') || ' Error occured in file creation for Injection Info ' || ', In CPOE ' ||  ' Tasy';

			    CALL PLS_UTL_FILE_PCK.NOVA_LEITURA('142', DATA_NOME_ARQUIVO_LOG, 'A');				
				CALL PLS_UTL_FILE_PCK.ESCREVER(DS_ARQ_LOG_MESSAGE);
				CALL PLS_UTL_FILE_PCK.FECHAR_ARQUIVO('T');



			END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tosho_presc_injection_pck.jpn_for_injection_info (NR_PRESCRICAO_P bigint) FROM PUBLIC;
