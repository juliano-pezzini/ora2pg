-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tiss_ins_ret_denial_pck.check_if_med_mat_conciliate ( material_p material, cd_item_p text, dt_item_p timestamp, vl_item_p bigint, qt_item_p bigint, qt_item_orig_p bigint, cd_setor_p setor_atendimento.cd_setor_atendimento%type ) RETURNS varchar AS $body$
DECLARE

	
ie_result_w	varchar(1);
ie_setor_w	boolean;
ie_dt_atend_w	boolean;
ie_dt_conta_w	boolean;
ie_vl_item_w	boolean;
	

BEGIN
	ie_result_w := 'N';
	ie_setor_w 	:= false;
	ie_dt_atend_w 	:= false;
	ie_dt_conta_w 	:= false;
	ie_vl_item_w 	:= false;
	
	if material_p.ie_status = 'N'
	and (
		material_p.cd_material_tiss = cd_item_p
		or material_p.cd_material_tuss = cd_item_p
		or material_p.cd_material_convenio = cd_item_p
	) then

		if material_p.cd_setor_atendimento = cd_setor_p then
			ie_setor_w := true;
		end if;

		if material_p.dt_atendimento = dt_item_p then
			ie_dt_atend_w := true;
		end if;

		if material_p.dt_conta = dt_item_p then
			ie_dt_conta_w := true;
		end if;

		if 	material_p.vl_material = vl_item_p
			or material_p.vl_unitario = dividir(vl_item_p, qt_item_orig_p) then
			ie_vl_item_w := true;
		end if;
		
		if (ie_dt_conta_w or ie_dt_atend_w)
			and ie_vl_item_w
			and ie_setor_w then
			
			ie_result_w 	:= 'S';
			
		elsif (ie_dt_conta_w or ie_dt_atend_w)
			and ie_setor_w then
			
			ie_result_w 	:= 'S';
			
		elsif (ie_dt_conta_w or ie_dt_atend_w)
			and ie_vl_item_w then
			
			ie_result_w	:= 'S';
			
		elsif (ie_dt_conta_w or ie_dt_atend_w) then
		
			ie_result_w 	:= 'S';
			
		elsif (ie_vl_item_w) then
		
			ie_result_w	:= 'S';
			
		end if;
	
	end if;

	return ie_result_w;
		
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tiss_ins_ret_denial_pck.check_if_med_mat_conciliate ( material_p material, cd_item_p text, dt_item_p timestamp, vl_item_p bigint, qt_item_p bigint, qt_item_orig_p bigint, cd_setor_p setor_atendimento.cd_setor_atendimento%type ) FROM PUBLIC;
