-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tiss_ins_ret_denial_pck.check_if_procedure_conciliate ( procedimento_p procedimento, cd_item_p text, dt_item_p timestamp, vl_item_p bigint, cd_setor_p setor_atendimento.cd_setor_atendimento%type, ie_funcao_medico_p text ) RETURNS varchar AS $body$
DECLARE

		
ie_result_w varchar(1);

ie_setor_w	boolean;
ie_dt_atend_w	boolean;
ie_dt_conta_w	boolean;
ie_vl_item_w	boolean;
ie_func_med_w 	boolean;


BEGIN
	
	ie_result_w 	:= 'N';
	ie_setor_w 	:= false;
	ie_dt_atend_w 	:= false;
	ie_dt_conta_w 	:= false;
	ie_vl_item_w 	:= false;
	ie_func_med_w 	:= false;
	
	if 	procedimento_p.ie_status = 'N'
	and (
		cd_item_p = procedimento_p.cd_procedimento
		or cd_item_p = procedimento_p.cd_procedimento_tuss
		or cd_item_p = procedimento_p.cd_procedimento_convenio
		or cd_item_p = procedimento_p.cd_proc_tiss
		or cd_item_p = procedimento_p.cd_proc_tiss_xml
	) then

		if procedimento_p.cd_setor_atendimento = cd_setor_p then
			ie_setor_w := true;
		end if;

		if procedimento_p.dt_procedimento = dt_item_p then
			ie_dt_atend_w := true;
		end if;

		if procedimento_p.dt_conta = dt_item_p then
			ie_dt_conta_w := true;
		end if;

		if 	procedimento_p.vl_procedimento = vl_item_p
			or procedimento_p.vl_medico = vl_item_p then
			ie_vl_item_w := true;
		end if;

		if 	procedimento_p.ie_funcao_medico = ie_funcao_medico_p then
			ie_func_med_w := true;
		end if;

		if (ie_func_med_w
			and ie_vl_item_w
			and (ie_dt_conta_w or ie_dt_atend_w)) then
			ie_result_w 	:= 'S';
		elsif (ie_func_med_w and ie_vl_item_w) then
		
			ie_result_w 	:= 'S';
			
		elsif (ie_func_med_w and (ie_dt_conta_w or ie_dt_atend_w)) then
		
			ie_result_w 	:= 'S';
			
		elsif	((ie_dt_conta_w or ie_dt_atend_w) and ie_vl_item_w) then
		
			ie_result_w 	:= 'S';
			
		elsif (ie_vl_item_w) then			
		
			ie_result_w 	:= 'S';
			
		elsif (ie_dt_conta_w or ie_dt_atend_w) then
		
			ie_result_w 	:= 'S';
			
		end if;
			
	end if;
	
	return ie_result_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tiss_ins_ret_denial_pck.check_if_procedure_conciliate ( procedimento_p procedimento, cd_item_p text, dt_item_p timestamp, vl_item_p bigint, cd_setor_p setor_atendimento.cd_setor_atendimento%type, ie_funcao_medico_p text ) FROM PUBLIC;
