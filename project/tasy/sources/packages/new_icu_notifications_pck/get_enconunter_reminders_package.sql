-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION new_icu_notifications_pck.get_enconunter_reminders ( nr_atendimento_p bigint ) RETURNS varchar AS $body$
DECLARE


  ds_conteudo_w    varchar(4000);
  qt_pendencias_w    bigint;
  cd_pessoa_fisica_w  varchar(10);


BEGIN
    if (nr_atendimento_p > 0) then
      cd_pessoa_fisica_w   := obter_codigo_usuario(wheb_usuario_pck.get_nm_usuario);
      qt_pendencias_w := 0;
      qt_pendencias_w  := new_icu_notifications_pck.get_overdue_items(wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_cd_estabelecimento, nr_atendimento_p);
      if (qt_pendencias_w > 0 ) then
        ds_conteudo_w := wheb_mensagem_pck.get_texto(1119579,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
      end if;

      qt_pendencias_w := 0;
      qt_pendencias_w := new_icu_notifications_pck.get_approval_items(nr_atendimento_p);
      if (qt_pendencias_w > 0) then
        if (coalesce(ds_conteudo_w, 'XPTO') <> 'XPTO') then
          ds_conteudo_w := ds_conteudo_w || chr(13) || wheb_mensagem_pck.get_texto(1119580,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        else
          ds_conteudo_w := wheb_mensagem_pck.get_texto(1119580,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        end if;
      end if;

      qt_pendencias_w := 0;
      qt_pendencias_w := new_icu_notifications_pck.get_pending_cosign_adm(nr_atendimento_p);
      if (qt_pendencias_w > 0) then
        if (coalesce(ds_conteudo_w, 'XPTO') <> 'XPTO') then
          ds_conteudo_w := ds_conteudo_w || chr(13) || wheb_mensagem_pck.get_texto(1119582,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        else
          ds_conteudo_w := wheb_mensagem_pck.get_texto(1119582,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        end if;
      end if;

      qt_pendencias_w := 0;
      qt_pendencias_w := new_icu_notifications_pck.get_pending_verif_items(cd_pessoa_fisica_w, nr_atendimento_p);
      if (qt_pendencias_w > 0) then
        if (coalesce(ds_conteudo_w, 'XPTO') <> 'XPTO') then
          ds_conteudo_w := ds_conteudo_w || chr(13) || wheb_mensagem_pck.get_texto(1119583,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        else
          ds_conteudo_w := wheb_mensagem_pck.get_texto(1119583,'DS_TOTAL_P='||'('||qt_pendencias_w||')');
        end if;
      end if;
    end if;

    return   ds_conteudo_w;

  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION new_icu_notifications_pck.get_enconunter_reminders ( nr_atendimento_p bigint ) FROM PUBLIC;
