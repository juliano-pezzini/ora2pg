-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION new_icu_notifications_pck.get_overdue_items ( nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_atendimento_p bigint) RETURNS bigint AS $body$
DECLARE


ie_etapas_sol_w     	varchar(1);
qt_horas_aten_sol_w   	varchar(255);
qt_minutos_w       		varchar(255);
qt_minutos_disp_w     	varchar(255);
ie_consiste_adm_ccg_w	varchar(255);
qt_overdue_items_w    	bigint := 0;


BEGIN

    if (nm_usuario_p IS NOT NULL AND nm_usuario_p::text <> '' AND cd_estabelecimento_p IS NOT NULL AND cd_estabelecimento_p::text <> '') then

		obter_Param_Usuario(1113, 144, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_etapas_sol_w);
		obter_Param_Usuario(1113, 153, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, qt_horas_aten_sol_w);
		obter_Param_Usuario(1113, 198, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, qt_minutos_w);
		obter_Param_Usuario(1113, 200, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, qt_minutos_disp_w);
		obter_Param_Usuario(1113, 543, cd_perfil_p, nm_usuario_p, cd_estabelecimento_p, ie_consiste_adm_ccg_w);

    end if;

	qt_overdue_items_w := Obter_qt_hor_pendente_prescr(
							cd_estabelecimento_p,
							null,
							cd_perfil_p,
							nr_atendimento_p,
							48,
							trunc(clock_timestamp()),
							trunc(clock_timestamp()) + 86399 / 86400,
							1,
							ie_etapas_sol_w,
							coalesce(qt_horas_aten_sol_w,'30'),
							coalesce(qt_minutos_w,'60'),
							qt_minutos_disp_w,
							ie_consiste_adm_ccg_w);

	return qt_overdue_items_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION new_icu_notifications_pck.get_overdue_items ( nm_usuario_p text, cd_perfil_p bigint, cd_estabelecimento_p bigint, nr_atendimento_p bigint) FROM PUBLIC;
