-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_util_pck.sql_tabela ( ds_tabela_p text, ds_alias_p text, dados_select_p INOUT dados_select, ie_tabela_fixa_p boolean default true) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Adicionar uma tabela ao comando sql que está sendo montado. Se a mesma tabela com o mesmo alias
	já existir no comando nada será feito.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

ie_tabela_fixa_p : indique se o comando será montado todo nesta procedure ou se algumas tabelas já serão fixos

Alterações:
------------------------------------------------------------------------------------------------------------------
jjung OS 721121 - 31/03/2014 - Criação da function.
15/05/2014 - Aumentado ds_tabela_w de 75 para 4000, para poder usar table function
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ie_instr_w	integer;
ds_tabela_w	varchar(4000);


BEGIN

-- Monta como ficará a tabela no comando
ds_tabela_w	:= pls_util_pck.sql_alias(ds_tabela_p, ds_alias_p);

ie_instr_w := position(lower(ds_tabela_w) in lower(dados_select_p.ds_tabelas));

-- Só adiciona uma vez para a mesma tableas com mesmo alias.
if (coalesce(ie_instr_w::text, '') = '' or ie_instr_w = 0) then

	if ((dados_select_p.ds_tabelas IS NOT NULL AND dados_select_p.ds_tabelas::text <> '') or ie_tabela_fixa_p) then

		dados_select_p.ds_tabelas :=	dados_select_p.ds_tabelas || ', ' || current_setting('pls_util_pck.enter_w')::varchar(2) ||
						ds_tabela_w;
	else
		dados_select_p.ds_tabelas :=	ds_tabela_w;
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_util_pck.sql_tabela ( ds_tabela_p text, ds_alias_p text, dados_select_p INOUT dados_select, ie_tabela_fixa_p boolean default true) FROM PUBLIC;
