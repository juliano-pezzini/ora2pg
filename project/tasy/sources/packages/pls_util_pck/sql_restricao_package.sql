-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_util_pck.sql_restricao ( ds_restricao_p text, dados_select_p INOUT dados_select, ie_restricao_fixa_p boolean default true) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Adicionar uma restrição ao comando sql que está sendo montado. Se a mesma restrição
	já existir no comando nada será feito.
	Caso não exista nenhuma restrição informada o where será adicionado.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

ie_restricao_fixa_p : indique se o comando será montado todo nesta procedure ou se algumas restrições já serão fixas

Alterações:
------------------------------------------------------------------------------------------------------------------
jjung OS 721121 - 31/03/2014 - Criação da function.
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ie_instr_w	integer;

BEGIN

ie_instr_w	:= position(lower(ds_restricao_p) in lower(dados_select_p.ds_restricao));

-- Só adiciona uma vez para a mesma restricao.
if (coalesce(ie_instr_w::text, '') = '' or ie_instr_w = 0) then

	if ((dados_select_p.ds_restricao IS NOT NULL AND dados_select_p.ds_restricao::text <> '') or ie_restricao_fixa_p) then

		dados_select_p.ds_restricao :=	dados_select_p.ds_restricao || current_setting('pls_util_pck.enter_w')::varchar(2) ||
						ds_restricao_p;
	else
		dados_select_p.ds_restricao :=	'where	' || ds_restricao_p;
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_util_pck.sql_restricao ( ds_restricao_p text, dados_select_p INOUT dados_select, ie_restricao_fixa_p boolean default true) FROM PUBLIC;
