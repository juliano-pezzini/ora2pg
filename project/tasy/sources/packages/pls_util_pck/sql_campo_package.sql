-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_util_pck.sql_campo ( ds_campo_p text, ds_alias_p text, dados_select_p INOUT dados_select, ie_campo_fixo_p boolean default true) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Adicionar um campo ao comando sql que está sendo montado. Se o mesmo campo com o mesmo alias
	já existir no comando nada será feito.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[X]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ ] Outros:
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

ie_campo_fixo_p : indique se o comando será montado todo nesta procedure ou se alguns campos já serão fixos

Alterações:
------------------------------------------------------------------------------------------------------------------
jjung OS 721121 - 31/03/2014 - Criação da function.
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ie_instr_w	integer;
ds_campo_w	varchar(1000);


BEGIN

-- Monta como ficará o campo no comando
ds_campo_w	:= pls_util_pck.sql_alias(ds_campo_p, ds_alias_p);

ie_instr_w	:= position(lower(ds_campo_w) in lower(dados_select_p.ds_campos));

-- Só adiciona uma vez para o mesmo campo com mesmo alias.
if (coalesce(ie_instr_w::text, '') = '' or ie_instr_w = 0) then

	if ((dados_select_p.ds_campos IS NOT NULL AND dados_select_p.ds_campos::text <> '') or ie_campo_fixo_p) then

		dados_select_p.ds_campos :=	dados_select_p.ds_campos || ', ' || current_setting('pls_util_pck.enter_w')::varchar(2) ||
						ds_campo_w;
	else
		dados_select_p.ds_campos :=	ds_campo_w;
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_util_pck.sql_campo ( ds_campo_p text, ds_alias_p text, dados_select_p INOUT dados_select, ie_campo_fixo_p boolean default true) FROM PUBLIC;
