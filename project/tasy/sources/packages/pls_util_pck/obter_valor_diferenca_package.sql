-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_util_pck.obter_valor_diferenca ( vl_soma_p bigint, vl_total_p bigint, ie_limita_dif_p text default 'S') RETURNS bigint AS $body$
DECLARE

-- esta função recebe dois valores e verifica se trata-se de arredondamento, ou seja, irá comparar os valores para e verificar a diferença entre eles
-- retornando S caso seja uma diferença pequena e N caso sejam iguais ou diferença de valor muito grande.
vl_diferenca_w		double precision;


BEGIN

vl_diferenca_w := 0;

-- só é necessário verificar caso os valores sejam diferentes e ambos tenham um valor
-- caso algum deles venha nulo então é retornado 0
if (vl_soma_p <> vl_total_p) then

	vl_diferenca_w := vl_total_p - vl_soma_p;
end if;

if (ie_limita_dif_p = 'S') then

	-- se o valor de diferença for menor que 0.03 para mais ou para menos trata-se apenas de arredondamento
	if (vl_diferenca_w not between -0.03 and 0.03) then

		vl_diferenca_w := 0;
	end if;
end if;

return vl_diferenca_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_util_pck.obter_valor_diferenca ( vl_soma_p bigint, vl_total_p bigint, ie_limita_dif_p text default 'S') FROM PUBLIC;
