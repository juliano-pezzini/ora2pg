-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ctb_concil_financeira_pck.ctb_gravar_documento ( cd_estabelecimento_p ctb_documento.cd_estabelecimento%type, dt_competencia_p ctb_documento.dt_competencia%type, cd_tipo_lote_contabil_p ctb_documento.cd_tipo_lote_contabil%type, nr_seq_trans_financ_p ctb_documento.nr_seq_trans_financ%type, nr_seq_info_p ctb_documento.nr_seq_info%type, nr_documento_p ctb_documento.nr_documento%type, nr_seq_doc_compl_p ctb_documento.nr_seq_doc_compl%type, nr_doc_analitico_p ctb_documento.nr_doc_analitico%type, vl_movimento_p ctb_documento.vl_movimento%type, nm_tabela_p ctb_documento.nm_tabela%type, nm_atributo_p ctb_documento.nm_atributo%type, nm_usuario_p ctb_documento.nm_usuario%type, ie_situacao_ctb_p ctb_documento.ie_situacao_ctb%type default 'P', ds_origem_p ctb_documento.ds_origem%type default null, nr_seq_proj_rec_p ctb_documento.nr_seq_proj_rec%type default null) AS $body$
DECLARE


ie_modo_lote_w          ctb_param_lote_nf.ie_ctb_online%type;
current_setting('ctb_concil_financeira_pck.ie_concil_contab_w')::pls_visible_false.ie_concil_contab%type	pls_visible_false.ie_concil_contab%type;
ds_origem_w		ctb_documento.ds_origem%type	:= ds_origem_p;

BEGIN

PERFORM set_config('ctb_concil_financeira_pck.ie_concil_contab_w', ctb_concil_financeira_pck.get_concil_contab(), false);
ie_modo_lote_w          := ctb_online_pck.get_modo_lote(cd_tipo_lote_contabil_p, cd_estabelecimento_p, null);

if (current_setting('ctb_concil_financeira_pck.ie_concil_contab_w')::pls_visible_false.ie_concil_contab%type = 'S' or ie_modo_lote_w = 'S') then
	begin
	if (ds_origem_p = '') then
		ds_origem_w	:= obter_desc_funcao(wheb_usuario_pck.get_cd_funcao);
	end if;


	insert	into	ctb_documento(	nr_sequencia,
		dt_atualizacao,
		nm_usuario,
		dt_atualizacao_nrec,
		nm_usuario_nrec,
		cd_estabelecimento,
		dt_competencia,
		cd_tipo_lote_contabil,
		nr_seq_trans_financ,
		nr_seq_info,
		nr_documento,
		nr_seq_doc_compl,
		vl_movimento,
		nm_tabela,
		nm_atributo,
		ie_status,
		ie_situacao_ctb,
		nr_lote_contabil,
		nr_doc_analitico,
		ds_origem,
		ds_stack,
        nr_seq_proj_rec)
	values (	nextval('ctb_documento_seq'),
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		cd_estabelecimento_p,
		dt_competencia_p,
		cd_tipo_lote_contabil_p,
		nr_seq_trans_financ_p,
		nr_seq_info_p,
		nr_documento_p,
		nr_seq_doc_compl_p,
		vl_movimento_p,
		nm_tabela_p,
		nm_atributo_p,
		'N',
		ie_situacao_ctb_p,
		null,
		nr_doc_analitico_p,
		ds_origem_w,
		substr('Technical information: CallStack Insert: ' || substr(dbms_utility.format_call_stack,1,3950),1,4000),
        nr_seq_proj_rec_p);
	end;
    end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ctb_concil_financeira_pck.ctb_gravar_documento ( cd_estabelecimento_p ctb_documento.cd_estabelecimento%type, dt_competencia_p ctb_documento.dt_competencia%type, cd_tipo_lote_contabil_p ctb_documento.cd_tipo_lote_contabil%type, nr_seq_trans_financ_p ctb_documento.nr_seq_trans_financ%type, nr_seq_info_p ctb_documento.nr_seq_info%type, nr_documento_p ctb_documento.nr_documento%type, nr_seq_doc_compl_p ctb_documento.nr_seq_doc_compl%type, nr_doc_analitico_p ctb_documento.nr_doc_analitico%type, vl_movimento_p ctb_documento.vl_movimento%type, nm_tabela_p ctb_documento.nm_tabela%type, nm_atributo_p ctb_documento.nm_atributo%type, nm_usuario_p ctb_documento.nm_usuario%type, ie_situacao_ctb_p ctb_documento.ie_situacao_ctb%type default 'P', ds_origem_p ctb_documento.ds_origem%type default null, nr_seq_proj_rec_p ctb_documento.nr_seq_proj_rec%type default null) FROM PUBLIC;
