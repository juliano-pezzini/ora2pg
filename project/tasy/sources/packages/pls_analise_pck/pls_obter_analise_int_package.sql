-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_analise_pck.pls_obter_analise_int ( nm_usuario_p text, nr_seq_grupo_atual_p bigint, nr_seq_analise_p bigint, ie_fluxo_com_glosa_p text, ie_somente_minha_analise_p text ) RETURNS SETOF VETOR_INT AS $body$
DECLARE
	
	 
	
  rw RECORD;

BEGIN
	 
	FOR rw IN (	 
			SELECT	ie_fluxo_com_glosa, 
				ie_fluxo_com_glosa_check, 
				ie_inserir, 
				ie_inserir_check, 
				ie_ordem, 
				ie_ordem_titulo, 
				nr_sequencia, 
				nr_seq_conta, 
				nr_seq_item, 
				ds_item_despesa, 
				cd_item, 
				ds_tipo_despesa, 
				ds_via_aces, 
				nr_seq_prestador_exec, 
				nm_prestador_exec, 
				dt_item, 
				ds_grau_part, 
				ie_origem_proced, 
				nr_seq_grau_partic, 
				tx_item, 
				qt_apresentado, 
				qt_liberado, 
				vl_unitario, 
				vl_total, 
				vl_unitario_apres, 
				vl_total_apres, 
				vl_calculado, 
				ds_guia, 
				nr_seq_conta_referencia, 
				nr_guia, 
				nr_seq_apres, 
				ie_status_item, 
				ie_situacao, 
				ie_ocorrencia_glosa, 
				nr_seq_protocolo, 
				nm_prestador_pagamento, 
				ie_status_conta, 
				ds_status_conta, 
				ds_seq_analise, 
				nr_seq_mot_liberacao, 
				cd_material, 
				cd_porte_anestesico, 
				nr_auxiliares, 
				ie_tipo_despesa, 
				nr_seq_guia, 
				ie_autorizado, 
				cd_classificacao_sip, 
				cd_classif_cred, 
				cd_classif_deb, 
				ie_tipo_item, 
				ie_carater_internacao, 
				ie_exige_nf, 
				cd_guia, 
				ie_tipo_guia, 
				nr_seq_res_conta_princ, 
				nr_seq_analise, 
				nr_seq_prestador_solic, 
				nm_prestador_solic, 
				ie_via_acesso, 
				ds_fornecedor, 
				ie_pagamento, 
				nr_identificador, 
				nr_seq_grupo_item, 
				nr_seq_prestador_pgto, 
				nr_seq_cbo_saude, 
				nr_seq_item_ref, 
				vl_uni_calculado, 
				ds_item_despesa_order, 
				nr_seq_apres_prof, 
				ds_setor_atendimento, 
				ds_unidade_medida, 
				nr_seq_partic_proc, 
				ie_tipo_glosa, 
				ds_item_importacao, 
				vl_taxa_intercambio_imp, 
				vl_taxa_intercambio, 
				tx_intercambio_imp, 
				tx_intercambio, 
				nr_seq_conta_proc, 
				nr_seq_conta_mat, 
				nm_usuario_liberacao, 
				vl_glosa, 
				ie_valor_base, 
				ds_espec_cbo, 
				ds_carater_internacao, 
				ds_exige_nf, 
				ie_auditor_item, 
				nr_autorizacao, 
				vl_calculado_hi, 
				vl_calculado_co, 
				vl_calculado_material vl_calculado_mat, 
				vl_liberado_hi, 
				vl_liberado_co, 
				vl_liberado_material vl_liberado_mat, 
				vl_glosa_co, 
				vl_glosa_material vl_glosa_mat, 
				vl_glosa_hi, 
				ie_custo_operacional 
			from	( 
				--PROCS E MATS 
				SELECT	'' ie_fluxo_com_glosa, 
					'' ie_fluxo_com_glosa_check, 
					0 ie_inserir, 
					'' ie_inserir_check, 
					nr_ordem ie_ordem, 
					1 ie_ordem_titulo, 
					nr_sequencia, 
					nr_seq_conta, 
					nr_seq_item,	 
					substr('     ' ||CASE WHEN coalesce(coalesce(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),cd_item),0)=0 THEN InitCap(pls_obter_desc_item_desp(ds_tipo_despesa, 'S'))||' não reconhecido.'  ELSE ds_item END ,1,255) ds_item_despesa, 
					cd_item, 
					ds_tipo_despesa, 
					ds_via_acesso ds_via_aces, 
					nr_seq_prestador_exec, 
					nm_prestador nm_prestador_exec, 
					trunc(dt_item)||' '||to_char(dt_inicio_item, 'hh24:mi:ss') dt_item, 
					ds_grau_participacao ds_grau_part, 
					ie_origem_proced, 
					nr_seq_grau_partic, 
					tx_item, 
					qt_apresentado, 
					qt_liberado, 
					vl_unitario, 
					vl_total, 
					vl_unitario_apres,    
					vl_total_apres, 
					vl_calculado, 
					ds_tipo_guia ds_guia, 
					nr_seq_conta_referencia, 
					coalesce(cd_guia_referencia,cd_guia) nr_guia, 
					1 nr_seq_apres, 
					ie_status ie_status_item, 
					ie_situacao, 
					ie_ocorrencia_glosa, 
					nr_seq_protocolo, 
					nm_prestador_pagamento, 
					ie_status_conta, 
					ds_status_conta, 
					nr_seq_analise ds_seq_analise, 
					nr_seq_mot_liberacao, 
					substr(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),1,20) cd_material, 
					cd_porte_anestesico, 
					nr_auxiliares, 
					ie_tipo_despesa, 
					nr_seq_guia, 
					ie_autorizado, 
					cd_classificacao_sip, 
					cd_classif_cred, 
					cd_classif_deb, 
					ie_tipo_item, 
					ie_carater_internacao, 
					ie_exige_nf, 
					cd_guia, 
					ie_tipo_guia, 
					nr_seq_res_conta_princ, 
					nr_seq_analise, 
					nr_seq_prestador_solic, 
					nm_prestador_solic, 
					ie_via_acesso, 
					ds_fornecedor, 
					ie_pagamento, 
					nr_identificador, 
					nr_seq_grupo_item, 
					nr_seq_prestador_pgto, 
					nr_seq_cbo_saude, 
					nr_seq_item_ref, 
					dividir_sem_round(vl_calculado, qt_apresentado) vl_uni_calculado, 
					ds_item ds_item_despesa_order, 
					nr_seq_apres_prof, 
					ds_setor_atendimento, 
					CASE WHEN ie_tipo_item='M' THEN  substr(pls_obter_dados_material(cd_item,'UM'),1,255)  ELSE null END  ds_unidade_medida, 
					null nr_seq_partic_proc, 
					pls_obter_ie_valor_glosa(nr_seq_item, ie_tipo_item) ie_tipo_glosa, 
					ds_item_importacao, 
					vl_taxa_intercambio_imp vl_taxa_intercambio_imp, 
					vl_taxa_intercambio vl_taxa_intercambio, 
					tx_intercambio_imp tx_intercambio_imp, 
					tx_intercambio tx_intercambio, 
					nr_seq_conta_proc, 
					nr_seq_conta_mat, 
					nm_usuario_liberacao, 
					vl_glosa, 
					ie_valor_base, 
					pls_obter_especialidade_ptu(nr_seq_item,ie_tipo_item) ds_espec_cbo, 
					obter_valor_dominio(2819,ie_carater_internacao) ds_carater_internacao, 
					CASE WHEN ie_exige_nf='S' THEN 'Entregue' WHEN ie_exige_nf='N' THEN 'Não entregue' WHEN ie_exige_nf='E' THEN  'Exige'  ELSE '' END  ds_exige_nf, 
					pls_obter_item_acao_auditor(nr_sequencia, nm_usuario_p, nr_seq_grupo_atual_p, nr_seq_analise) ie_auditor_item, 
					substr(pls_obter_nr_autoriz_ptu(nr_seq_item, ie_tipo_item),1,25) nr_autorizacao, 
					vl_calculado_hi, 
					vl_calculado_co, 
					vl_calculado_material, 
					vl_liberado_hi, 
					vl_liberado_co, 
					vl_liberado_material, 
					vl_glosa_co, 
					vl_glosa_material, 
					vl_glosa_hi, 
					ie_custo_operacional 
				from	w_pls_resumo_conta a 
				where	ie_tipo_item <> 'R' 
				and	nr_seq_analise = nr_seq_analise_p 
				and	((coalesce(ie_fluxo_com_glosa_p,'N') = 'N') or (coalesce(ie_fluxo_com_glosa,'N') = 'P')) 
				and	((coalesce(ie_somente_minha_analise_p,'N') = 'N') or (exists (  	select	x.nr_sequencia 
													from  pls_analise_grupo_item x, 
														pls_analise_conta_item y 
													where  x.nr_seq_item_analise  = y.nr_sequencia  
													and   x.nr_seq_grupo     = nr_seq_grupo_atual_P 
													and   ((y.nr_seq_conta_proc  = a.nr_seq_conta_proc) or (y.nr_seq_conta_mat  = a.nr_seq_conta_mat))	 LIMIT 1))) 
				
union
 
				--Titulo 
				select	'' ie_fluxo_com_glosa, 
					'' ie_fluxo_com_glosa_check, 
					0 ie_inserir, 
					'' ie_inserir_check,	 
					z.nr_ordem ie_ordem, 
					0 ie_ordem_titulo, 
					null nr_sequencia, 
					null nr_seq_conta, 
					null nr_seq_item, 
					substr(pls_obter_desc_item_desp_int(z.nr_ordem, 'P'),1,255) ds_item_despesa, 
					null cd_item, 
					null ds_tipo_despesa, 
					null ds_via_aces, 
					null nr_seq_prestador_exec, 
					null nm_prestador_exec, 
					null dt_item,	 
					null ds_grau_part, 
					null ie_origem_proced, 
					null nr_seq_grau_partic, 
					null tx_item, 
					null qt_apresentado, 
					null qt_liberado, 
					null vl_unitario, 
					null vl_total, 
					null vl_unitario_apres,    
					null vl_total_apres,  
					null vl_calculado, 
					null ds_guia, 
					null nr_seq_conta_referencia, 
					coalesce(z.cd_guia_referencia,z.cd_guia) nr_guia, 
					0 nr_seq_apres, 
					null ie_status_item, 
					null ie_situacao, 
					null ie_ocorrencia_glosa, 
					null nr_seq_protocolo, 
					null nm_prestador_pagamento, 
					null ie_status_conta, 
					null ds_status_conta, 
					null ds_seq_analise, 
					null nr_seq_mot_liberacao, 
					null cd_material, 
					null cd_porte_anestesico, 
					null nr_auxiliares, 
					null ie_tipo_despesa, 
					null nr_seq_guia, 
					null ie_autorizado, 
					null cd_classificacao_sip, 
					null cd_classif_cred, 
					null cd_classif_deb, 
					null ie_tipo_item, 
					null ie_carater_internacao, 
					null ie_exige_nf, 
					null cd_guia, 
					null ie_tipo_guia, 
					null nr_seq_res_conta_princ, 
					z.nr_seq_analise nr_seq_analise, 
					null nr_seq_prestador_solic, 
					null nm_prestador_solic, 
					null ie_via_acesso, 
					null ds_fornecedor, 
					null ie_pagamento, 
					null nr_identificador, 
					null nr_seq_grupo_item, 
					null nr_seq_prestador_pgto, 
					null nr_seq_cbo_saude, 
					null nr_seq_item_ref, 
					null vl_uni_calculado, 
					null ds_item_despesa_order, 
					null nr_seq_apres_prof, 
					null ds_setor_atendimento, 
					'' ds_unidade_medida, 
					null nr_seq_partic_proc, 
					null ie_tipo_glosa, 
					null ds_item_importacao, 
					null vl_taxa_intercambio_imp, 
					null vl_taxa_intercambio, 
					null tx_intercambio_imp, 
					null tx_intercambio, 
					null nr_seq_conta_proc, 
					null nr_seq_conta_mat, 
					null nm_usuario_liberacao, 
					null vl_glosa, 
					null ie_valor_base, 
					null ds_espec_cbo, 
					null ds_carater_internacao, 
					null ds_exige_nf, 
					null ie_auditor_item, 
					null nr_autorizacao, 
					null vl_calculado_hi, 
					null vl_calculado_co, 
					null vl_calculado_mat, 
					null vl_liberado_hi, 
					null vl_liberado_co, 
					null vl_liberado_mat, 
					null vl_glosa_co, 
					null vl_glosa_mat, 
					null vl_glosa_hi, 
					null ie_custo_operacional 
				from	w_pls_resumo_conta z 
				where	z.nr_seq_analise = nr_seq_analise_p				 
				and	exists	(	Select	x.nr_sequencia 
							from	w_pls_resumo_conta x 
							where	x.nr_seq_analise = z.nr_seq_analise 
							and	z.ie_tipo_despesa = x.ie_tipo_despesa							 
							and	((coalesce(ie_fluxo_com_glosa_p,'N') = 'N') or (coalesce(x.ie_fluxo_com_glosa,'N') = 'P'))							 
							and	((coalesce(ie_somente_minha_analise_p,'N') = 'N') or (exists ( select	x.nr_sequencia 
															  from  	pls_analise_grupo_item x, 
																	pls_analise_conta_item y 
															  where  	x.nr_seq_item_analise  = y.nr_sequencia																										 
															  and   	((y.nr_seq_conta_proc	= x.nr_seq_conta_proc) or (y.nr_seq_conta_mat	= x.nr_seq_conta_mat) or (y.nr_seq_proc_partic	= x.nr_seq_partic_proc)) 
															  and   	x.nr_seq_grupo     = nr_seq_grupo_atual_p 	 LIMIT 1)))		) 
				group by ds_tipo_despesa, ie_tipo_despesa, nr_ordem, coalesce(cd_guia_referencia,cd_guia), nr_seq_analise 
				
union
 
				--LINHA INFORMATIVA - PARTICIPANTE QUANDO NÃO HÁ PROC 
				select	'' ie_fluxo_com_glosa, 
					'' ie_fluxo_com_glosa_check, 
					0 ie_inserir, 
					'' ie_inserir_check, 
					nr_ordem ie_ordem, 
					1 ie_ordem_titulo, 
					null, 
					null, 
					null,	 
					substr('     ' ||CASE WHEN coalesce(coalesce(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),cd_item),0)=0 THEN InitCap(pls_obter_desc_item_desp(ds_tipo_despesa, 'S'))||' não reconhecido.'  ELSE ds_item END ,1,255) ds_item_despesa, 
					cd_item, 
					null, 
					null, 
					null, 
					null, 
					trunc(dt_item)||' '||to_char(dt_inicio_item, 'hh24:mi:ss') dt_item, 
					null, 
					ie_origem_proced, 
					null, 
					null, 
					null qt_apresentado, 
					null qt_liberado, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'UL') vl_unitario, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'TL') vl_total, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'UA') vl_unitario_apres,    
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'TA') vl_total_apres, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'TC') vl_calculado, 
					null, 
					null, 
					null, 
					1 nr_seq_apres, 
					CASE WHEN ie_status='C' THEN  'C'  ELSE 'I' END  ie_status_item, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					nr_seq_analise, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					nr_seq_analise, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					nr_seq_item_ref, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'UC') vl_uni_calculado, 
					ds_item ds_item_despesa_order, 
					null, 
					null, 
					null, 
					null, 
					null, 
					null, 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'XI'), 
					pls_obter_vl_item_ptu(nr_seq_item_ref, nr_seq_analise, 'VX'), 
					null, 
					null, 
					null, 
					null, 
					null nm_usuario_liberacao, 
					null vl_glosa, 
					null ie_valor_base, 
					null ds_espec_cbo, 
					null ds_carater_internacao, 
					null ds_exige_nf, 
					null ie_auditor_item, 
					null nr_autorizacao,				 
					(	select	coalesce(sum(x.vl_calculado_hi),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_calculado_hi, 
					(	select	coalesce(sum(x.vl_calculado_co),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_calculado_co, 
					(	select	coalesce(sum(x.vl_calculado_material),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_calculado_material, 
					(	select	coalesce(sum(x.vl_liberado_hi),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_liberado_hi, 
					(	select	coalesce(sum(x.vl_liberado_co),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_liberado_co, 
					(	select	coalesce(sum(x.vl_glosa_co),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_glosa_co, 
					(	select	coalesce(sum(x.vl_liberado_material),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_liberado_material, 
					(	select	coalesce(sum(x.vl_glosa_material),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_glosa_material, 
					(	select	coalesce(sum(x.vl_glosa_hi),0) 
						from	w_pls_resumo_conta x 
						where	x.nr_seq_item_ref = a.nr_seq_item_ref 
						and	x.nr_seq_analise = a.nr_seq_analise	 
						and	x.ie_tipo_item	 = 'R') vl_glosa_hi, 
					null ie_custo_operacional 
				from	w_pls_resumo_conta a 
				where	ie_tipo_item = 'R'				 
				and	nr_seq_analise = nr_seq_analise_p 
				and	exists	(	Select	x.nr_sequencia 
							from	w_pls_resumo_conta x 
							where	x.nr_seq_analise = a.nr_seq_analise 
							and	x.nr_seq_item_ref = a.nr_seq_item_ref 
							and	((coalesce(ie_fluxo_com_glosa_p,'N') = 'N') or (coalesce(x.ie_fluxo_com_glosa,'N') = 'P'))							 
							and	((coalesce(ie_somente_minha_analise_p,'N') = 'N') or (exists ( select	x.nr_sequencia 
															 from  	pls_analise_grupo_item x, 
																	pls_analise_conta_item y 
															 where  	x.nr_seq_item_analise  = y.nr_sequencia																										 
															 and   	y.nr_seq_conta_proc	= a.nr_seq_conta_proc 
															 and   	x.nr_seq_grupo     = nr_seq_grupo_atual_p 	 LIMIT 1)))) 
				group by nr_ordem, 
					 ds_tipo_despesa, 
					 cd_item,	 
					 dt_item, 
					 dt_inicio_item, 
					 ie_origem_proced, 
					 nr_seq_analise, 
					 ie_tipo_despesa, 
					 nr_seq_analise, 
					 nr_seq_item_ref, 
					 ds_item, 
					 ie_status 
				
union
 
				--PARTICIPANTE 
				select	'' ie_fluxo_com_glosa, 
					'' ie_fluxo_com_glosa_check, 
					0 ie_inserir, 
					'' ie_inserir_check, 
					nr_ordem ie_ordem, 
					1 ie_ordem_titulo, 
					nr_sequencia, 
					nr_seq_conta, 
					nr_seq_item,	 
					substr('         ' ||nm_participante,1,255) ds_item_despesa, 
					cd_item, 
					ds_tipo_despesa, 
					ds_via_acesso ds_via_aces, 
					nr_seq_prestador_exec, 
					nm_prestador nm_prestador_exec, 
					trunc(dt_item)||' '||to_char(dt_inicio_item, 'hh24:mi:ss') dt_item,	 
					ds_grau_participacao ds_grau_part, 
					ie_origem_proced, 
					nr_seq_grau_partic, 
					tx_item, 
					qt_apresentado, 
					qt_liberado, 
					vl_unitario, 
					vl_total, 
					vl_unitario_apres, 
					vl_total_apres, 
					vl_calculado, 
					ds_tipo_guia ds_guia, 
					nr_seq_conta_referencia, 
					coalesce(cd_guia_referencia,cd_guia) nr_guia, 
					2 nr_seq_apres, 
					ie_status ie_status_item, 
					ie_situacao, 
					ie_ocorrencia_glosa, 
					nr_seq_protocolo, 
					nm_prestador_pagamento, 
					ie_status_conta, 
					ds_status_conta, 
					nr_seq_analise ds_seq_analise, 
					nr_seq_mot_liberacao, 
					substr(pls_obter_cod_mat_analise(cd_item, ds_tipo_despesa),1,20) cd_material, 
					cd_porte_anestesico, 
					nr_auxiliares, 
					ie_tipo_despesa, 
					nr_seq_guia, 
					ie_autorizado, 
					cd_classificacao_sip, 
					cd_classif_cred, 
					cd_classif_deb, 
					ie_tipo_item, 
					ie_carater_internacao, 
					ie_exige_nf, 
					cd_guia, 
					ie_tipo_guia, 
					nr_seq_res_conta_princ, 
					nr_seq_analise, 
					nr_seq_prestador_solic, 
					nm_prestador_solic, 
					ie_via_acesso, 
					ds_fornecedor, 
					ie_pagamento, 
					nr_identificador, 
					nr_seq_grupo_item, 
					nr_seq_prestador_pgto, 
					nr_seq_cbo_saude, 
					nr_seq_item_ref, 
					dividir_sem_round(vl_calculado, qt_apresentado) vl_uni_calculado, 
					ds_item ds_item_despesa_order, 
					nr_seq_apres_prof, 
					ds_setor_atendimento, 
					null ds_unidade_medida, 
					nr_seq_partic_proc, 
					pls_obter_ie_valor_glosa(nr_seq_item, ie_tipo_item) ie_tipo_glosa, 
					ds_item_importacao, 
					vl_taxa_intercambio_imp vl_taxa_intercambio_imp, 
					vl_taxa_intercambio vl_taxa_intercambio, 
					tx_intercambio_imp tx_intercambio_imp, 
					tx_intercambio tx_intercambio, 
					nr_seq_conta_proc, 
					nr_seq_conta_mat, 
					nm_usuario_liberacao, 
					vl_glosa, 
					ie_valor_base, 
					pls_obter_especialidade_ptu(nr_seq_item,ie_tipo_item) ds_espec_cbo, 
					obter_valor_dominio(2819,ie_carater_internacao) ds_carater_internacao, 
					CASE WHEN ie_exige_nf='S' THEN 'Entregue' WHEN ie_exige_nf='N' THEN 'Não entregue' WHEN ie_exige_nf='E' THEN  'Exige'  ELSE '' END  ds_exige_nf, 
					pls_obter_item_acao_auditor(nr_sequencia, nm_usuario_p, nr_seq_grupo_atual_p, nr_seq_analise) ie_auditor_item, 
					substr(pls_obter_nr_autoriz_ptu(nr_seq_item, ie_tipo_item),1,25) nr_autorizacao, 
					vl_calculado_hi, 
					vl_calculado_co, 
					vl_calculado_material, 
					vl_liberado_hi, 
					vl_liberado_co, 
					vl_liberado_material, 
					vl_glosa_co, 
					vl_glosa_material, 
					vl_glosa_hi, 
					ie_custo_operacional 
				from	w_pls_resumo_conta a 
				where	ie_tipo_item = 'R' 
				and	nr_seq_analise = nr_seq_analise_p 
				and	((coalesce(ie_fluxo_com_glosa_p,'N') = 'N') or (coalesce(ie_fluxo_com_glosa,'N') = 'P')) 
				and	((coalesce(ie_somente_minha_analise_p,'N') = 'N') or (exists (  	select	x.nr_sequencia 
													from  pls_analise_grupo_item x, 
														pls_analise_conta_item y 
													where  x.nr_seq_item_analise  = y.nr_sequencia																										 
													and   y.nr_seq_conta_proc	= a.nr_seq_conta_proc 
													and   x.nr_seq_grupo     = nr_seq_grupo_atual_p 	 LIMIT 1))) 
			) alias129 
         ) loop 
	 RETURN NEXT rw;
	 end loop;
 
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_analise_pck.pls_obter_analise_int ( nm_usuario_p text, nr_seq_grupo_atual_p bigint, nr_seq_analise_p bigint, ie_fluxo_com_glosa_p text, ie_somente_minha_analise_p text ) FROM PUBLIC;
