-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION surgery_schedule_pck.get_dados (nr_seq_agenda_p bigint) RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE


t_objeto_row_w						t_objeto_row;
cd_anestesista_w					pessoa_fisica.cd_pessoa_fisica%type;
cd_medico_w							pessoa_fisica.cd_pessoa_fisica%type;
cd_pessoa_chamada_setor_w 		pessoa_fisica.cd_pessoa_fisica%type;



BEGIN
if (coalesce(nr_seq_agenda_p,0) > 0) then
	select	max(a.cd_anestesista),
				max(a.cd_medico),
				max(a.cd_pessoa_chamada_setor)
	into STRICT		cd_anestesista_w,
				cd_medico_w,
				cd_pessoa_chamada_setor_w
	from		agenda_paciente a
	where		a.nr_sequencia = nr_seq_agenda_p;			

	if (cd_anestesista_w IS NOT NULL AND cd_anestesista_w::text <> '') then
		t_objeto_row_w.cd_anestesista				:=	cd_anestesista_w;
		t_objeto_row_w.nm_medico_anestesista	:=	obter_nome_medico(cd_anestesista_w,'G');
		t_objeto_row_w.nm_apelido_anestesista	:= obter_apelido_agenda(nr_seq_agenda_p,cd_anestesista_w);
	end if;	

	if (cd_pessoa_chamada_setor_w IS NOT NULL AND cd_pessoa_chamada_setor_w::text <> '') then
		t_objeto_row_w.cd_pessoa_chamada_setor	:= cd_pessoa_chamada_setor_w;
		t_objeto_row_w.nm_contato					:= obter_nome_pf(cd_pessoa_chamada_setor_w);
	end if;	

	if (cd_medico_w IS NOT NULL AND cd_medico_w::text <> '') then
		t_objeto_row_w.cd_medico 	:=	cd_medico_w;
		t_objeto_row_w.nm_medico 	:=	obter_nome_medico(cd_medico_w,'G');
	end if;	
	RETURN NEXT t_objeto_row_w;
end if;	
RETURN;		
END;	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION surgery_schedule_pck.get_dados (nr_seq_agenda_p bigint) FROM PUBLIC;
