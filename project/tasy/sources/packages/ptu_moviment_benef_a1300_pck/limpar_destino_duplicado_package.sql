-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ptu_moviment_benef_a1300_pck.limpar_destino_duplicado ( nr_seq_lote_p ptu_mov_benef_lote.nr_sequencia%type) AS $body$
DECLARE

	
	nr_seq_mov_destino_w	ptu_mov_benef_lote.nr_sequencia%type;
	
	C01 CURSOR(	nr_seq_lote_pc		bigint) FOR
		SELECT	cd_unimed_destino
		from	ptu_mov_benef_destino
		where	nr_seq_lote = nr_seq_lote_pc
		group by
			cd_unimed_destino;
	
	
BEGIN
	
	for r_c01_w in c01(nr_seq_lote_p) loop
		begin
		select	min(nr_sequencia)
		into STRICT	nr_seq_mov_destino_w
		from	ptu_mov_benef_destino
		where	nr_seq_lote = nr_seq_lote_p
		and	cd_unimed_destino = r_c01_w.cd_unimed_destino;
		
		delete from ptu_mov_benef_destino
		where	nr_seq_lote = nr_seq_lote_p
		and	cd_unimed_destino = r_c01_w.cd_unimed_destino
		and	nr_sequencia <> nr_seq_mov_destino_w;
		
		update	ptu_mov_benef_destino
		set	dt_geracao_arquivo	 = NULL
		where	nr_sequencia		= nr_seq_mov_destino_w;
		end;
	end loop;

	commit;
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_moviment_benef_a1300_pck.limpar_destino_duplicado ( nr_seq_lote_p ptu_mov_benef_lote.nr_sequencia%type) FROM PUBLIC;
