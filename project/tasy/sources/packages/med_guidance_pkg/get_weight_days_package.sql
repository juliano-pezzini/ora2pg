-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.get_weight_days (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

			
    qt_peso_w varchar(255) := '0';
    qt_dias_w varchar(255) := '0';

BEGIN	
		
	BEGIN
		SELECT qt_peso, qt_dias
		INTO STRICT   qt_peso_w,
                       qt_dias_w 			
		FROM (SELECT (qt_peso * 1000) qt_peso, TRUNC(clock_timestamp() - dt_delta_peso) qt_dias
		 FROM atendimento_sinal_vital
		 WHERE cd_pessoa_fisica = cd_pessoa_fisica_p
		 AND (dt_delta_peso IS NOT NULL AND dt_delta_peso::text <> '' AND qt_peso IS NOT NULL AND qt_peso::text <> '') 
		 ORDER BY dt_delta_peso DESC) alias4 LIMIT 1;
	    EXCEPTION
		WHEN OTHERS THEN 
			qt_peso_w := '0';
			qt_dias_w := '0';
		END;
			
	IF (ie_opcao_p = 'PESO') THEN
		RETURN qt_peso_w;
	END IF;
			
	IF (ie_opcao_p = 'DIAS') THEN
		RETURN qt_dias_w;	
	END IF;
		
    END;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.get_weight_days (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, ie_opcao_p text) FROM PUBLIC;
