-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.compare_examination_rule (nr_seq_med_guid_fee_p text, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type) RETURNS boolean AS $body$
DECLARE
	
	
    cursor_rule CURSOR FOR
    SELECT	cd_procedimento,
		si_condition_period,
		qt_exam_period,
		si_check_exam,
		si_period
    FROM   med_guid_fee_exam
    WHERE  nr_seq_med_guid_fee = nr_seq_med_guid_fee_p
    AND    clock_timestamp() BETWEEN dt_start AND dt_end;
	
    qt_days_rule_w double precision := 0;
    qt_days_pacient_w double precision := 0;
    ie_retorno_w boolean := false;

    
BEGIN

	FOR r_cursor_rule IN cursor_rule LOOP
			
		ie_retorno_w := false;
			
		qt_days_pacient_w := MED_GUIDANCE_PKG.GET_DAYS_EXAM_BY_STATUS(r_cursor_rule.cd_procedimento, cd_pessoa_fisica_p, r_cursor_rule.si_check_exam);
				
		IF NOT(qt_days_pacient_w > 0) THEN
				EXIT;
		END IF;
				
		IF (r_cursor_rule.qt_exam_period > 0) THEN

			qt_days_rule_w := MED_GUIDANCE_PKG.CONVERT_PERIOD_DAYS_RULES(r_cursor_rule.si_period, r_cursor_rule.qt_exam_period);
					
			IF NOT(MED_GUIDANCE_PKG.COMPARE_RULE(qt_days_rule_w, r_cursor_rule.si_condition_period, qt_days_pacient_w)) THEN
				EXIT;
			END IF;
				
		END IF;
				
		ie_retorno_w := true;
			
	END LOOP;

     RETURN ie_retorno_w;
		
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.compare_examination_rule (nr_seq_med_guid_fee_p text, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type) FROM PUBLIC;
