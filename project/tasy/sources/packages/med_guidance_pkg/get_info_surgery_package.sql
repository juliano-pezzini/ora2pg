-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.get_info_surgery (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, cd_procedimento_p text, ds_retorno_p text) RETURNS varchar AS $body$
DECLARE

	
    nr_cirurgia_w varchar(255);
    cd_procedimento_princ_w varchar(255);
    qt_dias_w varchar(255);
    qt_dias_real_w varchar(255);

BEGIN  
	    
	SELECT  nr_cirurgia,
	        cd_procedimento_princ,
		ROUND(dt_termino - dt_inicio_prevista) qt_dias,
		ROUND(dt_termino - dt_inicio_real) qt_dias_real
	INTO STRICT    nr_cirurgia_w,
	        cd_procedimento_princ_w,
		qt_dias_w,
		qt_dias_real_w
	FROM    cirurgia
	WHERE   cd_pessoa_fisica = cd_pessoa_fisica_p
	AND     cd_procedimento_princ = cd_procedimento_p;
	
	IF (ds_retorno_p = 'PP') THEN
		RETURN(cd_procedimento_princ_w);
	END IF;
	
	IF (ds_retorno_p = 'QTD') THEN
		RETURN(qt_dias_w);
	END IF;
			
	IF (ds_retorno_p = 'QTDR') THEN
		RETURN(qt_dias_real_w);
	END IF;

    END;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.get_info_surgery (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, cd_procedimento_p text, ds_retorno_p text) FROM PUBLIC;
