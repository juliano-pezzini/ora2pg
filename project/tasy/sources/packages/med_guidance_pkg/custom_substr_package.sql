-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.custom_substr ( ds_value_p text, ds_column_p text, ds_table_p text ) RETURNS varchar AS $body$
DECLARE


    vl_length_w         integer;
    vl_column_len_w     integer;
    ds_retorno_w        varchar(4000);


BEGIN
        BEGIN
            vl_length_w := LENGTH(ds_value_p);

            SELECT  coalesce(CHAR_LENGTH, coalesce(CHAR_COL_DECL_LENGTH, 0))
            INTO STRICT    vl_column_len_w
            FROM    ALL_TAB_COLS
            WHERE   COLUMN_NAME = ds_column_p
            AND     TABLE_NAME = ds_table_p;

            IF vl_length_w <= vl_column_len_w THEN
                ds_retorno_w := ds_value_p;
            ELSE
                ds_retorno_w := SUBSTR(ds_value_p, 0, vl_column_len_w - 3) || '...';
            END IF;
        EXCEPTION WHEN OTHERS THEN
            ds_retorno_w := null;
        END;

        RETURN ds_retorno_w;
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.custom_substr ( ds_value_p text, ds_column_p text, ds_table_p text ) FROM PUBLIC;
