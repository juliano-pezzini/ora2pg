-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.get_procedures_by_status (cd_procedimento_p PROC_INTERNO.CD_PROCEDIMENTO%type, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, si_check_procedure_p text) RETURNS boolean AS $body$
DECLARE

    qt_registros_w double precision := 0;

BEGIN	
		
	IF (si_check_procedure_p = '0') THEN
		SELECT COUNT(*)
		INTO STRICT   qt_registros_w
		FROM   cpoe_procedimento a
		INNER JOIN proc_interno b ON a.nr_seq_proc_interno = b.nr_sequencia
		WHERE  a.cd_pessoa_fisica = cd_pessoa_fisica_p
		AND    b.cd_procedimento = cd_procedimento_p;
	END IF;
		
	IF (si_check_procedure_p = '1') THEN
		SELECT COUNT(*)
		INTO STRICT   qt_registros_w
		FROM   procedimento_paciente
		WHERE  cd_pessoa_fisica = cd_pessoa_fisica_p
		AND    cd_procedimento = cd_procedimento_p;
	END IF;

	IF (si_check_procedure_p = '2') THEN
		SELECT SUM(qt_registros)
		INTO STRICT   qt_registros_w
		FROM (SELECT COUNT(*) qt_registros
		 FROM   cpoe_procedimento a
		 INNER JOIN proc_interno b ON a.nr_seq_proc_interno = b.nr_sequencia
		 WHERE  a.cd_pessoa_fisica = cd_pessoa_fisica_p
		 AND    b.cd_procedimento = cd_procedimento_p
		
UNION ALL

		 SELECT COUNT(*) qt_registros
		 FROM   procedimento_paciente
		 WHERE  cd_pessoa_fisica = cd_pessoa_fisica_p
		 AND    cd_procedimento = cd_procedimento_p) alias4;
	END IF;
		
     RETURN(qt_registros_w > 0);

    END;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.get_procedures_by_status (cd_procedimento_p PROC_INTERNO.CD_PROCEDIMENTO%type, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, si_check_procedure_p text) FROM PUBLIC;
