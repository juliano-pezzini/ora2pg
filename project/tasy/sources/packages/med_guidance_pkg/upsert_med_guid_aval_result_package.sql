-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE med_guidance_pkg.upsert_med_guid_aval_result ( nr_seq_med_guid_p MED_GUIDANCE_AVAL_RESULT.NR_SEQ_MED_GUID%type, nr_seq_item_p MED_GUIDANCE_AVAL_RESULT.NR_SEQ_ITEM%type, qt_resultado_p MED_GUIDANCE_AVAL_RESULT.QT_RESULTADO%type, ds_result_long_p MED_GUIDANCE_AVAL_RESULT.DS_RESULT_LONG%type, ds_resultado_p MED_GUIDANCE_AVAL_RESULT.DS_RESULTADO%type, nm_usuario_p MED_GUIDANCE_AVAL_RESULT.NM_USUARIO%type, ie_prepare_p text ) AS $body$
DECLARE


    dt_sysdate_s    timestamp := clock_timestamp();
    qt_records_w    integer;


BEGIN

        if ie_prepare_p = 'S' then
            DELETE  FROM MED_GUIDANCE_AVAL_RESULT
            WHERE   NR_SEQ_MED_GUID = nr_seq_med_guid_p;

            COMMIT;
        end if;

        INSERT INTO MED_GUIDANCE_AVAL_RESULT(
            NR_SEQ_MED_GUID,
            NR_SEQ_ITEM,
            QT_RESULTADO,
            DS_RESULT_LONG,
            DS_RESULTADO,
            DT_ATUALIZACAO,
            DT_ATUALIZACAO_NREC,
            NM_USUARIO,
            NM_USUARIO_NREC
        ) VALUES (
            nr_seq_med_guid_p,
            nr_seq_item_p,
            qt_resultado_p,
            ds_result_long_p,
            ds_resultado_p,
            dt_sysdate_s,
            dt_sysdate_s,
            nm_usuario_p,
            nm_usuario_p
        );

        COMMIT;
    EXCEPTION WHEN OTHERS THEN
        ROLLBACK;
        CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(799570, 'DS_ERRO_W=UPSERT_MED_GUID_AVAL_RESULT'|| chr(10) ||SQLERRM);
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_guidance_pkg.upsert_med_guid_aval_result ( nr_seq_med_guid_p MED_GUIDANCE_AVAL_RESULT.NR_SEQ_MED_GUID%type, nr_seq_item_p MED_GUIDANCE_AVAL_RESULT.NR_SEQ_ITEM%type, qt_resultado_p MED_GUIDANCE_AVAL_RESULT.QT_RESULTADO%type, ds_result_long_p MED_GUIDANCE_AVAL_RESULT.DS_RESULT_LONG%type, ds_resultado_p MED_GUIDANCE_AVAL_RESULT.DS_RESULTADO%type, nm_usuario_p MED_GUIDANCE_AVAL_RESULT.NM_USUARIO%type, ie_prepare_p text ) FROM PUBLIC;
