-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE med_guidance_pkg.upsert_medical_guid_order_rule ( cd_medical_practice_code_p MEDICAL_GUID_ORDER_RULE.CD_MEDICAL_PRACTICE_CODE%type, cd_estabelecimento_p MEDICAL_GUID_ORDER_RULE.CD_ESTABELECIMENTO%type, dt_start_p MEDICAL_GUID_ORDER_RULE.DT_START%type, dt_end_p MEDICAL_GUID_ORDER_RULE.DT_END%type, qt_current_score_p MEDICAL_GUID_ORDER_RULE.QT_CURRENT_SCORE%type, nm_usuario_p MEDICAL_GUID_ORDER_RULE.NM_USUARIO%type, qt_records_p bigint ) AS $body$
DECLARE


    dt_sysdate_s    timestamp := clock_timestamp();


BEGIN
        IF qt_records_p = 0 THEN
            BEGIN
                INSERT INTO MEDICAL_GUID_ORDER_RULE(
                    NR_SEQUENCIA,
                    CD_MEDICAL_PRACTICE_CODE,
                    CD_ESTABELECIMENTO,
                    NM_USUARIO_NREC,
                    NM_USUARIO,
                    DT_ATUALIZACAO,
                    DT_ATUALIZACAO_NREC,
                    DT_START,
                    DT_END,
                    QT_CURRENT_SCORE
                ) VALUES (
                    nextval('medical_guid_order_rule_seq'),
                    cd_medical_practice_code_p,
                    cd_estabelecimento_p,
                    nm_usuario_p,
                    nm_usuario_p,
                    dt_sysdate_s,
                    dt_sysdate_s,
                    dt_start_p,
                    dt_end_p,
                    qt_current_score_p
                );
            EXCEPTION WHEN OTHERS THEN
                ROLLBACK;
                CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(799570, 'DS_ERRO_W=MEDICAL_GUID_ORDER_RULE'|| chr(10) ||SQLERRM);
            END;
        ELSE
            BEGIN
                UPDATE  MEDICAL_GUID_ORDER_RULE
                SET     CD_ESTABELECIMENTO = cd_estabelecimento_p,
                        NM_USUARIO_NREC = nm_usuario_p,
                        NM_USUARIO = nm_usuario_p,
                        DT_ATUALIZACAO = dt_sysdate_s,
                        DT_ATUALIZACAO_NREC = dt_sysdate_s,
                        DT_START = dt_start_p,
                        DT_END = dt_end_p,
                        QT_CURRENT_SCORE = qt_current_score_p
                WHERE   CD_MEDICAL_PRACTICE_CODE = cd_medical_practice_code_p;
            EXCEPTION WHEN OTHERS THEN
                ROLLBACK;
                CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(799647, 'DS_ERRO_W=MEDICAL_GUID_ORDER_RULE'|| chr(10) ||SQLERRM);
            END;
        END IF;

        COMMIT;
    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE med_guidance_pkg.upsert_medical_guid_order_rule ( cd_medical_practice_code_p MEDICAL_GUID_ORDER_RULE.CD_MEDICAL_PRACTICE_CODE%type, cd_estabelecimento_p MEDICAL_GUID_ORDER_RULE.CD_ESTABELECIMENTO%type, dt_start_p MEDICAL_GUID_ORDER_RULE.DT_START%type, dt_end_p MEDICAL_GUID_ORDER_RULE.DT_END%type, qt_current_score_p MEDICAL_GUID_ORDER_RULE.QT_CURRENT_SCORE%type, nm_usuario_p MEDICAL_GUID_ORDER_RULE.NM_USUARIO%type, qt_records_p bigint ) FROM PUBLIC;
