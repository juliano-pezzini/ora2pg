-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.get_info_disease (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, cd_doenca_p text, ds_retorno_p text) RETURNS varchar AS $body$
DECLARE

	
    cd_doenca_w varchar(255);
    ie_diag_princ_depart_w varchar(255);
    ie_unidade_tempo_w varchar(255);
    qt_tempo_w varchar(255);

BEGIN  
	    
	SELECT	a.cd_doenca,
		a.ie_diag_princ_depart,
		a.ie_unidade_tempo,
		a.qt_tempo
	INTO STRICT 	cd_doenca_w,
		ie_diag_princ_depart_w,
		ie_unidade_tempo_w,
		qt_tempo_w
	FROM    diagnostico_doenca a
	INNER JOIN atendimento_paciente_v b ON b.nr_atendimento = a.nr_atendimento
	WHERE  b.cd_pessoa_fisica = cd_pessoa_fisica_p
	AND    a.cd_doenca = cd_doenca_p;

	IF (ds_retorno_p = 'CD') THEN
		RETURN(cd_doenca_w);
	END IF;
		
	IF (ds_retorno_p = 'DP') THEN
		RETURN(ie_diag_princ_depart_w);
	END IF;
		
	IF (ds_retorno_p = 'TMP') THEN
		RETURN(ie_unidade_tempo_w);
	END IF;
		
	IF (ds_retorno_p = 'QTMP') THEN
		RETURN(qt_tempo_w);
	END IF;

    END;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.get_info_disease (cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, cd_doenca_p text, ds_retorno_p text) FROM PUBLIC;
