-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION med_guidance_pkg.get_medicine_by_status (cd_material_p MATERIAL.CD_MATERIAL%type, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, si_check_medicine_p text) RETURNS boolean AS $body$
DECLARE

    qt_registros_w bigint;

BEGIN   
        
        IF (si_check_medicine_p = '0') THEN
            SELECT  COUNT(*)
            INTO STRICT    qt_registros_w
            FROM    cpoe_material 
            WHERE   cd_pessoa_fisica = cd_pessoa_fisica_p
            AND     cd_material = cd_material_p;
        END IF;

        IF (si_check_medicine_p = '1') THEN
            SELECT COUNT(*)
            INTO STRICT   qt_registros_w
            FROM   material_atend_paciente a
            INNER JOIN atendimento_paciente b on a.nr_atendimento = b.nr_atendimento
            WHERE  b.cd_pessoa_fisica = cd_pessoa_fisica_p
            AND    a.cd_material = cd_material_p;
        END IF;

        IF (si_check_medicine_p = '2') THEN
            SELECT sum(qt_registros) qt_registros
            INTO STRICT   qt_registros_w
            FROM (SELECT  COUNT(*) qt_registros
             FROM    cpoe_material
             WHERE   cd_material = cd_material_p
             AND     cd_pessoa_fisica = cd_pessoa_fisica_p
             
UNION ALL

             SELECT COUNT(*) qt_registros
             FROM   material_atend_paciente a
             INNER JOIN atendimento_paciente b on a.nr_atendimento = b.nr_atendimento
             WHERE  b.cd_pessoa_fisica = cd_pessoa_fisica_p
             AND    a.cd_material = cd_material_p) alias4;
        END IF;

     RETURN(qt_registros_w > 0);

    END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION med_guidance_pkg.get_medicine_by_status (cd_material_p MATERIAL.CD_MATERIAL%type, cd_pessoa_fisica_p PESSOA_FISICA.CD_PESSOA_FISICA%type, si_check_medicine_p text) FROM PUBLIC;
