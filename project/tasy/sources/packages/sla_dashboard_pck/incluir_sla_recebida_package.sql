-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE sla_dashboard_pck.incluir_sla_recebida ( cd_estabelecimento_p bigint, nr_sequencia_p bigint, nm_usuario_p text, ie_prioridade_p text, ie_classificacao_p text, nr_seq_localizacao_p bigint, nr_seq_grupo_trab_p bigint, dt_ordem_servico_p timestamp, dt_inicio_p timestamp, nr_seq_estagio_p bigint, nr_seq_equipamento_p bigint, nr_seq_classif_p bigint, ie_parado_p text, ie_nova_os_p text, ie_ambiente_p text, cd_funcao_p bigint, dt_alteracao_classif_p timestamp default null) AS $body$
DECLARE

				
nr_seq_regra_sla_w	man_ordem_serv_sla.nr_seq_sla%type;


BEGIN
nr_seq_regra_sla_w := sla_dashboard_pck.obter_se_tem_regra_sla(	cd_estabelecimento_p, nr_sequencia_p, nm_usuario_p,
						ie_prioridade_p, ie_classificacao_p,
						nr_seq_localizacao_p, nr_seq_grupo_trab_p, dt_ordem_servico_p, 
						dt_inicio_p, nr_seq_estagio_p, nr_seq_equipamento_p, nr_seq_classif_p, ie_parado_p, ie_ambiente_p);
						

if (nr_seq_regra_sla_w > 0) and (sla_dashboard_pck.obter_regra_loc_sla(nr_seq_localizacao_p, cd_funcao_p) = 'N') then
	CALL sla_dashboard_pck.incluir_os_sla_recebidas(cd_estabelecimento_p, nr_sequencia_p, nm_usuario_p, ie_prioridade_p, ie_classificacao_p, dt_ordem_servico_p,
						dt_inicio_p, nr_seq_regra_sla_w, ie_nova_os_p, dt_alteracao_classif_p, ie_ambiente_p);
elsif ( nr_seq_regra_sla_w = 0 and ie_classificacao_p = 'E' and sla_dashboard_pck.obter_regra_loc_sla(nr_seq_localizacao_p, cd_funcao_p) = 'N') then
	CALL sla_dashboard_pck.incluir_os_sla_recebidas(cd_estabelecimento_p, nr_sequencia_p, nm_usuario_p, ie_prioridade_p, ie_classificacao_p, dt_ordem_servico_p,
						dt_inicio_p, sla_dashboard_pck.obter_regra_alldef(sla_dashboard_pck.obter_nr_seq_regra_alldef(), ie_classificacao_p, ie_prioridade_p),
						ie_nova_os_p, dt_alteracao_classif_p, ie_ambiente_p);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sla_dashboard_pck.incluir_sla_recebida ( cd_estabelecimento_p bigint, nr_sequencia_p bigint, nm_usuario_p text, ie_prioridade_p text, ie_classificacao_p text, nr_seq_localizacao_p bigint, nr_seq_grupo_trab_p bigint, dt_ordem_servico_p timestamp, dt_inicio_p timestamp, nr_seq_estagio_p bigint, nr_seq_equipamento_p bigint, nr_seq_classif_p bigint, ie_parado_p text, ie_nova_os_p text, ie_ambiente_p text, cd_funcao_p bigint, dt_alteracao_classif_p timestamp default null) FROM PUBLIC;
