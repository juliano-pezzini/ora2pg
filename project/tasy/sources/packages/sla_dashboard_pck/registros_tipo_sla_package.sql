-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


	--###################################################################################################




CREATE OR REPLACE FUNCTION sla_dashboard_pck.registros_tipo_sla (dt_referencia_p timestamp) RETURNS SETOF T_TIPO_SLA AS $body$
DECLARE


	t_tipo_sla_row_w	t_tipo_sla_row;
	dt_referencia_w		timestamp;

	c01 CURSOR FOR
	SELECT	ie_tipo_sla,
		qt_sla,
		qt_sla_calculo,
		qt_atraso_resposta,
		qt_atraso_solucao,
		pr_atingido,
		qt_target
	from	man_resumo_sla_w
	where	dt_referencia	= dt_referencia_w
	and	ie_informacao	= 'T';

	c01_w	c01%rowtype;

	
BEGIN

	dt_referencia_w	:= trunc(dt_referencia_p,'month');

	open C01;
	loop
	fetch C01 into
		c01_w;
	EXIT WHEN NOT FOUND; /* apply on C01 */

		if (c01_w.ie_tipo_sla = 'SWP') then
			t_tipo_sla_row_w.ds_tipo_sla	:= 'SLA with penalty';
		elsif (c01_w.ie_tipo_sla = 'SWC') then
			t_tipo_sla_row_w.ds_tipo_sla	:= 'SLA with contract';
		elsif (c01_w.ie_tipo_sla = 'CSLA') then
			t_tipo_sla_row_w.ds_tipo_sla	:= 'Customer SLAs';
		elsif (c01_w.ie_tipo_sla = 'ALLDEF') then
			t_tipo_sla_row_w.ds_tipo_sla	:= 'All defects';
		end if;

		t_tipo_sla_row_w.dt_referencia		:= dt_referencia_w;
		t_tipo_sla_row_w.ie_tipo_sla		:= c01_w.ie_tipo_sla;
		t_tipo_sla_row_w.qt_atraso_resposta	:= c01_w.qt_atraso_resposta;
		t_tipo_sla_row_w.qt_atraso_solucao	:= c01_w.qt_atraso_solucao;
		t_tipo_sla_row_w.qt_sla			:= c01_w.qt_sla;
		t_tipo_sla_row_w.qt_sla_calculo		:= c01_w.qt_sla_calculo;
		t_tipo_sla_row_w.pr_atingido		:= c01_w.pr_atingido;
		t_tipo_sla_row_w.qt_target		:= c01_w.qt_target;

		RETURN NEXT t_tipo_sla_row_w;

	end loop;
	close C01;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION sla_dashboard_pck.registros_tipo_sla (dt_referencia_p timestamp) FROM PUBLIC;
