-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION sla_dashboard_pck.registros_sla_geral_global (dt_referencia_p timestamp) RETURNS SETOF T_CHART_SLA_GERAL_NEW AS $body$
DECLARE


t_chart_sla_geral_new_row_w	t_chart_sla_geral_new_row;
dt_referencia_w		timestamp;

c01 CURSOR FOR
SELECT ds_tipo_sla,
	ie_tipo_sla,
	qt_recebido qt_sla,
	null qt_sla_calculo,
	null qt_atraso_resposta,
	null qt_atraso_solucao,
	percent_atingido sla_achievement,
	percent_meta qt_target
from    table(sla_dashboard_pck.reg_sla_geral_ref(dt_referencia_w,'SWP'))

union

SELECT ds_tipo_sla,
	ie_tipo_sla,
	qt_recebido qt_sla,
	null qt_sla_calculo,
	null qt_atraso_resposta,
	null qt_atraso_solucao,
	percent_atingido sla_achievement,
	percent_meta qt_target
from    table(sla_dashboard_pck.reg_sla_geral_ref(dt_referencia_w,'SWC'))

union

select  ds_tipo_sla,
	ie_tipo_sla,
	qt_sla,
	qt_sla_calculo,
	qt_atraso_resposta,
	qt_atraso_solucao,
	pr_atingido sla_achievement,
	qt_target
from  table(sla_dashboard_pck.registros_sla_dashboard_ref(dt_referencia_w));

c01_w	c01%rowtype;


BEGIN

dt_referencia_w	:= trunc(dt_referencia_p,'month');

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */

	t_chart_sla_geral_new_row_w.ds_tipo_sla			:= c01_w.ds_tipo_sla;
	t_chart_sla_geral_new_row_w.dt_referencia		:= dt_referencia_w;
	t_chart_sla_geral_new_row_w.sla_achievement		:= c01_w.sla_achievement;
	t_chart_sla_geral_new_row_w.qt_target			:= c01_w.qt_target;
	t_chart_sla_geral_new_row_w.ie_tipo_sla			:= c01_w.ie_tipo_sla;
	t_chart_sla_geral_new_row_w.qt_sla			:= c01_w.qt_sla;
	t_chart_sla_geral_new_row_w.qt_sla_calculo		:= c01_w.qt_sla_calculo;
	t_chart_sla_geral_new_row_w.qt_atraso_resposta		:= c01_w.qt_atraso_resposta;
	t_chart_sla_geral_new_row_w.qt_atraso_solucao		:= c01_w.qt_atraso_solucao;

	RETURN NEXT t_chart_sla_geral_new_row_w;

end loop;
close C01;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION sla_dashboard_pck.registros_sla_geral_global (dt_referencia_p timestamp) FROM PUBLIC;
