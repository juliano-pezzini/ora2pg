-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION sla_dashboard_pck.obter_sla_estouro_total (ie_tipo_sla_p bigint,mes_ref_p bigint, ano_ref_p bigint) RETURNS SETOF T_SLA_ESTOURO_GERENCIA_TB AS $body$
DECLARE

    t_sla_estouro_gerencia_tb_w t_sla_estouro_gerencia_tb;
    sql_w varchar(32000);
BEGIN
    sql_w := 	'select a.nr_seq_localizacao,
			a.nr_seq_ordem,
			a.ds_localizacao,
			nvl(a.dono_estouro_resp,''Sem estouro/ Not breached'') ds_dono_estouro_resp,
			nvl(a.dono_estouro_sol,''Sem estouro/ Not breached'') ds_dono_estouro_sol,
			a.dt_estouro_resp,
			a.dt_estouro_sol,
			a.nr_seq_gerencia_resp,
			a.nr_seq_gerencia_sol,
			substr(a.ds_tipo_contrato,1,255) ds_tipo_contrato,
			a.ds_tipo_tempo
		from    table(sla_dashboard_pck.obter_sla_detalhe(:ie_tipo_sla_p,:mes_ref_p,:ano_ref_p)) a
		where   (a.dono_estouro_resp is not null or a.dono_estouro_sol is not null)';

    EXECUTE sql_w 
    BULK COLLECT INTO STRICT t_sla_estouro_gerencia_tb_w 
    USING   ie_tipo_sla_p,
            mes_ref_p, 
            ano_ref_p;
	
    for i in 1 .. t_sla_estouro_gerencia_tb_w.count loop
    
        RETURN NEXT  t_sla_estouro_gerencia_tb_w(i );

    end loop;
    return;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION sla_dashboard_pck.obter_sla_estouro_total (ie_tipo_sla_p bigint,mes_ref_p bigint, ano_ref_p bigint) FROM PUBLIC;
