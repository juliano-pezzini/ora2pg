-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE sla_dashboard_pck.man_incluir_os_monitor (nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type, nm_usuario_p text, cd_estabelecimento_p bigint, ie_commit_p text, ie_abertura_p text, ie_classificacao_p man_sla_evento.ie_classificacao%type, ie_prioridade_p man_sla_evento.ie_prioridade%type, qt_min_inicio_p man_sla_evento.qt_min_inicio%type, qt_min_termino_p man_sla_evento.qt_min_termino%type, qt_min_ordem_servico_p bigint, nr_seq_regra_sla_p bigint, ie_nova_os_p text, ie_tipo_sla_p man_sla_evento.ie_tipo_sla%type, ie_tipo_sla_termino_p man_sla_evento.ie_tipo_sla_termino%type, ie_tempo_p man_sla_evento.ie_tempo%type, ie_tempo_termino_p man_sla_evento.ie_tempo_termino%type, ie_ambiente_p man_ordem_servico.ie_ambiente%type) AS $body$
DECLARE

nr_seq_w	bigint;

BEGIN
	if (sla_dashboard_pck.obter_se_os_externa(nr_seq_regra_sla_p) > 0) or ( sla_dashboard_pck.obter_regra_alldef(sla_dashboard_pck.obter_nr_seq_regra_alldef(), ie_classificacao_p, ie_prioridade_p) = nr_seq_regra_sla_p ) or (nr_seq_regra_sla_p in (1968,1969,1970,1971,1973)) then
		insert into man_sla_monitor(
			nr_sequencia,
			nr_seq_ordem_servico,
			dt_atualizacao,
			nm_usuario,
			dt_atualizacao_nrec,
			nm_usuario_nrec,
			cd_estabelecimento
			)
		values (	
			nextval('man_sla_monitor_seq'),
			nr_seq_ordem_serv_p,
			clock_timestamp(),
			nm_usuario_p,
			clock_timestamp(),
			nm_usuario_p,
			cd_estabelecimento_p);
			
		if (ie_abertura_p = 'S' and ie_nova_os_p = 'S') then
			CALL sla_dashboard_pck.man_incluir_os_evento(nr_seq_ordem_serv_p, nm_usuario_p, cd_estabelecimento_p, null,'1', ie_commit_p, ie_classificacao_p, ie_prioridade_p,
						qt_min_inicio_p, qt_min_termino_p, qt_min_ordem_servico_p, nr_seq_regra_sla_p, null, null, ie_tipo_sla_p, ie_tipo_sla_termino_p, ie_tempo_p, ie_tempo_termino_p, ie_ambiente_p);
		end if;
	end if;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sla_dashboard_pck.man_incluir_os_monitor (nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type, nm_usuario_p text, cd_estabelecimento_p bigint, ie_commit_p text, ie_abertura_p text, ie_classificacao_p man_sla_evento.ie_classificacao%type, ie_prioridade_p man_sla_evento.ie_prioridade%type, qt_min_inicio_p man_sla_evento.qt_min_inicio%type, qt_min_termino_p man_sla_evento.qt_min_termino%type, qt_min_ordem_servico_p bigint, nr_seq_regra_sla_p bigint, ie_nova_os_p text, ie_tipo_sla_p man_sla_evento.ie_tipo_sla%type, ie_tipo_sla_termino_p man_sla_evento.ie_tipo_sla_termino%type, ie_tempo_p man_sla_evento.ie_tempo%type, ie_tempo_termino_p man_sla_evento.ie_tempo_termino%type, ie_ambiente_p man_ordem_servico.ie_ambiente%type) FROM PUBLIC;
