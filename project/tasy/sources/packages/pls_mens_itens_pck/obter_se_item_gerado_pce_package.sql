-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_mens_itens_pck.obter_se_item_gerado_pce ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_pagador_p pls_contrato_pagador.nr_sequencia%type, dt_mesano_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, dt_inicio_cobertura_p pls_mensalidade_segurado.dt_inicio_cobertura%type, dt_fim_cobertura_p pls_mensalidade_segurado.dt_fim_cobertura%type) RETURNS varchar AS $body$
DECLARE


qt_item_pre_gerado_w	bigint;


BEGIN

select 	count(1)
into STRICT	qt_item_pre_gerado_w
from	pls_mensalidade_seg_item a,
	pls_mensalidade_segurado b,
	pls_mensalidade c
where	a.nr_seq_mensalidade_seg = b.nr_sequencia
and	b.nr_seq_mensalidade = c.nr_sequencia
and	coalesce(c.ie_cancelamento::text, '') = ''
and	a.ie_tipo_item = '1'
and	b.nr_seq_segurado = nr_seq_segurado_p
and	c.nr_seq_pagador = nr_seq_pagador_p
and	b.dt_mesano_referencia = dt_mesano_referencia_p
and	b.dt_fim_cobertura >= dt_inicio_cobertura_p
and	b.dt_inicio_cobertura <= dt_fim_cobertura_p;

if (qt_item_pre_gerado_w > 0) then
	return 'S';
else
	return 'N';
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_mens_itens_pck.obter_se_item_gerado_pce ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_pagador_p pls_contrato_pagador.nr_sequencia%type, dt_mesano_referencia_p pls_mensalidade_segurado.dt_mesano_referencia%type, dt_inicio_cobertura_p pls_mensalidade_segurado.dt_inicio_cobertura%type, dt_fim_cobertura_p pls_mensalidade_segurado.dt_fim_cobertura%type) FROM PUBLIC;
