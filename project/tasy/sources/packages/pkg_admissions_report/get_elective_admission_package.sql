-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

  --
CREATE OR REPLACE FUNCTION pkg_admissions_report.get_elective_admission (NR_ATENDIMENTO_P ATENDIMENTO_PACIENTE.NR_ATENDIMENTO%TYPE) RETURNS bigint AS $body$
DECLARE


  NR_W bigint;

  
BEGIN
  
    NR_W := 0;

    BEGIN
      
      SELECT 1
        INTO STRICT NR_W
        
       WHERE EXISTS (SELECT 1
                       FROM AGENDA_QUIMIO Q
                      WHERE (Q.NR_ATENDIMENTO IS NOT NULL AND Q.NR_ATENDIMENTO::text <> '')
                        AND Q.NR_ATENDIMENTO = NR_ATENDIMENTO_P
                        AND Q.IE_STATUS_AGENDA <> 'C');

    EXCEPTION WHEN no_data_found THEN

      BEGIN
        
        SELECT 1
          INTO STRICT NR_W
          
         WHERE EXISTS (SELECT 1
                         FROM AGENDA_CONSULTA C
                        WHERE (C.NR_ATENDIMENTO IS NOT NULL AND C.NR_ATENDIMENTO::text <> '')
                          AND C.NR_ATENDIMENTO = NR_ATENDIMENTO_P
                          AND C.IE_STATUS_AGENDA <> 'C');

      EXCEPTION WHEN no_data_found THEN

        BEGIN
        
          SELECT 1
            INTO STRICT NR_W
            
           WHERE EXISTS (SELECT 1
                           FROM AGENDA_PACIENTE AP
                          WHERE (AP.NR_ATENDIMENTO IS NOT NULL AND AP.NR_ATENDIMENTO::text <> '')
                            AND AP.NR_ATENDIMENTO = NR_ATENDIMENTO_P
                            AND AP.IE_STATUS_AGENDA <> 'C');

        EXCEPTION WHEN no_data_found THEN

          NR_W := 0;

        END;

      END;

    END;
    
    RETURN NR_W;

  END;
  --
$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pkg_admissions_report.get_elective_admission (NR_ATENDIMENTO_P ATENDIMENTO_PACIENTE.NR_ATENDIMENTO%TYPE) FROM PUBLIC;
