-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_assist_pck.obter_se_consiste_rep ( nr_seq_regra_p bigint, cd_perfil_p text default null) RETURNS varchar AS $body$
DECLARE

	ie_consistencia_w	varchar(255);
	k  integer;
	
BEGIN
	ie_consistencia_w	:= null;
	
	if (cd_perfil_p IS NOT NULL AND cd_perfil_p::text <> '') then
		CALL CALL wheb_assist_pck.set_cd_perfil(cd_perfil_p);
	end if;

	for i in 1..consistenciaRep_w.count-1 loop
		begin
		if (current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor[i].nr_regra_w = nr_seq_regra_p) then
			ie_consistencia_w	:= current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor[i].ie_consiste_w;
			exit;
		end if;
		end;
	end loop;

	if (coalesce(ie_consistencia_w::text, '') = '') then
		k := current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor.count+1;
		current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor[k].nr_regra_w	:= nr_seq_regra_p;
		current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor[k].ie_consiste_w	:= obter_se_consistir_regra_rep(nr_seq_regra_p,current_setting('wheb_assist_pck.cd_perfil_w')::bigint);
		ie_consistencia_w	:=current_setting('wheb_assist_pck.consistenciarep_w')::consistenciaRepvetor[k].ie_consiste_w;
	end if;

	return ie_consistencia_w;
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_assist_pck.obter_se_consiste_rep ( nr_seq_regra_p bigint, cd_perfil_p text default null) FROM PUBLIC;
