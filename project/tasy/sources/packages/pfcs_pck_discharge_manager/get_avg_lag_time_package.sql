-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_discharge_manager.get_avg_lag_time ( cd_establishment_p bigint, cd_unit_p bigint default null, cd_unit_classification_p text default null) RETURNS bigint AS $body$
DECLARE

        vl_avg_lag_time_w integer;

BEGIN
        vl_avg_lag_time_w := ((
            coalesce(
                pfcs_pck_discharge_manager.get_avg_discharge_time(cd_establishment_p, cd_unit_p, cd_unit_classification_p),
                clock_timestamp()) - coalesce(
                    pfcs_pck_discharge_manager.get_avg_discharge_order_time(cd_establishment_p, cd_unit_p, cd_unit_classification_p),
                    clock_timestamp())
                ) * 1440);
        if (vl_avg_lag_time_w < 0) then
            vl_avg_lag_time_w := 0;
        end if;
        return vl_avg_lag_time_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_discharge_manager.get_avg_lag_time ( cd_establishment_p bigint, cd_unit_p bigint default null, cd_unit_classification_p text default null) FROM PUBLIC;
