-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_telemetry_config_pck.get_capacity_unit (cd_establishment_p bigint, cd_department_p text) RETURNS bigint AS $body$
DECLARE

		nr_capacity_unit_w	setor_atendimento.nr_unit_tl_capacity%type;
	
BEGIN
		select	sum(coalesce(sa.nr_unit_tl_capacity,0))
		  into STRICT	nr_capacity_unit_w
		   from	setor_atendimento sa
		  where	sa.cd_estabelecimento_base = cd_establishment_p
			and	sa.cd_classif_setor in ('1','3','4','9','11','12')
			and	sa.ie_situacao = pfcs_pck_constants.IE_ACTIVE
			and	((coalesce(cd_department_p::text, '') = '') or (sa.ds_setor_atendimento = cd_department_p));

		return nr_capacity_unit_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_telemetry_config_pck.get_capacity_unit (cd_establishment_p bigint, cd_department_p text) FROM PUBLIC;
