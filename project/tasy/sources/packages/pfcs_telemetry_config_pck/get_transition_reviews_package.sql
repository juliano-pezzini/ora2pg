-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_telemetry_config_pck.get_transition_reviews (cd_establishment_p bigint, cd_department_p text) RETURNS bigint AS $body$
DECLARE

		qt_transition_reviews_w		bigint := 0;
	
BEGIN
		select	count(1) vl_indicator
		  into STRICT	qt_transition_reviews_w
		  from	pfcs_panel_detail ppd
		inner join pfcs_detail_patient pdp on (ppd.nr_sequencia = pdp.nr_seq_detail)
		 left join pfcs_detail_bed pdb ON (ppd.nr_sequencia = pdb.nr_seq_detail)
		 where	ppd.nr_seq_indicator = 46 -- Transition reviews get data from this indicator
		   and	ppd.nr_seq_operational_level = cd_establishment_p
		   and (coalesce(cd_department_p::text, '') = '' or pdb.cd_department = cd_department_p)
		   and	ppd.nr_sequencia = pdb.nr_seq_detail
		   and	ppd.ie_situation = pfcs_pck_constants.IE_ACTIVE
		   and	pfcs_telemetry_config_pck.get_transition_review(pdp.qt_red_alarms, pdp.qt_yellow_alarms, pdp.qt_edi_score, pdp.dt_monitor_entrance) = pfcs_pck_constants.IE_YES_BR
		   and 	pfcs_telemetry_config_pck.get_discharge_orders(ppd.nr_seq_operational_level, pdp.nr_seq_encounter) = pfcs_pck_constants.IE_NO;

		return qt_transition_reviews_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_telemetry_config_pck.get_transition_reviews (cd_establishment_p bigint, cd_department_p text) FROM PUBLIC;
