-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clinical_notes_pck.is_active_decease_exists ( cd_pessoa_fisica_p text) RETURNS varchar AS $body$
DECLARE

    is_exists varchar(1) := 'N';

BEGIN
    select CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END 
    into STRICT is_exists
    from diagnostico_doenca a,
      atendimento_paciente x
    where a.nr_atendimento      = x.nr_atendimento
    and x.cd_pessoa_fisica      = cd_pessoa_fisica_p
    and (coalesce(a.dt_fim::text, '') = ''
    or a.dt_fim                 > clock_timestamp())
    and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
    and coalesce(a.ie_situacao, 'A') = 'A'
    and not exists (SELECT 1
      from diagnostico_doenca_hist z
      where z.cd_pessoa_fisica = cd_pessoa_fisica_p
      and z.cd_doenca          = a.cd_doenca
      and (z.ie_status IS NOT NULL AND z.ie_status::text <> '')
      and (z.dt_disease_end IS NOT NULL AND z.dt_disease_end::text <> '')
      );
    return is_exists;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION clinical_notes_pck.is_active_decease_exists ( cd_pessoa_fisica_p text) FROM PUBLIC;
