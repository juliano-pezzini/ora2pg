-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE clinical_notes_pck.clinical_note_check_default (ie_med_record_type_p text, ie_med_sub_type_p text, ie_soap_type_p text, ie_stage_p bigint, nr_sequence_p bigint) AS $body$
DECLARE

        ie_deafult_exists    varchar(1) := 'N';

BEGIN
        select CASE WHEN count(1)=0 THEN 'N'  ELSE 'S' END 
        into STRICT ie_deafult_exists
        from clinical_note_settings
        where ie_data_type = 'CLINICAL_NOTE'
        and ie_med_rec_type = ie_med_record_type_p
        and (coalesce(ie_cpoe_item_type::text, '') = '' or ie_cpoe_item_type = ie_med_sub_type_p)
        and ie_soap_type = ie_soap_type_p
        and ie_stage = ie_stage_p
        and ie_default_rule = 'S'
        and ie_situacao = 'A';

        if ( ie_deafult_exists = 'N' ) then
            update clinical_note_settings
            set ie_default_rule = 'S'
            where ie_data_type = 'CLINICAL_NOTE'
            and ie_med_rec_type = ie_med_record_type_p
            and (coalesce(ie_cpoe_item_type::text, '') = '' or ie_cpoe_item_type = ie_med_sub_type_p)
            and ie_soap_type = ie_soap_type_p
            and ie_stage = ie_stage_p
            and nr_sequencia = nr_sequence_p;

        else
            CALL wheb_mensagem_pck.exibir_mensagem_abort(1163202);
        end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE clinical_notes_pck.clinical_note_check_default (ie_med_record_type_p text, ie_med_sub_type_p text, ie_soap_type_p text, ie_stage_p bigint, nr_sequence_p bigint) FROM PUBLIC;
