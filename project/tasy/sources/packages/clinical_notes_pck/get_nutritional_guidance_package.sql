-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION clinical_notes_pck.get_nutritional_guidance (nr_seq_recomendacao_p cpoe_nut_guidance.nr_seq_recomendacao%type) RETURNS varchar AS $body$
DECLARE


ds_result_w		nutritional_guidance_pat.nm_guidance%type;


BEGIN

if (nr_seq_recomendacao_p IS NOT NULL AND nr_seq_recomendacao_p::text <> '') then
select max(ngpat.nm_guidance)
into STRICT ds_result_w
from nutritional_guidance_pat ngpat,
(SELECT nr_seq_nut_guidance from (select 1 or_seq, cng2.nr_seq_nut_guidance from cpoe_nut_guidance cng2 where cng2.nr_seq_recomendacao= nr_seq_recomendacao_p and cng2.ie_cpoe_rec = 'N'

union

select 2 or_seq, cng3.nr_seq_nut_guidance from cpoe_nut_guidance cng3 where cng3.nr_seq_recomendacao= nr_seq_recomendacao_p and coalesce(cng3.ie_cpoe_rec, 'S') = 'S') alias3 LIMIT 1) nut_gui
where nut_gui.nr_seq_nut_guidance = ngpat.nr_sequencia;

end if;

return ds_result_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION clinical_notes_pck.get_nutritional_guidance (nr_seq_recomendacao_p cpoe_nut_guidance.nr_seq_recomendacao%type) FROM PUBLIC;
