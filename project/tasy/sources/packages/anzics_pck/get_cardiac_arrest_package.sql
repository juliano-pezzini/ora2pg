-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION anzics_pck.get_cardiac_arrest ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, nr_seq_atepacu_p bigint) RETURNS bigint AS $body$
DECLARE

    qt_return_w               smallint := 0;
    ie_cardiac_event_exists_w varchar(1)   := 'N';

BEGIN
    CALL anzics_pck.set_icu_date(nr_seq_atepacu_p);
    SELECT CASE WHEN COUNT(1)=0 THEN 'N'  ELSE 'S' END
    INTO STRICT ie_cardiac_event_exists_w
    FROM QUA_EVENTO_PACIENTE ep
    JOIN QUA_EVENTO qe
    ON ep.NR_SEQ_EVENTO = qe.nr_sequencia
    JOIN QUA_TIPO_EVENTO qte
    ON qe.nr_seq_tipo      = qte.nr_sequencia
    WHERE nr_atendimento   = nr_atendimento_p
    AND qte.IE_TIPO_EVENTO = 'PCR'
    AND (ep.dt_liberacao IS NOT NULL AND ep.dt_liberacao::text <> '')
    AND coalesce(ep.dt_inativacao::text, '') = ''
    AND ep.ie_situacao     = 'A'
    AND dt_evento BETWEEN(current_setting('anzics_pck.dt_inicio_w')::timestamp - 1) AND current_setting('anzics_pck.dt_inicio_w')::timestamp;
    IF ( ie_cardiac_event_exists_w = 'S') THEN
      qt_return_w                 := 1;
    END IF;
    RETURN qt_return_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION anzics_pck.get_cardiac_arrest ( nr_atendimento_p bigint, cd_pessoa_fisica_p text, nr_seq_atepacu_p bigint) FROM PUBLIC;
