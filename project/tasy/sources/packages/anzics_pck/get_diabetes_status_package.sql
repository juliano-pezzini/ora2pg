-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION anzics_pck.get_diabetes_status ( nr_atendimento_p bigint) RETURNS bigint AS $body$
DECLARE

    nr_diabetes_status_1_w     smallint;
    nr_diabetes_status_2_w     smallint;
    nr_diabetes_status_3_w     smallint;
    nr_diabetes_status_4_e08_w smallint;
    nr_diabetes_status_4_z86_w smallint;
    nr_diabetes_status_4_r73_w smallint;
    cd_pessoa_fisica_w         varchar(10);

BEGIN
    cd_pessoa_fisica_w := obter_pessoa_atendimento(nr_atendimento_p,'C');
    SELECT CASE WHEN anzics_pck.get_if_icd(nr_atendimento_p,cd_pessoa_fisica_w,'E10')='S' THEN 1  ELSE 0 END ,
      CASE WHEN anzics_pck.get_if_icd(nr_atendimento_p,cd_pessoa_fisica_w,'E11')='S' THEN 1  ELSE 0 END ,
      CASE WHEN anzics_pck.get_if_icd(nr_atendimento_p,cd_pessoa_fisica_w,'O24')='S' THEN 1  ELSE 0 END ,
      CASE WHEN anzics_pck.get_if_icd(nr_atendimento_p,cd_pessoa_fisica_w,'E08')='S' THEN 1  ELSE 0 END ,
      CASE WHEN anzics_pck.get_if_icd(nr_atendimento_p,cd_pessoa_fisica_w,'R73')='S' THEN 1  ELSE 0 END
    INTO STRICT nr_diabetes_status_1_w,
      nr_diabetes_status_2_w,
      nr_diabetes_status_3_w,
      nr_diabetes_status_4_e08_w ,
      nr_diabetes_status_4_r73_w
;
    IF (nr_diabetes_status_1_w = 1) THEN
      RETURN 1;
    elsif (nr_diabetes_status_2_w = 1) THEN
      RETURN 2;
    elsif (nr_diabetes_status_3_w = 1) THEN
      RETURN 3;
    elsif (nr_diabetes_status_4_e08_w = 1 OR nr_diabetes_status_4_r73_w = 1 ) THEN
      RETURN 4;
    ELSE
      RETURN 5;
    END IF;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION anzics_pck.get_diabetes_status ( nr_atendimento_p bigint) FROM PUBLIC;
