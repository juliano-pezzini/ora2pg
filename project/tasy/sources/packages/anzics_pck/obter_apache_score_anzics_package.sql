-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION anzics_pck.obter_apache_score_anzics ( qt_fio2_p bigint, qt_pao2_p bigint, qt_co2_p bigint, ie_apache_type text DEFAULT 'II', dt_resultado_p timestamp DEFAULT NULL, nr_atendimento_p bigint DEFAULT NULL) RETURNS bigint AS $body$
DECLARE

    nr_apache_score_w smallint;
    qt_grad_aao2_w    double precision;
    ie_intubated_w    varchar(1) := 'N';

BEGIN
    IF (qt_fio2_p     > 0 AND qt_pao2_p > 0 AND qt_co2_p > 0 )THEN
      qt_grad_aao2_w := (713 * qt_fio2_p) - qt_pao2_p - (qt_co2_p / 0.8);
      ie_intubated_w := anzics_pck.get_intubation_status(nr_atendimento_p,(dt_resultado_p-((1/24/60)*59)),(dt_resultado_p + ((1/24/60)*59)));
    END IF;
    IF (ie_apache_type = 'II') THEN
      BEGIN
        IF (qt_fio2_p >= 0.5) THEN
          BEGIN
              IF (qt_grad_aao2_w     < 200) THEN
                nr_apache_score_w   := 0;
              elsif (qt_grad_aao2_w >= 200 AND qt_grad_aao2_w <= 349) THEN
                nr_apache_score_w   := 2;
              elsif (qt_grad_aao2_w >= 350 AND qt_grad_aao2_w <= 499) THEN
                nr_apache_score_w   := 3;
              ELSE
                nr_apache_score_w := 4;
              END IF;
          END;
        ELSE
          BEGIN
            IF ( qt_pao2_p       < 55) THEN
              nr_apache_score_w := 4;
            elsif (qt_pao2_p    >= 55 AND qt_pao2_p <= 60) THEN
              nr_apache_score_w := 3;
            elsif (qt_pao2_p    >= 61 AND qt_pao2_p <= 70) THEN
              nr_apache_score_w := 1;
            ELSE
              nr_apache_score_w := 0;
            END IF;
          END;
        END IF;
      END;
    ELSE
      BEGIN
        IF (qt_fio2_p >= 0.5) THEN
          BEGIN
            IF (ie_intubated_w       = 'S') THEN
              IF (qt_grad_aao2_w     < 100) THEN
                nr_apache_score_w   := 0;
              elsif (qt_grad_aao2_w >= 100 AND qt_grad_aao2_w <= 249) THEN
                nr_apache_score_w   := 7;
              elsif (qt_grad_aao2_w >= 250 AND qt_grad_aao2_w <= 349) THEN
                nr_apache_score_w   := 9;
              elsif (qt_grad_aao2_w >= 350 AND qt_grad_aao2_w <= 499) THEN
                nr_apache_score_w   := 11;
              ELSE
                nr_apache_score_w := 14;
              END IF;
            END IF;
          END;
        ELSE
          BEGIN
            IF ( qt_pao2_p       < 49) THEN
              nr_apache_score_w := 15;
            elsif (qt_pao2_p    >= 50 AND qt_pao2_p <= 69) THEN
              nr_apache_score_w := 5;
            elsif (qt_pao2_p    >= 70 AND qt_pao2_p <= 79) THEN
              nr_apache_score_w := 2;
            ELSE
              nr_apache_score_w := 0;
            END IF;
          END;
        END IF;
      END;
    END IF;
    RETURN nr_apache_score_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION anzics_pck.obter_apache_score_anzics ( qt_fio2_p bigint, qt_pao2_p bigint, qt_co2_p bigint, ie_apache_type text DEFAULT 'II', dt_resultado_p timestamp DEFAULT NULL, nr_atendimento_p bigint DEFAULT NULL) FROM PUBLIC;
