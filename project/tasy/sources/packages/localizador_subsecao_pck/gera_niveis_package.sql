-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--
-- dblink wrapper to call function localizador_subsecao_pck.gera_niveis() as an autonomous transaction
--
CREATE EXTENSION IF NOT EXISTS dblink;

CREATE OR REPLACE PROCEDURE localizador_subsecao_pck.gera_niveis (nr_seq_linked_data_p bigint, nr_seq_template_p bigint, nr_seq_documento_secao_p bigint) AS $body$
DECLARE
	-- Change this to reflect the dblink connection string
	v_conn_str  text := format('port=%s dbname=%s user=%s', current_setting('port'), current_database(), current_user);
	v_query     text;

BEGIN
	v_query := 'CALL localizador_subsecao_pck.gera_niveis_atx ( ' || quote_nullable(nr_seq_linked_data_p) || ',' || quote_nullable(nr_seq_template_p) || ',' || quote_nullable(nr_seq_documento_secao_p) || ' )';
	PERFORM * FROM dblink(v_conn_str, v_query) AS p (ret boolean);

END;
$body$ LANGUAGE plpgsql SECURITY DEFINER;




CREATE OR REPLACE PROCEDURE localizador_subsecao_pck.gera_niveis_atx (nr_seq_linked_data_p bigint, nr_seq_template_p bigint, nr_seq_documento_secao_p bigint) AS $body$
DECLARE

atributos_w          	atributos_t := atributos_t();
nr_indice_w          	bigint;
nr_indice_ww         	bigint  := 0;
i                    	smallint;
nr_seq_superior_1_w  	bigint;
nr_seq_superior_2_w  	bigint;
nr_seq_superior_3_w  	bigint;
nr_seq_superior_4_w  	bigint;
nr_seq_superior_5_w	 	bigint;
ds_lista_linked_w    	varchar(4000);
ds_descricao_w			varchar(255);
ie_chart_view_w			documento_secao.ie_chart_view%type := 'S';
ie_timeline_view_w		documento_secao.ie_chart_view%type := 'S';
ie_grid_view_w			documento_secao.ie_chart_view%type := 'S';


c_linked_data CURSOR FOR
   SELECT   a.nr_sequencia nr_seq_linked_data
   from     linked_data a,
            linked_data_ativacao b
   where    a.nr_sequencia             = b.nr_seq_linked_data
   and      a.nr_sequencia             = nr_seq_linked_data_p

union

   SELECT   b.nr_seq_linked_data_vinc nr_seq_linked_data
   from     linked_data a,
            linked_data_vinculo b,
            linked_data_ativacao c
   where    a.nr_sequencia            = b.nr_seq_linked_data
   and      b.nr_seq_linked_data_vinc = c.nr_seq_linked_data
   and      a.nr_sequencia            = nr_seq_linked_data_p;

c_level_1 CURSOR FOR
   SELECT  distinct b.ie_grupo,
           c.ds_expressao ds_descricao
   from    linked_data a,
           linked_data_ativacao b,
           valor_dominio_v c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x
   where   a.nr_sequencia        = b.nr_seq_linked_data
   and     b.ie_grupo            = c.vl_dominio
   and     c.cd_dominio          = 9771
   and     a.nr_sequencia        = x.nr_registro
   order by 2;

							
c_conteudo_template CURSOR FOR
	SELECT  a.nr_sequencia nr_seq_temp_conteudo,
			coalesce(a.ds_label,obter_desc_expressao(cd_exp_label_tela)) 	 ds_descricao,
			upper('nm_conteudo_'||a.nr_sequencia) nm_atrib_cliente,
			a.nr_seq_apres,
			c.DS_TEMPLATE
	from    ehr_template_conteudo a,
			ehr_elemento	b,
			EHR_TEMPLATE c
	where	a.nr_seq_elemento 		= b.nr_sequencia
	and		a.nr_seq_template		= c.nr_sequencia
	and		b.ie_componente 		in ('de','cb','lcb','dtp')
	and		coalesce(ie_situacao,'A') 	= 'A'
	and		a.nr_seq_template		= nr_seq_template_p
	order by a.nr_seq_apres;
	
c_template_insercao CURSOR FOR
	SELECT  distinct ds_template ds_descricao,
			nr_sequencia,
			nr_seq_apres nr_seq_apresent,
			(SELECT	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = 650) ie_chart_view,
			(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = 650) ie_timeline_view,
			(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = 650) ie_grid_view
	from    ehr_template a
	where	ie_insercao_apap	= 'S'
	and   	(dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
	order	by nr_seq_apres,ds_template;


c_elemento_insercao CURSOR(nr_seq_template_p  bigint) FOR
	SELECT  a.nr_sequencia nr_seq_temp_conteudo,
			coalesce(a.ds_label,obter_desc_expressao(cd_exp_label_tela)) ds_descricao,
			upper('nm_conteudo_'||a.nr_sequencia||'_650') nm_atributo_linked,
			a.nr_seq_apres,
			a.nr_seq_elem_sup nr_seq_atributo,
			--(select nvl(max('S'),'N') from ehr_template_conteudo x where x.nr_seq_elem_sup = a.nr_sequencia) ie_composto_tree
			CASE WHEN coalesce(a.nr_seq_elem_sup::text, '') = '' THEN 'N'  ELSE 'S' END  ie_composto_tree
	from    ehr_template_conteudo a,
			ehr_elemento	b,
			EHR_TEMPLATE c
	where	a.nr_seq_elemento 		= b.nr_sequencia
	and		a.nr_seq_template		= c.nr_sequencia
	and		b.ie_componente 		in ('de','cb','lcb','dtp')
	and		coalesce(ie_situacao,'A') 	= 'A'
	and		a.nr_seq_template		= nr_seq_template_p
	
union

	SELECT  a.nr_sequencia nr_seq_temp_conteudo,
			a.ds_label ds_descricao,
			upper('nm_conteudo_'||a.nr_sequencia||'_650') nm_atributo_linked,
			a.nr_seq_apres,
			a.nr_sequencia nr_seq_atributo,
			CASE WHEN coalesce(a.nr_seq_elem_sup::text, '') = '' THEN 'N'  ELSE 'S' END  ie_composto_tree
	from    ehr_template_conteudo a
	where	a.NR_SEQ_ELEM_VISUAL = 4
	and     exists (select 1 from ehr_template_conteudo x where a.nr_sequencia = x.nr_seq_elem_sup)
	and		coalesce(ie_situacao,'A') 	= 'A'
	and		a.nr_seq_template		= nr_seq_template_p
	order by nr_seq_apres;


c_level_2_bh CURSOR FOR
   SELECT  obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
           a.nm_atributo_linked nm_atributo,
           a.nm_atributo_linked,
           d.nr_seq_apresent,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
           linked_data_ativacao c,
           valor_dominio_v d,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y
   where   a.nr_seq_visao        = b.nr_sequencia
   and     a.nr_seq_visao        = c.nr_seq_visao
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and	   a.nr_seq_linked_data  = y.nr_sequencia	
   and     a.ie_visivel_cliente  = 'S'
   and     a.nr_seq_linked_data  = x.nr_registro
   and     c.IE_INFORMACAO       = d.vl_dominio
   and     d.cd_dominio          = 9778
   and     c.ie_grupo            = 'BH'
   and (coalesce(pkg_i18n.get_user_locale, 'pt_BR') != 'ja_JP' or a.nr_seq_linked_data not in (385, 386))
   order by d.nr_seq_apresent;

c_level_2_escalas CURSOR FOR
   SELECT  distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
           a.nr_seq_visao,
           b.nm_tabela,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
		   linked_data_ativacao c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y,
		   (SELECT 	t.nr_sequencia nr_seq_escala_doc
			from	escala_documentacao t
			where  	obter_se_valor_dominio_ativo(1799,t.ie_escala) = 'S'
			and	  	obter_se_escala_lib_pais(t.nr_sequencia,philips_param_pck.get_cd_pais) ='S' 
			and	  	philips_param_pck.get_cd_pais <> 1 
			and (t.ie_restricao_uso <> 'N' or coalesce(t.ie_restricao_uso::text, '') = '') 
			
union

			select  edv.nr_sequencia nr_seq_escala_doc
			from	escala_documentacao_v edv inner join escala_documentacao ed on edv.ie_escala = ed.ie_escala
			where   coalesce(wheb_assist_pck.getescalaliberada(edv.ie_escala),'S') = 'S' 
			and	    obter_se_escala_lib_pais(edv.nr_sequencia,philips_param_pck.get_cd_pais) = 'S'
			and (ed.ie_restricao_uso <> 'N' or coalesce(ed.ie_restricao_uso::text, '') = '') 
			and	    philips_param_pck.get_cd_pais = 1) z
   where   a.nr_seq_visao        = b.nr_sequencia
   and     a.nr_seq_linked_data  = x.nr_registro
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and	   a.nr_seq_linked_data	 = y.nr_sequencia
   and	   y.nr_seq_escala_doc	 = z.nr_seq_escala_doc
   and     c.ie_grupo            = 'ES'
   order by 1;

c_level_2_ganhos_perdas CURSOR(nr_seq_linked_data_p	 linked_data.nr_sequencia%type) FOR
   SELECT    c.ds_expressao ds_descricao,
             c.vl_dominio ie_perda_ganho,
             c.nr_seq_apresent,
			 nr_seq_linked_data_p nr_seq_linked_data,
			 (SELECT	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
			 (select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
			 (select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
   from      valor_dominio_v c
   where     coalesce(c.ie_situacao,'A')  = 'A'
   and       c.cd_dominio            = 9772
   order by  c.nr_seq_apresent;

c_level_2_eventos_atend CURSOR(nr_seq_linked_data_p  bigint) FOR
   SELECT   ds_expressao ds_descricao,
            vl_dominio IE_EVENTO_TIPO,
            (SELECT  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked,
            nr_seq_linked_data_p nr_seq_linked_data,
			nr_seq_apresent,
			(select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
			(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
			(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
   from     valor_dominio_v
   where    coalesce(ie_situacao,'A') = 'A'
   and      cd_dominio = 10224
   order by nr_seq_apresent;



c_level_3_ganhos_perdas CURSOR FOR
   SELECT   ds_expressao ds_descricao,
            vl_dominio ie_grupo_tipo,
            nr_seq_apresent
   from     valor_dominio_v
   where    coalesce(ie_situacao,'A')  = 'A'
   and      cd_dominio            = 9774
   order by nr_seq_apresent;

c_level_3_score_flex CURSOR FOR
   SELECT   ds_escala ds_descricao,
            nr_sequencia nr_seq_score_flex
   from     eif_escala_ii
   where    coalesce(ie_situacao,'A') = 'A'
   order by 1;

c_level_2_sinais_vitais CURSOR FOR
   SELECT  distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
           a.nr_seq_visao,
           a.nm_tabela,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
           linked_data_ativacao c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y
   where   a.nr_seq_visao = b.nr_sequencia
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and     a.nr_seq_linked_data  = y.nr_sequencia
   and     a.nr_seq_visao        = c.nr_seq_visao
   and     c.ie_grupo            = 'SV'
   and     c.nr_seq_linked_data  = x.nr_registro
   order by 1;


c_level_4_score_flex CURSOR FOR
   SELECT   substr(CASE WHEN coalesce(a.ds_grupo_atributo::text, '') = '' THEN a.ds_label  ELSE a.ds_label || ' (' ||a.ds_grupo_atributo|| ')' END ,1,2000) ds_descricao,
            a.nm_atributo_linked,
            a.nr_seq_linked_data
   from     table(localizador_subsecao_pck.get_linked_data(ds_lista_linked_w)) a
   where    upper(a.nm_table) = 'ESCALA_EIF_II'
   order by 1;

c_level_4_gp_oco_g CURSOR(ie_perda_ganho_p  text) FOR
   SELECT   distinct a.ds_grupo ds_descricao,
            a.nr_seq_grupo_pg
   from     table(get_ganhos_perdas) a
   where    a.ie_perda_ganho  = ie_perda_ganho_p
   and		a.ie_volume_ocorrencia = 'O'
   order by 1;

c_level_4_gp_vol_g CURSOR(ie_perda_ganho_p  text) FOR
   SELECT   distinct a.ds_grupo ds_descricao,
            a.nr_seq_grupo_pg
   from     table(get_ganhos_perdas) a
   where    a.ie_perda_ganho  = ie_perda_ganho_p
   and		a.ie_volume_ocorrencia in ('V','P')
   order by 1;


c_level_4_gp_oco_t CURSOR(ie_perda_ganho_p  text) FOR
   SELECT   a.ds_tipo || '('||a.ds_grupo||')' ds_descricao,
            a.nr_seq_tipo_pg,
            a.nr_seq_grupo_pg,
            a.ie_volume_ocorrencia
   from     table(get_ganhos_perdas) a
   where    a.ie_perda_ganho  = ie_perda_ganho_p
   and		a.ie_volume_ocorrencia = 'O'
   order by 1;

c_level_4_gp_vol_t CURSOR(ie_perda_ganho_p  text) FOR
   SELECT   a.ds_tipo || '('||a.ds_grupo||')' ds_descricao,
            a.nr_seq_tipo_pg,
            a.nr_seq_grupo_pg,
            a.ie_volume_ocorrencia
   from     table(get_ganhos_perdas) a
   where    a.ie_perda_ganho  = ie_perda_ganho_p
   and		a.ie_volume_ocorrencia in ('V','P')
   order by 1;


c_level_2_notas_clinicas CURSOR(nr_seq_linked_data_p  bigint) FOR
   SELECT   ds_tipo_evolucao ds_descricao,
            cd_tipo_evolucao ie_evolucao_clinica,
            (SELECT  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked,
            nr_seq_linked_data_p nr_seq_linked_data,
			(select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
			(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
			(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
   from     tipo_evolucao
   where    coalesce(ie_situacao,'A') = 'A'
   order by ds_tipo_evolucao;



c_level_2_templates CURSOR(nr_seq_linked_data_p  bigint) FOR
      
        SELECT 
            nr_sequencia IE_EVENTO_TIPO, 
            nr_sequencia nr_seq_tipo_registro,           
            ie_evolucao_clinica,
            nr_sequencia DS_EVENTO_TIPO,
            ds_template ds_descricao,
            (SELECT  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked,
            nr_seq_linked_data_p nr_seq_linked_data,
            (select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
			(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
			(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
        from EHR_TEMPLATE 
            
            where coalesce(dt_inativacao::text, '') = ''
            and (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
        order by ds_descricao asc;

            
c_level_2_obstetricia CURSOR FOR
   SELECT  distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
           a.nr_seq_visao,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
           linked_data_ativacao c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y
   where   a.nr_seq_visao = b.nr_sequencia
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and     a.nr_seq_linked_data  = y.nr_sequencia
   and     a.nr_seq_visao        = c.nr_seq_visao
   and     c.ie_grupo            = 'OB'
   and     c.nr_seq_linked_data  = x.nr_registro
   order by 1;

c_level_2_bundle CURSOR FOR
   SELECT   distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
            a.nm_atributo_linked nm_atributo,
            a.nm_atributo_linked,
            c.ie_informacao,
            d.nr_seq_apresent,
            a.nr_seq_visao,
            a.nr_seq_linked_data,
			coalesce(y.ie_chart_view,'N') ie_chart_view,
			coalesce(y.ie_timeline_view,'N') ie_timeline_view,
			coalesce(y.ie_grid_view,'S') ie_grid_view
   from     linked_data_atributo a,
            tabela_visao b,
            linked_data_ativacao c,
            valor_dominio_v d,
            table(lista_pck.obter_lista(ds_lista_linked_w)) x,
			linked_data y
   where    a.nr_seq_visao        = b.nr_sequencia
   and      a.nr_seq_visao        = c.nr_seq_visao
   and      a.nr_seq_linked_data  = c.nr_seq_linked_data
   and		a.nr_seq_linked_data  = y.nr_sequencia	
   and      a.ie_visivel_cliente  = 'S'
   and      a.nr_seq_linked_data  = x.nr_registro
   and      c.ie_informacao       = d.vl_dominio
   and      d.cd_dominio          = 9778
   and      c.ie_grupo            = 'CB'
   and      a.nm_tabela           = 'W_APAP_TOTAL'   
   order by d.nr_seq_apresent;

c_level_2_disp CURSOR FOR
   SELECT   distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
            a.nm_atributo_linked nm_atributo,
            a.nm_atributo_linked,
            c.ie_informacao,
            d.nr_seq_apresent,
            a.nr_seq_visao,
            a.nr_seq_linked_data,
			coalesce(y.ie_chart_view,'N') ie_chart_view,
			coalesce(y.ie_timeline_view,'N') ie_timeline_view,
			coalesce(y.ie_grid_view,'S') ie_grid_view
   from     linked_data_atributo a,
            tabela_visao b,
            linked_data_ativacao c,
            valor_dominio_v d,
            table(lista_pck.obter_lista(ds_lista_linked_w)) x,
			linked_data y
   where    a.nr_seq_visao        = b.nr_sequencia
   and      a.nr_seq_visao        = c.nr_seq_visao
   and      a.nr_seq_linked_data  = c.nr_seq_linked_data
   and		a.nr_seq_linked_data  = y.nr_sequencia
   and      a.ie_visivel_cliente  = 'S'
   and      a.nr_seq_linked_data  = x.nr_registro
   and      c.ie_informacao       = d.vl_dominio
   and      d.cd_dominio          = 9778
   and      c.ie_grupo            = 'D'
   and      a.nm_tabela           = 'W_APAP_TOTAL'   
   order by d.nr_seq_apresent;


c_level_2_prescricao CURSOR FOR
   SELECT   distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
            a.nm_atributo_linked nm_atributo,
            a.nm_atributo_linked,
            c.ie_informacao,
            d.nr_seq_apresent,
            a.nr_seq_visao,
            a.nr_seq_linked_data,
			coalesce(y.ie_chart_view,'N') ie_chart_view,
			coalesce(y.ie_timeline_view,'N') ie_timeline_view,
			coalesce(y.ie_grid_view,'S') ie_grid_view
   from     linked_data_atributo a,
            tabela_visao b,
            linked_data_ativacao c,
            valor_dominio_v d,
            table(lista_pck.obter_lista(ds_lista_linked_w)) x,
			linked_data y
   where    a.nr_seq_visao        = b.nr_sequencia
   and      a.nr_seq_visao        = c.nr_seq_visao
   and      a.nr_seq_linked_data  = c.nr_seq_linked_data
   and      a.nr_seq_linked_data  = y.nr_sequencia
   and      a.ie_visivel_cliente  = 'S'
   and      a.nr_seq_linked_data  = x.nr_registro
   and      c.ie_informacao       = d.vl_dominio
   and      d.cd_dominio          = 9778
   and      c.ie_grupo            = 'OR'
   and      a.nm_tabela           = 'W_APAP_TOTAL'
   
union

   SELECT   distinct obter_desc_expressao(b.CD_EXP_TITULO) ds_descricao,
            null nm_atributo,
            null nm_atributo_linked,
            c.ie_informacao,
            d.nr_seq_apresent,
            a.nr_seq_visao,
            a.nr_seq_linked_data,
			coalesce(y.ie_chart_view,'N') ie_chart_view,
			coalesce(y.ie_timeline_view,'N') ie_timeline_view,
			coalesce(y.ie_grid_view,'S') ie_grid_view
   from     linked_data_atributo a,
            tabela_visao b,
            linked_data_ativacao c,
            valor_dominio_v d,
            table(lista_pck.obter_lista(ds_lista_linked_w)) x,
			linked_data y
   where    a.nr_seq_visao        = b.nr_sequencia
   and      a.nr_seq_visao        = c.nr_seq_visao
   and      a.nr_seq_linked_data  = c.nr_seq_linked_data
   and      a.nr_seq_linked_data  = y.nr_sequencia
   and      a.ie_visivel_cliente  = 'S'
   and      a.nr_seq_linked_data  = x.nr_registro
   and      c.ie_informacao       = d.vl_dominio
   and      d.cd_dominio          = 9778
   and      c.ie_grupo            = 'OR'
   and      a.nm_tabela           <> 'W_APAP_TOTAL'
   order by nr_seq_apresent;

c_atributos CURSOR(nr_seq_visao_p  bigint) FOR
   SELECT   substr(CASE WHEN coalesce(a.ds_grupo_atributo::text, '') = '' THEN a.ds_label  ELSE a.ds_label || ' (' ||a.ds_grupo_atributo||')' END ,1,2000) ds_descricao,
            a.nm_atributo_linked,
            a.nr_seq_linked_data,
            a.nm_atributo,
			a.nr_seq_atributo,
			a.ie_composto_tree,
			a.ie_tipo_agrupamento_padrao,
			a.ie_chart_view,
			a.ie_timeline_view,
			a.ie_grid_view
   from     table(localizador_subsecao_pck.get_linked_data(ds_lista_linked_w)) a,
            table(lista_pck.obter_lista(ds_lista_linked_w)) x
   where    a.nr_seq_linked_data    = x.nr_registro
   and      a.nr_seq_vision         = nr_seq_visao_p
   order by 1;

c_level_3_ficha CURSOR FOR
   SELECT   distinct ds_substancia ds_descricao,
            nr_seq_ficha_tecnica nr_ficha_tecnica
   from     table(get_materiais) a
   order by 1;

c_level_3_gasoterapia CURSOR FOR
   SELECT   ds_gas ds_descricao,
            nr_sequencia nr_seq_gas
   from     gas
   where    coalesce(ie_situacao,'A')    = 'A'
   order by 1;

c_level_3_itens_admin CURSOR FOR
   SELECT    ds_expressao ds_descricao,
             vl_dominio ie_modo,
             nr_seq_apresent
   from      valor_dominio_v
   where     coalesce(ie_situacao,'A')    = 'A'
   and       cd_dominio              = 9776
   order by  nr_seq_apresent;

c_level_3_elementos CURSOR(nr_seq_linked_data_p  bigint) FOR
   SELECT	ds_expressao ds_descricao,
            vl_dominio ie_tipo_elemento,
			(SELECT  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked,
			nr_seq_linked_data_p nr_seq_linked_data,
            nr_seq_apresent
   from     valor_dominio_v
   where    coalesce(ie_situacao,'A')    = 'A'
   and      cd_dominio              = 2159
   order by  nr_seq_apresent,ds_expressao;


c_level_4_itens_admin_grupo CURSOR(ie_informacao_p  text) FOR
   SELECT   distinct ds_grupo_material ds_descricao,
            cd_grupo_material
   from     table(get_materiais) a
   order by 1;

c_level_4_itens_admin_subgrupo CURSOR(ie_informacao_p  text) FOR
   SELECT   distinct ds_subgrupo_material ds_descricao,
            cd_grupo_material,
            cd_subgrupo_material
   from     table(get_materiais) a
   order by 1;

c_level_4_itens_admin_classe CURSOR(ie_informacao_p  text) FOR
   SELECT   distinct ds_classe_material ds_descricao,
            cd_grupo_material,
            cd_subgrupo_material,
            cd_classe_material
   from     table(get_materiais) a
   order by 1;

c_level_4_itens_admin_ficha CURSOR(ie_informacao_p  text) FOR
   SELECT   distinct ds_substancia ds_descricao,
            nr_seq_ficha_tecnica nr_ficha_tecnica
   from     table(get_materiais) a
   order by 1;

c_level_4_itens_admin_material CURSOR(ie_informacao_p  text) FOR
   SELECT   distinct ds_material ds_descricao,
            cd_grupo_material,
            cd_subgrupo_material,
            cd_classe_material,
            cd_material
   from     table(get_materiais) a
   order by 1;

c_level_2_grupo_exames CURSOR(nr_seq_linked_data_p  linked_data.nr_sequencia%type) FOR
	SELECT	distinct	
			a.nr_sequencia,
			a.ds_grupo_exame_lab ds_descricao,
			a.nr_seq_apresent,
			a.ds_grupo_exame_lab,
			nr_seq_linked_data_p nr_seq_linked_data,
			(SELECT	coalesce(max(ie_chart_view),'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
			(select	coalesce(max(ie_timeline_view),'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
			(select	coalesce(max(ie_grid_view),'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
	FROM grupo_exame_lab a
LEFT OUTER JOIN exame_laboratorio b ON (a.nr_sequencia = b.nr_seq_grupo)
WHERE coalesce(a.nr_seq_superior::text, '') = ''  and coalesce(a.ie_exibe_exame_lab,'S') = 'S' and coalesce(b.ie_situacao,'A') = 'A' and b.ie_formato_resultado not in ('CA','XPTO') and ((to_char(current_setting('localizador_subsecao_pck.ie_param_24_w')::varchar(15)) is null) OR (obter_se_contido(a.nr_sequencia,current_setting('localizador_subsecao_pck.ie_param_24_w')::varchar(15)) = 'S')) ORDER BY	CASE	WHEN current_setting('localizador_subsecao_pck.ie_param_18_w')::varchar(15) = 'S' 	THEN a.nr_seq_apresent END,
				CASE	WHEN current_setting('localizador_subsecao_pck.ie_param_18_w')::varchar(15) = 'N'	then a.ds_grupo_exame_lab END;
	
/*	
cursor   c_level_3_grupo_exames (nr_seq_superior_p	in number) is
	SELECT	distinct	
			a.nr_sequencia nr_seq_grupo,
			a.ds_grupo_exame_lab ds_descricao,
			a.nr_seq_apresent,
			a.ds_grupo_exame_lab
	FROM	grupo_exame_lab a
	WHERE 	a.nr_seq_superior = nr_seq_superior_p
	and 	nvl(a.ie_exibe_exame_lab,'S') = 'S' 
	ORDER BY	CASE	WHEN ie_param_18_w = 'S' 	THEN a.nr_seq_apresent END,
				CASE	WHEN ie_param_18_w = 'N'	then a.ds_grupo_exame_lab END;
*/
c_level_3_grupo_exames CURSOR(nr_seq_superior_p	 bigint) FOR
	SELECT  a.nr_sequencia,
			ds_grupo_exame_lab ds_descricao,
			'G' ie_tipo,
			null nr_seq_exame,
			null nm_atributo_linked,
			null nr_seq_atributo,
			null ie_formato_resultado
	FROM	grupo_exame_lab a
	WHERE   nr_seq_superior = nr_seq_superior_p
	AND	    (nr_seq_superior IS NOT NULL AND nr_seq_superior::text <> '')
	
UNION

	SELECT  nr_seq_exame nr_sequencia,
			nm_exame ds_descricao,
			'E' ie_tipo,
			a.nr_seq_exame,
			'NM_COMPOSTO_EXAME_374' nm_atributo_linked,
			5826 nr_seq_atributo,
			a.ie_formato_resultado
	FROM	exame_laboratorio a
	WHERE   nr_seq_grupo = nr_seq_superior_p
	AND	    coalesce(nr_seq_superior::text, '') = ''
	and		coalesce(a.ie_situacao,'A') = 'A'
	and     a.ie_formato_resultado not in ('CA','XPTO')
	AND	    ((	current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'E' and
				a.cd_estabelecimento = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) OR 
				(current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'S' AND ((coalesce(cd_estabelecimento,0) = 0) OR (coalesce(cd_estabelecimento,0) = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type))) OR (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'N'))
	ORDER BY ie_tipo DESC,ds_descricao ASC;
				
c_level_4_grupo_exames CURSOR(nr_seq_superior_p	 bigint, nr_seq_exame_p  bigint) FOR
	SELECT	a.nr_sequencia,
			ds_grupo_exame_lab ds_descricao,
			'G' ie_tipo,
			null nr_seq_exame,
			null nm_atributo_linked,
			null nr_seq_atributo,
			null ie_formato_resultado
	FROM	grupo_exame_lab a
	WHERE 	nr_seq_superior = nr_seq_superior_p
	AND		(nr_seq_superior IS NOT NULL AND nr_seq_superior::text <> '')
	
UNION

	SELECT	nr_seq_grupo,
			nm_exame ds_descricao,
			'E' ie_tipo,
			a.nr_seq_exame,
			'NM_COMPOSTO_EXAME_374' nm_atributo_linked,
			5826 nr_seq_atributo,
			a.ie_formato_resultado
	FROM	exame_laboratorio a
	WHERE 	nr_seq_grupo = nr_seq_superior_p
	AND		coalesce(nr_seq_superior::text, '') = ''
	and		coalesce(nr_seq_exame_p::text, '') = ''
	and		coalesce(a.ie_situacao,'A') = 'A'
	and     a.ie_formato_resultado not in ('CA','XPTO')
	AND	    ((	current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'E' and
				a.cd_estabelecimento = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) OR 
				(current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'S' AND ((coalesce(cd_estabelecimento,0) = 0) OR (coalesce(cd_estabelecimento,0) = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type))) OR (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'N'))
	
union
			
	SELECT	nr_seq_grupo,
			nm_exame||' ('||Obter_Desc_Exame(nr_seq_exame_p)||')' ds_descricao,
			'E' ie_tipo,
			a.nr_seq_exame,
			'NM_COMPOSTO_EXAME_374' nm_atributo_linked,
			5826 nr_seq_atributo,
			a.ie_formato_resultado
	FROM	exame_laboratorio a
	WHERE 	nr_seq_superior  = nr_seq_exame_p
	and		coalesce(a.ie_situacao,'A') = 'A'
	and     a.ie_formato_resultado not in ('CA','XPTO')
	AND	    ((	current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'E' and 
				a.cd_estabelecimento = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) OR 
				(current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'S' AND ((coalesce(cd_estabelecimento,0) = 0) OR (coalesce(cd_estabelecimento,0) = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type))) OR (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'N'))
	ORDER BY ie_tipo DESC,ds_descricao ASC;

	
c_level_5_grupo_exames CURSOR(nr_seq_superior_p	 bigint, nr_seq_exame_p  bigint) FOR
	/*
	SELECT	nr_sequencia nr_seq_grupo,
			ds_grupo_exame_lab ds_descricao,
			'G' ie_tipo
	FROM	grupo_exame_lab a
	WHERE	nr_seq_superior = nr_seq_superior_p
	AND		ie_tipo_p = 'G'
	UNION	
	/*EXAME*/

	SELECT	nr_seq_exame,
			nm_exame ds_descricao,
			'NM_COMPOSTO_EXAME_374' nm_atributo_linked,
			5826 nr_seq_atributo,
			a.ie_formato_resultado
	FROM	exame_laboratorio a
	WHERE	nr_seq_grupo = nr_seq_superior_p
	AND		coalesce(nr_seq_superior::text, '') = ''
	and		coalesce(a.ie_situacao,'A') = 'A'
	and		coalesce(nr_seq_exame_p::text, '') = ''
	and     a.ie_formato_resultado not in ('CA','XPTO')
	AND	    ((	current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'E' and 
				a.cd_estabelecimento = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) OR 
				(current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'S' AND ((coalesce(cd_estabelecimento,0) = 0) OR (coalesce(cd_estabelecimento,0) = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type))) OR (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'N'))
	ORDER BY ds_descricao ASC;

	/*
	SELECT	distinct	
			a.nr_sequencia nr_seq_grupo,
			a.ds_grupo_exame_lab ds_descricao,
			a.nr_seq_apresent,
			a.ds_grupo_exame_lab
	FROM	grupo_exame_lab a
	WHERE 	a.nr_seq_superior = nr_seq_superior_p
	and 	nvl(a.ie_exibe_exame_lab,'S') = 'S' 
	ORDER BY	CASE	WHEN ie_param_18_w = 'S' 	THEN a.nr_seq_apresent END,
				CASE	WHEN ie_param_18_w = 'N'	then a.ds_grupo_exame_lab END;
	*/
				
				
/*
   select  distinct b.DS_GRUPO_EXAME_LAB ds_descricao,
           b.nr_sequencia nr_seq_grupo
   from    EXAME_LABORATORIO a,
           GRUPO_EXAME_LAB b
   where   a.nr_seq_grupo = b.nr_sequencia
   and     nvl(a.ie_situacao,'A') = 'A'
   union
   select  obter_desc_expressao(342888) ds_descricao,
           0 nr_seq_grupo
   from    dual
   where   exists (select 1 from EXAME_LABORATORIO a where nvl(a.ie_situacao,'A') = 'A' and a.nr_seq_grupo is null)
   order by 1;
*/
c_exames CURSOR(nr_seq_grupo_p  bigint) FOR
   SELECT  	nr_seq_exame,
			nm_exame ds_descricao,
			lab_obter_tipo_result_exame(null,nr_seq_exame) ie_formato_resultado
   from    	exame_laboratorio
   where   	coalesce(nr_seq_grupo,0) = nr_seq_grupo_p
   and     	coalesce(ie_situacao,'A') = 'A'
   and     	coalesce(lab_obter_tipo_result_exame(null,nr_seq_exame),'XPTO') not in ('CA','XPTO')
   and		coalesce(nr_seq_superior::text, '') = ''
   AND		((current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'E' AND	cd_estabelecimento = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type) OR 
			 (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'S' AND	((coalesce(cd_estabelecimento,0) = 0) OR (coalesce(cd_estabelecimento,0) = current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type))) OR (current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15) = 'N'))
   order by 2;


c_level_2_glicemia CURSOR FOR
   SELECT  distinct obter_desc_expressao(b.cd_exp_titulo) ds_descricao,
           a.nr_seq_visao,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
           linked_data_ativacao c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y
   where   a.nr_seq_visao = b.nr_sequencia
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and     a.nr_seq_linked_data  = y.nr_sequencia
   and     a.nr_seq_visao        = c.nr_seq_visao
   and     c.ie_grupo            = 'GL'
   and     c.nr_seq_linked_data  = x.nr_registro
   order by 1;

c_level_2_dias CURSOR FOR
   SELECT  distinct  a.nm_atributo_linked,
           a.nr_seq_visao,
           a.nm_atributo,
           a.nr_seq_linked_data,
		   coalesce(y.ie_chart_view,'N') ie_chart_view,
		   coalesce(y.ie_timeline_view,'N') ie_timeline_view,
		   coalesce(y.ie_grid_view,'S') ie_grid_view
   from    linked_data_atributo a,
           tabela_visao b,
           linked_data_ativacao c,
           table(lista_pck.obter_lista(ds_lista_linked_w)) x,
		   linked_data y
   where   a.nr_seq_visao = b.nr_sequencia
   and     a.nr_seq_linked_data  = c.nr_seq_linked_data
   and     a.nr_seq_linked_data  = y.nr_sequencia
   and     a.nr_seq_visao        = c.nr_seq_visao
   and     c.ie_grupo            = 'DI'
   and     c.nr_seq_linked_data  = x.nr_registro
   order by 1;

   c_cp_level2 CURSOR(nr_seq_linked_data_p  linked_data.nr_sequencia%type) FOR
SELECT b.NR_SEQUENCIA CD_GRUPO,
    b.DS_GRUPO ds_descricao,
	nr_seq_linked_data_p nr_seq_linked_data,
	(SELECT	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
	(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
	(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
FROM PE_GRUPO_DIAGNOSTICO b
ORDER BY b.DS_GRUPO;

c_cp_level3 CURSOR(CD_GRUPO_P  bigint, nr_seq_linked_data_p  bigint) FOR
SELECT 
    NR_SEQUENCIA IE_EVENTO_TIPO,
    NR_SEQUENCIA nr_seq_diagnostico,
    null ie_evolucao_clinica,
    NR_SEQUENCIA DS_EVENTO_TIPO,    
    DS_DIAGNOSTICO ds_descricao,
    (SELECT  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked,    
    nr_seq_linked_data_p nr_seq_linked_data,
	(select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
	(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
	(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
FROM PE_DIAGNOSTICO a
WHERE
    nr_seq_grupo = CD_GRUPO_P 
ORDER BY 
    DS_DIAGNOSTICO;

c_cp_level2_Outros CURSOR(nr_seq_linked_data_p  linked_data.nr_sequencia%type) FOR
SELECT 	obter_desc_expressao(295064) ds_descricao,
		nr_seq_linked_data_p nr_seq_linked_data,
		(select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
		(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
		(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
;

c_cp_level3_Diag_Outros CURSOR(nr_seq_linked_data_p  bigint) FOR
SELECT
    NR_SEQUENCIA IE_EVENTO_TIPO,
    NR_SEQUENCIA CD_DIAG,
    DS_DIAGNOSTICO ds_descricao,
    nr_seq_linked_data_p nr_seq_linked_data,
    (select  max(b.nm_atributo_linked) from linked_data_atributo b where b.nr_seq_linked_data = nr_seq_linked_data_p and b.ie_visivel_cliente = 'S') nm_atributo_linked, 
    DS_DEFINICAO,
	(select	coalesce(ie_chart_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_chart_view,
	(select	coalesce(ie_timeline_view,'N') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_timeline_view,
	(select	coalesce(ie_grid_view,'S') from	linked_data where nr_sequencia = nr_seq_linked_data_p) ie_grid_view
FROM PE_DIAGNOSTICO a
WHERE  coalesce(a.nr_seq_grupo::text, '') = '' 
ORDER BY 
    DS_DIAGNOSTICO;


c_lista_linked_data CURSOR FOR
	SELECT	a.nr_sequencia nr_seq_linked_data
	from 	linked_data a
	where	a.ie_apap = 'S';
	/*
	and		decode(ie_chart_view_w,'S',nvl(a.ie_chart_view,'S'),'S') = 'S'
	and		decode(ie_timeline_view_w,'S',nvl(a.ie_timeline_view,'S'),'S') = 'S'
	and		decode(ie_grid_view_w,'S',nvl(a.ie_grid_view,'S'),'S') = 'S'
	and 	(not exists (select 1 from LINKED_DATA_ACESSO_LOC l where pkg_i18n.get_user_locale() = l.ds_locale) or
			(exists (select 1 from LINKED_DATA_ACESSO_LOC l where pkg_i18n.get_user_locale() = l.ds_locale) and
			exists (select 1 from LINKED_DATA_ACESSO_LOC l where pkg_i18n.get_user_locale() = l.ds_locale and a.nr_sequencia = l.nr_seq_linked_data)));
	*/
BEGIN
/*
if	(nr_seq_documento_secao_p is not null) then
	select	nvl(max(ie_chart_view),'N'),
			nvl(max(ie_timeline_view),'N'),
			nvl(max(ie_grid_view),'S')
	into	ie_chart_view_w,
			ie_timeline_view_w,
			ie_grid_view_w
	from	documento_secao
	where	nr_sequencia = nr_seq_documento_secao_p;
end if;
*/
obter_param_usuario(746, 18, wheb_usuario_pck.get_cd_perfil, current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type, current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('localizador_subsecao_pck.ie_param_18_w')::varchar(15));
obter_param_usuario(746, 23, wheb_usuario_pck.get_cd_perfil, current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type, current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('localizador_subsecao_pck.ie_param_23_w')::varchar(15));
obter_param_usuario(746, 24, wheb_usuario_pck.get_cd_perfil, current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type, current_setting('localizador_subsecao_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('localizador_subsecao_pck.ie_param_24_w')::varchar(15));

if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP') then
	<<read_linked>>
	for r_linked_data in c_linked_data
	   loop
	   if (coalesce(ds_lista_linked_w::text, '') = '') then
		  ds_lista_linked_w := r_linked_data.nr_seq_linked_data;
	   else
		  ds_lista_linked_w := ds_lista_linked_w||','||r_linked_data.nr_seq_linked_data;
	   end if;
	   end loop read_linked;
else
	<<read_linked>>
	for r_lista_linked_data in c_lista_linked_data
	   loop
	   if (coalesce(ds_lista_linked_w::text, '') = '') then
		  ds_lista_linked_w := r_lista_linked_data.nr_seq_linked_data;
	   else
		  ds_lista_linked_w := ds_lista_linked_w||','||r_lista_linked_data.nr_seq_linked_data;
	   end if;
	   end loop read_linked;
end if;

nr_indice_w := 0;

<<read_conteudo_template>>
for r_conteudo_template in c_conteudo_template
	loop
	if (nr_indice_w = 0) then
		ds_descricao_w	:= substr(r_conteudo_template.ds_template,1,255);
		nr_indice_w := nr_indice_w + 1;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
		nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao           := ds_descricao_w;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura           := ds_descricao_w;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data     := null;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_template     	 := nr_seq_template_p;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel               := 1;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia           := nr_indice_w;
		current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
		nr_seq_superior_1_w                              := nr_indice_w;
	end if;
	nr_indice_w := nr_indice_w + 1;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
	nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao         	:= r_conteudo_template.ds_descricao;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_atributo          	:= r_conteudo_template.nm_atrib_cliente;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_temp_conteudo	:= r_conteudo_template.nr_seq_temp_conteudo;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_template     	:= nr_seq_template_p;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura         	:= ds_descricao_w||' -> '||r_conteudo_template.ds_descricao;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_apresent      	:= 0;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data   	:= nr_seq_linked_data_p;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel             	:= 2;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia         	:= nr_indice_w;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_superior      	:= nr_seq_superior_1_w;
	current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario            := wheb_usuario_pck.get_nm_usuario;
	end loop	read_conteudo_template;

<<read_level_1>>
for r_level_1 in c_level_1
   loop
   nr_indice_w := nr_indice_w + 1;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
   nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao           := r_level_1.ds_descricao;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data     := null;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel               := 1;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia           := nr_indice_w;
   current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
   nr_seq_superior_1_w                              := nr_indice_w;
   if (r_level_1.ie_grupo = 'TC') then
		<<read_level_2>>	
		for r_level_2 in c_template_insercao
			loop
			nr_indice_w := nr_indice_w + 1;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
			nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao         := r_level_2.ds_descricao;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura         := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_apresent      := r_level_2.nr_seq_apresent;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data   := 650;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grupo 			:= r_level_1.ie_grupo;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel             	:= 2;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia         := nr_indice_w;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_superior      := nr_seq_superior_1_w;
			current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario           := wheb_usuario_pck.get_nm_usuario;
			nr_seq_superior_2_w							   := nr_indice_w;	
			<<read_level_3>>
			for r_level_3 in c_elemento_insercao(r_level_2.nr_sequencia)
				loop
				nr_indice_w := nr_indice_w + 1;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
				nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_apresent        := r_level_3.nr_seq_apres;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_temp_conteudo	 := r_level_3.nr_seq_temp_conteudo;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_template     	 := r_level_2.nr_sequencia;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_atributo        := r_level_3.nr_seq_atributo;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_composto_tree       := r_level_3.ie_composto_tree;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data     := 650;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grupo 			   	 := r_level_1.ie_grupo;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel               := 3;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia           := nr_indice_w;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
				current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
				end loop read_level_3;
			end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'BH') then
      <<read_level_2>>
      for r_level_2 in c_level_2_bh
         loop
         nr_indice_w := nr_indice_w + 1;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
         nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao         := r_level_2.ds_descricao;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_atributo          := r_level_2.nm_atributo_linked;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura         := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_apresent      := r_level_2.nr_seq_apresent;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data   := r_level_2.nr_seq_linked_data;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grupo 			:= r_level_1.ie_grupo;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel             := 2;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia         := nr_indice_w;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_superior      := nr_seq_superior_1_w;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario           := wheb_usuario_pck.get_nm_usuario;
         end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'ES') then
      <<read_level_2>>
      for r_level_2 in c_level_2_escalas
         loop
         nr_indice_w := nr_indice_w + 1;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
         nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ie_grupo 			  := r_level_1.ie_grupo;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_nivel               := 2;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_sequencia           := nr_indice_w;
         current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
		 current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                                      := nr_indice_w;
         if (r_level_2.nm_tabela = 'ESCALA_EIF_II') then
            <<read_level_3>>
            for r_level_3 in c_level_3_score_flex
               loop
               nr_indice_w := nr_indice_w + 1;
               current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.extend(1);
               nr_indice_ww   := current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t.count;
               current_setting('localizador_subsecao_pck.estrutura_w')::estrutura_t[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nr_seq_score_flex      := r_level_3.nr_seq_score_flex;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			   estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			   estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			   estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               nr_seq_superior_3_w                                      := nr_indice_w;
               <<read_level_4>>
               for r_level_4 in c_level_4_score_flex
                  loop
                  nr_indice_w := nr_indice_w + 1;
                  estrutura_w.extend(1);
                  nr_indice_ww   := estrutura_w.count;
                  estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                  estrutura_w[nr_indice_ww].nm_atributo            := r_level_4.nm_atributo_linked;
                  estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                  estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_4.nr_seq_linked_data;
				  estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
				  estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			      estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
				  estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
                  estrutura_w[nr_indice_ww].nr_seq_linked_data     := nr_seq_linked_data_p;
				  estrutura_w[nr_indice_ww].ie_grupo 			   := r_level_1.ie_grupo;
                  estrutura_w[nr_indice_ww].nr_nivel               := 4;
                  estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                  estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
				  estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                  end loop read_level_4;
               end loop read_level_3;
         else
            <<read_level_3>>
            for r_level_3 in c_atributos(r_level_2.nr_seq_visao)
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_3.nr_seq_linked_data;
			   estrutura_w[nr_indice_ww].ie_chart_view          := r_level_3.ie_chart_view;
			   estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_3.ie_timeline_view;
			   estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_3.ie_grid_view;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nr_seq_atributo        := r_level_3.nr_seq_atributo;
			   estrutura_w[nr_indice_ww].ie_composto_tree       := r_level_3.ie_composto_tree;
			   estrutura_w[nr_indice_ww].ie_tipo_agrupamento	:= r_level_3.ie_tipo_agrupamento_padrao;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               end loop read_level_3;
         end if;
         end loop read_level_2;
	elsif (r_level_1.ie_grupo = 'D') then
		<<read_level_2>>
		for r_level_2 in c_level_2_disp
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;
			estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
			estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].ie_grupo 				 := r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].nr_nivel               := 2;
			estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
			nr_seq_superior_2_w                              := nr_indice_w;
			end loop read_level_2;
	elsif (r_level_1.ie_grupo = 'CB') then
		<<read_level_2>>
		for r_level_2 in c_level_2_bundle
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;
			estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
			estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].ie_grupo 				 := r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].nr_nivel               := 2;
			estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
			nr_seq_superior_2_w                              := nr_indice_w;
			end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'OR') then
      <<read_level_2>>
      for r_level_2 in c_level_2_prescricao
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
         estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
		 estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
		 estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
		 estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 			  := r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_nivel               := 2;
         estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
		 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                              := nr_indice_w;
		 if (r_level_2.ie_informacao = 'ENUT') then
			<<read_level_3>>
            for r_level_3 in c_level_3_elementos(r_level_2.nr_seq_linked_data)
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
               estrutura_w[nr_indice_ww].ie_tipo_elemento       := r_level_3.ie_tipo_elemento;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			   estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			   estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			   estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               end loop read_level_3;
         elsif (r_level_2.ie_informacao = 'DE') then
            <<read_level_3>>
            for r_level_3 in c_level_3_ficha
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
               estrutura_w[nr_indice_ww].nr_ficha_tecnica       := r_level_3.nr_ficha_tecnica;
               estrutura_w[nr_indice_ww].ie_wdlg                := 'UM';
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
				estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               end loop read_level_3;
         elsif (r_level_2.ie_informacao = 'PCA') then
            <<read_level_3>>
            for r_level_3 in c_atributos(r_level_2.nr_seq_visao)
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_3.nr_seq_linked_data;
				estrutura_w[nr_indice_ww].ie_chart_view         := r_level_3.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_3.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_3.ie_grid_view;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
               estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nr_seq_atributo        := r_level_3.nr_seq_atributo;
			   estrutura_w[nr_indice_ww].ie_composto_tree       := r_level_3.ie_composto_tree;
			   estrutura_w[nr_indice_ww].ie_tipo_agrupamento	:= r_level_3.ie_tipo_agrupamento_padrao;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               end loop read_level_3;
         elsif (r_level_2.ie_informacao = 'GA') then
            <<read_level_3>>
            for r_level_3 in c_level_3_gasoterapia
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
               estrutura_w[nr_indice_ww].nr_seq_gas             := r_level_3.nr_seq_gas;
               estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
				estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               end loop read_level_3;
         elsif (r_level_2.ie_informacao in ('IA','IP')) then
            <<read_level_3>>
            for r_level_3 in c_level_3_itens_admin
               loop
               nr_indice_w := nr_indice_w + 1;
               estrutura_w.extend(1);
               nr_indice_ww   := estrutura_w.count;
               estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
               estrutura_w[nr_indice_ww].nr_seq_apresent        := r_level_3.nr_seq_apresent;
               estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
				estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
			   estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			   estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
               estrutura_w[nr_indice_ww].nr_nivel               := 3;
               estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
               estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
               nr_seq_superior_3_w                                      := nr_indice_w;
			   estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
               if (r_level_3.ie_modo = 'G') then
                  <<read_level_4>>
                  for r_level_4 in c_level_4_itens_admin_grupo(r_level_2.ie_informacao)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
					 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					 estrutura_w[nr_indice_ww].ie_grupo 			  := r_level_1.ie_grupo;
                     estrutura_w[nr_indice_ww].cd_grupo_material      := r_level_4.cd_grupo_material;
                     estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
                     estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
                     estrutura_w[nr_indice_ww].nr_nivel               := 4;
                     estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                     estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                     end loop read_level_4;
               elsif (r_level_3.ie_modo = 'S') then
                  <<read_level_4>>
                  for r_level_4 in c_level_4_itens_admin_subgrupo(r_level_2.ie_informacao)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
                     estrutura_w[nr_indice_ww].cd_subgrupo_material   := r_level_4.cd_subgrupo_material;
					 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                     estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
                     estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
                     estrutura_w[nr_indice_ww].nr_nivel               := 4;
                     estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                     estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                     end loop read_level_4;
               elsif (r_level_3.ie_modo = 'C') then
                  <<read_level_4>>
                  for r_level_4 in c_level_4_itens_admin_classe(r_level_2.ie_informacao)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
					 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                     estrutura_w[nr_indice_ww].cd_classe_material     := r_level_4.cd_classe_material;
                     estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
					 estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
					 estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
					 estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
                     estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
                     estrutura_w[nr_indice_ww].nr_nivel               := 4;
                     estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                     estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                     end loop read_level_4;
               elsif (r_level_3.ie_modo = 'F') then
                  <<read_level_4>>
                  for r_level_4 in c_level_4_itens_admin_ficha(r_level_2.ie_informacao)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
					 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                     estrutura_w[nr_indice_ww].nr_ficha_tecnica       := r_level_4.nr_ficha_tecnica;
                     estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
                     estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
                     estrutura_w[nr_indice_ww].nr_nivel               := 4;
                     estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                     estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                     end loop read_level_4;
               elsif (r_level_3.ie_modo = 'M') then
                  <<read_level_4>>
                  for r_level_4 in c_level_4_itens_admin_material(r_level_2.ie_informacao)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
					 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                     estrutura_w[nr_indice_ww].cd_material            := r_level_4.cd_material;
                     estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
                     estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
                     estrutura_w[nr_indice_ww].ie_informacao          := r_level_2.ie_informacao;
                     estrutura_w[nr_indice_ww].nr_nivel               := 4;
                     estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
                     estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
                     end loop read_level_4;
               end if;
               end loop read_level_3;
         end if;
         end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'SV') then
      <<read_level_2>>
      for r_level_2 in c_level_2_sinais_vitais
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao         := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].ds_estrutura         := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nr_seq_linked_data   := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_nivel             := 2;
         estrutura_w[nr_indice_ww].nr_sequencia         := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior      := nr_seq_superior_1_w;
		 estrutura_w[nr_indice_ww].nm_usuario           := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                            := nr_indice_w;
         <<read_level_3>>
         for r_level_3 in c_atributos(r_level_2.nr_seq_visao)
            loop
            nr_indice_w := nr_indice_w + 1;
            estrutura_w.extend(1);
            nr_indice_ww   := estrutura_w.count;
            estrutura_w[nr_indice_ww].ds_descricao			:= r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nm_atributo           := r_level_3.nm_atributo_linked;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
            estrutura_w[nr_indice_ww].ds_estrutura          := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
			estrutura_w[nr_indice_ww].ie_aparelho_pa		:= null;
			if (r_level_2.nr_seq_linked_data = 533) then
				estrutura_w[nr_indice_ww].ie_aparelho_pa		:= 'C';
			end if;	
			if (r_level_3.nm_atributo_linked = 'NM_COMPOSTO_PAI_533') then
				estrutura_w[nr_indice_ww].ie_aparelho_pa	:= 'I';
			end if;	
            estrutura_w[nr_indice_ww].nr_seq_linked_data    := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
            estrutura_w[nr_indice_ww].nr_nivel              := 3;
            estrutura_w[nr_indice_ww].nr_sequencia          := nr_indice_w;
            estrutura_w[nr_indice_ww].nr_seq_superior       := nr_seq_superior_2_w;
			estrutura_w[nr_indice_ww].nr_seq_atributo       := r_level_3.nr_seq_atributo;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].ie_composto_tree      := r_level_3.ie_composto_tree;
			estrutura_w[nr_indice_ww].ie_tipo_agrupamento	:= r_level_3.ie_tipo_agrupamento_padrao;
			estrutura_w[nr_indice_ww].nm_usuario            := wheb_usuario_pck.get_nm_usuario;
            end loop read_level_3;
         end loop read_level_2;

            elsif (r_level_1.ie_grupo = 'TE') then
      <<read_level_2>>

      for r_level_2 in c_level_2_templates(443)
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;

            estrutura_w[nr_indice_ww].ie_evolucao_clinica  := r_level_2.ie_evolucao_clinica;
			
            estrutura_w[nr_indice_ww].nr_seq_tipo_registro  := r_level_2.nr_seq_tipo_registro;
			estrutura_w[nr_indice_ww].ds_descricao         	:= r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nm_atributo          	:= r_level_2.nm_atributo_linked;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].ds_estrutura         	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nr_seq_linked_data   	:= r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
            estrutura_w[nr_indice_ww].ie_evento_tipo   	    := r_level_2.ie_evento_tipo;
			estrutura_w[nr_indice_ww].nr_nivel             	:= 2;
			estrutura_w[nr_indice_ww].nr_sequencia         	:= nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior      	:= nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nm_usuario            := wheb_usuario_pck.get_nm_usuario;
			end loop read_level_2;

      
   elsif (r_level_1.ie_grupo = 'GL') then
      <<read_level_2>>
      for r_level_2 in c_level_2_glicemia
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao         := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].ds_estrutura         := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nr_seq_linked_data   := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_nivel             := 2;
         estrutura_w[nr_indice_ww].nr_sequencia         := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior      := nr_seq_superior_1_w;
		 estrutura_w[nr_indice_ww].nm_usuario           := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                            := nr_indice_w;
         <<read_level_3>>
         for r_level_3 in c_atributos(r_level_2.nr_seq_visao)
            loop
            nr_indice_w := nr_indice_w + 1;
            estrutura_w.extend(1);
            nr_indice_ww   := estrutura_w.count;
            estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
            estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_3.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_3.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_3.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_3.ie_grid_view;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
            estrutura_w[nr_indice_ww].nr_nivel               := 3;
            estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
            estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			estrutura_w[nr_indice_ww].nr_seq_atributo        := r_level_3.nr_seq_atributo;
			estrutura_w[nr_indice_ww].ie_composto_tree       := r_level_3.ie_composto_tree;
			estrutura_w[nr_indice_ww].ie_tipo_agrupamento	:= r_level_3.ie_tipo_agrupamento_padrao;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
            end loop read_level_3;
         end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'OB') then
      <<read_level_2>>
      for r_level_2 in c_level_2_obstetricia
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
         estrutura_w[nr_indice_ww].nr_nivel               := 2;
		 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                                      := nr_indice_w;
         <<read_level_3>>
         for r_level_3 in c_atributos(r_level_2.nr_seq_visao)
            loop
            nr_indice_w := nr_indice_w + 1;
            estrutura_w.extend(1);
            nr_indice_ww   := estrutura_w.count;
            estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
            estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_3.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view         := r_level_3.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_3.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_3.ie_grid_view;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
            estrutura_w[nr_indice_ww].nr_nivel               := 3;
            estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
            estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
			estrutura_w[nr_indice_ww].nr_seq_atributo        := r_level_3.nr_seq_atributo;
			estrutura_w[nr_indice_ww].ie_composto_tree       := r_level_3.ie_composto_tree;
			estrutura_w[nr_indice_ww].ie_tipo_agrupamento	:= r_level_3.ie_tipo_agrupamento_padrao;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
            end loop read_level_3;
         end loop read_level_2;
   elsif (r_level_1.ie_grupo = 'EX') then
		atributos_w.delete;
		i := 0;
		<<read_atributo>>
		for r_atributos in c_atributos(105042)
			loop
			atributos_w.extend(1);
			i := i + 1;
			atributos_w[i].ds_descricao         := r_atributos.ds_descricao;
			atributos_w[i].nm_atributo_linked   := r_atributos.nm_atributo_linked;
			atributos_w[i].nm_atributo          := r_atributos.nm_atributo;
			atributos_w[i].nr_seq_linked_data   := r_atributos.nr_seq_linked_data;
			atributos_w[i].ie_chart_view        := r_atributos.ie_chart_view;
			atributos_w[i].ie_timeline_view     := r_atributos.ie_timeline_view;
			atributos_w[i].ie_grid_view			:= r_atributos.ie_grid_view;
			atributos_w[i].nr_seq_atributo      := r_atributos.nr_seq_atributo;
			atributos_w[i].ie_composto_tree     := r_atributos.ie_composto_tree;
			atributos_w[i].ie_tipo_agrupamento	:= r_atributos.ie_tipo_agrupamento_padrao;
			end loop read_atributo;
		<<read_level_2>>
		for r_level_2 in c_level_2_grupo_exames(374)
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;
			estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].nr_nivel               := 2;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nr_seq_apresent        := nr_indice_w;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
			nr_seq_superior_2_w                              := nr_indice_w;
			<<read_level_3>>
			for r_level_3 in c_level_3_grupo_exames(r_level_2.nr_sequencia)
				loop
				nr_indice_w := nr_indice_w + 1;
				estrutura_w.extend(1);
				nr_indice_ww   := estrutura_w.count;
				estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
				estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
				estrutura_w[nr_indice_ww].nr_seq_linked_data     := 374;
				estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
				estrutura_w[nr_indice_ww].nm_atributo            := r_level_3.nm_atributo_linked;
				estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
				estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
				estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_3.nr_seq_exame;
				estrutura_w[nr_indice_ww].nr_nivel               := 3;
				estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
				estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
				estrutura_w[nr_indice_ww].nr_seq_apresent        := nr_indice_w;
				estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
				nr_seq_superior_3_w                              := nr_indice_w;
				for   i in atributos_w.first..atributos_w.last
					loop
					if (((r_level_3.ie_formato_resultado in ('V','CV','DD')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','NR_SEQ_MATERIAL'))) or
						((r_level_3.ie_formato_resultado in ('VP')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','PR_RESULTADO','NR_SEQ_MATERIAL'))) or
						((r_level_3.ie_formato_resultado in ('DV')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL'))) or
						((r_level_3.ie_formato_resultado in ('P')) and (atributos_w[i].nm_atributo in ('PR_RESULTADO','NR_SEQ_MATERIAL'))) or
						((r_level_3.ie_formato_resultado in ('SM','MS','MSL','SDM','DL','S','D')) and (atributos_w[i].nm_atributo in ('DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL')))) then
						nr_indice_w := nr_indice_w + 1;
						estrutura_w.extend(1);
						nr_indice_ww   := estrutura_w.count;
						estrutura_w[nr_indice_ww].nm_atributo            := atributos_w[i].nm_atributo_linked;
						estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_3.nr_seq_exame;
						estrutura_w[nr_indice_ww].nr_seq_linked_data     := atributos_w[i].nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view          := atributos_w[i].ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view       := atributos_w[i].ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			 := atributos_w[i].ie_grid_view;
						estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
						estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
						estrutura_w[nr_indice_ww].nr_seq_atributo     	 := atributos_w[i].nr_seq_atributo;
						estrutura_w[nr_indice_ww].nr_nivel               := 4;
						estrutura_w[nr_indice_ww].ie_composto_tree       := 'S';
						estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
						estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
						estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
					end if;
					end loop;
				<<read_level_4>>
				for r_level_4 in c_level_4_grupo_exames(r_level_3.nr_sequencia, r_level_3.nr_seq_exame)
					loop
					nr_indice_w := nr_indice_w + 1;
					estrutura_w.extend(1);
					nr_indice_ww   := estrutura_w.count;
					estrutura_w[nr_indice_ww].ds_descricao           := r_level_4.ds_descricao;
					estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
					estrutura_w[nr_indice_ww].nr_seq_linked_data     := 374;
					estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
					estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
					estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
					estrutura_w[nr_indice_ww].nm_atributo            := r_level_4.nm_atributo_linked;
					estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
					estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
					estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_4.nr_seq_exame;
					estrutura_w[nr_indice_ww].nr_nivel               := 4;
					estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
					estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_3_w;
					estrutura_w[nr_indice_ww].nr_seq_apresent        := nr_indice_w;
					estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
					nr_seq_superior_4_w                              := nr_indice_w;
					for   i in atributos_w.first..atributos_w.last
						loop
						if (((r_level_4.ie_formato_resultado in ('V','CV','DD')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','NR_SEQ_MATERIAL'))) or
							((r_level_4.ie_formato_resultado in ('VP')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','PR_RESULTADO','NR_SEQ_MATERIAL'))) or
							((r_level_4.ie_formato_resultado in ('DV')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL'))) or
							((r_level_4.ie_formato_resultado in ('P')) and (atributos_w[i].nm_atributo in ('PR_RESULTADO','NR_SEQ_MATERIAL'))) or
							((r_level_4.ie_formato_resultado in ('SM','MS','MSL','SDM','DL','S','D')) and (atributos_w[i].nm_atributo in ('DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL')))) then
							nr_indice_w := nr_indice_w + 1;
							estrutura_w.extend(1);
							nr_indice_ww   := estrutura_w.count;
							estrutura_w[nr_indice_ww].nm_atributo            := atributos_w[i].nm_atributo_linked;
							estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_4.nr_seq_exame;
							estrutura_w[nr_indice_ww].nr_seq_linked_data     := atributos_w[i].nr_seq_linked_data;
							estrutura_w[nr_indice_ww].ie_chart_view          := atributos_w[i].ie_chart_view;
							estrutura_w[nr_indice_ww].ie_timeline_view       := atributos_w[i].ie_timeline_view;
							estrutura_w[nr_indice_ww].ie_grid_view			 := atributos_w[i].ie_grid_view;
							estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
							estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
							estrutura_w[nr_indice_ww].nr_seq_atributo     	 := atributos_w[i].nr_seq_atributo;
							estrutura_w[nr_indice_ww].ie_composto_tree       := 'S';
							estrutura_w[nr_indice_ww].nr_nivel               := 5;
							estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
							estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_4_w;
							estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
						end if;
						end loop;
					<<read_level_5>>
					for r_level_5 in c_level_5_grupo_exames(r_level_4.nr_sequencia, r_level_4.nr_seq_exame)
						loop
						nr_indice_w := nr_indice_w + 1;
						estrutura_w.extend(1);
						nr_indice_ww   := estrutura_w.count;
						estrutura_w[nr_indice_ww].ds_descricao           := r_level_5.ds_descricao;
						estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao||' -> '||r_level_5.ds_descricao;
						estrutura_w[nr_indice_ww].nr_seq_linked_data     := 374;
						estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
						estrutura_w[nr_indice_ww].nm_atributo            := r_level_5.nm_atributo_linked;
						estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
						estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
						estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_5.nr_seq_exame;
						estrutura_w[nr_indice_ww].nr_nivel               := 5;
						estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
						estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_4_w;
						estrutura_w[nr_indice_ww].nr_seq_apresent        := nr_indice_w;
						estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
						nr_seq_superior_5_w								 := nr_indice_w;	
						for   i in atributos_w.first..atributos_w.last
							loop
							if (((r_level_5.ie_formato_resultado in ('V','CV','DD')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','NR_SEQ_MATERIAL'))) or
							    ((r_level_5.ie_formato_resultado in ('VP')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','PR_RESULTADO','NR_SEQ_MATERIAL'))) or
							    ((r_level_5.ie_formato_resultado in ('DV')) and (atributos_w[i].nm_atributo in ('QT_RESULTADO','DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL'))) or
							    ((r_level_5.ie_formato_resultado in ('P')) and (atributos_w[i].nm_atributo in ('PR_RESULTADO','NR_SEQ_MATERIAL'))) or
							    ((r_level_5.ie_formato_resultado in ('SM','MS','MSL','SDM','DL','S','D')) and (atributos_w[i].nm_atributo in ('DS_RESULTADO_CURTO','DS_RESULTADO','NR_SEQ_MATERIAL')))) then
								nr_indice_w := nr_indice_w + 1;
								estrutura_w.extend(1);
								nr_indice_ww   := estrutura_w.count;
								estrutura_w[nr_indice_ww].nm_atributo            := atributos_w[i].nm_atributo_linked;
								estrutura_w[nr_indice_ww].nr_seq_exame           := r_level_5.nr_seq_exame;
								estrutura_w[nr_indice_ww].nr_seq_linked_data     := atributos_w[i].nr_seq_linked_data;
								estrutura_w[nr_indice_ww].ie_chart_view          := atributos_w[i].ie_chart_view;
								estrutura_w[nr_indice_ww].ie_timeline_view       := atributos_w[i].ie_timeline_view;
								estrutura_w[nr_indice_ww].ie_grid_view			 := atributos_w[i].ie_grid_view;
								estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
								estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
								estrutura_w[nr_indice_ww].nr_seq_atributo     	 := atributos_w[i].nr_seq_atributo;
								estrutura_w[nr_indice_ww].ie_composto_tree       := 'S';
								estrutura_w[nr_indice_ww].nr_nivel               := 6;
								estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
								estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_5_w;
								estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
							end if;
							end loop;
						end loop	read_level_5;
					end loop	read_level_4;
				end loop	read_level_3;
			end loop	read_level_2;	
   elsif (r_level_1.ie_grupo = 'EV') then
      <<read_level_2>>
      for r_level_2 in c_level_2_notas_clinicas(373)
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ie_evolucao_clinica    := r_level_2.ie_evolucao_clinica;
         estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
		 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
		 estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
		 estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
		 estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
         estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
         estrutura_w[nr_indice_ww].nr_nivel               := 2;
		 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
         end loop r_level_2;
	elsif (r_level_1.ie_grupo = 'EA') then
		<<read_level_2>>
		for r_level_2 in c_level_2_eventos_atend(409)
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;
			estrutura_w[nr_indice_ww].ds_descricao         	:= r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nm_atributo          	:= r_level_2.nm_atributo_linked;
			estrutura_w[nr_indice_ww].ds_estrutura         	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nr_seq_apresent      	:= r_level_2.nr_seq_apresent;
			estrutura_w[nr_indice_ww].nr_seq_linked_data   	:= r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_evento_tipo   		:= r_level_2.ie_evento_tipo;
			estrutura_w[nr_indice_ww].nr_nivel             	:= 2;
			estrutura_w[nr_indice_ww].nr_sequencia         	:= nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior      	:= nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
			end loop read_level_2;
	elsif (r_level_1.ie_grupo = 'OC') then
		<<read_level_2>>
		for r_level_2 in c_level_2_ganhos_perdas(636)
			loop
			nr_indice_w := nr_indice_w + 1;
			estrutura_w.extend(1);
			nr_indice_ww   := estrutura_w.count;
			estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
			estrutura_w[nr_indice_ww].nr_seq_apresent        := r_level_2.nr_seq_apresent;
			estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
			estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
			estrutura_w[nr_indice_ww].nr_nivel               := 2;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
			nr_seq_superior_2_w                                      := nr_indice_w;
			<<read_level_3>>
			for r_level_3 in c_level_3_ganhos_perdas
				loop
				nr_indice_w := nr_indice_w + 1;
				estrutura_w.extend(1);
				nr_indice_ww   := estrutura_w.count;
				estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
				estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
				estrutura_w[nr_indice_ww].nr_seq_apresent        := r_level_3.nr_seq_apresent;
				estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
				estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
				estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
				estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
				estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
				estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
				estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
				estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
				estrutura_w[nr_indice_ww].nr_nivel               := 3;
				estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
				nr_seq_superior_3_w                                      := nr_indice_w;
				if (r_level_3.ie_grupo_tipo = 'G') then
					<<read_level_4>>
					for r_level_4 in c_level_4_gp_oco_g(r_level_2.ie_perda_ganho)
						loop
						nr_indice_w := nr_indice_w + 1;
						estrutura_w.extend(1);
						nr_indice_ww   := estrutura_w.count;
						estrutura_w[nr_indice_ww].nr_seq_grupo_pg        	:= r_level_4.nr_seq_grupo_pg;
						estrutura_w[nr_indice_ww].ds_descricao           	:= r_level_4.ds_descricao;
						estrutura_w[nr_indice_ww].nm_atributo         		:= 'QT_OCORRENCIA_636';
						estrutura_w[nr_indice_ww].ds_estrutura           	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
						estrutura_w[nr_indice_ww].nr_seq_linked_data     	:= r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view          	:= r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_level_2.ie_grid_view;
						estrutura_w[nr_indice_ww].nr_seq_documento_secao 	:= nr_seq_documento_secao_p;
						estrutura_w[nr_indice_ww].ie_grupo					:= r_level_1.ie_grupo;
						estrutura_w[nr_indice_ww].nr_sequencia           	:= nr_indice_w;
						estrutura_w[nr_indice_ww].nr_seq_superior        	:= nr_seq_superior_3_w;
						estrutura_w[nr_indice_ww].nr_nivel               	:= 4;
						estrutura_w[nr_indice_ww].ie_tipo_agrupamento		:= null;
						estrutura_w[nr_indice_ww].nm_usuario             	:= wheb_usuario_pck.get_nm_usuario;
						nr_seq_superior_4_w                              	:= nr_indice_w;
						end loop read_level_4;
				else
					<<read_level_4>>
					for r_level_4 in c_level_4_gp_oco_t(r_level_2.ie_perda_ganho)
						loop
						nr_indice_w := nr_indice_w + 1;
						estrutura_w.extend(1);
						nr_indice_ww   := estrutura_w.count;
						estrutura_w[nr_indice_ww].nr_seq_tipo_pg         	:= r_level_4.nr_seq_tipo_pg;
						estrutura_w[nr_indice_ww].nr_seq_grupo_pg        	:= r_level_4.nr_seq_grupo_pg;
						estrutura_w[nr_indice_ww].nm_atributo				:= 'QT_OCORRENCIA_636';
						estrutura_w[nr_indice_ww].ds_descricao           	:= r_level_4.ds_descricao;
						estrutura_w[nr_indice_ww].ds_estrutura           	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
						estrutura_w[nr_indice_ww].nr_seq_documento_secao 	:= nr_seq_documento_secao_p;
						estrutura_w[nr_indice_ww].ie_grupo 					:= r_level_1.ie_grupo;
						estrutura_w[nr_indice_ww].nr_seq_linked_data     	:= r_level_2.nr_seq_linked_data;
						estrutura_w[nr_indice_ww].ie_chart_view          	:= r_level_2.ie_chart_view;
						estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_level_2.ie_timeline_view;
						estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_level_2.ie_grid_view;
						estrutura_w[nr_indice_ww].nr_sequencia           	:= nr_indice_w;
						estrutura_w[nr_indice_ww].nr_seq_superior        	:= nr_seq_superior_3_w;
						estrutura_w[nr_indice_ww].nr_nivel               	:= 4;
						estrutura_w[nr_indice_ww].ie_wdlg               	:= 'GP';
						estrutura_w[nr_indice_ww].nm_usuario             	:= wheb_usuario_pck.get_nm_usuario;
						nr_seq_superior_4_w                                 := nr_indice_w;
						estrutura_w[nr_indice_ww].ie_tipo_agrupamento		:= null;
						end loop read_level_4;
				end if;
				end loop read_level_3;
			end loop read_level_2;
	elsif (r_level_1.ie_grupo = 'GP') then
      <<read_level_2>>
      for r_level_2 in c_level_2_ganhos_perdas(294)
         loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao;
         estrutura_w[nr_indice_ww].nr_seq_apresent        := r_level_2.nr_seq_apresent;
         estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
		 estrutura_w[nr_indice_ww].ie_chart_view       	  := r_level_2.ie_chart_view;
		 estrutura_w[nr_indice_ww].ie_timeline_view    	  := r_level_2.ie_timeline_view;
		 estrutura_w[nr_indice_ww].ie_grid_view			  := r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 			  := r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
         estrutura_w[nr_indice_ww].nr_nivel               := 2;
		 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
         nr_seq_superior_2_w                                      := nr_indice_w;
         <<read_level_3>>
         for r_level_3 in c_level_3_ganhos_perdas
            loop
            nr_indice_w := nr_indice_w + 1;
            estrutura_w.extend(1);
            nr_indice_ww   := estrutura_w.count;
            estrutura_w[nr_indice_ww].ds_descricao           := r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao;
            estrutura_w[nr_indice_ww].nr_seq_apresent        := r_level_3.nr_seq_apresent;
            estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          := r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       := r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 := r_level_2.ie_grid_view;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
			estrutura_w[nr_indice_ww].ie_grupo 				 := r_level_1.ie_grupo;
            estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
            estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_2_w;
            estrutura_w[nr_indice_ww].nr_nivel               := 3;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
            nr_seq_superior_3_w                                      := nr_indice_w;
            if (r_level_3.ie_grupo_tipo = 'G') then
               <<read_level_4>>
               for r_level_4 in c_level_4_gp_vol_g(r_level_2.ie_perda_ganho)
                  loop
                  nr_indice_w := nr_indice_w + 1;
                  estrutura_w.extend(1);
                  nr_indice_ww   := estrutura_w.count;
                  estrutura_w[nr_indice_ww].nr_seq_grupo_pg        	:= r_level_4.nr_seq_grupo_pg;
                  estrutura_w[nr_indice_ww].ds_descricao           	:= r_level_4.ds_descricao;
                  estrutura_w[nr_indice_ww].ds_estrutura           	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
				  estrutura_w[nr_indice_ww].nm_atributo         	:= 'QT_VOLUME_294';
                  estrutura_w[nr_indice_ww].nr_seq_linked_data     	:= r_level_2.nr_seq_linked_data;
					estrutura_w[nr_indice_ww].ie_chart_view         := r_level_2.ie_chart_view;
					estrutura_w[nr_indice_ww].ie_timeline_view      := r_level_2.ie_timeline_view;
					estrutura_w[nr_indice_ww].ie_grid_view			:= r_level_2.ie_grid_view;
				  estrutura_w[nr_indice_ww].nr_seq_documento_secao 	:= nr_seq_documento_secao_p;
				  estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                  estrutura_w[nr_indice_ww].nr_sequencia           	:= nr_indice_w;
                  estrutura_w[nr_indice_ww].nr_seq_superior        	:= nr_seq_superior_3_w;
                  estrutura_w[nr_indice_ww].nr_nivel               	:= 4;
				  estrutura_w[nr_indice_ww].ie_tipo_agrupamento		:= null;
				  estrutura_w[nr_indice_ww].nm_usuario             	:= wheb_usuario_pck.get_nm_usuario;
                  nr_seq_superior_4_w                              	:= nr_indice_w;
				  /*
                  <<read_level_5>>
                  for r_level_5 in c_atributos (104806)
                     loop
                     nr_indice_w := nr_indice_w + 1;
                     estrutura_w.extend(1);
                     nr_indice_ww   := estrutura_w.count;
                     estrutura_w(nr_indice_ww).ds_descricao        := r_level_5.ds_descricao;
                     estrutura_w(nr_indice_ww).nm_atributo         := r_level_5.nm_atributo_linked;
                     estrutura_w(nr_indice_ww).nr_seq_grupo_pg     := r_level_4.nr_seq_grupo_pg;
                     estrutura_w(nr_indice_ww).ds_estrutura        := r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao||' -> '||r_level_5.ds_descricao;
                     estrutura_w(nr_indice_ww).nr_seq_linked_data  := r_level_5.nr_seq_linked_data;
					 estrutura_w(nr_indice_ww).ie_grupo 				:= r_level_1.ie_grupo;
					 estrutura_w(nr_indice_ww).nr_seq_documento_secao := nr_seq_documento_secao_p;
                     estrutura_w(nr_indice_ww).nr_sequencia        := nr_indice_w;
                     estrutura_w(nr_indice_ww).nr_seq_superior     := nr_seq_superior_4_w;
                     estrutura_w(nr_indice_ww).nr_nivel            := 5;
					 estrutura_w(nr_indice_ww).nr_seq_atributo     := r_level_5.nr_seq_atributo;
					 estrutura_w(nr_indice_ww).ie_composto_tree    := r_level_5.ie_composto_tree;
					 estrutura_w(nr_indice_ww).ie_tipo_agrupamento	:= r_level_5.ie_tipo_agrupamento_padrao;
                     end loop read_level_5;
				  */
	
                  end loop read_level_4;
            else
               <<read_level_4>>
               for r_level_4 in c_level_4_gp_vol_t(r_level_2.ie_perda_ganho)
                  loop
                  nr_indice_w := nr_indice_w + 1;
                  estrutura_w.extend(1);
                  nr_indice_ww   := estrutura_w.count;
                  estrutura_w[nr_indice_ww].nr_seq_tipo_pg         	:= r_level_4.nr_seq_tipo_pg;
                  estrutura_w[nr_indice_ww].nr_seq_grupo_pg        	:= r_level_4.nr_seq_grupo_pg;
                  estrutura_w[nr_indice_ww].ds_descricao           	:= r_level_4.ds_descricao;
                  estrutura_w[nr_indice_ww].ds_estrutura           	:= r_level_1.ds_descricao||' -> '||r_level_2.ds_descricao||' -> '||r_level_3.ds_descricao||' -> '||r_level_4.ds_descricao;
				  estrutura_w[nr_indice_ww].nm_atributo         	:= 'QT_VOLUME_294';
				  estrutura_w[nr_indice_ww].nr_seq_documento_secao 	:= nr_seq_documento_secao_p;
				  estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
                  estrutura_w[nr_indice_ww].nr_seq_linked_data     	:= 294;
					estrutura_w[nr_indice_ww].ie_chart_view          	:= r_level_2.ie_chart_view;
					estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_level_2.ie_timeline_view;
					estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_level_2.ie_grid_view;
				  estrutura_w[nr_indice_ww].ie_wdlg               	:= 'GP';
				  estrutura_w[nr_indice_ww].ie_tipo_agrupamento		:= null;
                  estrutura_w[nr_indice_ww].nr_sequencia           	:= nr_indice_w;
                  estrutura_w[nr_indice_ww].nr_seq_superior        	:= nr_seq_superior_3_w;
                  estrutura_w[nr_indice_ww].nr_nivel               	:= 4;
				  estrutura_w[nr_indice_ww].nm_usuario             	:= wheb_usuario_pck.get_nm_usuario;
                  nr_seq_superior_4_w                               := nr_indice_w;
                  end loop read_level_4;
            end if;
            end loop read_level_3;
         end loop read_level_2;
    elsif (r_level_1.ie_grupo = 'CP') then
    for r_c_cp_level2 in c_cp_level2(433) loop
	  <<read_level_2>>
      nr_indice_w                                     := nr_indice_w + 1;
      estrutura_w.extend(1);
      nr_indice_ww                                    := estrutura_w.count;
      estrutura_w[nr_indice_ww].ds_descricao          := substr(r_c_cp_level2.ds_descricao,1,255);
      estrutura_w[nr_indice_ww].ds_estrutura          := substr(r_level_1.ds_descricao||' -> '|| r_c_cp_level2.ds_descricao,1,255);
	  estrutura_w[nr_indice_ww].nr_seq_linked_data    := r_c_cp_level2.nr_seq_linked_data;
	  estrutura_w[nr_indice_ww].ie_chart_view         := r_c_cp_level2.ie_chart_view;
	  estrutura_w[nr_indice_ww].ie_timeline_view      := r_c_cp_level2.ie_timeline_view;
	  estrutura_w[nr_indice_ww].ie_grid_view		  := r_c_cp_level2.ie_grid_view;
      estrutura_w[nr_indice_ww].nr_sequencia          := nr_indice_w;
      estrutura_w[nr_indice_ww].nr_nivel              := 2;
      estrutura_w[nr_indice_ww].nr_seq_superior       := nr_seq_superior_1_w;
	  estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
	  estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
	  estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
      nr_seq_superior_2_w := nr_indice_w;

	      for r_c_cp_level3 in c_cp_level3(r_c_cp_level2.CD_GRUPO,433) loop
	      <<read_level_3>>
	        nr_indice_w                                     := nr_indice_w + 1;
	        estrutura_w.extend(1);
	        nr_indice_ww                                    := estrutura_w.count;
           estrutura_w[nr_indice_ww].nr_seq_diagnostico    := r_c_cp_level3.nr_seq_diagnostico;
           estrutura_w[nr_indice_ww].ie_evolucao_clinica   := r_c_cp_level3.ie_evolucao_clinica;
	        estrutura_w[nr_indice_ww].ds_descricao          := substr(r_c_cp_level3.ds_descricao,1,255);
	        estrutura_w[nr_indice_ww].ds_estrutura          := substr(r_level_1.ds_descricao||' -> '|| r_c_cp_level2.ds_descricao ||' -> '|| r_c_cp_level3.ds_descricao,1,255);
            estrutura_w[nr_indice_ww].ie_evento_tipo       := r_c_cp_level3.ie_evento_tipo;
            estrutura_w[nr_indice_ww].nm_atributo          := r_c_cp_level3.nm_atributo_linked;
            estrutura_w[nr_indice_ww].nr_seq_linked_data   := r_c_cp_level3.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          	:= r_c_cp_level3.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_c_cp_level3.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_c_cp_level3.ie_grid_view;
			estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
			estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
	        estrutura_w[nr_indice_ww].nr_sequencia          := nr_indice_w;
	        estrutura_w[nr_indice_ww].nr_nivel              := 3;
	        estrutura_w[nr_indice_ww].nr_seq_superior       := nr_seq_superior_2_w;
			estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;

	  end loop;
    end loop;	

    for r_c_cp_level2_Outros in c_cp_level2_Outros(433) loop
	  <<read_level_3>>
      nr_indice_w                                     := nr_indice_w + 1;
      estrutura_w.extend(1);
      nr_indice_ww                                    	:= estrutura_w.count;
      estrutura_w[nr_indice_ww].ds_descricao          	:= substr(r_c_cp_level2_Outros.ds_descricao,1,255);
      estrutura_w[nr_indice_ww].ds_estrutura          	:= substr(r_level_1.ds_descricao ||' -> '|| r_c_cp_level2_Outros.ds_descricao,1,255);
	  estrutura_w[nr_indice_ww].nr_seq_documento_secao 	:= nr_seq_documento_secao_p;
	  estrutura_w[nr_indice_ww].nr_seq_linked_data   	:= r_c_cp_level2_Outros.nr_seq_linked_data;
	  estrutura_w[nr_indice_ww].ie_chart_view          	:= r_c_cp_level2_Outros.ie_chart_view;
	  estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_c_cp_level2_Outros.ie_timeline_view;
	  estrutura_w[nr_indice_ww].ie_grid_view			:= r_c_cp_level2_Outros.ie_grid_view;
	  estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
      estrutura_w[nr_indice_ww].nr_sequencia          	:= nr_indice_w;
      estrutura_w[nr_indice_ww].nr_nivel              	:= 2;
      estrutura_w[nr_indice_ww].nr_seq_superior       	:= nr_seq_superior_1_w;
	  estrutura_w[nr_indice_ww].nm_usuario              := wheb_usuario_pck.get_nm_usuario;
      nr_seq_superior_2_w := nr_indice_w;

      for r_c_cp_level3_Diag_Outros in c_cp_level3_Diag_Outros(433) loop
	  <<read_level_4>>
	    nr_indice_w                                     := nr_indice_w + 1;
	    estrutura_w.extend(1);
	    nr_indice_ww                                    := estrutura_w.count;
       estrutura_w[nr_indice_ww].nr_seq_diagnostico           := r_c_cp_level3_Diag_Outros.CD_DIAG;
	    estrutura_w[nr_indice_ww].ds_descricao          := substr(r_c_cp_level3_Diag_Outros.ds_descricao,1,255);
	    estrutura_w[nr_indice_ww].ds_estrutura          := substr(r_level_1.ds_descricao||' -> '|| r_c_cp_level2_Outros.ds_descricao ||' -> '|| r_c_cp_level3_Diag_Outros.ds_descricao,1,255);
        estrutura_w[nr_indice_ww].ie_evento_tipo   	 := r_c_cp_level3_Diag_Outros.ie_evento_tipo;
        estrutura_w[nr_indice_ww].nm_atributo          := r_c_cp_level3_Diag_Outros.nm_atributo_linked;
        estrutura_w[nr_indice_ww].nr_seq_linked_data   := r_c_cp_level3_Diag_Outros.nr_seq_linked_data;
		estrutura_w[nr_indice_ww].ie_chart_view          	:= r_c_cp_level3_Diag_Outros.ie_chart_view;
		estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_c_cp_level3_Diag_Outros.ie_timeline_view;
		estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_c_cp_level3_Diag_Outros.ie_grid_view;
		estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
		estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
	    estrutura_w[nr_indice_ww].nr_sequencia          := nr_indice_w;
	    estrutura_w[nr_indice_ww].nr_nivel              := 3;
	    estrutura_w[nr_indice_ww].nr_seq_superior       := nr_seq_superior_2_w;
		estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;	
	  end loop;
    end loop;		

   elsif (r_level_1.ie_grupo = 'DI') then
    <<read_level_2>>
    for r_level_2 in c_level_2_dias
    loop
         nr_indice_w := nr_indice_w + 1;
         estrutura_w.extend(1);
         nr_indice_ww   := estrutura_w.count;
         estrutura_w[nr_indice_ww].ds_descricao           := r_level_2.nm_atributo_linked;
         estrutura_w[nr_indice_ww].nm_atributo            := r_level_2.nm_atributo_linked;
         estrutura_w[nr_indice_ww].ds_estrutura           := r_level_1.ds_descricao||' -> '||r_level_2.nm_atributo_linked;
         estrutura_w[nr_indice_ww].nr_seq_linked_data     := r_level_2.nr_seq_linked_data;
			estrutura_w[nr_indice_ww].ie_chart_view          	:= r_level_2.ie_chart_view;
			estrutura_w[nr_indice_ww].ie_timeline_view       	:= r_level_2.ie_timeline_view;
			estrutura_w[nr_indice_ww].ie_grid_view			 	:= r_level_2.ie_grid_view;
		 estrutura_w[nr_indice_ww].nr_seq_documento_secao := nr_seq_documento_secao_p;
		 estrutura_w[nr_indice_ww].ie_grupo 				:= r_level_1.ie_grupo;
         estrutura_w[nr_indice_ww].nr_sequencia           := nr_indice_w;
         estrutura_w[nr_indice_ww].nr_seq_superior        := nr_seq_superior_1_w;
         estrutura_w[nr_indice_ww].nr_nivel               := 2;
		 estrutura_w[nr_indice_ww].nm_usuario             := wheb_usuario_pck.get_nm_usuario;
    end loop read_level_2;

   end if;
   end loop read_level_1;




END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE localizador_subsecao_pck.gera_niveis (nr_seq_linked_data_p bigint, nr_seq_template_p bigint, nr_seq_documento_secao_p bigint) FROM PUBLIC; -- REVOKE ALL ON PROCEDURE localizador_subsecao_pck.gera_niveis_atx (nr_seq_linked_data_p bigint, nr_seq_template_p bigint, nr_seq_documento_secao_p bigint) FROM PUBLIC;
