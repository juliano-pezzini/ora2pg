-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION localizador_subsecao_pck.get_ganhos_perdas () RETURNS SETOF GANHOS_PERDAS_T AS $body$
DECLARE

indice_w bigint;

c_ganhos_perdas CURSOR FOR
   SELECT  a.nr_sequencia nr_seq_grupo_pg,
           a.ds_grupo,
           a.ie_perda_ganho,
           b.ds_tipo,
           b.nr_sequencia nr_seq_tipo_pg,
           b.ie_volume_ocorrencia
   from    grupo_perda_ganho a,
           tipo_perda_ganho b
   where   a.nr_sequencia = b.nr_seq_grupo
   and     coalesce(a.ie_situacao,'A')  = 'A'
   and     coalesce(b.ie_situacao,'A')  = 'A';
BEGIN
if (current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.count = 0) then
   <<read_ganhos_perdas>>
   for r_ganhos_perdas in c_ganhos_perdas
      loop
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.extend(1);
      indice_w := current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.count;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].nr_seq_grupo_pg       := r_ganhos_perdas.nr_seq_grupo_pg;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].ds_grupo              := r_ganhos_perdas.ds_grupo;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].ie_perda_ganho        := r_ganhos_perdas.ie_perda_ganho;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].ds_tipo               := r_ganhos_perdas.ds_tipo;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].nr_seq_tipo_pg        := r_ganhos_perdas.nr_seq_tipo_pg;
      current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t[indice_w].ie_volume_ocorrencia  := r_ganhos_perdas.ie_volume_ocorrencia;

      end loop read_ganhos_perdas;
end if;

if (current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.count > 0) then
   for linha in current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.first..ganhos_perdas_w.last loop
      if (current_setting('localizador_subsecao_pck.ganhos_perdas_w')::ganhos_perdas_t.exists(linha)) then
         RETURN NEXT current_setting('localizador_subsecao_pck.ganhos_perdas_w'::ganhos_perdas_t(linha));
      end if;
   end loop;
end if;
return;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION localizador_subsecao_pck.get_ganhos_perdas () FROM PUBLIC;
