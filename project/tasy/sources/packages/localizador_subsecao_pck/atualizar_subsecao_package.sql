-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE localizador_subsecao_pck.atualizar_subsecao ( nr_seq_documento_secao_p bigint, nr_sequencia_p bigint, nr_seq_apresentacao_p bigint, ie_tipo_dosagem_p text, nr_seq_inf_adic_p bigint, ie_membro_p text, ie_aparelho_pa_p text, ie_pupila_lado_p text, ds_lista_removidos_p text) AS $body$
DECLARE


nm_atributo_w						documento_subsecao.nm_atributo%type;
nr_seq_grupo_pg_w                	documento_subsecao.nr_seq_grupo_pg%type;
nr_seq_tipo_pg_w                 	documento_subsecao.nr_seq_tipo_pg%type;
nr_seq_linked_data_w             	documento_subsecao.nr_seq_linked_data%type;
nr_seq_linked_data_subsecao_ww   	documento_subsecao.nr_seq_linked_data%type;
nr_seq_score_flex_w              	documento_subsecao.nr_seq_score_flex%type;
nr_ficha_tecnica_w               	documento_subsecao.nr_ficha_tecnica%type;
nr_seq_gas_w                     	documento_subsecao.nr_seq_gas%type;
cd_material_w                    	documento_subsecao.cd_material%type;
cd_grupo_material_w              	documento_subsecao.cd_grupo_material%type;
cd_subgrupo_material_w           	documento_subsecao.cd_subgrupo_material%type;
cd_classe_material_w             	documento_subsecao.cd_classe_material%type;
ie_evolucao_clinica_w            	documento_subsecao.ie_evolucao_clinica%type;
nr_seq_doc_subsecao_w	         	documento_subsecao.nr_sequencia%type;
nr_seq_exame_w                   	documento_subsecao.nr_seq_exame%type;
ie_evento_tipo_w		         	documento_subsecao.ie_evento_tipo%type;
ie_tipo_elemento_w	         	 	documento_subsecao.ie_tipo_elemento%type;
nr_seq_diag_w       	         	documento_subsecao.nr_seq_diagnostico%type;
nr_seq_tipo_registro_w	         	documento_subsecao.nr_seq_tipo_registro%type;
nr_seq_temp_conteudo_w			 	documento_subsecao.nr_seq_temp_conteudo%type;		
nr_seq_template_w					documento_secao.nr_seq_template%type;
ie_aparelho_pa_w					documento_subsecao.ie_aparelho_pa%type;
ie_tipo_agrupamento_w				documento_subsecao.ie_tipo_agrupamento%type;
current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type						usuario.nm_usuario%type	:= wheb_usuario_pck.get_nm_usuario;
																	

c_removidos CURSOR(nr_seq_linked_data_p  bigint,nr_seq_template_p  bigint,nr_seq_documento_secao_p  bigint) FOR
	SELECT  a.nm_atributo,
            a.nr_seq_grupo_pg,
            a.nr_seq_tipo_pg,
            a.nr_seq_score_flex,
            a.nr_ficha_tecnica,
            a.nr_seq_gas,
            a.cd_material,
            a.cd_grupo_material,
            a.cd_subgrupo_material,
            a.cd_classe_material,
            a.ie_evolucao_clinica,
            a.nr_seq_exame,
			a.ie_evento_tipo,
			a.nr_seq_diagnostico,
            a.nr_seq_tipo_registro,
			a.ie_tipo_elemento,
			a.nr_seq_temp_conteudo,
			a.ie_aparelho_pa,
			a.nr_seq_template
   from     w_apap_localizador a,
            table(lista_pck.obter_lista(ds_lista_removidos_p)) b
   where    a.nr_sequencia = b.nr_registro
   and		coalesce(a.ie_composto_tree,'N') = 'N'
   and		a.nm_usuario = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type
   
union

   SELECT   c.nm_atributo_linked nm_atributo,
            a.nr_seq_grupo_pg,
            a.nr_seq_tipo_pg,
            a.nr_seq_score_flex,
            a.nr_ficha_tecnica,
            a.nr_seq_gas,
            a.cd_material,
            a.cd_grupo_material,
            a.cd_subgrupo_material,
            a.cd_classe_material,
            a.ie_evolucao_clinica,
            a.nr_seq_exame,
            a.ie_evento_tipo,
			a.nr_seq_diagnostico,
            a.nr_seq_tipo_registro,
			a.ie_tipo_elemento,
			a.nr_seq_temp_conteudo,
			a.ie_aparelho_pa,
			a.nr_seq_template
   from     w_apap_localizador a,
            linked_data_atrib_comp b,
            linked_data_atributo c,
            table(lista_pck.obter_lista(ds_lista_removidos_p)) d
   where    a.nr_seq_atributo 	= b.nr_seq_atrib
   and		c.nr_sequencia		= b.nr_seq_atrib_comp
   and      a.nr_sequencia      = d.nr_registro
   and		a.nm_usuario 		= current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type;
	
BEGIN
	
	select	max(nr_seq_linked_data)
	into STRICT	nr_seq_linked_data_w
	from	documento_secao
	where	nr_sequencia = nr_seq_documento_secao_p;
	
	
	if (ds_lista_removidos_p IS NOT NULL AND ds_lista_removidos_p::text <> '') then
		<<read_removidos>>
		for r_removidos in c_removidos(nr_seq_linked_data_w,null,nr_seq_documento_secao_p)
			loop
			delete
			from     documento_subsecao
			where    nm_atributo                = r_removidos.nm_atributo
			and      nr_seq_documento_secao     = nr_seq_documento_secao_p
			and      (((nr_seq_grupo_pg         = r_removidos.nr_seq_grupo_pg) or (coalesce(r_removidos.nr_seq_grupo_pg::text, '') = ''))
			and       ((nr_seq_tipo_pg          = r_removidos.nr_seq_tipo_pg) or (coalesce(r_removidos.nr_seq_tipo_pg::text, '') = ''))
			and       ((nr_seq_score_flex       = r_removidos.nr_seq_score_flex) or (coalesce(r_removidos.nr_seq_score_flex::text, '') = ''))
			and       ((nr_ficha_tecnica        = r_removidos.nr_ficha_tecnica) or (coalesce(r_removidos.nr_ficha_tecnica::text, '') = ''))
			and       ((nr_seq_gas              = r_removidos.nr_seq_gas) or (coalesce(r_removidos.nr_seq_gas::text, '') = ''))
			and       ((cd_material             = r_removidos.cd_material) or (coalesce(r_removidos.cd_material::text, '') = ''))
			and       ((cd_grupo_material       = r_removidos.cd_grupo_material) or (coalesce(r_removidos.cd_grupo_material::text, '') = ''))
			and       ((cd_subgrupo_material    = r_removidos.cd_subgrupo_material) or (coalesce(r_removidos.cd_subgrupo_material::text, '') = ''))
			and       ((cd_classe_material      = r_removidos.cd_classe_material) or (coalesce(r_removidos.cd_classe_material::text, '') = ''))
			and       ((ie_evolucao_clinica     = r_removidos.ie_evolucao_clinica) or (coalesce(r_removidos.ie_evolucao_clinica::text, '') = ''))
			and       ((ie_evento_tipo     	 = r_removidos.ie_evento_tipo) or (coalesce(r_removidos.ie_evento_tipo::text, '') = ''))
			and       ((nr_seq_diagnostico     	 = r_removidos.nr_seq_diagnostico) or (coalesce(r_removidos.nr_seq_diagnostico::text, '') = ''))
			and       ((ie_tipo_elemento     	 = r_removidos.ie_tipo_elemento) or (coalesce(r_removidos.ie_tipo_elemento::text, '') = ''))
			and       ((nr_seq_tipo_registro  	 = r_removidos.nr_seq_tipo_registro) or (coalesce(r_removidos.nr_seq_tipo_registro::text, '') = ''))
			and       ((nr_seq_temp_conteudo  	 = r_removidos.nr_seq_temp_conteudo) or (coalesce(r_removidos.nr_seq_temp_conteudo::text, '') = ''))
			and       ((ie_aparelho_pa  	 	 = r_removidos.ie_aparelho_pa) or (coalesce(r_removidos.ie_aparelho_pa::text, '') = ''))
			and       ((nr_seq_exame            = r_removidos.nr_seq_exame) or (coalesce(r_removidos.nr_seq_exame::text, '') = '')));
			end loop read_removidos;
	else
		select  max(a.nm_atributo),
				max(a.nr_seq_grupo_pg),
				max(a.nr_seq_tipo_pg),
				max(a.nr_seq_score_flex),
				max(a.nr_ficha_tecnica),
				max(a.nr_seq_gas),
				max(a.cd_material),
				max(a.cd_grupo_material),
				max(a.cd_subgrupo_material),
				max(a.cd_classe_material),
				max(a.ie_evolucao_clinica),
				max(a.nr_seq_exame),
				max(a.nr_seq_linked_data),
				max(a.ie_evento_tipo),
				max(a.ie_tipo_elemento),
				max(a.nr_seq_tipo_registro),
				max(a.nr_seq_diagnostico),
				max(a.nr_seq_temp_conteudo),
				max(a.ie_aparelho_pa),
				max(a.ie_tipo_agrupamento),
				max(a.nr_seq_template)
		into STRICT    nm_atributo_w,
				nr_seq_grupo_pg_w,
				nr_seq_tipo_pg_w,
				nr_seq_score_flex_w,
				nr_ficha_tecnica_w,
				nr_seq_gas_w,
				cd_material_w,
				cd_grupo_material_w,
				cd_subgrupo_material_w,
				cd_classe_material_w,
				ie_evolucao_clinica_w,
				nr_seq_exame_w,
				nr_seq_linked_data_subsecao_ww,
				ie_evento_tipo_w,
				ie_tipo_elemento_w,
				nr_seq_tipo_registro_w,
				nr_seq_diag_w,
				nr_seq_temp_conteudo_w,
				ie_aparelho_pa_w,
				ie_tipo_agrupamento_w,
				nr_seq_template_w
		from    w_apap_localizador a
		where   nr_sequencia = nr_sequencia_p
		and		a.nm_usuario = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type;

		update	documento_subsecao
		set		nr_seq_apresentacao        = nr_seq_apresentacao_p,
				nr_seq_inf_adic            = nr_seq_inf_adic_p,
				ie_membro                  = ie_membro_p,
				ie_aparelho_pa             = ie_aparelho_pa_w,
				ie_tipo_dosagem            = ie_tipo_dosagem_p,
				dt_atualizacao             = clock_timestamp(),
				nm_usuario                 = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type
		where	nr_seq_documento_secao     = nr_seq_documento_secao_p
		and     nm_atributo                = nm_atributo_w
		and     nr_seq_linked_data         = nr_seq_linked_data_subsecao_ww
		and     (((nr_seq_grupo_pg         = nr_seq_grupo_pg_w) or (coalesce(nr_seq_grupo_pg_w::text, '') = ''))
		and     ((nr_seq_tipo_pg          = nr_seq_tipo_pg_w) or (coalesce(nr_seq_tipo_pg_w::text, '') = ''))
		and     ((nr_seq_score_flex       = nr_seq_score_flex_w) or (coalesce(nr_seq_score_flex_w::text, '') = ''))
		and     ((nr_ficha_tecnica        = nr_ficha_tecnica_w) or (coalesce(nr_ficha_tecnica_w::text, '') = ''))
		and     ((nr_seq_gas              = nr_seq_gas_w) or (coalesce(nr_seq_gas_w::text, '') = ''))
		and     ((cd_material             = cd_material_w) or (coalesce(cd_material_w::text, '') = ''))
		and     ((cd_grupo_material       = cd_grupo_material_w) or (coalesce(cd_grupo_material_w::text, '') = ''))
		and     ((cd_subgrupo_material    = cd_subgrupo_material_w) or (coalesce(cd_subgrupo_material_w::text, '') = ''))
		and     ((cd_classe_material      = cd_classe_material_w) or (coalesce(cd_classe_material_w::text, '') = ''))
		and     ((nr_seq_exame            = nr_seq_exame_w) or (coalesce(nr_seq_exame_w::text, '') = ''))
		and     ((ie_evento_tipo          = ie_evento_tipo_w) or (coalesce(ie_evento_tipo_w::text, '') = ''))
		and     ((nr_seq_diagnostico          = nr_seq_diag_w) or (coalesce(nr_seq_diag_w::text, '') = ''))
		and     ((ie_tipo_elemento        = ie_tipo_elemento_w) or (coalesce(ie_tipo_elemento_w::text, '') = ''))
		and     ((nr_seq_tipo_registro    = nr_seq_tipo_registro_w) or (coalesce(nr_seq_tipo_registro_w::text, '') = ''))
		and     ((nr_seq_temp_conteudo    = nr_seq_temp_conteudo_w) or (coalesce(nr_seq_temp_conteudo_w::text, '') = ''))
		and     ((ie_aparelho_pa    	  = ie_aparelho_pa_w) or (coalesce(ie_aparelho_pa_w::text, '') = ''))
		and     ((ie_evolucao_clinica     = ie_evolucao_clinica_w) or (coalesce(ie_evolucao_clinica_w::text, '') = '')));

		if	NOT FOUND then
			select	nextval('documento_subsecao_seq')
			into STRICT	nr_seq_doc_subsecao_w
			;

			insert	into	documento_subsecao( nr_sequencia,
												nr_seq_documento_secao,
												dt_atualizacao,
												nm_usuario,
												dt_atualizacao_nrec,
												nm_usuario_nrec,
												nr_seq_apresentacao,
												ie_modo,
												nm_atributo,
												nr_seq_grupo_pg,
												nr_seq_tipo_pg,
												nr_seq_score_flex,
												nr_ficha_tecnica,
												ie_tipo_dosagem,
												ie_controla_adep,
												nr_seq_gas,
												cd_material,
												cd_grupo_material,
												cd_subgrupo_material,
												cd_classe_material,
												ie_evolucao_clinica,
												nr_seq_inf_adic,
												ie_membro,
												ie_aparelho_pa,
												nr_seq_exame,
												nr_seq_linked_data,
												ie_evento_tipo,
												ie_tipo_elemento,
												nr_seq_tipo_registro,
												nr_seq_diagnostico,
												nr_seq_temp_conteudo,
												ie_tipo_agrupamento,
												ie_trend,
												ie_mark_exceeded_value_chart,
												ie_grafico)
			SELECT                              nr_seq_doc_subsecao_w,
												nr_seq_documento_secao_p,
												clock_timestamp(),
												current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
												clock_timestamp(),
												current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
												nr_seq_apresentacao_p,
												'A',
												nm_atributo_w,
												nr_seq_grupo_pg_w,
												nr_seq_tipo_pg_w,
												nr_seq_score_flex_w,
												nr_ficha_tecnica_w,
												ie_tipo_dosagem_p,
												'N',
												nr_seq_gas_w,
												cd_material_w,
												cd_grupo_material_w,
												cd_subgrupo_material_w,
												cd_classe_material_w,
												ie_evolucao_clinica_w,
												nr_seq_inf_adic_p,
												ie_membro_p,
												ie_aparelho_pa_w,
												nr_seq_exame_w,
												nr_seq_linked_data_subsecao_ww,
												ie_evento_tipo_w,
												ie_tipo_elemento_w,
												nr_seq_tipo_registro_w,
												nr_seq_diag_w,
												nr_seq_temp_conteudo_w,
												ie_tipo_agrupamento_w,
												'N',
												'N',
												'N'
												;

			if (nr_seq_exame_w IS NOT NULL AND nr_seq_exame_w::text <> '') then
				insert	into	documento_subsecao( nr_sequencia,
													nr_seq_documento_secao,
													dt_atualizacao,
													nm_usuario,
													dt_atualizacao_nrec,
													nm_usuario_nrec,
													nr_seq_apresentacao,
													ie_modo,
													nm_atributo,
													nr_seq_grupo_pg,
													nr_seq_tipo_pg,
													nr_seq_score_flex,
													nr_ficha_tecnica,
													ie_tipo_dosagem,
													ie_controla_adep,
													nr_seq_gas,
													cd_material,
													cd_grupo_material,
													cd_subgrupo_material,
													cd_classe_material,
													ie_evolucao_clinica,
													nr_seq_inf_adic,
													ie_membro,
													ie_trend,
													ie_mark_exceeded_value_chart,
													ie_grafico,
													ie_aparelho_pa,
													nr_seq_exame,
													nr_seq_linked_data,
													nr_seq_superior,
													nr_ordem_composto,
													ie_evento_tipo,
													ie_tipo_elemento,
													nr_seq_tipo_registro,
													nr_seq_diagnostico,
													ie_tipo_agrupamento)
				SELECT								nextval('documento_subsecao_seq'),
													nr_seq_documento_secao_p,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													nr_seq_apresentacao_p,
													'A',
													a.nm_atributo,
													nr_seq_grupo_pg_w,
													nr_seq_tipo_pg_w,
													nr_seq_score_flex_w,
													nr_ficha_tecnica_w,
													ie_tipo_dosagem_p,
													'N',
													nr_seq_gas_w,
													cd_material_w,
													cd_grupo_material_w,
													cd_subgrupo_material_w,
													cd_classe_material_w,
													ie_evolucao_clinica_w,
													nr_seq_inf_adic_p,
													ie_membro_p,
													'N',
													'N',
													'N',
													ie_aparelho_pa_p,
													nr_seq_exame_w,
													nr_seq_linked_data_subsecao_ww,
													nr_seq_doc_subsecao_w,
													b.nr_seq_apresentacao,
													ie_evento_tipo_w,
													ie_tipo_elemento_w,
													nr_seq_tipo_registro_w,
													nr_seq_diag_w,
													ie_tipo_agrupamento_w
				from ( SELECT  nm_atributo,
															  nr_seq_exame
													  from    w_apap_localizador
													  where   nr_seq_linked_data = 374
													  and	  nm_usuario = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type
													  and	  ie_composto_tree = 'S') a,
													( select  a.nm_atributo_linked nm_atributo,
															  b.nr_seq_apresentacao
													  from    linked_data_atributo a,
															  linked_data_atrib_comp b
													  where   a.nr_sequencia = b.nr_seq_atrib_comp
													  and     a.nr_seq_linked_data = 374) b
				where   a.nm_atributo 	= b.nm_atributo
				and     a.nr_seq_exame  = nr_seq_exame_w;
			elsif (coalesce(nr_seq_temp_conteudo_w::text, '') = '') then
				insert	into	documento_subsecao( nr_sequencia,
													nr_seq_documento_secao,
													dt_atualizacao,
													nm_usuario,
													dt_atualizacao_nrec,
													nm_usuario_nrec,
													nr_seq_apresentacao,
													ie_modo,
													nm_atributo,
													nr_seq_grupo_pg,
													nr_seq_tipo_pg,
													nr_seq_score_flex,
													nr_ficha_tecnica,
													ie_tipo_dosagem,
													ie_controla_adep,
													nr_seq_gas,
													cd_material,
													cd_grupo_material,
													cd_subgrupo_material,
													cd_classe_material,
													ie_evolucao_clinica,
													nr_seq_inf_adic,
													ie_membro,
													ie_aparelho_pa,
													nr_seq_exame,
													nr_seq_linked_data,
													nr_seq_superior,
													nr_ordem_composto,
													ie_evento_tipo,
													ie_tipo_elemento,
													nr_seq_tipo_registro,
													nr_seq_diagnostico,
													ie_tipo_agrupamento,
													ie_mostrar_linha_sup,
													ds_texto_antes,
													ds_texto_depois,
													ie_trend,
													ie_mark_exceeded_value_chart,
													ie_grafico)
				SELECT								nextval('documento_subsecao_seq'),
													nr_seq_documento_secao_p,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													nr_seq_apresentacao_p,
													'A',
													c.nm_atributo_linked,
													nr_seq_grupo_pg_w,
													nr_seq_tipo_pg_w,
													nr_seq_score_flex_w,
													nr_ficha_tecnica_w,
													ie_tipo_dosagem_p,
													'N',
													nr_seq_gas_w,
													cd_material_w,
													cd_grupo_material_w,
													cd_subgrupo_material_w,
													cd_classe_material_w,
													ie_evolucao_clinica_w,
													nr_seq_inf_adic_p,
													ie_membro_p,
													ie_aparelho_pa_w,
													nr_seq_exame_w,
													nr_seq_linked_data_subsecao_ww,
													nr_seq_doc_subsecao_w,
													b.nr_seq_apresentacao,
													ie_evento_tipo_w,
													ie_tipo_elemento_w,
													nr_seq_tipo_registro_w,
													nr_seq_diag_w,
													ie_tipo_agrupamento_w,
													coalesce(b.ie_mostrar_linha_sup,'N'),
													b.ds_texto_antes,
													b.ds_texto_depois,
													'N',
													'N',
													'N'
				from     							w_apap_localizador a,
													linked_data_atrib_comp b,
													linked_data_atributo c
				where    							a.nr_seq_atributo 	= b.nr_seq_atrib
				and									c.nr_sequencia		= b.nr_seq_atrib_comp
				and									a.nm_usuario = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type
				and									a.nr_sequencia 		= nr_sequencia_p;
			else	
				insert	into	documento_subsecao( nr_sequencia,
													nr_seq_documento_secao,
													dt_atualizacao,
													nm_usuario,
													dt_atualizacao_nrec,
													nm_usuario_nrec,
													nr_seq_apresentacao,
													ie_modo,
													nm_atributo,
													nr_seq_grupo_pg,
													nr_seq_tipo_pg,
													nr_seq_score_flex,
													nr_ficha_tecnica,
													ie_tipo_dosagem,
													ie_controla_adep,
													nr_seq_gas,
													cd_material,
													cd_grupo_material,
													cd_subgrupo_material,
													cd_classe_material,
													ie_evolucao_clinica,
													nr_seq_inf_adic,
													ie_membro,
													ie_aparelho_pa,
													nr_seq_exame,
													nr_seq_linked_data,
													nr_seq_superior,
													nr_ordem_composto,
													ie_evento_tipo,
													ie_tipo_elemento,
													nr_seq_tipo_registro,
													nr_seq_diagnostico,
													ie_tipo_agrupamento,
													nr_seq_temp_conteudo,
													ie_trend,
													ie_mark_exceeded_value_chart,
													ie_grafico)
				SELECT								nextval('documento_subsecao_seq'),
													nr_seq_documento_secao_p,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													clock_timestamp(),
													current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type,
													nr_seq_apresentacao_p,
													'A',
													a.nm_atributo,
													nr_seq_grupo_pg_w,
													nr_seq_tipo_pg_w,
													nr_seq_score_flex_w,
													nr_ficha_tecnica_w,
													ie_tipo_dosagem_p,
													'N',
													nr_seq_gas_w,
													cd_material_w,
													cd_grupo_material_w,
													cd_subgrupo_material_w,
													cd_classe_material_w,
													ie_evolucao_clinica_w,
													nr_seq_inf_adic_p,
													ie_membro_p,
													ie_aparelho_pa_w,
													nr_seq_exame_w,
													nr_seq_linked_data_subsecao_ww,
													nr_seq_doc_subsecao_w,
													a.nr_seq_apresent,
													ie_evento_tipo_w,
													ie_tipo_elemento_w,
													nr_seq_tipo_registro_w,
													nr_seq_diag_w,
													ie_tipo_agrupamento_w,
													a.nr_seq_temp_conteudo,
													'N',
													'N',
													'N'
				from     							w_apap_localizador a
				where								a.nr_seq_atributo = nr_seq_temp_conteudo_w
				and									a.nm_usuario = current_setting('localizador_subsecao_pck.nm_usuario_w')::usuario.nm_usuario%type
				and									a.ie_composto_tree = 'S';
			end if;
		end if;
	end if;	
	commit;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE localizador_subsecao_pck.atualizar_subsecao ( nr_seq_documento_secao_p bigint, nr_sequencia_p bigint, nr_seq_apresentacao_p bigint, ie_tipo_dosagem_p text, nr_seq_inf_adic_p bigint, ie_membro_p text, ie_aparelho_pa_p text, ie_pupila_lado_p text, ds_lista_removidos_p text) FROM PUBLIC;
