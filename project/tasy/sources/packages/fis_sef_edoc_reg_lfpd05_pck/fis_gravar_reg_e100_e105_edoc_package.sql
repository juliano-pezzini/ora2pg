-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/*Gravação dos registro e100 e e105*/

CREATE OR REPLACE PROCEDURE fis_sef_edoc_reg_lfpd05_pck.fis_gravar_reg_e100_e105_edoc () AS $body$
BEGIN
/*Grava o registro e100 para depois o e105, pois precisa do nr_sequencia gravado para poder inserir o nr_seq_superior do e105*/

forall i in current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e100_w')::registro_e100.first .. current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e100_w')::registro_e100.last
	insert into fis_sef_edoc_e100 values current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e100_w')::registro_e100(i);

/*Limpa o array*/

current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e100_w')::registro_e100.delete;

/*Grava o e025*/

forall i in current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e105_w')::registro_e105.first .. current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e105_w')::registro_e105.last
	insert into fis_sef_edoc_e105 values current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e105_w')::registro_e105(i);

/*Limpa o array*/

current_setting('fis_sef_edoc_reg_lfpd05_pck.fis_registros_e105_w')::registro_e105.delete;

commit;

PERFORM set_config('fis_sef_edoc_reg_lfpd05_pck.qt_cursor_e100_w', 0, false);
PERFORM set_config('fis_sef_edoc_reg_lfpd05_pck.qt_cursor_e105_w', 0, false);

/*Libera memoria*/

dbms_session.free_unused_user_memory;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_sef_edoc_reg_lfpd05_pck.fis_gravar_reg_e100_e105_edoc () FROM PUBLIC;
