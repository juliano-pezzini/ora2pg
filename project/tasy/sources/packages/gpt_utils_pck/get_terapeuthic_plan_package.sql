-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


--
-- dblink wrapper to call function gpt_utils_pck.get_terapeuthic_plan() as an autonomous transaction
--
CREATE EXTENSION IF NOT EXISTS dblink;

CREATE OR REPLACE FUNCTION gpt_utils_pck.get_terapeuthic_plan (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_param_1_p text, ie_status_analise_p text, ie_lib_enfermagem_p text, ie_lib_farmacia_p text, ie_dispensacao_p text, ie_vigentes_p text, ie_tipo_ativacao_p text default 'T', qt_horas_quimio_p bigint default 0, ie_suspenso_p text default 'S') RETURNS SETOF T_ITEM AS $body$
DECLARE
	-- Change this to reflect the dblink connection string
	v_conn_str  text := format('port=%s dbname=%s user=%s', current_setting('port'), current_database(), current_user);
	v_query     text;

	v_ret	T_ITEM;
BEGIN
	v_query := 'SELECT * FROM gpt_utils_pck.get_terapeuthic_plan_atx ( ' || quote_nullable(nr_atendimento_p) || ',' || quote_nullable(cd_pessoa_fisica_p) || ',' || quote_nullable(ie_param_1_p) || ',' || quote_nullable(ie_status_analise_p) || ',' || quote_nullable(ie_lib_enfermagem_p) || ',' || quote_nullable(ie_lib_farmacia_p) || ',' || quote_nullable(ie_dispensacao_p) || ',' || quote_nullable(ie_vigentes_p) || ',' || quote_nullable(ie_tipo_ativacao_p) || ',' || quote_nullable(qt_horas_quimio_p) || ',' || quote_nullable(ie_suspenso_p) || ' )';
	SELECT * INTO v_ret FROM dblink(v_conn_str, v_query) AS p (ret T_ITEM);
	RETURN v_ret;

END;
$body$ LANGUAGE plpgsql SECURITY DEFINER;




CREATE OR REPLACE FUNCTION gpt_utils_pck.get_terapeuthic_plan_atx (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_param_1_p text, ie_status_analise_p text, ie_lib_enfermagem_p text, ie_lib_farmacia_p text, ie_dispensacao_p text, ie_vigentes_p text, ie_tipo_ativacao_p text default 'T', qt_horas_quimio_p bigint default 0, ie_suspenso_p text default 'S') RETURNS SETOF T_ITEM AS $body$
DECLARE


	line_w			t_item_row;
	line_nutri_w		t_item_row;
	line_proc_w			t_item_row;
	prev_group_type_w	varchar(10)	:= -1;
	prev_item_type_w	varchar(10)	:= -1;
	ds_espaco_w				varchar(255) := chr(38)||'nbsp;'||chr(38)||'nbsp;'||chr(38)||'nbsp;';
	ie_type_cons_w		varchar(10) :='';
	ie_si_order4_w		bigint := 0;
	nr_seq_reg_item_w	cpoe_material.nr_sequencia%type;
	ds_hor_prox_adm_w	varchar(2000);
	qt_horas_quimio_w	bigint;

	ie_profissional_w       varchar(10) := 0;
	ie_dominio_profissional_w bigint := 0;
	
	cd_estabelecimento_w 	estabelecimento.cd_estabelecimento%type;
	cd_perfil_w				perfil.cd_perfil%type;
    nm_usuario_w    		usuario.nm_usuario%type;
	
	ie_param_62_w			varchar(1);
	ie_item_lib_hor_w		varchar(1);
	ie_dieta_enteral_w		cpoe_dieta.ie_dieta_enteral%type;
	ie_micromedex_ivc_w cliente_integracao.ie_situacao%TYPE;

	ie_param_cpoe_35_w varchar(2);
	ie_formato_administracao_w varchar(20);
	total_dose_w varchar(20);

		C01 CURSOR FOR
			SELECT	a.*
	from (
		SELECT	si_order,
		        si_order2, 
                si_order3, 
                si_order4, 
                nr_sequencia, 
                ds_item, 
                cd_pessoa_fisica, 
                nr_atendimento, 
                ds_interval, 
                ds_horarios, 
                si_group_type, 
                ds_group, 
                si_item_type, 
                ds_item_type, 
                ds_administration, 
                dt_lib_suspensao, 
                dt_inicio, 
                dt_fim, 
                dt_liberacao, 
                dt_liberacao_enfermagem, 
                dt_liberacao_farmacia, 
                dt_revalidacao, 
                ie_lib_pendente_enf, 
                ie_lib_pendente_farm, 
                ie_item_conf_enf, 
                ie_item_conf_farm, 
                ie_retrogrado, 
                dt_suspensao, 
                dt_lib_suspensao_p, 
                nr_seq_apresent_acm_sn, 
                nr_seq_apresent_subgrupo, 
                nr_seq_apresent_item, 
                nr_seq_apresentacao, 
                ie_urgencia, 
                dt_adm_adicional, 
                dt_programada, 
                dt_inicio_hem1,
                dt_inicio_hem2, 
                dt_inicio_hem3, 
                dt_inicio_hem4, 
                dt_inicio_hem5, 
                dt_inicio_proc1, 
                dt_inicio_proc2, 
                dt_inicio_proc3, 
                dt_inicio_proc4, 
                dt_inicio_proc5, 
                dt_inicio_proc6, 
                dt_inicio_proc7, 
                ds_hor_prox_adm, 
                ds_protocolo, 
                ds_subtipo_protocolo, 
                ie_acm, 
                ie_se_necessario, 
                ie_interv_operacao,
                cd_funcao_origem, 
                nm_usuario_nrec, 
                ie_pend_reval, 
                ie_itm_pend_reval, 
                ie_oncologia, 
                ie_paciente_alergico, 
                ds_alertas, 
                ie_medic_controlado, 
                ie_material_alto_risco, 
                ie_mat_alto_custo, 
                ie_mat_composto, 
                ie_medicacao_paciente, 
                ie_padronizado, 
                dt_fim_cih, 
                ie_sem_aprazamento, 
                dt_protocolo_onc, 
                ie_segunda, 
                ie_terca, 
                ie_quarta, 
                ie_quinta, 
                ie_sexta, 
                ie_sabado, 
                ie_domingo
		from	tpm_all_items_v
		where	nr_atendimento	= nr_atendimento_p
		and		(nr_atendimento_p IS NOT NULL AND nr_atendimento_p::text <> '')
		
union all

		select	si_order, 
		        si_order2, 
                si_order3, 
                si_order4, 
                nr_sequencia, 
                ds_item, 
                cd_pessoa_fisica, 
                nr_atendimento, 
                ds_interval, 
                ds_horarios, 
                si_group_type, 
                ds_group, 
                si_item_type, 
                ds_item_type, 
                ds_administration, 
                dt_lib_suspensao, 
                dt_inicio, 
                dt_fim, 
                dt_liberacao, 
                dt_liberacao_enfermagem, 
                dt_liberacao_farmacia, 
                dt_revalidacao, 
                ie_lib_pendente_enf, 
                ie_lib_pendente_farm, 
                ie_item_conf_enf, 
                ie_item_conf_farm, 
                ie_retrogrado, 
                dt_suspensao, 
                dt_lib_suspensao_p, 
                nr_seq_apresent_acm_sn, 
                nr_seq_apresent_subgrupo, 
                nr_seq_apresent_item, 
                nr_seq_apresentacao, 
                ie_urgencia, 
                dt_adm_adicional, 
                dt_programada, 
                dt_inicio_hem1,
                dt_inicio_hem2, 
                dt_inicio_hem3, 
                dt_inicio_hem4, 
                dt_inicio_hem5, 
                dt_inicio_proc1, 
                dt_inicio_proc2, 
                dt_inicio_proc3, 
                dt_inicio_proc4, 
                dt_inicio_proc5, 
                dt_inicio_proc6, 
                dt_inicio_proc7, 
                ds_hor_prox_adm, 
                ds_protocolo, 
                ds_subtipo_protocolo, 
                ie_acm, 
                ie_se_necessario, 
                ie_interv_operacao,
                cd_funcao_origem, 
                nm_usuario_nrec, 
                ie_pend_reval, 
                ie_itm_pend_reval, 
                ie_oncologia, 
                ie_paciente_alergico, 
                ds_alertas, 
                ie_medic_controlado, 
                ie_material_alto_risco, 
                ie_mat_alto_custo, 
                ie_mat_composto, 
                ie_medicacao_paciente, 
                ie_padronizado, 
                dt_fim_cih, 
                ie_sem_aprazamento, 
                dt_protocolo_onc, 
                ie_segunda, 
                ie_terca, 
                ie_quarta, 
                ie_quinta, 
                ie_sexta, 
                ie_sabado, 
                ie_domingo
		from	tpm_all_items_v
		where	cd_pessoa_fisica	= cd_pessoa_fisica_p
		and		coalesce(nr_atendimento_p::text, '') = ''
		) a
		where ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or (a.si_order2 <> 0 and (dt_liberacao_enfermagem IS NOT NULL AND dt_liberacao_enfermagem::text <> '')))
		and (ie_status_analise_p = '0'		
		or (ie_status_analise_p = '1' and ((ie_param_1_p = 'E' and ie_item_conf_enf = 'S') or (ie_param_1_p = 'F' and ie_item_conf_farm = 'S')))		
		or (ie_status_analise_p = '2' and (
			(ie_param_1_p = 'E' and ie_lib_pendente_enf = 'S' and ((coalesce(ie_param_62_w,'N') = 'N') or obter_se_item_lib_hor_gpt(a.si_item_type, a.nr_sequencia) = 'N')) or 
			(ie_param_1_p = 'F' and ie_lib_pendente_farm = 'S' and ((coalesce(ie_param_62_w,'N') = 'N') or obter_se_item_lib_hor_gpt(a.si_item_type, a.nr_sequencia) = 'N')))))		
		and (ie_lib_enfermagem_p = '2' or (ie_lib_enfermagem_p = '0' and (dt_liberacao_enfermagem IS NOT NULL AND dt_liberacao_enfermagem::text <> '')) or (ie_lib_enfermagem_p = '1' and coalesce(dt_liberacao_enfermagem::text, '') = ''))
		and (ie_lib_farmacia_p = '2' or (ie_lib_farmacia_p = '0' and (dt_liberacao_farmacia IS NOT NULL AND dt_liberacao_farmacia::text <> '')) or (ie_lib_farmacia_p = '1' and coalesce(dt_liberacao_farmacia::text, '') = ''))
		and (ie_dispensacao_p = '2' or (ie_dispensacao_p = '0' and (select	max(coalesce(x.ie_regra_disp,'S'))
																from	prescr_material x left join cpoe_material y ON (y.nr_sequencia = x.nr_seq_mat_cpoe)
																where	y.nr_sequencia	= a.nr_sequencia) = 'U') or (ie_dispensacao_p = '1' and (select	max(coalesce(x.ie_regra_disp,'S'))
																from	prescr_material x left join cpoe_material y ON (y.nr_sequencia = x.nr_seq_mat_cpoe)
																where	y.nr_sequencia	= a.nr_sequencia) = 'S'))
		and (ie_vigentes_p = 'N' or ((cpoe_reg_valido_ativacao(CASE WHEN coalesce(a.dt_lib_suspensao::text, '') = '' THEN  coalesce(a.dt_fim_cih,a.dt_fim)  ELSE coalesce(a.dt_suspensao,coalesce(a.dt_fim_cih,a.dt_fim)) END  ,a.dt_inicio, clock_timestamp(), a.cd_funcao_origem, null, null, null, null, null, null, qt_horas_quimio_p) = 'S') OR (a.ie_retrogrado = 'S'
		and  coalesce(a.dt_liberacao::text, '') = '')))
		and  ((a.cd_funcao_origem in (2314,916)) or (trunc(a.dt_inicio,'mi') < fim_dia(clock_timestamp())) or (a.si_item_type in ('M','SOL') and cpoe_obter_se_item_oncologia(nr_sequencia,a.si_item_type) = 'S' and trunc(a.dt_inicio,'mi') < (clock_timestamp() + (qt_horas_quimio_w / 24))))
		and	nr_sequencia > 0
		and	((ie_suspenso_p = 'N' and coalesce(a.dt_lib_suspensao::text, '') = '') or ie_suspenso_p = 'S')
				 -- Todos os itens

				and ((ie_tipo_ativacao_p = 'T' AND 1=1) 	or  	-- Retrogrado
				    ((ie_tipo_ativacao_p = 'R') and (		--Itens
							coalesce(a.ie_urgencia::text, '') = ''
						and     a.ie_acm <> 'S'
						and     a.ie_se_necessario <> 'S'
						and (obter_dif_data(a.dt_inicio, clock_timestamp(), 'TM') < 1440)
						and (cpoe_horarios_prescr_lib(a.nr_sequencia, a.si_item_type) = 'N')
						and     (trunc(a.dt_inicio,'mi') < trunc(clock_timestamp(),'mi') or (a.si_item_type in ('M','SOL') and cpoe_obter_se_item_oncologia(nr_sequencia,a.si_item_type) = 'S' and trunc(a.dt_inicio,'mi') < (clock_timestamp() + (qt_horas_quimio_w / 24))))
						and     coalesce(a.dt_suspensao::text, '') = ''
						and     a.si_group_type not in ('I','AP')
						and     a.ie_interv_operacao <> 'F'
						and 	((coalesce(a.ie_retrogrado,'N') <> 'S') or (coalesce(a.dt_liberacao::text, '') = ''))
						and (coalesce(coalesce(a.dt_fim_cih,a.dt_fim)::text, '') = ''  or (Obter_prox_hora_cheia_gpt(clock_timestamp())  <  coalesce(a.dt_fim_cih,a.dt_fim)))
						--Hemoterapia

						and     ((a.si_group_type <> 'H') or
   						         ((coalesce(a.dt_programada::text, '') = '' or trunc(clock_timestamp(),'mi') < trunc(a.dt_programada, 'mi'))
							and (coalesce(a.dt_inicio_hem1::text, '') = '' or trunc(a.dt_inicio_hem1,'mi') = trunc(a.dt_programada,'mi'))
							and (coalesce(a.dt_inicio_hem2::text, '') = '' or trunc(a.dt_inicio_hem2,'mi') = trunc(a.dt_programada,'mi'))
							and (coalesce(a.dt_inicio_hem3::text, '') = '' or trunc(a.dt_inicio_hem3,'mi') = trunc(a.dt_programada,'mi'))
							and (coalesce(a.dt_inicio_hem4::text, '') = '' or trunc(a.dt_inicio_hem4,'mi') = trunc(a.dt_programada,'mi'))
							and (coalesce(a.dt_inicio_hem5::text, '') = '' or trunc(a.dt_inicio_hem5,'mi') = trunc(a.dt_programada,'mi'))))
						-- materiais

						and     ((a.si_group_type <> 'M')or (coalesce(a.dt_adm_adicional::text, '') = '' or trunc(a.dt_adm_adicional,'mi') = trunc(a.dt_inicio,'mi')))
						--Procedimentos

						and     ((a.si_group_type <> 'P')
						or     ((coalesce(a.dt_inicio_proc1::text, '') = '' or trunc(a.dt_inicio_proc1,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc2::text, '') = '' or trunc(a.dt_inicio_proc2,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc3::text, '') = '' or trunc(a.dt_inicio_proc3,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc4::text, '') = '' or trunc(a.dt_inicio_proc4,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc5::text, '') = '' or trunc(a.dt_inicio_proc5,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc6::text, '') = '' or trunc(a.dt_inicio_proc6,'mi') = trunc(a.dt_inicio,'mi'))
						and (coalesce(a.dt_inicio_proc7::text, '') = '' or trunc(a.dt_inicio_proc7,'mi') = trunc(a.dt_inicio,'mi'))))))
				or  (((ie_tipo_ativacao_p = 'C' ) and coalesce(a.dt_suspensao::text, '') = ''
						and coalesce(a.ie_urgencia::text, '') = ''
						and     a.ie_acm <> 'S'
						and     a.ie_se_necessario <> 'S'
						and (obter_dif_data(a.dt_inicio, clock_timestamp(), 'TM') < 1440)
						and (cpoe_horarios_prescr_lib(a.nr_sequencia, a.si_item_type) = 'N')
						and trunc(a.dt_inicio,'mi') < trunc(clock_timestamp(),'mi')
						and     a.si_group_type <> 'I'
						and     a.ie_interv_operacao <> 'F'
						and (coalesce(a.dt_fim::text, '') = ''  or (Obter_prox_hora_cheia_gpt(clock_timestamp())  <  a.dt_fim))
						and (
						-- Complexo

							coalesce(a.ie_urgencia::text, '') = ''
						--Hemoterapia

						and     (((a.dt_programada IS NOT NULL AND a.dt_programada::text <> '') and trunc(clock_timestamp(),'mi') > trunc(a.dt_programada, 'mi'))
						or      (((a.dt_inicio_hem1 IS NOT NULL AND a.dt_inicio_hem1::text <> '') and trunc(a.dt_inicio_hem1,'mi') <> trunc(a.dt_programada,'mi'))
						or ((a.dt_inicio_hem2 IS NOT NULL AND a.dt_inicio_hem2::text <> '') and trunc(a.dt_inicio_hem2,'mi') <> trunc(a.dt_programada,'mi'))
						or ((a.dt_inicio_hem3 IS NOT NULL AND a.dt_inicio_hem3::text <> '') and trunc(a.dt_inicio_hem3,'mi') <> trunc(a.dt_programada,'mi'))
						or ((a.dt_inicio_hem4 IS NOT NULL AND a.dt_inicio_hem4::text <> '') and trunc(a.dt_inicio_hem4,'mi') <> trunc(a.dt_programada,'mi'))
						or ((a.dt_inicio_hem5 IS NOT NULL AND a.dt_inicio_hem5::text <> '') and trunc(a.dt_inicio_hem5,'mi') <> trunc(a.dt_programada,'mi'))))
						-- materiais

						or ((a.dt_adm_adicional IS NOT NULL AND a.dt_adm_adicional::text <> '') and trunc(a.dt_adm_adicional,'mi') <> trunc(a.dt_inicio,'mi'))
						--Procedimentos

						or      ((((a.dt_inicio_proc1 IS NOT NULL AND a.dt_inicio_proc1::text <> '') and trunc(a.dt_inicio_proc1,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc2 IS NOT NULL AND a.dt_inicio_proc2::text <> '') and trunc(a.dt_inicio_proc2,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc3 IS NOT NULL AND a.dt_inicio_proc3::text <> '') and trunc(a.dt_inicio_proc3,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc4 IS NOT NULL AND a.dt_inicio_proc4::text <> '') and trunc(a.dt_inicio_proc4,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc5 IS NOT NULL AND a.dt_inicio_proc5::text <> '') and trunc(a.dt_inicio_proc5,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc6 IS NOT NULL AND a.dt_inicio_proc6::text <> '') and trunc(a.dt_inicio_proc6,'mi') <> trunc(a.dt_inicio,'mi'))
						or ((a.dt_inicio_proc7 IS NOT NULL AND a.dt_inicio_proc7::text <> '') and trunc(a.dt_inicio_proc7,'mi') <> trunc(a.dt_inicio,'mi'))))))))
				order by si_group_type, si_item_type;
BEGIN
		cd_estabelecimento_w	:= wheb_usuario_pck.get_cd_estabelecimento;
		cd_perfil_w				:= obter_perfil_ativo;
		nm_usuario_w			:= wheb_usuario_pck.get_nm_usuario;
		
		obter_param_usuario(252, 62, cd_perfil_w, nm_usuario_w, cd_estabelecimento_w, ie_param_62_w);
		
		qt_horas_quimio_w	:= coalesce(qt_horas_quimio_p,0);

		for r_c01 in c01 loop
		begin
            select b.ie_formato_administracao into STRICT ie_formato_administracao_w from cpoe_material a, via_aplicacao b
                where a.ie_via_aplicacao = b.ie_via_aplicacao and a.nr_sequencia = r_c01.nr_sequencia;
            exception
                when no_data_found then
                ie_formato_administracao_w := null;
        end;

         if (coalesce(pkg_i18n.get_user_locale, 'pt_BR') = 'ja_JP') then
            if (ie_formato_administracao_w = 'TD') then
                total_dose_w :=  ' (' || WHEB_MENSAGEM_PCK.get_texto(1153579) || ')';
            else
                total_dose_w := null;
            end if;
        end if;

		ie_profissional_w := gpt_obter_Profissional_Usuario(r_c01.nm_usuario_nrec);

		if(('S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo, r_c01.si_group_type)) and (
				(((ie_profissional_w IS NOT NULL AND ie_profissional_w::text <> '') and  gpt_funcao_prescr_liberada(Obter_perfil_Ativo ,ie_profissional_w) = 'S') or
				 ((coalesce(ie_profissional_w::text, '') = '') and gpt_funcao_prescr_liberada(Obter_perfil_Ativo ,r_c01.si_order4) = 'S')))) then
		/* Generate title */


			if (r_c01.si_item_type = 'SNE') then
			  ie_type_cons_w := 'E';
			elsif (r_c01.si_item_type = 'LD') then
			 ie_type_cons_w := 'L';
			elsif (r_c01.si_item_type = 'D') then
			  ie_type_cons_w := 'O';
			else
			 ie_type_cons_w := r_c01.si_item_type;
			end if;

			if (r_c01.si_group_type <> prev_group_type_w ) then
					line_w.nr_sequencia	:= null;
					line_w.ds_item		:= null;
					line_w.cd_pessoa_fisica	:= r_c01.cd_pessoa_fisica;
					line_w.nr_atendimento	:= r_c01.nr_atendimento;
					line_w.ds_interval	:= null;
					line_w.ds_horarios	:= null;
					line_w.si_group_type	:= r_c01.si_group_type;
					line_w.si_item_type	:= r_c01.si_item_type;
					line_w.ie_pend_reval := r_c01.ie_pend_reval;
					line_w.ie_itm_pend_reval   := null;
					

					/*Group */



					if (r_c01.si_group_type = 'N' and (
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'D')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'SNE')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'S')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'J')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'LD')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'NPTA')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'NI')
						 )) then

						line_w.ds_group	:= obter_valor_dominio(7768,'N');
						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'N', 'G')::text, '') = '')then
							line_w.si_order := 1000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'N', 'G') * 10);
						end if;
					elsif (r_c01.si_group_type = 'DIA') then
						line_w.ds_group	:= obter_valor_dominio(7768,'D');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'D', 'G')::text, '') = '')then
							line_w.si_order := 7000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'D', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'G') then
						line_w.ds_group	:= obter_valor_dominio(7768,'G');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'G', 'G')::text, '') = '')then
							line_w.si_order := 4000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'G', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'H') then
						line_w.ds_group	:= obter_valor_dominio(7768,'H');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'H', 'G')::text, '') = '')then
							line_w.si_order := 6000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'H', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'I') then
						line_w.ds_group	:= obter_valor_dominio(7768,'I');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'I', 'G')::text, '') = '')then
							line_w.si_order := 10000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'I', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'M') then
						line_w.ds_group	:= obter_valor_dominio(7768,'M');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'M', 'G')::text, '') = '')then
							line_w.si_order := 2000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'M', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'R') then
						line_w.ds_group	:= obter_valor_dominio(7768,'R');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'R', 'G')::text, '') = '')then
							line_w.si_order := 5000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'R', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'P') then

						line_w.ds_group	:= obter_valor_dominio(7768,'P');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'P', 'G')::text, '') = '')then
							line_w.si_order := 3000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'P', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'MA') then
						line_w.ds_group	:= obter_valor_dominio(7768,'MA');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'MA', 'G')::text, '') = '')then
							line_w.si_order := 8000000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'MA', 'G')*10);
						end if;
					elsif (r_c01.si_group_type = 'AP') then

						line_w.ds_group	:= obter_valor_dominio(7768,'AP');

						if (coalesce(obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'AP', 'G')::text, '') = '')then
							line_w.si_order := 9500000;
						else
							line_w.si_order := (obter_posicao_grupo(obter_estabelecimento_ativo, Obter_perfil_Ativo, obter_setor_ativo, Obter_Usuario_Ativo, 'AP', 'G')*10);
						end if;
					end if;

					line_w.ds_item		:= '<strong>' || line_w.ds_group || '</strong>';
					
					/* Sub group */


					line_w.ds_item_type	:= null;

					line_w.ds_administration	:= null;
					line_w.dt_lib_suspensao		:= null;
					line_w.dt_inicio			:= null;
					line_w.dt_fim				:= null;
					line_w.dt_liberacao			:= null;
					line_w.dt_liberacao_enfermagem	:= null;
					line_w.dt_liberacao_farmacia	:= null;
					line_w.dt_revalidacao			:= null;
					line_w.ie_lib_pendente_enf	:= null;
					line_w.ie_lib_pendente_farm	:= null;
					line_w.ie_item_conf_enf		:= null;
					line_w.ie_item_conf_farm	:= null;
					line_w.ie_retrogrado		:= null;
					line_w.dt_suspensao		:= null;
					line_w.ie_pend_reval := r_c01.ie_pend_reval;
					line_w.ie_itm_pend_reval   := null;
					
					if (r_c01.si_group_type = 'N') then
					    line_nutri_w := line_w;
					else
					    RETURN NEXT line_w;
						line_w := null;
					end if;
			end if;

			nr_seq_reg_item_w := coalesce(r_c01.nr_sequencia,0);

			ds_hor_prox_adm_w := '';

			if (nr_seq_reg_item_w > 0) and (r_c01.si_item_type <> 'MAT') and -- Material
				(r_c01.si_item_type <> 'I') and -- Intervencao de enfermagem
				(r_c01.si_item_type <> 'DI') then -- Hemodialise

				case coalesce(r_c01.si_item_type,'XPTO')
					when 'O' then -- Gasoterapia
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_gasoterapia','prescr_gasoterapia','nr_seq_gas_cpoe','prescr_gasoterapia_hor','nr_seq_gasoterapia',null,nr_seq_reg_item_w);
					when 'HM' then --Hemoterapia
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_hemoterapia','prescr_procedimento','nr_seq_proc_cpoe','prescr_proc_hor','nr_seq_procedimento',null,nr_seq_reg_item_w);
					when 'M' then -- Medicamento
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_material','prescr_material','nr_seq_mat_cpoe','prescr_mat_hor','nr_seq_material',null,nr_seq_reg_item_w);
					when 'SOL' then -- Solucao
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_material','prescr_material','nr_seq_mat_cpoe','prescr_mat_hor','nr_seq_material',null,nr_seq_reg_item_w);
					when 'SNE' then -- SNE
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_dieta','prescr_material','nr_seq_dieta_cpoe','prescr_mat_hor','nr_seq_material','and ie_tipo_dieta  = ''E''',nr_seq_reg_item_w);
					when 'J' then -- Jejum
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_dieta',null,null,null,null,'and ie_tipo_dieta  = ''J''',nr_seq_reg_item_w);
					when 'LD' then -- Leites e Derivados
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_dieta',null,null,null,null,'and ie_tipo_dieta  = ''L''',nr_seq_reg_item_w);
					when 'D' then -- Dieta
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_dieta','prescr_dieta','nr_seq_dieta_cpoe','prescr_dieta_hor','nr_seq_dieta','and ie_tipo_dieta  = ''O''',nr_seq_reg_item_w);
					when 'S' then -- Suplemento oral
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_dieta','prescr_material','nr_seq_dieta_cpoe','prescr_mat_hor','nr_seq_material','and ie_tipo_dieta  = ''S''',nr_seq_reg_item_w);
					when 'P' then -- Procedimento
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_procedimento','prescr_procedimento','nr_seq_proc_cpoe','prescr_proc_hor','nr_seq_procedimento',null,nr_seq_reg_item_w);
					when 'R' then -- Recomendacao
						ds_hor_prox_adm_w := obter_ds_hor_prox_adm('cpoe_recomendacao','prescr_recomendacao','nr_seq_rec_cpoe','prescr_rec_hor','nr_seq_recomendacao',null,nr_seq_reg_item_w);
					else
						ds_hor_prox_adm_w := '';
				end case;

			end if;

			if (r_c01.si_item_type <> prev_item_type_w) and (r_c01.si_item_type IS NOT NULL AND r_c01.si_item_type::text <> '') and ('S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo, r_c01.si_item_type)) then
					line_w.si_order	:= r_c01.si_order;
					line_w.si_order2	:= r_c01.si_order2;
					line_w.si_order3	:= cpoe_obter_ordem_subgrupo(r_c01.si_group_type, ie_type_cons_w,coalesce(obter_estabelecimento_ativo,0),coalesce(Obter_perfil_Ativo,0),coalesce(obter_setor_ativo,0),Obter_Usuario_Ativo,'G');
					line_w.si_order4	:= ie_si_order4_w;
					line_w.nr_sequencia	:= null;
					line_w.ds_item		:= null;
					line_w.cd_pessoa_fisica	:= r_c01.cd_pessoa_fisica;
					line_w.nr_atendimento	:= r_c01.nr_atendimento;
					line_w.ds_interval	:= null;
					line_w.ds_horarios	:= null;
					line_w.si_group_type	:= r_c01.si_group_type;
					line_w.si_item_type	:= r_c01.si_item_type;
					line_w.ie_itm_pend_reval   := null;
					

					--Group

					line_w.ds_group	:= null;
					

					--Sub group

					if (r_c01.si_group_type = 'N'and (
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'D')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'SNE')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'S')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'J')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'LD')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'NPTA')or
						 'S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo,'NI')
						 )) then
						if (r_c01.si_item_type = 'J') then
							line_w.ds_item_type	:= obter_valor_dominio(7769,'J');
						else
							select max(ie_dieta_enteral)
							into STRICT ie_dieta_enteral_w
								from cpoe_dieta
							where nr_sequencia = r_c01.nr_sequencia;

              Obter_param_Usuario(2314, 35, obter_perfil_ativo, obter_usuario_ativo, obter_estabelecimento_ativo, ie_param_cpoe_35_w);
							if (ie_dieta_enteral_w = 'S' and ie_param_cpoe_35_w = 'S') then
								line_w.ds_item_type	:= obter_desc_expressao(1028131);
							else
								line_w.ds_item_type	:=	cpoe_obter_desc_tipo_item(cpoe_obter_tipo_item('CPOE_DIETA',r_c01.nr_sequencia));
							end if;
						end if;
						if (line_nutri_w.ds_group IS NOT NULL AND line_nutri_w.ds_group::text <> '') then
						    RETURN NEXT line_nutri_w;
						    line_nutri_w := null;
						end if;
						line_w.si_order2	:= 1;
					elsif (r_c01.si_group_type = 'DIA') then
						select	max(CASE WHEN a.ie_tipo_dialise='DP' THEN obter_valor_dominio(7769,'DP')  ELSE obter_valor_dominio(7769,'DI') END )
						into STRICT	line_w.ds_item_type
						from	cpoe_dialise a
						where	a.nr_sequencia	= r_c01.nr_sequencia;
						line_w.si_order2	:= 1;
					elsif (r_c01.si_group_type = 'M') then
						line_w.ds_item_type	:=	cpoe_obter_desc_tipo_item(cpoe_obter_tipo_item('CPOE_MATERIAL',r_c01.nr_sequencia));
						line_w.si_order2	:= 1;

					end if;
					if (line_w.ds_item_type IS NOT NULL AND line_w.ds_item_type::text <> '') then
						line_w.ds_item		:= ds_espaco_w || ds_espaco_w || '<strong>' || line_w.ds_item_type || '</strong>';
						line_w.ds_administration	:= null;
						line_w.dt_lib_suspensao		:= null;
						line_w.dt_inicio			:= null;
						line_w.dt_fim				:= null;
						line_w.dt_liberacao			:= null;
						line_w.dt_liberacao_enfermagem	:= null;
						line_w.dt_liberacao_farmacia	:= null;
						line_w.dt_revalidacao				:= null;
						line_w.ie_lib_pendente_enf	:= null;
						line_w.ie_lib_pendente_farm	:= null;
						line_w.ie_item_conf_enf		:= null;
						line_w.ie_item_conf_farm	:= null;
						line_w.ie_retrogrado		:= null;
						line_w.dt_suspensao		:= null;
						line_w.dt_lib_suspensao_p      := null;
						line_w.nr_seq_apresent_acm_sn  := null;
						line_w.nr_seq_apresent_subgrupo := null;
						line_w.nr_seq_apresent_item := null;
						line_w.nr_seq_apresentacao := null;
						line_w.ie_urgencia := null; ----------------------------------
						line_w.dt_adm_adicional := null;
						line_w.dt_programada := null;
						line_w.dt_inicio_hem1 := null;
						line_w.dt_inicio_hem2 := null;
						line_w.dt_inicio_hem3 := null;
						line_w.dt_inicio_hem4 := null;
						line_w.dt_inicio_hem5 := null;
						line_w.dt_inicio_proc1 := null;
						line_w.dt_inicio_proc2 := null;
						line_w.dt_inicio_proc3 := null;
						line_w.dt_inicio_proc4 := null;
						line_w.dt_inicio_proc5 := null;
						line_w.dt_inicio_proc6 := null;
						line_w.dt_inicio_proc7 := null;
						line_w.ie_pend_reval   := r_c01.ie_pend_reval;
						line_w.ie_itm_pend_reval   := null;
						line_w.ie_paciente_alergico   := null;
						line_w.ds_alertas := null;
						line_w.ie_medic_controlado := null;
						line_w.ie_material_alto_risco := null;
						line_w.ie_mat_alto_custo   := null;
						line_w.ie_mat_composto   := null;
						line_w.ie_medicacao_paciente   := null;
						line_w.ie_padronizado   := null;
						line_w.dt_protocolo_onc := null;
						
						RETURN NEXT line_w;
						line_w := null;
					end if;
			end if;

			prev_group_type_w	:= r_c01.si_group_type;
			prev_item_type_w	:= r_c01.si_item_type;

			line_w.si_order	:= r_c01.si_order;
			line_w.si_order2	:= r_c01.si_order2;
			line_w.si_order3	:= cpoe_obter_ordem_subgrupo(r_c01.si_group_type, ie_type_cons_w,coalesce(obter_estabelecimento_ativo,0),coalesce(Obter_perfil_Ativo,0),coalesce(obter_setor_ativo,0),Obter_Usuario_Ativo,'G');
			line_w.si_order4	:= ie_si_order4_w;
			line_w.nr_sequencia	:= r_c01.nr_sequencia;
			line_w.ds_item	:= ds_espaco_w || ds_espaco_w || ds_espaco_w || ds_espaco_w || REPLACE(r_c01.ds_item, '<br>', ('<br>'||ds_espaco_w || ds_espaco_w || ds_espaco_w || ds_espaco_w))|| total_dose_w;
			line_w.cd_pessoa_fisica	:= r_c01.cd_pessoa_fisica;
			line_w.nr_atendimento	:= r_c01.nr_atendimento;
			line_w.ds_interval	:= r_c01.ds_interval;
			line_w.ds_horarios	:= r_c01.ds_horarios;
			line_w.si_group_type	:= r_c01.si_group_type;
			line_w.ds_group	:= r_c01.ds_group;
			line_w.si_item_type	:= r_c01.si_item_type;
			line_w.ds_item_type	:= r_c01.ds_item_type;
			line_w.ds_administration	:= r_c01.ds_administration;
			line_w.dt_lib_suspensao	:= r_c01.dt_lib_suspensao;
			line_w.dt_inicio	:= r_c01.dt_inicio;
			line_w.dt_fim	:= r_c01.dt_fim;
			line_w.dt_liberacao	:= r_c01.dt_liberacao;
			line_w.dt_liberacao_enfermagem	:= r_c01.dt_liberacao_enfermagem;
			line_w.dt_liberacao_farmacia	:= r_c01.dt_liberacao_farmacia;
			line_w.dt_revalidacao := gpt_obter_dt_ult_reval(r_c01.nr_sequencia, r_c01.si_item_type, r_c01.nr_atendimento);
			line_w.ie_sem_aprazamento := r_c01.ie_sem_aprazamento;
			
			if (coalesce(ie_param_62_w,'N') = 'S') and (line_w.si_group_type in ('R', 'N', 'G', 'P', 'H')) then
				if ((r_c01.ie_lib_pendente_enf = 'S') or (r_c01.ie_lib_pendente_farm = 'S')) then
					ie_item_lib_hor_w := obter_se_item_lib_hor_gpt(line_w.si_item_type, line_w.nr_sequencia);
				
					if (r_c01.ie_lib_pendente_enf = 'S' and ie_item_lib_hor_w = 'N') then
						line_w.ie_lib_pendente_enf := 'S';
					end if;
				
					if (r_c01.ie_lib_pendente_farm = 'S' and ie_item_lib_hor_w = 'N') then
						line_w.ie_lib_pendente_farm := 'S';
					end if;
				end if;
			else
				line_w.ie_lib_pendente_enf	:= r_c01.ie_lib_pendente_enf;
				line_w.ie_lib_pendente_farm	:= r_c01.ie_lib_pendente_farm;			
			end if;			
			
			line_w.ie_item_conf_enf	:= r_c01.ie_item_conf_enf;
			line_w.ie_item_conf_farm	:= r_c01.ie_item_conf_farm;
			line_w.ie_retrogrado	:= r_c01.ie_retrogrado;
			line_w.dt_suspensao	:= r_c01.dt_suspensao;
			line_w.dt_lib_suspensao_p      := r_c01.dt_lib_suspensao_p; --------------------------------------
			line_w.nr_seq_apresent_acm_sn  := r_c01.nr_seq_apresent_acm_sn;
			line_w.nr_seq_apresent_subgrupo := r_c01.nr_seq_apresent_subgrupo;
			line_w.nr_seq_apresent_item := r_c01.nr_seq_apresent_item;
			line_w.nr_seq_apresentacao := r_c01.nr_seq_apresentacao;
			line_w.ie_urgencia := r_c01.ie_urgencia; ----------------------------------
			line_w.dt_adm_adicional := r_c01.dt_adm_adicional;
			line_w.dt_programada := r_c01.dt_programada;
			line_w.dt_inicio_hem1 := r_c01.dt_inicio_hem1;
			line_w.dt_inicio_hem2 := r_c01.dt_inicio_hem2;
			line_w.dt_inicio_hem3 := r_c01.dt_inicio_hem3;
			line_w.dt_inicio_hem4 := r_c01.dt_inicio_hem4;
			line_w.dt_inicio_hem5 := r_c01.dt_inicio_hem5;
			line_w.dt_inicio_proc1 := r_c01.dt_inicio_proc1;
			line_w.dt_inicio_proc2 := r_c01.dt_inicio_proc2;
			line_w.dt_inicio_proc3 := r_c01.dt_inicio_proc3;
			line_w.dt_inicio_proc4 := r_c01.dt_inicio_proc4;
			line_w.dt_inicio_proc5 := r_c01.dt_inicio_proc5;
			line_w.dt_inicio_proc6 := r_c01.dt_inicio_proc6;
			line_w.dt_inicio_proc7 := r_c01.dt_inicio_proc7;
			line_w.ds_hor_prox_adm := ds_hor_prox_adm_w;
			line_w.ds_protocolo := r_c01.ds_protocolo;
			line_w.ds_subtipo_protocolo := r_c01.ds_subtipo_protocolo;
			line_w.ie_acm		:= r_c01.ie_acm;
			line_w.ie_se_necessario := r_c01.ie_se_necessario;
			line_w.ie_interv_operacao := r_c01.ie_interv_operacao;
			line_w.cd_funcao_origem := r_c01.cd_funcao_origem;
			line_w.nm_usuario_nrec := r_c01.nm_usuario_nrec;
			line_w.ie_pend_reval := r_c01.ie_pend_reval;
			line_w.ie_itm_pend_reval := r_c01.ie_itm_pend_reval;
			line_w.ie_oncologia := r_c01.ie_oncologia;
			line_w.ie_paciente_alergico   := r_c01.ie_paciente_alergico;
			line_w.ds_alertas   := r_c01.ds_alertas;
			line_w.ie_medic_controlado := r_c01.ie_medic_controlado;
			line_w.ie_material_alto_risco := r_c01.ie_material_alto_risco;
			line_w.ie_mat_alto_custo   := r_c01.ie_mat_alto_custo;
			line_w.ie_mat_composto   := r_c01.ie_mat_composto;
			line_w.ie_medicacao_paciente   := r_c01.ie_medicacao_paciente;
			line_w.ie_padronizado   := r_c01.ie_padronizado;
			line_w.dt_protocolo_onc := r_c01.dt_protocolo_onc;
			line_w.ie_segunda := r_c01.ie_segunda;
			line_w.ie_terca := r_c01.ie_terca;
			line_w.ie_quarta := r_c01.ie_quarta;
			line_w.ie_quinta := r_c01.ie_quinta;
			line_w.ie_sexta := r_c01.ie_sexta;
			line_w.ie_sabado := r_c01.ie_sabado;
			line_w.ie_domingo := r_c01.ie_domingo;
			if (r_c01.si_item_type in ('M','SOL')) then
			   line_w.ds_dias_semana := CPOE_OBTER_DIAS_SEMANA(r_c01.nr_sequencia, 'M');
			end if;									
			if (r_c01.si_item_type in ('DI','DP')) then
			   line_w.ds_dias_semana := CPOE_OBTER_DIAS_SEMANA(r_c01.nr_sequencia, 'DI');
			end if;
			if (r_c01.si_item_type in ('P')) then
			   line_w.ds_dias_semana := CPOE_OBTER_DIAS_SEMANA(r_c01.nr_sequencia, 'P');
			end if;
			
			if ('S' = gpt_obter_se_apresenta_grupo(Obter_perfil_Ativo, r_c01.si_item_type)) then
			RETURN NEXT line_w;
			line_w := null;
			end if;
		 end if;
		end loop;

		select ie_situacao
		into STRICT ie_micromedex_ivc_w
		from cliente_integracao a
		where a.nr_seq_inf_integracao = 1175;

		if ('A' = ie_micromedex_ivc_w and ie_tipo_ativacao_p = 'T') then
			line_w.si_order := -1;
			line_w.si_order2 := null;
			line_w.si_order3 := null;
			line_w.si_order4 := null;
			line_w.nr_sequencia := null;
			line_w.ds_item := '<strong>' || obter_desc_expressao(714057) || '</strong>';
			line_w.cd_pessoa_fisica := null;
			line_w.nr_atendimento := null;
			line_w.ds_interval := null;
			line_w.ds_horarios := 'IV_COMPATIBILITY';
			line_w.si_group_type := null;
			line_w.ds_group := null;
			line_w.si_item_type := null;
			line_w.ds_item_type := null;
			line_w.ds_administration := null;
			line_w.dt_lib_suspensao := null;
			line_w.dt_inicio := null;
			line_w.dt_fim := null;
			line_w.dt_liberacao := null;
			line_w.dt_liberacao_enfermagem := null;
			line_w.dt_liberacao_farmacia := null;
			line_w.dt_revalidacao := null;
			line_w.ie_lib_pendente_enf := null;
			line_w.ie_lib_pendente_farm := null;
			line_w.ie_item_conf_enf := null;
			line_w.ie_item_conf_farm := null;
			line_w.ie_retrogrado := null;
			line_w.dt_suspensao := null;
			line_w.dt_lib_suspensao_p := null;
			line_w.nr_seq_apresent_acm_sn := null;
			line_w.nr_seq_apresent_subgrupo := null;
			line_w.nr_seq_apresent_item := null;
			line_w.nr_seq_apresentacao := null;
			line_w.ie_urgencia := null;
			line_w.dt_adm_adicional := null;
			line_w.dt_programada := null;
			line_w.dt_inicio_hem1 := null;
			line_w.dt_inicio_hem2 := null;
			line_w.dt_inicio_hem3 := null;
			line_w.dt_inicio_hem4 := null;
			line_w.dt_inicio_hem5 := null;
			line_w.dt_inicio_proc1 := null;
			line_w.dt_inicio_proc2 := null;
			line_w.dt_inicio_proc3 := null;
			line_w.dt_inicio_proc4 := null;
			line_w.dt_inicio_proc5 := null;
			line_w.dt_inicio_proc6 := null;
			line_w.dt_inicio_proc7 := null;
			line_w.ds_hor_prox_adm := null;
			line_w.ds_protocolo := null;
			line_w.ds_subtipo_protocolo := null;
			line_w.ie_acm := null;
			line_w.ie_se_necessario := null;
			line_w.ie_interv_operacao := null;
			line_w.cd_funcao_origem := null;
			line_w.nm_usuario_nrec := null;
			line_w.ie_pend_reval := null;
			line_w.ie_itm_pend_reval := null;
			line_w.ie_paciente_alergico := null;
			line_w.ds_alertas := null;
			line_w.ie_medic_controlado := null;
			line_w.ie_material_alto_risco := null;
			line_w.ie_mat_alto_custo   := null;
			line_w.ie_mat_composto   := null;
			line_w.ie_medicacao_paciente   := null;
			line_w.ie_padronizado   := null;
			line_w.dt_protocolo_onc := null;
			
			RETURN NEXT line_w;

		end if;

		return;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gpt_utils_pck.get_terapeuthic_plan (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_param_1_p text, ie_status_analise_p text, ie_lib_enfermagem_p text, ie_lib_farmacia_p text, ie_dispensacao_p text, ie_vigentes_p text, ie_tipo_ativacao_p text default 'T', qt_horas_quimio_p bigint default 0, ie_suspenso_p text default 'S') FROM PUBLIC; -- REVOKE ALL ON FUNCTION gpt_utils_pck.get_terapeuthic_plan_atx (nr_atendimento_p bigint, cd_pessoa_fisica_p text, ie_param_1_p text, ie_status_analise_p text, ie_lib_enfermagem_p text, ie_lib_farmacia_p text, ie_dispensacao_p text, ie_vigentes_p text, ie_tipo_ativacao_p text default 'T', qt_horas_quimio_p bigint default 0, ie_suspenso_p text default 'S') FROM PUBLIC;
