-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/* ################ End get_retro_os                  ####################### */

/* ################ Start phi_get_os_list             ####################### */

CREATE OR REPLACE FUNCTION phi_ordem_servico_pck.phi_get_os_list (nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type) RETURNS SETOF T_SERVICE_ORDER_ROW_DATA AS $body$
DECLARE


	t_service_order_row_w	t_service_order_row;
	
	nr_seq_service_order_leaf_w	man_ordem_servico.nr_sequencia%type;
	nr_seq_os_ant_w			man_ordem_servico.nr_sequencia%type;
	
BEGIN

		select	phi_ordem_servico_pck.get_retro_os(nr_seq_ordem_serv_p)
		into STRICT	nr_seq_service_order_leaf_w
		;

		t_service_order_row_w.nr_seq_ordem_serv	:= nr_seq_service_order_leaf_w;
		RETURN NEXT t_service_order_row_w;

		select	mos.nr_seq_os_ant
		into STRICT	nr_seq_os_ant_w
		from	man_ordem_servico mos
		where	mos.nr_sequencia = nr_seq_service_order_leaf_w;
		
		while(nr_seq_os_ant_w IS NOT NULL AND nr_seq_os_ant_w::text <> '') loop
		
			t_service_order_row_w.nr_seq_ordem_serv	:= nr_seq_os_ant_w;
			RETURN NEXT t_service_order_row_w;

			select	mos.nr_seq_os_ant
			into STRICT	nr_seq_os_ant_w
			from	man_ordem_servico mos
			where	mos.nr_sequencia = nr_seq_os_ant_w;
		end loop;

	return;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION phi_ordem_servico_pck.phi_get_os_list (nr_seq_ordem_serv_p man_ordem_servico.nr_sequencia%type) FROM PUBLIC;
