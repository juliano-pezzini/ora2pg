-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tws_solicitacao_rescisao_pck.gerar_solic_rescisao_benef ( nr_seq_solicitacao_p pls_solicitacao_rescisao.nr_sequencia%type, nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_causa_rescisao_p pls_causa_rescisao.nr_sequencia%type, nr_seq_novo_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p text, ie_commit_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:
Inserir os beneficiários na solicitação de rescisão.
O commit será controlado pela aplicação e deverá ser realizado somente após a inserção 
de todos os beneficiários.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[  ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [ x] Outros: TWS
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 

nr_seq_motivo_padrao_w		pls_motivo_cancelamento.nr_sequencia%type;
ie_titularidade_w		varchar(1);
nr_seq_contrato_w		pls_contrato.nr_sequencia%type;


BEGIN

select	nr_seq_motivo_padrao
into STRICT	nr_seq_motivo_padrao_w
from	pls_causa_rescisao
where 	nr_sequencia	= nr_seq_causa_rescisao_p;

select	CASE WHEN coalesce(nr_seq_titular::text, '') = '' THEN 'T'  ELSE 'D' END  ie_titularidade
into STRICT	ie_titularidade_w
from	pls_segurado
where	nr_sequencia	= nr_seq_segurado_p;

insert into	pls_solic_rescisao_benef(	nr_sequencia, nr_seq_solicitacao, nr_seq_segurado,
						dt_atualizacao, nm_usuario, dt_atualizacao_nrec, 
						nm_usuario_nrec, nr_seq_causa_rescisao, nr_seq_motivo_rescisao,
						nr_seq_novo_titular, ie_titularidade) 
			      values (	nextval('pls_solic_rescisao_benef_seq'), nr_seq_solicitacao_p, nr_seq_segurado_p, 
						clock_timestamp(), nm_usuario_p, clock_timestamp(), 
						nm_usuario_p, nr_seq_causa_rescisao_p, nr_seq_motivo_padrao_w,  
						nr_seq_novo_titular_p, ie_titularidade_w);

if (ie_commit_p = 'S') then	
	commit;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tws_solicitacao_rescisao_pck.gerar_solic_rescisao_benef ( nr_seq_solicitacao_p pls_solicitacao_rescisao.nr_sequencia%type, nr_seq_segurado_p pls_segurado.nr_sequencia%type, nr_seq_causa_rescisao_p pls_causa_rescisao.nr_sequencia%type, nr_seq_novo_titular_p pls_segurado.nr_sequencia%type, nm_usuario_p text, ie_commit_p text) FROM PUBLIC;
