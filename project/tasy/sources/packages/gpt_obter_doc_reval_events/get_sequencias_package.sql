-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION gpt_obter_doc_reval_events.get_sequencias (ds_itens_p text default null) RETURNS SETOF T_OBJETO_REVALIDATION_EVENTS AS $body$
DECLARE


		t_objeto_row_w		t_revalidation_events;
		ie_existe_w			varchar(1);

		c01 CURSOR FOR
		SELECT		x.nr_atendimento,
					x.nr_sequencia,
					x.dt_validacao,
					x.dt_atualizacao_nrec,
					x.nr_seq_cpoe,
					x.nm_tabela,
					gpt_se_item_doc_reval(x.nm_tabela, x.nr_seq_cpoe, null, 1) ie_tipo_item
		from		gpt_doc_reval_events_v x
		where		x.ie_pendente_reval = 'S'
		and			gpt_se_item_doc_reval(x.nm_tabela, x.nr_seq_cpoe, null, 1) <> 'XPTO';

	
BEGIN


		for c01_w in c01 loop
		
			if (ds_itens_p IS NOT NULL AND ds_itens_p::text <> '') then
			
				select	max('S')
				into STRICT	ie_existe_w
				from	table(lista_pck.obter_lista_char(ds_itens_p))
				where	c01_w.ie_tipo_item = cd_registro;
			
			end if;

			if (coalesce(ds_itens_p::text, '') = '') or (ie_existe_w = 'S') then

				t_objeto_row_w.nr_sequencia := c01_w.nr_sequencia;
				t_objeto_row_w.nr_atendimento := c01_w.nr_atendimento;
				t_objeto_row_w.dt_validacao := c01_w.dt_validacao;
				t_objeto_row_w.dt_atualizacao_nrec := c01_w.dt_atualizacao_nrec;

			RETURN NEXT t_objeto_row_w;
			
			end if;

		end loop;

		return;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION gpt_obter_doc_reval_events.get_sequencias (ds_itens_p text default null) FROM PUBLIC;
