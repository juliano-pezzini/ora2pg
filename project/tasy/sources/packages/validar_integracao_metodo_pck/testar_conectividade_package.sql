-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION validar_integracao_metodo_pck.testar_conectividade (host_p text, porta_p text) RETURNS varchar AS $body$
DECLARE

 tcpCnx utl_tcp.connection;
 cOk    CONSTANT varchar(2) := 'OK';
 cFail  CONSTANT varchar(5) := 'ERROR';

BEGIN
  BEGIN
  tcpCnx := utl_tcp.open_connection(host_p, porta_p, tx_timeout => 5);
  utl_tcp.close_connection(tcpCnx);
  RETURN cOk;

  EXCEPTION
  WHEN utl_tcp.network_error THEN 
   IF (UPPER(SQLERRM) LIKE '%HOST%') THEN
       RETURN cFail || ' - ' || SQLERRM;
     ELSIF (UPPER(SQLERRM) LIKE '%LISTENER%') THEN
       RETURN cOk || ' - ' || SQLERRM;
     ELSE
      RETURN cFail || ' - ' || SQLERRM;
     END IF;
   WHEN OTHERS THEN
     RETURN cFail || ' - ' || SQLERRM;
  END;
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION validar_integracao_metodo_pck.testar_conectividade (host_p text, porta_p text) FROM PUBLIC;
