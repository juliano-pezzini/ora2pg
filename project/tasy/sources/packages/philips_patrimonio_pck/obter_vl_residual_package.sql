-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION philips_patrimonio_pck.obter_vl_residual ( nr_seq_bem_p bigint, dt_mes_referencia_p timestamp, vl_default_p bigint) RETURNS bigint AS $body$
DECLARE


vl_residual_w		pat_bem_regra_residual.vl_residual%type;


BEGIN
vl_residual_w := vl_default_p;
if (nr_seq_bem_p > 0) then
	begin
	select	vl_residual
	into STRICT	vl_residual_w
	from (SELECT	vl_residual
		from	pat_bem_regra_residual
		where	nr_seq_bem = nr_seq_bem_p
		and	pkg_date_utils.start_of(dt_mes_referencia_p,'DD', 0) between pkg_date_utils.start_of(dt_inicio_vigencia,'DD', 0) and fim_mes(coalesce(dt_fim_vigencia,dt_mes_referencia_p))
		order by dt_inicio_vigencia desc) alias5 LIMIT 1;
	exception
	when others then
		vl_residual_w := coalesce(vl_default_p,0);
	end;
end if;

return	vl_residual_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION philips_patrimonio_pck.obter_vl_residual ( nr_seq_bem_p bigint, dt_mes_referencia_p timestamp, vl_default_p bigint) FROM PUBLIC;
