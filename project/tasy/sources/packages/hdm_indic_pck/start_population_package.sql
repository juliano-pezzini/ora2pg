-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE hdm_indic_pck.start_population () AS $body$
BEGIN
		insert	into hdm_log_atualizacao_indic(nr_sequencia,
							dt_atualizacao, 
							nm_usuario, 
							dt_atualizacao_nrec, 
							nm_usuario_nrec, 
							ie_tipo_indicador, 
							dt_inicio_ref, 
							dt_fim_ref, 
							dt_inicio_atualizacao, 
							dt_fim_atualizacao)
			values (nextval('hdm_log_atualizacao_indic_seq'),
				clock_timestamp(),
				current_setting('hdm_indic_pck.nm_usuario_w')::usuario.nm_usuario%type,
				clock_timestamp(),
				current_setting('hdm_indic_pck.nm_usuario_w')::usuario.nm_usuario%type,
				current_setting('hdm_indic_pck.si_indicator_w')::varchar(4),
				current_setting('hdm_indic_pck.dt_start_w')::timestamp,
				current_setting('hdm_indic_pck.dt_end_w')::timestamp,
				clock_timestamp(),
				null);
		commit;
		
		CALL hdm_indic_pck.populate_dimensions();
		
		case	current_setting('hdm_indic_pck.si_indicator_w')::varchar(4)
			when '1837' then
				hdm_indic_pck.populate_ft_vital_signs();
			when '1845' then
				hdm_indic_pck.populate_ft_lab_exams();
			when '1851' then
				hdm_indic_pck.populate_ft_habits();
			when '1863' then
				hdm_indic_pck.populate_ft_disease();
			when '1868' then
				hdm_indic_pck.populate_ft_medications_use();
			when '1880' then
				hdm_indic_pck.populate_ft_urgency();
			when '1894' then
				hdm_indic_pck.populate_ft_vaccines();
			when '1898' then
				hdm_indic_pck.populate_ft_procedures();
			when '1912' then
				hdm_indic_pck.populate_ft_red_cost();
			when '1916' then
				hdm_indic_pck.populate_ft_team_episodes();
			when '1917' then
				hdm_indic_pck.populate_ft_appointment();
			when '1921' then
				hdm_indic_pck.populate_ft_participant();
			when '1923' then
				hdm_indic_pck.populate_ft_permanence();
			when '1924' then
				hdm_indic_pck.populate_ft_care_plan();
			when '1927' then
				hdm_indic_pck.populate_ft_activ_group();
			when '1932' then
				hdm_indic_pck.populate_ft_care_suspension();
			when '3090' then
				hdm_indic_pck.populate_ft_sinister_panel();
		end case;
		
		update	hdm_log_atualizacao_indic
		set	dt_fim_atualizacao = clock_timestamp()
		where	nr_sequencia = (SELECT	max(nr_sequencia)
					from	hdm_log_atualizacao_indic);
		commit;
		
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hdm_indic_pck.start_population () FROM PUBLIC;
