-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE hdm_indic_pck.clear_data () AS $body$
DECLARE

	c_vital_sign_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_vital_sign a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_exam_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_exam a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_habit_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_habit a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day_start);
	
	c_clinic_ant_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_clinic_ant a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day_start);
	
	c_medication_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_medication a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day_start);
	
	c_med_bill_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_med_bill a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_vaccine_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_vaccine a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_procedure_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_procedure a
		where	exists (SELECT	1
				from	hdm_indic_dm_month b
				where	b.dt_complete_date between pkg_date_utils.start_of(dt_start_pc,'MONTH', 0) and fim_mes(dt_end_pc)
				and	b.nr_sequencia = a.nr_seq_month);
	
	c_cost_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_cost a
		where	exists (SELECT	1
				from	hdm_indic_dm_month b
				where	b.dt_complete_date between pkg_date_utils.start_of(dt_start_pc,'MONTH', 0) and fim_mes(dt_end_pc)
				and	b.nr_sequencia = a.nr_seq_month);
	
	c_episode_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_episode a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_appointment_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_appoint a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_participant_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_partic a
		where	exists (SELECT	1
				from	hdm_indic_dm_month b
				where	b.dt_complete_date between pkg_date_utils.start_of(dt_start_pc,'MONTH', 0) and fim_mes(dt_end_pc)
				and	b.nr_sequencia = a.nr_seq_month);

	c_permanence_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_permanence a
		where	exists (SELECT	1
				from	hdm_indic_dm_month b
				where	b.dt_complete_date between pkg_date_utils.start_of(dt_start_pc,'MONTH', 0) and fim_mes(dt_end_pc)
				and	b.nr_sequencia = a.nr_seq_month);
	
	c_plan_real_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_plan_real a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
	c_group_act_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_group_act a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day_scheduled);

	c_suspension_data CURSOR(dt_start_pc timestamp, dt_end_pc timestamp) FOR
		SELECT	a.nr_sequencia
		from	hdm_indic_ft_suspension a
		where	exists (SELECT	1
				from	hdm_indic_dm_day b
				where	b.dt_complete_date between dt_start_pc and dt_end_pc
				and	b.nr_sequencia = a.nr_seq_day);
	
BEGIN
		case	current_setting('hdm_indic_pck.si_indicator_w')::varchar(4)
			when '1837' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_vital_sign_pr ';
					EXECUTE ' truncate table hdm_indic_ft_vital_sign_rd ';
					EXECUTE ' truncate table hdm_indic_ft_vital_sign_ag ';
					EXECUTE ' truncate table hdm_indic_ft_vital_sign_cp ';
					
					for	r_c_vital_sign_data in c_vital_sign_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_vital_sign
						where	nr_sequencia = r_c_vital_sign_data.nr_sequencia;
					end loop;
				end;

			when '1845' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_exam_pr ';
					EXECUTE ' truncate table hdm_indic_ft_exam_rd ';
					EXECUTE ' truncate table hdm_indic_ft_exam_ag ';
					EXECUTE ' truncate table hdm_indic_ft_exam_cp ';
					
					for	r_c_exam_data in c_exam_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_exam
						where	nr_sequencia = r_c_exam_data.nr_sequencia;
					end loop;
				end;
			when '1851' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_habit_pr ';
					EXECUTE ' truncate table hdm_indic_ft_habit_rd ';
					EXECUTE ' truncate table hdm_indic_ft_habit_ag ';
					EXECUTE ' truncate table hdm_indic_ft_habit_cp ';
					
					for	r_c_habit_data in c_habit_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_habit
						where	nr_sequencia = r_c_habit_data.nr_sequencia;
					end loop;
				end;
			when '1863' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_clinic_ant_pr ';
					EXECUTE ' truncate table hdm_indic_ft_clinic_ant_rd ';
					EXECUTE ' truncate table hdm_indic_ft_clinic_ant_ag ';
					EXECUTE ' truncate table hdm_indic_ft_clinic_ant_cp ';
					
					for	r_c_clinic_ant_data in c_clinic_ant_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_clinic_ant
						where	nr_sequencia = r_c_clinic_ant_data.nr_sequencia;
					end loop;
				end;
			when '1868' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_medication_pr ';
					EXECUTE ' truncate table hdm_indic_ft_medication_rd ';
					EXECUTE ' truncate table hdm_indic_ft_medication_ag ';
					EXECUTE ' truncate table hdm_indic_ft_medication_cp ';
					
					for	r_c_medication_data in c_medication_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_medication
						where	nr_sequencia = r_c_medication_data.nr_sequencia;
					end loop;
				end;
			when '1880' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_med_bill_pr ';
					EXECUTE ' truncate table hdm_indic_ft_med_bill_rd ';
					EXECUTE ' truncate table hdm_indic_ft_med_bill_ag ';
					EXECUTE ' truncate table hdm_indic_ft_med_bill_cp ';
					EXECUTE ' truncate table hdm_indic_ft_med_bill_cg ';
					EXECUTE ' truncate table hdm_indic_ft_med_bill_dg ';
					
					for	r_c_med_bill_data in c_med_bill_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_med_bill
						where	nr_sequencia = r_c_med_bill_data.nr_sequencia;
					end loop;
				end;
			when '1894' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_vaccine_pr ';
					EXECUTE ' truncate table hdm_indic_ft_vaccine_rd ';
					EXECUTE ' truncate table hdm_indic_ft_vaccine_ag ';
					EXECUTE ' truncate table hdm_indic_ft_vaccine_cp ';
					
					for	r_c_vaccine_data in c_vaccine_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_vaccine
						where	nr_sequencia = r_c_vaccine_data.nr_sequencia;
					end loop;
				end;
			when '1898' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_procedure_pr ';
					EXECUTE ' truncate table hdm_indic_ft_procedure_rd ';
					EXECUTE ' truncate table hdm_indic_ft_procedure_ag ';
					EXECUTE ' truncate table hdm_indic_ft_procedure_cp ';
					EXECUTE ' truncate table hdm_indic_ft_procedure_cg ';
					EXECUTE ' truncate table hdm_indic_ft_procedure_dg ';
					
					for	r_c_procedure_data in c_procedure_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_procedure
						where	nr_sequencia = r_c_procedure_data.nr_sequencia;
					end loop;
				end;
			when '1912' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_cost_pr ';
					EXECUTE ' truncate table hdm_indic_ft_cost_rd ';
					EXECUTE ' truncate table hdm_indic_ft_cost_ag ';
					EXECUTE ' truncate table hdm_indic_ft_cost_cp ';
					EXECUTE ' truncate table hdm_indic_ft_cost_cg ';
					
					for	r_c_cost_data in c_cost_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_cost
						where	nr_sequencia = r_c_cost_data.nr_sequencia;
					end loop;
				end;
			when '1916' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_episode_pr ';
					EXECUTE ' truncate table hdm_indic_ft_episode_rd ';
					EXECUTE ' truncate table hdm_indic_ft_episode_ag ';
					EXECUTE ' truncate table hdm_indic_ft_episode_cp ';
					EXECUTE ' truncate table hdm_indic_ft_episode_pf ';
					
					for	r_c_episode_data in c_episode_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_episode
						where	nr_sequencia = r_c_episode_data.nr_sequencia;
					end loop;
				end;
			when '1917' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_appoint_pr ';
					EXECUTE ' truncate table hdm_indic_ft_appoint_rd ';
					EXECUTE ' truncate table hdm_indic_ft_appoint_ag ';
					EXECUTE ' truncate table hdm_indic_ft_appoint_cp ';
					EXECUTE ' truncate table hdm_indic_ft_appoint_pf ';
					
					for	r_c_appointment_data in c_appointment_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_appoint
						where	nr_sequencia = r_c_appointment_data.nr_sequencia;
					end loop;
				end;
			when '1921' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_partic_pr ';
					EXECUTE ' truncate table hdm_indic_ft_partic_rd ';
					EXECUTE ' truncate table hdm_indic_ft_partic_ag ';
					EXECUTE ' truncate table hdm_indic_ft_partic_cp ';
					EXECUTE ' truncate table hdm_indic_ft_partic_pf ';
					EXECUTE ' truncate table hdm_indic_ft_partic_sr ';
					
					for	r_c_participant_data in c_participant_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_partic
						where	nr_sequencia = r_c_participant_data.nr_sequencia;
					end loop;
				end;
			when '1923' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_permanence_pr ';
					EXECUTE ' truncate table hdm_indic_ft_permanence_rd ';
					EXECUTE ' truncate table hdm_indic_ft_permanence_ag ';

					for	r_c_permanence_data in c_permanence_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_permanence
						where	nr_sequencia = r_c_permanence_data.nr_sequencia;
					end loop;
				end;
			when '1924' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_plan_real_pr ';
					EXECUTE ' truncate table hdm_indic_ft_plan_real_pf ';
					EXECUTE ' truncate table hdm_indic_ft_plan_real_ag ';
					
					for	r_c_plan_real_data in c_plan_real_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_plan_real
						where	nr_sequencia = r_c_plan_real_data.nr_sequencia;
					end loop;
				end;
			when '1927' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_group_act_pr ';
					EXECUTE ' truncate table hdm_indic_ft_group_act_pf ';
					EXECUTE ' truncate table hdm_indic_ft_group_act_ag ';
					
					for	r_c_group_act_data in c_group_act_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_group_act
						where	nr_sequencia = r_c_group_act_data.nr_sequencia;
					end loop;
				end;
			when '1932' then
				begin
					EXECUTE ' truncate table hdm_indic_ft_suspension_pr ';
				
					for	r_c_suspension_data in c_suspension_data(current_setting('hdm_indic_pck.dt_start_w')::timestamp, current_setting('hdm_indic_pck.dt_end_w')::timestamp) loop
						delete	from hdm_indic_ft_suspension
						where	nr_sequencia = r_c_suspension_data.nr_sequencia;
					end loop;
				end;
			/*when '3090' then
				delete from hdm_indic_ft_panel_sinist;*/

		end case;
		commit;
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE hdm_indic_pck.clear_data () FROM PUBLIC;
