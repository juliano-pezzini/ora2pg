-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_comissao_equipe_pck.carregar_parametros ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type, dt_referencia_p timestamp) AS $body$
BEGIN

PERFORM set_config('pls_comissao_equipe_pck.dt_referencia_fim_w', fim_dia(last_day(dt_referencia_p)), false);
PERFORM set_config('pls_comissao_equipe_pck.ie_gerar_lanc_tit_aberto_w', obter_valor_param_usuario(1206, 16, obter_perfil_ativo, nm_usuario_p, cd_estabelecimento_p), false);

select	coalesce(ie_dt_ref_comissao_equipe, 'L'),
	coalesce(ie_comissao_equipe_tit_aberto, 'N'),
	coalesce(ie_gerar_juro_mult_tit_repasse, 'N'),
	coalesce(ie_gerar_desconto_tit_repasse, 'N'),
	coalesce(ie_tipo_desconto_tit_repasse, 'A'),
	coalesce(ie_valor_percent_desconto, 'V'),
	coalesce(ie_remido_sinistralidade_reaj, 'N')
into STRICT	current_setting('pls_comissao_equipe_pck.ie_dt_ref_comissao_equipe_w')::pls_parametros.ie_dt_ref_comissao_equipe%type,
	current_setting('pls_comissao_equipe_pck.ie_comissao_equipe_tit_abert_w')::pls_parametros.ie_comissao_equipe_tit_aberto%type,
	current_setting('pls_comissao_equipe_pck.ie_gerar_juro_mult_tit_repas_w')::pls_parametros.ie_gerar_juro_mult_tit_repasse%type,
	current_setting('pls_comissao_equipe_pck.ie_gerar_desconto_tit_repass_w')::pls_parametros.ie_gerar_desconto_tit_repasse%type,
	current_setting('pls_comissao_equipe_pck.ie_tipo_desconto_tit_repasse_w')::pls_parametros.ie_tipo_desconto_tit_repasse%type,
	current_setting('pls_comissao_equipe_pck.ie_valor_percent_desconto_w')::pls_parametros.ie_valor_percent_desconto%type,
	current_setting('pls_comissao_equipe_pck.ie_remido_sinist_reaj_w')::pls_parametros.ie_remido_sinistralidade_reaj%type
from	pls_parametros
where	cd_estabelecimento = cd_estabelecimento_p;

if (current_setting('pls_comissao_equipe_pck.ie_dt_ref_comissao_equipe_w')::pls_parametros.ie_dt_ref_comissao_equipe%type = 'L') then
	PERFORM set_config('pls_comissao_equipe_pck.ds_restricao_parametros_w', ' and	t.dt_liquidacao between :dt_referencia_inicio and :dt_referencia_fim ', false);
else
	if (current_setting('pls_comissao_equipe_pck.ie_comissao_equipe_tit_abert_w')::pls_parametros.ie_comissao_equipe_tit_aberto%type = 'S') then
		PERFORM set_config('pls_comissao_equipe_pck.ds_restricao_parametros_w', ' and	t.ie_situacao in (''1'',''2'') ', false);
	else
		PERFORM set_config('pls_comissao_equipe_pck.ds_restricao_parametros_w', ' and	t.ie_situacao = ''2'' ', false);
	end if;
	
	PERFORM set_config('pls_comissao_equipe_pck.ds_restricao_parametros_w', current_setting('pls_comissao_equipe_pck.ds_restricao_parametros_w')::varchar(4000) || ' and a.dt_contratacao between :dt_referencia_inicio and :dt_referencia_fim ', false);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_comissao_equipe_pck.carregar_parametros ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type, dt_referencia_p timestamp) FROM PUBLIC;
