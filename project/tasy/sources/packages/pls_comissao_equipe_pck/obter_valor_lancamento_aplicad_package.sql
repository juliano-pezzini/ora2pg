-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_comissao_equipe_pck.obter_valor_lancamento_aplicad () RETURNS bigint AS $body$
DECLARE


vl_lancamento_adic_aplicado_w	pls_repasse_lanc.vl_lanc_aplicado%type;
vl_item_mensalidade_lanc_w	pls_comissao_benef_item.vl_item_mensalidade%type;
vl_comissao_titulo_lanc_w	pls_comissao_benef_item.vl_comissao%type;


BEGIN

if (current_setting('pls_comissao_equipe_pck.ie_valor_percent_desconto_w')::pls_parametros.ie_valor_percent_desconto%type = 'P') then
	select	coalesce(sum(b.vl_item_mensalidade),0),
		coalesce(sum(b.vl_comissao),0)
	into STRICT	vl_item_mensalidade_lanc_w,
		vl_comissao_titulo_lanc_w
	from	pls_comissao_benef_item	 b,
		pls_comissao_beneficiario a
	where	a.nr_sequencia = b.nr_seq_comissao_benef
	and	a.nr_seq_comissao = nr_seq_comissao_p
	and	a.nr_titulo = nr_titulo_p;

	vl_lancamento_adic_aplicado_w := (vl_lancamento_p * vl_comissao_titulo_lanc_w) / vl_item_mensalidade_lanc_w;
else
	vl_lancamento_adic_aplicado_w := vl_lancamento_p;
end if;

return(vl_lancamento_adic_aplicado_w * -1);

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_comissao_equipe_pck.obter_valor_lancamento_aplicad () FROM PUBLIC;
