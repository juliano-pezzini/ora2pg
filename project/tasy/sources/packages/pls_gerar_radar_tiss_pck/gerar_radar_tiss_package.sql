-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerar_radar_tiss_pck.gerar_radar_tiss ( nr_seq_radar_p bigint, nm_usuario_p text) AS $body$
DECLARE

	 
		ie_grupo_evento_w	varchar(5);
	
		C01 CURSOR FOR 
			SELECT	VL_DOMINIO 
			from	valor_dominio 
			where	CD_DOMINIO = 5894;
	
		
BEGIN 
 
		current_setting('pls_gerar_radar_tiss_pck.grupo_evento_vetor_w')::grupo_evento_v.delete;
 
		open C01;
		loop 
		fetch C01 into	 
			ie_grupo_evento_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
			current_setting('pls_gerar_radar_tiss_pck.grupo_evento_vetor_w')::grupo_evento_v(current_setting('pls_gerar_radar_tiss_pck.grupo_evento_vetor_w')::grupo_evento_v.count+1).ie_grupo_evento	:= ie_grupo_evento_w;
		end loop;
		close C01;
	 
		CALL pls_gerar_radar_tiss_pck.set_nr_seq_radar(nr_seq_radar_p);
		CALL CALL CALL CALL CALL CALL CALL CALL pls_gerar_radar_tiss_pck.set_nm_usuario(nm_usuario_p);
		 
		--Obter a vers√£o vigente do TISS 
		PERFORM set_config('pls_gerar_radar_tiss_pck.cd_versao_tiss_w', replace(pls_obter_versao_tiss,'.',''), false);	
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_1();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_2();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_3();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_4();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_5();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_6();
		CALL pls_gerar_radar_tiss_pck.gerar_pergunta_radar_7();
	 
		update	PLS_RADAR_TISS 
		set	DT_GERACAO_RADAR	= clock_timestamp() 
		where	nr_sequencia		= nr_seq_radar_p;
	 
		commit;
	 
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_radar_tiss_pck.gerar_radar_tiss ( nr_seq_radar_p bigint, nm_usuario_p text) FROM PUBLIC;
