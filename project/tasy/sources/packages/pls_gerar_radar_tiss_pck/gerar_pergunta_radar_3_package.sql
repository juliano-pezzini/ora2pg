-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerar_radar_tiss_pck.gerar_pergunta_radar_3 () AS $body$
DECLARE

	 
	ie_metodo_eleg_w		varchar(5);
	qt_prestador_w			bigint;
	cd_estabelecimento_w		estabelecimento.cd_estabelecimento%type;
	
	C01 CURSOR FOR 
		SELECT	VL_DOMINIO 
		from	valor_dominio 
		where	CD_DOMINIO = 5896;
	
	
BEGIN 
	 
	select	cd_estabelecimento 
	into STRICT	cd_estabelecimento_w 
	from	pls_radar_tiss 
	where	nr_sequencia	= pls_gerar_radar_tiss_pck.get_nr_seq_radar();
	 
	for i in 1..grupo_evento_vetor_w.count loop 
		open C01;
		loop 
		fetch C01 into	 
			IE_METODO_ELEG_w;
		EXIT WHEN NOT FOUND; /* apply on C01 */
 
			select	count(1) 
			into STRICT	qt_prestador_w 
			from	pls_prest_radar03	x, 
				pls_prestador		a 
			where	a.nr_sequencia		= x.nr_seq_prestador 
			and	a.ie_situacao		= 'A' 
			and	a.cd_estabelecimento	= cd_estabelecimento_w 
			and	a.ie_tipo_relacao 	<> 'F' 
			and	x.ie_grupo_evento	= current_setting('pls_gerar_radar_tiss_pck.grupo_evento_vetor_w')::grupo_evento_v[i].ie_grupo_evento 
			and	x.ie_metodo_eleg	= ie_metodo_eleg_w;
 
			insert into pls_radar_pergunta03(	nr_sequencia,dt_atualizacao,nm_usuario,dt_atualizacao_nrec,nm_usuario_nrec, 
					nr_seq_radar,IE_METODO_ELEG,IE_GRUPO_EVENTO,QT_ELEG) 
			values (	nextval('pls_radar_pergunta03_seq'),clock_timestamp(),get_nm_usuario,clock_timestamp(),get_nm_usuario, 
					get_nr_seq_radar,IE_METODO_ELEG_w,current_setting('pls_gerar_radar_tiss_pck.grupo_evento_vetor_w')::grupo_evento_v[i].ie_grupo_evento,qt_prestador_w);
		end loop;
		close C01;
	end loop;
	 
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerar_radar_tiss_pck.gerar_pergunta_radar_3 () FROM PUBLIC;
