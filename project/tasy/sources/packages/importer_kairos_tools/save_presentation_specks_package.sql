-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/**
* BASPRE
*/
CREATE OR REPLACE PROCEDURE importer_kairos_tools.save_presentation_specks ( cd_material_glo_p MATERIAL_GLOBAL.CD_MATERIAL_GLO%type, cd_unit_p UNIDADE_MEDIDA_MATGLOBAL.CD_UNIDADE%type, ds_unit_p UNIDADE_MEDIDA_MATGLOBAL.DS_UNIDADE%type, ds_via_adm_p VIAADM_MATGLOBAL.DS_VIA_ADM%type, cd_barcode_p BARRAS_MATGLOBAL.CD_BARRAS%type, ie_situation_p MATERIAL_GLOBAL.IE_SITUACAO%type DEFAULT 'A') AS $body$
DECLARE


cd_unit_w 			UNIDADE_MEDIDA_MATGLOBAL.CD_UNIDADE%type;
cd_material_glo_w 		MATERIAL_GLOBAL.CD_MATERIAL_GLO%type;


BEGIN
	CALL importer_kairos_tools.save_presentation(
		cd_unit_p 	=> cd_unit_p,
		ds_unit_p	=> ds_unit_p,
		cd_internal_p	=> cd_material_glo_p,
		ie_situation_p	=> ie_situation_p
	);

	cd_unit_w 		:= cd_material_glo_p || cd_unit_p;

	cd_material_glo_w	:= importer_kairos_tools.get_product_by_code_and_pres(cd_material_glo_p, cd_unit_w);

	IF (coalesce(cd_material_glo_w::text, '') = '') THEN
		CALL importer_kairos_tools.duplicate_product(cd_material_glo_p);
		cd_material_glo_w 	:= importer_kairos_tools.get_product_by_code_and_pres(cd_material_glo_p, cd_unit_p);		
	END IF;

	CALL importer_kairos_tools.save_product_unit(cd_material_glo_w, cd_unit_w);

	IF (ds_via_adm_p IS NOT NULL AND ds_via_adm_p::text <> '') THEN
		CALL importer_kairos_tools.save_administration_via(
			cd_via_adm_p 	=> NULL,
			ds_via_adm_p 	=> ds_via_adm_p,
			ie_situation_p	=> ie_situation_p
		);
	END IF;

	CALL importer_kairos_tools.save_barcode(
		cd_material_glo_p => cd_material_glo_w,
		cd_barcode_p 	  => cd_barcode_p,
		ie_situation_p	  => ie_situation_p
	);
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE importer_kairos_tools.save_presentation_specks ( cd_material_glo_p MATERIAL_GLOBAL.CD_MATERIAL_GLO%type, cd_unit_p UNIDADE_MEDIDA_MATGLOBAL.CD_UNIDADE%type, ds_unit_p UNIDADE_MEDIDA_MATGLOBAL.DS_UNIDADE%type, ds_via_adm_p VIAADM_MATGLOBAL.DS_VIA_ADM%type, cd_barcode_p BARRAS_MATGLOBAL.CD_BARRAS%type, ie_situation_p MATERIAL_GLOBAL.IE_SITUACAO%type DEFAULT 'A') FROM PUBLIC;
