-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION emergency_ophthalmology_pck.get_data ( dt_inicial_p timestamp, dt_final_p timestamp, cd_medico_resp_p text, cd_status_atendimento_p text, nr_seq_triagem_p bigint, nr_seq_triagem_prior_p bigint, ie_considerar_datas_p text, ie_somente_pend_p text, ie_paciente_p text, ie_ordenacao_p text) RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE

							
t_objeto_row_w					      t_objeto_row;
cd_estabelecimento_w			      estabelecimento.cd_estabelecimento%type	:= wheb_usuario_pck.get_cd_estabelecimento;
cd_perfil_w						      perfil.cd_perfil%type							:= wheb_usuario_pck.get_cd_perfil;
nm_usuario_w					      usuario.nm_usuario%type 						:= wheb_usuario_pck.get_nm_usuario;
sel_dt_entrada_w                 varchar(1000) := 'select a.dt_entrada, ';
sel_nr_atendimento_w             varchar(1000) := 'a.nr_atendimento, ';
sel_ie_alta_evasao_w             varchar(1000) := 'obter_se_motivo_alta_evasao(a.cd_motivo_alta) ie_alta_evasao, ';
sel_nm_paciente_w                varchar(1000) := 'substr(obter_nome_paciente(a.nr_atendimento),1,255) nm_paciente, ';
sel_nm_medico_resp_w             varchar(1000) := 'SUBSTR(obter_nome_pf(a.cd_medico_resp),1,255) nm_medico_resp, ';
sel_nr_idade_w                   varchar(1000) := 'SUBSTR(obter_dados_pf(a.cd_pessoa_fisica,''I''),1,5) nr_idade, ';
sel_ds_sexo_w                    varchar(1000) := 'decode(b.ie_sexo,''M'',obter_desc_expressao(311131),''F'',obter_desc_expressao(554941),obter_desc_expressao(309141)) ds_sexo, ';
sel_ds_deficiencia_w             varchar(1000) := 'obter_deficiencia_paciente_pc(a.cd_pessoa_fisica)ds_deficiencia, ';
sel_ds_gestante_w                varchar(1000) := 'SUBSTR(obter_se_pac_gravida(a.cd_pessoa_fisica),1,50) ds_gestante, ';
sel_dt_alta_w                    varchar(1000) := 'a.dt_alta, ';
sel_ie_prioridade_w              varchar(1000) := 'obter_prioridade_tcr(a.nr_seq_triagem) ie_prioridade, ';
sel_cd_pessoa_fisica_w           varchar(1000) := 'a.cd_pessoa_fisica, ';
sel_nr_seq_pac_senha_fila_w      varchar(1000) := 'a.nr_seq_pac_senha_fila, ';
sel_cd_medico_resp_w             varchar(1000) := 'a.cd_medico_resp, ';
sel_dt_atend_medico_w            varchar(1000) := 'a.dt_atend_medico, ';
sel_dt_fim_consulta_w            varchar(1000) := 'a.dt_fim_consulta, ';
sel_dt_inicio_atendimento_w      varchar(1000) := 'a.dt_inicio_atendimento, ';
sel_dt_fim_triagem_w             varchar(1000) := 'a.dt_fim_triagem, ';
sel_ds_triagem_w                 varchar(1000) := 'obter_desc_triagem(a.nr_seq_triagem) ds_triagem, ';
sel_ds_triagem_prioridade_w      varchar(1000) := 'obter_dados_tcp(a.nr_seq_triagem_prioridade,''DESC'') ds_triagem_prioridade, ';
sel_ie_prioridade_classif_w      varchar(1000) := 'TO_NUMBER(obter_dados_tcp(a.nr_seq_triagem_prioridade,''SEQ'')) ie_prioridade_classif, ';
sel_nr_seq_local_pa_w            varchar(1000) := 'a.nr_seq_local_pa, ';
sel_nr_seq_triagem_w             varchar(1000) := 'a.nr_seq_triagem, ';
sel_nr_seq_triagem_prior_w       varchar(1000) := 'a.nr_seq_triagem_prioridade, ';
sel_dt_chamada_enfermagem_w      varchar(1000) := 'a.dt_chamada_enfermagem, ';
sel_dt_chamada_paciente_w        varchar(1000) := 'a.dt_chamada_paciente, ';
sel_nr_seq_consulta_w            varchar(1000) := 'c.nr_sequencia nr_seq_consulta, ';
sel_ds_status_atendimento_w      varchar(1000) := 'oft_obter_status_pronto_atend(a.nr_atendimento, ''D'') ds_status_atendimento, ';
sel_cd_status_atendimento_w      varchar(1000) := 'oft_obter_status_pronto_atend(a.nr_atendimento, ''C'') cd_status_atendimento, ';
sel_dt_fim_senha_w               varchar(1000) := 'obter_data_fim_senha(a.nr_seq_pac_senha_fila) dt_fim_senha, ';
sel_cd_senha_gerada_w            varchar(1000) := 'substr(obter_dados_senha(a.nr_seq_pac_senha_fila,''CD''),1,100) cd_senha_gerada, ';
sel_nr_seq_fila_espera_w         varchar(1000) := 'substr(obter_dados_senha(a.nr_seq_pac_senha_fila,''SF''),1,100) nr_seq_fila_espera ';

from_select_w                    varchar(1000) := '  FROM     atendimento_paciente a, '||
                                                   '           pessoa_fisica b, '||
                                                   '           oft_consulta c ';

where_w                          varchar(1000) := '  WHERE    a.cd_pessoa_fisica   = b.cd_pessoa_fisica '||
                                                   '  and      a.nr_atendimento     = c.nr_atendimento '||
                                                   '  and      c.dt_cancelamento is null '||
                                                   '  AND	   a.dt_cancelamento is null '||
                                                   '  and      a.ie_tipo_atendimento = 3';

where_alta_w                     varchar(1000) := ' and a.dt_alta IS NULL ';
where_pacientes_w                varchar(1000) := '';
where_data_w                     varchar(1000) := ' and (a.dt_entrada BETWEEN pkg_date_utils.start_of(:dt_inicial_p,''DD'') AND pkg_date_utils.end_of(:dt_final_p,''DAY'')) ';
where_status_atend_w             varchar(1000) := '';
where_triagem_risco_w            varchar(1000) := '';
where_triagem_prior_w            varchar(1000) := '';
c_emergency				            integer;
retorno_w				            bigint;
cd_setor_usuario_w               setor_atendimento.cd_setor_atendimento%type := wheb_usuario_pck.get_cd_setor_atendimento;

dt_entrada_w                    atendimento_paciente.dt_entrada%type;
nr_atendimento_w                atendimento_paciente.nr_atendimento%type;
ie_alta_evasao_w                varchar(15);
nm_paciente_w                   varchar(255);
nm_medico_resp_w                varchar(255);
nr_idade_w                      varchar(15);
ds_sexo_w                       varchar(255);
ds_deficiencia_w                varchar(4000);
ds_gestante_w                   varchar(255);
dt_alta_w                       atendimento_paciente.dt_entrada%type;
ie_prioridade_w                 triagem_classif_risco.nr_seq_prioridade%type;
cd_pessoa_fisica_w              atendimento_paciente.cd_pessoa_fisica%type;
nr_seq_pac_senha_fila_w         atendimento_paciente.nr_seq_pac_senha_fila%type;
cd_medico_resp_w                atendimento_paciente.cd_medico_resp%type;
dt_atend_medico_w               atendimento_paciente.dt_atend_medico%type;
dt_fim_consulta_w               atendimento_paciente.dt_fim_consulta%type;
dt_inicio_atendimento_w         atendimento_paciente.dt_inicio_atendimento%type;
dt_fim_triagem_w                atendimento_paciente.dt_fim_triagem%type;
ds_triagem_w                    triagem_classif_risco.ds_classificacao%type;
ds_triagem_prioridade_w         triagem_classif_prioridade.ds_classificacao%type;
ie_prioridade_classif_w         triagem_classif_prioridade.nr_seq_prioridade%type;
nr_seq_local_pa_w               atendimento_paciente.nr_seq_local_pa%type;
nr_seq_triagem_w                atendimento_paciente.nr_seq_triagem%type;
nr_seq_triagem_prioridade_w     atendimento_paciente.nr_seq_triagem_prioridade%type;
dt_chamada_enfermagem_w         atendimento_paciente.dt_chamada_enfermagem%type;
dt_chamada_paciente_w           atendimento_paciente.dt_chamada_paciente%type;
nr_seq_consulta_w               oft_consulta.nr_sequencia%type;
ds_status_atendimento_w         varchar(255);
cd_status_atendimento_w         varchar(255);
dt_fim_senha_w                  paciente_senha_fila.dt_fim_atendimento%type;
cd_senha_gerada_w               varchar(255);
nr_seq_fila_espera_w            varchar(255);
where_add_w                     varchar(7000);

BEGIN

if coalesce(ie_considerar_datas_p,'N') = 'N' then
   where_data_w := '';
end if;

if coalesce(ie_somente_pend_p,'N') = 'N' then
   where_alta_w := '';
end if;

if (coalesce(ie_paciente_p,'T') = 'P') then
   where_pacientes_w       := ' and (a.cd_medico_resp = :cd_medico_resp_p) ';
elsif (coalesce(ie_paciente_p,'T') = 'S') then
   where_pacientes_w := ' and (obter_setor_atendimento(a.nr_Atendimento) = :cd_setor_usuario_p) ';
end if;

if (cd_status_atendimento_p IS NOT NULL AND cd_status_atendimento_p::text <> '') then
   where_status_atend_w := ' and (oft_obter_status_pronto_atend(a.nr_atendimento, ''C'') = :cd_status_atendimento_p) ';
end if;

if (nr_seq_triagem_p IS NOT NULL AND nr_seq_triagem_p::text <> '') then
   where_triagem_risco_w := ' and (a.nr_seq_triagem = :nr_seq_triagem_risco_p) ';
end if;

if (nr_seq_triagem_prior_p IS NOT NULL AND nr_seq_triagem_prior_p::text <> '') then
   where_triagem_prior_w := ' and (a.nr_seq_triagem_prioridade = :nr_seq_triagem_prior_p) ';
end if;

where_add_w := where_w ||
               where_alta_w ||
               where_pacientes_w ||
               where_data_w ||
               where_status_atend_w ||
               where_triagem_risco_w ||
               where_triagem_prior_w;

c_emergency := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(c_emergency,   sel_dt_entrada_w ||
                              sel_nr_atendimento_w ||
                              sel_ie_alta_evasao_w ||
                              sel_nm_paciente_w ||
                              sel_nm_medico_resp_w ||
                              sel_nr_idade_w ||
                              sel_ds_sexo_w ||
                              sel_ds_deficiencia_w ||
                              sel_ds_gestante_w ||
                              sel_dt_alta_w ||
                              sel_ie_prioridade_w ||
                              sel_cd_pessoa_fisica_w ||
                              sel_nr_seq_pac_senha_fila_w ||
                              sel_cd_medico_resp_w ||
                              sel_dt_atend_medico_w ||
                              sel_dt_fim_consulta_w ||
                              sel_dt_inicio_atendimento_w ||
                              sel_dt_fim_triagem_w ||
                              sel_ds_triagem_w ||
                              sel_ds_triagem_prioridade_w ||
                              sel_ie_prioridade_classif_w ||
                              sel_nr_seq_local_pa_w ||
                              sel_nr_seq_triagem_w ||
                              sel_nr_seq_triagem_prior_w ||
                              sel_dt_chamada_enfermagem_w ||
                              sel_dt_chamada_paciente_w ||
                              sel_nr_seq_consulta_w||
                              sel_ds_status_atendimento_w ||
                              sel_cd_status_atendimento_w ||
                              sel_dt_fim_senha_w ||
                              sel_cd_senha_gerada_w ||
                              sel_nr_seq_fila_espera_w ||
                              from_select_w ||
                              where_add_w,
                              dbms_sql.Native);

DBMS_SQL.DEFINE_COLUMN(c_emergency,1,dt_entrada_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,2,nr_atendimento_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,3,ie_alta_evasao_w,15);
DBMS_SQL.DEFINE_COLUMN(c_emergency,4,nm_paciente_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,5,nm_medico_resp_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,6,nr_idade_w,15);
DBMS_SQL.DEFINE_COLUMN(c_emergency,7,ds_sexo_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,8,ds_deficiencia_w,4000);
DBMS_SQL.DEFINE_COLUMN(c_emergency,9,ds_gestante_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,10,dt_alta_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,11,ie_prioridade_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,12,cd_pessoa_fisica_w,10);
DBMS_SQL.DEFINE_COLUMN(c_emergency,13,nr_seq_pac_senha_fila_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,14,cd_medico_resp_w,10);
DBMS_SQL.DEFINE_COLUMN(c_emergency,15,dt_atend_medico_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,16,dt_fim_consulta_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,17,dt_inicio_atendimento_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,18,dt_fim_triagem_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,19,ds_triagem_w,60);
DBMS_SQL.DEFINE_COLUMN(c_emergency,20,ds_triagem_prioridade_w,60);
DBMS_SQL.DEFINE_COLUMN(c_emergency,21,ie_prioridade_classif_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,22,nr_seq_local_pa_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,23,nr_seq_triagem_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,24,nr_seq_triagem_prioridade_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,25,dt_chamada_enfermagem_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,26,dt_chamada_paciente_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,27,nr_seq_consulta_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,28,ds_status_atendimento_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,29,cd_status_atendimento_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,30,dt_fim_senha_w);
DBMS_SQL.DEFINE_COLUMN(c_emergency,31,cd_senha_gerada_w,255);
DBMS_SQL.DEFINE_COLUMN(c_emergency,32,nr_seq_fila_espera_w,255);


if (position(':DT_INICIAL_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'dt_inicial_p', dt_inicial_p);
end if;

if (position(':DT_FINAL_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'dt_final_p', dt_final_p);
end if;

if (position(':CD_MEDICO_RESP_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'cd_medico_resp_p', cd_medico_resp_p);
end if;

if (position(':CD_SETOR_USUARIO_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'cd_setor_usuario_p', cd_setor_usuario_w);
end if;

if (position(':CD_STATUS_ATENDIMENTO_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'cd_status_atendimento_p', cd_status_atendimento_p);
end if;

if (position(':NR_SEQ_TRIAGEM_RISCO_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'nr_seq_triagem_risco_p', nr_seq_triagem_p);
end if;

if (position(':NR_SEQ_TRIAGEM_PRIOR_P' in upper(where_add_w)) > 0) then
   DBMS_SQL.BIND_VARIABLE(c_emergency,'nr_seq_triagem_prior_p', nr_seq_triagem_prior_p);
end if;

retorno_w := DBMS_SQL.execute(c_emergency);

while( DBMS_SQL.FETCH_ROWS(c_emergency) > 0 ) loop
   begin
   DBMS_SQL.COLUMN_VALUE(c_emergency,1,dt_entrada_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,2,nr_atendimento_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,3,ie_alta_evasao_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,4,nm_paciente_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,5,nm_medico_resp_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,6,nr_idade_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,7,ds_sexo_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,8,ds_deficiencia_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,9,ds_gestante_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,10,dt_alta_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,11,ie_prioridade_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,12,cd_pessoa_fisica_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,13,nr_seq_pac_senha_fila_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,14,cd_medico_resp_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,15,dt_atend_medico_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,16,dt_fim_consulta_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,17,dt_inicio_atendimento_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,18,dt_fim_triagem_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,19,ds_triagem_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,20,ds_triagem_prioridade_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,21,ie_prioridade_classif_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,22,nr_seq_local_pa_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,23,nr_seq_triagem_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,24,nr_seq_triagem_prioridade_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,25,dt_chamada_enfermagem_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,26,dt_chamada_paciente_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,27,nr_seq_consulta_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,28,ds_status_atendimento_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,29,cd_status_atendimento_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,30,dt_fim_senha_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,31,cd_senha_gerada_w);
   DBMS_SQL.COLUMN_VALUE(c_emergency,32,nr_seq_fila_espera_w);

   t_objeto_row_w.dt_entrada			         := dt_entrada_w;
   t_objeto_row_w.nr_atendimento			      := nr_atendimento_w;
   t_objeto_row_w.ie_alta_evasao			      := ie_alta_evasao_w;
   t_objeto_row_w.nm_paciente		            := nm_paciente_w;
   t_objeto_row_w.nm_medico_resp			      := nm_medico_resp_w;
   t_objeto_row_w.nr_idade			            := nr_idade_w;
   t_objeto_row_w.ds_sexo			            := ds_sexo_w;
   t_objeto_row_w.ds_deficiencia			      := ds_deficiencia_w;
   t_objeto_row_w.ds_gestante		            := ds_gestante_w;
   t_objeto_row_w.dt_alta		               := dt_alta_w;
   t_objeto_row_w.ie_prioridade			      := ie_prioridade_w;
   t_objeto_row_w.cd_pessoa_fisica			   := cd_pessoa_fisica_w;
   t_objeto_row_w.nr_seq_pac_senha_fila		:= nr_seq_pac_senha_fila_w;
   t_objeto_row_w.cd_medico_resp	            := cd_medico_resp_w;
   t_objeto_row_w.dt_atend_medico			   := dt_atend_medico_w;
   t_objeto_row_w.dt_fim_consulta			   := dt_fim_consulta_w;
   t_objeto_row_w.dt_inicio_atendimento		:= dt_inicio_atendimento_w;
   t_objeto_row_w.dt_fim_triagem			      := dt_fim_triagem_w;
   t_objeto_row_w.ds_triagem			         := ds_triagem_w;
   t_objeto_row_w.ds_triagem_prioridade		:= ds_triagem_prioridade_w;
   t_objeto_row_w.ie_prioridade_classif		:= ie_prioridade_classif_w;
   t_objeto_row_w.nr_seq_local_pa			   := nr_seq_local_pa_w;
   t_objeto_row_w.nr_seq_triagem			      := nr_seq_triagem_w;
   t_objeto_row_w.nr_seq_triagem_prioridade  := nr_seq_triagem_prioridade_w;
   t_objeto_row_w.dt_chamada_enfermagem		:= dt_chamada_enfermagem_w;
   t_objeto_row_w.dt_chamada_paciente			:= dt_chamada_paciente_w;
   t_objeto_row_w.ds_status_atendimento		:= ds_status_atendimento_w;
   t_objeto_row_w.cd_status_atendimento		:= cd_status_atendimento_w;
   t_objeto_row_w.dt_fim_senha			      := dt_fim_senha_w;
   t_objeto_row_w.cd_senha_gerada			   := cd_senha_gerada_w;
   t_objeto_row_w.nr_seq_fila_espera			:= nr_seq_fila_espera_w;
   t_objeto_row_w.nr_seq_consulta			   := nr_seq_consulta_w;
   t_objeto_row_w.nr_seq_prioridade          := 0;
   t_objeto_row_w.qt_tempo_triagem          := null;
   t_objeto_row_w.qt_tempo_total          := null;
   t_objeto_row_w.qt_tempo_consulta          := null;
   if (ie_ordenacao_p = 'CR') then
      t_objeto_row_w.nr_seq_prioridade       := ie_prioridade_classif_w;
   elsif (ie_ordenacao_p = 'CP') then
      t_objeto_row_w.nr_seq_prioridade       := ie_prioridade_w;
   end if;
   if (dt_inicio_atendimento_w IS NOT NULL AND dt_inicio_atendimento_w::text <> '') then
      t_objeto_row_w.qt_tempo_triagem       := pkg_date_utils.get_DiffDate(dt_inicio_atendimento_w, coalesce(dt_fim_triagem_w, clock_timestamp()), 'MINUTE');
      t_objeto_row_w.qt_tempo_total       := pkg_date_utils.get_DiffDate(dt_inicio_atendimento_w, coalesce(dt_fim_consulta_w, clock_timestamp()), 'MINUTE');
   end if;
   if (dt_atend_medico_w IS NOT NULL AND dt_atend_medico_w::text <> '') then
      t_objeto_row_w.qt_tempo_consulta       := pkg_date_utils.get_DiffDate(dt_atend_medico_w, coalesce(dt_fim_consulta_w, clock_timestamp()), 'MINUTE');
   end if;
   RETURN NEXT t_objeto_row_w;
   end;
end loop;
DBMS_SQL.CLOSE_CURSOR(c_emergency);
RETURN;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION emergency_ophthalmology_pck.get_data ( dt_inicial_p timestamp, dt_final_p timestamp, cd_medico_resp_p text, cd_status_atendimento_p text, nr_seq_triagem_p bigint, nr_seq_triagem_prior_p bigint, ie_considerar_datas_p text, ie_somente_pend_p text, ie_paciente_p text, ie_ordenacao_p text) FROM PUBLIC;
