-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_creden_prestador_pck.lista_servicos ( nr_seq_tipo_credenciamento_p pls_tipo_cred_prestador.nr_sequencia%type, cd_especialidade_p especialidade_medica.cd_especialidade%type) RETURNS SETOF T_SERVICOS AS $body$
DECLARE

t_servicos_row_w t_servicos_row;

C01 CURSOR(	cd_especialidade_pc	especialidade_medica.cd_especialidade%type) FOR
	SELECT	b.cd_procedimento,
		b.ie_origem_proced
	from	pls_proced_especialidade a,
		table(pls_grupos_pck.obter_procs_estrutura(a.cd_procedimento, a.ie_origem_proced, null, a.cd_grupo_proc, a.cd_especialidade_proc, a.cd_area_procedimento, null, null)) b
	where	a.cd_especialidade		= cd_especialidade_pc
	and	a.ie_estrutura = 'S'
	and	not exists (	SELECT	1
					from	pls_proced_especialidade x,
						table(pls_grupos_pck.obter_procs_estrutura(x.cd_procedimento, x.ie_origem_proced, null, x.cd_grupo_proc, x.cd_especialidade_proc, x.cd_area_procedimento, null, null)) y
					where	x.cd_especialidade	= cd_especialidade_pc
					and	x.ie_estrutura = 'N'
					and	y.cd_procedimento	= b.cd_procedimento
					and	y.ie_origem_proced	= b.ie_origem_proced)
	group by b.cd_procedimento,
		b.ie_origem_proced;

BEGIN

for c01_w in C01(cd_especialidade_p) loop
	begin
	t_servicos_row_w.cd_procedimento	:= c01_w.cd_procedimento;
	t_servicos_row_w.ie_origem_proced	:= c01_w.ie_origem_proced;
	RETURN NEXT t_servicos_row_w;
	end;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_creden_prestador_pck.lista_servicos ( nr_seq_tipo_credenciamento_p pls_tipo_cred_prestador.nr_sequencia%type, cd_especialidade_p especialidade_medica.cd_especialidade%type) FROM PUBLIC;
