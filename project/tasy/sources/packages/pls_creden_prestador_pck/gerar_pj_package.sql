-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_creden_prestador_pck.gerar_pj ( nr_seq_credenciamento_p pls_creden_prestador.nr_sequencia%type, cd_tipo_pessoa_p pessoa_juridica.cd_tipo_pessoa%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

cd_cgc_w		pessoa_juridica.cd_cgc%type;
ds_email_w		pls_creden_prestador.ds_email%type;
cd_estabelecimento_w	pls_creden_prestador.cd_estabelecimento%type;

BEGIN

begin
select	nr_cnpj,
	ds_email,
	cd_estabelecimento
into STRICT	cd_cgc_w,
	ds_email_w,
	cd_estabelecimento_w
from	pls_creden_prestador
where	nr_sequencia	= nr_seq_credenciamento_p;
exception
when others then
	CALL wheb_mensagem_pck.exibir_mensagem_abort(1207549); --Registro invalido
end;

insert	into	pessoa_juridica(	cd_cgc, ds_razao_social, nm_fantasia,
		dt_atualizacao, nm_usuario, dt_atualizacao_nrec, nm_usuario_nrec,
		cd_cep, ds_endereco, nr_endereco,
		ds_complemento, ds_bairro, cd_municipio_ibge,
		ds_municipio, sg_estado, cd_tipo_pessoa,
		nr_telefone, nr_inscricao_estadual, nr_inscricao_municipal,
		ds_site_internet, ie_prod_fabric, ie_situacao,
		ie_tipo_secretaria,cd_cnes,nr_seq_tipo_logradouro,
		ds_latitude,ds_longitude,nr_ddi_telefone,
		nr_seq_pais)
	(SELECT	nr_cnpj, ds_razao_social, nm_fantasia,
		clock_timestamp(), nm_usuario_p, clock_timestamp(), nm_usuario_p,
		cd_cep, ds_endereco, nr_endereco,
		ds_complemento, ds_bairro, cd_municipio_ibge,
		obter_desc_municipio_ibge(cd_municipio_ibge), sg_estado, cd_tipo_pessoa_p,
		nr_telefone, nr_inscricao_estadual, nr_inscricao_municipal,
		ds_site_internet, 'N', 'A',
		ie_tipo_secretaria,cd_cnes,nr_seq_tipo_logradouro,
		ds_latitude,ds_longitude,nr_ddi_telefone,
		nr_seq_pais
	from	pls_creden_prestador
	where	nr_sequencia	= nr_seq_credenciamento_p );

if (ds_email_w IS NOT NULL AND ds_email_w::text <> '') then
	insert	into	pessoa_juridica_estab(	nr_sequencia, cd_cgc, cd_estabelecimento,
			ds_email, ie_conta_dif_nf, ie_rateio_adiant,
			ie_retem_iss, dt_atualizacao, nm_usuario,
			dt_atualizacao_nrec, nm_usuario_nrec )
		values (	nextval('pessoa_juridica_estab_seq'), cd_cgc_w, cd_estabelecimento_w,
			ds_email_w, 'N', 'P',
			'N', clock_timestamp(), nm_usuario_p,
			clock_timestamp(), nm_usuario_p );
end if;

update	pls_creden_prestador
set	cd_cgc		= cd_cgc_w,
	dt_atualizacao	= clock_timestamp(),
	nm_usuario	= nm_usuario_p
where	nr_sequencia	= nr_seq_credenciamento_p;

commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_creden_prestador_pck.gerar_pj ( nr_seq_credenciamento_p pls_creden_prestador.nr_sequencia%type, cd_tipo_pessoa_p pessoa_juridica.cd_tipo_pessoa%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
