-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE search_panorama_content.insert_severidade_alg_data (nr_pontuacao_p bigint, nr_delta_p bigint, nr_linha_base_p bigint, nr_media_p bigint, ie_severidade_p text, nr_pontuacao_rod_p bigint default 0, ie_categoria_rod_p text default 'S', cd_exp_severidade_p bigint default 0, cd_exp_severidade_penultimo_p bigint default 0, ie_escala_acuidade_p text default 'N', nr_pontuacao_ror_p bigint default 0, ds_exp_scoreflex_p text default '', dt_pontuacao_p timestamp default null) AS $body$
DECLARE


	nr_pontuacao_w          bigint;
	nr_delta_w              bigint;
    nr_linha_base_w         bigint;
    nr_media_w              bigint;
	ie_severidade_w         varchar(2);
    cd_exp_severidade_w     bigint;
    cd_exp_categoria_rod_w  bigint;
    cd_exp_delta_w          bigint;
	icon_categoria_rod_w    varchar(255);
    cd_exp_categoria_ror_w  bigint;
	ds_exp_scoreflex_w		varchar(255);

BEGIN
 nr_pontuacao_w := nr_pontuacao_p;
 nr_delta_w :=nr_delta_p;
 nr_linha_base_w := nr_linha_base_p;
 nr_media_w := nr_media_p;
 ie_severidade_w := ie_severidade_p;

    if (coalesce(nr_pontuacao_w::text, '') = '') then
        nr_pontuacao_w :=0;
    end if;

    --if (nr_delta_w is null) then
         --nr_delta_w:=0;
    --end if;
    if (coalesce(nr_linha_base_w::text, '') = '') then
         nr_linha_base_w:=0;
    end if;

    if (coalesce(nr_media_w::text, '') = '') then
         nr_media_w:=0;
    end if;

    if (coalesce(ie_severidade_w::text, '') = '') then
          ie_severidade_w := 'X';
    end if;

   if (nr_delta_p >0) then
    cd_exp_delta_w:=1138894;
    icon_categoria_rod_w :='assets/icons/status-and-feedback/arrow-up-red.svg';
   else
    icon_categoria_rod_w :='assets/icons/status-and-feedback/arrow-down-green.svg';
    cd_exp_delta_w:=1138893;
   end if;

  CASE
   WHEN nr_pontuacao_ror_p > 7.5 THEN cd_exp_categoria_ror_w := 1160515;
   WHEN nr_pontuacao_ror_p > 1 AND nr_pontuacao_ror_p <= 7.5 THEN cd_exp_categoria_ror_w :=1160516;
   WHEN nr_pontuacao_ror_p < 1 THEN cd_exp_categoria_ror_w := 1160515;
   ELSE cd_exp_categoria_ror_w :=0;
   END CASE;

   CASE ie_categoria_rod_p
   WHEN 'H' THEN cd_exp_categoria_rod_w:=1160515;
   WHEN 'M' THEN cd_exp_categoria_rod_w:=1160516;
   WHEN 'L' THEN cd_exp_categoria_rod_w:=1160517;
   ELSE cd_exp_categoria_rod_w:=0;
   END CASE;

    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_pontuacao             			:= nr_pontuacao_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_delta                 			:= nr_delta_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_linha_base            			:= nr_linha_base_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_media                 			:= nr_media_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.ie_severidade            			:= ie_severidade_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_pontuacao_rod         			:= nr_pontuacao_rod_p;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.ie_categoria_rod         			:= ie_categoria_rod_p;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.cd_exp_severidade        			:= cd_exp_severidade_p;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.cd_exp_categoria_rod     			:= cd_exp_categoria_rod_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.cd_exp_delta             			:= cd_exp_delta_w;
	current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.icon_categoria_rod       			:= icon_categoria_rod_w;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.ie_escala_acuidade       			:= ie_escala_acuidade_p;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.nr_pontuacao_ror         			:= nr_pontuacao_ror_p;
    current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.cd_exp_categoria_ror     			:= cd_exp_categoria_ror_w;
	current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.cd_exp_severidade_penultimo		:= cd_exp_severidade_penultimo_p;
	current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.ds_exp_scoreflex					    := ds_exp_scoreflex_p;
	current_setting('search_panorama_content.t_objeto_severidade_alg_row_w')::t_objeto_severidade_alg_row.dt_pontuacao_opcao1				:= dt_pontuacao_p;
	
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE search_panorama_content.insert_severidade_alg_data (nr_pontuacao_p bigint, nr_delta_p bigint, nr_linha_base_p bigint, nr_media_p bigint, ie_severidade_p text, nr_pontuacao_rod_p bigint default 0, ie_categoria_rod_p text default 'S', cd_exp_severidade_p bigint default 0, cd_exp_severidade_penultimo_p bigint default 0, ie_escala_acuidade_p text default 'N', nr_pontuacao_ror_p bigint default 0, ds_exp_scoreflex_p text default '', dt_pontuacao_p timestamp default null) FROM PUBLIC;
