-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION search_panorama_content.get_ad_info_data (nr_seq_interno_p bigint, ie_concluido_p text, nr_atendimento_p bigint default null) RETURNS SETOF T_OBJETO_AD_INFO_ROW_DATA AS $body$
DECLARE


c_ad_info CURSOR FOR
SELECT * from pan_info_adicional_v where nr_seq_interno = nr_seq_interno_p or nr_atendimento = nr_atendimento_p;

c_leitos_info CURSOR FOR
SELECT	u.cd_setor_atendimento,
        u.cd_unidade_basica,
        u.cd_unidade_compl,
        u.nr_seq_interno,
        coalesce(u.ie_status_unidade, 'L') ie_status_unidade,
        u.ie_retaguarda_atual,
        u.nr_atendimento
  from	unidade_atendimento u
 where	u.ie_situacao = 'A'
   and	u.nr_seq_interno = nr_seq_interno_p;

c_precaucao CURSOR FOR
SELECT (select obter_microorganismo_precaucao(ap.nr_sequencia) ) microorganismo,
	   (select obter_motivo_precaucao(ap.nr_sequencia) ) motivo,
	   (select cp.ds_precaucao from cih_precaucao cp where cp.nr_sequencia = ap.nr_seq_precaucao) ds_precaucao
from atendimento_precaucao ap
where ap.nr_atendimento = (select nr_atendimento from unidade_atendimento where nr_seq_interno = nr_seq_interno_p)
    and (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
    and coalesce(dt_fim_acompanhamento, clock_timestamp()) >= clock_timestamp()
    and coalesce(dt_final_precaucao, clock_timestamp()) >= clock_timestamp()
order by ap.nr_sequencia desc LIMIT 1;

c_order_pres CURSOR FOR
    SELECT nr_seq_apresentacao, ie_campo_panorama
    from pan_configuracao_campos
    where nr_seq_configuracao = (SELECT nr_sequencia from pan_configuracao where cd_perfil=coalesce(wheb_usuario_pck.get_cd_perfil,1980));

TYPE order_pres IS TABLE OF bigint INDEX BY varchar(30);
arr_order_pres order_pres;

cd_departamento_w 			departamento_medico.cd_departamento%type;
ie_pflegegrad_w             varchar(4000);
ds_valor_dominio_w          valor_dominio_v.ds_valor_dominio%TYPE;
ie_protocol_gerenciado_w    varchar(1);
dt_historico_manutencao_w       timestamp;
ds_motivo_manutencao_w          varchar(80);
dt_prevista_w                   timestamp;
dt_inicio_w                     timestamp;
ds_servico_w                    varchar(80);
nm_prof_previsto_w              varchar(60);
ds_executor_w                   varchar(40);
dt_historico_interdicao_w       timestamp;
ds_motivo_interdicao_w          varchar(60);
nm_acompanhante_w	            varchar(255);
nr_atendimento_w	            atendimento_paciente.nr_atendimento%type;
dt_historico_isolamento_w	    timestamp;
ds_motivo_isolamento_w		    varchar(255);
nm_paciente_reserva_w		    varchar(255);
ie_solicitacao_reserva_pend_w   smallint;
nm_paciente_w                   varchar(255);
BEGIN
    for cr_order in c_order_pres loop
         arr_order_pres(cr_order.ie_campo_panorama):=cr_order.nr_seq_apresentacao;
    end loop;

	for r_c_ad_info in c_ad_info loop

		if ((r_c_ad_info.dt_previsto_alta IS NOT NULL AND r_c_ad_info.dt_previsto_alta::text <> '') and arr_order_pres.EXISTS(75)) then
			CALL search_panorama_content.insert_ad_info_data(75,309369,1065031,substr(r_c_ad_info.dt_previsto_alta,1,255),null,r_c_ad_info.dt_previsto_alta,75,'date(shortDate)',ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(75));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_classif_esp_pac IS NOT NULL AND r_c_ad_info.ds_classif_esp_pac::text <> '') and arr_order_pres.EXISTS(69)) then
			CALL search_panorama_content.insert_ad_info_data( 69,285109, 1061836,substr(r_c_ad_info.ds_classif_esp_pac,1,255), null,null,69,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(69));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.dt_nascimento IS NOT NULL AND r_c_ad_info.dt_nascimento::text <> '') and arr_order_pres.EXISTS(2)) then
			CALL search_panorama_content.insert_ad_info_data( 2,287065,968853,substr(r_c_ad_info.dt_nascimento,1,255), null,r_c_ad_info.dt_nascimento,2,'date(shortDate)', ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(2));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.dt_obito IS NOT NULL AND r_c_ad_info.dt_obito::text <> '') and arr_order_pres.EXISTS(66)) then
			CALL search_panorama_content.insert_ad_info_data(66,286749,1058604,substr(r_c_ad_info.dt_obito,1,255), null, r_c_ad_info.dt_obito,66,'date(shortDate)', ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(66));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ie_fator_rh IS NOT NULL AND r_c_ad_info.ie_fator_rh::text <> '') and arr_order_pres.EXISTS(67)) then
			CALL search_panorama_content.insert_ad_info_data(67,290015,1058609,substr(r_c_ad_info.ie_fator_rh,1,255),null,null,67,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(67));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ie_tipo_sangue IS NOT NULL AND r_c_ad_info.ie_tipo_sangue::text <> '') and arr_order_pres.EXISTS(68)) then
			CALL search_panorama_content.insert_ad_info_data( 68,299998,1058610,substr(r_c_ad_info.ie_tipo_sangue,1,255),null,null,68,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(68));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ie_sexo IS NOT NULL AND r_c_ad_info.ie_sexo::text <> '') and arr_order_pres.EXISTS(3)) then
			CALL search_panorama_content.insert_ad_info_data( 3,298476,968960,substr(r_c_ad_info.ie_sexo,1,255), null,null,3,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(3));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_convenio IS NOT NULL AND r_c_ad_info.ds_convenio::text <> '') and arr_order_pres.EXISTS(4)) then
			CALL search_panorama_content.insert_ad_info_data( 4,696048,968976,substr(r_c_ad_info.ds_convenio,1,255), null,null,4,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(4));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if (r_c_ad_info.ds_plano_convenio IS NOT NULL AND r_c_ad_info.ds_plano_convenio::text <> '') then
			CALL search_panorama_content.insert_ad_info_data( 5,697043,969125,substr(r_c_ad_info.ds_plano_convenio,1,255),null,null,5,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(5));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_clinica IS NOT NULL AND r_c_ad_info.ds_clinica::text <> '') and arr_order_pres.EXISTS(6)) then
			CALL search_panorama_content.insert_ad_info_data( 6,284962,969181,substr(r_c_ad_info.ds_clinica,1,255),null,null,7,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(6));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;
		if ((r_c_ad_info.nr_dias_internado IS NOT NULL AND r_c_ad_info.nr_dias_internado::text <> '') and arr_order_pres.EXISTS(7)) then
			CALL search_panorama_content.insert_ad_info_data( 7,692411,1024110,null,r_c_ad_info.nr_dias_internado,null,8,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(7));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;
		if ((r_c_ad_info.ds_vaga IS NOT NULL AND r_c_ad_info.ds_vaga::text <> '') and arr_order_pres.EXISTS(8)) then
			CALL search_panorama_content.insert_ad_info_data( 8,298850, 969267,substr(r_c_ad_info.ds_vaga,1,255), null,  null,9,null, ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(8));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;
		if ((r_c_ad_info.ds_escalas IS NOT NULL AND r_c_ad_info.ds_escalas::text <> '') and arr_order_pres.EXISTS(9)) then
			CALL search_panorama_content.insert_ad_info_data( 9,308877, 969272,substr(r_c_ad_info.ds_escalas,1,255), null,  null,10, null, ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(9));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;
		/*Utilizado para estrutura case*/

		if ((r_c_ad_info.nr_atendimento IS NOT NULL AND r_c_ad_info.nr_atendimento::text <> '') and arr_order_pres.EXISTS(11)) then
			CALL search_panorama_content.insert_ad_info_data(11,283863,969291,null, substr(r_c_ad_info.nr_atendimento,1,255),null,1, null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,11);
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.nr_seq_episodio IS NOT NULL AND r_c_ad_info.nr_seq_episodio::text <> '') and arr_order_pres.EXISTS(28)) then
			CALL search_panorama_content.insert_ad_info_data( 28,783146, 969276,null, substr(r_c_ad_info.nr_seq_episodio,1,255),	null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(28));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

    select obter_departamento_data(r_c_ad_info.nr_atendimento)
    into STRICT cd_departamento_w
;

		if ((cd_departamento_w IS NOT NULL AND cd_departamento_w::text <> '') and arr_order_pres.EXISTS(29)) then
			CALL search_panorama_content.insert_ad_info_data( 29,332098,969277,substr(obter_nome_departamento_medico(cd_departamento_w),1,255),null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(29));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_score_flex IS NOT NULL AND r_c_ad_info.ds_score_flex::text <> '') and arr_order_pres.EXISTS(76)) then
			CALL search_panorama_content.insert_ad_info_data(76,313958,1069291,r_c_ad_info.ds_score_flex, null,	null,null,	null, ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(76));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;
		if ((r_c_ad_info.ds_score_flex_II IS NOT NULL AND r_c_ad_info.ds_score_flex_II::text <> '') and arr_order_pres.EXISTS(77)) then
            CALL search_panorama_content.insert_ad_info_data( 77,313969, 1069676,replace(substr(r_c_ad_info.ds_score_flex_II,1,length(r_c_ad_info.ds_score_flex_II)-5),'<br>','|'), null,	null,null,	null, ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(77));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_nivel_complexidade IS NOT NULL AND r_c_ad_info.ds_nivel_complexidade::text <> '') and arr_order_pres.EXISTS(30)) then
			CALL search_panorama_content.insert_ad_info_data( 30,859709, 996138,r_c_ad_info.ds_nivel_complexidade, null,	null,null,	null, ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(30));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_diagnostico IS NOT NULL AND r_c_ad_info.ds_diagnostico::text <> '') and arr_order_pres.EXISTS(81)) then
			CALL search_panorama_content.insert_ad_info_data(81,287694,1022593,r_c_ad_info.ds_diagnostico, null,null,6,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(81));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.nm_colab_resp IS NOT NULL AND r_c_ad_info.nm_colab_resp::text <> '') and arr_order_pres.EXISTS(33)) then
			CALL search_panorama_content.insert_ad_info_data(33,714994,1022634,r_c_ad_info.nm_colab_resp, null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(33));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.qt_pontos IS NOT NULL AND r_c_ad_info.qt_pontos::text <> '') and arr_order_pres.EXISTS(34)) then
			CALL search_panorama_content.insert_ad_info_data(34,309327,1022649,r_c_ad_info.qt_pontos,null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(34));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_gradacao2 IS NOT NULL AND r_c_ad_info.ds_gradacao2::text <> '') and arr_order_pres.EXISTS(35)) then
			CALL search_panorama_content.insert_ad_info_data(35,309328,1022671,r_c_ad_info.ds_gradacao2,null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(35));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_gradacao1 IS NOT NULL AND r_c_ad_info.ds_gradacao1::text <> '') and arr_order_pres.EXISTS(61)) then
			CALL search_panorama_content.insert_ad_info_data(61,309312,1052766,r_c_ad_info.ds_gradacao1, null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(61));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_gradacao3 IS NOT NULL AND r_c_ad_info.ds_gradacao3::text <> '') and arr_order_pres.EXISTS(62)) then
			CALL search_panorama_content.insert_ad_info_data(62,309329,1052768,r_c_ad_info.ds_gradacao3,null,null,null,null,ie_concluido_p,r_c_ad_info.cd_pessoa_fisica,arr_order_pres(62));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_gradacao4 IS NOT NULL AND r_c_ad_info.ds_gradacao4::text <> '') and arr_order_pres.EXISTS(63)) then
            CALL search_panorama_content.insert_ad_info_data(63,686100,1052769,r_c_ad_info.ds_gradacao4,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(63));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.qt_ponto_nut IS NOT NULL AND r_c_ad_info.qt_ponto_nut::text <> '') and arr_order_pres.EXISTS(36)) then
            CALL search_panorama_content.insert_ad_info_data(36,309319,1022693,r_c_ad_info.qt_ponto_nut,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(36));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

		if ((r_c_ad_info.qt_ponto_nut2 IS NOT NULL AND r_c_ad_info.qt_ponto_nut2::text <> '') and arr_order_pres.EXISTS(65)) then
            CALL search_panorama_content.insert_ad_info_data(65,854589,1053077,r_c_ad_info.qt_ponto_nut2,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(65));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

		if ((r_c_ad_info.ds_escalas_panorama IS NOT NULL AND r_c_ad_info.ds_escalas_panorama::text <> '') and arr_order_pres.EXISTS(64)) then
            CALL search_panorama_content.insert_ad_info_data(64,308877,969272,replace(substr(r_c_ad_info.ds_escalas_panorama,1,length(r_c_ad_info.ds_escalas_panorama)-5),'<br>','|'),null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(64));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_anotacao IS NOT NULL AND r_c_ad_info.ds_anotacao::text <> '') and arr_order_pres.EXISTS(37)) then
            CALL search_panorama_content.insert_ad_info_data(37,308100,1022887,r_c_ad_info.ds_anotacao,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(37));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.dt_cirurgia IS NOT NULL AND r_c_ad_info.dt_cirurgia::text <> '') and arr_order_pres.EXISTS(38)) then
            CALL search_panorama_content.insert_ad_info_data(38,614821,1022890,r_c_ad_info.dt_cirurgia,null,r_c_ad_info.dt_cirurgia,null,'date(shortDate)',ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(38));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_tipo_isolamento_cih IS NOT NULL AND r_c_ad_info.ds_tipo_isolamento_cih::text <> '') and arr_order_pres.EXISTS(39)) then
            CALL search_panorama_content.insert_ad_info_data(39,306717,1022904,r_c_ad_info.ds_tipo_isolamento_cih,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(39));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.qt_escala_dor IS NOT NULL AND r_c_ad_info.qt_escala_dor::text <> '') and arr_order_pres.EXISTS(42)) then
            CALL search_panorama_content.insert_ad_info_data(42,669692,1022924,r_c_ad_info.qt_escala_dor,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(42));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_escala_dor IS NOT NULL AND r_c_ad_info.ds_escala_dor::text <> '') and arr_order_pres.EXISTS(43)) then
            CALL search_panorama_content.insert_ad_info_data(43,600756,1022945,r_c_ad_info.ds_escala_dor,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(43));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_nutricionista IS NOT NULL AND r_c_ad_info.nm_nutricionista::text <> '') and arr_order_pres.EXISTS(44)) then
            CALL search_panorama_content.insert_ad_info_data(44,310527,1022946,r_c_ad_info.nm_nutricionista,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(44));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.qt_dias_prev_inter IS NOT NULL AND r_c_ad_info.qt_dias_prev_inter::text <> '') and arr_order_pres.EXISTS(45)) then
            CALL search_panorama_content.insert_ad_info_data(45,287749,1022953,r_c_ad_info.qt_dias_prev_inter,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(45));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_aval_nut IS NOT NULL AND r_c_ad_info.nm_aval_nut::text <> '') and arr_order_pres.EXISTS(46)) then
            CALL search_panorama_content.insert_ad_info_data(46,738750,1022961,r_c_ad_info.nm_aval_nut,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(46));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.dt_escala_dor IS NOT NULL AND r_c_ad_info.dt_escala_dor::text <> '') and arr_order_pres.EXISTS(40)) then
            CALL search_panorama_content.insert_ad_info_data(40,309093,1022963,r_c_ad_info.dt_escala_dor,null,r_c_ad_info.dt_escala_dor,null,'date(shortDate)',ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(40));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_medico_resp IS NOT NULL AND r_c_ad_info.nm_medico_resp::text <> '') and arr_order_pres.EXISTS(41)) then
            CALL search_panorama_content.insert_ad_info_data(41,293157,1022986,r_c_ad_info.nm_medico_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(41));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_psicologo_resp IS NOT NULL AND r_c_ad_info.nm_psicologo_resp::text <> '') and arr_order_pres.EXISTS(47)) then
            CALL search_panorama_content.insert_ad_info_data(47,682758,1022992,r_c_ad_info.nm_psicologo_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(47));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if (r_c_ad_info.nm_farmaceutico_resp IS NOT NULL AND r_c_ad_info.nm_farmaceutico_resp::text <> '') then
            CALL search_panorama_content.insert_ad_info_data(48,289984,1022995,r_c_ad_info.nm_farmaceutico_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(48));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_fisioterapeuta_resp IS NOT NULL AND r_c_ad_info.nm_fisioterapeuta_resp::text <> '') and arr_order_pres.EXISTS(49)) then
            CALL search_panorama_content.insert_ad_info_data(49,682744,1022997,r_c_ad_info.nm_fisioterapeuta_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(49));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_assistente_resp IS NOT NULL AND r_c_ad_info.nm_assistente_resp::text <> '') and arr_order_pres.EXISTS(50)) then
            CALL search_panorama_content.insert_ad_info_data(50,682746,1022999,r_c_ad_info.nm_assistente_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(50));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.nm_enf_resp IS NOT NULL AND r_c_ad_info.nm_enf_resp::text <> '') and arr_order_pres.EXISTS(51)) then
            CALL search_panorama_content.insert_ad_info_data(51,682733,1023009,r_c_ad_info.nm_enf_resp,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(51));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.dt_entrada IS NOT NULL AND r_c_ad_info.dt_entrada::text <> '') and arr_order_pres.EXISTS(52)) then
            CALL search_panorama_content.insert_ad_info_data(52,873779,1028751,r_c_ad_info.dt_entrada,null,r_c_ad_info.dt_entrada,null,'date(shortDate)',ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(52));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.qt_dia_unidade IS NOT NULL AND r_c_ad_info.qt_dia_unidade::text <> '') and arr_order_pres.EXISTS(53)) then
            CALL search_panorama_content.insert_ad_info_data(53,560060,1028880,r_c_ad_info.qt_dia_unidade,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(53));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.dt_diag_nutricional IS NOT NULL AND r_c_ad_info.dt_diag_nutricional::text <> '') and arr_order_pres.EXISTS(54)) then
            CALL search_panorama_content.insert_ad_info_data(54,309331,1028885,r_c_ad_info.dt_diag_nutricional,null,r_c_ad_info.dt_diag_nutricional,null,'date(shortDate)',ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(54));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_nutricional IS NOT NULL AND r_c_ad_info.ds_nutricional::text <> '') and arr_order_pres.EXISTS(55)) then
            CALL search_panorama_content.insert_ad_info_data(55,287708,1028886,r_c_ad_info.ds_nutricional,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(55));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_dieta_liberada IS NOT NULL AND r_c_ad_info.ds_dieta_liberada::text <> '') and arr_order_pres.EXISTS(57)) then
            CALL search_panorama_content.insert_ad_info_data(57,287910,1028890,r_c_ad_info.ds_dieta_liberada,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(57));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_cirurgia IS NOT NULL AND r_c_ad_info.ds_cirurgia::text <> '') and arr_order_pres.EXISTS(58)) then
            CALL search_panorama_content.insert_ad_info_data(58,316812,1028959,r_c_ad_info.ds_cirurgia,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(58));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.qt_dia_perman_unid IS NOT NULL AND r_c_ad_info.qt_dia_perman_unid::text <> '') and arr_order_pres.EXISTS(70)) then
			CALL search_panorama_content.insert_ad_info_data(70,744330,1064727,r_c_ad_info.qt_dia_perman_unid,null,null,70,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(70));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_tipo_vaga IS NOT NULL AND r_c_ad_info.ds_tipo_vaga::text <> '') and arr_order_pres.EXISTS(71)) then
			CALL search_panorama_content.insert_ad_info_data(71,300053,1064728,r_c_ad_info.ds_tipo_vaga,null,null,71, null, ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(71));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_prox_leito_desej IS NOT NULL AND r_c_ad_info.ds_prox_leito_desej::text <> '') and arr_order_pres.EXISTS(72)) then
			CALL search_panorama_content.insert_ad_info_data(72,1064729,1064729,r_c_ad_info.ds_prox_leito_desej,null,null,72, null, ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(72));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_classif_setor_solic IS NOT NULL AND r_c_ad_info.ds_classif_setor_solic::text <> '') and arr_order_pres.EXISTS(73)) then
			CALL search_panorama_content.insert_ad_info_data(73,935780,1064735,r_c_ad_info.ds_classif_setor_solic,null,null,73, null, ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(73));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_lista_exame_agendado IS NOT NULL AND r_c_ad_info.ds_lista_exame_agendado::text <> '') and arr_order_pres.EXISTS(74)) then
			CALL search_panorama_content.insert_ad_info_data(74,609024,1064736,r_c_ad_info.ds_lista_exame_agendado,null,null,74, null, ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(74));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
		end if;

		if ((r_c_ad_info.ds_sae IS NOT NULL AND r_c_ad_info.ds_sae::text <> '') and arr_order_pres.EXISTS(59)) then
            CALL search_panorama_content.insert_ad_info_data(59,297968,1033368,r_c_ad_info.ds_sae,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(59));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        if ((r_c_ad_info.ds_tipo_episodio IS NOT NULL AND r_c_ad_info.ds_tipo_episodio::text <> '') and arr_order_pres.EXISTS(78)) then
            CALL search_panorama_content.insert_ad_info_data(78,855574,1073621,r_c_ad_info.ds_tipo_episodio,null,null,null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(78));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

		if ((r_c_ad_info.protolo_gererenciado_qtd IS NOT NULL AND r_c_ad_info.protolo_gererenciado_qtd::text <> '') and arr_order_pres.EXISTS(79)) then
            select CASE WHEN r_c_ad_info.protolo_gererenciado_qtd=0 THEN  'N'  ELSE 'S' END  ds
              into STRICT ie_protocol_gerenciado_w;
            CALL search_panorama_content.insert_ad_info_data(79,296595,1122773,ie_protocol_gerenciado_w,null,null,null, null, ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(79));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;

        select obter_pflegegrad(r_c_ad_info.cd_pessoa_fisica, r_c_ad_info.nr_atendimento)
        into STRICT ie_pflegegrad_w
;

        if ((ie_pflegegrad_w IS NOT NULL AND ie_pflegegrad_w::text <> '') and arr_order_pres.EXISTS(31)) then
             select max(v_dom.ds_valor_dominio) as ds_valor_dominio
               into STRICT ds_valor_dominio_w
               from dominio dom
                   ,valor_dominio_v v_dom
              where dom.cd_dominio = v_dom.cd_dominio
                and dom.cd_dominio = 8674 -- Pflegegrad
                and v_dom.vl_dominio = ie_pflegegrad_w;
            CALL search_panorama_content.insert_ad_info_data(31,795203, 996681, ds_valor_dominio_w, null, null, null,null,ie_concluido_p, r_c_ad_info.cd_pessoa_fisica,arr_order_pres(31));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
        end if;
	end loop;

	for r_c_leitos_info in c_leitos_info loop
		if (r_c_leitos_info.ie_status_unidade = 'A') then
			if ((r_c_leitos_info.nr_atendimento IS NOT NULL AND r_c_leitos_info.nr_atendimento::text <> '') and arr_order_pres.EXISTS(10) and arr_order_pres.EXISTS(11) and arr_order_pres.EXISTS(12) and arr_order_pres.EXISTS(13)) then
				CALL search_panorama_content.insert_ad_info_data(10,283863,969291,null,r_c_leitos_info.nr_atendimento,null,1,null,ie_concluido_p,null,arr_order_pres(10));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(11,295156,969294,obter_pessoa_atendimento(r_c_leitos_info.nr_atendimento, 'N'),null,null,2,null,ie_concluido_p,null,arr_order_pres(11));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(12,309145,969295,null,null,obter_dados_atendimento_dt(nr_atendimento_w, 'DAM'),3,'date(shortDate)', ie_concluido_p,null,arr_order_pres(12));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(13,283377,969298,null,null,obter_dados_atendimento_dt(nr_atendimento_w, 'DA'),4,'date(shortDate)', ie_concluido_p,null,arr_order_pres(13));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			end if;

		--CHAMADO MANUTENCAO
		--MANUTENCAO
		elsif (r_c_leitos_info.ie_status_unidade = 'C') or (r_c_leitos_info.ie_status_unidade = 'E') and (arr_order_pres.EXISTS(14)) and (arr_order_pres.EXISTS(15)) then
			begin
				select	a.dt_historico,
						coalesce(substr((select obter_desc_mot_manut(a.cd_motivo_manutencao) ),1,80), (select wheb_mensagem_pck.get_texto(997030) ))
				into STRICT	dt_historico_manutencao_w,
						ds_motivo_manutencao_w
				from	unidade_atend_hist a,
						unidade_atendimento b
				where	a.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
				and		b.nr_seq_interno = a.nr_seq_unidade
				and 	coalesce(a.dt_fim_historico::text, '') = ''
				and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
				and 	a.dt_historico =
						(SELECT	max(z.dt_historico)
						from    unidade_atend_hist z
						where   z.nr_seq_unidade = b.nr_seq_interno
						and 	coalesce(z.dt_fim_historico::text, '') = ''
						and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
			exception
				when others then
				null;
			end;

			CALL search_panorama_content.insert_ad_info_data(14,291978,969306,to_char(dt_historico_manutencao_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_historico_manutencao_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(14));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(15,293478,969307,ds_motivo_manutencao_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(15));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);

		--AGUARDANDO HIGIENIZACAO
		--EM HIGIENIZACAO
		elsif (r_c_leitos_info.ie_status_unidade = 'G') or (r_c_leitos_info.ie_status_unidade = 'H') and (arr_order_pres.EXISTS(16)) and (arr_order_pres.EXISTS(17)) and (arr_order_pres.EXISTS(18)) then
			begin
				select	b.dt_inicio_higienizacao,
						b.dt_aguard_higienizacao,
						(select OBTER_DESCRICAO_PADRAO('SL_SERVICO','DS_SERVICO', a.NR_SEQ_SERVICO) ) ds_servico,
						coalesce(substr((select obter_nome_pf(a.cd_prof_previsto) ), 1, 60), (select wheb_mensagem_pck.get_texto(997030) )) nm_prof_previsto,
						substr((select obter_valor_dominio(1811, ie_executor) ),1,40) ds_executor
				into STRICT	dt_inicio_w,
						dt_prevista_w,
						ds_servico_w,
						nm_prof_previsto_w,
						ds_executor_w
				from	unidade_atendimento b
				left join sl_unid_atend a on b.nr_seq_interno = a.nr_seq_unidade
				where	b.nr_seq_interno = r_c_leitos_info.nr_seq_interno
				and 	coalesce(a.dt_fim::text, '') = ''
				and  	(a.dt_inicio IS NOT NULL AND a.dt_inicio::text <> '')
				and 	a.nr_sequencia =
						(SELECT	max(z.nr_sequencia)
						from    sl_unid_atend z
						where   z.nr_seq_unidade = a.nr_seq_unidade
						and 	coalesce(z.dt_fim::text, '') = ''
						and 	z.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
						and  	(z.dt_inicio IS NOT NULL AND z.dt_inicio::text <> '')
						)  LIMIT 1;
			exception when no_data_found then
				select b.dt_inicio_higienizacao,
					   b.dt_aguard_higienizacao,
					   null,
					   null,
					   null
				 into STRICT  dt_inicio_w,
					   dt_prevista_w,
					   ds_servico_w,
					   nm_prof_previsto_w,
					   ds_executor_w
				  from	unidade_atendimento b
				 where b.nr_seq_interno  = r_c_leitos_info.nr_seq_interno;
			end;
				--
			if (r_c_leitos_info.ie_status_unidade = 'G') then
				CALL search_panorama_content.insert_ad_info_data(16,314396,969308, to_char(dt_prevista_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_prevista_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(16));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(17,293478,969309,ds_servico_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(17));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(18,310486,969313,nm_prof_previsto_w,null,null,3,null,ie_concluido_p,null,arr_order_pres(18));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			elsif (r_c_leitos_info.ie_status_unidade = 'H') then
				CALL search_panorama_content.insert_ad_info_data(16,291978,969318,to_char(dt_inicio_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_inicio_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(16));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(17,293478,969309,ds_servico_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(17));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				CALL search_panorama_content.insert_ad_info_data(18,296514,969319,ds_executor_w,null,null,3,null,ie_concluido_p,null,arr_order_pres(18));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			end if;

		-- INTERDITADO
		elsif (r_c_leitos_info.ie_status_unidade = 'I') and (arr_order_pres.EXISTS(19))and (arr_order_pres.EXISTS(20)) then
			begin
				select	a.dt_historico,
						coalesce(substr((select OBTER_DESC_MOT_INTER(a.CD_MOTIVO_INTERDICAO) ),1,60), (select wheb_mensagem_pck.get_texto(997030) ))
				into STRICT	dt_historico_interdicao_w,
						ds_motivo_interdicao_w
				from	unidade_atend_hist a,
						unidade_atendimento b
				where	a.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
				and		b.nr_seq_interno = a.nr_seq_unidade
				and 	coalesce(a.dt_fim_historico::text, '') = ''
				and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
				and 	a.dt_historico =
						(SELECT	max(z.dt_historico)
						from    unidade_atend_hist z
						where   z.nr_seq_unidade = b.nr_seq_interno
						and 	coalesce(z.dt_fim_historico::text, '') = ''
						and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
			exception
				when others then
				null;
			end;

			CALL search_panorama_content.insert_ad_info_data(19,291978,969320,to_char(dt_historico_interdicao_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_historico_interdicao_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(19));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(20,293478,969321,ds_motivo_interdicao_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(20));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);

		-- ACOMPANHANTE
		elsif (r_c_leitos_info.ie_status_unidade = 'M')and (arr_order_pres.EXISTS(21)) and (arr_order_pres.EXISTS(22)) then
			begin
				select	coalesce((select obter_nome_pf(cd_paciente_reserva) ), nm_pac_reserva),
						nr_atendimento_acomp
				into STRICT	nm_acompanhante_w,
						nr_atendimento_w
				from	unidade_atendimento
				where	nr_seq_interno = r_c_leitos_info.nr_seq_interno;
			exception
				when others then
				null;
			end;

			if (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') then
				select (select obter_nome_pf(cd_pessoa_fisica) )
				into STRICT    nm_paciente_w
				from	atendimento_paciente
				where	nr_atendimento = nr_atendimento_w;
			end if;

			CALL search_panorama_content.insert_ad_info_data(21,283172,974474,nm_acompanhante_w,null,null,1,null,ie_concluido_p,null,arr_order_pres(21));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(21,295156,969294,nm_paciente_w,null,null,1,null,ie_concluido_p,null,arr_order_pres(21));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(22,283863,969361,null,nr_atendimento_w,null,2,null,ie_concluido_p,null,arr_order_pres(22));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);

		-- ISOLAMENTO
		elsif (r_c_leitos_info.ie_status_unidade = 'O')and (arr_order_pres.EXISTS(23)) and (arr_order_pres.EXISTS(24)) then
			begin
				select	a.dt_historico,
						coalesce(substr((select obter_motivo_isol_leito(a.nr_seq_mot_isol) ),1,255), (select wheb_mensagem_pck.get_texto(997030) ))
				into STRICT	dt_historico_isolamento_w,
						ds_motivo_isolamento_w
				from	unidade_atend_hist a,
						unidade_atendimento b
				where	a.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
				and		b.nr_seq_interno = a.nr_seq_unidade
				and 	coalesce(a.dt_fim_historico::text, '') = ''
				and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
				and 	a.dt_historico =
						(SELECT	max(z.dt_historico)
						from    unidade_atend_hist z
						where   z.nr_seq_unidade = b.nr_seq_interno
						and 	coalesce(z.dt_fim_historico::text, '') = ''
						and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
			exception
				when others then
				null;
			end;

			CALL search_panorama_content.insert_ad_info_data(23,291978,969422,to_char(dt_historico_isolamento_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_historico_isolamento_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(23));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(24,293478,969502,ds_motivo_isolamento_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(24));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);

		-- RESERVADO
		elsif (r_c_leitos_info.ie_status_unidade = 'R') and (arr_order_pres.EXISTS(25)) and (arr_order_pres.EXISTS(26)) then
			begin
				select	coalesce(nm_pac_reserva, (select obter_nome_pf(cd_paciente_reserva) ))
				into STRICT	nm_paciente_reserva_w
				from	unidade_atendimento
				where	nr_seq_interno = r_c_leitos_info.nr_seq_interno;
			exception
				when others then
				null;
			end;

			if (coalesce(r_c_leitos_info.ie_retaguarda_atual,'N') = 'S') then
				CALL search_panorama_content.insert_ad_info_data(25,683266,969587,'719927',null,null,1,null,ie_concluido_p,null,arr_order_pres(25));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			end if;

			if (nm_paciente_reserva_w IS NOT NULL AND nm_paciente_reserva_w::text <> '') then
				CALL search_panorama_content.insert_ad_info_data(26,295156,969602,nm_paciente_reserva_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(26));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			end if;
		--LIVRE
		elsif (r_c_leitos_info.ie_status_unidade = 'L') and (arr_order_pres.EXISTS(25)) and (arr_order_pres.EXISTS(27)) then
			begin
				select	1
				into STRICT 	ie_solicitacao_reserva_pend_w
				from	unidade_atendimento a,
						gestao_vaga b
				where	a.cd_setor_atendimento = b.cd_setor_desejado
				and		a.cd_unidade_basica = b.cd_unidade_basica
				and		a.cd_unidade_compl = b.cd_unidade_compl
				and		b.ie_status not in ('F','C','D','N','T')
				and		a.nr_seq_interno = r_c_leitos_info.nr_seq_interno  LIMIT 1;
			exception
				when others then
				null;
			end;

			if (coalesce(r_c_leitos_info.ie_retaguarda_atual,'N') = 'S') then
				CALL search_panorama_content.insert_ad_info_data(25,683266,969628,'719927',null,null,1,null,ie_concluido_p,null,arr_order_pres(25));
				RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				if (ie_solicitacao_reserva_pend_w = 1) then
					CALL search_panorama_content.insert_ad_info_data(27,100330842,969629,'719927',null,null,1,null,ie_concluido_p,null,arr_order_pres(27));
					RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
				end if;
			end if;
		--SAIDA INTERDICAO
		elsif (r_c_leitos_info.ie_status_unidade = 'S') and (arr_order_pres.EXISTS(19))and (arr_order_pres.EXISTS(20)) then
			begin
				select	a.dt_historico
				into STRICT	dt_historico_interdicao_w
				from	unidade_atend_hist a,
						unidade_atendimento b
				where	a.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
				and		b.nr_seq_interno = a.nr_seq_unidade
				and 	coalesce(a.dt_fim_historico::text, '') = ''
				and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
				and 	a.dt_historico =
						(SELECT	max(z.dt_historico)
						from    unidade_atend_hist z
						where   z.nr_seq_unidade = b.nr_seq_interno
						and 	coalesce(z.dt_fim_historico::text, '') = ''
						and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> ''));
			exception
				when others then
				null;
			end;

			begin
				select	coalesce(substr((select OBTER_DESC_MOT_INTER(a.CD_MOTIVO_INTERDICAO) ),1,60), (select wheb_mensagem_pck.get_texto(997030) ))
				into STRICT	ds_motivo_interdicao_w
				from	unidade_atend_hist a,
						unidade_atendimento b
				where	a.nr_seq_unidade = r_c_leitos_info.nr_seq_interno
				and		b.nr_seq_interno = a.nr_seq_unidade
				and  	(a.dt_historico IS NOT NULL AND a.dt_historico::text <> '')
				and 	a.dt_historico =
						(SELECT	max(z.dt_historico)
						from    unidade_atend_hist z
						where   z.nr_seq_unidade = b.nr_seq_interno
						and 	coalesce(z.dt_fim_historico::text, '') = ''
						and  	(z.dt_historico IS NOT NULL AND z.dt_historico::text <> '')
						and 	z.ie_status_unidade = 'I');
			exception
				when others then
				null;
			end;

			CALL search_panorama_content.insert_ad_info_data(19,291978,969647,to_char(dt_historico_interdicao_w, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario))),null,dt_historico_interdicao_w,1,'date(shortDate)', ie_concluido_p,null,arr_order_pres(19));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);
			CALL search_panorama_content.insert_ad_info_data(20,293478,969661,ds_motivo_interdicao_w,null,null,2,null,ie_concluido_p,null,arr_order_pres(20));
			RETURN NEXT current_setting('search_panorama_content.t_objeto_ad_info_row_w'::t_objeto_ad_info_row);

		end if;
    end loop;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION search_panorama_content.get_ad_info_data (nr_seq_interno_p bigint, ie_concluido_p text, nr_atendimento_p bigint default null) FROM PUBLIC;
