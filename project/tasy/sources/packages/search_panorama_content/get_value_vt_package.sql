-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION search_panorama_content.get_value_vt (nr_atendimento_p bigint) RETURNS bigint AS $body$
DECLARE

  qt_vc_prog_w bigint;
  qt_imc_w bigint;
  vt_value_w bigint;

BEGIN
    SELECT max(amr.qt_vc_prog) into STRICT qt_vc_prog_w
    FROM atendimento_monit_resp amr
    WHERE amr.nr_atendimento = nr_atendimento_p
    AND amr.nr_sequencia =
          (SELECT MAX(amr1.NR_SEQUENCIA)
            FROM atendimento_monit_resp amr1
            WHERE amr1.nr_atendimento = nr_atendimento_p);

   
    SELECT max(asv.qt_imc) into STRICT qt_imc_w
    FROM atendimento_sinal_vital asv
    WHERE asv.nr_atendimento = nr_atendimento_p
    AND asv.nr_sequencia =
         (SELECT MAX(asv1.NR_SEQUENCIA)
          FROM atendimento_sinal_vital asv1
          WHERE asv1.nr_atendimento = nr_atendimento_p);

    vt_value_w := round((qt_vc_prog_w / qt_imc_w)::numeric,1);

    return vt_value_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION search_panorama_content.get_value_vt (nr_atendimento_p bigint) FROM PUBLIC;
