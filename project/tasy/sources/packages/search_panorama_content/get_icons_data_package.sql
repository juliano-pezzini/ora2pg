-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


CREATE TYPE src_organ_icons_w AS (src_organ_icons_w varchar(255)[5]);


CREATE OR REPLACE FUNCTION search_panorama_content.get_icons_data (cd_setor_atendimento_p bigint, cd_unidade_basica_p text, nr_seq_interno_p bigint) RETURNS SETOF T_OBJETO_ICONS_ROW_DATA AS $body$
DECLARE


c_unidadeBasica CURSOR FOR
SELECT * from unidade_atendimento where nr_seq_interno = nr_seq_interno_p;

c_patient CURSOR FOR
SELECT * from table(search_panorama_content.get_data(cd_setor_atendimento_p,cd_unidade_basica_p,nr_seq_interno_p));

c_profile_icons_ocor CURSOR FOR
SELECT	ri.cd_icone_panorama, ri.nr_seq_prioridade, ri.ds_icone_instituicao
  from	regra_perm_panorama r
inner join regra_perm_panorama_icone ri on ri.nr_seq_regra = r.nr_sequencia
 where r.nr_sequencia in (select nr_sequencia from regra_perm_panorama where cd_perfil  = wheb_usuario_pck.get_cd_perfil);


 c_profile_icons_pat CURSOR FOR
SELECT	ri.cd_icone_panorama, ri.nr_seq_prioridade, ri.ds_icone_instituicao
  from	regra_perm_panorama r
inner join regra_panorama_icone_pac ri on ri.nr_seq_regra = r.nr_sequencia
 where r.nr_sequencia = (select max(nr_sequencia) from regra_perm_panorama where cd_perfil  = wheb_usuario_pck.get_cd_perfil);

 --ocor_alerta_3
c_alerta CURSOR(cd_pessoa_fisica_p  text) FOR
SELECT	a.dt_alerta,
		a.ds_alerta
  from	atendimento_alerta a,
		atendimento_paciente b
 where	b.cd_pessoa_fisica = cd_pessoa_fisica_p
   and		a.nr_atendimento = b.nr_atendimento
   and		a.ie_situacao = 'A'
   and		((coalesce(a.dt_fim_alerta::text, '') = '') or (a.dt_fim_alerta >= trunc(clock_timestamp(),'dd')))

union all

 SELECT	a.dt_alerta,
		a.ds_alerta
   from	alerta_paciente a
  where	a.cd_pessoa_fisica = cd_pessoa_fisica_p
	and		a.ie_situacao = 'A'
	and		((coalesce(a.dt_fim_alerta::text, '') = '') or (a.dt_fim_alerta >= trunc(clock_timestamp(),'dd')))
order by 1, 2;


--ocor_exame_lab_4
c_prescricao_4 CURSOR(nr_atendimento_p  bigint)FOR
	SELECT	b.dt_prescricao,
			b.nr_prescricao,
			c.nr_seq_exame,
			substr(p.ds_procedimento,1,120) ds_procedimento
	from	atendimento_paciente a,
			prescr_medica b,
			procedimento p,
			exame_laboratorio z,
			prescr_procedimento c
			left outer join proc_interno w on w.nr_sequencia = c.nr_seq_proc_interno
	where	a.nr_atendimento = nr_atendimento_p
	and		a.nr_atendimento = b.nr_atendimento
	and		b.nr_prescricao = c.nr_prescricao
	and		p.cd_procedimento = c.cd_procedimento
	and		p.ie_origem_proced = c.ie_origem_proced
	and		z.nr_seq_exame = c.nr_seq_exame
	and		b.dt_prescricao > clock_timestamp() - interval '2 days'
	and		c.ie_suspenso = 'N'
	and		(c.nr_seq_exame IS NOT NULL AND c.nr_seq_exame::text <> '')
	and		coalesce(c.nr_seq_solic_sangue::text, '') = ''
	and		coalesce(c.nr_seq_derivado::text, '') = ''
	and		coalesce(c.nr_seq_exame_sangue::text, '') = ''
	and		c.ie_amostra = 'N'
	and		c.ie_status_atend <> 20
	and		c.cd_motivo_baixa = 0
	and	((coalesce(w.nr_sequencia::text, '') = ''
			and coalesce(c.nr_seq_proc_interno::text, '') = '') or ((w.nr_sequencia IS NOT NULL AND w.nr_sequencia::text <> '')
			and	(c.nr_seq_proc_interno IS NOT NULL AND c.nr_seq_proc_interno::text <> '')
			and	coalesce(c.nr_seq_prot_glic::text, '') = ''
			and	coalesce(c.nr_seq_origem::text, '') = ''
			and	coalesce(w.ie_tipo,'O') not in ('G','BS')
			and	coalesce(w.ie_ivc,'N') <> 'S'))
	and		exists (	SELECT	1
					from	prescr_proc_hor d
					where	c.nr_prescricao = d.nr_prescricao
					and	c.nr_sequencia = d.nr_seq_procedimento
					and	coalesce(d.dt_fim_horario::text, '') = ''
					and	coalesce(d.ie_situacao,'A') = 'A'  LIMIT 1)
	and (select adep_obter_regra_inclusao('LAB', b.cd_estabelecimento, b.cd_setor_atendimento,
									b.cd_perfil_ativo, null, p.cd_procedimento, p.ie_origem_proced,
									c.nr_seq_proc_interno, b.cd_Setor_atendimento,c.cd_Setor_atendimento,
									b.nr_prescricao, c.nr_seq_exame) ) = 'N';

--ocor_exame_enf_5
c_precricao_5 CURSOR(nr_atendimento_p  bigint) FOR
	SELECT	b.dt_prescricao,
			b.nr_prescricao,
			c.nr_seq_exame,
			(SELECT substr(p.ds_procedimento,1,120) ) ds_procedimento
	from	atendimento_paciente a,
			prescr_medica b,
			procedimento p,
			exame_laboratorio z,
			prescr_procedimento c
			left outer join proc_interno w on w.nr_sequencia = c.nr_seq_proc_interno
	where	a.nr_atendimento = nr_atendimento_p
	and		a.nr_atendimento = b.nr_atendimento
	and		b.nr_prescricao = c.nr_prescricao
	and		p.cd_procedimento = c.cd_procedimento
	and		p.ie_origem_proced = c.ie_origem_proced
	and		z.nr_seq_exame = c.nr_seq_exame
	and		b.dt_prescricao > clock_timestamp() - interval '2 days'
	and		c.ie_suspenso = 'N'
	and		(c.nr_seq_exame IS NOT NULL AND c.nr_seq_exame::text <> '')
	and		coalesce(c.nr_seq_solic_sangue::text, '') = ''
	and		coalesce(c.nr_seq_derivado::text, '') = ''
	and		coalesce(c.nr_seq_exame_sangue::text, '') = ''
	and		((coalesce(w.nr_sequencia::text, '') = ''
				and coalesce(c.nr_seq_proc_interno::text, '') = '') or ((w.nr_sequencia IS NOT NULL AND w.nr_sequencia::text <> '')
				and	(c.nr_seq_proc_interno IS NOT NULL AND c.nr_seq_proc_interno::text <> '')
				and	coalesce(c.nr_seq_prot_glic::text, '') = ''
				and	coalesce(c.nr_seq_origem::text, '') = ''
				and	coalesce(w.ie_tipo,'O') not in ('G','BS')
				and	coalesce(w.ie_ivc,'N') <> 'S'))
	and		exists (	select	1
					from	prescr_proc_hor d
					where	c.nr_prescricao = d.nr_prescricao
					and	c.nr_sequencia = d.nr_seq_procedimento
					and	coalesce(d.dt_fim_horario::text, '') = ''
					and	coalesce(d.ie_situacao,'A') = 'A'  LIMIT 1)
	and (select adep_obter_regra_inclusao('LAB', b.cd_estabelecimento,
										b.cd_setor_atendimento, b.cd_perfil_ativo, null,
										p.cd_procedimento, p.ie_origem_proced, c.nr_seq_proc_interno,
										b.cd_Setor_atendimento,c.cd_Setor_atendimento,
										b.nr_prescricao, c.nr_seq_exame) ) = 'S';

 --ocor_it_susp_sol_6
c_prescricao_6 CURSOR(nr_atendimento_p  bigint)FOR
	SELECT	b.nr_prescricao,
			c.dt_suspensao,
			c.nr_seq_solucao cd_item,
			substr(coalesce(c.ds_solucao, (SELECT obter_prim_comp_sol(b.nr_prescricao,c.nr_seq_solucao) ) ),1,240) ds_item
	from	atendimento_paciente a,
			prescr_medica b,
			prescr_solucao c
	where	a.nr_atendimento = nr_atendimento_p
	and		a.nr_atendimento = b.nr_atendimento
	and		c.nr_prescricao = b.nr_prescricao
	and		b.dt_prescricao > clock_timestamp() - interval '2 days'
	and		c.ie_suspenso = 'S'
	and (select Obter_se_prescr_vigente(b.nr_prescricao) ) = 'S';

--ocor_exame_lab_res_10
c_laboratorio_resultado CURSOR(nr_atendimento_p  bigint) FOR
    SELECT
        er.dt_resultado,
        el.NM_EXAME,
        eri.qt_resultado,
        eri.ds_resultado,
        eri.ds_unidade_medida,
        eri.ds_flag,
        elp.ie_tipo_valor
    FROM
        exame_lab_resultado     er,
        exame_lab_result_item   eri
        LEFT JOIN(SELECT elp.ie_tipo_valor,elp.nr_seq_exame,elp.ie_situacao,elp.qt_minima,elp.qt_maxima,elp.nr_seq_prioridade from  exame_lab_padrao elp order by elp.nr_seq_prioridade asc) elp ON (eri.nr_seq_exame = elp.nr_seq_exame and elp.ie_situacao='A' and  eri.qt_resultado >= elp.qt_minima and eri.qt_resultado <=elp.qt_maxima ),
        exame_laboratorio       el
    WHERE
        er.nr_atendimento = nr_atendimento_p
        AND er.nr_seq_resultado = eri.nr_seq_resultado
        AND eri.nr_seq_exame = el.nr_seq_exame
        AND (er.dt_resultado IS NOT NULL AND er.dt_resultado::text <> '')
        AND (er.dt_liberacao IS NOT NULL AND er.dt_liberacao::text <> '')
        AND ((eri.qt_resultado IS NOT NULL AND eri.qt_resultado::text <> '') OR (eri.ds_resultado IS NOT NULL AND eri.ds_resultado::text <> ''))
        AND ( eri.qt_resultado >0 OR (eri.ds_resultado IS NOT NULL AND eri.ds_resultado::text <> '') )
        AND NOT EXISTS (SELECT 1 FROM laudo_paciente_ciente lpc WHERE lpc.nr_prescricao= er.nr_prescricao and lpc.ie_tipo_acao = 'M' and lpc.nm_usuario = wheb_usuario_pck.get_nm_usuario  LIMIT 1)
        order by er.dt_resultado asc;

--ocor_res_critico_11
c_exame_11 CURSOR(nr_atendimento_p  bigint, ie_visualizacao_icon_p  text )FOR
	SELECT  d.dt_resultado,
			d.nr_prescricao,
			substr((SELECT obter_desc_exame_lab(e.nr_seq_exame,null,null,null) ),1,255) ds_exame,
			substr((select obter_nome_medico(coalesce(d.cd_medico,e.cd_medico_resp),'N') ),1,60) nm_medico,
			substr((select obter_result_lab_panorama(d.nr_seq_resultado, e.ds_resultado, e.qt_resultado, e.pr_resultado, e.nr_seq_prescr, d.nr_prescricao, e.nr_seq_exame) ),1,255) ||
				' ' || (select Obter_LAB_Unid_Med(e.nr_seq_unid_med,'C') ) ds_resultado
	from	exame_lab_resultado d,
			exame_lab_result_item e
	where	d.nr_seq_resultado = e.nr_seq_resultado
	and		d.nr_atendimento = nr_atendimento_p
	and		coalesce(e.dt_visualizacao::text, '') = ''
	and		e.dt_liberacao > clock_timestamp() - interval '1 days'
	and (select lab_se_result_nao_aceit(d.nr_seq_resultado, e.ds_resultado, e.qt_resultado, e.pr_resultado, e.nr_seq_prescr, d.nr_prescricao, e.nr_seq_exame) ) = 'S'
	and (ie_visualizacao_icon_p =  'L')
	
union all

	select  d.dt_resultado,
			d.nr_prescricao,
			substr((select obter_desc_exame_lab(e.nr_seq_exame,null,null,null) ),1,255) ds_exame,
			substr((select obter_nome_medico(coalesce(d.cd_medico,e.cd_medico_resp),'N') ),1,60) nm_medico,
			substr((select obter_result_lab_panorama(d.nr_seq_resultado, e.ds_resultado, e.qt_resultado, e.pr_resultado, e.nr_seq_prescr, d.nr_prescricao, e.nr_seq_exame) ),1,255) ||
				' ' || (select Obter_LAB_Unid_Med(e.nr_seq_unid_med,'C') ) ds_resultado
	from	exame_lab_resultado d,
			exame_lab_result_item e
	where	d.nr_seq_resultado = e.nr_seq_resultado
	and		d.nr_atendimento = nr_atendimento_p
	and		coalesce(e.dt_visualizacao::text, '') = ''
	and		e.dt_aprovacao > clock_timestamp() - interval '1 days'
	and (select lab_se_result_nao_aceit(d.nr_seq_resultado, e.ds_resultado, e.qt_resultado, e.pr_resultado, e.nr_seq_prescr, d.nr_prescricao, e.nr_seq_exame) ) = 'S'
	and (coalesce(ie_visualizacao_icon_p,'X') <> 'L');

--ocor_it_susp_med_13
c_prescricao_13 CURSOR(nr_atendimento_p  bigint) FOR
	SELECT	b.nr_prescricao,
			c.dt_suspensao,
			m.cd_material cd_item,
			m.ds_material ds_item
	from	atendimento_paciente a,
			prescr_medica b,
			prescr_material c,
			material m
	where	a.nr_atendimento = nr_atendimento_p
	and		a.nr_atendimento = b.nr_atendimento
	and		b.nr_prescricao = c.nr_prescricao
	and		m.cd_material = c.cd_material
	and		b.dt_prescricao > clock_timestamp() - interval '2 days'
	and		c.ie_suspenso = 'S'
	and		c.ie_agrupador not in (3,4,7,9)
	and		coalesce(c.nr_seq_kit::text, '') = ''
	and (SELECT Obter_se_prescr_vigente(b.nr_prescricao) ) = 'S';

--ocor_it_n_conf_enf_14
c_prescricao_14_a CURSOR(nr_atendimento_p  bigint) FOR
	SELECT	a.*
	from	pan_item_prescr_nao_conf_v a
	where	a.nr_atendimento	= nr_atendimento_p
	and		coalesce(a.dt_liberacao::text, '') = ''
    and	    a.dt_inicio between trunc(clock_timestamp()) and fim_dia(clock_timestamp() + interval '1 days');

c_prescricao_14_b CURSOR(nr_atendimento_p  bigint) FOR
	SELECT	a.*
	from	pan_item_prescr_nao_conf_v a
	where	a.nr_atendimento	= nr_atendimento_p
	and		coalesce(a.dt_liberacao::text, '') = ''
    and	    a.dt_inicio >= trunc(clock_timestamp() + interval '2 days');

--ocor_it_n_conf_farm_15
c_prescricao_15 CURSOR(nr_atendimento_p  bigint) FOR
	SELECT	a.*
	from	pan_item_prescr_nao_conf_v a
	where	a.nr_atendimento	= nr_atendimento_p
  and		coalesce(a.dt_liberacao_farmacia::text, '') = ''
	and		a.ie_momento_lote = 'F'
	and	  trunc(a.dt_inicio) between trunc(clock_timestamp()) and fim_dia(clock_timestamp() + interval '1 days')
;

--ocor_exame_nonlab_57
c_prescricao_57 CURSOR(nr_atendimento_p  bigint) FOR
	SELECT distinct b.dt_prescricao,
	b.nr_prescricao,
	(SELECT Obter_Desc_Procedimento(c.cd_PROCEDIMENTO,c.IE_ORIGEM_PROCED) ) ds_procedimento
	from	atendimento_paciente a,
			prescr_medica b,
			procedimento p,
			laudo_paciente	z,
			prescr_procedimento c
			left outer join proc_interno w on w.nr_sequencia = c.nr_seq_proc_interno
	where	a.nr_atendimento = nr_atendimento_p
	and c.nr_sequencia = z.NR_SEQ_PRESCRICAO
	and		a.nr_atendimento = b.nr_atendimento
	and		b.nr_prescricao = c.nr_prescricao
	and		p.cd_procedimento = c.cd_procedimento
	and		p.ie_origem_proced = c.ie_origem_proced
	and		b.dt_prescricao > clock_timestamp() - interval '2 days'
	and		c.ie_suspenso = 'N'
	and		c.nr_seq_exame is  null
	and	((coalesce(w.nr_sequencia::text, '') = ''
			and coalesce(c.nr_seq_proc_interno::text, '') = '') or ((w.nr_sequencia IS NOT NULL AND w.nr_sequencia::text <> '')
			and	(c.nr_seq_proc_interno IS NOT NULL AND c.nr_seq_proc_interno::text <> '')
			and	coalesce(c.nr_seq_prot_glic::text, '') = ''
			and	coalesce(c.nr_seq_origem::text, '') = ''
			and	coalesce(w.ie_tipo,'O') not in ('G','BS')
			and	coalesce(w.ie_ivc,'N') <> 'S'))
	and		exists (	select	1
					from	prescr_proc_hor d
					where	c.nr_prescricao = d.nr_prescricao
					and	c.nr_sequencia = d.nr_seq_procedimento
					and	coalesce(d.dt_fim_horario::text, '') = ''
					and	coalesce(d.ie_situacao,'A') = 'A'  LIMIT 1)
	and (select adep_obter_regra_inclusao('PROC', b.cd_estabelecimento, b.cd_setor_atendimento,
									b.cd_perfil_ativo, null, c.cd_procedimento, c.ie_origem_proced,
									c.nr_seq_proc_interno, b.cd_Setor_atendimento,c.cd_Setor_atendimento,
									b.nr_prescricao, c.nr_seq_exame) ) = 'S';
--dispositivos
c_devices CURSOR(nr_atendimento_p  bigint) FOR
SELECT apd.dt_instalacao, d.ds_dispositivo, apd.dt_retirada_prev, c.dt_alta, CASE WHEN apd.ie_acao='A' THEN 'S'  ELSE 'N' END  ie_disp_alta,apd.ie_sucesso, apd.dt_retirada
from dispositivo d,
	atendimento_paciente c,
	atend_pac_dispositivo apd
where	apd.nr_seq_dispositivo = d.nr_sequencia
and apd.nr_atendimento = nr_atendimento_p
and	c.nr_atendimento = apd.nr_atendimento
and	coalesce(dt_retirada::text, '') = ''
and coalesce(d.ie_exibe_panorama,'N') = 'S';

--follow_up
c_follow_up CURSOR(nr_atendimento_p  bigint) FOR
SELECT fl.nr_sequencia
  from panorama_acomp_prof fl
  where fl.ie_acomp_ativo='S'
    and fl.nr_atendimento = nr_atendimento_p
    and fl.nm_usuario =wheb_usuario_pck.get_nm_usuario;

--Watchlist
c_watchlist CURSOR(cd_pessoa_fisica_p  text) FOR
SELECT distinct wl.cd_pessoa_fisica
  from panorama_acomp_watchlist wl
  where wl.cd_pessoa_fisica = cd_pessoa_fisica_p
    and wl.nm_usuario_nrec = wheb_usuario_pck.get_nm_usuario;

--intervention_pen
c_intervention_pen CURSOR(nr_atendimento_p  bigint) FOR
 SELECT er.dt_atualizacao, et.ds_template
 from EHR_REGISTRO er
 left join EHR_TEMPLATE et on et.nr_sequencia=er.nr_seq_templ
 where er.nr_atendimento=nr_atendimento_p
 and coalesce(er.dt_liberacao::text, '') = '' 
 and er.nm_usuario= wheb_usuario_pck.get_nm_usuario;

--body_system_setor
    c_algoritmo_icon CURSOR(p_cd_setor_atendimento bigint) FOR
    SELECT
        apc.ie_escala_acuidade
    FROM
        pan_configuracao_setor      t,
        acuidade_panorama_clinico   apc
    WHERE
        t.nr_sequencia = apc.nr_seq_pan_config_setor
        AND t.cd_setor_atendimento = p_cd_setor_atendimento
        AND t.ie_situacao = 'A';

--body_system
c_body_system_AA CURSOR(p_nr_atendimento bigint) FOR
    SELECT
       ac.ie_sistema_organismo,
       ac.nr_pontuacao,
       ac.nr_peso
    FROM automated_acuity aa, automated_acuity_component ac
    WHERE aa.nr_sequencia = ac.cd_automated_acuity
    AND   aa.nr_atendimento = p_nr_atendimento
    AND   (aa.ie_tipo_cuidado IS NOT NULL AND aa.ie_tipo_cuidado::text <> '')
    AND   aa.nr_sequencia = (SELECT MAX(aa_sub.nr_sequencia) FROM automated_acuity aa_sub
                                WHERE aa_sub.nr_atendimento = aa.nr_atendimento)
    order by CASE WHEN ac.ie_sistema_organismo='NEU' THEN 1 WHEN ac.ie_sistema_organismo='CAR' THEN 2 WHEN ac.ie_sistema_organismo='RES' THEN 3 WHEN ac.ie_sistema_organismo='REN' THEN 4 WHEN ac.ie_sistema_organismo='HEM' THEN 5 WHEN ac.ie_sistema_organismo='DOE' THEN 6 END;

c_task_list_alerts CURSOR(nr_atendimento_cp bigint, ie_task_status_cp text) FOR
	SELECT 	wl.dt_final_previsto dt_alerta,
			substr( coalesce(obter_informacao_wl(wl.nr_seq_regra, 'A', wl.nr_sequencia), wl.DS_MANUAL_TASK) , 1, 255) ds_alerta
	FROM 	wl_worklist wl
	RIGHT JOIN wl_item it ON wl.nr_seq_item = it.nr_sequencia
	INNER JOIN wl_regra_worklist rw ON rw.nr_seq_item = it.nr_sequencia
	WHERE	it.ie_situacao = 'A'
	AND 	wl.dt_inicial BETWEEN TRUNC(clock_timestamp() - interval '7 days') AND TRUNC(clock_timestamp() + interval '1 days')
	AND 	wl.nr_atendimento = nr_atendimento_cp
	AND 	obter_status_worklist(wl.nr_sequencia, 'C') = ie_task_status_cp --'A' -- overdue (atrasado)
	ORDER BY SUBSTR(obter_prioridade_worklist(wl.nr_seq_item), 1, 80);

--Comments -- 93
  c_comment CURSOR(nr_atendimento_p  bigint) FOR
     SELECT a.dt_atualizacao,
            a.ds_comentario 
       from panorama_card_comment a
      where a.ie_situacao = 'A'
        and a.nr_atendimento = nr_atendimento_p
      order by 1 desc ,2;
type tab_organ_icons_w         IS TABLE OF src_organ_icons_w INDEX BY varchar(3);
icons_organ_w tab_organ_icons_w;

ie_fall_risk_w varchar(5);
ie_patient_gender varchar(5);
qt_protocolos_ativos_w bigint;
respiracao_w atendimento_monit_resp.ie_respiracao%type;
traqueo_w atendimento_monit_resp.ie_canula_traqueo%type;
integracao_w atendimento_monit_resp.ie_integracao%type;
interface_w atendimento_monit_resp.ie_disp_resp_esp%type;
liberacao_w atendimento_monit_resp.dt_liberacao%type;
nr_regra_icon_w bigint;
ie_has_ventilation varchar(1) := 'S';
ds_descrtion_icon_w varchar(2000);
desc_bed_w  varchar(255);
desc_name_w varchar(255);
desc_age_w  varchar(255);
desc_sexo_w varchar(255);
desc_icon_w varchar(5);
v_countBaby		integer:=0;
ds_isolation_w varchar(255);
nr_encounter_status_w integer;
ie_risco_queda_w varchar(5);
ds_alerta_w	varchar(10000)	:= null;
dt_alerta_w	varchar(4000)	:= null;
qt_hora_pend_prescr_w	bigint;
cd_setor_atendimento_w	integer;
dt_solicitacao_w		timestamp;
ds_status_w				varchar(255);
dt_prevista_w			timestamp;
ds_tipo_acomodacao_w	varchar(255);
ds_setor_desejado_w		varchar(255);
cd_unidade_desejada_w	varchar(255);
ie_alerta_w		varchar(3);
ie_visualizacao_icon_w		varchar(3);
ie_pac_mr_w			varchar(5);
ie_pac_isol_w		varchar(5);
dt_solicit_w varchar(4000)	:= null;
w_tot_pendencias bigint := 0;
w_tot_pendencias_atrasadas bigint := 0;
w_achou_atrasado bigint := 0;
ds_pac_away_w	varchar(10000)	:= null;
ie_pac_away_w			varchar(1);
ds_surgery_status_w	varchar(1000)	:= null;
ds_img_address_w	varchar(1000)	:= null;
ie_surgery_status_w	varchar(2);
nr_seq_legenda_w	bigint;
nr_atendimento_w	bigint;
cd_pessoa_fisica_w varchar(20);
ie_icon_devide_prior_w smallint;
ie_icon_devide_w smallint;
ie_device_label_w bigint;
ie_time_device_alert_w  integer;
cd_label_sexo_w bigint;
ie_end_life_w smallint;
icone_organ_w                 varchar(255);
icone_body_system_w           varchar(255);
cd_exp_body_system_w          bigint;
json_html_organ_item_w        PHILIPS_JSON;
json_html_organ_list_w        PHILIPS_JSON_LIST;
ie_follow_up                  boolean := TRUE;
ie_watchlist                  boolean := TRUE;
qtd_chamadas_v                bigint;
nr_pontuacao_body_sys_w       varchar(2);
pontuacao_organ_w             varchar(2);
nr_min_result_exam_w          bigint;
nr_min_exibir_result_w        bigint;
nr_qtd_results_w              bigint;
icon_result_exam_w            varchar(255);
ds_result_exam_w              varchar(4000);
ds_result_exam_div_w          varchar(4000);
ds_dt_result_exam_w           varchar(255);
nr_evolucao_w                 bigint;
nr_notas_nao_visualizadas_w   bigint := 0;
ds_intervention_pen_w         varchar(4000);
exec_w						  varchar(300);
  r1 RECORD;
  r_companions RECORD;
  r_newBorn RECORD;
BEGIN

	select max(nr_sequencia)
	  into STRICT nr_regra_icon_w
	  from regra_perm_panorama
	 where cd_perfil  = wheb_usuario_pck.get_cd_perfil;

	select max(nr_atendimento)
	  into STRICT nr_atendimento_w
	  from unidade_atendimento
	 where nr_seq_interno = nr_seq_interno_p;

	select max(cd_pessoa_fisica)
	  into STRICT cd_pessoa_fisica_w
	  from atendimento_paciente
	 where nr_atendimento = nr_atendimento_w;

	select coalesce((select obter_status_atend_panorama(nr_seq_interno_p) ),0)
		into STRICT nr_encounter_status_w
		;

	for r_profile_icons in c_profile_icons_ocor loop
			--ocor_it_nao_chec_1
		if (r_profile_icons.cd_icone_panorama = 1) then
			begin
				ds_alerta_w:= null;

        select max(obter_setor_atendimento(nr_atendimento_w))
        into STRICT cd_setor_atendimento_w
;

				select max((select Obter_qt_hor_pendente_prescr(wheb_usuario_pck.get_cd_estabelecimento,cd_setor_atendimento_w,null/*cd_perfil_p*/
,nr_atendimento_w,0,trunc(clock_timestamp()),clock_timestamp(),1,'S',0,0,0,'S') ))
        into STRICT qt_hora_pend_prescr_w
;

				if (qt_hora_pend_prescr_w > 0) then
						ds_alerta_w := wheb_mensagem_pck.get_texto(1009750);
						CALL search_panorama_content.insert_icons_data(1,get_icon_path(593, null),967897,r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,4000),r_profile_icons.nr_seq_prioridade, 'F', 1204684);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
					end if;
			end;
		end if;
		--ocor_alerta_3
		if (r_profile_icons.cd_icone_panorama = 3) then
			begin
				ds_alerta_w:= null;
				for r_c_alerta in c_alerta(cd_pessoa_fisica_w) loop
					if (coalesce(length(ds_alerta_w),0) < 10000) then
						dt_alerta_w := '<div>' || to_char(r_c_alerta.dt_alerta,'dd/mm/yyyy hh24:mi:ss');
						ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_alerta.ds_alerta|| '</div><br>',1,4000);
					end if;
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(3,get_icon_path(586, null),968048,r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,4000),r_profile_icons.nr_seq_prioridade, 'F', 968176);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_exame_lab_4
		if (r_profile_icons.cd_icone_panorama = 4) then
			begin
				ds_alerta_w:= null;
				for	r_c_prescricao_4 in c_prescricao_4(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_prescricao_4.dt_prescricao,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_prescricao_4.ds_procedimento|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(4,get_icon_path(590, null),967927,r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,4000),r_profile_icons.nr_seq_prioridade, 'F', 988845);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_exame_enf_5
		if (r_profile_icons.cd_icone_panorama = 5) then
			begin
				ds_alerta_w:= null;
				for r_c_precricao_5 in c_precricao_5(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_precricao_5.dt_prescricao,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_precricao_5.ds_procedimento|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(5,get_icon_path(592, null),967928,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 988845);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_it_susp_sol_6
		if (r_profile_icons.cd_icone_panorama = 6) then
			begin
				ds_alerta_w:= null;
				for r_c_prescricao_6 in c_prescricao_6(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_prescricao_6.dt_suspensao,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:= 	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_prescricao_6.ds_item|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(6,get_icon_path(416, null),988848,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 1204684);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_teste_bac_8
		if (r_profile_icons.cd_icone_panorama = 8) then
			begin
				ds_alerta_w:= null;

        select max(Obter_se_paciente_MR(nr_atendimento_w))
        into STRICT ie_pac_mr_w
;

        select max(obter_se_pac_isolamento(nr_atendimento_w))
        into STRICT ie_pac_isol_w
;

				if	(ie_pac_mr_w = 'S' AND ie_pac_isol_w = 'N') or
					(ie_pac_mr_w = 'N' AND ie_pac_isol_w = 'S')then

					if (ie_pac_mr_w = 'S') then
						ds_alerta_w := '795077';
					else
						ds_alerta_w := '795078';
					end if;
				end if;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(8,get_icon_path(712, null),967496,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 988847);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_protocolo_9
		if (r_profile_icons.cd_icone_panorama = 9 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ie_alerta_w := 'N';
				ds_alerta_w := '795062';

				select	coalesce(max(IE_PROTOCOLO_ASSISTENCIAL),'N')
				  into STRICT 	ie_alerta_w
				  from	triagem_pronto_atend
				 where	nr_atendimento = nr_atendimento_w
				   and 	cd_pessoa_fisica = cd_pessoa_fisica_w
				;

				if (ie_alerta_w = 'S') then
					CALL search_panorama_content.insert_icons_data(9,get_icon_path(80, null),967568,r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,4000),r_profile_icons.nr_seq_prioridade, 'F', 966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;

        --ocor_exame_lab_res_10
    	if (r_profile_icons.cd_icone_panorama = 10 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				icon_result_exam_w := 'assets/icons/status-and-feedback/microscope.svg';
				nr_min_exibir_result_w:=120;
				nr_qtd_results_w:=0;

                 FOR cr_result IN c_laboratorio_resultado(nr_atendimento_w) LOOP
                    ds_dt_result_exam_w := TO_CHAR(cr_result.dt_resultado, 'DD/MM/YYYY HH24:MI');
                    nr_min_result_exam_w :=TRUNC((EXTRACT(DAY FROM (CURRENT_TIMESTAMP - cr_result.dt_resultado)) * 24 * 60 * 60
                                                  +EXTRACT(HOUR FROM (CURRENT_TIMESTAMP - cr_result.dt_resultado)) * 60 
                                                  +EXTRACT(MINUTE FROM (CURRENT_TIMESTAMP - cr_result.dt_resultado))),0);

                    ds_result_exam_w := ds_dt_result_exam_w || ' - '|| substr(cr_result.nm_exame,1,255);

                    IF (cr_result.qt_resultado IS NOT NULL AND cr_result.qt_resultado::text <> '') THEN
                        ds_result_exam_w :=ds_result_exam_w||' - '|| cr_result.qt_resultado;
                    END IF;

                    IF (cr_result.ds_unidade_medida IS NOT NULL AND cr_result.ds_unidade_medida::text <> '') THEN
                        ds_result_exam_w :=ds_result_exam_w||' '|| cr_result.ds_unidade_medida;
                    END IF;

                    IF (cr_result.ds_resultado IS NOT NULL AND cr_result.ds_resultado::text <> '') AND coalesce(cr_result.qt_resultado::text, '') = '' THEN
                        ds_result_exam_w :=ds_result_exam_w||' - '|| cr_result.ds_resultado;
                    END IF;

                    IF (cr_result.ds_flag IS NOT NULL AND cr_result.ds_flag::text <> '') OR (cr_result.ie_tipo_valor IS NOT NULL AND cr_result.ie_tipo_valor::text <> '') THEN

						begin
						exec_w := 'CALL CLINICAL_PANORAMA_MD_PCK.GET_ICON_RESULT_EXAM(:1,:2,:3) INTO :result';
						EXECUTE EXEC_W USING  IN  cr_result.ds_flag,
														IN  cr_result.ie_tipo_valor,
														IN  nr_min_exibir_result_w,
														OUT icon_result_exam_w;

						exception
						when others then
						icon_result_exam_w := icon_result_exam_w;
						end;

                        IF cr_result.ds_flag in ('LL','HH') OR cr_result.ie_tipo_valor = 2 THEN
                            nr_min_exibir_result_w := 0;
                        END IF;
                        IF (cr_result.ds_flag in ('L','H') OR cr_result.ie_tipo_valor = 1) AND nr_min_exibir_result_w <> 0 THEN
                            nr_min_exibir_result_w := 60;
                        END IF;
                        IF (cr_result.ds_flag IS NOT NULL AND cr_result.ds_flag::text <> '') THEN
                            ds_result_exam_w := ds_result_exam_w||' - '||cr_result.ds_flag;
                        END IF;

                    END IF;

                    IF nr_min_result_exam_w < nr_min_exibir_result_w or nr_min_exibir_result_w=0 THEN
                        nr_qtd_results_w := nr_qtd_results_w + 1;

                        IF nr_qtd_results_w > 10 THEN
                          ds_result_exam_w:='...' || wheb_mensagem_pck.get_texto(1154693);
                        END IF;

                        ds_result_exam_div_w:=substr(ds_result_exam_div_w || '<div>' || ds_result_exam_w ||'</div><br>',1,4000);
                        exit when nr_qtd_results_w > 10;
                    END IF;

                END LOOP;

                IF (ds_result_exam_div_w IS NOT NULL AND ds_result_exam_div_w::text <> '') THEN
                    CALL search_panorama_content.insert_icons_data(10,icon_result_exam_w,1153480,r_profile_icons.ds_icone_instituicao,substr(ds_result_exam_div_w,1,4000),r_profile_icons.nr_seq_prioridade, 'MW', 966278);
                    RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
                    PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
                    ds_result_exam_div_w := null;
                END IF;

			end;
		end if;

		--ocor_res_critico_11
		if (r_profile_icons.cd_icone_panorama = 11) then
			begin
				ds_alerta_w:= null;
				begin
				obter_param_usuario(281, 176, null/*cd_perfil_p*/
, '',wheb_usuario_pck.get_cd_estabelecimento, ie_visualizacao_icon_w);
				exception
				when others then
					ie_visualizacao_icon_w := 'L';
				end;

				for r_c_exame_11 in c_exame_11(nr_atendimento_w, ie_visualizacao_icon_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_exame_11.dt_resultado,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:= 	substr(ds_alerta_w || r_c_exame_11.nr_prescricao || ' - ' || dt_alerta_w ||' - ' ||
											r_c_exame_11.ds_exame || ' - ' || trim(both r_c_exame_11.ds_resultado) || ' - ' || r_c_exame_11.nm_medico || '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(11,get_icon_path(589, null),967511,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_it_susp_med_13
		if (r_profile_icons.cd_icone_panorama = 13) then
			begin
				ds_alerta_w:= null;
				for r_c_prescricao_13 in c_prescricao_13(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_prescricao_13.dt_suspensao,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:= 	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_prescricao_13.ds_item|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(13,get_icon_path(416, null),967649,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 1204684);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_it_n_conf_enf_14
		if (r_profile_icons.cd_icone_panorama = 14 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;

				for	r_c_prescricao_14_a in c_prescricao_14_a(nr_atendimento_w) loop
					ds_alerta_w	:=	substr(ds_alerta_w || r_c_prescricao_14_a.nr_prescricao || ' - ' || r_c_prescricao_14_a.ds_item || '<br>',1,4000);
				end loop;
				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					  CALL search_panorama_content.insert_icons_data(14,get_icon_path(null, 853),967890,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 1043295);
					  RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					  PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;

				ds_alerta_w := null;

				for	r_c_prescricao_14_b in c_prescricao_14_b(nr_atendimento_w) loop
					ds_alerta_w	:=	substr(ds_alerta_w || r_c_prescricao_14_b.nr_prescricao || ' - ' || r_c_prescricao_14_b.ds_item || '<br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					  CALL search_panorama_content.insert_icons_data(14,get_icon_path(592, null),967890,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 1043295);
					  RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					  PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_it_n_conf_farm_15
		if (r_profile_icons.cd_icone_panorama = 15 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				for	r_c_prescricao_15 in c_prescricao_15(nr_atendimento_w) loop
					ds_alerta_w	:=	substr(ds_alerta_w || r_c_prescricao_15.nr_prescricao || ' - ' || r_c_prescricao_15.ds_item || '<br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					 CALL search_panorama_content.insert_icons_data(15,get_icon_path(591, null),967860,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 967860);
					 RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					 PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_bacteria_conf_16
		if (r_profile_icons.cd_icone_panorama = 16 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w	:= null;

        select obter_se_paciente_mr(nr_atendimento_w)
        into STRICT ie_pac_mr_w
;

        select obter_se_pac_isolamento(nr_atendimento_w)
        into STRICT ie_pac_isol_w
;

				if (ie_pac_mr_w = 'S' and ie_pac_isol_w = 'S') then

            select substr((select obter_desc_MR(nr_atendimento_w) )
              || ' - ' || 
              (select obter_desc_precaucao_atend(nr_atendimento_w, 'P') ), 1, 4000)
            into STRICT ds_alerta_w
;

						CALL search_panorama_content.insert_icons_data(16,get_icon_path(711, null),967929,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', 988847);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);

				end if;
			end;
		end if;
		--ocor_transf_solic_18
		if (r_profile_icons.cd_icone_panorama = 18 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				select	max(dt_solicitacao),
						max(ie_status),
						max(dt_prevista),
						max((select obter_desc_tipo_acomodacao(cd_tipo_acomod_desej) )) ds_tipo_acomodacao,
						max((select obter_ds_descricao_setor(cd_setor_desejado) )) ds_setor_desejado,
						max(cd_unidade_basica||' '||cd_unidade_compl)
				into STRICT	dt_solicitacao_w,
						ds_status_w,
						dt_prevista_w,
						ds_tipo_acomodacao_w,
						ds_setor_desejado_w,
						cd_unidade_desejada_w
				from	gestao_vaga
				where	ie_status not in ('F','R','C','D','N','E','T')
				and (nr_atendimento = nr_atendimento_w or cd_pessoa_fisica = cd_pessoa_fisica_w);

				if (dt_solicitacao_w IS NOT NULL AND dt_solicitacao_w::text <> '') then
					if (dt_prevista_w IS NOT NULL AND dt_prevista_w::text <> '') then
						dt_alerta_w := '<div>' || to_char(dt_prevista_w,'dd/mm/yyyy hh24:mi:ss') || '</div>';
					end if;

					dt_solicit_w := '<div>' || to_char(dt_solicitacao_w,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w  := substr(dt_solicit_w||' '|| 'D_1408'||'S_' || ds_status_w ||'</div><br>'||dt_alerta_w|| ' ',1,4000);

					if (ds_tipo_acomodacao_w IS NOT NULL AND ds_tipo_acomodacao_w::text <> '') then
            select substr(ds_alerta_w || (select obter_desc_expressao(299379) ) ||': '||ds_tipo_acomodacao_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
					if (ds_setor_desejado_w IS NOT NULL AND ds_setor_desejado_w::text <> '') then
            select substr(ds_alerta_w || '<br>'|| (select obter_desc_expressao(298359) ) ||': '||ds_setor_desejado_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
					if ((trim(both cd_unidade_desejada_w) IS NOT NULL AND (trim(both cd_unidade_desejada_w))::text <> '')) then
            select substr(ds_alerta_w || '<br>'|| (select obter_desc_expressao(300760) ) ||': '||cd_unidade_desejada_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
				end if;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(18,get_icon_path(606, null),967418,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_leito_reserv_19
		if (r_profile_icons.cd_icone_panorama = 19 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				select 	max(dt_solicitacao),
						max(ie_status),
						max(dt_prevista),
						max((select obter_desc_tipo_acomodacao(cd_tipo_acomod_desej) )) ds_tipo_acomodacao,
						max((select obter_ds_descricao_setor(cd_setor_desejado) )) ds_setor_desejado,
						max(cd_unidade_basica||' '||cd_unidade_compl)
				into STRICT	dt_solicitacao_w,
						ds_status_w,
						dt_prevista_w,
						ds_tipo_acomodacao_w,
						ds_setor_desejado_w,
						cd_unidade_desejada_w
				from	gestao_vaga
				where	ie_status = 'R'
				and		nr_atendimento = nr_atendimento_w;

				if (dt_solicitacao_w IS NOT NULL AND dt_solicitacao_w::text <> '') then
					if (dt_prevista_w IS NOT NULL AND dt_prevista_w::text <> '') then
						dt_alerta_w := '<div>' || to_char(dt_prevista_w,'dd/mm/yyyy hh24:mi:ss') || '</div>';
					end if;

					dt_solicit_w := '<div>' || to_char(dt_solicitacao_w,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w  := substr(dt_solicit_w||' ,'||'D_1408'||'S_' || ds_status_w || '_E' ||'</div><br>'||dt_alerta_w || ' ',1,4000);

					if (ds_tipo_acomodacao_w IS NOT NULL AND ds_tipo_acomodacao_w::text <> '') then
            select substr(ds_alerta_w || (select obter_desc_expressao(299379) ) ||': '||ds_tipo_acomodacao_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
					if (ds_setor_desejado_w IS NOT NULL AND ds_setor_desejado_w::text <> '') then
            select substr(ds_alerta_w || '<br>'|| (select obter_desc_expressao(298359) ) ||': '||ds_setor_desejado_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
					if ((trim(both cd_unidade_desejada_w) IS NOT NULL AND (trim(both cd_unidade_desejada_w))::text <> '')) then
            select substr(ds_alerta_w || '<br>'|| (select obter_desc_expressao(300760) ) ||': '||cd_unidade_desejada_w,1,4000)
            into STRICT ds_alerta_w
;
					end if;
				end if;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(19,get_icon_path(758, null),967643,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F', null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;

		--TASK LIST - PENDING
		if (r_profile_icons.cd_icone_panorama = 20 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				SELECT  count(*)
				INTO STRICT    w_achou_atrasado
				FROM    w_pan_ocorrencia
				WHERE   nr_atendimento = nr_atendimento_w
				AND     ie_icone = 21;

				if (w_achou_atrasado = 0) then

					for r_alert in c_task_list_alerts(nr_atendimento_w, 'T') loop
						if (r_alert.ds_alerta IS NOT NULL AND r_alert.ds_alerta::text <> '') then
							dt_alerta_w := '<div>' || to_char(r_alert.dt_alerta,'dd/mm/yyyy hh24:mi:ss');
							ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_alert.ds_alerta|| '</div><br>',1,4000);
						end if;
					end loop;

					if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
						CALL search_panorama_content.insert_icons_data(20,get_icon_path(null, 130),297726,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'PT', 1216328);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
					end if;

				end if;
			end;
		end if;

		-- TASK LIST - OVERDUE
		if (r_profile_icons.cd_icone_panorama = 21 and (cd_pessoa_fisica_w IS NOT NULL AND cd_pessoa_fisica_w::text <> '')) then
			begin
				ds_alerta_w:= null;

				for r_alert in c_task_list_alerts(nr_atendimento_w, 'A') loop
					if (r_alert.ds_alerta IS NOT NULL AND r_alert.ds_alerta::text <> '') then
						dt_alerta_w := '<div>' || to_char(r_alert.dt_alerta,'dd/mm/yyyy hh24:mi:ss');
						ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_alert.ds_alerta|| '</div><br>',1,4000);
					end if;
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(21,get_icon_path(513, null),319221,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'DT',1216328);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;

		--ocor_pendencias_50
		if (r_profile_icons.cd_icone_panorama = 50 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				select 	max('#@1070675#@')
				into STRICT	ds_alerta_w
				from   	episodio_pac_document
				where  	nr_seq_episodio = (SELECT obter_episodio_atendimento(nr_atendimento_w) );

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(50,get_icon_path(726, null),1070654,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F',1015705);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_pendencias_51
		if (r_profile_icons.cd_icone_panorama = 51 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				select 	max('#@1070682#@')
				into STRICT	ds_alerta_w
				from   	episodio_pac_document
				where  	nr_seq_episodio = (SELECT obter_episodio_atendimento(nr_atendimento_w) );

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(51,get_icon_path(231, null),1070654,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F',1015705);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_pendencias_52
		if (r_profile_icons.cd_icone_panorama = 52 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				select 	max('#@1070684#@')
				into STRICT	ds_alerta_w
				from   	episodio_pac_document
				where  	nr_seq_episodio = (SELECT obter_episodio_atendimento(nr_atendimento_w) );

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(52,get_icon_path(311, null),1070654,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade, 'F',1015705);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;
		--ocor_pac_away_53
		if (r_profile_icons.cd_icone_panorama = 53 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;

        select OBTER_SE_PACIENTE_AWAY(nr_atendimento_w)
        into STRICT ie_pac_away_w
;

				if	ie_pac_away_w = 'S'  then

          select OBTER_PACIENTE_AWAY_DESC(nr_atendimento_w)
          into STRICT ds_pac_away_w
;

					CALL search_panorama_content.insert_icons_data(53,get_icon_path(610, null),1076995,r_profile_icons.ds_icone_instituicao,ds_pac_away_w,r_profile_icons.nr_seq_prioridade, 'F');
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;

		--surgery_status_54
		if (r_profile_icons.cd_icone_panorama = 54 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
			ds_alerta_w:= null;

			select	max((select obter_status_paciente_painel(	a.dt_analise,
									a.dt_chegada,
									a.dt_paciente_aguardo,
									a.dt_alta_cc,
									a.dt_chamada_pre_inducao,
									a.dt_sala_recuperacao,
									a.dt_chegada_fim,
									a.dt_saida_paciente_cc,
									a.ie_status_agenda) ))
			into STRICT	ie_surgery_status_w
			from	agenda_paciente a,
				cirurgia b
			where	a.nr_cirurgia	= b.nr_cirurgia
			and	b.nr_atendimento = nr_atendimento_w
			and	b.dt_inicio_prevista between trunc(clock_timestamp() - interval '1 days') and fim_dia(clock_timestamp());

			if	(ie_surgery_status_w IS NOT NULL AND ie_surgery_status_w::text <> '')  then
				CASE ie_surgery_status_w
				WHEN 'AN' THEN nr_seq_legenda_w := 1274;
				WHEN 'CH' THEN nr_seq_legenda_w := 1275;
				WHEN 'PA' THEN nr_seq_legenda_w := 1279;
				WHEN 'AL' THEN nr_seq_legenda_w := 1280;
				WHEN 'PI' THEN nr_seq_legenda_w := 1281;
				WHEN 'SR' THEN nr_seq_legenda_w := 1282;
				WHEN 'CF' THEN nr_seq_legenda_w := 1283;
				WHEN 'SC' THEN nr_seq_legenda_w := 1284;
				ELSE nr_seq_legenda_w := 0;
				END CASE;

				if (coalesce(nr_seq_legenda_w, 0) > 0) then
					select 	max((select obter_desc_expressao(a.cd_exp_legenda) )),
						max('assets/' || b.ds_dir_img_server)
					into STRICT	ds_surgery_status_w,
						ds_img_address_w
					from 	tasy_padrao_imagem a,
						tasy_padrao_imagem_html b
					where 	b.nr_sequencia = a.nr_seq_img_html
					and 	a.nr_seq_legenda = 1716
					and	a.nr_sequencia = nr_seq_legenda_w;

					CALL search_panorama_content.insert_icons_data(54,ds_img_address_w,1097046,r_profile_icons.ds_icone_instituicao,ds_surgery_status_w,r_profile_icons.nr_seq_prioridade, 'F');
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;
			exception
        when others then
        null;
			end;
		end if;

		--ocor_exame_nonlab_57
		if (r_profile_icons.cd_icone_panorama = 57 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				for	r_c_prescricao_57 in c_prescricao_57(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_c_prescricao_57.dt_prescricao,'dd/mm/yyyy hh24:mi:ss');
					ds_alerta_w	:=	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_c_prescricao_57.ds_procedimento|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(57,get_icon_path(null, 756),1127818,r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,4000),r_profile_icons.nr_seq_prioridade, 'F',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end;
		end if;

       --body_system_80
        if (r_profile_icons.cd_icone_panorama = 80 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
            json_html_organ_item_w:=PHILIPS_JSON();
            json_html_organ_list_w:=PHILIPS_JSON_LIST();

            select obter_setor_atendimento(nr_atendimento_w)
            into STRICT cd_setor_atendimento_w
;

            icons_organ_w('CAR'):= src_organ_icons_w('assets/icons/status-and-feedback/heart.svg','assets/icons/status-and-feedback/heart-yellow.svg','assets/icons/status-and-feedback/heart-red.svg','1140660'); -- icone nao cadastrado
            icons_organ_w('RES'):= src_organ_icons_w('assets/icons/status-and-feedback/lungs.svg','assets/icons/status-and-feedback/lungs-yellow.svg','assets/icons/status-and-feedback/lungs-red.svg','1140661'); -- icone nao cadastrado
            icons_organ_w('HEM'):= src_organ_icons_w('assets/icons/status-and-feedback/transfusion.svg','assets/icons/status-and-feedback/transfusion-yellow.svg','assets/icons/status-and-feedback/transfusion-red.svg','1140754');  -- icone nao cadastrado
            icons_organ_w('REN'):= src_organ_icons_w('assets/icons/status-and-feedback/kidneys.svg','assets/icons/status-and-feedback/kidneys-yellow.svg','assets/icons/status-and-feedback/kidneys-red.svg','1140662'); -- icone nao cadastrado
            icons_organ_w('DOE'):= src_organ_icons_w('assets/icons/status-and-feedback/infectology.svg','assets/icons/status-and-feedback/infectology-yellow.svg','assets/icons/status-and-feedback/infectology-red.svg','1140666'); -- icone nao cadastrado
            icons_organ_w('NEU'):= src_organ_icons_w('assets/icons/status-and-feedback/brain.svg','assets/icons/status-and-feedback/brain-yellow.svg','assets/icons/status-and-feedback/brain-red.svg','1140664'); -- icone nao cadastrado
            FOR reg_cursor1 IN c_algoritmo_icon(cd_setor_atendimento_w) LOOP

                IF reg_cursor1.ie_escala_acuidade = 'AA' THEN
                    FOR reg_cursor2 IN c_body_system_AA(nr_atendimento_w) LOOP
                        icone_organ_w:=NULL;
                        pontuacao_organ_w:=NULL;
                        cd_exp_body_system_w:=icons_organ_w(reg_cursor2.ie_sistema_organismo)(4);

                        CASE
                        WHEN coalesce(reg_cursor2.nr_pontuacao::text, '') = '' OR reg_cursor2.nr_pontuacao = 0 THEN 
                            pontuacao_organ_w:='N';
                            icone_organ_w:= icons_organ_w(reg_cursor2.ie_sistema_organismo)(1);
                        WHEN reg_cursor2.nr_pontuacao = 1 OR reg_cursor2.nr_pontuacao = 2  THEN
                            pontuacao_organ_w:='M';
                            icone_organ_w:= icons_organ_w(reg_cursor2.ie_sistema_organismo)(2);
                            IF (coalesce(icone_body_system_w::text, '') = '') THEN
                            icone_body_system_w:='assets/icons/status-and-feedback/human-body-minor-warning.svg'; -- icone nao cadastrado
                            END IF;
                        WHEN reg_cursor2.nr_pontuacao > 2 THEN
                            pontuacao_organ_w:='H';
                            icone_organ_w:= icons_organ_w(reg_cursor2.ie_sistema_organismo)(3);
                            icone_body_system_w:='assets/icons/status-and-feedback/human-body-major-warning.svg'; -- icone nao cadastrado
                        ELSE NULL;
                        END CASE;
                        nr_pontuacao_body_sys_w :=TO_CHAR(reg_cursor2.nr_pontuacao);
                        IF (reg_cursor2.nr_peso IS NOT NULL AND reg_cursor2.nr_peso::text <> '') THEN
                            nr_pontuacao_body_sys_w :=TO_CHAR(reg_cursor2.nr_pontuacao * reg_cursor2.nr_peso);
                        END IF;
                        IF coalesce(reg_cursor2.nr_pontuacao::text, '') = '' THEN
                            nr_pontuacao_body_sys_w:='--';
                            pontuacao_organ_w:='N';
                        END IF;
                        IF (icone_organ_w IS NOT NULL AND icone_organ_w::text <> '')THEN
                            json_html_organ_item_w.PUT('ICONE',icone_organ_w);
                            json_html_organ_item_w.PUT('TOTAL',nr_pontuacao_body_sys_w);
                            json_html_organ_item_w.PUT('SCORE',pontuacao_organ_w);
                            json_html_organ_item_w.PUT('CD_EXPRESSAO',cd_exp_body_system_w);
                            json_html_organ_list_w.APPEND(json_html_organ_item_w.to_json_value());
                        END IF;
                    END LOOP;

                END IF;
            END LOOP;
            IF (icone_body_system_w IS NOT NULL AND icone_body_system_w::text <> '') THEN
                CALL search_panorama_content.insert_icons_data(80,icone_body_system_w,1140721,r_profile_icons.ds_icone_instituicao,json_html_organ_list_w.to_char(),r_profile_icons.nr_seq_prioridade, 'F', 1027448);
                RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
            END IF;
        end if;

		--devices
		if (r_profile_icons.cd_icone_panorama = 62 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			ds_alerta_w:= null;
			ie_icon_devide_prior_w := 0;
			obter_param_usuario(1113, 415, wheb_usuario_pck.get_cd_perfil, wheb_usuario_pck.get_nm_usuario, wheb_usuario_pck.get_cd_estabelecimento, ie_time_device_alert_w);
				for r_c_devices in c_devices(nr_atendimento_w) loop
					if ((r_c_devices.dt_alta IS NOT NULL AND r_c_devices.dt_alta::text <> '') and r_c_devices.ie_disp_alta = 'S' and ie_icon_devide_prior_w < 1) then
						ie_icon_devide_prior_w := 1;
					elsif (r_c_devices.ie_sucesso = 'N' and ie_icon_devide_prior_w < 2) then
						ie_icon_devide_prior_w := 2;
					elsif (coalesce(r_c_devices.dt_retirada::text, '') = '' and coalesce(r_c_devices.dt_alta::text, '') = '' and

					(coalesce(r_c_devices.dt_retirada_prev, clock_timestamp() + interval '1 days') between clock_timestamp() and clock_timestamp() + (1/1440*+ ie_time_device_alert_w) )


					and ie_icon_devide_prior_w < 3) then
						ie_icon_devide_prior_w := 3;
					elsif (coalesce(r_c_devices.dt_retirada::text, '') = '' and coalesce(r_c_devices.dt_alta::text, '') = '' and coalesce(r_c_devices.dt_retirada_prev, clock_timestamp() + interval '1 days') < clock_timestamp() and ie_icon_devide_prior_w < 4) then
						ie_icon_devide_prior_w := 4;
					end if;

					select CASE WHEN ie_icon_devide_prior_w=1 THEN 298 WHEN ie_icon_devide_prior_w=2 THEN 299 WHEN ie_icon_devide_prior_w=3 THEN 301 WHEN ie_icon_devide_prior_w=4 THEN 302  ELSE 303 END , CASE WHEN ie_icon_devide_prior_w=1 THEN 1141792 WHEN ie_icon_devide_prior_w=2 THEN 1141793 WHEN ie_icon_devide_prior_w=3 THEN 1142212 WHEN ie_icon_devide_prior_w=4 THEN 1142211  ELSE 1141795 END
					 into STRICT ie_icon_devide_w, ie_device_label_w
					;

				 	dt_alerta_w := to_char(r_c_devices.dt_instalacao, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario)));
					ds_alerta_w	:= 	substr(ds_alerta_w ||'<div>' || r_c_devices.ds_dispositivo ||' - '||dt_alerta_w ||  '</div><br>',1,4000);
				end loop;
				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(62,get_icon_path(ie_icon_devide_w,null),ie_device_label_w,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade,'F',866783);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
		end if;

        --follow_up_icon
        if ((nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '') and ie_follow_up) then
         for r_follow_up in c_follow_up(nr_atendimento_w) loop
           if (r_follow_up.nr_sequencia IS NOT NULL AND r_follow_up.nr_sequencia::text <> '') then
              CALL search_panorama_content.insert_icons_data(null,'assets/icons/status-and-feedback/star.svg',1134749,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,2, 'CR'); -- icone nao cadastrado
               RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
            end if;
          end loop;
          ie_follow_up := FALSE;
        end if;

       --intervention_pen
       if ( r_profile_icons.cd_icone_panorama = 92 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
            ds_intervention_pen_w := null;
            for r_interv in c_intervention_pen(nr_atendimento_w) loop
                ds_intervention_pen_w := ds_intervention_pen_w || to_char(r_interv.dt_atualizacao,'dd/mm/yyyy hh24:mi:ss')||' - '|| r_interv.ds_template || '<br>';
            end loop;

            if (ds_intervention_pen_w IS NOT NULL AND ds_intervention_pen_w::text <> '') then
               CALL search_panorama_content.insert_icons_data(92,'assets/icons/status-and-feedback/report-clock.svg',1163799,get_icon_profile_rule(0,nr_regra_icon_w,'D'),ds_intervention_pen_w,1, 'F', 966278);
               RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
            end if;
       end if;

		--Comments
		if (r_profile_icons.cd_icone_panorama = 93 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			begin
				ds_alerta_w:= null;
				for r_comment in c_comment(nr_atendimento_w) loop
					dt_alerta_w := '<div>' || to_char(r_comment.dt_atualizacao,'dd/mm/yyyy');
					ds_alerta_w	:= 	substr(ds_alerta_w || dt_alerta_w || ' - ' || r_comment.ds_comentario|| '</div><br>',1,4000);
				end loop;

				if (ds_alerta_w IS NOT NULL AND ds_alerta_w::text <> '') then
					CALL search_panorama_content.insert_icons_data(93, get_icon_path(681, null),1166245, r_profile_icons.ds_icone_instituicao,substr(ds_alerta_w,1,255), r_profile_icons.nr_seq_prioridade, 'CM', 1180635);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
				ds_alerta_w:= null;
			end;
    end if;

		--New Clinical Note
		if (r_profile_icons.cd_icone_panorama = 91 and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
			 nr_notas_nao_visualizadas_w :=  obter_nota_clinica_visualizada(	 nr_atendimento_w ,
													 wheb_usuario_pck.get_nm_usuario );
			 if nr_notas_nao_visualizadas_w > 0  then
				CALL search_panorama_content.insert_icons_data(91,get_icon_path(682,null), ie_device_label_w,r_profile_icons.ds_icone_instituicao,ds_alerta_w,r_profile_icons.nr_seq_prioridade,'F',966278);
				RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
			 end if;
		end if;
		--
		--watchlist
		if (ie_watchlist and (nr_atendimento_w IS NOT NULL AND nr_atendimento_w::text <> '')) then
		  for r_watchlist in c_watchlist(cd_pessoa_fisica_w) loop
			if (r_watchlist.cd_pessoa_fisica IS NOT NULL AND r_watchlist.cd_pessoa_fisica::text <> '') then
			  CALL search_panorama_content.insert_icons_data(null,'assets/icons/status-and-feedback/eye.svg',1164274,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1,'CR'); -- icone nao cadastrado
			  RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			end if;
		  end loop;
		  ie_watchlist := FALSE;
		end if;
	end loop;

  select count(*) into STRICT qtd_chamadas_v from unidade_atendimento ua
  where nr_seq_interno = nr_seq_interno_p
  and (ua.nr_atendimento IS NOT NULL AND ua.nr_atendimento::text <> '')
  and exists (
    SELECT 1 from video_server_notification vsn
                   where vsn.cd_setor_atendimento = ua.cd_setor_atendimento 
                   and vsn.cd_unidade_basica = ua.cd_unidade_basica 
                   and vsn.cd_unidade_compl = ua.cd_unidade_compl 
                   and coalesce(vsn.dt_video_assessment::text, '') = '' 
                   and (clock_timestamp() - cast(vsn.dt_notification as timestamp)) <= 1/3);

  if (qtd_chamadas_v > 0) then
    CALL search_panorama_content.insert_icons_data(9999,'assets/icons/status-and-feedback/phone-call-missed.svg',1038978,wheb_mensagem_pck.get_texto(1147697),'',2,'F');
    RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
    PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
  end if;

	for r_patient in c_patient loop

    select '<div>'|| (select wheb_mensagem_pck.get_texto(1141805) )
      || ' : ' || to_char(r_patient.dt_previsto_alta, 
      (select pkg_date_formaters.localize_mask('timestamp', (select pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario) )) )) 
      || '</div>'
    into STRICT ds_descrtion_icon_w
;

		if (nr_encounter_status_w > 0) then
			CASE nr_encounter_status_w
			WHEN 329 THEN search_panorama_content.insert_icons_data(null,get_icon_path(null, 32),1028427,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F'); --in-discharge-process
			WHEN 278 THEN search_panorama_content.insert_icons_data(60,get_icon_path(392, null),1028428,get_icon_profile_rule(0,nr_regra_icon_w,'D'),ds_descrtion_icon_w,1, 'F', 966278);
			WHEN 949 THEN search_panorama_content.insert_icons_data(null,get_icon_path(393, null),1028429,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 904 THEN search_panorama_content.insert_icons_data(null,get_icon_path(400, null),1028430,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 201 THEN search_panorama_content.insert_icons_data(null,get_icon_path(216, null),1028431,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 199 THEN search_panorama_content.insert_icons_data(null,get_icon_path(384, null),967930,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 446 THEN search_panorama_content.insert_icons_data(null,get_icon_path(391, null),1028432,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 188 THEN search_panorama_content.insert_icons_data(null,get_icon_path(188, null),1030008,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'F');
			WHEN 279 THEN search_panorama_content.insert_icons_data(60,'assets/icons/status-and-feedback/arrow-up-orange-calendar.svg',1142209,get_icon_profile_rule(0,nr_regra_icon_w,'D'),ds_descrtion_icon_w,1, 'F', 966278);
			WHEN 280 THEN search_panorama_content.insert_icons_data(60,'assets/icons/status-and-feedback/arrow-up-red-calendar.svg',1142210,get_icon_profile_rule(0,nr_regra_icon_w,'D'),ds_descrtion_icon_w,1, 'F', 966278);
			ELSE nr_encounter_status_w := 0;
			END CASE;
			if (nr_encounter_status_w > 0) then
				RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
			end if;
		end if;

		if (r_patient.ie_status_unidade IS NOT NULL AND r_patient.ie_status_unidade::text <> '') then
			CASE r_patient.ie_status_unidade
			WHEN 'A' THEN search_panorama_content.insert_icons_data(null,null,974331,get_icon_profile_rule(0,nr_regra_icon_w,'D'),974331,1, 'H');
			WHEN 'C' THEN search_panorama_content.insert_icons_data(null,get_icon_path(388, null),974370,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'G' THEN search_panorama_content.insert_icons_data(null,get_icon_path(395, null),974405,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'E' THEN search_panorama_content.insert_icons_data(null,get_icon_path(390, null),974413,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'H' THEN search_panorama_content.insert_icons_data(null,get_icon_path(394, null),974414,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'I' THEN search_panorama_content.insert_icons_data(null,get_icon_path(375, null),974421,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'L' THEN search_panorama_content.insert_icons_data(null,null,988594,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'M' THEN search_panorama_content.insert_icons_data(null,get_icon_path(604, null),974474,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'P' THEN search_panorama_content.insert_icons_data(null,null,974492,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'R' THEN search_panorama_content.insert_icons_data(null,get_icon_path(819, null),974500,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'S' THEN search_panorama_content.insert_icons_data(null,get_icon_path(399, null),974531,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'O' THEN search_panorama_content.insert_icons_data(null,get_icon_path(402, null),974468,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'U' THEN search_panorama_content.insert_icons_data(null,get_icon_path(398, null),1031108,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			WHEN 'D' THEN search_panorama_content.insert_icons_data(null,get_icon_path(401, null),1031107,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			ELSE NULL;
			END CASE;
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		if (r_patient.ie_leito_adaptado = 'S') then
			CALL search_panorama_content.insert_icons_data(null,get_icon_path(403, null),966048,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		if (r_patient.ie_temporario = 'S') then
			CALL search_panorama_content.insert_icons_data(null,get_icon_path(623, null),966146,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		if (upper(r_patient.ie_new_patient) = 'S') then
			CALL search_panorama_content.insert_icons_data(null,'/assets/icons/patient-blue.svg',1132257,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,6, 'PB');
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		if (r_patient.ie_leito_retaguarda = 'S') then
			CALL search_panorama_content.insert_icons_data(null,get_icon_path(null, 305),966160,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		if (r_patient.ie_status_unidade <> 'P' and (r_patient.ie_sexo_paciente IS NOT NULL AND r_patient.ie_sexo_paciente::text <> '')) then
			if (upper(r_patient.ie_sexo_paciente) = 'M') then
				CALL search_panorama_content.insert_icons_data(null,get_icon_path(600, null),983334,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
				RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
			elsif (upper(r_patient.ie_sexo_paciente) = 'F') then
				CALL search_panorama_content.insert_icons_data(null,get_icon_path(601, null),983333,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,1, 'H');
				RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
			end if;
		end if;

		if (r_patient.cd_pessoa_paciente IS NOT NULL AND r_patient.cd_pessoa_paciente::text <> '') then
			select CASE WHEN r_patient.ie_sexo='M' THEN 565 WHEN r_patient.ie_sexo='F' THEN 566  ELSE 685 END  into STRICT ie_patient_gender;
			CALL search_panorama_content.insert_icons_data(0,get_icon_path(null, ie_patient_gender),r_patient.cd_exp_sexo,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,0,'U',null);
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

		--Content
		for r_profile_icons_pat in c_profile_icons_pat loop

			if (r_profile_icons_pat.cd_icone_panorama = 65) then
				if (substr(pan_obter_se_pac_alergia(r_patient.cd_pessoa_paciente),1,1) = 'S') then
					CALL search_panorama_content.insert_icons_data(65,get_icon_path(605, null),966277,r_profile_icons_pat.ds_icone_instituicao,substr(obter_descricao_alergias(r_patient.cd_pessoa_paciente),1,4000),r_profile_icons_pat.nr_seq_prioridade,'C',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				elsif (obter_se_nega_alergia(r_patient.cd_pessoa_paciente) = 'S') then
					CALL search_panorama_content.insert_icons_data(65,get_icon_path(840, null),1065028,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'C');
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 0) then --Vip not_found
				if (r_patient.ie_vip = 'S') then
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(665, null),null,r_profile_icons_pat.ds_icone_instituicao,r_patient.ds_vip,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 66) then
				if ((obter_classificacao_pf(r_patient.cd_pessoa_paciente) IS NOT NULL AND (obter_classificacao_pf(r_patient.cd_pessoa_paciente))::text <> '')) then
					CALL search_panorama_content.insert_icons_data(66,get_icon_path(626, null),null,r_profile_icons_pat.ds_icone_instituicao,substr(obter_desc_classif_paciente(r_patient.cd_pessoa_paciente,'D'),1,255),r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;


			if (r_profile_icons_pat.cd_icone_panorama = 2) then
				if (to_char(r_patient.dt_nascimento,'DDMM') = to_char(clock_timestamp(), 'DDMM')) then
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(615, null),r_patient.nr_seq_texto_nasc,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;


			if (r_profile_icons_pat.cd_icone_panorama = 67) then
				ie_risco_queda_w := obter_desc_escala_queda(r_patient.cd_setor_atendimento, r_patient.nr_atendimento, 'R');
				if (ie_risco_queda_w <> 'N') then
					select CASE WHEN ie_risco_queda_w='B' THEN 667 WHEN ie_risco_queda_w='M' THEN 699 WHEN ie_risco_queda_w='A' THEN 700  ELSE 667 END
					  into STRICT ie_fall_risk_w
					;

					CALL search_panorama_content.insert_icons_data(67,get_icon_path(null,ie_fall_risk_w),null,r_profile_icons_pat.ds_icone_instituicao,obter_desc_escala_queda(r_patient.cd_setor_atendimento, r_patient.nr_atendimento, 'D'),r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 25) then
				if (cpoe_obter_se_jejum(r_patient.nr_atendimento, r_patient.cd_pessoa_paciente) = 'S') then
					CALL search_panorama_content.insert_icons_data(25,get_icon_path(75,null),null,r_profile_icons_pat.ds_icone_instituicao,cpoe_obter_tipo_jejum(r_patient.nr_atendimento, r_patient.cd_pessoa_paciente),r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;
			if (r_profile_icons_pat.cd_icone_panorama = 55) then
				if (cpoe_obter_exame_nao_checado(r_patient.nr_atendimento, r_patient.cd_pessoa_paciente) = 'S') then
					CALL search_panorama_content.insert_icons_data(55,get_icon_path(240,null),1097560,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;
			if (r_profile_icons_pat.cd_icone_panorama = 64) then
				if (r_patient.ie_paciente_isolado = 'S') then
					select max(ds_tipo_isolamento_cih) into STRICT ds_isolation_w from pan_info_adicional_v where nr_atendimento = r_patient.nr_atendimento;
					CALL search_panorama_content.insert_icons_data(64,get_icon_path(189,null),1030648,r_profile_icons_pat.ds_icone_instituicao,ds_isolation_w,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;
			if (r_profile_icons_pat.cd_icone_panorama = 68) then
				if (r_patient.has_obito IS NOT NULL AND r_patient.has_obito::text <> '') then
					ds_descrtion_icon_w := obter_desc_expressao(605270, wheb_usuario_pck.get_nr_seq_idioma) ||': '||to_char(r_patient.has_obito, pkg_date_formaters.localize_mask('timestamp', pkg_date_formaters.getUserLanguageTag(wheb_usuario_pck.get_cd_estabelecimento, wheb_usuario_pck.get_nm_usuario)));
					CALL search_panorama_content.insert_icons_data(68,get_icon_path(60,null),1134466,r_profile_icons_pat.ds_icone_instituicao,ds_descrtion_icon_w,r_profile_icons_pat.nr_seq_prioridade,'C',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;


			if (r_profile_icons_pat.cd_icone_panorama = 69) then
				if (r_patient.status_camera > 0 and (r_patient.cd_pessoa_paciente IS NOT NULL AND r_patient.cd_pessoa_paciente::text <> '')) then
					case r_patient.status_camera
					when 1 then
						search_panorama_content.insert_icons_data(69,get_icon_path(846,null),1130975,wheb_mensagem_pck.get_texto(1130975),null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					when 2 then
						search_panorama_content.insert_icons_data(69,get_icon_path(848,null),1130976,wheb_mensagem_pck.get_texto(1130976),null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					when 3 then
						search_panorama_content.insert_icons_data(69,get_icon_path(849,null),1130979,wheb_mensagem_pck.get_texto(1130979),null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					when 4 then
						search_panorama_content.insert_icons_data(69,get_icon_path(847,null),1130977,wheb_mensagem_pck.get_texto(1130977),null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					else null;
          end case;
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 9) then
					select count(1)
					  into STRICT qt_protocolos_ativos_w
					  from gqa_protocolo_pac a
					 where (a.cd_pessoa_fisica = r_patient.cd_pessoa_paciente
						or (coalesce(r_patient.cd_pessoa_paciente::text, '') = '' and a.nr_atendimento = r_patient.nr_atendimento))
					   and a.ie_situacao = 'A'
					   and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
					   and coalesce(a.dt_termino::text, '') = ''
					   and coalesce(a.dt_inativacao::text, '') = ''
				  order by a.nr_sequencia asc;

				if (qt_protocolos_ativos_w > 0) then
					for r1 in (
						SELECT  a.nr_sequencia nr_seq_protocolo,
								a.ds_nome_protocolo ds_protocolo,
							   to_number((SELECT gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'SEQUENCIA') )) nr_seq_etapa,
							   (select gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'NOME') ) ds_etapa,
							   (select gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'ICONE') ) ds_icon,
							   (select gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'TAG') ) ds_tag,
							   (select gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'COR') ) ds_cor,
							   (select gqa_obter_protocolo_tag_atual(a.nr_sequencia, 'PATH') ) ds_icon_path,
							   (select gqa_obter_desc_prot_panorama(a.nr_sequencia) ) ds_description_html
						from gqa_protocolo_pac a
						where (a.nr_atendimento = r_patient.nr_atendimento or (coalesce(r_patient.nr_atendimento::text, '') = '' and a.cd_pessoa_fisica = r_patient.cd_pessoa_paciente))
						and a.ie_situacao = 'A'
						and (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
						and coalesce(a.dt_termino::text, '') = ''
						and coalesce(a.dt_inativacao::text, '') = ''
						order by a.nr_sequencia asc)
					loop
						CALL search_panorama_content.insert_icons_data(9,r1.ds_icon_path,null,r1.ds_icon,r1.ds_description_html,r_profile_icons_pat.nr_seq_prioridade,'C',null, r1.ds_tag, r1.ds_etapa, r1.ds_cor);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
					end loop;
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 61) then

				begin
				ie_has_ventilation := 'N';

				select respiracao, traqueo, integracao, interface, liberacao
				  into STRICT respiracao_w, traqueo_w, integracao_w, interface_w, liberacao_w
				from (
					SELECT amr.ie_respiracao respiracao, amr.ie_canula_traqueo traqueo, amr.ie_integracao integracao, amr.ie_disp_resp_esp  interface, amr.dt_liberacao      liberacao
					FROM atendimento_monit_resp amr
					 WHERE amr.ie_situacao = 'A'
					   AND amr.ie_respiracao <> 'ESPONT'
					   AND coalesce(amr.dt_inativacao::text, '') = ''
					   AND amr.NR_ATENDIMENTO = r_patient.nr_atendimento
					   AND amr.NR_SEQUENCIA IN ( SELECT coalesce(MAX(amrt.NR_SEQUENCIA),0)
								       FROM atendimento_monit_resp amrt
								      WHERE amrt.ie_situacao = 'A'
									AND coalesce(amrt.dt_inativacao::text, '') = ''
									AND amrt.NR_ATENDIMENTO = r_patient.nr_atendimento) ORDER BY 1) alias5 LIMIT 1;
				ie_has_ventilation := 'S';
				exception when no_data_found then
					ie_has_ventilation := 'N';
				end;

				if (ie_has_ventilation <> 'N' ) then
				  if (integracao_w = 'N' ) then -- Digitacao manual
				    if (respiracao_w = 'VMNI' and coalesce(traqueo_w::text, '') = '' and interface_w = 'F') then --Ventilacao nao invasiva, semm entubacao e Mascara total face
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-non-invasive.svg',1183411,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    elsif (respiracao_w = 'VMI' and (traqueo_w = 'COT' or traqueo_w = 'CN') and coalesce(interface_w::text, '') = '') then -- Ventilacao invasiva, Intubacao Orotraquial e sem interface
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-intubated.svg',1134002,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    elsif (respiracao_w = 'VMI' and traqueo_w = 'TP' and coalesce(interface_w::text, '') = '') then -- Ventilacao invasiva, Traquesostomia e sem interface
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-tracheostomy.svg',1134004,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    elsif (respiracao_w = 'VMI' and (traqueo_w = 'COT' or traqueo_w = 'CN') and interface_w = 'T') then -- Ventilacao invasiva, Intubacao Orotraquial e Tubo em T(Ayre)
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/device-intubated.svg',1183409,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    elsif (respiracao_w = 'VMI' and traqueo_w = 'TP' and interface_w = 'T') then -- Ventilacao invasiva, Traquesostomia e Tubo em T(Ayre)
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/device-tracheostomy.svg',1183410,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    else
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/cancel.svg',1134008,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    end if;
				  else
				    if (coalesce(liberacao_w::text, '') = '' ) then -- Interfaceado nao liberado
				      CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/device-minor-warning.svg',1183404,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
				      RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
				      PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				    else
				      if (respiracao_w = 'VMNI' and coalesce(traqueo_w::text, '') = '' and interface_w = 'F') then --Ventilacao nao invasiva, semm entubacao e Mascara total face
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-non-invasive-green.svg',1183411,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      elsif (respiracao_w = 'VMI' and (traqueo_w = 'COT' or traqueo_w = 'CN') and coalesce(interface_w::text, '') = '') then -- Ventilacao invasiva, Intubacao Orotraquial e sem interface
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-intubated-green.svg',1134002,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      elsif (respiracao_w = 'VMI' and traqueo_w = 'TP' and coalesce(interface_w::text, '') = '') then -- Ventilacao invasiva, Traquesostomia e sem interface
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/ventilation-tracheostomy-green.svg',1134004,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      elsif (respiracao_w = 'VMI' and (traqueo_w = 'COT' or traqueo_w = 'CN') and interface_w = 'T') then -- Ventilacao invasiva, Intubacao Orotraquial e Tubo em T(Ayre)
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/device-intubated-green.svg',1183409,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      elsif (respiracao_w = 'VMI' and traqueo_w = 'TP' and interface_w = 'T') then -- Ventilacao invasiva, Traquesostomia e Tubo em T(Ayre)
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/device-tracheostomy-green.svg',1183410,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      else
					CALL search_panorama_content.insert_icons_data(61,'assets/icons/status-and-feedback/cancel.svg',1134008,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'VI',966278);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				      end if;
				    end if;
				  end if;
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 70) then --Acompanhante not_found
        select obter_desc_exp_idioma(292477,wheb_usuario_pck.get_nr_seq_idioma,null)
        into STRICT desc_bed_w
;

        select obter_desc_exp_idioma(294174,wheb_usuario_pck.get_nr_seq_idioma,null)
        into STRICT desc_name_w
;

        select obter_desc_exp_idioma(291539,wheb_usuario_pck.get_nr_seq_idioma,null)
        into STRICT desc_age_w
;

        select obter_desc_exp_idioma(298476,wheb_usuario_pck.get_nr_seq_idioma,null)
        into STRICT desc_sexo_w
;

				ds_descrtion_icon_w := null;

				for r_companions in (SELECT	coalesce(a.nm_acompanhante, substr((select obter_nome_pf(a.cd_pessoa_fisica) ),1,40)) nm_acompanhante,
											(select obter_idade_pf(a.cd_pessoa_fisica, clock_timestamp(), 'A') ) ds_idade,
											(select obter_sexo_pf(a.cd_pessoa_fisica, 'D') ) ds_sexo,
											(select obter_desc_leito_unid_compl(a.nr_seq_interno) ) ds_bed,
											a.ie_alojamento ie_alojamento
									  from	atendimento_acompanhante a
									 where	a.nr_atendimento	= r_patient.nr_atendimento
									   and	((a.cd_pessoa_fisica IS NOT NULL AND a.cd_pessoa_fisica::text <> '') or (a.nm_acompanhante IS NOT NULL AND a.nm_acompanhante::text <> ''))
									   and	coalesce(a.dt_saida::text, '') = ''
									   and  nr_acompanhante = (select max(b.nr_acompanhante)
																 from atendimento_acompanhante b
																where b.nr_atendimento = a.nr_atendimento
																  and b.cd_pessoa_fisica = a.cd_pessoa_fisica
															 group by a.cd_pessoa_fisica)
									order by a.nm_acompanhante)
				loop

					ds_descrtion_icon_w := ds_descrtion_icon_w || '<hr>';

					if ((r_companions.ds_bed IS NOT NULL AND r_companions.ds_bed::text <> '') and r_companions.ie_alojamento = 'S') then
						ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_bed_w || ':' || r_companions.ds_bed || '</div>';
					elsif (r_companions.ie_alojamento = 'N') then
						ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'||obter_desc_exp_idioma(893224,wheb_usuario_pck.get_nr_seq_idioma,null) || '</div>';
					end if;

					if (r_companions.nm_acompanhante IS NOT NULL AND r_companions.nm_acompanhante::text <> '') then
						ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_name_w ||':'|| r_companions.nm_acompanhante || '</div>';
					end if;

					if (r_companions.ds_idade IS NOT NULL AND r_companions.ds_idade::text <> '') then
						ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_age_w ||':'||r_companions.ds_idade || '</div>';
					end if;

					if (r_companions.ds_sexo IS NOT NULL AND r_companions.ds_sexo::text <> '') then
						ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_sexo_w ||':'||r_companions.ds_sexo || '</div>';
					end if;
				end loop;

				if (ds_descrtion_icon_w IS NOT NULL AND ds_descrtion_icon_w::text <> '') then
					select CASE WHEN(select obter_tipo_acompanhante(r_patient.nr_atendimento) )='CA' THEN 604 WHEN(select obter_tipo_acompanhante(r_patient.nr_atendimento) )='SA' THEN 385  ELSE null END
					  into STRICT desc_icon_w
					;
					CALL search_panorama_content.insert_icons_data(70,get_icon_path(desc_icon_w,null),1030000,r_profile_icons_pat.ds_icone_instituicao,ds_descrtion_icon_w,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end if;

			if (r_profile_icons_pat.cd_icone_panorama = 87 and (r_patient.nr_atendimento IS NOT NULL AND r_patient.nr_atendimento::text <> '')) then
				select count(1)
					into STRICT ie_end_life_w
				  from   diretriz_atendimento
				 where  ie_diretriz      	= 'MC'
				   and  ie_resposta      	= 'S'
				   and  ie_situacao      	= 'A'
				   and  (dt_liberacao IS NOT NULL AND dt_liberacao::text <> '')
				   and  coalesce(dt_inativacao::text, '') = ''
				   and  coalesce(dt_final::text, '') = ''
				   and  ie_status        	<> 'I'
				   and  nr_atendimento   = r_patient.nr_atendimento;
				if (ie_end_life_w > 0) then
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(null,764),1136943,r_profile_icons_pat.ds_icone_instituicao,null,r_profile_icons_pat.nr_seq_prioridade,'C',null);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;

			end if;
		end loop;

    select obter_desc_exp_idioma(294174,wheb_usuario_pck.get_nr_seq_idioma,null)
    into STRICT desc_name_w
;

    select obter_desc_exp_idioma(291539,wheb_usuario_pck.get_nr_seq_idioma,null)
    into STRICT desc_age_w
;

    select obter_desc_exp_idioma(298476,wheb_usuario_pck.get_nr_seq_idioma,null)
    into STRICT desc_sexo_w
;

		ds_descrtion_icon_w := null;

		for r_newBorn in (SELECT * from table(search_panorama_content.get_new_born_data(r_patient.nr_atendimento)))
		loop

			if (coalesce(ds_descrtion_icon_w::text, '') = '') then
				ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| obter_desc_exp_idioma(489689,wheb_usuario_pck.get_nr_seq_idioma,null) || '</div>'||'<br>';
			end if;

			if (r_newBorn.ds_nome_rn IS NOT NULL AND r_newBorn.ds_nome_rn::text <> '') then
				ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_name_w ||':'|| r_newBorn.ds_nome_rn || '</div>';
			end if;

			if (r_newBorn.ds_idade_rn IS NOT NULL AND r_newBorn.ds_idade_rn::text <> '') then
				ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_age_w ||':'||r_newBorn.ds_idade_rn || '</div>';
			end if;

			if (r_newBorn.ds_sexo_rn IS NOT NULL AND r_newBorn.ds_sexo_rn::text <> '') then
				ds_descrtion_icon_w := ds_descrtion_icon_w ||'<div>'|| desc_sexo_w ||':'||r_newBorn.ds_sexo_rn || '</div>';
			end if;

			select CASE WHEN r_newBorn.ie_sexo_rn='M' THEN 565 WHEN r_newBorn.ie_sexo_rn='F' THEN 566  ELSE 685 END , CASE WHEN r_newBorn.ie_sexo_rn='M' THEN 1135092 WHEN r_newBorn.ie_sexo_rn='F' THEN 1135091 WHEN r_newBorn.ie_sexo_rn='I' THEN 1135088 WHEN r_newBorn.ie_sexo_rn='D' THEN 1135090 END  into STRICT ie_patient_gender, cd_label_sexo_w;
			CALL search_panorama_content.insert_icons_data(0,get_icon_path(null, ie_patient_gender),cd_label_sexo_w,get_icon_profile_rule(0,nr_regra_icon_w,'D'),null,0,'UB',null,null,null,null,r_newBorn.nr_atend_rn);
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);

			for r_profile_icons_baby in c_profile_icons_pat loop
				if (r_profile_icons_baby.cd_icone_panorama = 0) then
					if (r_newBorn.ie_alergia = 'S') then
						CALL search_panorama_content.insert_icons_data(0,get_icon_path(605,null),r_newBorn.nr_seq_texto_alergia,get_icon_profile_rule(0,nr_regra_icon_w,'D'),r_newBorn.ds_alergias,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
					elsif (obter_se_nega_alergia(r_newBorn.cd_pessoa_fisica) = 'S') then
						CALL search_panorama_content.insert_icons_data(0,get_icon_path(840, null),1065028,r_profile_icons_baby.ds_icone_instituicao,null,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
						RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
						PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
					end if;
				end if;

				if (r_newBorn.ie_vip = 'S' and r_profile_icons_baby.cd_icone_panorama = 0) then
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(665, null),null,r_profile_icons_baby.ds_icone_instituicao,r_newBorn.ds_vip,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;

				if (r_newBorn.ie_classif_paciente = 'S' and r_profile_icons_baby.cd_icone_panorama = 0) then
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(626, null),null,r_profile_icons_baby.ds_icone_instituicao,r_newBorn.ds_classif_paciente,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;

				if (r_newBorn.ie_paciente_isolado = 'S' and r_profile_icons_baby.cd_icone_panorama = 63) then
					select max(ds_tipo_isolamento_cih) into STRICT ds_isolation_w from pan_info_adicional_v where nr_atendimento = r_newBorn.nr_atend_rn;
					CALL search_panorama_content.insert_icons_data(63,get_icon_path(189,null),1030648,r_profile_icons_baby.ds_icone_instituicao,ds_isolation_w,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
				if (r_newBorn.ie_risco_queda <> 'N' and r_profile_icons_baby.cd_icone_panorama = 0) then
					select CASE WHEN r_newBorn.ie_risco_queda='B' THEN 667 WHEN r_newBorn.ie_risco_queda='M' THEN 699 WHEN r_newBorn.ie_risco_queda='C' THEN 700  ELSE 667 END
					  into STRICT ie_fall_risk_w
					;
					CALL search_panorama_content.insert_icons_data(0,get_icon_path(null,ie_fall_risk_w),null,r_profile_icons_baby.ds_icone_instituicao,r_newBorn.ds_risco_queda,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;

				if (to_char(r_newBorn.dt_nascimento_rn,'DDMM') = to_char(clock_timestamp(), 'DDMM') and r_profile_icons_baby.cd_icone_panorama = 2) then
					CALL search_panorama_content.insert_icons_data(2,get_icon_path(615, null),r_newBorn.nr_seq_texto_nasc,r_profile_icons_baby.ds_icone_instituicao,null,r_profile_icons_baby.nr_seq_prioridade,'B',null,null,null,null,r_newBorn.nr_atend_rn);
					RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
					PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
				end if;
			end loop;
		end loop;

		if (ds_descrtion_icon_w IS NOT NULL AND ds_descrtion_icon_w::text <> '') then
			CALL search_panorama_content.insert_icons_data(71,get_icon_path(null,677),1031784,null,ds_descrtion_icon_w,null,'C');
			RETURN NEXT current_setting('search_panorama_content.t_objeto_icons_row_w'::t_objeto_icons_row);
			PERFORM set_config('search_panorama_content.t_objeto_icons_row_w', null, false);
		end if;

	end loop;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION search_panorama_content.get_icons_data (cd_setor_atendimento_p bigint, cd_unidade_basica_p text, nr_seq_interno_p bigint) FROM PUBLIC;
