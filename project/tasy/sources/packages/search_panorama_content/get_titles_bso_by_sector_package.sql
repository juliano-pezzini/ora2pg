-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/* Based on get_titles_body_system_organs */

CREATE OR REPLACE FUNCTION search_panorama_content.get_titles_bso_by_sector (cd_setor_atendimento_p bigint) RETURNS varchar AS $body$
DECLARE


c_algoritmo_icon CURSOR FOR
    SELECT
        apc.ie_escala_acuidade
    FROM
        pan_configuracao_setor      t,
        acuidade_panorama_clinico   apc
    WHERE
        t.nr_sequencia = apc.nr_seq_pan_config_setor
        AND t.cd_setor_atendimento = cd_setor_atendimento_p
        AND t.ie_situacao = 'A';

ds_return_w             varchar(255);
nr_expressao_w          integer;
BEGIN
  if (cd_setor_atendimento_p IS NOT NULL AND cd_setor_atendimento_p::text <> '') then
      FOR reg_cursor1 IN c_algoritmo_icon LOOP
          case reg_cursor1.ie_escala_acuidade
          when 'AA' then nr_expressao_w := 1198943;
          when 'EWS' then nr_expressao_w := 1198944;
          when 'PEWS' then nr_expressao_w := 1151753;
          when 'SAPS II' then nr_expressao_w := 1151754;
          when 'APACHE II' then nr_expressao_w := 1176047;
          when 'SOFA' then nr_expressao_w := 1176048;
          when 'SCORE FLEX' then nr_expressao_w := 1176050;
          when 'MEWS' then nr_expressao_w := 1176049;
          when 'SCORE FLEX2' then nr_expressao_w := 1180455;
          else null;
          END CASE;
      END LOOP;

      select wheb_mensagem_pck.get_texto(nr_expressao_w)
      into STRICT ds_return_w
;

  end if;
return ds_return_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION search_panorama_content.get_titles_bso_by_sector (cd_setor_atendimento_p bigint) FROM PUBLIC;
