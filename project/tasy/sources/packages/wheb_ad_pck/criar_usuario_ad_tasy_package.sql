-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_ad_pck.criar_usuario_ad_tasy (ds_new_user_p text, ds_new_user_nome_p text, ds_new_user_sobrenome_p text, ds_new_pass_p text, ds_display_name_p text, ds_ip_phone_p text, cd_estabelecimento_p bigint) RETURNS varchar AS $body$
DECLARE

	ds_dominio_w		varchar(255);
	ds_server_ip_w		varchar(255);
	ds_base_name_w		varchar(1000);
	ds_adm_user_w		varchar(255);
	ds_adm_pass_w		varchar(255);
	ds_keystore_w		varchar(1000);
	
BEGIN
	Obter_Param_Usuario(0,104,0,'Tasy',cd_estabelecimento_p,ds_server_ip_w);
	Obter_Param_Usuario(0,116,0,'Tasy',cd_estabelecimento_p,ds_dominio_w);
	Obter_Param_Usuario(0,169,0,'Tasy',cd_estabelecimento_p,ds_adm_user_w);
	Obter_Param_Usuario(0,170,0,'Tasy',cd_estabelecimento_p,ds_adm_pass_w);
	Obter_Param_Usuario(0,171,0,'Tasy',cd_estabelecimento_p,ds_keystore_w);
	Obter_Param_Usuario(0,177,0,'Tasy',cd_estabelecimento_p,ds_base_name_w);
	if (position('DC=' in upper(ds_base_name_w)) = 0) then
		ds_base_name_w := 'dc=' || replace(ds_base_name_w,'.',',dc=');
	end if;

	return criar_usuario_ad(ds_base_name_w, ds_dominio_w, ds_adm_user_w, ds_adm_pass_w, ds_server_ip_w, ds_new_user_p, ds_new_user_nome_p, ds_new_user_sobrenome_p, ds_new_pass_p, ds_keystore_w, ds_display_name_p, ds_ip_phone_p);
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_ad_pck.criar_usuario_ad_tasy (ds_new_user_p text, ds_new_user_nome_p text, ds_new_user_sobrenome_p text, ds_new_pass_p text, ds_display_name_p text, ds_ip_phone_p text, cd_estabelecimento_p bigint) FROM PUBLIC;
