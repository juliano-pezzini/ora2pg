-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_tipos_cta_val_pck.obter_qt_reg_selecao ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_item_p bigint, nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_filtro_p pls_tipos_cta_val_pck.dados_filtro) RETURNS integer AS $body$
DECLARE


qt_registro_w	integer;
ds_sql		varchar(2000);

var_cur_w	integer;
var_exec_w	integer;
var_retorno_w	integer;


BEGIN

select	count(1)
into STRICT	qt_registro_w
from	pls_rp_cta_selecao a
where	a.nr_id_transacao = nr_id_transacao_p
and	a.nr_seq_conta = nr_seq_conta_p
and	a.nr_seq_conta_proc = nr_seq_item_p
and	a.nr_seq_rp_cta_filtro = dados_filtro_p.nr_sequencia;


-- Obter a quantidade de registros na selecao conforme o item e a transacao passados por parametro

ds_sql := 'select	count(1) ' || current_setting('pls_tipos_cta_val_pck.enter_w')::pls_util_pck.enter_w%type ||
	  'from		pls_rp_cta_selecao a ' || current_setting('pls_tipos_cta_val_pck.enter_w')::pls_util_pck.enter_w%type ||
	  'where	a.nr_id_transacao = :nr_id_transacao_p ';

-- Conta

ds_sql := ds_sql || ' and	a.nr_seq_conta = :nr_seq_conta_p';

-- Procedimento

ds_sql := ds_sql || ' and	a.nr_seq_conta_proc = :nr_seq_conta_proc_p';

ds_sql := ds_sql || ' and	a.nr_seq_rp_cta_filtro = :nr_seq_filtro ';

var_cur_w := dbms_sql.open_cursor;
dbms_sql.parse(var_cur_w, ds_sql, 1);


dbms_sql.bind_variable(var_cur_w, ':nr_id_transacao_p', nr_id_transacao_p);

-- Conta

dbms_sql.bind_variable(var_cur_w, ':nr_seq_conta_p', nr_seq_conta_p);

-- Procedimento

dbms_sql.bind_variable(var_cur_w, ':nr_seq_conta_proc_p', nr_seq_item_p);

dbms_sql.bind_variable(var_cur_w, ':nr_seq_filtro', dados_filtro_p.nr_sequencia);

dbms_sql.define_column(var_cur_w, 1, qt_registro_w);
var_exec_w := dbms_sql.execute(var_cur_w);

loop
var_retorno_w := dbms_sql.fetch_rows(var_cur_w);
exit when var_retorno_w = 0;
	-- Atualiza a variavel com o resultado do select

	dbms_sql.column_value(var_cur_w, 1, qt_registro_w);
end loop;
dbms_sql.close_cursor(var_cur_w);

return qt_registro_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_tipos_cta_val_pck.obter_qt_reg_selecao ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_item_p bigint, nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_filtro_p pls_tipos_cta_val_pck.dados_filtro) FROM PUBLIC;
