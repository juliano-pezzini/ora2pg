-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_tipos_cta_val_pck.pls_cta_val_aplica_regra ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_regra_p pls_tipos_cta_val_pck.dados_regra, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE



/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Rotina responsavel por atualizar o procedimento com a regra de valorizacao especial
-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[  ]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ X] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de aten??o:

------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


ie_tipo_item_w			integer;				
qt_oc_benef_w			integer;
nr_seq_proc_num_w		dbms_sql.number_table;
nr_seq_regra_num_w		dbms_sql.number_table;
i				integer;
qt_cnt_w			integer;

-- Retorna a informacao dos itens que estao na tabela de selecao.

c_gera_val CURSOR(nr_id_transacao_pc		pls_rp_cta_selecao.nr_id_transacao%type) FOR
	SELECT	x.nr_seq_conta_proc
	from	pls_rp_cta_selecao		x
	where	x.nr_id_transacao	= nr_id_transacao_pc
	and	x.ie_valido		= 'S';

BEGIN

qt_cnt_w := pls_util_cta_pck.qt_registro_transacao_w;
i := 0;

for c_gera_val_w in c_gera_val(nr_id_transacao_p) loop

	nr_seq_proc_num_w(i) := c_gera_val_w.nr_seq_conta_proc;
	nr_seq_regra_num_w(i) := dados_regra_p.nr_seq_regra;
	
	-- se atingiu a quantidade de registros manda para o banco

	if (i = qt_cnt_w) then
	
		CALL pls_tipos_cta_val_pck.atualizar_regra_proc(	nr_seq_proc_num_w, nr_seq_regra_num_w, nm_usuario_p);
		
		nr_seq_proc_num_w.delete;
		nr_seq_regra_num_w.delete;
		i := 0;
	else
		i := i + 1;
	end if;

end loop;

CALL pls_tipos_cta_val_pck.atualizar_regra_proc(	nr_seq_proc_num_w, nr_seq_regra_num_w, nm_usuario_p);

nr_seq_proc_num_w.delete;
nr_seq_regra_num_w.delete;
i := 0;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_tipos_cta_val_pck.pls_cta_val_aplica_regra ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_regra_p pls_tipos_cta_val_pck.dados_regra, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
