-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_tipos_cta_val_pck.obter_restricao_fil_conta ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_filtro_p pls_tipos_cta_val_pck.dados_filtro) RETURNS varchar AS $body$
DECLARE


qt_filtro_conta_w	integer;
ds_sql_w		varchar(300);


BEGIN
-- obter a quantidade de filtros de conta na regra

qt_filtro_conta_w := pls_tipos_cta_val_pck.obter_qt_filtro_conta(nr_id_transacao_p, dados_filtro_p);

-- so retorna algo se existir filtro de conta na regra

ds_sql_w := null;
if (qt_filtro_conta_w > 0) then
	-- monta a restricao para verificar se a conta se encaixou nos filtros da regra.

	ds_sql_w :=	' and	exists		(select	1 ' || pls_util_pck.enter_w ||
			'			from	pls_rp_cta_selecao x' || pls_util_pck.enter_w ||
			'			where	x.nr_id_transacao 	= :nr_id_transacao '|| pls_util_pck.enter_w ||
			'			and	x.nr_seq_conta_proc 	= proc.nr_sequencia '|| pls_util_pck.enter_w ||
			'			and	x.nr_seq_conta 		= proc.nr_seq_conta' || pls_util_pck.enter_w ||
			'			and	x.ie_valido 		= ' || current_setting('pls_tipos_cta_val_pck.aspas_w')::pls_util_pck.aspas_w%type || 'S' || current_setting('pls_tipos_cta_val_pck.aspas_w')::pls_util_pck.aspas_w%type;
	ds_sql_w := ds_sql_w || pls_util_pck.enter_w || ' and	x.nr_seq_rp_cta_filtro = :nr_seq_filtro ';
	
	ds_sql_w := ds_sql_w || ')';
end if;

return ds_sql_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_tipos_cta_val_pck.obter_restricao_fil_conta ( nr_id_transacao_p pls_rp_cta_selecao.nr_id_transacao%type, dados_filtro_p pls_tipos_cta_val_pck.dados_filtro) FROM PUBLIC;
