-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

--Principal	 
CREATE OR REPLACE PROCEDURE planserv_desdobramento_cta_pck.desbobrar_conta_pacote ( nr_interno_conta_p conta_paciente.nr_interno_conta%type, nm_usuario_p usuario.nm_usuario%type, ie_gerar_log_p text default 'N') AS $body$
DECLARE

	 
	ie_tipo_atend_conta_w	conta_paciente.ie_tipo_atend_conta%type;
	
	
BEGIN 
 
		CALL planserv_desdobramento_cta_pck.set_gerar_log(ie_gerar_log_p);
		CALL planserv_desdobramento_cta_pck.set_contas_criadas(null);
		 
		select	coalesce(max(ie_tipo_atend_conta),0) 
		into STRICT	ie_tipo_atend_conta_w 
		from	conta_paciente 
		where	nr_interno_conta = nr_interno_conta_p;		
		 
		 
		if (ie_tipo_atend_conta_w = 0) then 
			--A conta não possui tipo de atendimento informado! 
			--Favor verificar a função Conta Paciente / TISS / Dados TISS. 
			CALL wheb_mensagem_pck.exibir_mensagem_abort(410464);
		elsif (ie_tipo_atend_conta_w = 1) then 
			CALL planserv_desdobramento_cta_pck.processar_internacao(nr_interno_conta_p,nm_usuario_p);
		else 
			CALL planserv_desdobramento_cta_pck.processar_emergencia(nr_interno_conta_p,nm_usuario_p);			
		end if;
 
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE planserv_desdobramento_cta_pck.desbobrar_conta_pacote ( nr_interno_conta_p conta_paciente.nr_interno_conta%type, nm_usuario_p usuario.nm_usuario%type, ie_gerar_log_p text default 'N') FROM PUBLIC;
