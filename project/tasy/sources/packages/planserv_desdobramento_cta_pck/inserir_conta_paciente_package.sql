-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE planserv_desdobramento_cta_pck.inserir_conta_paciente ( nr_interno_conta_p conta_paciente.nr_interno_conta%type, dt_periodo_inicial_p conta_paciente.dt_periodo_inicial%type, dt_periodo_final_p conta_paciente.dt_periodo_final%type, nm_usuario_p usuario.nm_usuario%type, nr_interno_cont_ret_p INOUT conta_paciente.nr_interno_conta%type) AS $body$
DECLARE

 
	nr_interno_conta_w conta_paciente.nr_interno_conta%type;

	
BEGIN 
 
		begin 
			select nextval('conta_paciente_seq') 
			into STRICT nr_interno_conta_w 
			;
			 
			insert into conta_paciente(nr_atendimento, 
					dt_acerto_conta, 
					ie_status_acerto, 
					dt_periodo_inicial, 
					dt_periodo_final, 
					dt_atualizacao, 
					nm_usuario, 
					cd_convenio_parametro, 
					cd_categoria_parametro, 
					dt_mesano_referencia, 
					dt_mesano_contabil, 
					cd_convenio_calculo, 
					cd_categoria_calculo, 
					nr_interno_conta, 
					cd_estabelecimento, 
					nr_protocolo, 
					vl_desconto, 
					vl_conta, 
					ie_tipo_atend_tiss, 
					nr_seq_saida_consulta, 
					nr_seq_saida_spsadt, 
					nr_seq_saida_int, 
					ie_tipo_atend_conta, 
					ie_tipo_guia, 
					nr_conta_orig_desdob) 
			SELECT	nr_atendimento, 
				dt_acerto_conta, 
				1, 
				dt_periodo_inicial_p, 
				dt_periodo_final_p, 
				clock_timestamp(), 
				nm_usuario_p, 
				cd_convenio_parametro, 
				cd_categoria_parametro, 
				dt_mesano_referencia, 
				dt_mesano_contabil, 
				cd_convenio_calculo, 
				cd_categoria_calculo, 
				nr_interno_conta_w, 
				cd_estabelecimento, 
				'0', 
				0, 
				0, 
				ie_tipo_atend_tiss, 
				nr_seq_saida_consulta, 
				nr_seq_saida_spsadt, 
				nr_seq_saida_int, 
				ie_tipo_atend_conta, 
				ie_tipo_guia, 
				nr_interno_conta_p 
			from 	conta_paciente 
			where 	nr_interno_conta	= nr_interno_conta_p;
 
			CALL planserv_desdobramento_cta_pck.set_contas_criadas(nr_interno_conta_w);
			nr_interno_cont_ret_p := nr_interno_conta_w;
			 
			commit;
		exception 
		when others then 
			nr_interno_cont_ret_p:=0;	
		end;
 
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE planserv_desdobramento_cta_pck.inserir_conta_paciente ( nr_interno_conta_p conta_paciente.nr_interno_conta%type, dt_periodo_inicial_p conta_paciente.dt_periodo_inicial%type, dt_periodo_final_p conta_paciente.dt_periodo_final%type, nm_usuario_p usuario.nm_usuario%type, nr_interno_cont_ret_p INOUT conta_paciente.nr_interno_conta%type) FROM PUBLIC;
