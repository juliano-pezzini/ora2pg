-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_fiscal_dados_dmed_pck.inserir_dados_negociacao ( ie_descarregar_vetor_p text) AS $body$
BEGIN

if	((ie_descarregar_vetor_p = 'S') or (current_setting('pls_fiscal_dados_dmed_pck.nr_indice_vetor_w')::bigint >= pls_util_pck.qt_registro_transacao_w)) then
	if (current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_item_mens_w')::pls_util_cta_pck.t_number_table.count > 0) then
		forall i in current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_item_mens_w')::pls_util_cta_pck.t_number_table.first..tb_nr_seq_item_mens_w.last
			insert into pls_negociacao_mens_fiscal(nr_sequencia, dt_atualizacao, dt_atualizacao_nrec,
				nm_usuario, nm_usuario_nrec, nr_seq_parcela,
				ie_tipo_item, nr_seq_segurado, nr_seq_item_mens,
				nr_seq_tipo_lanc, vl_item, vl_juros_negociacao,
				vl_multa_negociacao, vl_taxa_negociacao, vl_desconto_negociacao,
				nr_titulo_negociado, vl_juros_negociacao_ant, vl_multa_negociacao_ant,
				vl_desconto_negociacao_ant, vl_taxa_negociacao_ant, nr_seq_item_mens_aprop)
			values (nextval('pls_negociacao_mens_fiscal_seq'), clock_timestamp(), clock_timestamp(),
				nm_usuario_p, nm_usuario_p, tb_nr_seq_parcela_neg_w(i),
				tb_ie_tipo_item_w(i), current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_segurado_w')::pls_util_cta_pck.t_number_table(i), current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_item_mens_w')::pls_util_cta_pck.t_number_table(i),
				current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_tipo_lanc_w')::pls_util_cta_pck.t_number_table(i), current_setting('pls_fiscal_dados_dmed_pck.tb_vl_item_w')::pls_util_cta_pck.t_number_table(i), current_setting('pls_fiscal_dados_dmed_pck.tb_vl_juros_negociacao_w')::pls_util_cta_pck.t_number_table(i),
				current_setting('pls_fiscal_dados_dmed_pck.tb_vl_multa_negociacao_w')::pls_util_cta_pck.t_number_table(i), current_setting('pls_fiscal_dados_dmed_pck.tb_vl_taxa_negociacao_w')::pls_util_cta_pck.t_number_table(i), current_setting('pls_fiscal_dados_dmed_pck.tb_vl_desconto_negociacao_w')::pls_util_cta_pck.t_number_table(i),
				tb_nr_titulo_negociado_w(i), tb_vl_juros_negociacao_ant_w(i), tb_vl_multa_negociacao_ant_w(i),
				tb_vl_desconto_negoc_ant_w(i), tb_vl_taxa_negociacao_ant_w(i), current_setting('pls_fiscal_dados_dmed_pck.tb_nr_seq_item_mens_aprop_w')::pls_util_cta_pck.t_number_table(i));
		commit;
	end if;
	
	CALL pls_fiscal_dados_dmed_pck.limpar_vetor_negociacao();
else
	nr_indice_vetor_neg_w := nr_indice_vetor_neg_w + 1;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_fiscal_dados_dmed_pck.inserir_dados_negociacao ( ie_descarregar_vetor_p text) FROM PUBLIC;
