-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION tiss_convenio_pck.tiss_obter_xml_projeto (cd_convenio_p bigint, cd_estabelecimento_p bigint, ie_tipo_tiss_p text, dt_referencia_p timestamp default null) RETURNS bigint AS $body$
DECLARE

		
		
current_setting('tiss_convenio_pck.dt_referencia_w')::timestamp		timestamp;
indice_w		bigint;	
nr_seq_projeto_w	bigint;	
i 			integer;

BEGIN

PERFORM set_config('tiss_convenio_pck.dt_referencia_w', coalesce(dt_referencia_p,current_setting('tiss_convenio_pck.dt_referencia_local_w')::timestamp), false);

for i in 1..tiss_proj_xml_vet_w.count loop
begin
	if (current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[i].cd_convenio		= cd_convenio_p) and (current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[i].cd_estabelecimento	= cd_estabelecimento_p) and (current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[i].dt_referencia		= current_setting('tiss_convenio_pck.dt_referencia_w')::timestamp) and (current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[i].ie_tipo_tiss		= ie_tipo_tiss_p) then
		return  current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[i].nr_seq_projeto;
	end if;
end;
end loop;

nr_seq_projeto_w	:= tiss_obter_xml_projeto2(	cd_convenio_p,
							cd_estabelecimento_p,
							ie_tipo_tiss_p,
							dt_referencia_p);

indice_w						:= current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet.count+1;
current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[indice_w].cd_convenio		:= cd_convenio_p;
current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[indice_w].cd_estabelecimento	:= cd_estabelecimento_p;
current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[indice_w].ie_tipo_tiss		:= ie_tipo_tiss_p;
current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[indice_w].nr_seq_projeto		:= nr_seq_projeto_w;
current_setting('tiss_convenio_pck.tiss_proj_xml_vet_w')::tiss_proj_xml_vet[indice_w].dt_referencia		:= current_setting('tiss_convenio_pck.dt_referencia_w')::timestamp;

return nr_seq_projeto_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION tiss_convenio_pck.tiss_obter_xml_projeto (cd_convenio_p bigint, cd_estabelecimento_p bigint, ie_tipo_tiss_p text, dt_referencia_p timestamp default null) FROM PUBLIC;
