-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ppm_painel_pck.get_target_metrica (nr_seq_metrica_p bigint, dt_inicial_p timestamp, dt_final_p timestamp) RETURNS SETOF T_PPM_PAINEL AS $body$
DECLARE

		
	nr_mes_w	bigint;
	qt_target_w	ppm_objetivo_metrica.qt_target%type;
	i		integer;
	line_w		t_ppm_painel_row;
		
	
BEGIN
	
	if (nr_seq_metrica_p IS NOT NULL AND nr_seq_metrica_p::text <> '') then
	
		select	qt_target
		into STRICT	qt_target_w
		from	ppm_objetivo_metrica
		where	nr_sequencia = nr_seq_metrica_p;
		
		select	(to_char(dt_final_p,'MM'))::numeric
		into STRICT	nr_mes_w
		;
		
		i := 1;
		for i in 1..nr_mes_w loop
			begin		
			
			line_w.nr_seq_resultado		:= null;
			line_w.nr_seq_metrica		:= nr_seq_metrica_p;
			line_w.dt_resultado		:= to_date('01/'||lpad(i,2,'0')||'/'||to_char(dt_final_p,'yyyy'),'dd/mm/yyyy');
			line_w.nr_mes_resultado		:= i;
			line_w.vl_resultado		:= qt_target_w;
			line_w.ie_resultado		:= null;
			
			RETURN NEXT line_w;
			
			end;
		end loop;
			
	end if;
		
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ppm_painel_pck.get_target_metrica (nr_seq_metrica_p bigint, dt_inicial_p timestamp, dt_final_p timestamp) FROM PUBLIC;
