-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ppm_painel_pck.get_tipo_resultado (qt_target_p ppm_objetivo_metrica.qt_target%type, qt_target_final_p ppm_objetivo_metrica.qt_target_final%type, qt_target_exceeds_p ppm_objetivo_metrica.qt_target_exceeds%type, qt_target_exceeds_final_p ppm_objetivo_metrica.qt_target_exceeds_final%type, ie_condicao_p ppm_objetivo_metrica.ie_condicao%type, ie_condicao_exceeds_p ppm_objetivo_metrica.ie_condicao_exceeds%type, vl_resultado_p ppm_objetivo_result.vl_resultado_calc%type) RETURNS varchar AS $body$
DECLARE


	ds_retorno_w		varchar(1);
	/* ds_retorno_w
		A - Meta atingida
		E - Meta excedida
		N - Meta nao atingida
	*/
	
BEGIN

		if (ie_condicao_p = '=') and (qt_target_p = vl_resultado_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = '<') and (vl_resultado_p < qt_target_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = '<=') and (vl_resultado_p <= qt_target_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = '>') and (vl_resultado_p > qt_target_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = '>=') and (vl_resultado_p >= qt_target_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = 'BTW') and (vl_resultado_p between qt_target_p and qt_target_final_p) then
			ds_retorno_w	:= 'A';
		elsif (ie_condicao_p = '<>') and (vl_resultado_p <> qt_target_p) then
			ds_retorno_w	:= 'A';
		else
			ds_retorno_w	:= 'N';
		end if;

		if (qt_target_exceeds_p IS NOT NULL AND qt_target_exceeds_p::text <> '') and (ie_condicao_exceeds_p IS NOT NULL AND ie_condicao_exceeds_p::text <> '') then

			if (ie_condicao_exceeds_p = '=') and (qt_target_exceeds_p = vl_resultado_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = '<') and (vl_resultado_p < qt_target_exceeds_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = '<=') and (vl_resultado_p <= qt_target_exceeds_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = '>') and (vl_resultado_p > qt_target_exceeds_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = '>=') and (vl_resultado_p >= qt_target_exceeds_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = '<>') and (vl_resultado_p <> qt_target_exceeds_p) then
				ds_retorno_w	:= 'E';
			elsif (ie_condicao_exceeds_p = 'BTW') and (vl_resultado_p between qt_target_exceeds_p and qt_target_exceeds_final_p) then
				ds_retorno_w	:= 'E';
			end if;
		end if;

	return	ds_retorno_w;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ppm_painel_pck.get_tipo_resultado (qt_target_p ppm_objetivo_metrica.qt_target%type, qt_target_final_p ppm_objetivo_metrica.qt_target_final%type, qt_target_exceeds_p ppm_objetivo_metrica.qt_target_exceeds%type, qt_target_exceeds_final_p ppm_objetivo_metrica.qt_target_exceeds_final%type, ie_condicao_p ppm_objetivo_metrica.ie_condicao%type, ie_condicao_exceeds_p ppm_objetivo_metrica.ie_condicao_exceeds%type, vl_resultado_p ppm_objetivo_result.vl_resultado_calc%type) FROM PUBLIC;
