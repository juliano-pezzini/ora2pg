-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE sus_obter_inco_ativa_pck.set_sus_obter_inco_ativa (cd_inconsistencia_p bigint) AS $body$
BEGIN
        PERFORM set_config('sus_obter_inco_ativa_pck.registro_nao_encontrado_w', true, false);
        PERFORM set_config('sus_obter_inco_ativa_pck.cd_estabelecimento_w', wheb_usuario_pck.get_cd_estabelecimento, false);

        if (coalesce(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38),0) > 0) then
        for i in 1..registros_w loop
                if (to_char(current_setting('sus_obter_inco_ativa_pck.array_cd_inconsistencia')::strarray(i)) = to_char(cd_inconsistencia_p) and
                        to_char(current_setting('sus_obter_inco_ativa_pck.array_cd_estabelecimento')::strarray(i)) = to_char(current_setting('sus_obter_inco_ativa_pck.cd_estabelecimento_w')::smallint)) then
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_consiste_w', current_setting('sus_obter_inco_ativa_pck.array_ie_consiste')::strarray(i), false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_aih_w', current_setting('sus_obter_inco_ativa_pck.array_ie_aih')::strarray(i), false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_apac_w', current_setting('sus_obter_inco_ativa_pck.array_ie_apac')::strarray(i), false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_con_w', current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_con')::strarray(i), false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_ind_w', current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_ind')::strarray(i), false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.registro_nao_encontrado_w', false, false);
                        exit;
                end if;
        end loop;
        end if;

        if (current_setting('sus_obter_inco_ativa_pck.registro_nao_encontrado_w')::boolean) then

        begin
        select	max(nr_sequencia)
        into STRICT	current_setting('sus_obter_inco_ativa_pck.nr_seq_inconsistencia_w')::bigint
        from	sus_inconsistencia
        where	cd_inconsistencia	= cd_inconsistencia_p;
        exception
        when no_data_found then
                PERFORM set_config('sus_obter_inco_ativa_pck.nr_seq_inconsistencia_w', 0, false);
        when others then
                PERFORM set_config('sus_obter_inco_ativa_pck.nr_seq_inconsistencia_w', 0, false);
        end;

        begin
        select	ie_consiste,
                ie_aih,
                ie_apac,
                ie_bpa_consolidado,
                ie_bpa_individualizado
        into STRICT	current_setting('sus_obter_inco_ativa_pck.ie_consiste_w')::varchar(1),
                current_setting('sus_obter_inco_ativa_pck.ie_aih_w')::varchar(1),
                current_setting('sus_obter_inco_ativa_pck.ie_apac_w')::varchar(1),
                current_setting('sus_obter_inco_ativa_pck.ie_bpa_con_w')::varchar(1),
                current_setting('sus_obter_inco_ativa_pck.ie_bpa_ind_w')::varchar(1)
        from	sus_inconsistencia_estab
        where	nr_seq_inconsistencia	= current_setting('sus_obter_inco_ativa_pck.nr_seq_inconsistencia_w')::bigint
        and	cd_estabelecimento	= current_setting('sus_obter_inco_ativa_pck.cd_estabelecimento_w')::smallint;
        exception
        when no_data_found then
                begin
                select	ie_consiste,
                        ie_aih,
                        ie_apac,
                        ie_bpa_consolidado,
                        ie_bpa_individualizado
                into STRICT	current_setting('sus_obter_inco_ativa_pck.ie_consiste_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_aih_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_apac_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_bpa_con_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_bpa_ind_w')::varchar(1)
                from	sus_inconsistencia
                where	cd_inconsistencia	= cd_inconsistencia_p;
                exception
                when no_data_found then
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_consiste_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_aih_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_apac_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_con_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_ind_w', 'N', false);
                when others then
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_consiste_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_aih_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_apac_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_con_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_ind_w', 'N', false);
                end;
        when others then
                begin
                select	ie_consiste,
                        ie_aih,
                        ie_apac,
                        ie_bpa_consolidado,
                        ie_bpa_individualizado
                into STRICT	current_setting('sus_obter_inco_ativa_pck.ie_consiste_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_aih_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_apac_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_bpa_con_w')::varchar(1),
                        current_setting('sus_obter_inco_ativa_pck.ie_bpa_ind_w')::varchar(1)
                from	sus_inconsistencia
                where	cd_inconsistencia	= cd_inconsistencia_p;
                exception
                when no_data_found then
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_consiste_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_aih_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_apac_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_con_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_ind_w', 'N', false);
                when others then
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_consiste_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_aih_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_apac_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_con_w', 'N', false);
                        PERFORM set_config('sus_obter_inco_ativa_pck.ie_bpa_ind_w', 'N', false);
                end;
        end;

        PERFORM set_config('sus_obter_inco_ativa_pck.registros_w', current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38) + 1, false);
        current_setting('sus_obter_inco_ativa_pck.array_cd_estabelecimento')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_cd_inconsistencia')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_ie_consiste')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_ie_aih')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_ie_apac')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_con')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_ind')::strarray.extend;
        current_setting('sus_obter_inco_ativa_pck.array_cd_estabelecimento')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.cd_estabelecimento_w')::smallint;
        current_setting('sus_obter_inco_ativa_pck.array_cd_inconsistencia')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := cd_inconsistencia_p;
        current_setting('sus_obter_inco_ativa_pck.array_ie_consiste')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.ie_consiste_w')::varchar(1);
        current_setting('sus_obter_inco_ativa_pck.array_ie_aih')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.ie_aih_w')::varchar(1);
        current_setting('sus_obter_inco_ativa_pck.array_ie_apac')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.ie_apac_w')::varchar(1);
        current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_con')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.ie_bpa_con_w')::varchar(1);
        current_setting('sus_obter_inco_ativa_pck.array_ie_bpa_ind')::strarray(current_setting('sus_obter_inco_ativa_pck.registros_w')::numeric(38)) := current_setting('sus_obter_inco_ativa_pck.ie_bpa_ind_w')::varchar(1);
        end if;
        end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE sus_obter_inco_ativa_pck.set_sus_obter_inco_ativa (cd_inconsistencia_p bigint) FROM PUBLIC;
