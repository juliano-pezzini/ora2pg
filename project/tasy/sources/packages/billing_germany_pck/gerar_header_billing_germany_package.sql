-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION billing_germany_pck.gerar_header_billing_germany () RETURNS SETOF T_BILLING_GERMANY_HEADER_DATA AS $body$
DECLARE


	linha_w   t_billing_germany_header;

	id_seq_w		bigint;
	ds_seq_w		varchar(14);
	nm_remetente_w		varchar(35);
	nm_destinatario_w	varchar(35);
	dt_atual_w		timestamp;
	nm_arquivo_w		varchar(14);

        c01 CURSOR FOR
        SELECT  'UNB' 				unb
		,'UNOC' 			unb_s001_0001
		,3				unb_s001_0002
		,nm_remetente_w			unb_s002_0004
		,nm_destinatario_w		unb_s003_0010
		,to_char(dt_atual_w, 'yymmdd')	unb_s004_0017
		,to_char(dt_atual_w, 'hh24mi')	unb_s004_0019
		,ds_seq_w			unb_s004_0020
		,substr(nm_arquivo_w, 1, 14)	unb_s005_0026
;

	r_C01 	C01%rowtype;



BEGIN

	-- Preparacao dos dados do cabeçalho do arquivo.
	id_seq_w	:= 0999;
	nm_remetente_w	:= 'Não Identificado';
	nm_destinatario_w	:= 'Não Identificado';
	dt_atual_w	:= clock_timestamp();
	nm_arquivo_w	:= 'KRH'||45678||901;

	if	length(id_seq_w) < 6 then
		ds_seq_w := lpad(to_char(id_seq_w),5,'0');
	else
		ds_seq_w := to_char(id_seq_w);
	end if;

	open C01;
	loop
	fetch C01 into r_C01;
	EXIT WHEN NOT FOUND; /* apply on C01 */
		linha_w.unb		:=	r_C01.unb;
		linha_w.unb_s001_0001	:=	r_C01.unb_s001_0001;
		linha_w.unb_s001_0002	:=	r_C01.unb_s001_0002;
		linha_w.unb_s002_0004	:=	r_C01.unb_s002_0004;
		linha_w.unb_s003_0010	:=	r_C01.unb_s003_0010;
		linha_w.unb_s004_0017	:=	r_C01.unb_s004_0017;
		linha_w.unb_s004_0019	:=	r_C01.unb_s004_0019;
		linha_w.unb_s004_0020	:=	r_C01.unb_s004_0020;
		linha_w.unb_s005_0026	:=	r_C01.unb_s005_0026;
		RETURN NEXT linha_w;
        end loop;
	close C01;

        return;

        END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION billing_germany_pck.gerar_header_billing_germany () FROM PUBLIC;
