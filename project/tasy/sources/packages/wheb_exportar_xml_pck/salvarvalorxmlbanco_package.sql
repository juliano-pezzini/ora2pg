-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE wheb_exportar_xml_pck.salvarvalorxmlbanco () AS $body$
BEGIN
		if (current_setting('wheb_exportar_xml_pck.ie_tipo_w')::varchar(60) = 'TISS')  then
			PERFORM set_config('wheb_exportar_xml_pck.ds_xml_valor_w', replace(current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::varchar(32000),'GERAR_HASH_MD5',''), false);
			PERFORM set_config('wheb_exportar_xml_pck.qt_valor_xml_w', current_setting('wheb_exportar_xml_pck.qt_valor_xml_w')::bigint + 1, false);
			if (current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::(varchar(32000) IS NOT NULL AND (varchar(32000))::text <> '')) then
				insert into tiss_log_valor_xml(
					nr_sequencia,
					nr_seq_log_tiss,
					ds_valor_xml)
				values (
					nextval('tiss_log_valor_xml_seq'),
					current_setting('wheb_exportar_xml_pck.nr_seq_log_w')::bigint,
					current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::varchar(32000)
				);
				commit;
			end if;
		elsif ( current_setting('wheb_exportar_xml_pck.ie_tipo_w')::coalesce(varchar(60)::text, '') = '' or ((current_setting('wheb_exportar_xml_pck.ie_tipo_w')::varchar(60) <> 'INTEGRACAO') and (current_setting('wheb_exportar_xml_pck.ie_tipo_w')::varchar(60) <> 'PTUSCS') and (current_setting('wheb_exportar_xml_pck.ie_tipo_w')::varchar(60) <> 'SIP'))) then
			PERFORM set_config('wheb_exportar_xml_pck.ds_xml_valor_w', replace(current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::varchar(32000),'GERAR_HASH_MD5',''), false);
			PERFORM set_config('wheb_exportar_xml_pck.qt_valor_xml_w', current_setting('wheb_exportar_xml_pck.qt_valor_xml_w')::bigint + 1, false);
			if (current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::(varchar(32000) IS NOT NULL AND (varchar(32000))::text <> '')) then
				insert into tasy_valor_xml_banco(
					nr_sequencia,
					dt_atualizacao,
					nm_usuario,
					ds_valor_xml,
					nr_seq_geracao,
					nr_seq_projeto)
				values (
					current_setting('wheb_exportar_xml_pck.nr_seq_log_w')::bigint,
					clock_timestamp(),
					'Tasy',
					current_setting('wheb_exportar_xml_pck.ds_xml_valor_w')::varchar(32000),
					current_setting('wheb_exportar_xml_pck.nr_seq_geracao_w')::bigint,
					current_setting('wheb_exportar_xml_pck.nr_seq_projeto_w')::bigint
				);
				commit;
			end if;
		end if;
		PERFORM set_config('wheb_exportar_xml_pck.ds_xml_valor_w', '', false);
	end;

$body$
LANGUAGE PLPGSQL
;
-- REVOKE ALL ON PROCEDURE wheb_exportar_xml_pck.salvarvalorxmlbanco () FROM PUBLIC;
