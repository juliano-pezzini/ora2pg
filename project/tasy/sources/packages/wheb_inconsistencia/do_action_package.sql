-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_inconsistencia.do_action (integridade_referencial_p INTEGRIDADE_REFERENCIAL, ie_acao text) RETURNS boolean AS $body$
DECLARE

    count_w         bigint;
    rows_affected_w bigint;

BEGIN
    rows_affected_w := 0;
    count_w := wheb_inconsistencia.do_count_incrows(integridade_referencial_p);

    CASE UPPER(ie_acao)
      WHEN current_setting('wheb_inconsistencia.domain_action_inc_delete')::varchar(1) THEN
        rows_affected_w := wheb_inconsistencia.do_delete_incrows(integridade_referencial_p);

      WHEN current_setting('wheb_inconsistencia.domain_action_inc_insert')::varchar(1) THEN
        rows_affected_w := wheb_inconsistencia.do_insert_from_schema(integridade_referencial_p, 'TASY_VERSAO');

      WHEN current_setting('wheb_inconsistencia.domain_action_inc_script')::varchar(1) THEN
      BEGIN
        CALL wheb_inconsistencia.do_execute_config_script(integridade_referencial_p.nm_tabela, integridade_referencial_p.nm_integridade_referencial, WHEB_DB.GETSQL_IN(current_setting('wheb_inconsistencia.domain_obj_type_constraint')::varchar(15)));

        IF wheb_inconsistencia.do_count_incrows(integridade_referencial_p) <= 0 THEN
          rows_affected_w := count_w;
        END IF;
      END;

      WHEN current_setting('wheb_inconsistencia.domain_action_inc_update')::varchar(1) THEN
        rows_affected_w := wheb_inconsistencia.do_update_incrows(integridade_referencial_p);
    ELSE
      RETURN FALSE;
    END CASE;

    RETURN(rows_affected_w = count_w);
  END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_inconsistencia.do_action (integridade_referencial_p INTEGRIDADE_REFERENCIAL, ie_acao text) FROM PUBLIC;
