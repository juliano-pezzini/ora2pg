-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE intpd_rest_utils_pck.check_authorization_intpadrao (NR_SEQ_FILA_P INTPD_DATA_RECEIVE.NR_SEQ_FILA%TYPE, IE_SISTEMA_P CREDENCIAIS_INTEGRACAO.IE_SISTEMA%TYPE) AS $body$
DECLARE

    AUTH_REG_W  INTPD_DATA_RECEIVE.DS_VALUE%TYPE;
    AUTH_SIST_W varchar(250);

BEGIN
    SELECT SUBSTR(IDR.DS_VALUE, position(' ' in IDR.DS_VALUE) + 1)
      INTO STRICT AUTH_REG_W
      FROM INTPD_DATA_RECEIVE IDR
     WHERE IDR.NR_SEQ_FILA = NR_SEQ_FILA_P
       AND UPPER(IDR.DS_NAME) = 'AUTHORIZATION';

    SELECT UTL_RAW.CAST_TO_VARCHAR2(UTL_ENCODE.BASE64_ENCODE(encode(CI.DS_LOGIN || ':' || CI.DS_SENHA::bytea, 'hex')::bytea))
      INTO STRICT AUTH_SIST_W
      FROM CREDENCIAIS_INTEGRACAO CI
     WHERE CI.IE_SISTEMA = IE_SISTEMA_P;

    IF (AUTH_REG_W != AUTH_SIST_W) THEN
       CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(59471, '_DS_ERRO_P=PROJESI-001;', -20100);
    END IF;
  EXCEPTION
    WHEN OTHERS THEN
         CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(59471, '_DS_ERRO_P=PROJESI-002;', -20100);
  END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_rest_utils_pck.check_authorization_intpadrao (NR_SEQ_FILA_P INTPD_DATA_RECEIVE.NR_SEQ_FILA%TYPE, IE_SISTEMA_P CREDENCIAIS_INTEGRACAO.IE_SISTEMA%TYPE) FROM PUBLIC;
