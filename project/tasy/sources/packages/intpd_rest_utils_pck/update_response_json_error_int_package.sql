-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE intpd_rest_utils_pck.update_response_json_error_int (NR_SEQ_FILA_P INTPD_DATA_RECEIVE.NR_SEQ_FILA%TYPE, MSG_ERRO_P text, STATUS_HTTP_P INTPD_FILA_TRANSMISSAO.IE_STATUS_HTTP%TYPE, DO_ROLLBACK_P boolean DEFAULT TRUE) AS $body$
DECLARE

    DS_RESPONSE_W   INTPD_FILA_TRANSMISSAO.DS_MESSAGE_RESPONSE%TYPE;
    JSON_RESPONSE_W PHILIPS_JSON := PHILIPS_JSON();

BEGIN
    IF (DO_ROLLBACK_P) THEN
       ROLLBACK;
    END IF;

    DBMS_LOB.CREATETEMPORARY(DS_RESPONSE_W, TRUE);

    JSON_RESPONSE_W.PUT('ERROR', MSG_ERRO_P);
    JSON_RESPONSE_W.(DS_RESPONSE_W);

    UPDATE INTPD_FILA_TRANSMISSAO IFT
       SET IFT.IE_STATUS_HTTP      = STATUS_HTTP_P,
           IFT.IE_STATUS           = 'E',
           IFT.DS_MESSAGE_RESPONSE = DS_RESPONSE_W
     WHERE IFT.NR_SEQUENCIA = NR_SEQ_FILA_P;

    COMMIT;

    DBMS_LOB.FREETEMPORARY(DS_RESPONSE_W);
  EXCEPTION
    WHEN OTHERS THEN
         BEGIN
           ROLLBACK;
           CALL WHEB_MENSAGEM_PCK.EXIBIR_MENSAGEM_ABORT(59471, '_DS_ERRO_P=PROJESI-003;', SQLSTATE);
         END;
  END;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE intpd_rest_utils_pck.update_response_json_error_int (NR_SEQ_FILA_P INTPD_DATA_RECEIVE.NR_SEQ_FILA%TYPE, MSG_ERRO_P text, STATUS_HTTP_P INTPD_FILA_TRANSMISSAO.IE_STATUS_HTTP%TYPE, DO_ROLLBACK_P boolean DEFAULT TRUE) FROM PUBLIC;
