-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION wheb_log_pck.get_ie_gerar_callstack (nm_tabela_p text) RETURNS varchar AS $body$
DECLARE


	ind	bigint := 0;
	
BEGIN

	PERFORM set_config('wheb_log_pck.ie_gerar_callstack_w', '', false);
	for i in 1..ie_call_w.count  loop
		begin
		if (current_setting('wheb_log_pck.ie_call_w')::Vetor[i](.nm_tabela_w IS NOT NULL AND .nm_tabela_w::text <> '') and
			upper(current_setting('wheb_log_pck.ie_call_w')::Vetor[i].nm_tabela_w) = upper(nm_tabela_p)) then
			begin
			PERFORM set_config('wheb_log_pck.ie_gerar_callstack_w', current_setting('wheb_log_pck.ie_call_w')::Vetor[i].ie_gravar_call_stack_w, false);
			end;
		end if;
		end;
	end loop;

	if (current_setting('wheb_log_pck.ie_gerar_callstack_w')::varchar(1) = '' or
		current_setting('wheb_log_pck.ie_gerar_callstack_w')::coalesce(varchar(1)::text, '') = '') then
		begin
		ind := current_setting('wheb_log_pck.ie_call_w')::Vetor.count + 1;

		obter_valor_dinamico_char_bv('select nvl(ie_callstack,''N'') from tabela_sistema where upper(nm_tabela) = upper(:nm_tabela_p)', 'nm_tabela_p='||nm_tabela_p||';', current_setting('wheb_log_pck.ie_call_w')::Vetor[ind].ie_gravar_call_stack_w);
		current_setting('wheb_log_pck.ie_call_w')::Vetor[ind].nm_tabela_w := nm_tabela_p;
		PERFORM set_config('wheb_log_pck.ie_gerar_callstack_w', current_setting('wheb_log_pck.ie_call_w')::Vetor[ind].ie_gravar_call_stack_w, false);
		end;
	end if;

	return current_setting('wheb_log_pck.ie_gerar_callstack_w')::varchar(1);
	end;

$body$
LANGUAGE PLPGSQL
 STABLE;
-- REVOKE ALL ON FUNCTION wheb_log_pck.get_ie_gerar_callstack (nm_tabela_p text) FROM PUBLIC;
