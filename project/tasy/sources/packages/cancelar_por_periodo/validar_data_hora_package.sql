-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE cancelar_por_periodo.validar_data_hora (dt_inicial_p timestamp, dt_final_p timestamp, hr_inicial_p timestamp, hr_final_p timestamp) AS $body$
DECLARE


dt_agenda_padrao_w varchar(20);
hr_inicial_w timestamp;
hr_final_w timestamp;


BEGIN

  if (dt_inicial_p IS NOT NULL AND dt_inicial_p::text <> '') and (dt_final_p IS NOT NULL AND dt_final_p::text <> '') and (trunc(dt_final_p) < trunc(dt_inicial_p)) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort('A data final nao pode ser menor q a data incial. procurara expressao depois');
  end if;

  if (dt_inicial_p IS NOT NULL AND dt_inicial_p::text <> '') and ( trunc(dt_inicial_p) < trunc(clock_timestamp())) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort('A data inicial nao pode ser menor q a data atual. procurara expressao depois');
  end if;

   if (dt_final_p IS NOT NULL AND dt_final_p::text <> '') and (trunc(dt_final_p) < trunc(clock_timestamp())) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort('A data final nao pode ser menor q a data atual. procurara expressao depois');
  end if;

  dt_agenda_padrao_w := to_char(clock_timestamp(), 'dd/mm/yyyy');
  hr_inicial_w := to_date(dt_agenda_padrao_w || to_char(hr_inicial_p, 'HH24:mi') , 'dd/mm/yyyy HH24:mi');
  hr_final_w  := to_date(dt_agenda_padrao_w || to_char(hr_final_p, 'HH24:mi') , 'dd/mm/yyyy HH24:mi');

  if (hr_final_w < hr_inicial_w) then
    CALL Wheb_mensagem_pck.exibir_mensagem_abort('A hora final nao pode ser menor q a hora atual. procurara expressao depois');
  end if;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE cancelar_por_periodo.validar_data_hora (dt_inicial_p timestamp, dt_final_p timestamp, hr_inicial_p timestamp, hr_final_p timestamp) FROM PUBLIC;
