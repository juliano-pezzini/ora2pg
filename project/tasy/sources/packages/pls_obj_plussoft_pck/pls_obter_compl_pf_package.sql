-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_obj_plussoft_pck.pls_obter_compl_pf ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, ie_tipo_complemento_p compl_pessoa_fisica.ie_tipo_complemento%type, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE


qt_registro_w		bigint;
nr_ddi_telefone_w	compl_pessoa_fisica.nr_ddi_telefone%type;
nr_ddd_telefone_w	compl_pessoa_fisica.nr_ddd_telefone%type;
nr_telefone_w		compl_pessoa_fisica.nr_telefone%type;
ds_email_w		compl_pessoa_fisica.ds_email%type;
cd_cep_w		compl_pessoa_fisica.cd_cep%type;
nr_seq_pais_w		compl_pessoa_fisica.nr_seq_pais%type;
sg_estado_w		compl_pessoa_fisica.sg_estado%type;
ds_municipio_w		compl_pessoa_fisica.ds_municipio%type;
ds_tipo_logradouro_w	compl_pessoa_fisica.cd_tipo_logradouro%type;
ds_endereco_w		compl_pessoa_fisica.ds_endereco%type;
nr_endereco_w		compl_pessoa_fisica.nr_endereco%type;
ds_complemento_w	compl_pessoa_fisica.ds_complemento%type;
cd_municipio_ibge_w	compl_pessoa_fisica.cd_municipio_ibge%type;
ds_bairro_w		compl_pessoa_fisica.ds_bairro%type;
dt_atualizacao_w	compl_pessoa_fisica.dt_atualizacao%type;
ds_fone_adic_w		compl_pessoa_fisica.ds_fone_adic%type;
nm_contato_w		varchar(255);
ds_retorno_w		varchar(255);


BEGIN

select	count(1)
into STRICT	qt_registro_w
from	compl_pessoa_fisica
where	cd_pessoa_fisica 	= cd_pessoa_fisica_p
and	ie_tipo_complemento 	= ie_tipo_complemento_p;

/* Tipo complemento: 
	1               Residencial
	2               Comercial
	4               do Pai
	5               da Mae
	9               Adicional
*/
if (qt_registro_w > 0) then
	
	select	nr_ddi_telefone,
		nr_ddd_telefone,
		nr_telefone,
		ds_email,
		cd_cep,
		nr_seq_pais,
		sg_estado,
		ds_municipio,
		cd_tipo_logradouro,
		ds_endereco,
		coalesce(nr_endereco, ds_compl_end) nr_endereco,
		ds_complemento,
		cd_municipio_ibge,
		ds_bairro,
		dt_atualizacao,
		ds_fone_adic,
		nm_contato
	into STRICT	nr_ddi_telefone_w,
		nr_ddd_telefone_w,
		nr_telefone_w,
		ds_email_w,
		cd_cep_w,
		nr_seq_pais_w,
		sg_estado_w,
		ds_municipio_w,
		ds_tipo_logradouro_w,
		ds_endereco_w,
		nr_endereco_w,
		ds_complemento_w,
		cd_municipio_ibge_w,
		ds_bairro_w,
		dt_atualizacao_w,
		ds_fone_adic_w,
		nm_contato_w
	from	compl_pessoa_fisica
	where	cd_pessoa_fisica 	= cd_pessoa_fisica_p
	and	ie_tipo_complemento 	= ie_tipo_complemento_p  LIMIT 1;
	
	if (ie_opcao_p = 'DDI') then
		ds_retorno_w := nr_ddi_telefone_w;
	elsif (ie_opcao_p = 'DDD') then
		ds_retorno_w := nr_ddd_telefone_w;
	elsif (ie_opcao_p = 'TEL') then
		ds_retorno_w := nr_telefone_w;
	elsif (ie_opcao_p = 'EMAIL') then
		ds_retorno_w := ds_email_w;
	elsif (ie_opcao_p = 'CEP') then
		ds_retorno_w := cd_cep_w;
	elsif (ie_opcao_p = 'PAIS') then
	
		select	max(nm_pais)
		into STRICT	ds_retorno_w
		from	pais y
		where	y.nr_sequencia = nr_seq_pais_w;
	
	elsif (ie_opcao_p = 'UF') then
		ds_retorno_w := sg_estado_w;
	elsif (ie_opcao_p = 'MUN') then
		ds_retorno_w := ds_municipio_w;
	elsif (ie_opcao_p = 'LOG') then
		
		select	max(ds_tipo_logradouro)
		into STRICT	ds_retorno_w
		from	sus_tipo_logradouro x
		where	x.cd_tipo_logradouro = ds_tipo_logradouro_w;
		
	elsif (ie_opcao_p = 'END') then
		ds_retorno_w := ds_endereco_w;
	elsif (ie_opcao_p = 'NR') then
		ds_retorno_w := nr_endereco_w;
	elsif (ie_opcao_p = 'COMP') then
		ds_retorno_w := ds_complemento_w;
	elsif (ie_opcao_p = 'IBGE') then
		ds_retorno_w := cd_municipio_ibge_w;
	elsif (ie_opcao_p = 'BAI') then
		ds_retorno_w := ds_bairro_w;
	elsif (ie_opcao_p = 'ATL') then
		ds_retorno_w := dt_atualizacao_w;
	elsif (ie_opcao_p = 'ADIC') then
		ds_retorno_w := ds_fone_adic_w;
	elsif (ie_opcao_p = 'NM') then
		ds_retorno_w := nm_contato_w;
	end if;

end if;

return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_obj_plussoft_pck.pls_obter_compl_pf ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, ie_tipo_complemento_p compl_pessoa_fisica.ie_tipo_complemento%type, ie_opcao_p text) FROM PUBLIC;
