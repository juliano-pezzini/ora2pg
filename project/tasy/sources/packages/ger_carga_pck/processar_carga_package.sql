-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ger_carga_pck.processar_carga (nr_seq_carga_p bigint, nr_seq_carga_arq_p bigint, nr_sequencia_p bigint, ie_tipo_proc_p text) AS $body$
DECLARE


nr_seq_carga_arq_w	bigint;
nr_sequencia_w		bigint;
nm_usuario_w		varchar(15);


BEGIN

if (coalesce(nr_seq_carga_arq_p,0) > 0) then
	nr_seq_carga_arq_w	:= null;
else
	nr_seq_carga_arq_w	:= nr_seq_carga_arq_p;
end if;

if (coalesce(nr_sequencia_p,0) > 0) then
	nr_sequencia_w	:= null;
else
	nr_sequencia_w	:= nr_sequencia_p;
end if;

CALL wheb_usuario_pck.set_ie_commit('N');
CALL gerar_int_padrao.set_gravar_log_alter_campo('N');
CALL gerar_int_padrao.set_executando_recebimento('S');

select	max(nr_seq_tipo_carga),
	max(ie_atualizar),
	max(nm_usuario)
into STRICT	current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type,
	current_setting('ger_carga_pck.ie_atualizar_w')::varchar(1),
	nm_usuario_w
from	ger_carga_inicial
where	nr_sequencia	= nr_seq_carga_p;

CALL wheb_usuario_pck.set_nm_usuario(nm_usuario_w);
CALL philips_param_pck.set_nr_seq_idioma(obter_nr_seq_idioma(nm_usuario_w));
CALL wheb_usuario_pck.set_cd_estabelecimento(1);

CALL ger_carga_pck.valida_mascara_date(nr_seq_carga_p);



if (current_setting('ger_carga_pck.ie_mascara_date_valida_w')::varchar(1) = 'S') then
	if (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 16) then --Patients
		CALL ger_carga_pck.proc_impnpat(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 17) then --Physicians
		CALL ger_carga_pck.proc_physician(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type in (18,19)) then --Insurances - Legal Entity
		CALL ger_carga_pck.proc_pj_conv(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 20) then --Cases and movements
		CALL ger_carga_pck.proc_impnfal(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 21) then --Insurances related to the patient's case
		CALL ger_carga_pck.proc_impncir(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 23) then --Case diagnosis
		proc_impndia(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 24) then --Case procedures
		proc_impnicp(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 25) then --ICD - Catalog
		IMPORTAR_CID(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 26) then --DRG - Catalog
		IMPORTAR_DRG(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 29) then --Procedures - Catalog
		IMPORTAR_OPS(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 31) then --Procedures price
		CALL ger_carga_pck.importar_preco_proc(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 33) then --Vinculo entre Empresas e Convenios
		CALL ger_carga_pck.importar_vinc_empresa_conv(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 35) then --Link entre cases
		CALL ger_carga_pck.proc_impnffz(nr_seq_carga_p,nr_seq_carga_arq_w, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 47) then -- Catalog Codif
		CALL ger_carga_pck.importar_catalog_codif(nr_seq_carga_p,nr_seq_carga_arq_p, nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 67) then -- Case procedures
        	proc_impnlei(nr_seq_carga_p,nr_sequencia_w,ie_tipo_proc_p);
	elsif (current_setting('ger_carga_pck.nr_seq_tipo_carga_w')::ger_carga_inicial.nr_seq_tipo_carga%type = 60) then -- Case imp_icca_catalog
        	IMP_ICCA_CATALOG(nr_seq_carga_p, nr_seq_carga_arq_p);
	end if;
end if;




update	ger_carga_inicial
set	ie_acao		= 'DONE' --Finalizado
where	nr_sequencia	= nr_seq_carga_p;
commit;

CALL wheb_usuario_pck.set_ie_commit('S');
CALL gerar_int_padrao.set_gravar_log_alter_campo('S');
CALL gerar_int_padrao.set_executando_recebimento('N');


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ger_carga_pck.processar_carga (nr_seq_carga_p bigint, nr_seq_carga_arq_p bigint, nr_sequencia_p bigint, ie_tipo_proc_p text) FROM PUBLIC;
