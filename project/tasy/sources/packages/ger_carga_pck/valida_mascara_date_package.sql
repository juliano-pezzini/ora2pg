-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ger_carga_pck.valida_mascara_date (nr_seq_carga_p bigint) AS $body$
DECLARE


current_setting('ger_carga_pck.ds_mascara_date_w')::ger_carga_arq.ds_mascara_date%type	ger_carga_arq.ds_mascara_date%type;
nr_sequencia_w	ger_carga_arq.nr_sequencia%type;
nr_seq_tipo_arq_w	ger_carga_arq.nr_seq_tipo_arq%type;
dt_teste_w		timestamp;

current_setting('ger_carga_pck.c01')::CURSOR CURSOR FOR
SELECT	ds_mascara_date,
	nr_sequencia,
	nr_seq_tipo_arq
from	ger_carga_arq
where	nr_seq_carga		= nr_seq_carga_p
and	(ds_mascara_date IS NOT NULL AND ds_mascara_date::text <> '');


BEGIN

PERFORM set_config('ger_carga_pck.ie_mascara_date_valida_w', 'S', false);

open current_setting('ger_carga_pck.c01')::CURSOR;
loop
fetch current_setting('ger_carga_pck.c01')::into CURSOR
	current_setting('ger_carga_pck.ds_mascara_date_w')::ger_carga_arq.ds_mascara_date%type,
	nr_sequencia_w,
	nr_seq_tipo_arq_w;
EXIT WHEN NOT FOUND; /* apply on current_setting('ger_carga_pck.c01')::CURSOR */

	begin
	select	to_date(to_char(clock_timestamp(),current_setting('ger_carga_pck.ds_mascara_date_w')::ger_carga_arq.ds_mascara_date%type),current_setting('ger_carga_pck.ds_mascara_date_w')::ger_carga_arq.ds_mascara_date%type)
	into STRICT	dt_teste_w
	;
	exception
	when others then
		PERFORM set_config('ger_carga_pck.ie_mascara_date_valida_w', 'N', false);
		CALL gerar_ger_carga_log_import(
				'LOAD_TASY',
				nr_seq_carga_p,
				12,
				obter_desc_expressao(720213)||' ('||current_setting('ger_carga_pck.ds_mascara_date_w')::ger_carga_arq.ds_mascara_date%type||')', --O formato da mascara de data e invalido.
				null,
				nr_sequencia_w,
				nr_seq_tipo_arq_w,
				null);
	end;

end loop;
close current_setting('ger_carga_pck.c01')::CURSOR;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ger_carga_pck.valida_mascara_date (nr_seq_carga_p bigint) FROM PUBLIC;
