-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_analise_cta_pck.obter_restr_estab_logado () RETURNS varchar AS $body$
DECLARE


ie_analise_conta_medica_w   pls_controle_estab.ie_analise_conta_medica%type;
cd_estabelecimento_w    estabelecimento.cd_estabelecimento%type;
ds_restr_estab_w    varchar(100);


BEGIN
  select  coalesce(max(ie_analise_conta_medica), 'N')  
  into STRICT  ie_analise_conta_medica_w
  from  pls_controle_estab;

  if (ie_analise_conta_medica_w = 'S') then
  
    cd_estabelecimento_w := wheb_usuario_pck.get_cd_estabelecimento;

    ds_restr_estab_w := ' and a.cd_estabelecimento = '||cd_estabelecimento_w;
  else
    ds_restr_estab_w := '';
  end if;

return ds_restr_estab_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_analise_cta_pck.obter_restr_estab_logado () FROM PUBLIC;
