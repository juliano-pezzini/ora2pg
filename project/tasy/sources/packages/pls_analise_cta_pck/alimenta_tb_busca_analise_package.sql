-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_analise_cta_pck.alimenta_tb_busca_analise ( ds_param_busca_p text, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_id_transacao_p INOUT pls_analise_conta_temp.nr_id_transacao%type) AS $body$
DECLARE


dados_filtro_w    table_dados_busca_analise;
ie_select_w   integer;
ds_sql_w    varchar(32000);
valor_bind_w    sql_pck.t_dado_bind;
cursor_w    sql_pck.t_cursor;
nr_sequencia_ult_w  pls_analise_conta.nr_sequencia%type;

idx   integer;

tb_seq_analise_w    pls_util_cta_pck.t_number_table;
tb_cd_guia_w      pls_util_cta_pck.t_varchar2_table_20;
tb_nr_seq_lote_protocolo_w  pls_util_cta_pck.t_number_table;
tb_nr_seq_prestador_w   pls_util_cta_pck.t_number_table;
tb_nm_prestador_f_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nm_cooperativa_w   pls_util_cta_pck.t_varchar2_table_255;
tb_cd_usuario_plano_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nm_segurado_w    pls_util_cta_pck.t_varchar2_table_255;
tb_dt_analise_w     pls_util_cta_pck.t_date_table;
tb_ie_status_w      pls_util_cta_pck.t_varchar2_table_5;
tb_ds_status_w      pls_util_cta_pck.t_varchar2_table_255;
tb_qt_tempo_analise_w   pls_util_cta_pck.t_varchar2_table_255;
tb_ds_origem_analise_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nr_fatura_w      pls_util_cta_pck.t_varchar2_table_255;
tb_nr_nota_cred_deb_w   pls_util_cta_pck.t_varchar2_table_50;
tb_nr_nota_cred_deb_f_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nr_nota_cred_deb_ndr_w pls_util_cta_pck.t_varchar2_table_255;
tb_nr_titulo_receber_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nr_titulo_receber_ndr_w  pls_util_cta_pck.t_varchar2_table_255;
tb_ds_tipo_guia_w   pls_util_cta_pck.t_varchar2_table_255;
tb_vl_cobrado_w     pls_util_cta_pck.t_varchar2_table_255;
tb_dt_atendimento_w   pls_util_cta_pck.t_varchar2_table_255;
tb_origem_analise_w   pls_util_cta_pck.t_varchar2_table_255;
tb_apresentacao_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_analise_ref_w   pls_util_cta_pck.t_number_table;
tb_status_analise_ref_w   pls_util_cta_pck.t_varchar2_table_5;
tb_status_analise_pos_ref_w pls_util_cta_pck.t_varchar2_table_5;
tb_seq_grupo_auditor_w    pls_util_cta_pck.t_number_table;
tb_seq_segurado_w   pls_util_cta_pck.t_number_table;
tb_qt_audit_atual_w   pls_util_cta_pck.t_number_table;
tb_qt_audit_fut_w   pls_util_cta_pck.t_number_table;
tb_vl_liberado_w    pls_util_cta_pck.t_varchar2_table_255;
tb_origem_conta_w   pls_util_cta_pck.t_varchar2_table_5;
tb_ie_tipo_guia_w   pls_util_cta_pck.t_varchar2_table_5;
tb_refaturamento_w    pls_util_cta_pck.t_varchar2_table_5;
tb_vl_lib_pos_estab_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_protocolo_w   pls_util_cta_pck.t_number_table;
tb_cd_condicao_pagamento_w  pls_util_cta_pck.t_number_table;
tb_cd_guia_prestador_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_transacao_w   pls_util_cta_pck.t_number_table;
tb_vl_acatado_w     pls_util_cta_pck.t_number_table;
tb_vl_recursado_w   pls_util_cta_pck.t_number_table;

tb_seq_analise_ins_w    pls_util_cta_pck.t_number_table;
tb_cd_guia_ins_w    pls_util_cta_pck.t_varchar2_table_20;
tb_nr_seq_lote_protocolo_ins_w  pls_util_cta_pck.t_number_table;
tb_nr_seq_prestador_ins_w pls_util_cta_pck.t_number_table;
tb_nm_prestador_f_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nm_cooperativa_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_cd_usuario_plano_ins_w pls_util_cta_pck.t_varchar2_table_255;
tb_nm_segurado_ins_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nm_usuario_w     pls_util_cta_pck.t_varchar2_table_255;
tb_nm_usuario_nrec_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nm_usuario_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nm_usuario_nrec_ins_w  pls_util_cta_pck.t_varchar2_table_255;
tb_dt_analise_ins_w   pls_util_cta_pck.t_date_table;
tb_dt_atualizacao_w   pls_util_cta_pck.t_date_table;
tb_dt_atualizacao_nrec_w  pls_util_cta_pck.t_date_table;
tb_dt_atualizacao_ins_w   pls_util_cta_pck.t_date_table;
tb_dt_atualizacao_nrec_ins_w  pls_util_cta_pck.t_date_table;
tb_ie_status_ins_w    pls_util_cta_pck.t_varchar2_table_5;
tb_ds_status_ins_w    pls_util_cta_pck.t_varchar2_table_255;
tb_qt_tempo_analise_ins_w pls_util_cta_pck.t_varchar2_table_255;
tb_ds_origem_analise_ins_w  pls_util_cta_pck.t_varchar2_table_255;
tb_nr_fatura_ins_w    pls_util_cta_pck.t_varchar2_table_255;
tb_nr_nota_cred_deb_ins_w pls_util_cta_pck.t_varchar2_table_50;
tb_nr_nota_cred_deb_f_ins_w pls_util_cta_pck.t_varchar2_table_255;
tb_nr_nota_cred_deb_ndr_ins_w pls_util_cta_pck.t_varchar2_table_255;
tb_nr_titulo_receber_ins_w  pls_util_cta_pck.t_varchar2_table_255;
tb_nr_titulo_receber_ndr_ins_w  pls_util_cta_pck.t_varchar2_table_255;
tb_ds_tipo_guia_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_vl_cobrado_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_vl_liberado_ins_w    pls_util_cta_pck.t_varchar2_table_255;
tb_dt_atendimento_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_origem_analise_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_apresentacao_ins_w   pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_analise_ref_ins_w pls_util_cta_pck.t_number_table;
tb_status_analise_ref_ins_w pls_util_cta_pck.t_varchar2_table_5;
tb_status_analise_po_ref_ins_w  pls_util_cta_pck.t_varchar2_table_5;
tb_seq_grupo_auditor_ins_w  pls_util_cta_pck.t_number_table;
tb_seq_segurado_ins_w   pls_util_cta_pck.t_number_table;
tb_origem_conta_ins_w   pls_util_cta_pck.t_varchar2_table_5;
tb_ie_tipo_guia_ins_w   pls_util_cta_pck.t_varchar2_table_5;
tb_refaturamento_ins_w    pls_util_cta_pck.t_varchar2_table_5;
ie_status_prot_rec_w    pls_rec_glosa_protocolo.ie_status%type;
ie_analise_valida_w   varchar(1);
tb_dt_prazo_w     pls_util_cta_pck.t_date_table;
tb_dt_prazo_ins_w   pls_util_cta_pck.t_date_table;
tb_vl_lib_pos_estab_ins_w pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_protocolo_ins_w pls_util_cta_pck.t_number_table;
tb_cd_condicao_pagamento_ins_w  pls_util_cta_pck.t_number_table;
tb_cd_guia_prestador_ins_w  pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_transacao_ins_w pls_util_cta_pck.t_number_table;
tb_vl_acatado_ins_w   pls_util_cta_pck.t_number_table;
tb_vl_recursado_ins_w   pls_util_cta_pck.t_number_table;
pos_dt_nenhuma_w    integer;
pos_filtros_analise_w   integer;

BEGIN

-- passa sempre a ?ltima transa??o que foi utilizada, ou seja, a transa??o que existia antes da ?ltima atualiza??o da consulta

if (nr_id_transacao_p IS NOT NULL AND nr_id_transacao_p::text <> '') then
  delete  from pls_analise_conta_temp
  where nr_id_transacao = nr_id_transacao_p;
  commit;
end if;

select  nextval('pls_analise_conta_temp_seq')
into STRICT  nr_id_transacao_p
;

select  position('ie_tipo_data_rg.ItemIndex=0' in ds_param_busca_p),
  -- soma todas as posi??es, se for zero indica que n?o foi selecionado nenhum filtro

  position('nr_seq_analise=' in ds_param_busca_p) +
  position('cd_guia=' in ds_param_busca_p) + 
  position('cd_guia_prest=' in ds_param_busca_p) + 
  position('cd_guia_operadora=' in ds_param_busca_p) + 
  position('nr_seq_fatura=' in ds_param_busca_p) + 
  position('nr_seq_conta=' in ds_param_busca_p) + 
  position('nr_seq_protocolo=' in ds_param_busca_p) + 
  position('nr_seq_lote_analise=' in ds_param_busca_p)
into STRICT  pos_dt_nenhuma_w,
  pos_filtros_analise_w
;

-- se for o tipo de data "Nenhum", e nao tiver o seq da analise informado diretamente tem que parar o processamento

if  (pos_dt_nenhuma_w > 0 AND pos_filtros_analise_w = 0) then

  CALL wheb_mensagem_pck.exibir_mensagem_abort(1219114);
end if;


-- busca os dados da string passada de par?metro e alimenta nas vari?veis correspondentes

dados_filtro_w := pls_analise_cta_pck.obter_filtro_busca_analise(ds_param_busca_p);

-- existem dois selects nessa pesquisa, um para a an?lise normal (ie_select_w = 1) e outro para a an?lise de refer?ncia (ie_select_w = 2).

-- por isso ? criada esta intera??o de duas repeti??es

ie_select_w := 1;
loop
  exit when ie_select_w >= 3;

  valor_bind_w.delete;

  -- obt?m o comando sql juntamente com os bind variables

  valor_bind_w := pls_analise_cta_pck.obter_sql_busca_analise(dados_filtro_w, ie_select_w, nr_id_transacao_p, valor_bind_w);

  -- executa o comando sql com os respectivos binds

  valor_bind_w := sql_pck.executa_sql_cursor(ds_sql_w, valor_bind_w);

  loop
    fetch cursor_w bulk collect into
      tb_seq_analise_w, tb_cd_guia_w, tb_nr_seq_lote_protocolo_w, tb_nr_seq_prestador_w, tb_nm_prestador_f_w
      , tb_nm_cooperativa_w, tb_cd_usuario_plano_w , tb_nm_segurado_w, tb_dt_analise_w
      , tb_ie_status_w, tb_ds_status_w, tb_qt_tempo_analise_w, tb_ds_origem_analise_w
      , tb_nr_fatura_w, tb_nr_nota_cred_deb_w, tb_nr_nota_cred_deb_f_w, tb_nr_nota_cred_deb_ndr_w
      , tb_nr_titulo_receber_w, tb_nr_titulo_receber_ndr_w , tb_ds_tipo_guia_w
      , tb_vl_cobrado_w, tb_dt_atendimento_w, tb_origem_analise_w, tb_apresentacao_w
      , tb_nr_seq_analise_ref_w, tb_status_analise_ref_w, tb_status_analise_pos_ref_w
      , tb_seq_grupo_auditor_w, tb_seq_segurado_w, tb_ie_tipo_guia_w
      , tb_vl_liberado_w, tb_origem_conta_w, tb_nm_usuario_w
      , tb_nm_usuario_nrec_w , tb_dt_atualizacao_w, tb_dt_atualizacao_nrec_w
      , tb_refaturamento_w, tb_dt_prazo_w, tb_vl_lib_pos_estab_w, tb_nr_seq_protocolo_w
      , tb_cd_condicao_pagamento_w, tb_cd_guia_prestador_w, tb_nr_seq_transacao_w, tb_vl_acatado_w
      , tb_vl_recursado_w, tb_qt_audit_atual_w, tb_qt_audit_fut_w
    limit pls_util_cta_pck.qt_registro_transacao_w;

    exit when tb_seq_analise_w.count = 0;
    idx := 0;
    -- Tirar todo mundo nos tratamentos mais pesados.

    for i in tb_seq_analise_w.first .. tb_seq_analise_w.last loop

      ie_analise_valida_w := 'S';
      -- A an?lise de refer?ncia deve estar encerrada se tiver informada.

      if  (((coalesce(tb_nr_seq_analise_ref_w(i)::text, '') = '') or (coalesce(tb_status_analise_ref_w(i), 'T') = 'T' and coalesce(tb_status_analise_pos_ref_w(i), 'T') = 'T') or (tb_origem_analise_w(i) = '4')) and
        -- Quando for para pegar as an?lises pendentes (dados_filtro_w.situacao_analise_rg_ii = 1) ent?o verifica a quantidade de controle para auditoria.

        ((dados_filtro_w.situacao_analise_rg_ii <> 1) or (dados_filtro_w.situacao_analise_rg_ii = 1 and (tb_qt_audit_atual_w(i) > 0 or tb_qt_audit_fut_w(i) > 0))
         )) then
        
        --Quando retornar an?lise de p?s para recurso, ent?o somente exibir? a an?lise caso o protocolo do recurso estiver com status entre(Liberado ou pagamento efetuado) 

        --Verifica atrav?s das contas de p?s, se alguma conta esta em um lote

        if (tb_origem_analise_w(i) = 8) then
          select  max(ie_status)
          into STRICT  ie_status_prot_rec_w
          from  pls_rec_glosa_protocolo
          where nr_sequencia = ( SELECT max(nr_seq_protocolo)
                 from pls_rec_glosa_conta
                 where  nr_seq_conta = ( select max(nr_seq_conta)
                       from pls_conta_pos_estabelecido
                       where  nr_seq_analise = tb_seq_analise_w(i)));

          --An?lise somente ser? exibida, caso o status do recurso estiver como liberado para pagamento ou como pagamento efetuado.

          if (coalesce(ie_status_prot_rec_w::text, '') = '' or ie_status_prot_rec_w not in (3,6)) then
            ie_analise_valida_w := 'N';
          end if;

        end if;
        
        if (ie_analise_valida_w = 'S') then
          tb_seq_analise_ins_w(idx)   := tb_seq_analise_w(i);
          tb_cd_guia_ins_w(idx)     := tb_cd_guia_w(i);
          tb_nr_seq_lote_protocolo_ins_w(idx) := tb_nr_seq_lote_protocolo_w(i);
          tb_nr_seq_prestador_ins_w(idx)    := tb_nr_seq_prestador_w(i);
          tb_nm_prestador_f_ins_w(idx)    := tb_nm_prestador_f_w(i);
          tb_nm_cooperativa_ins_w(idx)    := tb_nm_cooperativa_w(i);
          tb_cd_usuario_plano_ins_w(idx)    := tb_cd_usuario_plano_w(i);
          tb_nm_segurado_ins_w(idx)   := tb_nm_segurado_w(i);
          tb_dt_analise_ins_w(idx)    := tb_dt_analise_w(i);
          tb_ie_status_ins_w(idx)     := tb_ie_status_w(i);
          tb_ds_status_ins_w(idx)     := tb_ds_status_w(i);
          tb_qt_tempo_analise_ins_w(idx)    := tb_qt_tempo_analise_w(i);
          tb_ds_origem_analise_ins_w(idx)   := tb_ds_origem_analise_w(i);
          tb_nr_fatura_ins_w(idx)     := tb_nr_fatura_w(i);
          tb_nr_nota_cred_deb_ins_w(idx)    := tb_nr_nota_cred_deb_w(i);
          tb_nr_nota_cred_deb_f_ins_w(idx)  := tb_nr_nota_cred_deb_f_w(i);
          tb_nr_nota_cred_deb_ndr_ins_w(idx)  := tb_nr_nota_cred_deb_ndr_w(i);
          tb_nr_titulo_receber_ins_w(idx)   := tb_nr_titulo_receber_w(i);
          tb_nr_titulo_receber_ndr_ins_w(idx) := tb_nr_titulo_receber_ndr_w(i);
          tb_ds_tipo_guia_ins_w(idx)    := tb_ds_tipo_guia_w(i);
          tb_vl_cobrado_ins_w(idx)    := tb_vl_cobrado_w(i);
          tb_dt_atendimento_ins_w(idx)    := tb_dt_atendimento_w(i);
          tb_origem_analise_ins_w(idx)    := tb_origem_analise_w(i);
          tb_apresentacao_ins_w(idx)    := tb_apresentacao_w(i);
          tb_nr_seq_analise_ref_ins_w(idx)  := tb_nr_seq_analise_ref_w(i);
          tb_status_analise_ref_ins_w(idx)  := tb_status_analise_ref_w(i);
          tb_status_analise_po_ref_ins_w(idx) := tb_status_analise_pos_ref_w(i);
          tb_seq_grupo_auditor_ins_w(idx)   := tb_seq_grupo_auditor_w(i);
          tb_seq_segurado_ins_w(idx)    := tb_seq_segurado_w(i);
          tb_origem_conta_ins_w(idx)    := tb_origem_conta_w(i);
          tb_nm_usuario_ins_w(idx)    := tb_nm_usuario_w(i);
          tb_nm_usuario_nrec_ins_w(idx)   := tb_nm_usuario_nrec_w(i);
          tb_dt_atualizacao_ins_w(idx)    := tb_dt_atualizacao_w(i);
          tb_dt_atualizacao_nrec_ins_w(idx) := tb_dt_atualizacao_nrec_w(i);
          tb_ie_tipo_guia_ins_w(idx)    := tb_ie_tipo_guia_w(i);
          tb_vl_liberado_ins_w(idx)   := tb_vl_liberado_w(i);
          tb_refaturamento_ins_w(idx)   := tb_refaturamento_w(i);
          tb_dt_prazo_ins_w(idx)      := tb_dt_prazo_w(i);
          tb_vl_lib_pos_estab_ins_w(idx)    := tb_vl_lib_pos_estab_w(i);
          tb_nr_seq_protocolo_ins_w(idx)    := tb_nr_seq_protocolo_w(i);
          tb_cd_condicao_pagamento_ins_w(idx) := tb_cd_condicao_pagamento_w(i);
          tb_cd_guia_prestador_ins_w(idx)   := tb_cd_guia_prestador_w(i);
          tb_nr_seq_transacao_ins_w(idx)    := tb_nr_seq_transacao_w(i);
          tb_vl_acatado_ins_w(idx)    := tb_vl_acatado_w(i);
          tb_vl_recursado_ins_w(idx)    := tb_vl_recursado_w(i);
          idx := idx + 1;
        end if;
      end if;
    end loop;

    -- Insere todos os registros das listas na tabela de sele??o

    forall i in tb_seq_analise_ins_w.first .. tb_seq_analise_ins_w.last 
      insert into pls_analise_conta_temp(cd_estabelecimento, cd_guia, cd_usuario_plano
        , ds_apresentacao, ds_origem_analise, ds_status
        , ds_tipo_guia, ds_vl_apresentado, dt_analise
        , dt_atendimento, dt_atualizacao, dt_atualizacao_nrec
        , ie_origem_analise, ie_status, nm_cooperativa
        , nm_prestador_f, nm_segurado, nm_usuario
        , nm_usuario_nrec, nr_fatura_f, nr_id_transacao
        , nr_nota_credito_debito, nr_nota_credito_debito_f, nr_nota_credito_debito_ndr_f
        , nr_seq_lote_protocolo, nr_seq_prestador, nr_sequencia
        , nr_titulo_receber_f, nr_titulo_receber_ndr_f, qt_tempo_analise
        , nr_seq_grupo_auditor, nr_seq_segurado, ie_origem_conta
        , ie_tipo_guia, dt_controle_del, vl_liberado
        , ie_refaturamento, dt_prazo_analise, vl_lib_pos_estab
        , nr_seq_protocolo, cd_condicao_pagamento, cd_guia_prestador
        , nr_seq_transacao, vl_acatado, vl_recursado)

      values ( cd_estabelecimento_p, tb_cd_guia_ins_w(i), tb_cd_usuario_plano_ins_w(i)
        , tb_apresentacao_ins_w(i), tb_ds_origem_analise_ins_w(i), tb_ds_status_ins_w(i)
        , tb_ds_tipo_guia_ins_w(i), tb_vl_cobrado_ins_w(i), tb_dt_analise_ins_w(i)
        , tb_dt_atendimento_ins_w(i), tb_dt_atualizacao_ins_w(i), tb_dt_atualizacao_nrec_ins_w(i)
        , tb_origem_analise_ins_w(i), tb_ie_status_ins_w(i), tb_nm_cooperativa_ins_w(i)
        , tb_nm_prestador_f_ins_w(i), tb_nm_segurado_ins_w(i), tb_nm_usuario_ins_w(i)
        , tb_nm_usuario_nrec_ins_w(i), tb_nr_fatura_ins_w(i), nr_id_transacao_p
        , tb_nr_nota_cred_deb_ins_w(i), tb_nr_nota_cred_deb_f_ins_w(i), tb_nr_nota_cred_deb_ndr_ins_w(i)
        , tb_nr_seq_lote_protocolo_ins_w(i), tb_nr_seq_prestador_ins_w(i), tb_seq_analise_ins_w(i)
        , tb_nr_titulo_receber_ins_w(i), tb_nr_titulo_receber_ndr_ins_w(i), tb_qt_tempo_analise_ins_w(i)
        , tb_seq_grupo_auditor_ins_w(i), tb_seq_segurado_ins_w(i), tb_origem_conta_ins_w(i)
        , tb_ie_tipo_guia_ins_w(i), clock_timestamp(), tb_vl_liberado_ins_w(i)
        , tb_refaturamento_ins_w(i), tb_dt_prazo_ins_w(i), tb_vl_lib_pos_estab_ins_w(i)
        , tb_nr_seq_protocolo_ins_w(i), tb_cd_condicao_pagamento_ins_w(i), tb_cd_guia_prestador_ins_w(i)
        , tb_nr_seq_transacao_ins_w(i), tb_vl_acatado_ins_w(i), tb_vl_recursado_ins_w(i));
    commit;

    tb_seq_analise_ins_w.delete;
    tb_cd_guia_ins_w.delete;
    tb_nr_seq_lote_protocolo_ins_w.delete;
    tb_nr_seq_prestador_ins_w.delete;
    tb_nm_prestador_f_ins_w.delete;
    tb_nm_cooperativa_ins_w.delete;
    tb_cd_usuario_plano_ins_w.delete;
    tb_nm_segurado_ins_w.delete;
    tb_dt_analise_ins_w.delete;
    tb_ie_status_ins_w.delete;
    tb_ds_status_ins_w.delete;
    tb_qt_tempo_analise_ins_w.delete;
    tb_ds_origem_analise_ins_w.delete;
    tb_nr_fatura_ins_w.delete;
    tb_nr_nota_cred_deb_ins_w.delete;
    tb_nr_nota_cred_deb_f_ins_w.delete;
    tb_nr_nota_cred_deb_ndr_ins_w.delete;
    tb_nr_titulo_receber_ins_w.delete;
    tb_nr_titulo_receber_ndr_ins_w.delete;
    tb_ds_tipo_guia_ins_w.delete;
    tb_vl_cobrado_ins_w.delete;
    tb_dt_atendimento_ins_w.delete;
    tb_origem_analise_ins_w.delete;
    tb_apresentacao_ins_w.delete;
    tb_nr_seq_analise_ref_ins_w.delete;
    tb_status_analise_ref_ins_w.delete;
    tb_status_analise_po_ref_ins_w.delete;
    tb_seq_grupo_auditor_ins_w.delete;
    tb_seq_segurado_ins_w.delete;
    tb_origem_conta_ins_w.delete;
    tb_dt_atualizacao_w.delete;
    tb_dt_atualizacao_nrec_w.delete;
    tb_nm_usuario_ins_w.delete;
    tb_nm_usuario_nrec_ins_w.delete;
    tb_dt_atualizacao_ins_w.delete;
    tb_dt_atualizacao_nrec_ins_w.delete;
    tb_vl_liberado_ins_w.delete;
    tb_refaturamento_ins_w.delete;
    tb_dt_prazo_ins_w.delete;
    tb_vl_lib_pos_estab_ins_w.delete;
    tb_nr_seq_protocolo_ins_w.delete;
    tb_cd_condicao_pagamento_ins_w.delete;
    tb_cd_guia_prestador_ins_w.delete;
    tb_nr_seq_transacao_ins_w.delete;
    tb_vl_acatado_ins_w.delete;
    tb_vl_recursado_ins_w.delete;
  end loop;
  close cursor_w;

  -- se for filtro pela an?lise s? precisa executar uma vez

  if (dados_filtro_w.nr_seq_analise IS NOT NULL AND dados_filtro_w.nr_seq_analise::text <> '') then
    ie_select_w := 3;
  else
    ie_select_w := ie_select_w + 1;
  end if;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_analise_cta_pck.alimenta_tb_busca_analise ( ds_param_busca_p text, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_id_transacao_p INOUT pls_analise_conta_temp.nr_id_transacao%type) FROM PUBLIC;
