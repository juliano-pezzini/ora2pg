-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_analise_cta_pck.obter_cond_pagto ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_analise_p pls_analise_conta.nr_sequencia%type) RETURNS bigint AS $body$
DECLARE


cd_cond_pgto_w  pls_prestador_pagto.cd_condicao_pagamento%type;


BEGIN

  select  max(w.cd_condicao_pagamento)
  into STRICT cd_cond_pgto_w
  from (SELECT  x.cd_condicao_pagamento,  
    y.nr_seq_analise  
    from    pls_conta     y,   
    pls_prestador_pagto   x   
    where  x.nr_seq_prestador   = y.nr_seq_prestador_exec  
  --  and y.nr_sequencia = nr_seq_conta_p  

  and y.nr_seq_analise = nr_seq_analise_p 
    and    y.dt_atendimento_referencia between x.dt_inicio_vigencia_ref and dt_fim_vigencia_ref   
    
union all
   
    SELECT  x.cd_condicao_pagamento,  
    y.nr_seq_analise  
    from    pls_conta     y,  
    pls_prestador_pagto   x,   
    pls_conta_proc     w,   
    pls_proc_participante   z  
    where  w.nr_seq_conta = y.nr_sequencia 
    --and y.nr_sequencia = nr_seq_conta_p  

    and y.nr_seq_analise = nr_seq_analise_p
   and   z.nr_seq_conta_proc   = w.nr_sequencia 
    and    x.nr_seq_prestador   = coalesce(z.nr_seq_prestador_pgto, z.nr_seq_prestador)  
    and    y.dt_atendimento_referencia between x.dt_inicio_vigencia_ref and dt_fim_vigencia_ref   
    
union all
 
    select  x.cd_condicao_pagamento,  
    y.nr_seq_analise  
    from    pls_conta    y, 
    pls_prestador_pagto  x, 
    pls_conta_medica_resumo  z  
    where  z.nr_seq_conta    = y.nr_sequencia 
   -- and y.nr_sequencia = nr_seq_conta_p  

   and y.nr_seq_analise = nr_seq_analise_p
    and    x.nr_seq_prestador  = z.nr_seq_prestador_pgto  
    and    y.dt_atendimento_referencia between x.dt_inicio_vigencia_ref and dt_fim_vigencia_ref) w, 
    pls_analise_conta_ap_v  ww  
  where  ww.nr_sequencia    = nr_seq_analise_p  
  and  ww.nr_sequencia    = w.nr_seq_analise;


return cd_cond_pgto_w;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_analise_cta_pck.obter_cond_pagto ( nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_analise_p pls_analise_conta.nr_sequencia%type) FROM PUBLIC;
