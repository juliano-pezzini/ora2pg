-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Obter prestador por conta
CREATE OR REPLACE PROCEDURE pls_alimenta_tb_tmp.gerar_prestador_cta (nr_seq_lote_p pls_lote_protocolo.nr_sequencia%type, nr_seq_protocolo_p pls_protocolo_conta.nr_sequencia%type, nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_lote_processo_p pls_cta_lote_processo.nr_sequencia%type, nr_seq_analise_p pls_analise_conta.nr_sequencia%type) AS $body$
DECLARE


_ora2pg_r RECORD;
nr_contador_w			integer := 0;
tb_nr_seq_prestador_w		pls_util_cta_pck.t_number_table;
tb_cd_prestador_w		pls_util_cta_pck.t_varchar2_table_50;
tb_ie_tipo_pessoa_prest_w	pls_util_cta_pck.t_varchar2_table_5;
tb_nr_seq_classificacao_w	pls_util_cta_pck.t_number_table;
tb_ie_tipo_prestador_w		pls_util_cta_pck.t_varchar2_table_5;
tb_nr_seq_lote_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_protocolo_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_conta_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_prest_inter_w		pls_util_cta_pck.t_number_table;
tb_null_w			pls_util_cta_pck.t_number_table;
tb_nr_seq_analise_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_lote_processo_w	pls_util_cta_pck.t_number_table;

-- Contas por lote de protocolo
c01 CURSOR(	nr_seq_lote_pc		pls_lote_protocolo.nr_sequencia%type) FOR
	SELECT	p.nr_sequencia nr_seq_prestador, -- Executor
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PE' ie_tipo_prestador,
		l.nr_sequencia nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_conta		c,
		pls_protocolo_conta	l,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_exec
	and	l.nr_seq_lote	= nr_seq_lote_pc
	
union all

	SELECT	p.nr_sequencia nr_seq_prestador, -- Solicitante
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PS' ie_tipo_prestador,
		l.nr_sequencia nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_conta		c,
		pls_protocolo_conta	l,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_solic_ref
	and	l.nr_seq_lote	= nr_seq_lote_pc
	
union all

	select	null nr_seq_prestador, -- Intercâmbio
		p.nr_sequencia nr_seq_prest_inter,
		null cd_prestador,
		CASE WHEN coalesce(p.cd_cgc_intercambio::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		null nr_seq_classificacao,
		'PIC' ie_tipo_prestador,
		l.nr_sequencia nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_conta			c,
		pls_protocolo_conta		l,
		pls_prestador_intercambio	p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prest_inter
	and	l.nr_seq_lote	= nr_seq_lote_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Executor IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PEM' ie_tipo_prestador,
		l.nr_sequencia nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_conta		c,
		pls_protocolo_conta	l,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_exec_imp_ref
	and	l.nr_seq_lote	= nr_seq_lote_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Solicitante IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PSM' ie_tipo_prestador,
		l.nr_sequencia nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_conta		c,
		pls_protocolo_conta	l,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_imp_ref
	and	l.nr_seq_lote	= nr_seq_lote_pc;

-- Contas por protocolo
c02 CURSOR(	nr_seq_protocolo_pc	pls_protocolo_conta.nr_sequencia%type) FOR
	SELECT	p.nr_sequencia nr_seq_prestador, -- Executor
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PE' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec
	and	c.nr_seq_protocolo	= nr_seq_protocolo_pc
	
union all

	SELECT	p.nr_sequencia nr_seq_prestador, -- Solicitante
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PS' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_solic_ref
	and	c.nr_seq_protocolo	= nr_seq_protocolo_pc
	
union all

	select	null nr_seq_prestador, -- Intercâmbio
		p.nr_sequencia nr_seq_prest_inter,
		null cd_prestador,
		CASE WHEN coalesce(p.cd_cgc_intercambio::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		null nr_seq_classificacao,
		'PIC' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta			c,
		pls_prestador_intercambio	p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prest_inter
	and	c.nr_seq_protocolo	= nr_seq_protocolo_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Executor IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PEM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec_imp_ref
	and	c.nr_seq_protocolo	= nr_seq_protocolo_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Solicitante IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PSM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_imp_ref
	and	c.nr_seq_protocolo	= nr_seq_protocolo_pc;

-- Contas
c03 CURSOR(	nr_seq_conta_pc		pls_conta.nr_sequencia%type) FOR
	SELECT	p.nr_sequencia nr_seq_prestador, -- Executor
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PE' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_exec
	and	c.nr_sequencia	= nr_seq_conta_pc
	
union all

	SELECT	p.nr_sequencia nr_seq_prestador, -- Solicitante
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PS' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_solic_ref
	and	c.nr_sequencia	= nr_seq_conta_pc
	
union all

	select	null nr_seq_prestador, -- Intercâmbio
		p.nr_sequencia nr_seq_prest_inter,
		null cd_prestador,
		CASE WHEN coalesce(p.cd_cgc_intercambio::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		null nr_seq_classificacao,
		'PIC' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta		l,
		pls_conta			c,
		pls_prestador_intercambio	p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prest_inter
	and	c.nr_sequencia	= nr_seq_conta_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Executor IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PEM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_exec_imp_ref
	and	c.nr_sequencia	= nr_seq_conta_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Solicitante IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PSM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia	= c.nr_seq_protocolo
	and	p.nr_sequencia	= c.nr_seq_prestador_imp_ref
	and	c.nr_sequencia	= nr_seq_conta_pc;

-- Analise
c04 CURSOR(	nr_seq_analise_pc		pls_analise_conta.nr_sequencia%type) FOR
	SELECT	p.nr_sequencia nr_seq_prestador, -- Executor
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PE' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec
	and	c.nr_seq_analise	= nr_seq_analise_pc
	
union all

	SELECT	p.nr_sequencia nr_seq_prestador, -- Solicitante
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PS' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_solic_ref
	and	c.nr_seq_analise	= nr_seq_analise_pc
	
union all

	select	null nr_seq_prestador, -- Intercâmbio
		p.nr_sequencia nr_seq_prest_inter,
		null cd_prestador,
		CASE WHEN coalesce(p.cd_cgc_intercambio::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		null nr_seq_classificacao,
		'PIC' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta		l,
		pls_conta			c,
		pls_prestador_intercambio	p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prest_inter
	and	c.nr_seq_analise	= nr_seq_analise_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Executor IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PEM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec_imp_ref
	and	c.nr_seq_analise	= nr_seq_analise_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Solicitante IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PSM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		null
	from	pls_protocolo_conta	l,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_imp_ref
	and	c.nr_seq_analise	= nr_seq_analise_pc;

-- Lote de processos
c05 CURSOR(	nr_seq_lote_processo_pc		pls_cta_lote_processo.nr_sequencia%type) FOR
	SELECT	p.nr_sequencia nr_seq_prestador, -- Executor
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PE' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		nr_seq_lote_processo_pc nr_seq_lote_processo_p,
		null
	from	pls_protocolo_conta	l,
		pls_cta_lote_proc_conta	y,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec
	and	c.nr_sequencia		= y.nr_seq_conta
	and	y.nr_seq_lote_processo	= nr_seq_lote_processo_pc
	
union all

	SELECT	p.nr_sequencia nr_seq_prestador, -- Solicitante
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PS' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		nr_seq_lote_processo_pc nr_seq_lote_processo_p,
		null
	from	pls_protocolo_conta	l,
		pls_cta_lote_proc_conta	y,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_solic_ref
	and	c.nr_sequencia		= y.nr_seq_conta
	and	y.nr_seq_lote_processo	= nr_seq_lote_processo_pc
	
union all

	select	null nr_seq_prestador, -- Intercâmbio
		p.nr_sequencia nr_seq_prest_inter,
		null cd_prestador,
		CASE WHEN coalesce(p.cd_cgc_intercambio::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		null nr_seq_classificacao,
		'PIC' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		nr_seq_lote_processo_pc nr_seq_lote_processo_p,
		null
	from	pls_protocolo_conta		l,
		pls_cta_lote_proc_conta		y,
		pls_conta			c,
		pls_prestador_intercambio	p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prest_inter
	and	c.nr_sequencia		= y.nr_seq_conta
	and	y.nr_seq_lote_processo	= nr_seq_lote_processo_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Executor IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PEM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		nr_seq_lote_processo_pc nr_seq_lote_processo_p,
		null
	from	pls_protocolo_conta	l,
		pls_cta_lote_proc_conta	y,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_exec_imp_ref
	and	c.nr_sequencia		= y.nr_seq_conta
	and	y.nr_seq_lote_processo	= nr_seq_lote_processo_pc
	
union all

	select	p.nr_sequencia nr_seq_prestador, -- Solicitante IMP
		null nr_seq_prest_inter,
		p.cd_prestador,
		CASE WHEN coalesce(p.cd_cgc::text, '') = '' THEN 'PF'  ELSE 'PJ' END  ie_tipo_pessoa_prest,
		p.nr_seq_classificacao,
		'PSM' ie_tipo_prestador,
		c.nr_seq_protocolo,
		c.nr_sequencia nr_seq_conta,
		c.nr_seq_analise,
		l.nr_seq_lote,
		nr_seq_lote_processo_pc nr_seq_lote_processo_p,
		null
	from	pls_protocolo_conta	l,
		pls_cta_lote_proc_conta	y,
		pls_conta		c,
		pls_prestador		p
	where	l.nr_sequencia		= c.nr_seq_protocolo
	and	p.nr_sequencia		= c.nr_seq_prestador_imp_ref
	and	c.nr_sequencia		= y.nr_seq_conta
	and	y.nr_seq_lote_processo	= nr_seq_lote_processo_pc;


BEGIN

if (nr_seq_lote_p IS NOT NULL AND nr_seq_lote_p::text <> '') then
	-- Contas por lote de protocolo
	open c01( nr_seq_lote_p );
	loop
	fetch c01 bulk collect into	tb_nr_seq_prestador_w,
					tb_nr_seq_prest_inter_w,
					tb_cd_prestador_w,
					tb_ie_tipo_pessoa_prest_w,
					tb_nr_seq_classificacao_w,
					tb_ie_tipo_prestador_w,
					tb_nr_seq_protocolo_w,
					tb_nr_seq_conta_w,
					tb_nr_seq_analise_w,
					tb_nr_seq_lote_w,
					tb_null_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_seq_prestador_w.count = 0;

		SELECT * FROM pls_alimenta_tb_tmp.inserir_prestador(	nr_contador_w, tb_nr_seq_prestador_w, tb_nr_seq_lote_w, tb_nr_seq_protocolo_w, tb_nr_seq_conta_w, tb_null_w, tb_null_w, tb_cd_prestador_w, tb_ie_tipo_pessoa_prest_w, tb_nr_seq_classificacao_w, tb_ie_tipo_prestador_w, tb_nr_seq_prest_inter_w, tb_null_w, tb_nr_seq_analise_w, tb_null_w) INTO STRICT _ora2pg_r;
 	nr_contador_w := _ora2pg_r.nr_contador_p; tb_nr_seq_prestador_w := _ora2pg_r.tb_nr_seq_prestador_p; tb_nr_seq_lote_w := _ora2pg_r.tb_nr_seq_lote_p; tb_nr_seq_protocolo_w := _ora2pg_r.tb_nr_seq_protocolo_p; tb_nr_seq_conta_w := _ora2pg_r.tb_nr_seq_conta_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_proc_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_mat_p; tb_cd_prestador_w := _ora2pg_r.tb_cd_prestador_p; tb_ie_tipo_pessoa_prest_w := _ora2pg_r.tb_ie_tipo_pessoa_prest_p; tb_nr_seq_classificacao_w := _ora2pg_r.tb_nr_seq_classificacao_p; tb_ie_tipo_prestador_w := _ora2pg_r.tb_ie_tipo_prestador_p; tb_nr_seq_prest_inter_w := _ora2pg_r.tb_nr_seq_prest_inter_p; tb_null_w := _ora2pg_r.tb_nr_seq_proc_partic_p; tb_nr_seq_analise_w := _ora2pg_r.tb_nr_seq_analise_p; tb_null_w := _ora2pg_r.tb_nr_seq_lote_processo_p;
	end loop;

elsif (nr_seq_protocolo_p IS NOT NULL AND nr_seq_protocolo_p::text <> '') then

	open c02(nr_seq_protocolo_p);
	loop

	fetch c02 bulk collect into	tb_nr_seq_prestador_w,
					tb_nr_seq_prest_inter_w,
					tb_cd_prestador_w,
					tb_ie_tipo_pessoa_prest_w,
					tb_nr_seq_classificacao_w,
					tb_ie_tipo_prestador_w,
					tb_nr_seq_protocolo_w,
					tb_nr_seq_conta_w,
					tb_nr_seq_analise_w,
					tb_nr_seq_lote_w,
					tb_null_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_seq_prestador_w.count = 0;

		SELECT * FROM pls_alimenta_tb_tmp.inserir_prestador(	nr_contador_w, tb_nr_seq_prestador_w, tb_nr_seq_lote_w, tb_nr_seq_protocolo_w, tb_nr_seq_conta_w, tb_null_w, tb_null_w, tb_cd_prestador_w, tb_ie_tipo_pessoa_prest_w, tb_nr_seq_classificacao_w, tb_ie_tipo_prestador_w, tb_nr_seq_prest_inter_w, tb_null_w, tb_nr_seq_analise_w, tb_null_w) INTO STRICT _ora2pg_r;
 	nr_contador_w := _ora2pg_r.nr_contador_p; tb_nr_seq_prestador_w := _ora2pg_r.tb_nr_seq_prestador_p; tb_nr_seq_lote_w := _ora2pg_r.tb_nr_seq_lote_p; tb_nr_seq_protocolo_w := _ora2pg_r.tb_nr_seq_protocolo_p; tb_nr_seq_conta_w := _ora2pg_r.tb_nr_seq_conta_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_proc_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_mat_p; tb_cd_prestador_w := _ora2pg_r.tb_cd_prestador_p; tb_ie_tipo_pessoa_prest_w := _ora2pg_r.tb_ie_tipo_pessoa_prest_p; tb_nr_seq_classificacao_w := _ora2pg_r.tb_nr_seq_classificacao_p; tb_ie_tipo_prestador_w := _ora2pg_r.tb_ie_tipo_prestador_p; tb_nr_seq_prest_inter_w := _ora2pg_r.tb_nr_seq_prest_inter_p; tb_null_w := _ora2pg_r.tb_nr_seq_proc_partic_p; tb_nr_seq_analise_w := _ora2pg_r.tb_nr_seq_analise_p; tb_null_w := _ora2pg_r.tb_nr_seq_lote_processo_p;
	end loop;

elsif (nr_seq_conta_p IS NOT NULL AND nr_seq_conta_p::text <> '') then


	open c03(nr_seq_conta_p);
	loop
	fetch c03 bulk collect into	tb_nr_seq_prestador_w,
					tb_nr_seq_prest_inter_w,
					tb_cd_prestador_w,
					tb_ie_tipo_pessoa_prest_w,
					tb_nr_seq_classificacao_w,
					tb_ie_tipo_prestador_w,
					tb_nr_seq_protocolo_w,
					tb_nr_seq_conta_w,
					tb_nr_seq_analise_w,
					tb_nr_seq_lote_w,
					tb_null_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_seq_prestador_w.count = 0;

		SELECT * FROM pls_alimenta_tb_tmp.inserir_prestador(	nr_contador_w, tb_nr_seq_prestador_w, tb_nr_seq_lote_w, tb_nr_seq_protocolo_w, tb_nr_seq_conta_w, tb_null_w, tb_null_w, tb_cd_prestador_w, tb_ie_tipo_pessoa_prest_w, tb_nr_seq_classificacao_w, tb_ie_tipo_prestador_w, tb_nr_seq_prest_inter_w, tb_null_w, tb_nr_seq_analise_w, tb_null_w) INTO STRICT _ora2pg_r;
 	nr_contador_w := _ora2pg_r.nr_contador_p; tb_nr_seq_prestador_w := _ora2pg_r.tb_nr_seq_prestador_p; tb_nr_seq_lote_w := _ora2pg_r.tb_nr_seq_lote_p; tb_nr_seq_protocolo_w := _ora2pg_r.tb_nr_seq_protocolo_p; tb_nr_seq_conta_w := _ora2pg_r.tb_nr_seq_conta_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_proc_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_mat_p; tb_cd_prestador_w := _ora2pg_r.tb_cd_prestador_p; tb_ie_tipo_pessoa_prest_w := _ora2pg_r.tb_ie_tipo_pessoa_prest_p; tb_nr_seq_classificacao_w := _ora2pg_r.tb_nr_seq_classificacao_p; tb_ie_tipo_prestador_w := _ora2pg_r.tb_ie_tipo_prestador_p; tb_nr_seq_prest_inter_w := _ora2pg_r.tb_nr_seq_prest_inter_p; tb_null_w := _ora2pg_r.tb_nr_seq_proc_partic_p; tb_nr_seq_analise_w := _ora2pg_r.tb_nr_seq_analise_p; tb_null_w := _ora2pg_r.tb_nr_seq_lote_processo_p;
	end loop;

elsif (nr_seq_analise_p IS NOT NULL AND nr_seq_analise_p::text <> '') then
	-- Analise
	open c04(nr_seq_analise_p);
	loop
	fetch c04 bulk collect into	tb_nr_seq_prestador_w,
					tb_nr_seq_prest_inter_w,
					tb_cd_prestador_w,
					tb_ie_tipo_pessoa_prest_w,
					tb_nr_seq_classificacao_w,
					tb_ie_tipo_prestador_w,
					tb_nr_seq_protocolo_w,
					tb_nr_seq_conta_w,
					tb_nr_seq_analise_w,
					tb_nr_seq_lote_w,
					tb_null_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_seq_prestador_w.count = 0;

		SELECT * FROM pls_alimenta_tb_tmp.inserir_prestador(	nr_contador_w, tb_nr_seq_prestador_w, tb_nr_seq_lote_w, tb_nr_seq_protocolo_w, tb_nr_seq_conta_w, tb_null_w, tb_null_w, tb_cd_prestador_w, tb_ie_tipo_pessoa_prest_w, tb_nr_seq_classificacao_w, tb_ie_tipo_prestador_w, tb_nr_seq_prest_inter_w, tb_null_w, tb_nr_seq_analise_w, tb_null_w) INTO STRICT _ora2pg_r;
 	nr_contador_w := _ora2pg_r.nr_contador_p; tb_nr_seq_prestador_w := _ora2pg_r.tb_nr_seq_prestador_p; tb_nr_seq_lote_w := _ora2pg_r.tb_nr_seq_lote_p; tb_nr_seq_protocolo_w := _ora2pg_r.tb_nr_seq_protocolo_p; tb_nr_seq_conta_w := _ora2pg_r.tb_nr_seq_conta_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_proc_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_mat_p; tb_cd_prestador_w := _ora2pg_r.tb_cd_prestador_p; tb_ie_tipo_pessoa_prest_w := _ora2pg_r.tb_ie_tipo_pessoa_prest_p; tb_nr_seq_classificacao_w := _ora2pg_r.tb_nr_seq_classificacao_p; tb_ie_tipo_prestador_w := _ora2pg_r.tb_ie_tipo_prestador_p; tb_nr_seq_prest_inter_w := _ora2pg_r.tb_nr_seq_prest_inter_p; tb_null_w := _ora2pg_r.tb_nr_seq_proc_partic_p; tb_nr_seq_analise_w := _ora2pg_r.tb_nr_seq_analise_p; tb_null_w := _ora2pg_r.tb_nr_seq_lote_processo_p;
	end loop;

elsif (nr_seq_lote_processo_p IS NOT NULL AND nr_seq_lote_processo_p::text <> '') then
	-- Lote de processos
	open c05(nr_seq_lote_processo_p);
	loop
	fetch c05 bulk collect into	tb_nr_seq_prestador_w,
					tb_nr_seq_prest_inter_w,
					tb_cd_prestador_w,
					tb_ie_tipo_pessoa_prest_w,
					tb_nr_seq_classificacao_w,
					tb_ie_tipo_prestador_w,
					tb_nr_seq_protocolo_w,
					tb_nr_seq_conta_w,
					tb_nr_seq_analise_w,
					tb_nr_seq_lote_w,
					tb_nr_seq_lote_processo_w,
					tb_null_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_seq_prestador_w.count = 0;

		SELECT * FROM pls_alimenta_tb_tmp.inserir_prestador(	nr_contador_w, tb_nr_seq_prestador_w, tb_nr_seq_lote_w, tb_nr_seq_protocolo_w, tb_nr_seq_conta_w, tb_null_w, tb_null_w, tb_cd_prestador_w, tb_ie_tipo_pessoa_prest_w, tb_nr_seq_classificacao_w, tb_ie_tipo_prestador_w, tb_nr_seq_prest_inter_w, tb_null_w, tb_nr_seq_analise_w, tb_nr_seq_lote_processo_w) INTO STRICT _ora2pg_r;
 	nr_contador_w := _ora2pg_r.nr_contador_p; tb_nr_seq_prestador_w := _ora2pg_r.tb_nr_seq_prestador_p; tb_nr_seq_lote_w := _ora2pg_r.tb_nr_seq_lote_p; tb_nr_seq_protocolo_w := _ora2pg_r.tb_nr_seq_protocolo_p; tb_nr_seq_conta_w := _ora2pg_r.tb_nr_seq_conta_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_proc_p; tb_null_w := _ora2pg_r.tb_nr_seq_conta_mat_p; tb_cd_prestador_w := _ora2pg_r.tb_cd_prestador_p; tb_ie_tipo_pessoa_prest_w := _ora2pg_r.tb_ie_tipo_pessoa_prest_p; tb_nr_seq_classificacao_w := _ora2pg_r.tb_nr_seq_classificacao_p; tb_ie_tipo_prestador_w := _ora2pg_r.tb_ie_tipo_prestador_p; tb_nr_seq_prest_inter_w := _ora2pg_r.tb_nr_seq_prest_inter_p; tb_null_w := _ora2pg_r.tb_nr_seq_proc_partic_p; tb_nr_seq_analise_w := _ora2pg_r.tb_nr_seq_analise_p; tb_nr_seq_lote_processo_w := _ora2pg_r.tb_nr_seq_lote_processo_p;
	end loop;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_alimenta_tb_tmp.gerar_prestador_cta (nr_seq_lote_p pls_lote_protocolo.nr_sequencia%type, nr_seq_protocolo_p pls_protocolo_conta.nr_sequencia%type, nr_seq_conta_p pls_conta.nr_sequencia%type, nr_seq_lote_processo_p pls_cta_lote_processo.nr_sequencia%type, nr_seq_analise_p pls_analise_conta.nr_sequencia%type) FROM PUBLIC;
