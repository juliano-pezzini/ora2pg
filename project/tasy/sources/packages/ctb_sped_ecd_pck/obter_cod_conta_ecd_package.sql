-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ctb_sped_ecd_pck.obter_cod_conta_ecd (ie_tipo_conta_p text, ie_apres_conta_ctb_p text, cd_empresa_p empresa.cd_empresa%type default null, cd_conta_contabil_p conta_contabil.cd_conta_contabil%type DEFAULT NULL, cd_classificacao_p conta_contabil.cd_classificacao%type default null, dt_vigencia_p timestamp default null) RETURNS varchar AS $body$
DECLARE


cd_codigo_conta_ecd_w	varchar(40) := cd_conta_contabil_p;
cd_classificacao_w	conta_contabil.cd_classificacao%type := cd_classificacao_p;


BEGIN

case
	when ie_tipo_conta_p = 'C' and ie_apres_conta_ctb_p = 'CD' then
		begin
		return cd_codigo_conta_ecd_w;
		end;
	when ie_tipo_conta_p = 'S' and ie_apres_conta_ctb_p = 'CD' then
		begin
		cd_classificacao_w	:= ctb_obter_classif_conta_sup( cd_classif_conta_p 	=> cd_classificacao_p,
									dt_vigencia_p		=> dt_vigencia_p, 
									cd_empresa_p		=> cd_empresa_p);
		cd_codigo_conta_ecd_w	:= substr(ctb_obter_codigo_classif_vig( cd_empresa_p		=> cd_empresa_p,
									cd_classificacao_p	=> cd_classificacao_w, 
									dt_vigencia_p		=> dt_vigencia_p),1,40);
		return cd_codigo_conta_ecd_w;
		end;
	when ie_tipo_conta_p = 'C' and ie_apres_conta_ctb_p = 'CL' then
		begin
		cd_codigo_conta_ecd_w	:= coalesce(cd_classificacao_p, ctb_obter_classif_conta( cd_conta_contabil_p	=> cd_conta_contabil_p,
											cd_classificacao_p	=> cd_classificacao_p,
											dt_vigencia_p		=> dt_vigencia_p));
		return cd_codigo_conta_ecd_w;
		end;
	when ie_tipo_conta_p = 'S' and ie_apres_conta_ctb_p = 'CL' then
		begin
		cd_classificacao_w	:= coalesce(cd_classificacao_p, ctb_obter_classif_conta( cd_conta_contabil_p	=> cd_conta_contabil_p,
											cd_classificacao_p	=> cd_classificacao_p,
											dt_vigencia_p		=> dt_vigencia_p));
		cd_codigo_conta_ecd_w	:= ctb_obter_classif_conta_sup( cd_classif_conta_p	=> cd_classificacao_w,
									dt_vigencia_p		=> dt_vigencia_p,
									cd_empresa_p		=> cd_empresa_p);
		return cd_codigo_conta_ecd_w;
		end;
	when ie_tipo_conta_p = 'C' and ie_apres_conta_ctb_p = 'CP' then
		begin
		cd_codigo_conta_ecd_w	:= coalesce(cd_classificacao_p, ctb_obter_classif_conta( cd_conta_contabil_p	=> cd_conta_contabil_p,
											cd_classificacao_p	=> cd_classificacao_p,
											dt_vigencia_p		=> dt_vigencia_p));
		cd_codigo_conta_ecd_w	:= replace(cd_codigo_conta_ecd_w,'.','');
		return cd_codigo_conta_ecd_w;
		end;
	when ie_tipo_conta_p = 'S' and ie_apres_conta_ctb_p = 'CP' then
		begin
		cd_classificacao_w	:= coalesce(cd_classificacao_p, ctb_obter_classif_conta( cd_conta_contabil_p	=> cd_conta_contabil_p,
											cd_classificacao_p	=> cd_classificacao_p,
											dt_vigencia_p		=> dt_vigencia_p));
											
		cd_codigo_conta_ecd_w	:= ctb_obter_classif_conta_sup( cd_classif_conta_p	=> cd_classificacao_w,
									dt_vigencia_p		=> dt_vigencia_p,
									cd_empresa_p		=> cd_empresa_p);
									
		cd_codigo_conta_ecd_w	:= replace(substr(cd_codigo_conta_ecd_w,1,40),'.','');
		return cd_codigo_conta_ecd_w;
		end;
	
else
	return null;
end case;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ctb_sped_ecd_pck.obter_cod_conta_ecd (ie_tipo_conta_p text, ie_apres_conta_ctb_p text, cd_empresa_p empresa.cd_empresa%type default null, cd_conta_contabil_p conta_contabil.cd_conta_contabil%type DEFAULT NULL, cd_classificacao_p conta_contabil.cd_classificacao%type default null, dt_vigencia_p timestamp default null) FROM PUBLIC;
