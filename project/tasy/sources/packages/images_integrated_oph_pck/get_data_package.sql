-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION images_integrated_oph_pck.get_data ( nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, dt_inicial_p timestamp, dt_final_p timestamp, ie_ignora_data_p text, ie_agrupa_imagem_p text) RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE

							
t_objeto_row_w					t_objeto_row;

cd_estabelecimento_w			estabelecimento.cd_estabelecimento%type	:= wheb_usuario_pck.get_cd_estabelecimento;
cd_perfil_w						perfil.cd_perfil%type							:= wheb_usuario_pck.get_cd_perfil;
nm_usuario_w					usuario.nm_usuario%type 						:= wheb_usuario_pck.get_nm_usuario;
cd_pf_usuario_w            pessoa_fisica.cd_pessoa_fisica%type       := obter_pf_usuario(wheb_usuario_pck.get_nm_usuario,'C');
dt_inicial_w               timestamp  := dt_inicial_p;
dt_final_w                 timestamp  := dt_final_p;
ds_titulo_tela_w           varchar(2000);
ds_lista_item_w            varchar(32000);
nr_seq_pedido_w            bigint;
ie_visao_mapeamento_w      varchar(15);
dt_registro_w              timestamp  := to_date('01/01/1899');
nr_seq_item_w              bigint:=-1;
nr_sequencia_w             bigint:=-1;
localeColombia             constant varchar(5) := 'es_CO';

exams CURSOR FOR
   SELECT 	b.ds_titulo,
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(b.nr_seq_item,cd_perfil_w) ds_item,
            trunc(b.dt_atualizacao_nrec) dt_registro,
            'IM' ie_tipo,
            b.nr_seq_item nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_imagem_exame b,
            oft_consulta c
   where  	b.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      (b.nr_seq_item IS NOT NULL AND b.nr_seq_item::text <> '')
   and      b.dt_atualizacao_nrec        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w)
   and      coalesce(b.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   and (coalesce(b.nr_seq_angio_retino::text, '') = '')
   and (coalesce(b.nr_seq_microscopia::text, '') = '')
   and (coalesce(b.nr_seq_biometria::text, '') = '') 
   and (coalesce(b.nr_seq_campimetria::text, '') = '')
   and (coalesce(b.nr_seq_topografia::text, '') = '') 
   and (coalesce(b.nr_seq_tomografia::text, '') = '') 
   and (coalesce(b.nr_seq_oct::text, '') = '') 
   and (coalesce(b.nr_seq_cerastocopia::text, '') = '') 
   and (coalesce(b.nr_seq_fundoscopia::text, '') = '') 
   and (coalesce(b.nr_seq_biomicroscopia::text, '') = '') 
   and (coalesce(b.nr_seq_oft_exame_externo::text, '') = '') 
   and (coalesce(b.nr_seq_paquimetria::text, '') = '') 
   and (coalesce(b.nr_seq_ultrassonografia::text, '') = '') 
   and (coalesce(b.nr_seq_mapeamento::text, '') = '') 
   and (coalesce(b.nr_seq_aberrometria::text, '') = '') 
   and (coalesce(b.ie_ceratoscopia,'N') = 'N')
   
union all

   --Anexos da angiofluorsceinografia

	SELECT 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(71,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            71 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.nr_sequencia       = b.nr_seq_angio_retino 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      coalesce(a.ie_tipo_registro,'A') = 'A'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da angiofluorsceinografia

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(71,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            71 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.nr_sequencia       = b.nr_seq_angio_retino 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      coalesce(a.ie_tipo_registro,'A') = 'A'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro da angiofluorsceinografia

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(71,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            71 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_ANGIO_RETINO' nm_tabela,
            --86068 nr_seq_visao,

            102575 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      coalesce(a.ie_tipo_registro,'A') = 'A'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos da retinografia

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(298,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            298 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_angio_retino 
   and      coalesce(a.ie_tipo_registro,'A') = 'R'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da retinografia

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(298,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            298 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_angio_retino 
   and      coalesce(a.ie_tipo_registro,'A') = 'R'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro da retinografia

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(298,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            298 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_ANGIO_RETINO' nm_tabela,
            --101309 nr_seq_visao,

            102576 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_angio_retino a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      coalesce(a.ie_tipo_registro,'A') = 'R'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos da biomicroscopia

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(10,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            --trunc(a.dt_exame) dt_registro,

            'IM' ie_tipo,
            10 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_biomicroscopia a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_biomicroscopia 
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da biomicroscopia

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(10,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'IM' ie_tipo,
            10 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_biomicroscopia a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_biomicroscopia 
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro da biomicroscopia

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(10,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            10 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_BIOMICROSCOPIA' nm_tabela,
            --86029 nr_seq_visao,

            CASE WHEN ie_visao_mapeamento_w='N' THEN 102579  ELSE 102651 END  nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_biomicroscopia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos do exame ocular externo

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(6,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'IM' ie_tipo,
            6 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_exame_externo a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.nr_sequencia    =  b.nr_seq_oft_exame_externo
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens do exame ocular externo

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(6,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'IM' ie_tipo,
            6 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_exame_externo a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia    =  b.nr_seq_exame_externo
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro do exame ocular externo

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(6,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            6 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_EXAME_EXTERNO' nm_tabela,
            --86101 nr_seq_visao,

            102594 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_exame_externo a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos da fundoscopia

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(9,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'IM' ie_tipo,
            9 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_fundoscopia a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia    = b.nr_seq_fundoscopia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da fundoscopia

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(9,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'IM' ie_tipo,
            9 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_fundoscopia a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_oft_fundoscopia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro da fundoscopia

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(9,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            9 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_FUNDOSCOPIA' nm_tabela,
            --86107 nr_seq_visao,

            102596 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_fundoscopia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos do mapeamento de retina

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(276,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            276 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_mapeamento_retina a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_mapeamento
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens do mapeamento de retina

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(276,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            276 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_mapeamento_retina a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_mapeamento
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')   
   
union all

   --Registro do mapeamento de retina

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(276,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            276 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_MAPEAMENTO_RETINA' nm_tabela,
            --86134 nr_seq_visao,

            102599 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_mapeamento_retina a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and pkg_i18n.get_user_locale <> localeColombia   
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(276,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            276 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_MAPEAMENTO_RETINA' nm_tabela,
            --86134 nr_seq_visao,

            111456 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_mapeamento_retina a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   AND pkg_i18n.get_user_locale = localeColombia 
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(173,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            173 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_tomografia_olho a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_tomografia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(173,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            173 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_TOMOGRAFIA_OLHO' nm_tabela,
            --86158 nr_seq_visao,

            102611 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_tomografia_olho a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos da ultrassonografia

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(277,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            277 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_ultrassonografia a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_ultrassonografia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da ultrassonografia

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(277,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            277 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_ultrassonografia a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_ultrassonografia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registros da ultrassonografia

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(277,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            277 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_ULTRASSONOGRAFIA' nm_tabela,
            --86162 nr_seq_visao,

            102614 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_ultrassonografia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(80,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            80 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_microscopia_especular a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_microscopia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(80,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            80 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_MICROSCOPIA_ESPECULAR' nm_tabela,
            --86135 nr_seq_visao,

            102600 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_microscopia_especular a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos da tomografia de coerencia optica

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(177,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            177 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_oct a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_oct
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da tomografia de coerencia optica

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(177,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            177 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_oct a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_oct
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')   
   
union all

   --Registro da tomografia de coerencia optica

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(177,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            177 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_OCT' nm_tabela,
            --86157 nr_seq_visao,

            102602 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_oct a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(171,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            171 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_campimetria a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_campimetria
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(171,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            171 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CAMPIMETRIA' nm_tabela,
            --86078 nr_seq_visao,

            102580 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_campimetria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(78,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            78 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_biometria a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_biometria
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(78,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            78 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_BIOMETRIA' nm_tabela,
            --88505 nr_seq_visao,

            102578 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_biometria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(84,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'IM' ie_tipo,
            84 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_paquimetria a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_paquimetria
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(84,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            84 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_PAQUIMETRIA' nm_tabela,
            CASE WHEN coalesce(IE_TIPO_PAQUIMETRIA,'S')='S' THEN 102606/*86143*/
  ELSE 102605/*86144*/
 END  nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_paquimetria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(168,null) ds_item,
            trunc(b.dt_atualizacao_nrec) dt_registro,
            'IM' ie_tipo,
            168 nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_imagem_exame b,
            oft_consulta c
   where  	b.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      b.dt_atualizacao_nrec        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      b.ie_ceratoscopia = 'S'
   and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w)
   and      coalesce(b.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(31,null) ds_item,
            trunc(b.dt_atualizacao_nrec) dt_registro,
            'IM' ie_tipo,
            31 nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_imagem_exame b,
            oft_consulta c
   where  	b.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w)
   and      b.dt_atualizacao_nrec        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      coalesce(b.dt_inativacao::text, '') = ''
   and (coalesce(b.nr_seq_angio_retino::text, '') = '')
   and (coalesce(b.nr_seq_microscopia::text, '') = '')
   and (coalesce(b.nr_seq_biometria::text, '') = '') 
   and (coalesce(b.nr_seq_campimetria::text, '') = '')
   and (coalesce(b.nr_seq_topografia::text, '') = '') 
   and (coalesce(b.nr_seq_tomografia::text, '') = '') 
   and (coalesce(b.nr_seq_oct::text, '') = '') 
   and (coalesce(b.nr_seq_cerastocopia::text, '') = '') 
   and (coalesce(b.nr_seq_fundoscopia::text, '') = '') 
   and (coalesce(b.nr_seq_biomicroscopia::text, '') = '') 
   and (coalesce(b.nr_seq_oft_exame_externo::text, '') = '') 
   and (coalesce(b.nr_seq_paquimetria::text, '') = '') 
   and (coalesce(b.nr_seq_ultrassonografia::text, '') = '') 
   and (coalesce(b.nr_seq_mapeamento::text, '') = '') 
   and (coalesce(b.nr_seq_aberrometria::text, '') = '') 
   and (coalesce(b.ie_ceratoscopia,'N') = 'N')
   and (coalesce(b.nr_seq_item::text, '') = '')
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   select 	b.nm_titulo ds_titulo, 
            b.ds_anexo ds_arquivo, 
            null ds_lado,
            CASE WHEN coalesce(b.cd_relatorio::text, '') = '' THEN obter_desc_item_perfil_oft(31,null)  ELSE d.ds_titulo END  ds_item,
            --b.dt_registro,

            trunc(b.dt_registro) dt_registro,
            'IM' ie_tipo,
            coalesce(b.cd_relatorio,31) nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            CASE WHEN coalesce(b.cd_relatorio::text, '') = '' THEN 2  ELSE 1 END  nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   FROM oft_consulta c, oft_anexo b
LEFT OUTER JOIN relatorio d ON (b.cd_relatorio = d.cd_relatorio AND b.cd_classif_relat = d.cd_classif_relat)
WHERE b.nr_seq_consulta		= c.nr_sequencia and c.cd_pessoa_fisica   = cd_pessoa_fisica_p   and b.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w) and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w) and coalesce(b.dt_inativacao::text, '') = '' and (b.ds_anexo IS NOT NULL AND b.ds_anexo::text <> '')
    
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            d.ds_tipo ds_item,
            --a.dt_avaliacao dt_registro,

            trunc(a.dt_avaliacao) dt_registro,
            'R' ie_tipo,
            220 nr_seq_item,
            a.nr_sequencia,
            a.nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_medico),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	med_avaliacao_paciente a,
            oft_consulta c,
            med_tipo_avaliacao d
   where  	a.nr_seq_consulta		   = c.nr_sequencia
   and      c.cd_pessoa_fisica      = cd_pessoa_fisica_p 
   and      a.dt_avaliacao        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_seq_tipo_avaliacao = d.nr_sequencia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	e.ds_titulo ds_titulo, 
            coalesce(e.ds_arquivo, e.ds_arquivo_backup) ds_arquivo, 
            null ds_lado,
            d.ds_tipo ds_item,
            --a.dt_avaliacao dt_registro,

            trunc(a.dt_avaliacao) dt_registro,
            'IM' ie_tipo,
            220 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_medico),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	med_avaliacao_paciente a,
            oft_consulta c,
            med_tipo_avaliacao d,
            oft_consulta_imagem e
   where  	a.nr_seq_consulta		   = c.nr_sequencia
   and      a.nr_sequencia          = e.nr_seq_avaliacao
   and      c.cd_pessoa_fisica      = cd_pessoa_fisica_p 
   and      a.dt_avaliacao        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_seq_tipo_avaliacao = d.nr_sequencia
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(19,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            19 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CORRECAO_ATUAL' nm_tabela,
            CASE WHEN IE_TIPO='S' THEN 102589/*90593*/  ELSE CASE WHEN ie_tipo='A' THEN 102588/*90600*/  ELSE CASE WHEN ie_tipo='C' THEN 102587/*90638*/
  ELSE 102586/*90637*/
 END  END  END  nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_correcao_atual a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(2,null) ds_item,
            --a.dt_anamnese dt_registro,

            trunc(a.dt_anamnese) dt_registro,
            'R' ie_tipo,
            2 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_ANAMNESE' nm_tabela,
            --86064 nr_seq_visao,

            102573 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_anamnese a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_anamnese        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(248,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            248 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_AUTO_REFRACAO' nm_tabela,
            --86072 nr_seq_visao,

            102577 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_auto_refracao a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(244,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            244 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_OLHO_SECO' nm_tabela,
            --86073 nr_seq_visao,

            102604 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_olho_seco a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            obter_valor_dominio(1372,a.ie_olho) ds_lado,
            obter_desc_item_perfil_oft(256,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            256 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CAPSULOTOMIA' nm_tabela,
            --86100 nr_seq_visao,

            102581 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_capsulotomia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(175,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            175 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CERASTOCOPIA' nm_tabela,
            --86080 nr_seq_visao,

            102583 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_cerastocopia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''  
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(24,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            24 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CONDUTA' nm_tabela,
            --86086 nr_seq_visao,

            102584 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_conduta a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)   
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''   
   AND      pkg_i18n.get_user_locale <> localeColombia
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(69,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            69 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_CURVA_TENCIONAL' nm_tabela,
            --86091 nr_seq_visao,

            102590 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_curva_tencional a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(245,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            245 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_DALTONISMO' nm_tabela,
            --86092 nr_seq_visao,

            102591 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_daltonismo a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            obter_desc_radio_group(336115,a.ie_olho) ds_lado,
            obter_desc_item_perfil_oft(12,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            12 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_DIAGNOSTICO' nm_tabela,
            --86093 nr_seq_visao,

            102592 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_diagnostico a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.ie_paciente,'S') = 'S'
   and      coalesce(a.dt_inativacao::text, '') = ''         
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(17,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            17 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_DNP' nm_tabela,
            --86097 nr_seq_visao,

            102593 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_dnp a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            obter_valor_dominio(1372,a.ie_olho) ds_lado,
            obter_desc_item_perfil_oft(254,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            254 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_FOTOCOAGULACAO_LASER' nm_tabela,
            --86105 nr_seq_visao,

            102595 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_fotocoagulacao_laser a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(73,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            73 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_GONIOSCOPIA' nm_tabela,
            --86109 nr_seq_visao,

            102597 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_gonioscopia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(242,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            242 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_IRIDECTOMIA' nm_tabela,
            --86121 nr_seq_visao,

            102598 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_iridectomia a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''      
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(7,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            7 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_MOTILIDADE_OCULAR' nm_tabela,
            --86136 nr_seq_visao,

            102601 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_motilidade_ocular a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = '' 
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(236,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            236 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_POTENCIAL_ACUIDADE' nm_tabela,
            --86145 nr_seq_visao,

            102607 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_potencial_acuidade a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(82,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            82 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_PUPILOMETRIA' nm_tabela,
            --86146 nr_seq_visao,

            102608 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_pupilometria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(13,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            13 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_OCULOS' nm_tabela,
            --86139 nr_seq_visao,

            102603 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_oculos a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(247,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            247 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_REFRACAO' nm_tabela,
            --86151 nr_seq_visao,

            102609 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_refracao a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      pkg_i18n.get_user_locale <> localeColombia    
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(255,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            255 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_SOBRECARGA_HIDRICA' nm_tabela,
            --86154 nr_seq_visao,

            102610 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_sobrecarga_hidrica a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(23,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            23 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_TONOMETRIA' nm_tabela,
            --88268 nr_seq_visao,

            102613 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_tonometria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   and      a.ie_tipo_tonometria = 2
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(8,null) ds_item,
            trunc(a.dt_exame) dt_registro,
            'R' ie_tipo,
            8 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_TONOMETRIA' nm_tabela,
            --86159 nr_seq_visao,

            102612 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	oft_tonometria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''    
   and      a.ie_tipo_tonometria = 1
   
union all
   
   select 	ds_titulo ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(21,null) ds_item,
            --a.dt_atualizacao_nrec dt_registro,

            trunc(a.dt_atualizacao_nrec) dt_registro,
            'R' ie_tipo,
            21 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'PEP_PAC_CI' nm_tabela,
            --86087 nr_seq_visao,

            102617 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	pep_pac_ci a
   where  	a.cd_pessoa_fisica      = cd_pessoa_fisica_p 
   and      a.dt_atualizacao_nrec   between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	Obter_desc_tipo_evolucao(ie_evolucao_clinica) ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(162,null) ds_item,
            --a.dt_evolucao dt_registro,

            trunc(a.dt_evolucao) dt_registro,
            'R' ie_tipo,
            162 nr_seq_item,
            a.cd_evolucao nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65585 nr_seq_ativacao_dbpanel,
            'EVOLUCAO_PACIENTE' nm_tabela,
            --86099 nr_seq_visao,

            102569 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_medico),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	evolucao_paciente a
   where  	a.cd_pessoa_fisica      = cd_pessoa_fisica_p 
   and      a.dt_evolucao   between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      consiste_se_consulta_evolucao(ie_evolucao_clinica,cd_pf_usuario_w,cd_perfil_w) = 'S'
   and      ie_tipo_evolucao <> '9'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(160,null) ds_item,
            trunc(a.dt_registro) dt_registro,
            'R' ie_tipo,
            160 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'PEP_ORIENTACAO_GERAL' nm_tabela,
            --86142 nr_seq_visao,

            102616 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	pep_orientacao_geral a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(28,null) ds_item,
            --a.dt_atestado dt_registro,

            trunc(a.dt_atestado) dt_registro,
            'R' ie_tipo,
            28 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'ATESTADO_PACIENTE' nm_tabela,
            --86069 nr_seq_visao,

            102566 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_medico),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from   	atestado_paciente a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_atestado        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select	a.ds_tipo ds_titulo,
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(231,null) ds_item,
            --a.dt_registro_date dt_registro,

            trunc(a.dt_registro_date) dt_registro,
            'R' ie_tipo,
            231 nr_seq_item,
            null nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            coalesce(a.ds_complemento_oft, a.ds_complemento) ds_texto,
            --substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico

            null nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from	   historico_saude_v a
   where	   a.cd_pessoa_fisica = cd_pessoa_fisica_p
   and	   substr(obter_se_visualiza_hs(a.ie_tipo),1,1) = 'S'
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and	   coalesce(a.dt_inativacao::text, '') = ''
   and      (a.ds_complemento IS NOT NULL AND a.ds_complemento::text <> '')
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(16,null) ds_item,
            --a.dt_receita dt_registro,

            trunc(a.dt_receita) dt_registro,
            'R' ie_tipo,
            16 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'MED_RECEITA' nm_tabela,
            --86147 nr_seq_visao,

            102572 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_medico),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	med_receita a
   where  	a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_receita        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select 	substr(obter_exame_agenda(a.cd_procedimento_princ, a.ie_origem_proced, a.nr_seq_proc_interno),1,240) ds_titulo, 
            null ds_arquivo, 
            obter_valor_dominio(1372,a.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(15,null) ds_item,
            --a.dt_inicio_real dt_registro,

            trunc(a.dt_inicio_real) dt_registro,
            'R' ie_tipo,
            15 nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'CIRURGIA_DESCRICAO' nm_tabela,
            --86141 nr_seq_visao,

            102568 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_responsavel),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	cirurgia a,
            cirurgia_descricao b
   where  	a.nr_cirurgia        = b.nr_cirurgia
   and      a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_inicio_real     between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.ie_status_cirurgia = 2
   and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w)
   and      coalesce(b.dt_inativacao::text, '') = ''
   
union all

   select 	substr(obter_exame_agenda(a.cd_procedimento_princ, a.ie_origem_proced, a.nr_seq_proc_interno),1,240) ds_titulo, 
            c.ds_arquivo ds_arquivo, 
            obter_valor_dominio(1372,a.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(15,null) ds_item,
            trunc(a.dt_inicio_real) dt_registro,
            'IM' ie_tipo,
            15 nr_seq_item,
            b.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(b.cd_responsavel),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	cirurgia a,
            cirurgia_descricao b,
            imagem_cirurgia c
   where  	a.nr_cirurgia        = b.nr_cirurgia
   and      b.nr_sequencia       = c.nr_seq_prot_cirurgia
   and      a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_inicio_real     between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.ie_status_cirurgia = 2
   and      (c.ds_arquivo IS NOT NULL AND c.ds_arquivo::text <> '')
   and ((b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> '') or b.nm_usuario = nm_usuario_w)
   and      coalesce(b.dt_inativacao::text, '') = ''
   
union all
   
   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(297,null) ds_item,
            --a.dt_justificativa dt_registro,

            trunc(a.dt_justificativa) dt_registro,
            'R' ie_tipo,
            297 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'PACIENTE_JUSTIFICATIVA' nm_tabela,
            --101131 nr_seq_visao,

            102615 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   from   	paciente_justificativa a
   where  	a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_justificativa   between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.cd_profissional = cd_pf_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   select	null ds_titulo,
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(75,null) ds_item,
            --c.dt_consulta dt_registro,

            trunc(c.dt_consulta) dt_registro,
            'R' ie_tipo,
            75 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
            c.nr_sequencia nr_seq_consulta
   from	   pedido_exame_externo a,
            oft_consulta c
   where	   a.nr_seq_consulta    = c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      c.dt_consulta        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      exists (select 1 from pedido_exame_externo_item b where a.nr_sequencia       = b.nr_seq_pedido)
   and	   coalesce(a.dt_inativacao::text, '') = ''
   
union all

   SELECT   ds_titulo_laudo ds_titulo,
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(165,null) ds_item,
            --a.dt_laudo dt_registro,

            trunc(a.dt_laudo) dt_registro,
            'R' ie_tipo,
            165 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            coalesce(nm_medico_resp,nm_medico) nm_medico,
            obter_clob_ds_laudo_paciente(a.nr_sequencia) ds_texto_longo,
            null nr_seq_consulta
   FROM	   laudo_paciente_v a
   WHERE	   (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
   and      coalesce(a.dt_cancelamento::text, '') = '' 
   and      a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_laudo   between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   AND		a.ie_formato = 1
   AND		(a.ds_laudo IS NOT NULL AND a.ds_laudo::text <> '')
   
union all

   SELECT   ds_titulo_laudo ds_titulo,
            DS_ARQUIVO_IMAGEM ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(165,null) ds_item,
            trunc(a.dt_laudo) dt_registro,
            'IM' ie_tipo,
            165 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            coalesce(nm_medico_resp,nm_medico) nm_medico,
            null ds_texto_longo,
            null nr_seq_consulta
   FROM	   laudo_paciente_v a,
            laudo_paciente_imagem b
   WHERE	   a.nr_sequencia = b.nr_sequencia
   and      (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
   and      coalesce(a.dt_cancelamento::text, '') = '' 
   and      a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_laudo   between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   AND		a.ie_formato = 1
   
union all

   --Anexos da aberrometria

   select 	b.ds_titulo, 
            b.ds_arquivo, 
            obter_valor_dominio(1372,b.ie_lado) ds_lado,
            obter_desc_item_perfil_oft(302,null) ds_item,
            a.dt_exame dt_registro,
            'IM' ie_tipo,
            302 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
			null nr_seq_consulta
   from   	oft_aberrometria a,
            oft_imagem_exame b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia    = b.nr_seq_aberrometria
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo IS NOT NULL AND b.ds_arquivo::text <> '')
   
union all

   --Banco de imagens da aberrometria

   select 	b.ds_titulo, 
            coalesce(b.ds_arquivo, b.ds_arquivo_backup) ds_arquivo,
            null ds_lado,
            obter_desc_item_perfil_oft(302,null) ds_item,
            a.dt_exame dt_registro,
            'IM' ie_tipo,
            302 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
			null nr_seq_consulta
   from   	oft_aberrometria a,
            oft_consulta_imagem b,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and      a.nr_sequencia       = b.nr_seq_aberrometria
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   and      (b.ds_arquivo_backup IS NOT NULL AND b.ds_arquivo_backup::text <> '')
   
union all

   --Registro da aberrometria

   select 	null ds_titulo, 
            null ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(302,null) ds_item,
            a.dt_exame dt_registro,
            'R' ie_tipo,
            302 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            65456 nr_seq_ativacao_dbpanel,
            'OFT_ABERROMETRIA' nm_tabela,
            103207 nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
			null nr_seq_consulta
   from   	oft_aberrometria a,
            oft_consulta c
   where  	a.nr_seq_consulta		= c.nr_sequencia
   and      c.cd_pessoa_fisica   = cd_pessoa_fisica_p 
   and      a.dt_exame        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
   and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
   and      coalesce(a.dt_inativacao::text, '') = ''
   
union all

   --Anexos GED

	select 	a.ds_titulo, 
            a.ds_arquivo, 
            null ds_lado,
            obter_desc_item_perfil_oft(235,null) ds_item,
            a.dt_registro,
            'IM' ie_tipo,
            235 nr_seq_item,
            a.nr_sequencia,
            null nr_seq_tipo_avaliacao,
            null nr_seq_ativacao_dbpanel,
            null nm_tabela,
            null nr_seq_visao,
            2 nr_ordem,
            null ds_texto,
            substr(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
            null ds_texto_longo,
			null nr_seq_consulta    
	from   	GED_ATENDIMENTO a
	where  	a.cd_pessoa_fisica   = cd_pessoa_fisica_p 
	and      a.dt_registro        between trunc(dt_inicial_w) and fim_dia(dt_final_w)
	and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '') or a.nm_usuario = nm_usuario_w)
	and      coalesce(a.dt_inativacao::text, '') = ''
	and      (a.ds_arquivo IS NOT NULL AND a.ds_arquivo::text <> '')
  
union all

  select null ds_titulo,
    null ds_arquivo,
    null ds_lado,
    obter_desc_item_perfil_oft(318,null) ds_item,
    trunc(a.dt_atualizacao) dt_registro,
    'R' ie_tipo,
    318 nr_seq_item,
    a.nr_sequencia,
    null nr_seq_tipo_avaliacao,
    74941 nr_seq_ativacao_dbpanel,
    'ATEND_QUEIXA_PACIENTE' nm_tabela,
    111160 nr_seq_visao,
    2 nr_ordem,
    null ds_texto,
    null nm_medico,
    null ds_texto_longo,
    null nr_seq_consulta
  from atend_queixa_paciente a
  where a.cd_pessoa_fisica = cd_pessoa_fisica_p
  and a.dt_atualizacao between trunc(dt_inicial_w) and fim_dia(dt_final_w)
  and ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
  or a.nm_usuario              = nm_usuario_w)
  and coalesce(a.dt_inativacao::text, '') = ''
  and pkg_i18n.get_user_locale = localeColombia
  
union all

  SELECT NULL ds_titulo,
      NULL ds_arquivo,
      NULL ds_lado,
      obter_desc_item_perfil_oft(321,NULL) ds_item,
      TRUNC(a.dt_atualizacao) dt_registro,
      'R' ie_tipo,
      321 nr_seq_item,
      a.nr_sequencia,
      NULL nr_seq_tipo_avaliacao,
      74991 nr_seq_ativacao_dbpanel,
      'GRADE_AMSLER' nm_tabela,
      111436 nr_seq_visao,
      2 nr_ordem,
      NULL ds_texto,
      NULL nm_medico,
      NULL ds_texto_longo,
      c.nr_sequencia nr_seq_consulta
    FROM grade_amsler a,
      oft_consulta c
    WHERE a.nr_seq_consulta = c.nr_sequencia
    AND c.cd_pessoa_fisica  = cd_pessoa_fisica_p
    AND a.dt_atualizacao BETWEEN TRUNC(dt_inicial_w) AND fim_dia(dt_final_w)
    AND ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
    OR a.nm_usuario              = nm_usuario_w)
    AND coalesce(a.dt_inativacao::text, '') = ''
    AND pkg_i18n.get_user_locale = localeColombia
  
union all

  SELECT NULL ds_titulo,
      NULL ds_arquivo,
      NULL ds_lado,
      obter_desc_item_perfil_oft(324,NULL) ds_item,
      TRUNC(a.dt_atualizacao) dt_registro,
      'R' ie_tipo,
      324 nr_seq_item,
      a.nr_sequencia,
      NULL nr_seq_tipo_avaliacao,
      74992 nr_seq_ativacao_dbpanel,
      'EXAME_PONTOS_VERMELHOS' nm_tabela,
      111437 nr_seq_visao,
      2 nr_ordem,
      NULL ds_texto,
      NULL nm_medico,
      NULL ds_texto_longo,
      c.nr_sequencia nr_seq_consulta
    FROM exame_pontos_vermelhos a,
      oft_consulta c
    WHERE a.nr_seq_consulta = c.nr_sequencia
    AND c.cd_pessoa_fisica  = cd_pessoa_fisica_p
    AND a.dt_atualizacao BETWEEN TRUNC(dt_inicial_w) AND fim_dia(dt_final_w)
    AND ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
    OR a.nm_usuario              = nm_usuario_w)
    AND coalesce(a.dt_inativacao::text, '') = ''
    AND pkg_i18n.get_user_locale = localeColombia
  
union all

  SELECT NULL ds_titulo,
      NULL ds_arquivo,
      NULL ds_lado,
      obter_desc_item_perfil_oft(247,NULL) ds_item,
      TRUNC(a.dt_exame) dt_registro,
      'R' ie_tipo,
      247 nr_seq_item,
      a.nr_sequencia,
      NULL nr_seq_tipo_avaliacao,
      65456 nr_seq_ativacao_dbpanel,
      'OFT_REFRACAO' nm_tabela,
      111450 nr_seq_visao,
      2 nr_ordem,
      NULL ds_texto,
      SUBSTR(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
      NULL ds_texto_longo,
      c.nr_sequencia nr_seq_consulta
    FROM oft_refracao a,
      oft_consulta c
    WHERE a.nr_seq_consulta = c.nr_sequencia
    AND c.cd_pessoa_fisica  = cd_pessoa_fisica_p
    AND a.dt_exame BETWEEN TRUNC(dt_inicial_w) AND fim_dia(dt_final_w)
    AND ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
    OR a.nm_usuario              = nm_usuario_w)
    AND coalesce(a.dt_inativacao::text, '') = ''
    AND pkg_i18n.get_user_locale = localeColombia
  
union all

    SELECT NULL ds_titulo,
      NULL ds_arquivo,
      NULL ds_lado,
      obter_desc_item_perfil_oft(24,NULL) ds_item,
      TRUNC(a.dt_registro) dt_registro,
      'R' ie_tipo,
      24 nr_seq_item,
      a.nr_sequencia,
      NULL nr_seq_tipo_avaliacao,
      65456 nr_seq_ativacao_dbpanel,
      'OFT_CONDUTA' nm_tabela,
      111536 nr_seq_visao,
      2 nr_ordem,
      NULL ds_texto,
      SUBSTR(obter_nome_pf(a.cd_profissional),1,255) nm_medico,
      NULL ds_texto_longo,
      c.nr_sequencia nr_seq_consulta
    FROM oft_conduta a,
      oft_consulta c
    WHERE a.nr_seq_consulta = c.nr_sequencia
    AND c.cd_pessoa_fisica  = cd_pessoa_fisica_p
    AND a.dt_registro BETWEEN TRUNC(dt_inicial_w) AND fim_dia(dt_final_w)
    AND ((a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
    OR a.nm_usuario      = nm_usuario_w)
    AND coalesce(a.dt_inativacao::text, '') = ''
    AND pkg_i18n.get_user_locale = localeColombia
	 order by dt_registro,nr_seq_item,nr_sequencia,ie_tipo;

   
itens_solicitacao CURSOR FOR
      SELECT	substr(obter_med_exame_externo(nr_sequencia),1,255) ds_exame,
               qt_exame,
               obter_valor_dominio(1372,b.IE_LADO) ds_lado
      from   	pedido_exame_externo_item b
      where  	b.nr_seq_pedido = nr_seq_pedido_w
      and      (obter_med_exame_externo(nr_sequencia) IS NOT NULL AND (obter_med_exame_externo(nr_sequencia))::text <> '')
      order    by NR_SEQ_APRESENT,1,2,3;

   

BEGIN
if (coalesce(ie_ignora_data_p,'N') = 'S') then
   dt_inicial_w   := to_date('01/01/1899');
   dt_final_w     := clock_timestamp() + interval '365 days';
end if;

obter_param_usuario(3010, 54, cd_perfil_w, nm_usuario_w, cd_estabelecimento_w, ie_visao_mapeamento_w);


FOR c_exams IN exams LOOP
	BEGIN
   ds_lista_item_w := null;
   if (c_exams.nr_seq_item = 75) then
      nr_seq_pedido_w := c_exams.nr_sequencia;
      FOR c_itens_solicitacao IN itens_solicitacao LOOP
         BEGIN
         if (c_itens_solicitacao.ds_exame IS NOT NULL AND c_itens_solicitacao.ds_exame::text <> '') then
            ds_lista_item_w := substr(ds_lista_item_w || obter_desc_expressao(289683,'Exame')||': '||c_itens_solicitacao.ds_exame||chr(10),1,6000);
         end if;

         if (c_itens_solicitacao.ds_lado IS NOT NULL AND c_itens_solicitacao.ds_lado::text <> '') then
            ds_lista_item_w := substr(ds_lista_item_w || obter_desc_expressao(292416,'Lado')||': '||c_itens_solicitacao.ds_lado||chr(10),1,6000);
         end if;

         if (c_itens_solicitacao.qt_exame IS NOT NULL AND c_itens_solicitacao.qt_exame::text <> '') then
            ds_lista_item_w := substr(ds_lista_item_w || obter_desc_expressao(297049,'Quantidade')||': '||c_itens_solicitacao.qt_exame||chr(10),1,6000);
         end if;
         ds_lista_item_w := substr(ds_lista_item_w ||chr(10),1,6000);
         end;
      end loop;
   end if;

      
   ds_titulo_tela_w  := obter_desc_expressao(327202,'Data:')|| ' ';
   ds_titulo_tela_w  := ds_titulo_tela_w||PKG_DATE_FORMATERS.to_varchar(c_exams.dt_registro,'shortDate',cd_estabelecimento_w,nm_usuario_w);
   ds_titulo_tela_w  := ds_titulo_tela_w||' - '||obter_desc_expressao(947102,'Lado:')|| ' ';
   if (coalesce(c_exams.ds_lado::text, '') = '') then
      ds_titulo_tela_w  := ds_titulo_tela_w||obter_desc_expressao(327119,'N'||chr(227)||'o informado');
   else
      ds_titulo_tela_w  := ds_titulo_tela_w||c_exams.ds_lado;
   end if;
   ds_titulo_tela_w  := ds_titulo_tela_w||' - '||obter_desc_expressao(728918,'Profissional:')|| ' ';
   ds_titulo_tela_w  := ds_titulo_tela_w||c_exams.nm_medico;

   if (coalesce(ie_agrupa_imagem_p,'N') = 'S') and (c_exams.ie_tipo = 'IM') then
      if ((trunc(c_exams.dt_registro) <> trunc(dt_registro_w)) or (c_exams.nr_seq_item <> nr_seq_item_w) 
		or (c_exams.nr_seq_item in (71,298,10,6,9,276,173,277,80,177,171,78,84,220,15,165,302) and c_exams.nr_sequencia <> nr_sequencia_w)) then
         dt_registro_w                          := trunc(c_exams.dt_registro);
         nr_seq_item_w                          := c_exams.nr_seq_item;
		 nr_sequencia_w                          := c_exams.nr_sequencia;

         t_objeto_row_w.ds_titulo               := null;
         t_objeto_row_w.ds_arquivo	            := null;
         t_objeto_row_w.ds_lado	               := null;
         t_objeto_row_w.ds_item		            := c_exams.ds_item;
         t_objeto_row_w.dt_registro	            := trunc(c_exams.dt_registro);
         t_objeto_row_w.ie_tipo	               := c_exams.ie_tipo;
         t_objeto_row_w.nr_seq_item	            := c_exams.nr_seq_item;
         t_objeto_row_w.nr_seq_registro	      := c_exams.nr_sequencia;
         t_objeto_row_w.nr_seq_tipo_avaliacao	:= null;
         t_objeto_row_w.nr_seq_ativacao_dbpanel	:= null;
         t_objeto_row_w.nm_tabela	            := null;
         t_objeto_row_w.nr_seq_visao	         := null;
         t_objeto_row_w.nr_ordem	               := c_exams.nr_ordem;
         t_objeto_row_w.ds_texto	               := null;
         t_objeto_row_w.ds_titulo_tela          := null;
         t_objeto_row_w.ds_texto_longo          := null;
         RETURN NEXT t_objeto_row_w;
      end if;
   else   
      t_objeto_row_w.ds_titulo               := c_exams.ds_titulo;
      t_objeto_row_w.ds_arquivo	            := c_exams.ds_arquivo;
      t_objeto_row_w.ds_lado	               := c_exams.ds_lado;
      t_objeto_row_w.ds_item		            := c_exams.ds_item;
      t_objeto_row_w.dt_registro	            := trunc(c_exams.dt_registro);
      t_objeto_row_w.ie_tipo	               := c_exams.ie_tipo;
      t_objeto_row_w.nr_seq_item	            := c_exams.nr_seq_item;
      t_objeto_row_w.nr_seq_registro	      := c_exams.nr_sequencia;
      t_objeto_row_w.nr_seq_tipo_avaliacao	:= c_exams.nr_seq_tipo_avaliacao;
      t_objeto_row_w.nr_seq_ativacao_dbpanel	:= c_exams.nr_seq_ativacao_dbpanel;
      t_objeto_row_w.nm_tabela	            := c_exams.nm_tabela;
      t_objeto_row_w.nr_seq_visao	         := c_exams.nr_seq_visao;
      t_objeto_row_w.nr_ordem	               := c_exams.nr_ordem;
      if (ds_lista_item_w IS NOT NULL AND ds_lista_item_w::text <> '') then
         t_objeto_row_w.ds_texto	               := ds_lista_item_w;
      else
         t_objeto_row_w.ds_texto	               := c_exams.ds_texto;
      end if;
      t_objeto_row_w.ds_titulo_tela          := ds_titulo_tela_w;
      t_objeto_row_w.ds_texto_longo          := c_exams.ds_texto_longo;
      RETURN NEXT t_objeto_row_w;
   end if;
	END;
end loop;	

RETURN;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION images_integrated_oph_pck.get_data ( nr_seq_consulta_p bigint, cd_pessoa_fisica_p text, dt_inicial_p timestamp, dt_final_p timestamp, ie_ignora_data_p text, ie_agrupa_imagem_p text) FROM PUBLIC;
