-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_conv_xml_cta_pck.obter_dados_beneficiario ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, ie_opcao_p text) RETURNS varchar AS $body$
DECLARE

/*
Opcoes : 
SXS - Sexo Sigla ('M', 'F', 'I')
UF   - Estado da Operadora
INT - Tipo de interc_mbio da operadora
*/


ds_retorno_w		varchar(255);
nr_seq_congenere_ok_w	pls_segurado.nr_seq_congenere_ok%type;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;


BEGIN

if (nr_seq_segurado_p IS NOT NULL AND nr_seq_segurado_p::text <> '') then
	if (ie_opcao_p = 'SXS') then
	
		ds_retorno_w := pls_obter_dados_segurado(nr_seq_segurado_p, ie_opcao_p);
		
	elsif (ie_opcao_p = 'UF') then
	
		select	max(nr_seq_congenere_ok),
			max(cd_estabelecimento)
		into STRICT	nr_seq_congenere_ok_w,
			cd_estabelecimento_w
		from	pls_segurado
		where	nr_sequencia = nr_seq_segurado_p;
		
		ds_retorno_w := pls_obter_estado_congenere(nr_seq_congenere_ok_w, cd_estabelecimento_w);
		
	elsif (ie_opcao_p = 'INT') then
	
		select	max(nr_seq_congenere_ok),
			max(cd_estabelecimento)
		into STRICT	nr_seq_congenere_ok_w,
			cd_estabelecimento_w
		from	pls_segurado
		where	nr_sequencia = nr_seq_segurado_p;
		
		ds_retorno_w := pls_obter_tipo_intercambio(nr_seq_congenere_ok_w, cd_estabelecimento_w);
		
	end if;
end if;

return	ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_conv_xml_cta_pck.obter_dados_beneficiario ( nr_seq_segurado_p pls_segurado.nr_sequencia%type, ie_opcao_p text) FROM PUBLIC;
