-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_conv_xml_cta_pck.obter_material_parametro_imp ( ie_parametro_p pls_param_importacao_conta.ie_tipo_material%type, dt_execucao_mat_p pls_conta_item_imp.dt_execucao%type, cd_material_number_p pls_conta_item_imp.cd_procedimento_conv%type, cd_versao_tiss_conv_p pls_protocolo_conta_imp.cd_versao_tiss_conv%type) RETURNS bigint AS $body$
DECLARE


nr_seq_material_conv_w	pls_material.nr_sequencia%type;


BEGIN
nr_seq_material_conv_w := null;

case(ie_parametro_p)
	-- Material do Hospital

	when 'H' then
		
		pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p, 
						'M', 'S', cd_versao_tiss_conv_p);
			
		if (coalesce(nr_seq_material_conv_w::text, '') = '') then
			pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p,
							'M', 'N', cd_versao_tiss_conv_p);
		end if;
		
	-- C_digo do material

	when 'C' then
		
		pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p,
						'O', 'S', cd_versao_tiss_conv_p);
			
		if (coalesce(nr_seq_material_conv_w::text, '') = '') then
			pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p,
							'O', 'N', cd_versao_tiss_conv_p);
		end if;
		
	-- Sequencia do material

	when 'S' then
		
		pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p,
						'S', 'S', cd_versao_tiss_conv_p);
			
		if (coalesce(nr_seq_material_conv_w::text, '') = '') then
			pls_obter_mat_tiss_vigente( 	nr_seq_material_conv_w, dt_execucao_mat_p, cd_material_number_p,
							'S', 'N', cd_versao_tiss_conv_p);
		end if;
	else
		null;
end case;

return nr_seq_material_conv_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_conv_xml_cta_pck.obter_material_parametro_imp ( ie_parametro_p pls_param_importacao_conta.ie_tipo_material%type, dt_execucao_mat_p pls_conta_item_imp.dt_execucao%type, cd_material_number_p pls_conta_item_imp.cd_procedimento_conv%type, cd_versao_tiss_conv_p pls_protocolo_conta_imp.cd_versao_tiss_conv%type) FROM PUBLIC;
