-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_conv_xml_cta_pck.pls_conv_nv_item_conta ( nr_seq_protocolo_p pls_protocolo_conta_imp.nr_sequencia%type, cd_versao_tiss_conv_p pls_protocolo_conta_imp.cd_versao_tiss_conv%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) AS $body$
BEGIN
-- carrega os par_metros para vari_veis globais da package

CALL CALL CALL CALL CALL CALL pls_conv_xml_cta_pck.carrega_parametros(cd_estabelecimento_p, 'C');

-- gerencia todo o processo de identificacao do item

CALL pls_conv_xml_cta_pck.gerencia_identificacao_item(nr_seq_protocolo_p, cd_versao_tiss_conv_p, cd_estabelecimento_p, nm_usuario_p);

-- faz a identificacao dos campos dos procedimento

CALL pls_conv_xml_cta_pck.pls_conv_dados_procedimento(nr_seq_protocolo_p, cd_versao_tiss_conv_p, cd_estabelecimento_p);

-- faz a identificacao dos campos dos materiais

CALL pls_conv_xml_cta_pck.pls_conv_dados_material(nr_seq_protocolo_p, cd_versao_tiss_conv_p, cd_estabelecimento_p);

-- Esta rotina tem a finalidade de , durante a importacao de arquivos xml de contas m_dicas, 

-- verificar se existe regras quanto a importacao de campos especiais que n_o existem no schema TISS.

-- Isto _ realizado embutindo o valor do campo, n_o existente no TISS, em um campo existente demarcando 

-- o valor com caracteres especiais como # ou @. Na id_ia original, por exemplo, iria ser embutido o  setor do

-- atendimento de um procedimento na descricao do mesmo sendo utilizado o caracter # para demarcacao do inicio e fim.

CALL pls_conv_xml_cta_pck.gerencia_regra_campo_especial(nr_seq_protocolo_p);

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_conv_xml_cta_pck.pls_conv_nv_item_conta ( nr_seq_protocolo_p pls_protocolo_conta_imp.nr_sequencia%type, cd_versao_tiss_conv_p pls_protocolo_conta_imp.cd_versao_tiss_conv%type, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
