-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_conv_xml_cta_pck.formata_cd_doenca ( cd_doenca_p pls_diagnostico_conta_imp.cd_doenca%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) RETURNS varchar AS $body$
DECLARE


cd_doenca_conv_w	pls_diagnostico_conta_imp.cd_doenca_conv%type;


BEGIN
-- inicia a vari_vel como nulo

cd_doenca_conv_w := null;

-- carrega os par_metros para vari_veis globais da package

CALL CALL CALL CALL CALL CALL pls_conv_xml_cta_pck.carrega_parametros(cd_estabelecimento_p, 'C');

-- verifica se foi passado algum valor  no parametro

if (cd_doenca_p IS NOT NULL AND cd_doenca_p::text <> '') then

	-- O campo sempre ser_ verificado com upper desta forma sempre retornar_ o valor com upper

	cd_doenca_conv_w := upper(cd_doenca_p);
	
	-- verifica se o parametro diz para ignorar os caracteres especiais

	if (current_setting('pls_conv_xml_cta_pck.ie_ignora_caracter_cid_w')::pls_param_importacao_conta.ie_ignora_caracter_cid%type = 'S') then
		cd_doenca_conv_w := replace(replace(replace(cd_doenca_conv_w,'.', ''),',', ''),'-', '');
	end if;
end if;

return	cd_doenca_conv_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_conv_xml_cta_pck.formata_cd_doenca ( cd_doenca_p pls_diagnostico_conta_imp.cd_doenca%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type) FROM PUBLIC;
