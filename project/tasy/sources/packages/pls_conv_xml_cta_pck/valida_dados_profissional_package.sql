-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_conv_xml_cta_pck.valida_dados_profissional ( ie_tipo_validacao_p bigint, nr_seq_cons_prof_conv_p pls_conta_imp.nr_seq_cons_prof_exec_conv%type, -- Sigla conselho
 nr_conselho_prof_conv_p pls_conta_imp.nr_cons_prof_exec_conv%type, -- Numero conselho
 sg_uf_conselho_conv_p pls_conta_imp.cd_uf_cons_prof_exec_conv%type, -- UF conselho
 nm_profissional_p pls_conta_imp.nm_profissional_exec%type, -- Nome
 ds_observacao_p out text) AS $body$
DECLARE


/* ie_tipo_validacao_p
 1 = Valida tudo
 2 = Valida apenas nome profissional
 3 = Valida apenas n_mero conselho profissional
 4 = Valida apenas sigla conselho profissional
 5 = Valida apenas UF do conselho profissional
 */

ie_dados_validos_w 	varchar(1);


BEGIN
ds_observacao_p := null;

-- Nome do profissional

if (ie_tipo_validacao_p in (1,2)) then
	if (coalesce(nm_profissional_p::text, '') = '') then
		ds_observacao_p := 'Nome profissional';
	end if;
end if;
-- N_mero do conselho

if (ie_tipo_validacao_p in (1,3)) then
	if (coalesce(nr_conselho_prof_conv_p::text, '') = '') then
		if (coalesce(ds_observacao_p::text, '') = '') then
			ds_observacao_p := 'N_mero do conselho';
		else	
			ds_observacao_p := ds_observacao_p || ', n_mero do conselho';
		end if;
	end if;
end if;
-- Sigla do conselho

if (ie_tipo_validacao_p in (1,4)) then
	if (coalesce(nr_seq_cons_prof_conv_p::text, '') = '') then
		if (coalesce(ds_observacao_p::text, '') = '') then
			ds_observacao_p := 'Sigla do conselho';
		else	
			ds_observacao_p := ds_observacao_p || ', sigla do conselho';
		end if;
	end if;
end if;
-- UF do conselho

if (ie_tipo_validacao_p in (1,5)) then
	if (coalesce(sg_uf_conselho_conv_p::text, '') = '') then
		if (coalesce(ds_observacao_p::text, '') = '') then
			ds_observacao_p := 'Estado(UF) do conselho';
		else	
			ds_observacao_p := ds_observacao_p || ', estado(UF) do conselho';
		end if;
	end if;
end if;

-- Retorna S caso seja v_lido

if (coalesce(ds_observacao_p::text, '') = '') then
	ie_dados_validos_w := 'S';
else
	ie_dados_validos_w := 'N';
end if;

return;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_conv_xml_cta_pck.valida_dados_profissional ( ie_tipo_validacao_p bigint, nr_seq_cons_prof_conv_p pls_conta_imp.nr_seq_cons_prof_exec_conv%type, nr_conselho_prof_conv_p pls_conta_imp.nr_cons_prof_exec_conv%type, sg_uf_conselho_conv_p pls_conta_imp.cd_uf_cons_prof_exec_conv%type, nm_profissional_p pls_conta_imp.nm_profissional_exec%type, ds_observacao_p out text) FROM PUBLIC;
