-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ptu_aviso_imp_pck.inserir_a520_lote ( nr_sequencia_p INOUT ptu_lote_aviso.nr_sequencia%type, cd_estabelecimento_p ptu_lote_aviso.cd_estabelecimento%type, nm_usuario_p ptu_lote_aviso.nm_usuario%type, dt_geracao_p ptu_lote_aviso.dt_geracao%type, dt_importacao_p ptu_lote_aviso.dt_importacao%type, ie_tipo_lote_p ptu_lote_aviso.ie_tipo_lote%type, ie_processo_p ptu_lote_aviso.ie_processo%type, ie_tipo_data_p ptu_lote_aviso.ie_tipo_data%type, ds_observacao_p ptu_lote_aviso.ds_observacao%type, dt_referencia_inicio_p ptu_lote_aviso.dt_referencia_inicio%type, dt_referencia_fim_p ptu_lote_aviso.dt_referencia_fim%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Insere os dados do A520 e devolve a chave primaria gerada
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[ ]  Objetos do dicionario [X] Tasy (Delphi/Java) [ X] Portal [ X]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_importacao_w		ptu_lote_aviso.dt_importacao%type := trunc(dt_importacao_p);


BEGIN
select	max(nr_sequencia)
into STRICT	nr_sequencia_p
from	ptu_lote_aviso
where	dt_importacao	= dt_importacao_w
and	ie_processo	= ie_processo_p;

if (coalesce(nr_sequencia_p::text, '') = '') then
	insert into ptu_lote_aviso(	nr_sequencia,
					cd_estabelecimento,
					dt_atualizacao,
					nm_usuario,
					dt_atualizacao_nrec,
					nm_usuario_nrec,
					dt_geracao,
					dt_importacao,
					ie_tipo_lote,
					ie_processo,
					ie_tipo_data,
					ds_observacao,
					dt_referencia_inicio,
					dt_referencia_fim)
	values (nextval('ptu_lote_aviso_seq'),
		cd_estabelecimento_p,
		clock_timestamp(),
		nm_usuario_p,
		clock_timestamp(),
		nm_usuario_p,
		dt_geracao_p,
		dt_importacao_p,
		ie_tipo_lote_p,
		ie_processo_p,
		ie_tipo_data_p,
		ds_observacao_p,
		dt_referencia_inicio_p,
		dt_referencia_fim_p) returning nr_sequencia into nr_sequencia_p;	
end if;
		
commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_imp_pck.inserir_a520_lote ( nr_sequencia_p INOUT ptu_lote_aviso.nr_sequencia%type, cd_estabelecimento_p ptu_lote_aviso.cd_estabelecimento%type, nm_usuario_p ptu_lote_aviso.nm_usuario%type, dt_geracao_p ptu_lote_aviso.dt_geracao%type, dt_importacao_p ptu_lote_aviso.dt_importacao%type, ie_tipo_lote_p ptu_lote_aviso.ie_tipo_lote%type, ie_processo_p ptu_lote_aviso.ie_processo%type, ie_tipo_data_p ptu_lote_aviso.ie_tipo_data%type, ds_observacao_p ptu_lote_aviso.ds_observacao%type, dt_referencia_inicio_p ptu_lote_aviso.dt_referencia_inicio%type, dt_referencia_fim_p ptu_lote_aviso.dt_referencia_fim%type) FROM PUBLIC;
