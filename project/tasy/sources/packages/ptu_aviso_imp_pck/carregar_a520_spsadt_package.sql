-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Carrregar os dados da guia SP/SADT do arquivo A520 de XML
CREATE OR REPLACE PROCEDURE ptu_aviso_imp_pck.carregar_a520_spsadt ( ds_arquivo_xml_p ptu_aviso_arq_xml.ds_arquivo%type, nr_seq_aviso_protocolo_p ptu_aviso_protocolo.nr_sequencia%type, nr_guias_p bigint, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


nr_guia_w			bigint := 1;
nr_proc_w			bigint := 1;
nr_desp_w			bigint := 1;
nr_equipe_w			bigint := 1;
nr_tag_proc_w			bigint := 0;
nr_tag_equipe_w			bigint := 0;
nr_tag_desp_w			bigint := 0;
ds_guia_w			text; -- guia
ds_solic_w			text; -- solicitante
ds_exec_w			text; -- executor
ds_procs_w			text; -- procedimentos
ds_proc_w			text; -- procedimento
ds_equipe_w			text; -- equipe
ds_desps_w			text; -- outras depesas
ds_desp_w			text; -- despesa
-- Guia
nr_seq_aviso_conta_w		ptu_aviso_conta.nr_sequencia%type;
nr_guia_principal_w		ptu_aviso_conta.nr_guia_principal%type;
nr_guia_operadora_w		ptu_aviso_conta.nr_guia_operadora%type;
nr_guia_prestador_w		ptu_aviso_conta.nr_guia_prestador%type;
cd_registro_ans_w		ptu_aviso_conta.cd_registro_ans%type;
dt_autorizacao_w		varchar(255);
cd_senha_w			ptu_aviso_conta.cd_senha%type;
dt_validade_senha_w		varchar(255);
nr_carteira_benef_w		ptu_aviso_conta.nr_carteira_benef%type;
ie_atendimento_rn_w		ptu_aviso_conta.ie_atendimento_rn%type;
nm_beneficiario_w		ptu_aviso_conta.nm_beneficiario%type;
nr_cns_benef_w			ptu_aviso_conta.nr_cns_benef%type;
ie_ident_beneficiario_w		ptu_aviso_conta.ie_ident_beneficiario%type;
cd_prestador_solicitante_w	ptu_aviso_conta.cd_prestador_solicitante%type;
cd_cpf_solicitante_w		ptu_aviso_conta.cd_cpf_solicitante%type;
cd_cnpj_solicitante_w		ptu_aviso_conta.cd_cnpj_solicitante%type;
nm_profissional_solicitante_w	ptu_aviso_conta.nm_profissional_solicitante%type;
sg_conselho_solicitante_w	ptu_aviso_conta.sg_conselho_solicitante%type;
nr_conselho_solicitante_w	ptu_aviso_conta.nr_conselho_solicitante%type;
sg_uf_solicitante_w		ptu_aviso_conta.sg_uf_solicitante%type;
nr_cbo_solicitante_w		ptu_aviso_conta.nr_cbo_solicitante%type;
nm_solicitante_w		ptu_aviso_conta.nm_solicitante%type;
dt_solicitacao_w		varchar(255);
ie_carater_atendimento_w	ptu_aviso_conta.ie_carater_atendimento%type;
ds_indicacao_clinica_w		ptu_aviso_conta.ds_indicacao_clinica%type;
cd_prestador_executante_w	ptu_aviso_conta.cd_prestador_executante%type;
cd_cpf_executante_w		ptu_aviso_conta.cd_cpf_executante%type;
cd_cnpj_executante_w		ptu_aviso_conta.cd_cnpj_executante%type;
nm_executante_w			ptu_aviso_conta.nm_executante%type;
cd_cnes_executante_w		ptu_aviso_conta.cd_cnes_executante%type;
ie_tipo_atendimento_w		ptu_aviso_conta.ie_tipo_atendimento%type;
ie_indicacao_acidente_w		ptu_aviso_conta.ie_indicacao_acidente%type;
ie_tipo_consulta_w		ptu_aviso_conta.ie_tipo_consulta%type;
ie_motivo_encerramento_w	ptu_aviso_conta.ie_motivo_encerramento%type;
ds_observacao_w			ptu_aviso_conta.ds_observacao%type;
vl_procedimento_w		ptu_aviso_conta.vl_procedimento%type;
vl_diaria_w			ptu_aviso_conta.vl_diaria%type;
vl_taxa_w			ptu_aviso_conta.vl_taxa%type;
vl_material_w			ptu_aviso_conta.vl_material%type;
vl_medicamento_w		ptu_aviso_conta.vl_medicamento%type;
vl_opme_w			ptu_aviso_conta.vl_opme%type;
vl_gases_w			ptu_aviso_conta.vl_gases%type;
vl_total_geral_w		ptu_aviso_conta.vl_total_geral%type;
-- Procedimento
nr_seq_aviso_procedimento_w	ptu_aviso_procedimento.nr_sequencia%type;
dt_execucao_w			varchar(255);
hr_inicial_w			ptu_aviso_procedimento.hr_inicial%type;
hr_final_w			ptu_aviso_procedimento.hr_final%type;
cd_tabela_w			ptu_aviso_procedimento.cd_tabela%type;
cd_proc_envio_w			ptu_aviso_procedimento.cd_proc_envio%type;
ds_procedimento_w		ptu_aviso_procedimento.ds_procedimento%type;
qt_executada_w			ptu_aviso_procedimento.qt_executada%type;
ie_via_acesso_w			ptu_aviso_procedimento.ie_via_acesso%type;
ie_tecnica_utilizada_w		ptu_aviso_procedimento.ie_tecnica_utilizada%type;
tx_reducao_acrescimo_w		ptu_aviso_procedimento.tx_reducao_acrescimo%type;
vl_unitario_w			ptu_aviso_procedimento.vl_unitario%type;
vl_total_w			ptu_aviso_procedimento.vl_total%type;
nr_seq_item_tiss_w		ptu_aviso_procedimento.nr_seq_item_tiss%type;
-- Equipe
nr_seq_aviso_participante_w	ptu_aviso_participante.nr_sequencia%type;
ie_grau_participante_w		ptu_aviso_participante.ie_grau_participante%type;
cd_prestador_w			ptu_aviso_participante.cd_prestador%type;
cd_cpf_contratado_w		ptu_aviso_participante.cd_cpf_contratado%type;
nm_profissional_w		ptu_aviso_participante.nm_profissional%type;
sg_conselho_w			ptu_aviso_participante.sg_conselho%type;
nr_conselho_w			ptu_aviso_participante.nr_conselho%type;
sg_uf_w				ptu_aviso_participante.sg_uf%type;
nr_cbo_w			ptu_aviso_participante.nr_cbo%type;
-- Outras despesas
nr_seq_aviso_material_w		ptu_aviso_material.nr_sequencia%type;
cd_despesa_w			ptu_aviso_material.cd_despesa%type;
dt_execucao_desp_w		varchar(255);
hr_inicial_desp_w		ptu_aviso_material.hr_inicial%type;
hr_final_desp_w			ptu_aviso_material.hr_final%type;
cd_tabela_desp_w		ptu_aviso_material.cd_tabela%type;
cd_mat_envio_w			ptu_aviso_material.cd_mat_envio%type;
qt_executada_desp_w		ptu_aviso_material.qt_executada%type;
cd_unidade_medida_w		ptu_aviso_material.cd_unidade_medida%type;
tx_reducao_acrescimo_desp_w	ptu_aviso_material.tx_reducao_acrescimo%type;
vl_unitario_desp_w		ptu_aviso_material.vl_unitario%type;
vl_total_desp_w			ptu_aviso_material.vl_total%type;
ds_material_w			ptu_aviso_material.ds_material%type;
nr_registro_anvisa_w		ptu_aviso_material.nr_registro_anvisa%type;
cd_ref_fabricante_w		ptu_aviso_material.cd_ref_fabricante%type;
cd_autoriz_funcionamento_w	ptu_aviso_material.cd_autoriz_funcionamento%type;
nr_seq_segurado_w		ptu_aviso_conta.nr_seq_segurado%type;
					

BEGIN

while(nr_guia_w <= nr_guias_p) loop
	ds_guia_w := ptu_aviso_imp_pck.obter_conteudo_tag(ds_arquivo_xml_p,'ans:guiaSP-SADT',nr_guia_w);
	
	-- Guia
	nr_guia_principal_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:guiaPrincipal',1);
	nr_guia_operadora_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaOperadora',1);
	nr_guia_prestador_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroGuiaPrestador',1);
	cd_registro_ans_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:registroANS',1);
	-- Autorizacao
	dt_autorizacao_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:dataAutorizacao',1);
	cd_senha_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:senha',1);
	dt_validade_senha_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:dataValidadeSenha',1);
	-- Beneficiario
	nr_carteira_benef_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroCarteira',1);
	ie_atendimento_rn_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:atendimentoRN',1);
	nm_beneficiario_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:nomeBeneficiario',1);
	nr_cns_benef_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:numeroCNS',1);
	ie_ident_beneficiario_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:identificadorBeneficiario',1);
	-- Dados solicitante
	ds_solic_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosSolicitante',1);
	cd_prestador_solicitante_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:codigoPrestadorNaOperadora',1);
	cd_cpf_solicitante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:cpfContratado',1);
	cd_cnpj_solicitante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:cnpjContratado',1);
	nm_solicitante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:nomeContratado',1);
	sg_conselho_solicitante_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:conselhoProfissional',1);
	nr_conselho_solicitante_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:numeroConselhoProfissional',1);
	sg_uf_solicitante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:UF',1);
	nr_cbo_solicitante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:CBOS',1);
	nm_profissional_solicitante_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_solic_w,'ans:nomeProfissional',1);
	-- Dados solicitacao
	dt_solicitacao_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:dataSolicitacao',1);
	ie_carater_atendimento_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:caraterAtendimento',1);
	ds_indicacao_clinica_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:indicacaoClinica',1);
	-- Dados executante
	ds_exec_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:dadosExecutante',1);
	cd_prestador_executante_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_exec_w,'ans:codigoPrestadorNaOperadora',1);
	cd_cpf_executante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_exec_w,'ans:cpfContratado',1);
	cd_cnpj_executante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_exec_w,'ans:cnpjContratado',1);
	nm_executante_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_exec_w,'ans:nomeContratado',1);
	cd_cnes_executante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_exec_w,'ans:CNES',1);
	-- Dados atendimento
	ie_tipo_atendimento_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:tipoAtendimento',1);
	ie_indicacao_acidente_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:indicacaoAcidente',1);
	ie_tipo_consulta_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:tipoConsulta',1);
	ie_motivo_encerramento_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:motivoEncerramento',1);
	ds_observacao_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:observacao',1);
	-- Valores
	vl_procedimento_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorProcedimentos',1));
	vl_diaria_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorDiarias',1));
	vl_taxa_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTaxasAlugueis',1));
	vl_material_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMateriais',1));
	vl_medicamento_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorMedicamentos',1));
	vl_opme_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorOPME',1));
	vl_gases_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorGasesMedicinais',1));
	vl_total_geral_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:valorTotalGeral',1));
	
	select	max(nr_seq_segurado)
	into STRICT	nr_seq_segurado_w
	from	pls_segurado_carteira
	where	cd_usuario_plano	= nr_carteira_benef_w;
	
	-- Inserir guia A520
		nr_seq_aviso_conta_w := ptu_aviso_imp_pck.inserir_a520_guias(	nr_seq_aviso_conta_w, nm_usuario_p, nr_seq_aviso_protocolo_p, null, nr_seq_segurado_w, nr_guia_principal_w, nr_guia_operadora_w, nr_guia_prestador_w, cd_registro_ans_w, dt_autorizacao_w, cd_senha_w, dt_validade_senha_w, nr_carteira_benef_w, ie_atendimento_rn_w, nm_beneficiario_w, nr_cns_benef_w, ie_ident_beneficiario_w, cd_prestador_solicitante_w, cd_cpf_solicitante_w, cd_cnpj_solicitante_w, nm_profissional_solicitante_w, sg_conselho_solicitante_w, nr_conselho_solicitante_w, sg_uf_solicitante_w, nr_cbo_solicitante_w, nm_solicitante_w, null, dt_solicitacao_w, ie_carater_atendimento_w, ds_indicacao_clinica_w, cd_prestador_executante_w, cd_cpf_executante_w, cd_cnpj_executante_w, null, null, null, null, null, nm_executante_w, cd_cnes_executante_w, ie_tipo_atendimento_w, ie_indicacao_acidente_w, ie_tipo_consulta_w, ie_motivo_encerramento_w, ds_observacao_w, vl_procedimento_w, vl_diaria_w, vl_taxa_w, vl_material_w, vl_medicamento_w, vl_opme_w, vl_gases_w, vl_total_geral_w, null, null, null, null, null, null, null, null, null);
				
	-- Procedimentos
	ds_procs_w 			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:procedimentosExecutados',1);
	nr_tag_proc_w			:= ptu_aviso_imp_pck.obter_numero_tag(ds_procs_w,'ans:procedimentoExecutado');
	while(nr_proc_w <= nr_tag_proc_w) loop
		ds_proc_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_procs_w,'ans:procedimentoExecutado',nr_proc_w);
		dt_execucao_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:dataExecucao',1);
		hr_inicial_w			:= ptu_aviso_imp_pck.converte_data_hora(dt_execucao_w,ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:horaInicial',1));
		hr_final_w			:= ptu_aviso_imp_pck.converte_data_hora(dt_execucao_w,ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:horaFinal',1));		
		cd_tabela_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoTabela',1);
		cd_proc_envio_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:codigoProcedimento',1);
		ds_procedimento_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:descricaoProcedimento',1);
		qt_executada_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:quantidadeExecutada',1));
		ie_via_acesso_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:viaAcesso',1);
		ie_tecnica_utilizada_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:tecnicaUtilizada',1);
		tx_reducao_acrescimo_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:reducaoAcrescimo',1));
		vl_unitario_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:valorUnitario',1));
		vl_total_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:valorTotal',1));
		nr_seq_item_tiss_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:sequencialItem',1));
		
		-- Inserir procedimento A520
			nr_seq_aviso_procedimento_w := ptu_aviso_imp_pck.inserir_a520_proc(	nr_seq_aviso_procedimento_w, nm_usuario_p, nr_seq_aviso_conta_w, null, null, null, '00', dt_execucao_w, hr_inicial_w, hr_final_w, cd_tabela_w, cd_proc_envio_w, ds_procedimento_w, qt_executada_w, ie_via_acesso_w, ie_tecnica_utilizada_w, tx_reducao_acrescimo_w, vl_unitario_w, vl_total_w, nr_seq_item_tiss_w);
		
		-- Participantes
		nr_tag_equipe_w			:= ptu_aviso_imp_pck.obter_numero_tag(ds_proc_w,'ans:equipeSadt');
		while(nr_equipe_w <= nr_tag_equipe_w) loop
			ds_equipe_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_proc_w,'ans:equipeSadt',nr_equipe_w);
			ie_grau_participante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:grauPart',1);
			cd_prestador_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:codigoPrestadorNaOperadora',1);
			cd_cpf_contratado_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:cpfContratado',1);
			nm_profissional_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:nomeProf',1);
			sg_conselho_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:conselho',1);
			nr_conselho_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:numeroConselhoProfissional',1);
			sg_uf_w				:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:UF',1);
			nr_cbo_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_equipe_w,'ans:CBOS',1);
			
			-- Inserir participante A520
				nr_seq_aviso_participante_w := ptu_aviso_imp_pck.inserir_a520_proc_part(	nr_seq_aviso_participante_w, null, ie_grau_participante_w, cd_prestador_w, cd_cpf_contratado_w, nm_profissional_w, sg_conselho_w, nr_conselho_w, sg_uf_w, nr_cbo_w, nm_usuario_p, nr_seq_aviso_procedimento_w);
			
			nr_equipe_w := nr_equipe_w + 1;
		end loop;
		nr_equipe_w := 1;
		
		nr_proc_w := nr_proc_w + 1;
	end loop;
	nr_proc_w := 1;
	
	-- Outras depesas
	ds_desps_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_guia_w,'ans:outrasDespesas',1);
	nr_tag_desp_w			:= ptu_aviso_imp_pck.obter_numero_tag(ds_desps_w,'ans:despesa');	
	while(nr_desp_w <= nr_tag_desp_w) loop
		ds_desp_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desps_w,'ans:despesa',nr_desp_w);
		cd_despesa_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoDespesa',1);
		dt_execucao_desp_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:dataExecucao',1);
		hr_inicial_desp_w		:= ptu_aviso_imp_pck.converte_data_hora(dt_execucao_desp_w,ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:horaInicial',1));
		hr_final_desp_w			:= ptu_aviso_imp_pck.converte_data_hora(dt_execucao_desp_w,ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:horaFinal',1));		
		cd_tabela_desp_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoTabela',1);
		cd_mat_envio_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoProcedimento',1);
		qt_executada_desp_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:quantidadeExecutada',1));
		cd_unidade_medida_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:unidadeMedida',1);
		tx_reducao_acrescimo_desp_w	:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:reducaoAcrescimo',1));
		vl_unitario_desp_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:valorUnitario',1));
		vl_total_desp_w			:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:valorTotal',1));
		ds_material_w			:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:descricaoProcedimento',1);
		nr_registro_anvisa_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:registroANVISA',1);
		cd_ref_fabricante_w		:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:codigoRefFabricante',1);
		cd_autoriz_funcionamento_w	:= ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:autorizacaoFuncionamento',1);
		nr_seq_item_tiss_w		:= ptu_aviso_imp_pck.converte_numero(ptu_aviso_imp_pck.obter_conteudo_tag(ds_desp_w,'ans:sequencialItem',1));
		
		-- Inserir material A520
			nr_seq_aviso_material_w := ptu_aviso_imp_pck.inserir_a520_mat(	nr_seq_aviso_material_w, nm_usuario_p, nr_seq_aviso_conta_w, null, null, cd_despesa_w, dt_execucao_desp_w, hr_inicial_desp_w, hr_final_desp_w, cd_tabela_desp_w, cd_mat_envio_w, qt_executada_desp_w, cd_unidade_medida_w, tx_reducao_acrescimo_desp_w, vl_unitario_desp_w, vl_total_desp_w, ds_material_w, nr_registro_anvisa_w, cd_ref_fabricante_w, cd_autoriz_funcionamento_w, nr_seq_item_tiss_w);
	
		nr_desp_w := nr_desp_w + 1;
	end loop;
	nr_desp_w := 1;
	
	nr_guia_w := nr_guia_w + 1;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_imp_pck.carregar_a520_spsadt ( ds_arquivo_xml_p ptu_aviso_arq_xml.ds_arquivo%type, nr_seq_aviso_protocolo_p ptu_aviso_protocolo.nr_sequencia%type, nr_guias_p bigint, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
