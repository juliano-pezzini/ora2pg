-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Carregar arquivo XML do A520 e A525
CREATE OR REPLACE PROCEDURE ptu_aviso_imp_pck.carregar_aviso_xml ( ds_arquivo_xml_p text, nm_arquivo_p ptu_aviso_arq_xml.nm_arquivo%type, nr_seq_lote_p ptu_aviso_arq_xml.nr_seq_lote%type, nm_usuario_p usuario.nm_usuario%type, ie_tipo_arquivo_p ptu_aviso_arq_xml.ie_tipo_arquivo%type, nr_seq_arquivo_p ptu_aviso_arq_xml.nr_seq_arquivo%type, nr_seq_arq_xml_p INOUT ptu_aviso_arq_xml.nr_sequencia%type) AS $body$
BEGIN
if (coalesce(nr_seq_arq_xml_p::text, '') = '') then
	-- Inserir arquivo
	insert	into ptu_aviso_arq_xml(nr_sequencia,			dt_atualizacao,		nm_usuario,
		dt_atualizacao_nrec,		nm_usuario_nrec,	nr_seq_lote,
		nr_seq_arquivo,			ds_arquivo,		ie_tipo_arquivo,
		nm_arquivo)
	values (nextval('ptu_aviso_arq_xml_seq'),	clock_timestamp(),		nm_usuario_p,
		clock_timestamp(),			nm_usuario_p,		nr_seq_lote_p,
		nr_seq_arquivo_p,		ds_arquivo_xml_p,	ie_tipo_arquivo_p,
		nm_arquivo_p) returning nr_sequencia into nr_seq_arq_xml_p;
		
elsif (nr_seq_arq_xml_p IS NOT NULL AND nr_seq_arq_xml_p::text <> '') then
	-- Preencher arquivo XML
	update	ptu_aviso_arq_xml
	set	ds_arquivo	= ds_arquivo || ds_arquivo_xml_p
	where	nr_sequencia	= nr_seq_arq_xml_p;
end if;	

commit;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_imp_pck.carregar_aviso_xml ( ds_arquivo_xml_p text, nm_arquivo_p ptu_aviso_arq_xml.nm_arquivo%type, nr_seq_lote_p ptu_aviso_arq_xml.nr_seq_lote%type, nm_usuario_p usuario.nm_usuario%type, ie_tipo_arquivo_p ptu_aviso_arq_xml.ie_tipo_arquivo%type, nr_seq_arquivo_p ptu_aviso_arq_xml.nr_seq_arquivo%type, nr_seq_arq_xml_p INOUT ptu_aviso_arq_xml.nr_sequencia%type) FROM PUBLIC;
