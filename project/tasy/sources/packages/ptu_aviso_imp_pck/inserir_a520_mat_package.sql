-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE ptu_aviso_imp_pck.inserir_a520_mat ( nr_sequencia_p INOUT ptu_aviso_material.nr_sequencia%type, nm_usuario_p ptu_aviso_material.nm_usuario%type, nr_seq_aviso_conta_p ptu_aviso_material.nr_seq_aviso_conta%type, nr_seq_conta_mat_p ptu_aviso_material.nr_seq_conta_mat%type, nr_seq_material_p ptu_aviso_material.nr_seq_material%type, cd_despesa_p ptu_aviso_material.cd_despesa%type, dt_execucao_p text, hr_inicial_p ptu_aviso_material.hr_inicial%type, hr_final_p ptu_aviso_material.hr_final%type, cd_tabela_p ptu_aviso_material.cd_tabela%type, cd_mat_envio_p ptu_aviso_material.cd_mat_envio%type, qt_executada_p ptu_aviso_material.qt_executada%type, cd_unidade_medida_p ptu_aviso_material.cd_unidade_medida%type, tx_reducao_acrescimo_p ptu_aviso_material.tx_reducao_acrescimo%type, vl_unitario_p ptu_aviso_material.vl_unitario%type, vl_total_p ptu_aviso_material.vl_total%type, ds_material_p ptu_aviso_material.ds_material%type, nr_registro_anvisa_p ptu_aviso_material.nr_registro_anvisa%type, cd_ref_fabricante_p ptu_aviso_material.cd_ref_fabricante%type, cd_autoriz_funcionamento_p ptu_aviso_material.cd_autoriz_funcionamento%type, nr_seq_item_tiss_p ptu_aviso_material.nr_seq_item_tiss%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Insere os dados do A520 e devolve a chave primaria gerada
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[ ]  Objetos do dicionario [X] Tasy (Delphi/Java) [ X] Portal [ X]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
dt_execucao_w		ptu_aviso_material.dt_execucao%type;
nr_seq_regra_w		varchar(255);
ie_ato_cooperado_w	varchar(255);
nr_seq_grupo_ans_w	bigint	:= null;


BEGIN

dt_execucao_w := ptu_aviso_imp_pck.converte_data(dt_execucao_p);

pls_obter_tipo_ato_coop_a520(nr_seq_aviso_conta_p, 'M', null, cd_mat_envio_p, cd_tabela_p, nr_seq_regra_w, ie_ato_cooperado_w);

nr_seq_grupo_ans_w	:= pls_obter_grupo_ans_a520(nr_seq_aviso_conta_p, 'M', null, cd_mat_envio_p, cd_tabela_p);

insert into ptu_aviso_material(	nr_sequencia,				dt_atualizacao,			nm_usuario,
				dt_atualizacao_nrec,			nm_usuario_nrec,		nr_seq_aviso_conta,
				nr_seq_conta_mat,			nr_seq_material,		cd_despesa,
				dt_execucao,				hr_inicial,			hr_final,
				cd_tabela,				cd_mat_envio,			qt_executada,
				cd_unidade_medida,			tx_reducao_acrescimo,		vl_unitario,
				vl_total,				ds_material,			nr_registro_anvisa,
				cd_ref_fabricante,			cd_autoriz_funcionamento,	ie_ato_cooperado,
				nr_seq_grupo_ans,			nr_seq_item_tiss)
			values (nextval('ptu_aviso_material_seq'),		clock_timestamp(),			nm_usuario_p,
				clock_timestamp(),				nm_usuario_p,			nr_seq_aviso_conta_p,
				nr_seq_conta_mat_p,			nr_seq_material_p,		cd_despesa_p,
				dt_execucao_w,				hr_inicial_p,			hr_final_p,
				cd_tabela_p,				cd_mat_envio_p,			qt_executada_p,
				cd_unidade_medida_p,			tx_reducao_acrescimo_p,		vl_unitario_p,
				vl_total_p,				ds_material_p,			nr_registro_anvisa_p,
				cd_ref_fabricante_p,			cd_autoriz_funcionamento_p,	ie_ato_cooperado_w,
				nr_seq_grupo_ans_w,			nr_seq_item_tiss_p) returning nr_sequencia into nr_sequencia_p;
				
commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_imp_pck.inserir_a520_mat ( nr_sequencia_p INOUT ptu_aviso_material.nr_sequencia%type, nm_usuario_p ptu_aviso_material.nm_usuario%type, nr_seq_aviso_conta_p ptu_aviso_material.nr_seq_aviso_conta%type, nr_seq_conta_mat_p ptu_aviso_material.nr_seq_conta_mat%type, nr_seq_material_p ptu_aviso_material.nr_seq_material%type, cd_despesa_p ptu_aviso_material.cd_despesa%type, dt_execucao_p text, hr_inicial_p ptu_aviso_material.hr_inicial%type, hr_final_p ptu_aviso_material.hr_final%type, cd_tabela_p ptu_aviso_material.cd_tabela%type, cd_mat_envio_p ptu_aviso_material.cd_mat_envio%type, qt_executada_p ptu_aviso_material.qt_executada%type, cd_unidade_medida_p ptu_aviso_material.cd_unidade_medida%type, tx_reducao_acrescimo_p ptu_aviso_material.tx_reducao_acrescimo%type, vl_unitario_p ptu_aviso_material.vl_unitario%type, vl_total_p ptu_aviso_material.vl_total%type, ds_material_p ptu_aviso_material.ds_material%type, nr_registro_anvisa_p ptu_aviso_material.nr_registro_anvisa%type, cd_ref_fabricante_p ptu_aviso_material.cd_ref_fabricante%type, cd_autoriz_funcionamento_p ptu_aviso_material.cd_autoriz_funcionamento%type, nr_seq_item_tiss_p ptu_aviso_material.nr_seq_item_tiss%type) FROM PUBLIC;
