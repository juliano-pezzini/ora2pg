-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION product_mgmt_pck.current_version (p_product_name text) RETURNS varchar AS $body$
DECLARE

    v_ret          varchar(20);
    v_product_name varchar(100);

BEGIN
    v_product_name := p_product_name;

    -- Condicao para permitir a coexistencia dos produtos Tasy e HIS

    if v_product_name = 'HIS' then
      if product_mgmt_pck.is_product_installed('HIS') = 'N' and
         product_mgmt_pck.is_product_installed('Tasy') = 'Y' then
        v_product_name := 'Tasy';
      end if;
    end if;

    if product_mgmt_pck.is_product_installed(v_product_name) = 'Y' then
      begin
        select product_version
          into STRICT v_ret
          from product_version
         where product_name = v_product_name
           and is_version_active = 'Y';
      exception
        when no_data_found then
          v_ret := null;
      end;
    else
      v_ret := null;
    end if;
    return v_ret;
  end;

  ---------------------------------------------------------------

  --

  -- Check if the specified version of a product is marked

  -- as active.

  --

  ---------------------------------------------------------------


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION product_mgmt_pck.current_version (p_product_name text) FROM PUBLIC;
