-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE gerar_esocial_dados_pck.gerar_esocial_dados_prest ( nr_seq_lote_p bigint, nr_seq_prestador_p bigint, ie_tipo_operacao_p text, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
BEGIN

	if (coalesce(current_setting('gerar_esocial_dados_pck.nr_seq_regra_w')::esocial_regra.nr_sequencia%type,0) <> 0) then
		insert into esocial_dados_prestador(
				nr_sequencia,
				dt_atualizacao,
				nm_usuario,
				dt_atualizacao_nrec,
				nm_usuario_nrec,
				nr_seq_esocial_lote,
				cd_empresa,
				dt_admissao,
				cd_colab_esocial,
				cd_colab_sefip,
				ie_tipo_operacao,
				cd_vinculo_colab,
				cd_cadastro_colab,
				cd_cad_colab_folha,
				nm_colaborador,
				nr_cpf,
				ie_estado_civil,
				nr_pis_pasep,
				dt_nascimento,
				nr_seq_prestador,
				cd_cargo,
				cd_escala,
				cd_filial_colab,
				cd_local,
				cd_alt_cargo,
				cd_turma_escala,
				cd_conta_financeira,
				cd_sindicato,
				cd_hora_base_colab,
				cd_hora_sabado,
				nr_horas_semanal,
				nr_horas_dsr,
				cd_banco,
				cd_agencia_bancaria,
				ie_sexo,
				cd_grau_instrucao,
				cd_centro_custo,
				ie_categoria_contribuinte)
			values (nextval('esocial_dados_prestador_seq'),
				clock_timestamp(),
				nm_usuario_p,
				clock_timestamp(),
				nm_usuario_p,
				nr_seq_lote_p,
				current_setting('gerar_esocial_dados_pck.cd_empresa_w')::esocial_lote.cd_empresa%type,
				current_setting('gerar_esocial_dados_pck.dt_cadastro_w')::pls_prestador.dt_cadastro%type,
				current_setting('gerar_esocial_dados_pck.cd_categoria_colab_w')::esocial_regra.cd_categoria_colab%type,
				current_setting('gerar_esocial_dados_pck.cd_categoria_sefip_w')::esocial_regra.cd_categoria_sefip%type,
				ie_tipo_operacao_p, -- I - Inclusao / A - Alteracao / E - Exclusao
				coalesce(current_setting('gerar_esocial_dados_pck.cd_vinculo_colab_w')::esocial_dados_prestador.cd_vinculo_colab%type,0),
				CASE WHEN ie_tipo_operacao_p='I' THEN 0  ELSE current_setting('gerar_esocial_dados_pck.cd_externo_esocial_w')::pls_prestador.cd_externo_esocial%type END ,
				null,
				coalesce(current_setting('gerar_esocial_dados_pck.nm_interno_w')::pls_prestador.nm_interno%type,current_setting('gerar_esocial_dados_pck.nm_pessoa_fisica_w')::pessoa_fisica.nm_pessoa_fisica%type),
				current_setting('gerar_esocial_dados_pck.nr_cpf_w')::pessoa_fisica.nr_cpf%type,
				current_setting('gerar_esocial_dados_pck.ie_estado_civil_w')::pessoa_fisica.ie_estado_civil%type,
				current_setting('gerar_esocial_dados_pck.nr_pis_pasep_w')::pessoa_fisica.nr_pis_pasep%type,
				current_setting('gerar_esocial_dados_pck.dt_nascimento_w')::pessoa_fisica.dt_nascimento%type,
				nr_seq_prestador_p,
				current_setting('gerar_esocial_dados_pck.cd_cargo_w')::esocial_dados_prestador.cd_cargo%type,
				current_setting('gerar_esocial_dados_pck.cd_escala_w')::esocial_dados_prestador.cd_escala%type,
				current_setting('gerar_esocial_dados_pck.cd_filial_colab_w')::esocial_dados_prestador.cd_filial_colab%type,
				current_setting('gerar_esocial_dados_pck.cd_local_w')::esocial_dados_prestador.cd_local%type,
				current_setting('gerar_esocial_dados_pck.cd_alt_cargo_w')::esocial_dados_prestador.cd_alt_cargo%type,
				current_setting('gerar_esocial_dados_pck.cd_turma_escala_w')::esocial_dados_prestador.cd_turma_escala%type,
				current_setting('gerar_esocial_dados_pck.cd_conta_financeira_w')::esocial_dados_prestador.cd_conta_financeira%type,
				current_setting('gerar_esocial_dados_pck.cd_sindicato_w')::esocial_dados_prestador.cd_sindicato%type,
				current_setting('gerar_esocial_dados_pck.cd_hora_base_colab_w')::esocial_dados_prestador.cd_hora_base_colab%type,
				current_setting('gerar_esocial_dados_pck.cd_hora_sabado_w')::esocial_dados_prestador.cd_hora_sabado%type,
				current_setting('gerar_esocial_dados_pck.nr_horas_semanal_w')::esocial_dados_prestador.nr_horas_semanal%type,
				current_setting('gerar_esocial_dados_pck.nr_horas_dsr_w')::esocial_dados_prestador.nr_horas_dsr%type,
				current_setting('gerar_esocial_dados_pck.cd_banco_w')::esocial_dados_prestador.cd_banco%type,
				current_setting('gerar_esocial_dados_pck.cd_agencia_bancaria_w')::esocial_dados_prestador.cd_agencia_bancaria%type,
				current_setting('gerar_esocial_dados_pck.ie_sexo_w')::esocial_dados_prestador.ie_sexo%type,
				current_setting('gerar_esocial_dados_pck.cd_grau_instrucao_w')::esocial_dados_prestador.cd_grau_instrucao%type,
				current_setting('gerar_esocial_dados_pck.cd_centro_custo_w')::esocial_dados_prestador.cd_centro_custo%type,
				current_setting('gerar_esocial_dados_pck.ie_categoria_contribuinte_w')::esocial_dados_prestador.ie_categoria_contribuinte%type);
	end if;

	commit;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE gerar_esocial_dados_pck.gerar_esocial_dados_prest ( nr_seq_lote_p bigint, nr_seq_prestador_p bigint, ie_tipo_operacao_p text, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;
