-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_gerencia_envio_ans_pck.atualizar_monitor_tiss_conta ( dados_conta_update_p pls_gerencia_envio_ans_pck.dados_monitor_conta_update, nr_seq_lote_p pls_monitor_tiss_lote.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

if (dados_conta_update_p.nr_sequencia.count > 0) then
	forall i in dados_conta_update_p.nr_sequencia.first..dados_conta_update_p.nr_sequencia.last
		update	pls_monitor_tiss_cta_val
		set	cd_cbo_executante		= dados_conta_update_p.cd_cbo_executante(i),
			cd_cnes_prest_exec		= substr(dados_conta_update_p.cd_cnes_prest_exec(i), 0, 7),
			cd_cpf_cgc_prest_exec 		= dados_conta_update_p.cd_cpf_cgc_prest_exec(i),
			cd_guia_operadora 		= dados_conta_update_p.cd_guia_operadora(i),
			cd_guia_prestador		= dados_conta_update_p.cd_guia_prestador(i),
			cd_municipio_benef 		= dados_conta_update_p.cd_municipio_benef(i),
			cd_municipio_prest_exec 	= dados_conta_update_p.cd_municipio_prest_exec(i),
			dt_atualizacao			= clock_timestamp(),
			dt_autorizacao			= dados_conta_update_p.dt_autorizacao(i),
			dt_fim_internacao       	= dados_conta_update_p.dt_fim_internacao(i),
			dt_inicio_faturamento 		= dados_conta_update_p.dt_inicio_faturamento(i),
			dt_nascimento 			= dados_conta_update_p.dt_nascimento(i),
			cd_guia_principal		= dados_conta_update_p.cd_guia_principal(i),
			dt_protocolo			= dados_conta_update_p.dt_protocolo(i),
			dt_solicitacao			= dados_conta_update_p.dt_solicitacao(i),
			ie_carater_atendimento 		= dados_conta_update_p.ie_carater_atendimento(i),
			ie_conta_atualizada		= 'S',
			ie_identif_prest_exec 		= dados_conta_update_p.ie_identif_prest_exec(i),
			ie_indicacao_acidente		= dados_conta_update_p.ie_indicacao_acidente(i),
			ie_origem_evento		= dados_conta_update_p.ie_origem_evento(i),
			ie_recem_nasc 			= dados_conta_update_p.ie_recem_nasc(i),
			ie_reembolso 			= dados_conta_update_p.ie_reembolso(i),
			ie_regime_internacao		= dados_conta_update_p.ie_regime_internacao(i),
			ie_sexo 			= dados_conta_update_p.ie_sexo(i),
			ie_tipo_consulta		= dados_conta_update_p.ie_tipo_consulta(i),
			nm_usuario			= nm_usuario_p,
			ie_tipo_faturamento     	= dados_conta_update_p.ie_tipo_faturamento(i),
			nr_seq_segurado 		= dados_conta_update_p.nr_seq_segurado(i),
			nr_seq_tipo_atendimento		= dados_conta_update_p.nr_seq_tipo_atendimento(i),
			nm_usuario_nrec			= nm_usuario_p,
			nr_cartao_nac_sus 		= dados_conta_update_p.nr_cartao_nac_sus(i),
			nr_diarias_acompanhante		 = NULL,
			nr_diarias_uti          	 = NULL,
			nr_protocolo_ans 		= dados_conta_update_p.nr_protocolo_ans(i),
			nr_seq_cbo_saude 		= dados_conta_update_p.nr_seq_cbo_saude(i),
			nr_seq_clinica			= dados_conta_update_p.nr_seq_clinica(i),
			nr_seq_lote_monitor		= nr_seq_lote_p,
			nr_seq_prestador		= dados_conta_update_p.nr_seq_prestador(i),
			vl_cobranca_guia		= dados_conta_update_p.vl_cobranca_guia(i),
			vl_total_diaria 		= dados_conta_update_p.vl_total_diaria(i),
			vl_total_glosa			= dados_conta_update_p.vl_total_glosa(i),
			vl_total_material		= dados_conta_update_p.vl_total_material(i),
			vl_total_medicamentos 		= dados_conta_update_p.vl_total_medicamentos(i),
			vl_total_opm			= dados_conta_update_p.vl_total_opm(i),
			vl_total_pago			 = NULL,
			vl_total_procedimento		= dados_conta_update_p.vl_total_procedimento(i),
			vl_total_tabela_propria		= 0,
			vl_total_taxa			= dados_conta_update_p.vl_total_taxa(i),
			dt_pagamento_previsto		= coalesce(dados_conta_update_p.dt_pagamento_previsto(i), dt_pagamento_previsto),
			dt_pagamento_recurso		= coalesce(dados_conta_update_p.dt_pagamento_recurso(i), dt_pagamento_recurso),
			dt_conta_fechada_recurso	= coalesce(dados_conta_update_p.dt_conta_fechada_recurso(i), dt_conta_fechada_recurso),
			dt_conta_fechada		= coalesce(dados_conta_update_p.dt_conta_fechada(i), dt_conta_fechada),
			dt_cancelamento_conta		= coalesce(dados_conta_update_p.dt_cancelamento_conta(i), dt_cancelamento_conta),
			cd_versao_tiss			= dados_conta_update_p.cd_versao_tiss(i),
			ie_tipo_envio			= dados_conta_update_p.ie_tipo_envio(i),
			ie_tipo_guia			= dados_conta_update_p.ie_tipo_guia(i),
			dt_realizacao			= dados_conta_update_p.dt_realizacao(i),
			ie_motivo_encerramento		= dados_conta_update_p.ie_motivo_encerramento(i),
			ie_tipo_atendimento		= dados_conta_update_p.ie_tipo_atendimento(i),
			ie_tipo_internacao		= dados_conta_update_p.ie_tipo_internacao(i),
			nr_seq_prest_inter		= dados_conta_update_p.nr_seq_prest_inter(i),
			nr_ident_pre_estab		= dados_conta_update_p.nr_ident_pre_estab(i),
			ie_tipo_atend_oper		= dados_conta_update_p.ie_tipo_atend_oper(i),
			nr_registro_operadora_inter	= dados_conta_update_p.nr_registro_operadora_inter(i),
			ie_fornec_direto	= dados_conta_update_p.ie_fornec_direto(i),
			nr_cpf_benef	=	dados_conta_update_p.cd_cpf_segurado(i),
			ie_regime_atendimento	= dados_conta_update_p.ie_regime_atendimento(i),
			ie_saude_ocupacional	= dados_conta_update_p.ie_saude_ocupacional(i),
			ie_cobertura_especial	= dados_conta_update_p.ie_cobertura_especial(i),
			cd_modelo_remuneracao	=	dados_conta_update_p.cd_modelo_remuneracao(i)
		where	nr_sequencia 			= dados_conta_update_p.nr_sequencia(i);

		commit;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_gerencia_envio_ans_pck.atualizar_monitor_tiss_conta ( dados_conta_update_p pls_gerencia_envio_ans_pck.dados_monitor_conta_update, nr_seq_lote_p pls_monitor_tiss_lote.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
