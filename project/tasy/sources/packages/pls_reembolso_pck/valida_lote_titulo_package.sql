-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_reembolso_pck.valida_lote_titulo ( nr_id_transacao_p pls_lote_titulo_reembolso.nr_sequencia%type) AS $body$
DECLARE


C01 CURSOR(	nr_id_transacao_pc	pls_lote_titulo_reembolso.nr_sequencia%type) FOR
	SELECT	b.cd_condicao_pagamento,
		pls_obter_se_mes_fechado(trunc(b.dt_mes_competencia, 'dd'), 'T', b.cd_estabelecimento) ie_mes_fechado,
		(	SELECT	max(pr_juro_padrao)
			from	table(pls_parametros_pck.f_retorna_param(b.cd_estabelecimento))) pr_juros_padrao		
	from	pls_lote_titulo_reembolso	a,
		pls_protocolo_conta		b
	where	b.nr_sequencia			= a.nr_seq_protocolo
	and	a.nr_id_transacao		= nr_id_transacao_pc;
	
BEGIN

for r_c01_w in C01(nr_id_transacao_p) loop
	if (coalesce(r_c01_w.cd_condicao_pagamento::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(196696);
	end if;

	if (r_c01_w.ie_mes_fechado = 'S') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(196697);
	end if;

	if (coalesce(r_c01_w.pr_juros_padrao::text, '') = '') then
		CALL wheb_mensagem_pck.exibir_mensagem_abort(196699);
	end if;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_reembolso_pck.valida_lote_titulo ( nr_id_transacao_p pls_lote_titulo_reembolso.nr_sequencia%type) FROM PUBLIC;
