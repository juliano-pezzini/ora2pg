-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE nais_interface_pck.save_pessoa_endereco_item ( ie_informacao_p text, ds_valor_p text, nr_seq_pessoa_endereco_p bigint) AS $body$
DECLARE

    nr_sequencia_w  pessoa_endereco_item.nr_sequencia%type;

BEGIN
    
        select  coalesce(max(nr_sequencia), 0)
        into STRICT    nr_sequencia_w
        from    pessoa_endereco_item
        where   ie_informacao = ie_informacao_p
        and     nr_seq_pessoa_endereco = nr_seq_pessoa_endereco_p;

        if (nr_sequencia_w = 0) then
            insert
            into pessoa_endereco_item(
                nr_sequencia,
                dt_atualizacao,
                dt_atualizacao_nrec,
                nm_usuario,
                nm_usuario_nrec,
                nr_seq_pessoa_endereco,
                ie_informacao,
                ds_valor
            )
            values (
                nextval('pessoa_endereco_item_seq'),
                clock_timestamp(),
                clock_timestamp(),
                current_setting('nais_interface_pck.nm_usuario_w')::varchar(20),
                current_setting('nais_interface_pck.nm_usuario_w')::varchar(20),
                nr_seq_pessoa_endereco_p,
                ie_informacao_p,
                trim(both replace(ds_valor_p,current_setting('nais_interface_pck.jpn_space_w')::varchar(255),' ') )
            );
            commit;
        else
            update  pessoa_endereco_item
            set     dt_atualizacao = clock_timestamp(),
                    nm_usuario = current_setting('nais_interface_pck.nm_usuario_w')::varchar(20),
                    ds_valor = trim(both replace(ds_valor_p,current_setting('nais_interface_pck.jpn_space_w')::varchar(255),' ') )
            where   nr_sequencia = nr_sequencia_w;
            commit;
        end if;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE nais_interface_pck.save_pessoa_endereco_item ( ie_informacao_p text, ds_valor_p text, nr_seq_pessoa_endereco_p bigint) FROM PUBLIC;
