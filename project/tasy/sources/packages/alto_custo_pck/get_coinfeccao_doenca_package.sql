-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION alto_custo_pck.get_coinfeccao_doenca ( nr_atendimento_p bigint, ie_doenca_cronica_p text, return_default text ) RETURNS varchar AS $body$
DECLARE

    c_doencas CURSOR FOR
      SELECT  a.cd_doenca
      from    diagnostico_doenca a,
              cid_doenca b
      where   b.cd_doenca_cid = a.cd_doenca
      and     a.nr_atendimento = nr_atendimento_p
      and     b.ie_doenca_cronica_mx = ie_doenca_cronica_p
      and     (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
      and     coalesce(a.dt_inativacao::text, '') = ''

union

      SELECT  a.cd_doenca
      from    paciente_antec_clinico a,
                cid_doenca b
      where   b.cd_doenca_cid = a.cd_doenca
      and     a.nr_atendimento = nr_atendimento_p
      and     b.ie_doenca_cronica_mx = ie_doenca_cronica_p
      and     (a.dt_liberacao IS NOT NULL AND a.dt_liberacao::text <> '')
      and     coalesce(a.dt_inativacao::text, '') = '';

    r_doencas     c_doencas %rowtype;
    ds_retorno_w  varchar(1) := return_default;


BEGIN
    begin
      open c_doencas;
      fetch c_doencas into r_doencas;
      if not c_doencas%notfound then
        ds_retorno_w := '1';
      end if;
      close c_doencas;
    exception
    when others then
      ds_retorno_w := return_default;
    end;
    return ds_retorno_w;
  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION alto_custo_pck.get_coinfeccao_doenca ( nr_atendimento_p bigint, ie_doenca_cronica_p text, return_default text ) FROM PUBLIC;
