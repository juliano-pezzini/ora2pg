-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_int_xml_cta_pck.pls_integra_lote_protocolo ( nr_seq_lote_protocolo_p pls_lote_protocolo_conta.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE


ie_pode_integrar_lote_prot_w		varchar(1);


BEGIN
-- verifica se o lote do protocolo pode ser integrado

ie_pode_integrar_lote_prot_w := pls_int_xml_cta_pck.verifica_pode_integrar_lote(nr_seq_lote_protocolo_p);

-- se passou na valida__o faz a c_pia dos dados para as tabelas "quentes"

if (ie_pode_integrar_lote_prot_w = 'S') then

	-- faz a integra__o do protocolo

	CALL pls_int_xml_cta_pck.pls_int_nv_protocolo(	nr_seq_lote_protocolo_p, nm_usuario_p);
	
	-- faz a integra__o da conta

	CALL pls_int_xml_cta_pck.pls_int_nv_conta(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos procedimentos

	CALL pls_int_xml_cta_pck.pls_int_nv_conta_proc(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos participantes

	CALL pls_int_xml_cta_pck.pls_int_nv_partic(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos materiais

	CALL pls_int_xml_cta_pck.pls_int_nv_conta_mat(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos diagn_sticos

	CALL pls_int_xml_cta_pck.pls_int_nv_diagnostico(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o das declara__es de diagn_stico

	CALL pls_int_xml_cta_pck.pls_int_nv_decl_cta(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o das faces dos dentes

	CALL pls_int_xml_cta_pck.pls_int_nv_face_dente(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos anexos da conta 

	CALL pls_int_xml_cta_pck.pls_int_nv_lote_anexo_cta(	nr_seq_lote_protocolo_p, nm_usuario_p);

	--faz a integra__o dos anexos de odontologia

	CALL pls_int_xml_cta_pck.pls_int_nv_lote_odont_cta(	nr_seq_lote_protocolo_p, nm_usuario_p);

	-- o _ltimo processo _ o que realiza a atualiza__o dos status do lote e protocolo

	-- sinalizando que eles foram aceitos e integrados

	CALL pls_int_xml_cta_pck.pls_atu_situacao_lote_prot(	nr_seq_lote_protocolo_p, cd_estabelecimento_p, nm_usuario_p);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_int_xml_cta_pck.pls_integra_lote_protocolo ( nr_seq_lote_protocolo_p pls_lote_protocolo_conta.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
