-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

	
/* --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

	


CREATE OR REPLACE PROCEDURE ptu_moviment_benef_a300_pck.gerar_arquivo_a300 ( nr_seq_lote_p ptu_mov_produto_lote.nr_sequencia%type, nm_arquivo_p text, ie_tipo_movimento_p text) AS $body$
DECLARE

	arq_texto_w	utl_file.file_type;
	
BEGIN
	PERFORM set_config('ptu_moviment_benef_a300_pck.ie_tipo_arquivo_w', 'N', false); -- Normal
	arq_texto_w := ptu_moviment_benef_a300_pck.criar_arquivo(nm_arquivo_p, arq_texto_w);

	if (ptu_moviment_benef_a300_pck.obter_versao_ptu(nr_seq_lote_p) in ('9.0','10.0')) then
		CALL ptu_moviment_benef_a300_pck.processar_arquivo_ptu_90(nr_seq_lote_p,arq_texto_w);
	else
		CALL ptu_moviment_benef_a300_pck.processar_arquivo_ptu_80(nr_seq_lote_p,arq_texto_w);
	end if;
	
	if (dbms_lob.isopen(current_setting('ptu_moviment_benef_a300_pck.ds_arquivo_w')::text) = 1) then
		dbms_lob.close(current_setting('ptu_moviment_benef_a300_pck.ds_arquivo_w')::text);
	end if;
	
	end;
	

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_moviment_benef_a300_pck.gerar_arquivo_a300 ( nr_seq_lote_p ptu_mov_produto_lote.nr_sequencia%type, nm_arquivo_p text, ie_tipo_movimento_p text) FROM PUBLIC;
