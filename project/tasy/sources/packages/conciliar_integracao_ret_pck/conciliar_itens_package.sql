-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integracao_ret_pck.conciliar_itens () AS $body$
DECLARE


IE_SETOR	boolean;
IE_FUNCAO	boolean;
IE_DT_ATEND	boolean;
IE_DT_CONTA	boolean;
IE_VL_PROC	boolean;
BEGIN

if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.count > 0) then

	for i in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.last loop

		if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.count > 0) then

			for j in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.last loop

				if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.count > 0) then

					for k in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.last loop						
						if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta.count > 0)
							and (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status <> 'C')then

							for l in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta.last loop							
								IE_SETOR	:=	false;
								IE_FUNCAO	:= 	false;
								IE_DT_ATEND	:= 	false;
								IE_DT_CONTA	:=	false;
								IE_VL_PROC	:=	false;

								if	coalesce(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_conciliado, 'N') = 'N' and (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status <> 'C') and (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).nr_interno_conta 			= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_interno_conta) and (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).cd_autorizacao 			= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_doc_convenio) and
									(
										(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento 	= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento) or (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento 	= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento_tuss) or (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento 	= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento_convenio)
									)
									then

									if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_exec = current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento) then
										IE_SETOR := true;
									end if;
									-- Tratamento para separar os valores dos participantes do procedimento	
									if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_funcao = current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_funcao_medico) then
										IE_FUNCAO := true;
									end if;	

									if (trunc(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].dt_realizacao,'dd') = trunc(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].dt_atendimento,'dd')) then
										IE_DT_ATEND := true;
									end if;

									if (trunc(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].dt_realizacao,'dd') = trunc(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].dt_realizacao,'dd')) then
										IE_DT_CONTA := true;
									end if;

									if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].vl_informado  = current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].vl_procedimento) or (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].vl_informado 	= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].vl_medico) then	
										IE_VL_PROC := true;
									end if;

									/*participante com mesmo valor e data*/

									if (ie_funcao) and (ie_vl_proc) and (ie_dt_atend or ie_dt_conta) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_atendimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_material		:= null;
                                        current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_conciliado 		:= 'S';
									/*participante com mesmo valor*/

									elsif (ie_funcao) and (ie_vl_proc) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_atendimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_material		:= null;
                                        current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_conciliado 	:= 'S';
									/*participante com mesma data*/

									elsif (ie_funcao) and (ie_dt_atend or ie_dt_conta) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_atendimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_material		:= null;
                                        current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_conciliado 	:= 'S';
									/*Mesma data de procedimento e valor*/

									elsif	((ie_dt_atend or ie_dt_conta) and ie_vl_proc) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_atendimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_material		:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_conciliado 	:= 'S';
									/*Mesmo valor de procedimento*/

									elsif (ie_vl_proc) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_setor_atendimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_material		:= null;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].ie_conciliado 	:= 'S';
									/*Mesma data de procedimento*/

									elsif (ie_dt_atend or ie_dt_conta) then
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].nr_seq_propaci 	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].nr_sequencia;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].cd_procedimento	:= current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).procedimentos_conta[l].cd_procedimento;
										current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_origem_proced	:= protocolos_w[i].contas(j).procedimentos_conta[l].ie_origem_proced;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).procedimentos_conta[l].cd_setor_atendimento;										
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= null;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).procedimentos_conta[l].ie_conciliado 	:= 'S';
									else
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := 0;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 	:= 'I'; --Item nao encontrado na conta paciente
									end if;									
								elsif (protocolos_w[i].contas(j).itens_conta[k].ie_status <> 'C') then
									protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := 0;
									protocolos_w[i].contas(j).itens_conta[k].ie_status 	:= 'I';
								end if;
							end loop;

						end if;

						if (protocolos_w[i].contas(j).materiais_conta.count > 0)
							and (protocolos_w[i].contas(j).itens_conta[k].ie_status <> 'C') then

							for l in protocolos_w[i].contas(j).materiais_conta.first .. protocolos_w[i].contas(j).materiais_conta.last loop

								IE_SETOR	:=	false;
								IE_DT_ATEND	:= 	false;
								IE_DT_CONTA	:=	false;
								IE_VL_PROC	:=	false;

								if (protocolos_w[i].contas(j).itens_conta[k].ie_status <> 'C') and
									coalesce(protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado, 'N') = 'N' and
									(
									(protocolos_w[i].contas(j).itens_conta[k].cd_procedimento = protocolos_w[i].contas(j).materiais_conta[l].cd_material_tiss) or (protocolos_w[i].contas(j).itens_conta[k].cd_procedimento = protocolos_w[i].contas(j).materiais_conta[l].cd_material_tuss) or (protocolos_w[i].contas(j).itens_conta[k].cd_procedimento = protocolos_w[i].contas(j).materiais_conta[l].cd_material_convenio)
									) then

									if (protocolos_w[i].contas(j).itens_conta[k].cd_setor_exec = protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento) then
										IE_SETOR := true;
									end if;

									if (trunc(protocolos_w[i].contas(j).itens_conta[k].dt_realizacao,'dd') = trunc(protocolos_w[i].contas(j).materiais_conta[l].dt_atendimento,'dd')) then
										IE_DT_ATEND := true;
									end if;

									if (trunc(protocolos_w[i].contas(j).itens_conta[k].dt_realizacao,'dd') = trunc(protocolos_w[i].contas(j).materiais_conta[l].dt_conta,'dd')) then
										IE_DT_CONTA := true;
									end if;

									if (protocolos_w[i].contas(j).itens_conta[k].vl_informado  = protocolos_w[i].contas(j).materiais_conta[l].vl_material) or (dividir(protocolos_w[i].contas(j).itens_conta[k].vl_informado,protocolos_w[i].contas(j).itens_conta[k].qt_executada)  = protocolos_w[i].contas(j).materiais_conta[l].vl_material)then	
										IE_VL_PROC := true;
									end if;

									/*mesmo valor e data*/

									if (ie_vl_proc) and (ie_dt_atend or ie_dt_conta) and (ie_setor) then
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= protocolos_w[i].contas(j).materiais_conta[l].nr_sequencia;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= protocolos_w[i].contas(j).materiais_conta[l].cd_material;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento;
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := null;
										protocolos_w[i].contas(j).itens_conta[k].cd_procedimento := null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado 	:= 'S';
									/*participante com mesma data*/

									elsif (ie_dt_atend or ie_dt_conta) and (ie_setor) then
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= protocolos_w[i].contas(j).materiais_conta[l].nr_sequencia;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= protocolos_w[i].contas(j).materiais_conta[l].cd_material;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento;
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := null;
										protocolos_w[i].contas(j).itens_conta[k].cd_procedimento := null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado 	:= 'S';
									elsif (ie_dt_atend or ie_dt_conta) and (ie_vl_proc) then
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= protocolos_w[i].contas(j).materiais_conta[l].nr_sequencia;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= protocolos_w[i].contas(j).materiais_conta[l].cd_material;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento;
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := null;
										protocolos_w[i].contas(j).itens_conta[k].cd_procedimento := null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado 	:= 'S';
									elsif (ie_dt_atend or ie_dt_conta)  then
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= protocolos_w[i].contas(j).materiais_conta[l].nr_sequencia;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= protocolos_w[i].contas(j).materiais_conta[l].cd_material;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento;
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := null;
										protocolos_w[i].contas(j).itens_conta[k].cd_procedimento := null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado 	:= 'S';
									/*mesmo valor*/

									elsif (ie_vl_proc) then
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci 	:= protocolos_w[i].contas(j).materiais_conta[l].nr_sequencia;
										protocolos_w[i].contas(j).itens_conta[k].cd_material		:= protocolos_w[i].contas(j).materiais_conta[l].cd_material;
										protocolos_w[i].contas(j).itens_conta[k].cd_setor_atendimento	:= protocolos_w[i].contas(j).materiais_conta[l].cd_setor_atendimento;
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_propaci := null;
										protocolos_w[i].contas(j).itens_conta[k].cd_procedimento := null;
										protocolos_w[i].contas(j).itens_conta[k].ie_status 		:= 'C';
										protocolos_w[i].contas(j).materiais_conta[l].ie_conciliado 	:= 'S';
									else
										protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci := 0;
										protocolos_w[i].contas(j).itens_conta[k].ie_status := 'I'; --Item nao encontrado na conta paciente
									end if;
								elsif (protocolos_w[i].contas(j).itens_conta[k].ie_status <> 'C') then
									protocolos_w[i].contas(j).itens_conta[k].nr_seq_matpaci := 0;
									protocolos_w[i].contas(j).itens_conta[k].ie_status := 'I';
								end if;
							end loop;
						end if;
					end loop;				
				end if;
			end loop;
		end if;
	end loop;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integracao_ret_pck.conciliar_itens () FROM PUBLIC;
