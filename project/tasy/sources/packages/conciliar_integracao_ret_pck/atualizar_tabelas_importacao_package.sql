-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integracao_ret_pck.atualizar_tabelas_importacao () AS $body$
BEGIN

	if current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.count > 0 then
		for i in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v.last loop

            if (current_setting('conciliar_integracao_ret_pck.ie_opcao_w')::varchar(2) = 'V' and current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].ie_status = 'C') then
                current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].ie_status := 'V';
            end if;
			current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v(i) := conciliar_integracao_ret_pck.verifica_gera_lote_grg(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v(i));

			if (current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.count > 0) then
				for j in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas.last loop

					if ( current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.count > 0 ) then
						for k in current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.first .. current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta.last loop

                            if (current_setting('conciliar_integracao_ret_pck.ie_opcao_w')::varchar(2) = 'V' and current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status = 'C') then
                                current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta[k].ie_status := 'V';
                            end if;

							current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta(k) := conciliar_integracao_ret_pck.atualiza_item(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).itens_conta(k));
						end loop;
					end if;					

                    if (current_setting('conciliar_integracao_ret_pck.ie_opcao_w')::varchar(2) = 'V' and current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).ie_status = 'C') then
                        current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j).ie_status := 'V';
                    end if;
					current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j) := conciliar_integracao_ret_pck.atualiza_guia(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v[i].contas(j));

				end loop;
			end if;

			current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v(i) := conciliar_integracao_ret_pck.atualiza_protocolo(current_setting('conciliar_integracao_ret_pck.protocolos_w')::protocolo_v(i));

		end loop;
	end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integracao_ret_pck.atualizar_tabelas_importacao () FROM PUBLIC;
