-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integracao_ret_pck.verifica_gera_lote_grg (protocolo_w INOUT protocolo) AS $body$
DECLARE


vl_informado_w	imp_dem_retorno_prot.vl_informado%type;
vl_liberado_w	imp_dem_retorno_prot.vl_liberado%type;
ds_retorno_w	varchar(2000);


BEGIN	

	select	max(vl_informado),
		max(vl_liberado)
	into STRICT	vl_informado_w,
		vl_liberado_w
	from	imp_dem_retorno
	where	nr_sequencia = protocolo_w.nr_seq_imp_dem_retorno;

	if ((vl_informado_w > 0) and (coalesce(vl_liberado_w::text, '') = ''))
		or (vl_informado_w > 0 AND vl_liberado_w = 0) then		
			CALL conciliar_integracao_ret_pck.atualiza_status_retorno(protocolo_w);			
			protocolo_w := conciliar_integracao_ret_pck.gerar_grg(protocolo_w);
	end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integracao_ret_pck.verifica_gera_lote_grg (protocolo_w INOUT protocolo) FROM PUBLIC;
