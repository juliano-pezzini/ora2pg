-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_pp_canc_pgto_prest_pck.cancelar_ie_tipo_item_1 ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type, nr_seq_pp_prest_p pls_pp_prestador.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

					
tb_nr_seq_conta_w		pls_util_cta_pck.t_number_table;
tb_nr_sequencia_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_item_w		pls_util_cta_pck.t_number_table;
tb_cd_procedimento_w		pls_util_cta_pck.t_number_table;
tb_ie_origem_proced_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_material_w		pls_util_cta_pck.t_number_table;
tb_qt_item_w			pls_util_cta_pck.t_number_table;
tb_nr_seq_prest_pgto_w		pls_util_cta_pck.t_number_table;
tb_cd_pessoa_fisica_w		pls_util_cta_pck.t_varchar2_table_20;
tb_nr_seq_competencia_w		pls_util_cta_pck.t_number_table;
tb_vl_medico_w			pls_util_cta_pck.t_number_table;
tb_vl_anestesista_w		pls_util_cta_pck.t_number_table;
tb_vl_auxiliares_w		pls_util_cta_pck.t_number_table;
tb_vl_custo_oper_w		pls_util_cta_pck.t_number_table;
tb_vl_materiais_w		pls_util_cta_pck.t_number_table;
tb_vl_calculado_w		pls_util_cta_pck.t_number_table;
tb_vl_apresentado_w		pls_util_cta_pck.t_number_table;
tb_vl_liberado_w		pls_util_cta_pck.t_number_table;
tb_vl_beneficiario_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_pp_lote_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_pp_evento_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_producao_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_segurado_w		pls_util_cta_pck.t_number_table;
tb_cd_guia_w			pls_util_cta_pck.t_varchar2_table_20;
tb_nr_seq_prest_atend_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_partic_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_grau_partic_w		pls_util_cta_pck.t_number_table;
tb_vl_glosa_w			pls_util_cta_pck.t_number_table;
tb_vl_unitario_w		pls_util_cta_pck.t_number_table;
tb_vl_unitario_calc_w		pls_util_cta_pck.t_number_table;
tb_cd_guia_referencia_w		pls_util_cta_pck.t_varchar2_table_20;
tb_dt_competencia_w		pls_util_cta_pck.t_date_table;
tb_ie_status_w			pls_util_cta_pck.t_varchar2_table_1;
tb_ie_tipo_guia_w		pls_util_cta_pck.t_varchar2_table_10;
tb_ds_item_w			pls_util_cta_pck.t_varchar2_table_255;
tb_nm_prestador_pgto_w		pls_util_cta_pck.t_varchar2_table_255;
tb_ie_tipo_item_w		pls_util_cta_pck.t_varchar2_table_10;
tb_ds_tipo_item_w		pls_util_cta_pck.t_varchar2_table_200;
tb_nr_seq_prest_exec_w		pls_util_cta_pck.t_number_table;
tb_nm_prestador_exec_w		pls_util_cta_pck.t_varchar2_table_255;
tb_nr_seq_tipo_atend_w		pls_util_cta_pck.t_number_table;
tb_ie_origem_conta_w		pls_util_cta_pck.t_varchar2_table_1;
tb_ie_tipo_despesa_w		pls_util_cta_pck.t_varchar2_table_10;
tb_nr_seq_pag_item_w		pls_util_cta_pck.t_number_table;
tb_ie_tipo_contrat_w		pls_util_cta_pck.t_varchar2_table_2;
tb_nr_seq_regra_valor_w		pls_util_cta_pck.t_number_table;
tb_pr_liberado_w		pls_util_cta_pck.t_number_table;
tb_nr_prest_venc_trib_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_protocolo_w		pls_util_cta_pck.t_number_table;
tb_ie_proc_mat_w		pls_util_cta_pck.t_varchar2_table_10;
tb_ie_status_prot_w		pls_util_cta_pck.t_varchar2_table_1;
tb_vl_taxa_adm_w		pls_util_cta_pck.t_number_table;
tb_nr_exame_coleta_w		pls_util_cta_pck.t_number_table;
tb_nr_honorario_crit_w		pls_util_cta_pck.t_number_table;
tb_vl_taxa_adm_co_w		pls_util_cta_pck.t_number_table;
tb_vl_taxa_adm_mat_w		pls_util_cta_pck.t_number_table;
tb_pr_taxa_adm_co_w		pls_util_cta_pck.t_number_table;
tb_pr_taxa_adm_mat_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_prot_ref_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_grupo_ans_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_fatura_w		pls_util_cta_pck.t_number_table;
tb_cd_coop_pgto_w		pls_util_cta_pck.t_varchar2_table_10;
tb_cd_guia_prestador_w		pls_util_cta_pck.t_varchar2_table_20;
tb_dt_item_w			pls_util_cta_pck.t_date_table;
tb_dt_comp_pgto_w		pls_util_cta_pck.t_date_table;
tb_nr_prot_prestador_w		pls_util_cta_pck.t_varchar2_table_20;
tb_vl_lib_original_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_regra_pgto_w		pls_util_cta_pck.t_number_table;
tb_ie_contador_w		pls_util_cta_pck.t_varchar2_table_1;
tb_ds_log_w			pls_util_cta_pck.t_varchar2_table_255;
tb_nr_serv_pre_pgto_w		pls_util_cta_pck.t_number_table;
tb_vl_provisorio_w		pls_util_cta_pck.t_number_table;
tb_ie_tipo_data_pgto_w		pls_util_cta_pck.t_varchar2_table_10;
tb_nr_seq_conta_mat_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_conta_proc_w		pls_util_cta_pck.t_number_table;
tb_conta_proc_partic_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_esquema_w		pls_util_cta_pck.t_number_table;
tb_cd_conta_deb_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_conta_cred_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_classif_deb_w		pls_util_cta_pck.t_varchar2_table_50;
tb_cd_classif_cred_w		pls_util_cta_pck.t_varchar2_table_50;
tb_cd_historico_w		pls_util_cta_pck.t_number_table;
tb_conta_glosa_cred_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_conta_glosa_deb_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_historico_glosa_w		pls_util_cta_pck.t_number_table;
tb_classif_glosa_cred_w		pls_util_cta_pck.t_varchar2_table_50;
tb_classif_glosa_deb_w		pls_util_cta_pck.t_varchar2_table_50;
tb_nr_esquema_glosa_w		pls_util_cta_pck.t_number_table;
tb_vl_hm_w			pls_util_cta_pck.t_number_table;
tb_vl_co_pag_w			pls_util_cta_pck.t_number_table;
tb_vl_materiais_pag_w		pls_util_cta_pck.t_number_table;
tb_vl_taxa_adm_pag_w		pls_util_cta_pck.t_number_table;
tb_ie_ato_cooperado_w		pls_util_cta_pck.t_varchar2_table_1;
tb_nr_regra_cooperado_w		pls_util_cta_pck.t_number_table;
tb_classif_prov_cred_w		pls_util_cta_pck.t_varchar2_table_50;
tb_classif_prov_deb_w		pls_util_cta_pck.t_varchar2_table_50;
tb_cd_conta_prov_cred_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_conta_prov_deb_w		pls_util_cta_pck.t_varchar2_table_20;
tb_cd_historico_prov_w		pls_util_cta_pck.t_number_table;
tb_nr_esquema_prov_w		pls_util_cta_pck.t_number_table;
tb_cd_hist_vl_ajuste_w		pls_util_cta_pck.t_number_table;
tb_vl_apres_ind_w		pls_util_cta_pck.t_number_table;
tb_vl_liberado_ant_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_pp_item_w		pls_util_cta_pck.t_number_table;
tb_nr_seq_resumo_est_w		pls_util_cta_pck.t_number_table;
tb_ie_saude_ocupacional_w	pls_util_cta_pck.t_varchar2_table_5;
tb_ie_regime_atendimento_w	pls_util_cta_pck.t_varchar2_table_5;

c01 CURSOR(	nr_seq_lote_pc		pls_pp_lote.nr_sequencia%type,
		nr_seq_pp_prest_pc	pls_pp_prestador.nr_sequencia%type) FOR
	SELECT	d.cd_classif_cred, d.cd_classif_deb, d.cd_classif_glosa_cred,
		d.cd_classif_glosa_deb, d.cd_classif_prov_cred, d.cd_classif_prov_deb,
		d.cd_conta_cred, d.cd_conta_deb, d.cd_conta_glosa_cred,
		d.cd_conta_glosa_deb, d.cd_conta_prov_cred, d.cd_conta_prov_deb,
		d.cd_cooperativa_pgto, d.cd_guia, d.cd_guia_prestador,
		d.cd_guia_referencia, d.cd_historico, d.cd_historico_glosa,
		d.cd_historico_prov, d.cd_historico_vl_ajuste, d.cd_pessoa_fisica,
		d.cd_procedimento, d.ds_item, d.ds_log,
		d.ds_tipo_item, d.dt_competencia, d.dt_competencia_pgto,
		d.dt_item, d.ie_ato_cooperado, d.ie_contador,
		d.ie_origem_conta, d.ie_origem_proced, d.ie_proc_mat,
		d.ie_status, d.ie_status_protocolo, d.ie_tipo_contratacao,
		d.ie_tipo_data_pagamento, d.ie_tipo_despesa, d.ie_tipo_guia, 
		d.ie_tipo_item, d.nm_prestador_exec, d.nm_prestador_pgto, 
		d.nr_protocolo_prestador, d.nr_seq_competencia, d.nr_seq_conta, 
		d.nr_seq_conta_mat, d.nr_seq_conta_proc, d.nr_seq_conta_proc_partic, 
		d.nr_seq_esquema, d.nr_seq_esquema_glosa, d.nr_seq_esquema_prov, 
		d.nr_seq_exame_coleta, d.nr_seq_fatura, d.nr_seq_grau_partic, 
		d.nr_seq_grupo_ans, d.nr_seq_honorario_crit, d.nr_seq_item, 
		d.nr_seq_material, d.nr_seq_pag_item, d.nr_seq_participante,
		d.nr_seq_pp_evento, d.nr_seq_pp_lote, d.nr_seq_prestador_atend,
		d.nr_seq_prestador_exec, d.nr_seq_prestador_pgto, d.nr_seq_prest_venc_trib,
		d.nr_seq_producao, d.nr_seq_protocolo, d.nr_seq_prot_referencia,
		d.nr_seq_regra_cooperado, d.nr_seq_regra_pgto, d.nr_seq_regra_valor,
		d.nr_seq_segurado, d.nr_seq_serv_pre_pgto, d.nr_seq_tipo_atendimento,
		d.nr_sequencia, d.pr_liberado, d.pr_taxa_adm_co,
		d.pr_taxa_adm_mat, d.qt_item, d.vl_anestesista,
		d.vl_apresentado, d.vl_apres_ind, d.vl_auxiliares,
		d.vl_beneficiario, d.vl_calculado, d.vl_co_pag,
		d.vl_custo_operacional, d.vl_glosa, d.vl_hm,
		d.vl_liberado, d.vl_liberado_ant, d.vl_lib_original,
		d.vl_materiais, d.vl_materiais_pag, d.vl_medico,
		d.vl_provisorio, d.vl_taxa_adm, d.vl_taxa_adm_co,
		d.vl_taxa_adm_mat, d.vl_taxa_adm_pag, d.vl_unitario,
		d.vl_unitario_calculado, c.nr_sequencia nr_seq_pp_item, d.ie_saude_ocupacional,
		d.ie_regime_atendimento
	from	pls_pp_prest_event_prest a,
		pls_pp_it_prest_event_val b,
		pls_pp_item_lote c,
		pls_conta_medica_resumo d
	where	a.nr_seq_pp_prest = nr_seq_pp_prest_pc
	and	b.nr_seq_prest_even_val = a.nr_seq_pp_prest_even_val
	and	c.nr_seq_lote = nr_seq_lote_pc
	and	c.nr_sequencia = b.nr_seq_item_lote
	and	c.ie_tipo_item = '1'
	and	d.nr_sequencia = c.nr_seq_resumo
	and	d.nr_seq_conta = c.nr_seq_conta;


BEGIN
-- retornar todos os itens do pagamento de producao medica que sejam de producao

open c01(nr_seq_lote_p, nr_seq_pp_prest_p);
loop
	fetch c01 bulk collect into	tb_cd_classif_deb_w, tb_cd_classif_cred_w, tb_classif_glosa_cred_w,
					tb_classif_glosa_deb_w, tb_classif_prov_cred_w, tb_classif_prov_deb_w,
					tb_cd_conta_cred_w, tb_cd_conta_deb_w, tb_conta_glosa_cred_w,
					tb_cd_conta_glosa_deb_w, tb_cd_conta_prov_cred_w, tb_cd_conta_prov_deb_w,
					tb_cd_coop_pgto_w, tb_cd_guia_w, tb_cd_guia_prestador_w,
					tb_cd_guia_referencia_w, tb_cd_historico_w, tb_cd_historico_glosa_w,
					tb_cd_historico_prov_w, tb_cd_hist_vl_ajuste_w, tb_cd_pessoa_fisica_w,
					tb_cd_procedimento_w, tb_ds_item_w, tb_ds_log_w,
					tb_ds_tipo_item_w, tb_dt_competencia_w, tb_dt_comp_pgto_w,
					tb_dt_item_w, tb_ie_ato_cooperado_w, tb_ie_contador_w,
					tb_ie_origem_conta_w, tb_ie_origem_proced_w, tb_ie_proc_mat_w,
					tb_ie_status_w, tb_ie_status_prot_w, tb_ie_tipo_contrat_w, 
					tb_ie_tipo_data_pgto_w, tb_ie_tipo_despesa_w, tb_ie_tipo_guia_w, 
					tb_ie_tipo_item_w, tb_nm_prestador_exec_w, tb_nm_prestador_pgto_w, 
					tb_nr_prot_prestador_w, tb_nr_seq_competencia_w, tb_nr_seq_conta_w, 
					tb_nr_seq_conta_mat_w, tb_nr_seq_conta_proc_w, tb_conta_proc_partic_w, 
					tb_nr_seq_esquema_w, tb_nr_esquema_glosa_w, tb_nr_esquema_prov_w, 
					tb_nr_exame_coleta_w, tb_nr_seq_fatura_w, tb_nr_seq_grau_partic_w, 
					tb_nr_seq_grupo_ans_w, tb_nr_honorario_crit_w, tb_nr_seq_item_w, 
					tb_nr_seq_material_w, tb_nr_seq_pag_item_w, tb_nr_seq_partic_w,
					tb_nr_seq_pp_evento_w, tb_nr_seq_pp_lote_w, tb_nr_seq_prest_atend_w,
					tb_nr_seq_prest_exec_w, tb_nr_seq_prest_pgto_w, tb_nr_prest_venc_trib_w,
					tb_nr_seq_producao_w, tb_nr_seq_protocolo_w, tb_nr_seq_prot_ref_w,
					tb_nr_regra_cooperado_w, tb_nr_seq_regra_pgto_w, tb_nr_seq_regra_valor_w,
					tb_nr_seq_segurado_w, tb_nr_serv_pre_pgto_w, tb_nr_seq_tipo_atend_w,
					tb_nr_sequencia_w, tb_pr_liberado_w, tb_pr_taxa_adm_co_w,
					tb_pr_taxa_adm_mat_w, tb_qt_item_w, tb_vl_anestesista_w,
					tb_vl_apresentado_w, tb_vl_apres_ind_w, tb_vl_auxiliares_w,
					tb_vl_beneficiario_w, tb_vl_calculado_w, tb_vl_co_pag_w,
					tb_vl_custo_oper_w, tb_vl_glosa_w, tb_vl_hm_w,
					tb_vl_liberado_w, tb_vl_liberado_ant_w, tb_vl_lib_original_w,
					tb_vl_materiais_w, tb_vl_materiais_pag_w, tb_vl_medico_w,
					tb_vl_provisorio_w, tb_vl_taxa_adm_w, tb_vl_taxa_adm_co_w,
					tb_vl_taxa_adm_mat_w, tb_vl_taxa_adm_pag_w, tb_vl_unitario_w,
					tb_vl_unitario_calc_w, tb_nr_seq_pp_item_w, tb_ie_saude_ocupacional_w,
					tb_ie_regime_atendimento_w
	limit pls_util_pck.qt_registro_transacao_w;
	exit when tb_nr_sequencia_w.count = 0;

	-- inativa o registro da conta medica resumo que esta sendo cancelado

	forall i in tb_nr_sequencia_w.first..tb_nr_sequencia_w.last
		update	pls_conta_medica_resumo
		set	ie_situacao = 'I'
		where	nr_seq_conta = tb_nr_seq_conta_w(i)
		and	nr_sequencia = tb_nr_sequencia_w(i);
	commit;

	-- insere um registro de estorno na conta medica resumo e retorna a sequencia dos registros inseridos

	forall i in tb_nr_sequencia_w.first..tb_nr_sequencia_w.last
		insert into pls_conta_medica_resumo(
			cd_classif_cred, cd_classif_deb, cd_classif_glosa_cred,
			cd_classif_glosa_deb, cd_classif_prov_cred, cd_classif_prov_deb,
			cd_conta_cred, cd_conta_deb, cd_conta_glosa_cred,
			cd_conta_glosa_deb, cd_conta_prov_cred, cd_conta_prov_deb,
			cd_cooperativa_pgto, cd_guia, cd_guia_prestador,
			cd_guia_referencia, cd_historico, cd_historico_glosa,
			cd_historico_prov, cd_historico_vl_ajuste, cd_pessoa_fisica,
			cd_procedimento, ds_item, ds_log,
			ds_tipo_item, dt_competencia, dt_competencia_pgto,
			dt_item, ie_ato_cooperado, ie_contador,
			ie_origem_conta, ie_origem_proced, ie_proc_mat,
			ie_situacao, ie_status, ie_status_protocolo,
			ie_tipo_contratacao, ie_tipo_data_pagamento, ie_tipo_despesa,
			ie_tipo_guia, ie_tipo_item, nm_prestador_exec,
			nm_prestador_pgto, nr_lote_contabil_pag, nr_lote_contabil_prov,
			nr_lote_contabil_rev, nr_lote_contab_pag, nr_protocolo_prestador,
			nr_seq_competencia, nr_seq_conta, nr_seq_conta_mat,
			nr_seq_conta_proc, nr_seq_conta_proc_partic, nr_seq_esquema,
			nr_seq_esquema_glosa, nr_seq_esquema_prov, nr_seq_exame_coleta,
			nr_seq_fatura, nr_seq_grau_partic, nr_seq_grupo_ans,
			nr_seq_honorario_crit, nr_seq_item, nr_seq_material,
			nr_seq_mvto_pag_cred, nr_seq_mvto_pag_deb, nr_seq_mvto_rev_cred,
			nr_seq_mvto_rev_deb, nr_seq_pag_item, nr_seq_participante,
			nr_seq_pp_evento, nr_seq_pp_lote, nr_seq_prestador_atend,
			nr_seq_prestador_exec, nr_seq_prestador_pgto, nr_seq_prest_venc_trib,
			nr_seq_producao, nr_seq_protocolo, nr_seq_prot_referencia,
			nr_seq_regra_cooperado, nr_seq_regra_pgto, nr_seq_regra_valor,
			nr_seq_segurado, nr_seq_serv_pre_pgto, nr_seq_tipo_atendimento,
			nr_sequencia, pr_liberado, pr_taxa_adm_co,
			pr_taxa_adm_mat, qt_item, vl_anestesista,
			vl_apresentado, vl_apres_ind, vl_auxiliares,
			vl_beneficiario, vl_calculado, vl_co_pag,
			vl_custo_operacional, vl_glosa, vl_hm,
			vl_liberado, vl_liberado_ant, vl_lib_original,
			vl_materiais, vl_materiais_pag, vl_medico,
			vl_provisorio, vl_taxa_adm, vl_taxa_adm_co,
			vl_taxa_adm_mat, vl_taxa_adm_pag, vl_unitario,
			vl_unitario_calculado, dt_atualizacao, nm_usuario,
			ie_saude_ocupacional, ie_regime_atendimento
		) values (
			tb_cd_classif_deb_w(i), tb_cd_classif_cred_w(i), tb_classif_glosa_cred_w(i),
			tb_classif_glosa_deb_w(i), tb_classif_prov_cred_w(i), tb_classif_prov_deb_w(i),
			tb_cd_conta_cred_w(i), tb_cd_conta_deb_w(i), tb_conta_glosa_cred_w(i),
			tb_cd_conta_glosa_deb_w(i), tb_cd_conta_prov_cred_w(i), tb_cd_conta_prov_deb_w(i),
			tb_cd_coop_pgto_w(i), tb_cd_guia_w(i), tb_cd_guia_prestador_w(i),
			tb_cd_guia_referencia_w(i), tb_cd_historico_w(i), tb_cd_historico_glosa_w(i),
			tb_cd_historico_prov_w(i), tb_cd_hist_vl_ajuste_w(i), tb_cd_pessoa_fisica_w(i),
			tb_cd_procedimento_w(i), tb_ds_item_w(i), tb_ds_log_w(i),
			tb_ds_tipo_item_w(i), tb_dt_competencia_w(i), tb_dt_comp_pgto_w(i),
			tb_dt_item_w(i), tb_ie_ato_cooperado_w(i), tb_ie_contador_w(i),
			tb_ie_origem_conta_w(i), tb_ie_origem_proced_w(i), tb_ie_proc_mat_w(i),
			'I', tb_ie_status_w(i), tb_ie_status_prot_w(i),
			tb_ie_tipo_contrat_w(i), tb_ie_tipo_data_pgto_w(i), tb_ie_tipo_despesa_w(i),
			tb_ie_tipo_guia_w(i), tb_ie_tipo_item_w(i), tb_nm_prestador_exec_w(i),
			tb_nm_prestador_pgto_w(i), 0, 0,
			0, 0, tb_nr_prot_prestador_w(i),
			tb_nr_seq_competencia_w(i), tb_nr_seq_conta_w(i), tb_nr_seq_conta_mat_w(i),
			tb_nr_seq_conta_proc_w(i), tb_conta_proc_partic_w(i), tb_nr_seq_esquema_w(i),
			tb_nr_esquema_glosa_w(i), tb_nr_esquema_prov_w(i), tb_nr_exame_coleta_w(i),
			tb_nr_seq_fatura_w(i), tb_nr_seq_grau_partic_w(i), tb_nr_seq_grupo_ans_w(i),
			tb_nr_honorario_crit_w(i), tb_nr_seq_item_w(i), tb_nr_seq_material_w(i),
			null, null, null,
			null, tb_nr_seq_pag_item_w(i), tb_nr_seq_partic_w(i),
			tb_nr_seq_pp_evento_w(i), tb_nr_seq_pp_lote_w(i), tb_nr_seq_prest_atend_w(i),
			tb_nr_seq_prest_exec_w(i), tb_nr_seq_prest_pgto_w(i), tb_nr_prest_venc_trib_w(i),
			tb_nr_seq_producao_w(i), tb_nr_seq_protocolo_w(i), tb_nr_seq_prot_ref_w(i),
			tb_nr_regra_cooperado_w(i), tb_nr_seq_regra_pgto_w(i), tb_nr_seq_regra_valor_w(i),
			tb_nr_seq_segurado_w(i), tb_nr_serv_pre_pgto_w(i), tb_nr_seq_tipo_atend_w(i),
			nextval('pls_conta_medica_resumo_seq'), tb_pr_liberado_w(i), tb_pr_taxa_adm_co_w(i),
			tb_pr_taxa_adm_mat_w(i), tb_qt_item_w(i) * -1, tb_vl_anestesista_w(i) * -1,
			tb_vl_apresentado_w(i) * -1, tb_vl_apres_ind_w(i) * -1, tb_vl_auxiliares_w(i) * -1,
			tb_vl_beneficiario_w(i) * -1, tb_vl_calculado_w(i) * -1, tb_vl_co_pag_w(i) * -1,
			tb_vl_custo_oper_w(i) * -1, tb_vl_glosa_w(i) * -1, tb_vl_hm_w(i) * -1,
			tb_vl_liberado_w(i) * -1, tb_vl_liberado_ant_w(i) * -1, tb_vl_lib_original_w(i) * -1,
			tb_vl_materiais_w(i) * -1, tb_vl_materiais_pag_w(i) * -1, tb_vl_medico_w(i) * -1,
			tb_vl_provisorio_w(i) * -1, tb_vl_taxa_adm_w(i) * -1, tb_vl_taxa_adm_co_w(i) * -1,
			tb_vl_taxa_adm_mat_w(i) * -1, tb_vl_taxa_adm_pag_w(i) * -1, tb_vl_unitario_w(i) * -1,
			tb_vl_unitario_calc_w(i) * -1, clock_timestamp(), nm_usuario_p,
			tb_ie_saude_ocupacional_w(i), tb_ie_regime_atendimento_w(i)
		) returning nr_sequencia bulk collect into tb_nr_seq_resumo_est_w;
	commit;

	-- faz o vinculo do item de estorno da conta medica com o item de estorno da pls_pp_item_lote

	forall i in tb_nr_sequencia_w.first..tb_nr_sequencia_w.last
		update	pls_pp_item_lote
		set	nr_seq_conta = tb_nr_seq_conta_w(i),
			nr_seq_resumo = tb_nr_seq_resumo_est_w(i)
		where	nr_seq_lote = nr_seq_lote_p
		and	nr_seq_origem_estorno = tb_nr_seq_pp_item_w(i);

	-- insere um registro pendente

	forall i in tb_nr_sequencia_w.first..tb_nr_sequencia_w.last
		insert into pls_conta_medica_resumo(
			cd_classif_cred, cd_classif_deb, cd_classif_glosa_cred,
			cd_classif_glosa_deb, cd_classif_prov_cred, cd_classif_prov_deb,
			cd_conta_cred, cd_conta_deb, cd_conta_glosa_cred,
			cd_conta_glosa_deb, cd_conta_prov_cred, cd_conta_prov_deb,
			cd_cooperativa_pgto, cd_guia, cd_guia_prestador,
			cd_guia_referencia, cd_historico, cd_historico_glosa,
			cd_historico_prov, cd_historico_vl_ajuste, cd_pessoa_fisica,
			cd_procedimento, ds_item, ds_log,
			ds_tipo_item, dt_competencia, dt_competencia_pgto,
			dt_item, ie_ato_cooperado, ie_contador,
			ie_origem_conta, ie_origem_proced, ie_proc_mat,
			ie_situacao, ie_status, ie_status_protocolo,
			ie_tipo_contratacao, ie_tipo_data_pagamento, ie_tipo_despesa,
			ie_tipo_guia, ie_tipo_item, nm_prestador_exec,
			nm_prestador_pgto, nr_lote_contabil_pag, nr_lote_contabil_prov,
			nr_lote_contabil_rev, nr_lote_contab_pag, nr_protocolo_prestador,
			nr_seq_competencia, nr_seq_conta, nr_seq_conta_mat,
			nr_seq_conta_proc, nr_seq_conta_proc_partic, nr_seq_esquema,
			nr_seq_esquema_glosa, nr_seq_esquema_prov, nr_seq_exame_coleta,
			nr_seq_fatura, nr_seq_grau_partic, nr_seq_grupo_ans,
			nr_seq_honorario_crit, nr_seq_item, nr_seq_material,
			nr_seq_mvto_pag_cred, nr_seq_mvto_pag_deb, nr_seq_mvto_rev_cred,
			nr_seq_mvto_rev_deb, nr_seq_pag_item, nr_seq_participante,
			nr_seq_pp_evento, nr_seq_pp_lote, nr_seq_prestador_atend,
			nr_seq_prestador_exec, nr_seq_prestador_pgto, nr_seq_prest_venc_trib,
			nr_seq_producao, nr_seq_protocolo, nr_seq_prot_referencia,
			nr_seq_regra_cooperado, nr_seq_regra_pgto, nr_seq_regra_valor,
			nr_seq_segurado, nr_seq_serv_pre_pgto, nr_seq_tipo_atendimento,
			nr_sequencia, pr_liberado, pr_taxa_adm_co,
			pr_taxa_adm_mat, qt_item, vl_anestesista,
			vl_apresentado, vl_apres_ind, vl_auxiliares,
			vl_beneficiario, vl_calculado, vl_co_pag,
			vl_custo_operacional, vl_glosa, vl_hm,
			vl_liberado, vl_liberado_ant, vl_lib_original,
			vl_materiais, vl_materiais_pag, vl_medico,
			vl_provisorio, vl_taxa_adm, vl_taxa_adm_co,
			vl_taxa_adm_mat, vl_taxa_adm_pag, vl_unitario,
			vl_unitario_calculado, dt_atualizacao, nm_usuario,
			ie_saude_ocupacional, ie_regime_atendimento
		) values (
			tb_cd_classif_deb_w(i), tb_cd_classif_cred_w(i), tb_classif_glosa_cred_w(i),
			tb_classif_glosa_deb_w(i), tb_classif_prov_cred_w(i), tb_classif_prov_deb_w(i),
			tb_cd_conta_cred_w(i), tb_cd_conta_deb_w(i), tb_conta_glosa_cred_w(i),
			tb_cd_conta_glosa_deb_w(i), tb_cd_conta_prov_cred_w(i), tb_cd_conta_prov_deb_w(i),
			tb_cd_coop_pgto_w(i), tb_cd_guia_w(i), tb_cd_guia_prestador_w(i),
			tb_cd_guia_referencia_w(i), tb_cd_historico_w(i), tb_cd_historico_glosa_w(i),
			tb_cd_historico_prov_w(i), tb_cd_hist_vl_ajuste_w(i), tb_cd_pessoa_fisica_w(i),
			tb_cd_procedimento_w(i), tb_ds_item_w(i), tb_ds_log_w(i),
			tb_ds_tipo_item_w(i), tb_dt_competencia_w(i), tb_dt_comp_pgto_w(i),
			tb_dt_item_w(i), tb_ie_ato_cooperado_w(i), tb_ie_contador_w(i),
			tb_ie_origem_conta_w(i), tb_ie_origem_proced_w(i), tb_ie_proc_mat_w(i),
			'A', tb_ie_status_w(i), tb_ie_status_prot_w(i),
			tb_ie_tipo_contrat_w(i), tb_ie_tipo_data_pgto_w(i), tb_ie_tipo_despesa_w(i),
			tb_ie_tipo_guia_w(i), tb_ie_tipo_item_w(i), tb_nm_prestador_exec_w(i),
			tb_nm_prestador_pgto_w(i), 0, 0,
			0, 0, tb_nr_prot_prestador_w(i),
			tb_nr_seq_competencia_w(i), tb_nr_seq_conta_w(i), tb_nr_seq_conta_mat_w(i),
			tb_nr_seq_conta_proc_w(i), tb_conta_proc_partic_w(i), tb_nr_seq_esquema_w(i),
			tb_nr_esquema_glosa_w(i), tb_nr_esquema_prov_w(i), tb_nr_exame_coleta_w(i),
			tb_nr_seq_fatura_w(i), tb_nr_seq_grau_partic_w(i), tb_nr_seq_grupo_ans_w(i),
			tb_nr_honorario_crit_w(i), tb_nr_seq_item_w(i), tb_nr_seq_material_w(i),
			null, null, null,
			null, tb_nr_seq_pag_item_w(i), tb_nr_seq_partic_w(i),
			tb_nr_seq_pp_evento_w(i), null, tb_nr_seq_prest_atend_w(i),
			tb_nr_seq_prest_exec_w(i), tb_nr_seq_prest_pgto_w(i), tb_nr_prest_venc_trib_w(i),
			tb_nr_seq_producao_w(i), tb_nr_seq_protocolo_w(i), tb_nr_seq_prot_ref_w(i),
			tb_nr_regra_cooperado_w(i), tb_nr_seq_regra_pgto_w(i), tb_nr_seq_regra_valor_w(i),
			tb_nr_seq_segurado_w(i), tb_nr_serv_pre_pgto_w(i), tb_nr_seq_tipo_atend_w(i),
			nextval('pls_conta_medica_resumo_seq'), tb_pr_liberado_w(i), tb_pr_taxa_adm_co_w(i),
			tb_pr_taxa_adm_mat_w(i), tb_qt_item_w(i), tb_vl_anestesista_w(i),
			tb_vl_apresentado_w(i), tb_vl_apres_ind_w(i), tb_vl_auxiliares_w(i),
			tb_vl_beneficiario_w(i), tb_vl_calculado_w(i), tb_vl_co_pag_w(i),
			tb_vl_custo_oper_w(i), tb_vl_glosa_w(i), tb_vl_hm_w(i),
			tb_vl_liberado_w(i), tb_vl_liberado_ant_w(i), tb_vl_lib_original_w(i),
			tb_vl_materiais_w(i), tb_vl_materiais_pag_w(i), tb_vl_medico_w(i),
			tb_vl_provisorio_w(i), tb_vl_taxa_adm_w(i), tb_vl_taxa_adm_co_w(i),
			tb_vl_taxa_adm_mat_w(i), tb_vl_taxa_adm_pag_w(i), tb_vl_unitario_w(i),
			tb_vl_unitario_calc_w(i), clock_timestamp(), nm_usuario_p,
			tb_ie_saude_ocupacional_w(i), tb_ie_regime_atendimento_w(i)
		);
	commit;
end loop;
close c01;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_pp_canc_pgto_prest_pck.cancelar_ie_tipo_item_1 ( nr_seq_lote_p pls_pp_lote.nr_sequencia%type, nr_seq_pp_prest_p pls_pp_prestador.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
