-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_ocor_imp_pck.gravar_lista_filtro ( nr_id_transacao_p pls_oc_cta_selecao_imp.nr_id_transacao%type, nr_seq_filtro_p pls_oc_cta_filtro.nr_sequencia%type, ie_valido_p pls_oc_cta_selecao_imp.ie_valido%type, nr_seq_conta_p pls_util_cta_pck.t_number_table, nr_seq_conta_proc_p pls_util_cta_pck.t_number_table, nr_seq_conta_mat_p pls_util_cta_pck.t_number_table, nr_seq_segurado_p pls_util_cta_pck.t_number_table, cd_guia_referencia_p pls_util_cta_pck.t_varchar2_table_20, tb_dt_item_p pls_util_cta_pck.t_date_table, tb_dt_hora_ini_p pls_util_cta_pck.t_date_table, tb_dt_hora_fim_p pls_util_cta_pck.t_date_table, tb_ie_origem_proced_p pls_util_cta_pck.t_number_table, tb_cd_procedimento_p pls_util_cta_pck.t_number_table, tb_seq_material_p pls_util_cta_pck.t_number_table) AS $body$
BEGIN
-- Insere todos os registros contidos na lista passada por parametro em um anico 

-- acesso ao contexto de SQL. Serve somente para a manutenaao do processamento 

-- de filtros.

if (nr_seq_conta_p.count > 0) then

	forall i in nr_seq_conta_p.first..nr_seq_conta_p.last
		insert into pls_oc_cta_selecao_imp(	nr_sequencia, nr_id_transacao,
				nr_seq_conta, nr_seq_conta_proc, 
				nr_seq_conta_mat, nr_seq_filtro,
				nr_seq_segurado, cd_guia_referencia,
				ie_valido, ie_valido_temp,
				ie_excecao, ie_tipo_registro,
				ie_marcado_excecao, dt_item,
				dt_item_hora_ini, dt_item_hora_fim,
				ie_origem_proced, cd_procedimento,
				nr_seq_material)
		values (	nextval('pls_oc_cta_selecao_imp_seq'), nr_id_transacao_p,
				nr_seq_conta_p(i), nr_seq_conta_proc_p(i),
				nr_seq_conta_mat_p(i), nr_seq_filtro_p,
				nr_seq_segurado_p(i), cd_guia_referencia_p(i),
				ie_valido_p, 'S',
				'N', CASE WHEN coalesce(nr_seq_conta_proc_p(i)::text, '') = '' THEN  CASE WHEN coalesce(nr_seq_conta_mat_p(i)::text, '') = '' THEN  'C'  ELSE 'M' END   ELSE 'P' END ,
				'N', tb_dt_item_p(i),
				tb_dt_hora_ini_p(i), tb_dt_hora_fim_p(i),
				tb_ie_origem_proced_p(i), tb_cd_procedimento_p(i),
				tb_seq_material_p(i));
	commit;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_ocor_imp_pck.gravar_lista_filtro ( nr_id_transacao_p pls_oc_cta_selecao_imp.nr_id_transacao%type, nr_seq_filtro_p pls_oc_cta_filtro.nr_sequencia%type, ie_valido_p pls_oc_cta_selecao_imp.ie_valido%type, nr_seq_conta_p pls_util_cta_pck.t_number_table, nr_seq_conta_proc_p pls_util_cta_pck.t_number_table, nr_seq_conta_mat_p pls_util_cta_pck.t_number_table, nr_seq_segurado_p pls_util_cta_pck.t_number_table, cd_guia_referencia_p pls_util_cta_pck.t_varchar2_table_20, tb_dt_item_p pls_util_cta_pck.t_date_table, tb_dt_hora_ini_p pls_util_cta_pck.t_date_table, tb_dt_hora_fim_p pls_util_cta_pck.t_date_table, tb_ie_origem_proced_p pls_util_cta_pck.t_number_table, tb_cd_procedimento_p pls_util_cta_pck.t_number_table, tb_seq_material_p pls_util_cta_pck.t_number_table) FROM PUBLIC;
