-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE dpc_pkg.validate_diagnosis_record (NR_SEQ_PATIENT_DPC_P bigint,NR_SEQ_PAT_DIAGNOSIS_P bigint,SI_MAIN_P text,SI_FOR_HOSPITALIZATION_P text, SI_SECOND_MOST_EXPENSIVE_P text,SI_SUB_DISEASE_P text,SI_COMORBIDITY_BEFORE_P text,SI_AFTER_ADMISSION_P text) AS $body$
DECLARE

SI_MAIN_W bigint;
SI_FOR_HOSPITALIZATION_W bigint;
SI_SECOND_MOST_EXPENSIVE_W bigint;
SI_SUB_DISEASE_W bigint;
SI_COMORBIDITY_BEFORE_W bigint;
SI_AFTER_ADMISSION_W bigint;


BEGIN

if (SI_MAIN_P ='Y') then

	select count(1) CNT
		into STRICT SI_MAIN_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_MAIN='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_MAIN_W>0)then

                    CALL wheb_mensagem_pck.exibir_mensagem_abort(1120950,'DS_LABEL_FIELD=' || obter_desc_expressao(968948));

            end if;

elsif (SI_FOR_HOSPITALIZATION_P ='Y') then

	select count(1) CNT
		into STRICT SI_FOR_HOSPITALIZATION_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_FOR_HOSPITALIZATION='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_FOR_HOSPITALIZATION_W>0)then

                    CALL wheb_mensagem_pck.exibir_mensagem_abort(1120950,'DS_LABEL_FIELD=' || obter_desc_expressao(709740));

            end if;

elsif (SI_SECOND_MOST_EXPENSIVE_P='Y') then

	select count(1) CNT
		into STRICT SI_SECOND_MOST_EXPENSIVE_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_SECOND_MOST_EXPENSIVE='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_SECOND_MOST_EXPENSIVE_W>0)then

                CALL wheb_mensagem_pck.exibir_mensagem_abort(1120950,'DS_LABEL_FIELD=' || obter_desc_expressao(968950));

            end if;


elsif (SI_SUB_DISEASE_P='Y') then

	select count(1) CNT
		into STRICT SI_SUB_DISEASE_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_SUB_DISEASE='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_SUB_DISEASE_W>0)then

                    CALL wheb_mensagem_pck.exibir_mensagem_abort(1120950,'DS_LABEL_FIELD=' || obter_desc_expressao(968952));

            end if;
end if;

if (SI_COMORBIDITY_BEFORE_P ='Y') then

	select count(1) CNT
		into STRICT SI_COMORBIDITY_BEFORE_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_COMORBIDITY_BEFORE='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_COMORBIDITY_BEFORE_W>=10)then

                    CALL wheb_mensagem_pck.exibir_mensagem_abort(1120995,'DS_LABEL_FIELD=' || obter_desc_expressao(968954));

            end if;
elsif (SI_AFTER_ADMISSION_P='Y') then

	select count(1) CNT
		into STRICT SI_AFTER_ADMISSION_W
		from PATIENT_DPC_DIAGNOSIS
		where nr_seq_patient_dpc = NR_SEQ_PATIENT_DPC_P
		and SI_AFTER_ADMISSION='Y'
		and nr_sequencia <> NR_SEQ_PAT_DIAGNOSIS_P;
            if (SI_AFTER_ADMISSION_W>=10)then

                    CALL wheb_mensagem_pck.exibir_mensagem_abort(1120995,'DS_LABEL_FIELD=' || obter_desc_expressao(968956));

            end if;
            end if;

end;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dpc_pkg.validate_diagnosis_record (NR_SEQ_PATIENT_DPC_P bigint,NR_SEQ_PAT_DIAGNOSIS_P bigint,SI_MAIN_P text,SI_FOR_HOSPITALIZATION_P text, SI_SECOND_MOST_EXPENSIVE_P text,SI_SUB_DISEASE_P text,SI_COMORBIDITY_BEFORE_P text,SI_AFTER_ADMISSION_P text) FROM PUBLIC;
