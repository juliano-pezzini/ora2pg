-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE dpc_pkg.set_dpc_code (NR_SEQ_PATIENT_DPC_P bigint, NR_SEQ_DPC_SCORE_P bigint) AS $body$
DECLARE

nr_seq_dpc_score_w dpc_score.qt_points_hosp_2%type;
qt_pts_dpc_w       patient_dpc.nr_seq_dpc_score%type;

BEGIN
    select   max(qt_points_hosp_2)
    into STRICT     qt_pts_dpc_w
    from     dpc_score
    where    nr_sequencia = nr_seq_dpc_score_p;

    select   max(nr_seq_dpc_score)
    into STRICT     nr_seq_dpc_score_w
    from     patient_dpc
    where    nr_sequencia     = nr_seq_patient_dpc_p;

    if (coalesce(nr_seq_dpc_score_w::text, '') = '') then
    if (coalesce(qt_pts_dpc_w,0) > 0) then
            update   patient_dpc
        set      nr_seq_dpc_score = nr_seq_dpc_score_p,
             si_category = '00'
        where    nr_sequencia     = nr_seq_patient_dpc_p;
    else
        update   patient_dpc
        set      nr_seq_dpc_score = nr_seq_dpc_score_p,
             si_category = '99'
        where    nr_sequencia     = nr_seq_patient_dpc_p;
    end if;
    else
        update   patient_dpc
        set      nr_seq_dpc_score = nr_seq_dpc_score_p
        where    nr_sequencia     = nr_seq_patient_dpc_p;
    end if;
commit;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dpc_pkg.set_dpc_code (NR_SEQ_PATIENT_DPC_P bigint, NR_SEQ_DPC_SCORE_P bigint) FROM PUBLIC;
