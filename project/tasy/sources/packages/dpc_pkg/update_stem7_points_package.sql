-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE dpc_pkg.update_stem7_points (nr_stem7_edition_p bigint) AS $body$
DECLARE

    c01 CURSOR FOR
        SELECT CD_KCODE,QT_POINT from dpc_stem7_points
        where nr_stem7_edition =nr_stem7_edition_p
        and CD_KCODE like 'K%'
        and ie_situacao ='A';
    r01_w   c01%rowtype;


BEGIN

        OPEN C01;
        LOOP
            FETCH c01 INTO r01_w;
            EXIT WHEN NOT FOUND; /* apply on C01 */
            BEGIN

            update dpc_stem7 set qt_point = r01_w.QT_POINT
            where replace(cd_k_surgery,' ','') =r01_w.CD_KCODE
            and ie_situacao='A'
            and nr_stem7_edition =nr_stem7_edition_p;

            END;
        END LOOP;

        COMMIT;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dpc_pkg.update_stem7_points (nr_stem7_edition_p bigint) FROM PUBLIC;
