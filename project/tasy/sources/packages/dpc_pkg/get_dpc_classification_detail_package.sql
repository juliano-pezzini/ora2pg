-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE dpc_pkg.get_dpc_classification_detail (nr_seq_patient_dpc_p bigint,nr_seq_interno_p bigint) AS $body$
DECLARE

si_outcome_w patient_dpc.si_out_come%type;
dt_start_w patient_dpc.dt_start_dpc%type;
dt_end_w patient_dpc.dt_end_dpc%type;
dt_inicio_w diagnostico_doenca.dt_inicio%type;
dt_fim_w diagnostico_doenca.dt_fim%type;
nr_atendimento_w patient_dpc.nr_atendimento%type;
nr_seq_interno_w patient_dpc.nr_seq_most_exp_diagnosis%type;

BEGIN

select  max(p.nr_atendimento), max(p.si_out_come), max(coalesce(p.dt_start_dpc,clock_timestamp())),max(coalesce(p.dt_end_dpc,clock_timestamp())), max(nr_seq_most_exp_diagnosis)
into STRICT    nr_atendimento_w, si_outcome_w, dt_start_w, dt_end_w, nr_seq_interno_w
from    patient_dpc p
where   p.nr_sequencia = nr_seq_patient_dpc_p;

select  coalesce(d.dt_inicio,clock_timestamp()), coalesce(d.dt_fim,clock_timestamp())
into STRICT    dt_inicio_w,dt_fim_w
from    diagnostico_doenca d
where   nr_atendimento = nr_atendimento_w
and     nr_seq_interno = nr_seq_interno_w;

if (si_outcome_w IS NOT NULL AND si_outcome_w::text <> '') then
        if (dt_fim_w < dt_start_w) then
                CALL wheb_mensagem_pck.exibir_mensagem_abort(1131939);
        end if;
else
        if (dt_inicio_w > dt_end_w) then
                CALL wheb_mensagem_pck.exibir_mensagem_abort(1131940);
        end if;
end if;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE dpc_pkg.get_dpc_classification_detail (nr_seq_patient_dpc_p bigint,nr_seq_interno_p bigint) FROM PUBLIC;
