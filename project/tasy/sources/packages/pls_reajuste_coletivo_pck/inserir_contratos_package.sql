-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_reajuste_coletivo_pck.inserir_contratos (ie_descarregar_vetores_p text) AS $body$
BEGIN
if	((nr_indice_contrato_w >= pls_util_pck.qt_registro_transacao_w) or (ie_descarregar_vetores_p = 'S')) then
	if (tb_nr_seq_reajuste_w.count > 0) then
		forall i in tb_nr_seq_reajuste_w.first..tb_nr_seq_reajuste_w.last
			insert into pls_reajuste(nr_sequencia, dt_atualizacao, nm_usuario, cd_estabelecimento,
					dt_atualizacao_nrec, nm_usuario_nrec, nr_seq_lote_referencia,
					dt_reajuste, ie_indice_reajuste, ie_tipo_reajuste, ie_status,
					ie_reajuste_tabela, nr_seq_contrato, nr_seq_intercambio,
					ie_tipo_contrato, nr_seq_plano, tx_reajuste,
					nr_seq_tipo_reajuste, ie_reajustar_copartic, tx_reajuste_copartic,
					tx_reajuste_copartic_max, ie_vinculo_coparticipacao, ie_reajustar_inscricao,
					tx_reajuste_inscricao, ie_reajustar_via_adic, tx_via_adicional,
					ie_reajustar_vl_manutencao, ie_aplicacao_reajuste, ie_reajustar_benef_cancelado,
					ie_caracteristica, ds_justificativa, tx_reajuste_proposto,
					ds_observacao, dt_aplicacao_reajuste, tx_deflator,
					dt_periodo_inicial, dt_periodo_final, ie_reaj_nao_aplicado,
					nr_contrato, ie_tipo_agrupamento_exclusivo, nr_seq_processo)
				values (nextval('pls_reajuste_seq'), clock_timestamp(), nm_usuario_p, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.cd_estabelecimento,
					clock_timestamp(), nm_usuario_p, tb_nr_seq_reajuste_w(i),
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.dt_reajuste, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_indice_reajuste, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_tipo_reajuste, tb_ie_status_w(i),
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_reajuste_tabela, tb_nr_seq_contrato_w(i), tb_nr_seq_intercambio_w(i),
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_tipo_contrato, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.nr_seq_plano, tb_tx_reajuste_w(i),
					tb_nr_seq_tipo_reajuste_w(i), tb_ie_reajustar_copartic_w(i), tb_tx_reajuste_copartic_w(i),
					tb_tx_reajuste_copartic_max_w(i), current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_vinculo_coparticipacao, tb_ie_reajustar_inscricao_w(i),
					tb_tx_reajuste_inscricao_w(i), tb_ie_reajustar_via_adic_w(i), tb_tx_via_adicional_w(i),
					tb_ie_reajusta_vl_manutencao_w(i), current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_aplicacao_reajuste, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_reajustar_benef_cancelado,
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_caracteristica, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ds_justificativa, tb_tx_reajuste_proposto_w(i),
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ds_observacao, tb_dt_aplicacao_reajuste_w(i), current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.tx_deflator,
					current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.dt_periodo_inicial, current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.dt_periodo_final, tb_ie_reaj_nao_aplicado_w(i),
					tb_nr_contrato_w(i), current_setting('pls_reajuste_coletivo_pck.pls_reajuste_w')::pls_reajuste%rowtype.ie_tipo_agrupamento_exclusivo, tb_nr_seq_processo_contrato_w(i))
			RETURNING nr_sequencia
			BULK COLLECT INTO tb_nr_seq_reajuste_wr;
		commit;
		
		if (nr_seq_reaj_coletivo_p IS NOT NULL AND nr_seq_reaj_coletivo_p::text <> '') then
			forall i in tb_nr_seq_reajuste_wr.first..tb_nr_seq_reajuste_wr.last
				update	pls_prog_reaj_coletivo
				set	nr_seq_reajuste		= tb_nr_seq_reajuste_wr(i),
					dt_atualizacao		= clock_timestamp(),
					ie_status		= 'A',
					nm_usuario		= nm_usuario_p
				where	nr_sequencia		= nr_seq_reaj_coletivo_p;
			commit;
		end if;
	end if;
	CALL pls_reajuste_coletivo_pck.limpar_vetor_contratos();
end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_reajuste_coletivo_pck.inserir_contratos (ie_descarregar_vetores_p text) FROM PUBLIC;
