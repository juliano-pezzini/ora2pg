-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_pp_lote_retencao_pck.atualizar_valores_trib_pessoa ( nr_cont_p INOUT integer, tb_nr_sequencia_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_trib_pag_p INOUT pls_util_cta_pck.t_number_table, tb_pr_aliquota_p INOUT pls_util_cta_pck.t_number_table, tb_vl_base_calc_p INOUT pls_util_cta_pck.t_number_table, tb_vl_tributo_p INOUT pls_util_cta_pck.t_number_table, tb_dt_pgto_trib_p INOUT pls_util_cta_pck.t_date_table, tb_nr_seq_trans_reg_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_trans_baixa_p INOUT pls_util_cta_pck.t_number_table, tb_cd_beneficiario_p INOUT pls_util_cta_pck.t_varchar2_table_20, tb_ie_periodicidade_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_cd_variacao_p INOUT pls_util_cta_pck.t_number_table, tb_cd_cond_pgto_p INOUT pls_util_cta_pck.t_number_table, tb_cd_darf_p INOUT pls_util_cta_pck.t_varchar2_table_10, tb_nr_seq_classe_p INOUT pls_util_cta_pck.t_number_table, tb_cd_tipo_baixa_neg_p INOUT pls_util_cta_pck.t_number_table, tb_ie_vencimento_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_ger_tit_pagar_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_cd_conta_financ_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN
-- se tiver algo faz o update
if (tb_nr_sequencia_p.count > 0) then

	forall i in tb_nr_sequencia_p.first..tb_nr_sequencia_p.last
		update	pls_pp_lr_trib_pessoa
		set	nm_usuario = nm_usuario_p,
			dt_atualizacao = clock_timestamp(),
			vl_base_calculo = coalesce(tb_vl_base_calc_p(i), 0),
			vl_tributo = coalesce(tb_vl_tributo_p(i), 0),
			pr_aliquota = coalesce(tb_pr_aliquota_p(i), 0),
			nr_seq_trib_conta_pagar = tb_nr_seq_trib_pag_p(i),
			nr_seq_trans_reg = tb_nr_seq_trans_reg_p(i),
			nr_seq_trans_baixa = tb_nr_seq_trans_baixa_p(i),
			cd_beneficiario = tb_cd_beneficiario_p(i),
			ie_periodicidade = tb_ie_periodicidade_p(i),
			cd_variacao = tb_cd_variacao_p(i),
			dt_pgto_tributo = tb_dt_pgto_trib_p(i),
			cd_cond_pagto = tb_cd_cond_pgto_p(i),
			cd_darf = tb_cd_darf_p(i),
			nr_seq_classe = tb_nr_seq_classe_p(i),
			cd_tipo_baixa_neg = tb_cd_tipo_baixa_neg_p(i),
			ie_vencimento = tb_ie_vencimento_p(i),
			ie_gerar_titulo_pagar = tb_ie_ger_tit_pagar_p(i),
			cd_conta_financ = tb_cd_conta_financ_p(i)
		where	nr_sequencia = tb_nr_sequencia_p(i);
	commit;
end if;

-- aqui limpa as vari√°veis
nr_cont_p := 0;
tb_nr_sequencia_p.delete;
tb_nr_seq_trib_pag_p.delete;
tb_pr_aliquota_p.delete;
tb_vl_base_calc_p.delete;
tb_vl_tributo_p.delete;
tb_nr_seq_trans_reg_p.delete;
tb_nr_seq_trans_baixa_p.delete;
tb_cd_beneficiario_p.delete;
tb_ie_periodicidade_p.delete;
tb_cd_variacao_p.delete;
tb_dt_pgto_trib_p.delete;
tb_cd_cond_pgto_p.delete;
tb_cd_darf_p.delete;
tb_nr_seq_classe_p.delete;
tb_cd_tipo_baixa_neg_p.delete;
tb_ie_vencimento_p.delete;
tb_ie_ger_tit_pagar_p.delete;
tb_cd_conta_financ_p.delete;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_pp_lote_retencao_pck.atualizar_valores_trib_pessoa ( nr_cont_p INOUT integer, tb_nr_sequencia_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_trib_pag_p INOUT pls_util_cta_pck.t_number_table, tb_pr_aliquota_p INOUT pls_util_cta_pck.t_number_table, tb_vl_base_calc_p INOUT pls_util_cta_pck.t_number_table, tb_vl_tributo_p INOUT pls_util_cta_pck.t_number_table, tb_dt_pgto_trib_p INOUT pls_util_cta_pck.t_date_table, tb_nr_seq_trans_reg_p INOUT pls_util_cta_pck.t_number_table, tb_nr_seq_trans_baixa_p INOUT pls_util_cta_pck.t_number_table, tb_cd_beneficiario_p INOUT pls_util_cta_pck.t_varchar2_table_20, tb_ie_periodicidade_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_cd_variacao_p INOUT pls_util_cta_pck.t_number_table, tb_cd_cond_pgto_p INOUT pls_util_cta_pck.t_number_table, tb_cd_darf_p INOUT pls_util_cta_pck.t_varchar2_table_10, tb_nr_seq_classe_p INOUT pls_util_cta_pck.t_number_table, tb_cd_tipo_baixa_neg_p INOUT pls_util_cta_pck.t_number_table, tb_ie_vencimento_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_ie_ger_tit_pagar_p INOUT pls_util_cta_pck.t_varchar2_table_5, tb_cd_conta_financ_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
