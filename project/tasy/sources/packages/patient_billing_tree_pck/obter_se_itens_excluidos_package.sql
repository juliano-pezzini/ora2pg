-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION patient_billing_tree_pck.obter_se_itens_excluidos (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_seq_episodio_p episodio_paciente.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type) RETURNS boolean AS $body$
DECLARE


	ie_retorno_w	boolean := false;
	qt_registro_w	bigint;

	
BEGIN

	select	1
	into STRICT	qt_registro_w
	
	where	exists (SELECT	1
		from	procedimento_paciente x
		where	x.nr_atendimento	= nr_atendimento_p
		and	coalesce(nr_seq_episodio_p,0) = 0
		and	(x.cd_motivo_exc_conta IS NOT NULL AND x.cd_motivo_exc_conta::text <> '')
		
union all

		SELECT	1
		from	material_atend_paciente x
		where	x.nr_atendimento	= nr_atendimento_p
		and	coalesce(nr_seq_episodio_p,0) = 0
		and	(x.cd_motivo_exc_conta IS NOT NULL AND x.cd_motivo_exc_conta::text <> '') 
		
union all

		select	1
		from	procedimento_paciente x,
			atendimento_paciente y
		where	x.nr_atendimento	= y.nr_atendimento
		and	y.nr_seq_episodio	= nr_seq_episodio_p
		and	(x.cd_motivo_exc_conta IS NOT NULL AND x.cd_motivo_exc_conta::text <> '') 
		
union all

		select	1
		from	material_atend_paciente x,
			atendimento_paciente y
		where	x.nr_atendimento	= y.nr_atendimento
		and	y.nr_seq_episodio	= nr_seq_episodio_p
		and	(x.cd_motivo_exc_conta IS NOT NULL AND x.cd_motivo_exc_conta::text <> '')  LIMIT 1);

	if (qt_registro_w > 0) then
		return true;
	else
		return false;
	end if;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION patient_billing_tree_pck.obter_se_itens_excluidos (cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, nr_seq_episodio_p episodio_paciente.nr_sequencia%type, nr_atendimento_p atendimento_paciente.nr_atendimento%type) FROM PUBLIC;
