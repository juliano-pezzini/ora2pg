-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION get_val_from_field_pck.get_valores (query_text_p text) RETURNS SETOF T_RESULT AS $body$
DECLARE


    vr_cursor     varchar(2000) := query_text_p;
    vr_nrcursor   bigint;
    vr_nrretorn   bigint;
    vr_qtdretor   bigint;
    vr_dscodigo   varchar(4000);
    vr_descricao  varchar(4000);
	vr_descricao1 varchar(4000);
    vr_descricao2 varchar(4000);
    vr_descricao3 varchar(4000);
	vr_descricao4 varchar(4000);
	vr_descricao5 varchar(4000);
	v_campo	      varchar(255);
	
	v_col_cnt integer;
    v_columns dbms_sql.desc_tab;
	v_count_columns integer;
	
	r_result_w r_result_row;
	v_composto_w char(1);WITH RECURSIVE cte AS (

    --cursores
	c01 CURSOR FOR
	SELECT query_text_p DS_EXP,
			regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
				position(')(' in replace(query_text_p,' ','')) + 2), ')', ''), '[^,]+', 1, level) DS, 
			regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
				position('(' in replace(query_text_p,' ','')) + 1, position(')(' in replace(query_text_p,' ',''))), ')(', ''), '[^,]+', 1, level) CD
	
	regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
					position(')(' in replace(query_text_p,' ','')) + 2), ')', ''), '[^,]+', 1, level) is not null  UNION ALL

    
	c01 CURSOR FOR
	SELECT query_text_p DS_EXP, 
			regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
				position(')(' in replace(query_text_p,' ','')) + 2), ')', ''), '[^,]+', 1, level) DS, 
			regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
				position('(' in replace(query_text_p,' ','')) + 1, position(')(' in replace(query_text_p,' ',''))), ')(', ''), '[^,]+', 1, level) CD
	
	regexp_substr(replace(SUBSTR(replace(query_text_p,' ',''),
					position(')(' in replace(query_text_p,' ','')) + 2), ')', ''), '[^,]+', 1, level) is not null JOIN cte c ON ()

) SELECT * FROM cte;
;
	c01_w	c01%rowtype;


BEGIN
  
	open c01;
		loop
			fetch c01 into c01_w;
			EXIT WHEN NOT FOUND; /* apply on c01 */
				begin
					r_result_w.DS_EXP := c01_w.DS_EXP;
					r_result_w.CD := c01_w.CD;
					r_result_w.DS := c01_w.DS;
					RETURN NEXT r_result_w;
				end;
		end loop;
	close c01;		

  END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION get_val_from_field_pck.get_valores (query_text_p text) FROM PUBLIC;
