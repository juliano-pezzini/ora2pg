-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_dados_atuariais_pck.consistir_regra_campo_arq ( nr_seq_regra_p pls_atuarial_arq_regra.nr_sequencia%type) AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Realiza as consistencias dos campos da regra de geracao do arquivo.

	Essas consistencias sao estruturais, elas nao validam o SQL que a regra ira gerar.

-------------------------------------------------------------------------------------------------------------------

Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

	
Alteracoes:
-------------------------------------------------------------------------------------------------------------------

 ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


campos_arquivo_w	campo_arquivo;

BEGIN



-- Carrega os campos

campos_arquivo_w := pls_dados_atuariais_pck.gera_campo_arquivo(nr_seq_regra_p, 'a');


-- Varre os campos e aplica as consistencias individuais

if (campos_arquivo_w.nr_seq_regra_campo.count > 0) then

	for i in campos_arquivo_w.nr_seq_regra_campo.first..campos_arquivo_w.nr_seq_regra_campo.last loop

		if	(((campos_arquivo_w.ds_preenchimento(i) IS NOT NULL AND (campos_arquivo_w.ds_preenchimento(i))::text <> '')) and (coalesce(campos_arquivo_w.ie_tamanho(i)::text, '') = '')) then

			-- Existem campos com o "preenchimento" informado, sem o "tamanho" informado.

			CALL wheb_mensagem_pck.exibir_mensagem_abort(896839);		
		end if;

		if	((coalesce(campos_arquivo_w.ie_campo(i)::text, '') = '') and (coalesce(campos_arquivo_w.ds_function(i)::text, '') = '')) then

			-- Existem campos na regra que nao possuem o "Campo" ou "Function" informados.

			CALL wheb_mensagem_pck.exibir_mensagem_abort(896841);		
		end if;

		if	(((campos_arquivo_w.ie_campo(i) IS NOT NULL AND (campos_arquivo_w.ie_campo(i))::text <> '')) and ((campos_arquivo_w.ds_function(i) IS NOT NULL AND (campos_arquivo_w.ds_function(i))::text <> ''))) then

			-- Existem campos na regra que nao possuem o "Campo" e "Function" informados.

			CALL wheb_mensagem_pck.exibir_mensagem_abort(897146);		
		end if;

	end loop;
else -- se nao tem nenhum campo, retorna como inconsistente.
	-- A regra nao possui campos informados

	CALL wheb_mensagem_pck.exibir_mensagem_abort(901217);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_dados_atuariais_pck.consistir_regra_campo_arq ( nr_seq_regra_p pls_atuarial_arq_regra.nr_sequencia%type) FROM PUBLIC;
