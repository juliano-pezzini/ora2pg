-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_indicadores_idss_pck.pls_gerar_grupo_indicador ( cd_grupo_p text, cd_indicador_p text, dt_referencia_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) AS $body$
BEGIN
	
	PERFORM set_config('pls_indicadores_idss_pck.dt_ref_inicio_mes_w', pkg_date_utils.start_of(dt_referencia_p,'MONTH'), false);
	
	delete	
	from	pls_indic_dados d
	where	d.cd_grupo		= coalesce(cd_grupo_p,'IDCC')
	and	d.cd_indicador		= coalesce(cd_indicador_p,d.cd_indicador)
	and	d.dt_competencia	= dt_referencia_p;
	
	commit;

	if (coalesce(cd_grupo_p,'IDCC') = 'IDCC') then -- Grupo Indicadores Contabeis
		CALL pls_indicadores_idss_pck.pls_gerar_indicador_idcc( 'IDCC', cd_indicador_p, dt_referencia_p, cd_estabelecimento_p, nm_usuario_p);
	elsif (cd_grupo_p = 'IDQS') then -- Indicadores da dimensão qualidade em atenção à saúde
		CALL pls_indicadores_idss_pck.pls_gerar_indicador_idqs( cd_grupo_p, cd_indicador_p, dt_referencia_p, cd_estabelecimento_p, nm_usuario_p);
	elsif (cd_grupo_p = 'IDGA') then -- Grupo Indicadores Dimensão Garantia de Acesso
		CALL pls_indicadores_idss_pck.pls_gerar_indicador_idga( cd_grupo_p, cd_indicador_p, dt_referencia_p, cd_estabelecimento_p, nm_usuario_p);
	elsif (cd_grupo_p = 'IDSM') then -- Indicadores da dimensão sustentabilidade no mercado
		CALL pls_indicadores_idss_pck.pls_gerar_indicador_idsm( cd_grupo_p, cd_indicador_p, dt_referencia_p, cd_estabelecimento_p, nm_usuario_p);
	elsif (cd_grupo_p = 'IDPR') then -- Indicadores de gestão de processos e regulação
		CALL pls_indicadores_idss_pck.pls_gerar_indicador_idpr( cd_grupo_p, cd_indicador_p, dt_referencia_p, cd_estabelecimento_p, nm_usuario_p);
	end if;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_indicadores_idss_pck.pls_gerar_grupo_indicador ( cd_grupo_p text, cd_indicador_p text, dt_referencia_p timestamp, cd_estabelecimento_p bigint, nm_usuario_p text) FROM PUBLIC;
