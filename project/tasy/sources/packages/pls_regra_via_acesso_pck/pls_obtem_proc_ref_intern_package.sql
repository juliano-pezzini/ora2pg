-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

CREATE OR REPLACE PROCEDURE pls_regra_via_acesso_pck.pls_obtem_proc_ref_intern ( dados_conta_proc_p pls_regra_via_acesso_pck.c_dados_proc_ref, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, i_p INOUT integer, nr_seq_conta_proc_table_p INOUT dbms_sql.number_table, nr_seq_proc_ref_table_p INOUT dbms_sql.number_table) AS $body$
DECLARE

/* ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade: 	Rotina responsavel por obter os procedimentos junto a seus novos procedimentos de referencia quando o tipo de guia da conta vinculada ao procedimento 
	passado como parametro for "Guia de Resumo de Internacao" (IE_TIPO_GUIA = 5).
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
 	

ie_proc_ref_via_w		pls_parametros.ie_proc_ref_via%type;
	
BEGIN

-- Cursor de procedimentos percorrido para verificar se existem guias filhas no sistema
for r_C01 in current_setting('pls_regra_via_acesso_pck.c_dados_proc_conta')::CURSOR((	dados_conta_proc_p.cd_guia_referencia,
					dados_conta_proc_p.nr_seq_segurado,
					dados_conta_proc_p.cd_procedimento,
					dados_conta_proc_p.ie_origem_proced,
					dados_conta_proc_p.dt_procedimento_trunc,
					dados_conta_proc_p.hr_inicio_proc,
					dados_conta_proc_p.nr_seq_analise) loop
	begin	
	nr_seq_conta_proc_table_p(i_p) 	:= r_C01.nr_seq_conta_proc;
	nr_seq_proc_ref_table_p(i_p)	:= dados_conta_proc_p.nr_seq_conta_proc;
	
	i_p := i_p + 1;
	end;
end loop;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_regra_via_acesso_pck.pls_obtem_proc_ref_intern ( dados_conta_proc_p pls_regra_via_acesso_pck.c_dados_proc_ref, nm_usuario_p usuario.nm_usuario%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, i_p INOUT integer, nr_seq_conta_proc_table_p INOUT dbms_sql.number_table, nr_seq_proc_ref_table_p INOUT dbms_sql.number_table) FROM PUBLIC;
