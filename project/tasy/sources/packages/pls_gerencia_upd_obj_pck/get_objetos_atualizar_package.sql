-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_gerencia_upd_obj_pck.get_objetos_atualizar (nm_objeto_p pls_controle_upd_obj.nm_objeto%type) RETURNS DADOS_OBJETOS AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Retornar os objetos que devem ser atualizados embutidos em uma nested table;.
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta:
[ ]  Objetos do dicionário [ ] Tasy (Delphi/Java) [  ] Portal [  ]  Relatórios [X] Outros:
	Somente nesta Package (private).
 ------------------------------------------------------------------------------------------------------------------
Pontos de atenção:

Alterações:
------------------------------------------------------------------------------------------------------------------
jjung - OS 609316 - 23/12/2013 - Criação da procedure.
------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
tb_objetos_w	dados_objetos;

tb_sequencia_w	dbms_sql.number_table;
tb_nome_w	dbms_sql.varchar2_table;
tb_param_w	dbms_sql.varchar2_table;
tb_data_w	dbms_sql.date_table;
idx		integer;

cs_objetos_atual CURSOR(nm_objeto_pc	pls_controle_upd_obj.nm_objeto%type) FOR
	SELECT	nr_sequencia,
		nm_objeto,
		ds_parametros,
		dt_atualizacao
	from	pls_controle_upd_obj
	where	ie_status = 'S'
	and	nm_objeto = nm_objeto_pc
	order by dt_atualizacao, nr_sequencia;

BEGIN

tb_objetos_w.nr_sequencia.delete;
tb_objetos_w.nm_objeto.delete;
tb_sequencia_w.delete;
tb_nome_w.delete;
tb_param_w.delete;
tb_data_w.delete;

idx	:= 0;

-- Abrir o cursor dos itens que devem ser atualizados.
open cs_objetos_atual(nm_objeto_p);

loop
-- Preencher os itens na lista,  serão postos todos os objetos que foram retornados do cursor.
fetch cs_objetos_atual bulk collect into tb_sequencia_w, tb_nome_w, tb_param_w, tb_data_w limit current_setting('pls_gerencia_upd_obj_pck.qt_registro_transacao_w')::integer;
exit when tb_sequencia_w.count = 0;

	for i in tb_sequencia_w.first..tb_sequencia_w.last loop
		
		tb_objetos_w.nr_sequencia(idx)	:= tb_sequencia_w(i);
		tb_objetos_w.nm_objeto(idx) 	:= tb_nome_w(i);
		tb_objetos_w.ds_parametro(idx) 	:= tb_param_w(i);
		
		idx	:= idx + 1;
	end loop;
end loop;
close cs_objetos_atual;

return tb_objetos_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_gerencia_upd_obj_pck.get_objetos_atualizar (nm_objeto_p pls_controle_upd_obj.nm_objeto%type) FROM PUBLIC;
