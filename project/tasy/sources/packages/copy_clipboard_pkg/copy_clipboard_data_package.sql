-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE copy_clipboard_pkg.copy_clipboard_data ( ie_record_type_p text, nr_sequencia_p bigint, nr_atendiment_p bigint ) AS $body$
DECLARE


        ds_return_w             varchar(2000);
        dt_atualizacao_w        timestamp;
        nm_usuario_w            varchar(1000);
        dt_atualizacao_nrec_w   varchar(1000);
        nm_usuario_nrec_w       varchar(1000);
        diagnosis_option_w      bigint;
        data_count_w            bigint;

BEGIN
        BEGIN
            ds_return_w := copy_clipboard_pkg.obter_data_format(ie_record_type_p, nr_sequencia_p, nr_atendiment_p);
        END;
        SELECT
            COUNT(1)
        INTO STRICT data_count_w
        FROM
            clipboard_data
        WHERE
            cd_estabelecimento = wheb_usuario_pck.get_cd_estabelecimento
            AND ie_record_type = ie_record_type_p;


        IF ( data_count_w < 1 ) THEN
            INSERT INTO clipboard_data(
                nr_sequencia,
                cd_estabelecimento,
                dt_atualizacao,
                nm_usuario,
                dt_atualizacao_nrec,
                nm_usuario_nrec,
                ie_record_type,
                ie_clip_data,
                ie_situacao
            ) VALUES (
                nextval('clipboard_data_seq'),
                wheb_usuario_pck.get_cd_estabelecimento,
                clock_timestamp(),
                wheb_usuario_pck.get_nm_usuario,
                clock_timestamp(),
                wheb_usuario_pck.get_nm_usuario,
                ie_record_type_p,
                ds_return_w,
                'A'
            );



        END IF;

    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE copy_clipboard_pkg.copy_clipboard_data ( ie_record_type_p text, nr_sequencia_p bigint, nr_atendiment_p bigint ) FROM PUBLIC;
