-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_utilizacao_benef_pck.retorna_exists_proc_atend ( ds_col_cd_guia_ok_w text, ds_col_nr_seq_segurado_w text) RETURNS varchar AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Cria o sql para um "exists" de procedimentos dentro do atendimento
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X]  Objetos do dicionario [ ] Tasy (Delphi/Java) [ ] Portal [  ]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

	Centraliza a criacao do exists para saber se dentro de um atendimento composto
	de cd_guia_ok e nr_seq_segurado, ainda nas tabelas de pls_conta e pls_conta_proc
	existe algum procedimento, desde que a conta esteja fechada e o procedimento nao
	esteja cancelado.
	
	Isto foi centralizado porque era usado em alguns pontos, entao qualquer alteracao
	aqui, verificar nos locais se ela e condizente.
Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
ds_retorno_w	varchar(2000):='';

BEGIN

ds_retorno_w	:=	'	select	1 ' || pls_util_pck.enter_w ||
			'			from	pls_conta	a, ' || pls_util_pck.enter_w ||
			'				pls_conta_proc	b ' || pls_util_pck.enter_w ||
			'			where	b.nr_seq_conta		= a.nr_sequencia ' || pls_util_pck.enter_w ||
			'			and	a.cd_guia_ok		= ' || ds_col_cd_guia_ok_w || ' ' || pls_util_pck.enter_w ||
			'			and	a.nr_seq_segurado	= ' || ds_col_nr_seq_segurado_w ||' ' || pls_util_pck.enter_w ||
			'			and	a.ie_status		= ''F'' ' || pls_util_pck.enter_w ||
			'			and	b.ie_status		!= ''C'' ';
			
return ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_utilizacao_benef_pck.retorna_exists_proc_atend ( ds_col_cd_guia_ok_w text, ds_col_nr_seq_segurado_w text) FROM PUBLIC;
