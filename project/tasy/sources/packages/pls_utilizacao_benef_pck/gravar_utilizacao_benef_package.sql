-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_utilizacao_benef_pck.gravar_utilizacao_benef ( nr_sequencia_p INOUT pls_util_cta_pck.t_number_table, cd_procedimento_p INOUT pls_util_cta_pck.t_number_table, ie_origem_proced_p INOUT pls_util_cta_pck.t_number_table, qt_utilizacao_p INOUT pls_util_cta_pck.t_number_table, vl_utilizacao_p INOUT pls_util_cta_pck.t_number_table, dt_realizacao_p INOUT pls_util_cta_pck.t_date_table, nr_seq_prestador_p INOUT pls_util_cta_pck.t_number_table, cd_medico_p INOUT pls_util_cta_pck.t_varchar2_table_10, nr_cpf_p INOUT pls_util_cta_pck.t_varchar2_table_15, cd_cgc_p INOUT pls_util_cta_pck.t_varchar2_table_15, cd_cbo_p INOUT pls_util_cta_pck.t_varchar2_table_20, nr_seq_cbo_saude_p INOUT pls_util_cta_pck.t_number_table, cd_municipio_ibge_p INOUT pls_util_cta_pck.t_varchar2_table_10, dt_inicio_faturamento_p INOUT pls_util_cta_pck.t_date_table, dt_fim_faturamento_p INOUT pls_util_cta_pck.t_date_table, nr_seq_saida_int_p INOUT pls_util_cta_pck.t_number_table, nr_seq_saida_spsadt_p INOUT pls_util_cta_pck.t_number_table, ie_grupo_ans_p INOUT pls_util_cta_pck.t_varchar2_table_10, nr_seq_segurado_p INOUT pls_util_cta_pck.t_number_table, cd_guia_ok_p INOUT pls_util_cta_pck.t_varchar2_table_20, nr_seq_titular_p INOUT pls_util_cta_pck.t_number_table, nr_seq_material_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_id_transacao_p w_pls_utilizacao_benef.nr_id_transacao%type, ie_commit_p text, ie_esvaziar_table_p text) AS $body$
DECLARE


/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Grava os dados passados para a utilizacao do beneficiario
-------------------------------------------------------------------------------------------------------------------
Locais de chamada direta: 
[X]  Objetos do dicionario [X] Tasy (Delphi/Java) [ X] Portal [ X]  Relatorios [ ] Outros:
-------------------------------------------------------------------------------------------------------------------
Pontos de atencao:

	A rotina apenas percorre as tabelas e insere elas, nenhuma validacao devera ser
	feita aqui.
	
	Todas as tabelas deverao possuir o mesmo numero de registros, mesmo que eles estejam null
	
	A decisao de commitar fica delegado a quem for chamar a rotina.
	A decicao de esvaziar as tabelas tambem e delegada a quem for chamar a rotina
Alteracoes:
-------------------------------------------------------------------------------------------------------------------
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */
				


BEGIN

-- Insere os registros na base (ao incluir uma coluna aqui, verificar se nao precisa adicionar no if para esvaziar as tabeals)
forall i in nr_sequencia_p.first..nr_sequencia_p.last
	insert into w_pls_utilizacao_benef(	nr_sequencia,
						cd_procedimento,
						ie_origem_proced,
						qt_utilizacao,
						vl_utilizacao,
						dt_realizacao,
						nr_seq_prestador,
						cd_medico,
						nr_cpf,
						cd_cgc,
						cd_cbo,
						nr_seq_cbo_saude,
						cd_municipio_ibge,
						dt_inicio_faturamento,
						dt_fim_faturamento,
						nr_seq_saida_int,
						nr_seq_saida_spsadt,
						ie_grupo_ans,
						nr_seq_segurado,
						cd_guia_ok,
						nr_seq_titular,
						nr_seq_material,
						nm_usuario,
						dt_atualizacao,
						cd_estabelecimento,
						nr_id_transacao)
	values (nr_sequencia_p(i),
		cd_procedimento_p(i),
		ie_origem_proced_p(i),
		qt_utilizacao_p(i),
		vl_utilizacao_p(i),
		dt_realizacao_p(i),
		nr_seq_prestador_p(i),
		cd_medico_p(i),
		nr_cpf_p(i),
		cd_cgc_p(i),
		cd_cbo_p(i),
		nr_seq_cbo_saude_p(i),
		cd_municipio_ibge_p(i),
		dt_inicio_faturamento_p(i),
		dt_fim_faturamento_p(i),
		nr_seq_saida_int_p(i),
		nr_seq_saida_spsadt_p(i),
		ie_grupo_ans_p(i),
		nr_seq_segurado_p(i),
		cd_guia_ok_p(i),
		nr_seq_titular_p(i),
		nr_seq_material_p(i),
		nm_usuario_p,
		clock_timestamp(),
		cd_estabelecimento_p,
		nr_id_transacao_p);

-- Se for configurado para commit		
if (coalesce(ie_commit_p, 'S') = 'S') then

	commit;
end if;

-- Se for configurado para limpar as tabelas passadas como parametro
if (coalesce(ie_esvaziar_table_p, 'N') = 'N') then

	nr_sequencia_p.delete;
	cd_procedimento_p.delete;
	ie_origem_proced_p.delete;
	qt_utilizacao_p.delete;
	vl_utilizacao_p.delete;
	dt_realizacao_p.delete;
	nr_seq_prestador_p.delete;
	cd_medico_p.delete;
	nr_cpf_p.delete;
	cd_cgc_p.delete;
	cd_cbo_p.delete;
	nr_seq_cbo_saude_p.delete;
	cd_municipio_ibge_p.delete;
	dt_inicio_faturamento_p.delete;
	dt_fim_faturamento_p.delete;
	nr_seq_saida_int_p.delete;
	nr_seq_saida_spsadt_p.delete;
	ie_grupo_ans_p.delete;
	nr_seq_segurado_p.delete;
	cd_guia_ok_p.delete;
	nr_seq_titular_p.delete;
	nr_seq_material_p.delete;
end if;


END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_utilizacao_benef_pck.gravar_utilizacao_benef ( nr_sequencia_p INOUT pls_util_cta_pck.t_number_table, cd_procedimento_p INOUT pls_util_cta_pck.t_number_table, ie_origem_proced_p INOUT pls_util_cta_pck.t_number_table, qt_utilizacao_p INOUT pls_util_cta_pck.t_number_table, vl_utilizacao_p INOUT pls_util_cta_pck.t_number_table, dt_realizacao_p INOUT pls_util_cta_pck.t_date_table, nr_seq_prestador_p INOUT pls_util_cta_pck.t_number_table, cd_medico_p INOUT pls_util_cta_pck.t_varchar2_table_10, nr_cpf_p INOUT pls_util_cta_pck.t_varchar2_table_15, cd_cgc_p INOUT pls_util_cta_pck.t_varchar2_table_15, cd_cbo_p INOUT pls_util_cta_pck.t_varchar2_table_20, nr_seq_cbo_saude_p INOUT pls_util_cta_pck.t_number_table, cd_municipio_ibge_p INOUT pls_util_cta_pck.t_varchar2_table_10, dt_inicio_faturamento_p INOUT pls_util_cta_pck.t_date_table, dt_fim_faturamento_p INOUT pls_util_cta_pck.t_date_table, nr_seq_saida_int_p INOUT pls_util_cta_pck.t_number_table, nr_seq_saida_spsadt_p INOUT pls_util_cta_pck.t_number_table, ie_grupo_ans_p INOUT pls_util_cta_pck.t_varchar2_table_10, nr_seq_segurado_p INOUT pls_util_cta_pck.t_number_table, cd_guia_ok_p INOUT pls_util_cta_pck.t_varchar2_table_20, nr_seq_titular_p INOUT pls_util_cta_pck.t_number_table, nr_seq_material_p INOUT pls_util_cta_pck.t_number_table, nm_usuario_p text, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nr_id_transacao_p w_pls_utilizacao_benef.nr_id_transacao%type, ie_commit_p text, ie_esvaziar_table_p text) FROM PUBLIC;
