-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

 
-- Insere o pacote na tabela 
CREATE OR REPLACE PROCEDURE ptu_gerar_tabela_a1200_pck.insere_pacote_a1200 ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_ptu_pacote_p INOUT ptu_pacote.nr_sequencia%type, cd_unimed_origem_p INOUT pls_congenere.cd_cooperativa%type) AS $body$
DECLARE

 
cd_unimed_origem_w	pls_congenere.cd_cooperativa%type;
nr_seq_congenere_w	pls_congenere.nr_sequencia%type;
cd_interface_w		ptu_regra_interface.cd_interface%type;
cd_versao_w		varchar(5);
nr_versao_transacao_w	varchar(5);


BEGIN 
-- Unimed de Origem 
cd_unimed_origem_w 	:= pls_obter_unimed_estab(cd_estabelecimento_p);
nr_seq_congenere_w 	:= pls_obter_cd_seq_congenere(lpad(cd_unimed_origem_w,4,'0'),'NR');
cd_interface_w 		:= coalesce(pls_obter_interf_ptu( cd_estabelecimento_p, nr_seq_congenere_w, clock_timestamp(), 'A1200'), '2183');
cd_versao_w		:= ptu_obter_versao('A1200',cd_interface_w);
nr_versao_transacao_w	:= ptu_obter_versao_transacao('A1200',cd_versao_w);
 
insert	into	ptu_pacote(	nr_sequencia, cd_unimed_origem, dt_atualizacao, 
		dt_geracao, ie_tipo_carga, ie_tipo_informacao,     
		cd_estabelecimento, nm_usuario, nm_usuario_nrec, 
		dt_atualizacao_nrec, nr_versao_transacao) 
values (	nextval('ptu_pacote_seq'), cd_unimed_origem_w, clock_timestamp(),        
		clock_timestamp(), 1, 2, 
		cd_estabelecimento_p, nm_usuario_p, nm_usuario_p, 
		clock_timestamp(), nr_versao_transacao_w) returning nr_sequencia into nr_seq_ptu_pacote_p;
 
cd_unimed_origem_p := cd_unimed_origem_w;
		 
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_gerar_tabela_a1200_pck.insere_pacote_a1200 ( cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type, nr_seq_ptu_pacote_p INOUT ptu_pacote.nr_sequencia%type, cd_unimed_origem_p INOUT pls_congenere.cd_cooperativa%type) FROM PUBLIC;
