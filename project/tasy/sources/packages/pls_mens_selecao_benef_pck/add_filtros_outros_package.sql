-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_mens_selecao_benef_pck.add_filtros_outros () AS $body$
DECLARE


sql_outros_w	varchar(4000) := null;


BEGIN

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_lote = 'CO') then
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_susp_mens_inicial IS NOT NULL AND rowtype.dt_susp_mens_inicial::text <> '') or current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_susp_mens_final IS NOT NULL AND rowtype.dt_susp_mens_final::text <> '')) then
		if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_motivo_suspensao IS NOT NULL AND rowtype.nr_seq_motivo_suspensao::text <> '')) then
			sql_outros_w := sql_outros_w ||	'		and	x.nr_seq_motivo_suspensao = :nr_seq_motivo_suspensao ';
			current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_motivo_suspensao', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_motivo_suspensao, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
		end if;
		
		if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_susp_mens_inicial IS NOT NULL AND rowtype.dt_susp_mens_inicial::text <> '')) then
			sql_outros_w := sql_outros_w ||	'		and	x.dt_fim_suspensao >= :dt_susp_mens_inicial ';
			current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_susp_mens_inicial', trunc(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_susp_mens_inicial,'dd'), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
		end if;
		
		if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_susp_mens_final IS NOT NULL AND rowtype.dt_susp_mens_final::text <> '')) then
			sql_outros_w := sql_outros_w ||	'		and	x.dt_fim_suspensao <= fim_dia(:dt_susp_mens_final) ';
			current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_susp_mens_final', fim_dia(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_susp_mens_final), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
		end if;
	
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000)	||	' and	exists(	select	1 ' ||
							'		from	pls_contrato_susp_mens x ' ||
							'		where	x.nr_seq_contrato	= c.nr_sequencia ' ||
							'		and	(x.nr_seq_pagador is null or x.nr_seq_pagador = d.nr_sequencia) ' || sql_outros_w ||
							' 		union ' ||
							' 		select	1 ' ||
							'		from	pls_contrato_susp_mens x ' ||
							'		where	x.nr_seq_pagador	= d.nr_sequencia ' ||
							'		and	x.nr_seq_contrato is null ' || sql_outros_w, false);
		
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||	' ) ', false);
	end if;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_mens_selecao_benef_pck.add_filtros_outros () FROM PUBLIC;
