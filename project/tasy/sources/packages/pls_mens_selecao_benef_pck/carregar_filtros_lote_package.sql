-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_mens_selecao_benef_pck.carregar_filtros_lote ( nr_seq_lote_p pls_lote_mensalidade.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN

select	*
into STRICT	current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype
from	pls_lote_mensalidade
where	nr_sequencia	= nr_seq_lote_p;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_regra_serie_nf IS NOT NULL AND rowtype.nr_seq_regra_serie_nf::text <> '')) then
	select	max(ie_tipo_contrato),
		max(ie_situacao_trabalhista),
		max(nr_seq_classif_itens)
	into STRICT	current_setting('pls_mens_selecao_benef_pck.ie_tipo_contrato_serie_w')::pls_regra_serie_nf_compl.ie_tipo_contrato%type,
		current_setting('pls_mens_selecao_benef_pck.ie_situacao_trabalhist_serie_w')::pls_regra_serie_nf_compl.ie_situacao_trabalhista%type,
		current_setting('pls_mens_selecao_benef_pck.nr_seq_classif_itens_serie_w')::pls_regra_serie_nf_compl.nr_seq_classif_itens%type
	from	pls_regra_serie_nf_compl
	where	nr_seq_regra	= current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_regra_serie_nf;
else
	PERFORM set_config('pls_mens_selecao_benef_pck.ie_tipo_contrato_serie_w', null, false);
	PERFORM set_config('pls_mens_selecao_benef_pck.ie_situacao_trabalhist_serie_w', null, false);
	PERFORM set_config('pls_mens_selecao_benef_pck.nr_seq_classif_itens_serie_w', null, false);
end if;

CALL pls_mensalidade_util_pck.set_seq_regra_grupo(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_regra_grupo);

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_mens_selecao_benef_pck.carregar_filtros_lote ( nr_seq_lote_p pls_lote_mensalidade.nr_sequencia%type, cd_estabelecimento_p estabelecimento.cd_estabelecimento%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
