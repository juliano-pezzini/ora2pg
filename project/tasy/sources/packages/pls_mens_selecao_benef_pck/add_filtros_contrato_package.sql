-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_mens_selecao_benef_pck.add_filtros_contrato () AS $body$
BEGIN

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_lote = 'CO') then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_tabelas_w', current_setting('pls_mens_selecao_benef_pck.sql_tabelas_w')::varchar(32000) || ' , pls_contrato c ', false);
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.nr_sequencia = a.nr_seq_contrato ', false);
	
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.cd_estabelecimento = :cd_estabelecimento ', false);
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':cd_estabelecimento', current_setting('pls_mens_selecao_benef_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_contrato IS NOT NULL AND rowtype.nr_seq_contrato::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and (c.nr_sequencia = :nr_seq_contrato_pc or c.nr_contrato_principal = :nr_seq_contrato_pc)', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_contrato_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_contrato, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_grupo_contrato IS NOT NULL AND rowtype.nr_seq_grupo_contrato::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and exists (select	1 ' ||
						'		from	pls_contrato_grupo x ' ||
						'		where	x.nr_seq_contrato = c.nr_sequencia ' ||
						'		and	x.nr_seq_grupo = :nr_seq_grupo_relac_pc )', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_grupo_relac_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_grupo_contrato, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_grupo_preco IS NOT NULL AND rowtype.nr_seq_grupo_preco::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and exists (select	1 ' ||
						'		from	pls_preco_contrato x ' ||
						'		where	x.nr_seq_contrato = c.nr_sequencia ' ||
						'		and	x.nr_seq_grupo = :nr_seq_grupo_preco_pc )', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_grupo_preco_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_grupo_preco, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.cd_classif_contrato IS NOT NULL AND rowtype.cd_classif_contrato::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and c.cd_classif_contrato = :cd_classif_contrato_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':cd_classif_contrato_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.cd_classif_contrato, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_contrato_inicial IS NOT NULL AND rowtype.dt_contrato_inicial::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and c.dt_contrato >= :dt_contrato_inicial_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_contrato_inicial_pc', trunc(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_contrato_inicial,'dd'), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_contrato_final IS NOT NULL AND rowtype.dt_contrato_final::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and c.dt_contrato <= :dt_contrato_final_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_contrato_final_pc', fim_dia(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_contrato_final), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
elsif (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_lote = 'CI') then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_tabelas_w', current_setting('pls_mens_selecao_benef_pck.sql_tabelas_w')::varchar(32000) || ' , pls_intercambio c ', false);
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.nr_sequencia = a.nr_seq_intercambio ', false);
	
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.cd_estabelecimento = :cd_estabelecimento ', false);
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':cd_estabelecimento', current_setting('pls_mens_selecao_benef_pck.cd_estabelecimento_w')::estabelecimento.cd_estabelecimento%type, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_grupo_preco IS NOT NULL AND rowtype.nr_seq_grupo_preco::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and exists (select	1 ' ||
						'		from	pls_preco_contrato x ' ||
						'		where	x.nr_seq_intercambio = c.nr_sequencia ' ||
						'		and	x.nr_seq_grupo = :nr_seq_grupo_preco_pc )', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_grupo_preco_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_grupo_preco, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.ie_tipo_contrato_serie_w')::pls_regra_serie_nf_compl.ie_tipo_contrato%type = 'A') then	
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and (c.cd_cgc is not null) ', false);
	elsif (current_setting('pls_mens_selecao_benef_pck.ie_tipo_contrato_serie_w')::pls_regra_serie_nf_compl.ie_tipo_contrato%type = 'I') then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and (c.cd_cgc is null) ', false);
	end if;
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_contrato_inter IS NOT NULL AND rowtype.nr_seq_contrato_inter::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.nr_sequencia = :nr_seq_intercambio_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_intercambio_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_contrato_inter, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.nr_seq_grupo_inter IS NOT NULL AND rowtype.nr_seq_grupo_inter::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.nr_seq_grupo_intercambio = :nr_seq_grupo_intercambio_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':nr_seq_grupo_intercambio_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.nr_seq_grupo_inter, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.ie_tipo_contrato IS NOT NULL AND rowtype.ie_tipo_contrato::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.ie_tipo_contrato = :ie_tipo_contrato_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_tipo_contrato_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_contrato, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_contrato_inicial IS NOT NULL AND rowtype.dt_contrato_inicial::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and c.dt_inclusao >= :dt_contrato_inicial_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_contrato_inicial_pc', trunc(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_contrato_inicial,'dd'), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
	
	if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.dt_contrato_final IS NOT NULL AND rowtype.dt_contrato_final::text <> '')) then
		PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) ||' and c.dt_inclusao <= :dt_contrato_final_pc ', false);
		current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':dt_contrato_final_pc', fim_dia(current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.dt_contrato_final), current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
	end if;
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.cd_empresa_inicial IS NOT NULL AND rowtype.cd_empresa_inicial::text <> '')) then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.cd_operadora_empresa >= :cd_empresa_inicial_pc ', false);
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':cd_empresa_inicial_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.cd_empresa_inicial, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.cd_empresa_final IS NOT NULL AND rowtype.cd_empresa_final::text <> '')) then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and c.cd_operadora_empresa < :cd_empresa_final_pc ', false);
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':cd_empresa_final_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.cd_empresa_final, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_mens_selecao_benef_pck.add_filtros_contrato () FROM PUBLIC;
