-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE pls_mens_selecao_benef_pck.add_filtros_produto () AS $body$
DECLARE


sql_where_produto_w	varchar(32000) := null;


BEGIN

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_preco = 'P') then
	sql_where_produto_w := sql_where_produto_w || ' and g.ie_preco = ''1'' ';
elsif (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_preco = 'C') then
	sql_where_produto_w := sql_where_produto_w || ' and g.ie_preco in (''2'',''3'') ';
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%(rowtype.ie_tipo_preco IS NOT NULL AND rowtype.ie_tipo_preco::text <> '')) and (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_lote = 'CI') then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and a.ie_tipo_repasse = :ie_tipo_preco_pc', false);
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_tipo_preco_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_preco, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_regulamentacao <> 'T') then
	sql_where_produto_w := sql_where_produto_w || ' and g.ie_regulamentacao = :ie_regulamentacao_pc';
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_regulamentacao_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_regulamentacao, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_contratacao = 'C') then
	sql_where_produto_w := sql_where_produto_w || 	' and g.ie_tipo_contratacao in (''CA'',''CE'')';
elsif (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_contratacao in ('I','CA','CE')) then
	sql_where_produto_w := sql_where_produto_w || 	' and g.ie_tipo_contratacao = :ie_tipo_contratacao_pc';
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_tipo_contratacao_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_tipo_contratacao, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

if (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_fator_moderador = 'S') then
	sql_where_produto_w := sql_where_produto_w ||	' and	((g.ie_franquia	= ''N'') ' ||
							' and	(g.ie_coparticipacao	= ''N''))';
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_fator_moderador_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_fator_moderador, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
elsif (current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_fator_moderador = 'C') then
	sql_where_produto_w := sql_where_produto_w ||	' and	((g.ie_franquia	= ''S'') ' ||
							' or	(g.ie_coparticipacao	= ''S''))';
	current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind := sql_pck.bind_variable(':ie_fator_moderador_pc', current_setting('pls_mens_selecao_benef_pck.pls_lote_mensalidade_w')::pls_lote_mensalidade%rowtype.ie_fator_moderador, current_setting('pls_mens_selecao_benef_pck.valor_bind_w')::sql_pck.t_dado_bind);
end if;

if (sql_where_produto_w IS NOT NULL AND sql_where_produto_w::text <> '') then
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_tabelas_w', current_setting('pls_mens_selecao_benef_pck.sql_tabelas_w')::varchar(32000) || ', pls_plano g', false);
	PERFORM set_config('pls_mens_selecao_benef_pck.sql_where_w', current_setting('pls_mens_selecao_benef_pck.sql_where_w')::varchar(32000) || ' and a.nr_seq_plano = g.nr_sequencia' || sql_where_produto_w, false);
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE pls_mens_selecao_benef_pck.add_filtros_produto () FROM PUBLIC;
