-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION validar_integracao_pck.validacao_email (cd_perfil_p text, nm_usuario_p text, cd_estabelecimento_p text) RETURNS varchar AS $body$
DECLARE

    msg_erro_w varchar(30000) := '';
    smtp_w varchar(500) := '';
    porta_w varchar(500) := '';

BEGIN
    smtp_w :=  obter_valor_param_usuario(0,20,cd_perfil_p,nm_usuario_p, cd_estabelecimento_p);
    porta_w :=  obter_valor_param_usuario(0,109,cd_perfil_p,nm_usuario_p, cd_estabelecimento_p);
    if coalesce(porta_w::text, '') = '' then
      msg_erro_w := VALIDAR_INTEGRACAO_METODO_PCK.tratar_mensagem(msg_erro_w, 'Porta do SMTP não configurada.');
    end if;
    if coalesce(smtp_w::text, '') = '' then
      msg_erro_w := VALIDAR_INTEGRACAO_METODO_PCK.tratar_mensagem(msg_erro_w, 'Endereço SMTP não configurado.');
    else
      msg_erro_w := VALIDAR_INTEGRACAO_METODO_PCK.tratar_mensagem(msg_erro_w, VALIDAR_INTEGRACAO_METODO_PCK.validar_espaco(smtp_w));
      msg_erro_w := VALIDAR_INTEGRACAO_METODO_PCK.tratar_mensagem(msg_erro_w, VALIDAR_INTEGRACAO_METODO_PCK.validar_regra_acl(smtp_w));
      msg_erro_w := VALIDAR_INTEGRACAO_METODO_PCK.tratar_mensagem(msg_erro_w, 'Teste de conectividade "' || smtp_w || ':' || porta_w || '"' || chr(10) || ' - ' ||VALIDAR_INTEGRACAO_METODO_PCK.testar_conectividade(smtp_w, porta_w));
    end if;
    return msg_erro_w;
  end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION validar_integracao_pck.validacao_email (cd_perfil_p text, nm_usuario_p text, cd_estabelecimento_p text) FROM PUBLIC;
