-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

-->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>DESFAZER GERACAO POPULACAO ALVO<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<--
CREATE OR REPLACE PROCEDURE mprev_pop_alvo_prest_pck.desfazer_geracao_pop_alvo (nr_seq_populacao_alvo_p bigint) AS $body$
BEGIN

	update	mprev_populacao_alvo
	set	dt_inicio_filtro_atend	 = NULL,
		dt_inicio_filtro_benef	 = NULL,
		dt_inicio_filtro_custo	 = NULL,
		dt_inicio_filtro_pessoa	 = NULL,
		dt_fim_filtro_atend	 = NULL,
		dt_fim_filtro_benef	 = NULL,
		dt_fim_filtro_custo	 = NULL,
		dt_fim_filtro_pessoa	 = NULL
	where	nr_sequencia	= nr_seq_populacao_alvo_p;

	delete 	FROM mprev_pop_alvo_selecao
	where	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;

	delete 	FROM mprev_pop_alvo_data
	where 	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;

	delete 	FROM mprev_pop_alvo_pessoa
	where 	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;

	delete 	FROM mprev_pop_pes_atend
	where 	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	
	delete 	FROM mprev_pop_pes_diagnostico
	where 	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;

	delete 	FROM mprev_pop_pes_atend_proc
	where 	nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	
	delete 	FROM mprev_pessoa_cubo_ops_w
	where	nr_seq_pop_alvo = nr_seq_populacao_alvo_p;
	
	/*Delete dos registros das tabelas filhas*/

	---Atendimentos
	delete from HDM_POP_ALVO_ATEND
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	---Diagnosticos
	delete from HDM_POP_ALVO_DIAGNOSTICO
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	---Lista problemas
	delete from HDM_POP_ALVO_PROBLEMA
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	---Procedimentos
	delete from  HDM_POP_ALVO_PROCED
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	---Tratamentos
	delete from HDM_POP_ALVO_TRATAMENTO
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;
	---Medicamentos
	delete from HDM_POP_ALVO_MEDIC
	where nr_seq_populacao_alvo = nr_seq_populacao_alvo_p;

	commit;

	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE mprev_pop_alvo_prest_pck.desfazer_geracao_pop_alvo (nr_seq_populacao_alvo_p bigint) FROM PUBLIC;
