-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION fis_transf_entre_estab.fis_carga_nf_trans ( nr_seq_nf_transf_p bigint) RETURNS varchar AS $body$
DECLARE


ds_retorno_w		varchar(1):= 'S';

C01 CURSOR FOR
	SELECT	cd_cgc_s,
		cd_condicao_pagamento_s,
		cd_estabelecimento_s,
		cd_natureza_operacao_s,
		cd_operacao_nf_s,
		cd_serie_nf_s,
		dt_emissao_s,
		dt_entrada_saida_s,
		nr_nota_fiscal_s,
	        cd_cgc_e,
	        cd_condicao_pagamento_e,
	        cd_estabelecimento_e,
	        cd_natureza_operacao_e,
	        cd_operacao_nf_e,
	        cd_serie_nf_e,
	        dt_emissao_e,
	        dt_entrada_saida_e,
	        nr_nota_fiscal_e,
		nm_usuario
	from	nota_fiscal_transferencia
	where	nr_sequencia 	= nr_seq_nf_transf_p  LIMIT 1;

c01_w	c01%rowtype;


BEGIN

begin

open C01;
loop
fetch C01 into
	c01_w;
EXIT WHEN NOT FOUND; /* apply on C01 */
	begin

	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_cgc_s				:= c01_w.cd_cgc_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_cgc_e				:= c01_w.cd_cgc_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_condicao_pagamento_s		:= c01_w.cd_condicao_pagamento_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_estabelecimento_s		:= c01_w.cd_estabelecimento_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_natureza_operacao_s		:= c01_w.cd_natureza_operacao_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_operacao_nf_s			:= c01_w.cd_operacao_nf_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].cd_serie_nf_s			:= c01_w.cd_serie_nf_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].dt_emissao_s			:= c01_w.dt_emissao_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].dt_entrada_saida_s		:= c01_w.dt_entrada_saida_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].nr_nota_fiscal_s			:= c01_w.nr_nota_fiscal_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_saida_w')::registro_nota_fiscal_transf[1].nm_usuario			:= c01_w.nm_usuario;

	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_cgc_e			:= c01_w.cd_cgc_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_cgc_s			:= c01_w.cd_cgc_s;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_condicao_pagamento_e		:= c01_w.cd_condicao_pagamento_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_estabelecimento_e		:= c01_w.cd_estabelecimento_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_natureza_operacao_e		:= c01_w.cd_natureza_operacao_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_operacao_nf_e		:= c01_w.cd_operacao_nf_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].cd_serie_nf_e			:= c01_w.cd_serie_nf_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].dt_emissao_e			:= c01_w.dt_emissao_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].dt_entrada_saida_e		:= c01_w.dt_entrada_saida_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].nr_nota_fiscal_e		:= c01_w.nr_nota_fiscal_e;
	current_setting('fis_transf_entre_estab.nota_fiscal_transf_entrada_w')::registro_nota_fiscal_transf[1].nm_usuario			:= c01_w.nm_usuario;

	end;
end loop;
close C01;

exception
when others then
	ds_retorno_w:=	'N';
end;

return	ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION fis_transf_entre_estab.fis_carga_nf_trans ( nr_seq_nf_transf_p bigint) FROM PUBLIC;
