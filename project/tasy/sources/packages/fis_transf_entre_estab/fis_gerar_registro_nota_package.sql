-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION fis_transf_entre_estab.fis_gerar_registro_nota ( nota_fiscal_transf_p registro_nota_fiscal_transf, ie_entrada_saida_p text) RETURNS REGISTRO_NOTA_FISCAL AS $body$
DECLARE


ds_retorno_w		registro_nota_fiscal;
nr_seq_nf_saida_w	nota_fiscal.nr_sequencia%type;
nr_seq_nf_entrada_w	nota_fiscal.nr_sequencia%type;


BEGIN

if (ie_entrada_saida_p = 'S') then
	begin

	select	nextval('nota_fiscal_seq')
	into STRICT	nr_seq_nf_saida_w
	;

	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_cgc_emitente	:=	nota_fiscal_transf_p[1].cd_cgc_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_cgc		:=	nota_fiscal_transf_p[1].cd_cgc_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_condicao_pagamento	:=	nota_fiscal_transf_p[1].cd_condicao_pagamento_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_estabelecimento	:=	nota_fiscal_transf_p[1].cd_estabelecimento_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_natureza_operacao	:=	nota_fiscal_transf_p[1].cd_natureza_operacao_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_operacao_nf	:=	nota_fiscal_transf_p[1].cd_operacao_nf_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).cd_serie_nf		:=	nota_fiscal_transf_p[1].cd_serie_nf_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).dt_emissao		:=	nota_fiscal_transf_p[1].dt_emissao_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).dt_entrada_saida	:=	nota_fiscal_transf_p[1].dt_entrada_saida_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).nr_nota_fiscal	:=	nota_fiscal_transf_p[1].nr_nota_fiscal_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).nr_sequencia		:=	nr_seq_nf_saida_w;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).nm_usuario            :=	nota_fiscal_transf_p[1].nm_usuario;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).dt_atualizacao        :=	clock_timestamp();
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).nr_sequencia_nf	:=	1;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).ie_situacao		:=	1;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).ie_tipo_nota		:=	'SD';
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).ie_acao_nf		:=	'1';
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).ie_emissao_nf		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).ie_tipo_frete		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).vl_mercadoria		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).vl_total_nota		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).qt_peso_bruto		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_saida_w')::bigint).qt_peso_liquido	:=	0;

	end;
elsif (ie_entrada_saida_p = 'E') then
	begin

	select	nextval('nota_fiscal_seq')
	into STRICT	nr_seq_nf_entrada_w
	;

	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_cgc_emitente		:=	nota_fiscal_transf_p[1].cd_cgc_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_cgc			:=	nota_fiscal_transf_p[1].cd_cgc_s;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_condicao_pagamento	:=	nota_fiscal_transf_p[1].cd_condicao_pagamento_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_estabelecimento		:=	nota_fiscal_transf_p[1].cd_estabelecimento_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_natureza_operacao	:=	nota_fiscal_transf_p[1].cd_natureza_operacao_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_operacao_nf		:=	nota_fiscal_transf_p[1].cd_operacao_nf_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).cd_serie_nf			:=	nota_fiscal_transf_p[1].cd_serie_nf_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).dt_emissao			:=	nota_fiscal_transf_p[1].dt_emissao_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).dt_entrada_saida		:=	nota_fiscal_transf_p[1].dt_entrada_saida_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).nr_nota_fiscal		:=	nota_fiscal_transf_p[1].nr_nota_fiscal_e;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).nr_sequencia		:=	nr_seq_nf_entrada_w;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).nm_usuario             	:=	nota_fiscal_transf_p[1].nm_usuario;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).dt_atualizacao         	:=	clock_timestamp();
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).nr_sequencia_nf		:=	1;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).ie_situacao			:=	1;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).ie_tipo_nota		:=	'EN';
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).ie_acao_nf			:=	'1';
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).ie_emissao_nf		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).ie_tipo_frete		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).vl_mercadoria		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).vl_total_nota		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).qt_peso_bruto		:=	0;
	ds_retorno_w(current_setting('fis_transf_entre_estab.idx_entrada_w')::bigint).qt_peso_liquido		:=	0;

	end;
end if;

return	ds_retorno_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION fis_transf_entre_estab.fis_gerar_registro_nota ( nota_fiscal_transf_p registro_nota_fiscal_transf, ie_entrada_saida_p text) FROM PUBLIC;
