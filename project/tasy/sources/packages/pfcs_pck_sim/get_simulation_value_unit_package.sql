-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pfcs_pck_sim.get_simulation_value_unit ( cd_establishment_p bigint, nr_hour_p bigint, cd_type_p text, cd_unit_p text, ie_std_deviation_p text, vl_aux_p bigint ) RETURNS varchar AS $body$
BEGIN
        PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', null, false);
        if (cd_type_p = current_setting('pfcs_pck_sim.cd_type_census_w')::varchar(3)) then
            PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', pfcs_pck_sim.get_simulation_data(cd_establishment_p, nr_hour_p, current_setting('pfcs_pck_sim.cd_pred_capacity_w')::smallint, null, cd_unit_p, ie_std_deviation_p), false);
        elsif (cd_type_p = current_setting('pfcs_pck_sim.cd_type_discharges_w')::varchar(3)) then
            PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', pfcs_pck_sim.get_simulation_data(cd_establishment_p, nr_hour_p, current_setting('pfcs_pck_sim.cd_pred_discharges_w')::smallint, null, cd_unit_p, ie_std_deviation_p), false);
        elsif (cd_type_p = current_setting('pfcs_pck_sim.cd_type_beds_needed_w')::varchar(3)) then
            PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', pfcs_pck_sim.get_simulation_data(cd_establishment_p, nr_hour_p, current_setting('pfcs_pck_sim.cd_pred_arrival_w')::smallint, null, cd_unit_p, ie_std_deviation_p), false);
        else
            if (ie_std_deviation_p = PFCS_PCK_CONSTANTS.IE_NO) then
                if (cd_type_p = current_setting('pfcs_pck_sim.cd_type_capacity_w')::varchar(3)) then
                    PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', concat(
                        pfcs_get_percentage_value(
                            (pfcs_pck_sim.get_simulation_data(cd_establishment_p, nr_hour_p, current_setting('pfcs_pck_sim.cd_pred_capacity_w')::smallint, null, cd_unit_p, ie_std_deviation_p))::numeric ,
                            vl_aux_p),
                        PFCS_PCK_CONSTANTS.DS_PERCENT_SIGN), false);
                elsif (cd_type_p = current_setting('pfcs_pck_sim.cd_type_available_beds_w')::varchar(3)) then
                    PERFORM set_config('pfcs_pck_sim.ds_sim_value_w', (vl_aux_p - coalesce(pfcs_get_simulation_data(cd_establishment_p, nr_hour_p, current_setting('pfcs_pck_sim.cd_pred_capacity_w')::smallint, null, cd_unit_p, ie_std_deviation_p), 0)), false);
                end if;
            end if;
        end if;
        return current_setting('pfcs_pck_sim.ds_sim_value_w')::varchar(80);
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pfcs_pck_sim.get_simulation_value_unit ( cd_establishment_p bigint, nr_hour_p bigint, cd_type_p text, cd_unit_p text, ie_std_deviation_p text, vl_aux_p bigint ) FROM PUBLIC;
