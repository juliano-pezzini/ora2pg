-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE fis_refatoracao_nf_pck.fis_duplicar_baixa_tit ( nr_titulo_receb_p titulo_receber.nr_titulo%type, nr_seq_baixa_old_p titulo_receber_liq.nr_sequencia%type, nr_interno_conta_p conta_paciente.nr_interno_conta%type, nr_seq_baixa_new_p INOUT titulo_receber_liq.nr_sequencia%type, nm_usuario_p text) AS $body$
DECLARE

					
nr_seq_baixa_w		titulo_receber_liq.nr_sequencia%type;
nr_adiantamento_w	titulo_receber_liq.nr_adiantamento%type;
cd_estabelecimento_w	estabelecimento.cd_estabelecimento%type;
				

BEGIN

select	cd_estabelecimento
into STRICT	cd_estabelecimento_w
from	titulo_receber
where	nr_titulo = nr_titulo_receb_p;

select	coalesce(max(nr_sequencia),0) + 1
into STRICT	nr_seq_baixa_w
from	titulo_receber_liq
where	nr_titulo = nr_titulo_receb_p;

select	coalesce(nr_adiantamento,0)
into STRICT	nr_adiantamento_w
from	titulo_receber_liq
where	nr_titulo = nr_titulo_receb_p
and	nr_sequencia = nr_seq_baixa_old_p;

insert into titulo_receber_liq(nr_titulo,
	nr_sequencia,
	dt_recebimento,
	vl_recebido,
	vl_descontos,
	vl_juros,
	vl_multa,
	cd_moeda,
	dt_atualizacao,
	nm_usuario,
	cd_tipo_recebimento,
	ie_acao,
	ie_origem_baixa,
	nr_adiantamento,
	cd_serie_nf_devol,
	nr_nota_fiscal_devol,
	cd_banco,
	cd_agencia_bancaria,
	nr_documento,
	nr_lote_banco,
	cd_cgc_emp_cred,
	nr_cartao_cred,
	nr_lote_contabil,
	vl_rec_maior,
	vl_glosa,
	nr_seq_trans_fin,
	ie_lib_caixa,
	nr_lote_contab_antecip,
	nr_lote_contab_pro_rata,
	vl_cotacao,
	vl_recebido_estrang)	
SELECT	nr_titulo,
	nr_seq_baixa_w,
	dt_recebimento,
	vl_recebido,
	vl_descontos,
	vl_juros,
	vl_multa,
	cd_moeda,
	dt_atualizacao,
	nm_usuario,
	cd_tipo_recebimento,
	ie_acao,
	ie_origem_baixa,
	nr_adiantamento,
	cd_serie_nf_devol,
	nr_nota_fiscal_devol,
	cd_banco,
	cd_agencia_bancaria,
	nr_documento,
	nr_lote_banco,
	cd_cgc_emp_cred,
	nr_cartao_cred,
	nr_lote_contabil,
	vl_rec_maior,
	vl_glosa,
	nr_seq_trans_fin,
	ie_lib_caixa,
	nr_lote_contab_antecip,
	nr_lote_contab_pro_rata,
	vl_cotacao,
	vl_recebido_estrang
from	titulo_receber_liq
where	nr_titulo = nr_titulo_receb_p
and	nr_sequencia = nr_seq_baixa_old_p;

CALL atualizar_saldo_tit_rec(nr_titulo_receb_p, nm_usuario_p);

commit;

nr_seq_baixa_new_p := nr_seq_baixa_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_refatoracao_nf_pck.fis_duplicar_baixa_tit ( nr_titulo_receb_p titulo_receber.nr_titulo%type, nr_seq_baixa_old_p titulo_receber_liq.nr_sequencia%type, nr_interno_conta_p conta_paciente.nr_interno_conta%type, nr_seq_baixa_new_p INOUT titulo_receber_liq.nr_sequencia%type, nm_usuario_p text) FROM PUBLIC;
