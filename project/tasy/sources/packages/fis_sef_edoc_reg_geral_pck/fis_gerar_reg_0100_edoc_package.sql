-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


/*Registro 0100: contabilista*/

CREATE OR REPLACE PROCEDURE fis_sef_edoc_reg_geral_pck.fis_gerar_reg_0100_edoc () AS $body$
DECLARE


nr_seq_fis_sef_edoc_0100_w	fis_sef_edoc_0100.nr_sequencia%type;


BEGIN

/*Pega a sequencia da taleba fis_sef_edoc_0100 para o insert*/

select	nextval('fis_sef_edoc_0100_seq')
into STRICT	nr_seq_fis_sef_edoc_0100_w
;

insert into	fis_sef_edoc_0100(	nr_sequencia,
					dt_atualizacao,
					dt_atualizacao_nrec,
					nm_usuario,
					nm_usuario_nrec,
					cd_reg,
					ds_nome,
					cd_assin,
					cd_cnpj,
					cd_cpf,
					cd_crc,
					cd_cep,
					ds_end,
					nr_num,
					ds_compl,
					ds_bairro,
					sg_uf,
					cd_mun,
					cd_cep_cp,
					cd_cp,
					nr_fone,
					nr_fax,
					ds_email,
					nr_seq_controle
					)
					SELECT	nr_seq_fis_sef_edoc_0100_w								nr_sequencia,
						clock_timestamp()											dt_atualizacao,
						clock_timestamp()											dt_atualizacao_nrec,
						current_setting('fis_sef_edoc_reg_geral_pck.nm_usuario_w')::usuario.nm_usuario%type										nm_usuario,
						current_setting('fis_sef_edoc_reg_geral_pck.nm_usuario_w')::usuario.nm_usuario%type										nm_usuario_nrec,
						'0100'											cd_reg,
						substr(b.nm_pessoa_fisica,1,60)								ds_nome,
						'900'										cd_assin,
						null											cd_cnpj,
						b.nr_cpf										cd_cpf,
						substr(fis_efd_icmsipi_elimina_c(a.nr_crc),1,10)					cd_crc,
						c.cd_cep										cd_cep,
						substr(c.ds_endereco,1,40)								ds_end,
						substr(c.nr_endereco,1,6)								nr_num,
						substr(c.ds_complemento,1,50)								ds_compl,
						substr(c.ds_bairro,1,20)								ds_bairro,
						c.sg_estado										sg_uf,
						elimina_caracteres_especiais(substr(c.cd_municipio_ibge || substr(calcula_digito('MODULO10', c.cd_municipio_ibge),1,1),1,7))	cd_mun,
						null											cd_cep_cp,
						null											cd_cp,
						substr(elimina_caracteres_telefone(c.nr_ddi_telefone || c.nr_ddd_telefone || c.nr_telefone),1,10)				nr_fone,
						substr(elimina_caracteres_telefone(c.nr_ddi_fax || c.nr_ddd_fax || c.ds_fax),1,10) 						nr_fax,
						substr(c.ds_email,1,60)									ds_email,
						current_setting('fis_sef_edoc_reg_geral_pck.nr_seq_controle_w')::fis_sef_edoc_controle.nr_sequencia%type									nr_seq_controle
					from	estabelecimento 	a,
						pessoa_fisica 		b,
						compl_pessoa_fisica 	c
					where	a.cd_contabilista	= b.cd_pessoa_fisica
					and 	b.cd_pessoa_fisica	= c.cd_pessoa_fisica
					and 	c.ie_tipo_complemento	= 1
					and 	a.cd_estabelecimento	= current_setting('fis_sef_edoc_reg_geral_pck.cd_estabelecimento_w')::fis_sef_edoc_controle.cd_estabelecimento%type;
commit;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE fis_sef_edoc_reg_geral_pck.fis_gerar_reg_0100_edoc () FROM PUBLIC;
