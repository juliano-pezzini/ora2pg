-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION search_pend_item_data_pck.get_data ( nr_sequencia_p bigint ) RETURNS SETOF T_OBJETO_ROW_DATA AS $body$
DECLARE



t_objeto_row_w	t_objeto_row;
nm_tabela_w		varchar(255);
ds_comando_w	varchar(255);
nr_sequencia_w	bigint;
ds_campo_w		varchar(255) := 'nr_sequencia';

pending_items CURSOR FOR
	SELECT	*
	FROM	pep_item_pendente
	WHERE	nr_sequencia = nr_sequencia_p;

BEGIN

	FOR item IN pending_items LOOP
		BEGIN

		if (item.nr_seq_sinal_vital IS NOT NULL AND item.nr_seq_sinal_vital::text <> '') then
			nm_tabela_w := 'atendimento_sinal_vital';
			nr_sequencia_w := item.nr_seq_sinal_vital;
		elsif (item.nr_seq_aldrete IS NOT NULL AND item.nr_seq_aldrete::text <> '') then
			nm_tabela_w := 'escala_aldrete';
			nr_sequencia_w := item.nr_seq_aldrete;
		elsif (item.nr_seq_posicao IS NOT NULL AND item.nr_seq_posicao::text <> '') then
			nm_tabela_w := 'posicao_cirurgia';
			nr_sequencia_w := item.nr_seq_posicao;
		elsif (item.nr_seq_pele IS NOT NULL AND item.nr_seq_pele::text <> '') then
			nm_tabela_w := 'pepo_pele';
			nr_sequencia_w := item.nr_seq_pele;
		elsif (item.nr_seq_incisao IS NOT NULL AND item.nr_seq_incisao::text <> '') then
			nm_tabela_w := 'incisao_cirurgia';
			nr_sequencia_w := item.nr_seq_incisao;
		elsif (item.nr_seq_curativo IS NOT NULL AND item.nr_seq_curativo::text <> '') then
			nm_tabela_w := 'pepo_curativo';
			nr_sequencia_w := item.nr_seq_curativo;
		elsif (item.nr_seq_avaliacao IS NOT NULL AND item.nr_seq_avaliacao::text <> '') then
			nm_tabela_w := 'med_avaliacao_paciente';
			nr_sequencia_w := item.nr_seq_avaliacao;
		elsif (item.nr_seq_atend_monit_resp IS NOT NULL AND item.nr_seq_atend_monit_resp::text <> '') then
			nm_tabela_w := 'atendimento_monit_resp';
			nr_sequencia_w := item.nr_seq_atend_monit_resp;
		elsif (item.nr_seq_atend_monit_hemo IS NOT NULL AND item.nr_seq_atend_monit_hemo::text <> '') then
			nm_tabela_w := 'atend_monit_hemod';
			nr_sequencia_w := item.nr_seq_atend_monit_hemo;
		elsif (item.nr_seq_tecnica_anest IS NOT NULL AND item.nr_seq_tecnica_anest::text <> '') then
			nm_tabela_w := 'cirurgia_tec_anestesica';
			nr_sequencia_w := item.nr_seq_tecnica_anest;
		elsif (item.nr_seq_desc_anest IS NOT NULL AND item.nr_seq_desc_anest::text <> '') then
			nm_tabela_w := 'anestesia_descricao';
			nr_sequencia_w := item.nr_seq_desc_anest;
		elsif (item.nr_seq_evento IS NOT NULL AND item.nr_seq_evento::text <> '') then
			nm_tabela_w := 'qua_evento_paciente';
			nr_sequencia_w := item.nr_seq_evento;
		elsif (item.nr_seq_orient_alta IS NOT NULL AND item.nr_seq_orient_alta::text <> '') then
			nm_tabela_w := 'atendimento_alta';
			nr_sequencia_w := item.nr_seq_orient_alta;
		elsif (item.nr_seq_atend_srpa IS NOT NULL AND item.nr_seq_atend_srpa::text <> '') then
			nm_tabela_w := 'atend_aval_srpa';
			nr_sequencia_w := item.nr_seq_atend_srpa;
		elsif (item.nr_seq_conjunto IS NOT NULL AND item.nr_seq_conjunto::text <> '') then
			nm_tabela_w := 'cm_conjunto_cont';
			nr_sequencia_w := item.nr_seq_conjunto;
		elsif (item.cd_evolucao IS NOT NULL AND item.cd_evolucao::text <> '') then
			nm_tabela_w := 'evolucao_paciente';
			nr_sequencia_w := item.cd_evolucao;
			ds_campo_w := 'cd_evolucao';
		elsif (item.nr_seq_equip_cirurgia IS NOT NULL AND item.nr_seq_equip_cirurgia::text <> '') then
			nm_tabela_w := 'equipamento_cirurgia';
			nr_sequencia_w := item.nr_seq_equip_cirurgia;
		elsif (item.nr_seq_registro IS NOT NULL AND item.nr_seq_registro::text <> '') then
			if ( item.ie_tipo_registro = 'CDC' ) then
				nm_tabela_w := 'cirurgia_descricao';
			elsif ( item.ie_tipo_registro = 'CP' ) then
				nm_tabela_w := 'cirurgia_participante';
				ds_campo_w := 'nr_seq_interno';
			elsif ( item.ie_tipo_registro = 'TMOV' ) then
				nm_tabela_w := 'evento_cirurgia_paciente';
			end if;

			nr_sequencia_w := item.nr_seq_registro;
		end if;

		if (nm_tabela_w IS NOT NULL AND nm_tabela_w::text <> '' AND nr_sequencia_w IS NOT NULL AND nr_sequencia_w::text <> '') then
			ds_comando_w := 	' select 	nvl(nr_cirurgia, 0) '||
								' from ' || nm_tabela_w ||
								' where	'|| ds_campo_w || ' = ' || nr_sequencia_w;

			EXECUTE ds_comando_w
			into STRICT t_objeto_row_w.surgery_sequence;

			if (coalesce(item.ie_tipo_registro::text, '') = '' or item.ie_tipo_registro <> 'CP') then
				ds_comando_w := 	' select nvl(nr_seq_pepo, 0) '||
									' from ' || nm_tabela_w ||
									' where	'|| ds_campo_w || ' = ' || nr_sequencia_w;

				EXECUTE ds_comando_w
				into STRICT t_objeto_row_w.ehro_sequence;
			end if;
		end if;

		RETURN NEXT t_objeto_row_w;
		END;
	END LOOP;

	RETURN;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION search_pend_item_data_pck.get_data ( nr_sequencia_p bigint ) FROM PUBLIC;
