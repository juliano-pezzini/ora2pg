-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION suep_pck.obter_historico_saude_mulher ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, nr_seq_suep_p bigint, nm_usuario_p text ) RETURNS SETOF T_SAUDE_MULHER_ROW_DATA AS $body$
DECLARE

			 
t_saude_mulher_row_w	t_saude_mulher_row;

 
C01 CURSOR FOR 
	SELECT a.qt_gestacoes, 
		a.qt_nasc_mortos, 
		a.ie_idade_fertil, 
		a.ie_pac_gravida, 
		a.dt_ult_menstruacao, 
		a.qt_ig_sem_us, 
		a.qt_ig_dia_us 
	from  historico_saude_mulher a 
	where a.cd_pessoa_fisica = cd_pessoa_fisica_p 
	and  a.nr_sequencia 	 = (SELECT max(b.nr_sequencia) 
				   from 	historico_saude_mulher b 
				   where	b.cd_pessoa_fisica = a.cd_pessoa_fisica 
				   and	(b.dt_liberacao IS NOT NULL AND b.dt_liberacao::text <> ''));
	
BEGIN 
 
 
for r_c01 in c01 loop 
	begin 
	t_saude_mulher_row_w.qt_gestacoes		:= r_c01.qt_gestacoes;
	t_saude_mulher_row_w.qt_nasc_mortos		:= r_c01.qt_nasc_mortos;
	t_saude_mulher_row_w.ie_idade_fertil		:= r_c01.ie_idade_fertil;
	t_saude_mulher_row_w.ie_pac_gravida		:= r_c01.ie_pac_gravida;
	t_saude_mulher_row_w.dt_ult_menstruacao		:= r_c01.dt_ult_menstruacao;
	t_saude_mulher_row_w.qt_ig_dia_us		:= r_c01.qt_ig_dia_us;
	RETURN NEXT t_saude_mulher_row_w;
	end;
end loop;
 
return;
 
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION suep_pck.obter_historico_saude_mulher ( cd_pessoa_fisica_p text, nr_atendimento_p bigint, nr_seq_suep_p bigint, nm_usuario_p text ) FROM PUBLIC;
