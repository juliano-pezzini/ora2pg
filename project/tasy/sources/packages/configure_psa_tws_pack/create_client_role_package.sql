-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE configure_psa_tws_pack.create_client_role ( ds_client_p client.ds_client%type, ds_role_p role.ds_role%type) AS $body$
DECLARE


id_client_w         	client.id%type;
id_role_w             role.id%type;
qt_client_role_w      integer;


BEGIN

  select id
    into STRICT id_client_w
    from client
    where ds_client = ds_client_p;

  select id
    into STRICT id_role_w
    from role
    where ds_role = ds_role_p;

  select	count(1)
   into STRICT	qt_client_role_w
   from	client_role
   where	id_role = id_role_w
   and	id_client = id_client_w;


   if ( qt_client_role_w = 0 ) then
      -- link between role and permission

      --permission: schematics:retrieve

      insert into client_role(id_client, id_role, dt_creation, dt_modification)
      values ( id_client_w, id_role_w, clock_timestamp(), clock_timestamp());
  end if;

end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE configure_psa_tws_pack.create_client_role ( ds_client_p client.ds_client%type, ds_role_p role.ds_role%type) FROM PUBLIC;
