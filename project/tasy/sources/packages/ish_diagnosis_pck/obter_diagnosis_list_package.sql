-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ish_diagnosis_pck.obter_diagnosis_list ( nr_seq_fila_p bigint, ie_tipo_p text) RETURNS SETOF T_DIAGNOSIS AS $body$
DECLARE


r_diagnosis_row_w			r_diagnosis_row;

/*
nr_atendimento_w			atendimento_paciente.nr_atendimento%type;
nr_seq_diagnostico_w		diagnostico_doenca.nr_seq_interno%type;
cd_doenca_w			diagnostico_doenca.cd_doenca%type;
ds_classificacao_aux_w		classificacao_diagnostico.ds_classificacao%type;
ds_chave_fila_w			varchar2(35);
diagnostico_doenca_chave_w	dbms_sql.varchar2_table;
nr_seq_regra_w			intpd_eventos_sistema.nr_seq_regra_conv%type;
ie_conversao_w			intpd_eventos_sistema.ie_conversao%type;

cursor c01 is
select  d.cd_doenca,
	a.cd_estabelecimento,
	a.nr_seq_episodio,
	e.cd_empresa
from	diagnostico_doenca d,
	atendimento_paciente a,
	estabelecimento e
where	a.nr_atendimento = d.nr_atendimento
and	a.cd_estabelecimento = e.cd_estabelecimento
and	d.nr_atendimento = nr_atendimento_w
and	d.nr_seq_interno = nr_seq_diagnostico_w
and	d.cd_doenca = cd_doenca_w;

c01_w	c01%rowtype;
*/



BEGIN
/*
if	(nvl(nr_seq_fila_p,0) > 0) then
	select	a.nr_seq_documento,
		b.nr_seq_regra_conv,
		nvl(b.ie_conversao,'I')
	into	ds_chave_fila_w,
		nr_seq_regra_w,
		ie_conversao_w
	from	intpd_fila_transmissao a,
		intpd_eventos_sistema b
	where	a.nr_seq_evento_sistema = b.nr_sequencia
	and	a.nr_sequencia = nr_seq_fila_p;

	diagnostico_doenca_chave_w := obter_lista_string(ds_chave_fila_w, ds_separador_w);

	nr_atendimento_w	:= diagnostico_doenca_chave_w(1); --nr_atendimento
	nr_seq_diagnostico_w := diagnostico_doenca_chave_w(2); --dt_diagnostico
	cd_doenca_w		:= diagnostico_doenca_chave_w(3); --cd_doenca

	open c01;
	loop
	fetch c01 into
		c01_w;
	exit when c01%notfound;
		begin
		ish_diagnosis_pck.limpar_atributos_diagnosis(r_diagnosis_row_w);

		begin
		select	nr_sequencia
		into 	r_diagnosis_row_w.patcaseid
		from	episodio_paciente e
		where 	nr_sequencia = c01_w.nr_seq_episodio;
		exception
		when others then
			null;
		end;

		pipe	row(r_diagnosis_row_w);
		end;
	end loop;
	close c01;
end if;*/


r_diagnosis_row_w := ish_diagnosis_pck.limpar_atributos_diagnosis(r_diagnosis_row_w);
RETURN NEXT r_diagnosis_row_w;
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ish_diagnosis_pck.obter_diagnosis_list ( nr_seq_fila_p bigint, ie_tipo_p text) FROM PUBLIC;
