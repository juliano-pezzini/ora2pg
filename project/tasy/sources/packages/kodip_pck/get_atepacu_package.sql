-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION kodip_pck.get_atepacu ( deptnum_p bigint, departments_p xml) RETURNS bigint AS $body$
DECLARE

		
nr_seq_atepacu_w	bigint	:=	null;

c01 CURSOR FOR

SELECT	a.deptid,
	row_number() OVER () - 1 deptnum
from	xmltable('/Departments/Department' passing departments_p columns
		deptid	varchar(255) path '@DeptId') a;
		
c01_w	c01%rowtype;
	

BEGIN

open c01;
loop
fetch c01 into	
	c01_w;
EXIT WHEN NOT FOUND; /* apply on c01 */
	begin
	if (c01_w.deptnum = deptnum_p) then
		nr_seq_atepacu_w	:=	somente_numero(c01_w.deptid);
		exit;
	end if;
	end;
end loop;
close c01;

begin
select	nr_seq_interno
into STRICT	nr_seq_atepacu_w
from	atend_paciente_unidade
where	nr_seq_interno = nr_seq_atepacu_w;
exception
when others then
	nr_seq_atepacu_w	:=	null;
end;

return nr_seq_atepacu_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION kodip_pck.get_atepacu ( deptnum_p bigint, departments_p xml) FROM PUBLIC;
