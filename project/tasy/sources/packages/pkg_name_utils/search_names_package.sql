-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pkg_name_utils.search_names (name text, name_type text default null, exact_match text default null) RETURNS SETOF PERSON_NAME_TABLE AS $body$
DECLARE

	
	person_name_r2	person_name_row_score;
	person_name_r	person_name_row_score := person_name_row_score(null,null,null,null,null,null,null, null);
	c01 REFCURSOR;

BEGIN
	if (dbms_db_version.version >= '12') then
		open c01 for EXECUTE 'select * from table(pkg_name_utils.search_names_ora_text(:name, :name_type, :exact_match))' using name, name_type, exact_match;
	else
		open c01 for EXECUTE 'select * from table(pkg_name_utils.search_names_legacy(:name, :name_type))' using name, name_type;
	end if;

	loop
	fetch c01
	into	person_name_r.nr_sequencia,
			person_name_r.ds_given_name,
			person_name_r.ds_component_name_1,
			person_name_r.ds_component_name_2,
			person_name_r.ds_component_name_3,
			person_name_r.ds_family_name,
			person_name_r.ds_type,
			person_name_r.nr_score;
	EXIT WHEN NOT FOUND; /* apply on c01 */
		begin
		RETURN NEXT person_name_r;
		end;
	end loop;
	close c01;
end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pkg_name_utils.search_names (name text, name_type text default null, exact_match text default null) FROM PUBLIC;
