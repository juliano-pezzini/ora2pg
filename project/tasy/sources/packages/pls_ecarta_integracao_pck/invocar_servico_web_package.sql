-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';

-- tipos globais
-- variáveis globais internas
--
--
CREATE OR REPLACE FUNCTION pls_ecarta_integracao_pck.invocar_servico_web ( ds_chamada_p text) RETURNS text AS $body$
DECLARE

	request_w	utl_http.req;
	response_w	utl_http.resp;
	buffer_w	varchar(1024);
	ds_retorno_w	text := null;

BEGIN
	-- Seta variáveis globais
	PERFORM set_config('pls_ecarta_integracao_pck.nm_procedimento_w', 'invocar serviço web', false);

	-- Prepara a requisição
	request_w := utl_http.begin_request(ds_chamada_p, 'POST', 'HTTP/1.1');
	utl_http.set_header(request_w, 'Content-Type', 'text/plain');

	-- Invoca o serviço web
	response_w := utl_http.get_response(request_w);

	-- Processa o retorno
	begin
		loop
			utl_http.read_line(response_w, buffer_w, false);
			ds_retorno_w := buffer_w;
		end loop;
		utl_http.end_response(response_w);
	exception
		when utl_http.end_of_body then
			utl_http.end_response(response_w);
		when utl_http.too_many_requests then
			utl_http.end_response(response_w);
	end;
	-- Retorna
	return ds_retorno_w;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_ecarta_integracao_pck.invocar_servico_web ( ds_chamada_p text) FROM PUBLIC;
