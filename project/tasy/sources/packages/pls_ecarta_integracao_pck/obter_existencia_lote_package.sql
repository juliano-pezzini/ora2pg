-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_ecarta_integracao_pck.obter_existencia_lote ( nr_seq_ecarta_lote_p pls_ecarta_lote.nr_sequencia%type) RETURNS boolean AS $body$
DECLARE

	qt_registro_w	bigint;

	-- Lote não encerrado
	c01_w CURSOR FOR
	SELECT	count(1)
	from	pls_ecarta_lote a
	where	exists (SELECT	1
			from	pls_ecarta_solicitacao	z
			where	coalesce(z.dt_baixa::text, '') = ''
			and	z.nr_seq_ecarta_lote	= a.nr_sequencia)
	and	a.nr_sequencia	= nr_seq_ecarta_lote_p;

BEGIN
	-- Executa consulta
	open c01_w;
	fetch c01_w into qt_registro_w;
	close c01_w;

	-- Se estiver encerrada, retorna que não existe
	if (qt_registro_w > 0) then
		return true;
	else
		return false;
	end if;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION pls_ecarta_integracao_pck.obter_existencia_lote ( nr_seq_ecarta_lote_p pls_ecarta_lote.nr_sequencia%type) FROM PUBLIC;
