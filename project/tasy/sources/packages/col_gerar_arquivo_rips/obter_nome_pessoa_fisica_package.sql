-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION col_gerar_arquivo_rips.obter_nome_pessoa_fisica ( cd_pessoa_fisica_P pessoa_fisica.cd_pessoa_fisica%TYPE, posicao_p bigint ) RETURNS varchar AS $body$
DECLARE


    nm_pessoa_fisica_w pessoa_fisica.nm_pessoa_fisica%TYPE;

BEGIN
        SELECT 
               CASE WHEN posicao_p=1 THEN  CASE WHEN (b.ds_given_name IS NOT NULL AND b.ds_given_name::text <> '') THEN                                    b.ds_given_name ELSE regexp_substr(a.nm_pessoa_fisica, '[^ ]+', 1, 1) END WHEN posicao_p=2 THEN  CASE WHEN (b.ds_given_name IS NOT NULL AND b.ds_given_name::text <> '') THEN                                    b.ds_component_name_1 ELSE regexp_substr(a.nm_pessoa_fisica, '[^ ]+', 1, 2) END WHEN posicao_p=3 THEN  CASE WHEN (b.ds_given_name IS NOT NULL AND b.ds_given_name::text <> '') THEN                                    b.ds_family_name ELSE regexp_substr(A.nm_pessoa_fisica, '[^ ]+', 1, 3) END WHEN posicao_p=4 THEN   CASE WHEN (b.ds_given_name IS NOT NULL AND b.ds_given_name::text <> '') THEN                                    b.ds_component_name_2 ELSE (CASE WHEN length(A.nm_pessoa_fisica) - length(replace(A.nm_pessoa_fisica, ' ', '')) > 2 THEN                                                                       substr(a.nm_pessoa_fisica, instr(a.nm_pessoa_fisica,' ', 1, 3)) ELSE                                                                       NULL END) END                      END 
        INTO STRICT    nm_pessoa_fisica_w
        FROM pessoa_fisica a
LEFT OUTER JOIN person_name b ON (a.nr_seq_person_name = b.nr_sequencia AND 'main' = b.ds_type)
WHERE a.cd_pessoa_fisica = cd_pessoa_fisica_p;

        RETURN nm_pessoa_fisica_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION col_gerar_arquivo_rips.obter_nome_pessoa_fisica ( cd_pessoa_fisica_P pessoa_fisica.cd_pessoa_fisica%TYPE, posicao_p bigint ) FROM PUBLIC;
