-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION col_gerar_arquivo_rips.obter_arquivos_rips ( nr_lote_p bigint, dt_inicio_p timestamp DEFAULT NULL, dt_fim_p timestamp DEFAULT NULL, ie_tipo_registro_p valor_dominio.vl_dominio%TYPE DEFAULT NULL) RETURNS SETOF TABLE_ARQUIVO_RIPS AS $body$
DECLARE

        registro_rips_w col_arq_registro_rips_type;

BEGIN
        IF ( coalesce(ie_tipo_registro_p::text, '') = '' ) THEN
            FOR rec_w IN current_setting('col_gerar_arquivo_rips.c_dominio_rips')::LOOP CURSOR
                IF (UPPER(rec_w.ie_tipo_registro) = 'CT') THEN
                    NULL;
                ELSE
                    registro_rips_w := col_gerar_arquivo_rips.obter_registro_rips(nr_lote_p, dt_inicio_p, dt_fim_p, rec_w.ie_tipo_registro);
                        RETURN NEXT  registro_rips_w;
                END IF;
            END LOOP;
        ELSE
            registro_rips_w := col_gerar_arquivo_rips.obter_registro_rips(nr_lote_p, dt_inicio_p, dt_fim_p, ie_tipo_registro_p);
            IF (registro_rips_w.ds_conteudo_arquivo IS NOT NULL AND registro_rips_w.ds_conteudo_arquivo::text <> '') THEN
                RETURN NEXT  registro_rips_w;
            END IF;

        END IF;

        RETURN;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION col_gerar_arquivo_rips.obter_arquivos_rips ( nr_lote_p bigint, dt_inicio_p timestamp DEFAULT NULL, dt_fim_p timestamp DEFAULT NULL, ie_tipo_registro_p valor_dominio.vl_dominio%TYPE DEFAULT NULL) FROM PUBLIC;
