-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION col_gerar_arquivo_rips.converte_valor_coluna ( ds_arquivo_p text, nr_column_type bigint DEFAULT 96) RETURNS text AS $body$
DECLARE

        return_w text;

BEGIN
        IF coalesce(ds_arquivo_p::text, '') = '' THEN
            return ds_arquivo_p;
        END IF;

        return_w := ds_arquivo_p;

        CASE 
            WHEN nr_column_type in (1,96,112,113) THEN 
                CASE
                    WHEN REGEXP_LIKE(ds_arquivo_p, '^\d{1,2}/\d{1,2}/\d{2,4}[ ]{0,1}\d{0,2}[:]{0,1}\d{0,2}[:]{0,1}\d{0,2}$') THEN
                        return_w := ds_arquivo_p;
                    WHEN REGEXP_LIKE(ds_arquivo_p, '^\d{1,2}-\d{1,2}-\d{2,4}[ ]{0,1}\d{0,2}[:]{0,1}\d{0,2}[:]{0,1}\d{0,2}$')
                        OR REGEXP_LIKE(ds_arquivo_p, '^\d{0,2}[:]{0,1}\d{0,2}[:]{0,1}\d{0,2}$')
                    THEN
                        return_w := REGEXP_REPLACE(ds_arquivo_p,'-', '/');
                    ELSE
                        return_w := UPPER(REGEXP_REPLACE(convert(ds_arquivo_p,'US7ASCII'),'[^[:alnum:]]', ' '));
                    END CASE;
            WHEN nr_column_type in (12) THEN return_w := to_char(to_date(ds_arquivo_p), 'dd-mm-yyyy');
            WHEN nr_column_type in (2) THEN
                IF floor(ds_arquivo_p) != ds_arquivo_p THEN
                    return_w := TO_CHAR(ds_arquivo_p,'FM999999999999990.00');
                END IF;
        END case;

        return return_w;
    EXCEPTION
        WHEN OTHERS THEN
        return   return_w;
    END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION col_gerar_arquivo_rips.converte_valor_coluna ( ds_arquivo_p text, nr_column_type bigint DEFAULT 96) FROM PUBLIC;
