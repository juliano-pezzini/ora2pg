-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';


-- Desfazer dados do arquivo A525



CREATE OR REPLACE PROCEDURE ptu_aviso_pck.desfazer_dados_env_a525 ( nr_seq_arquivo_p ptu_aviso_arquivo.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
BEGIN
delete	FROM ptu_aviso_ret_item_glosa rig
where	rig.nr_seq_ret_item	in (SELECT	ri.nr_sequencia
					from	ptu_aviso_ret_item ri,
						ptu_aviso_ret_guia rg,
						ptu_aviso_ret_protocolo rp,
						ptu_aviso_ret_arquivo ra
					where	ra.nr_sequencia	= rp.nr_seq_ret_arquivo
					and	rp.nr_sequencia	= rg.nr_seq_ret_protocolo
					and	rg.nr_sequencia	= ri.nr_seq_ret_guia
					and	ra.nr_seq_arquivo = nr_seq_arquivo_p);

delete	FROM ptu_aviso_ret_item ri
where	ri.nr_seq_ret_guia	in (SELECT	rg.nr_sequencia
					from	ptu_aviso_ret_guia rg,
						ptu_aviso_ret_protocolo rp,
						ptu_aviso_ret_arquivo ra
					where	ra.nr_sequencia	= rp.nr_seq_ret_arquivo
					and	rp.nr_sequencia	= rg.nr_seq_ret_protocolo
					and	ra.nr_seq_arquivo = nr_seq_arquivo_p);	

delete	FROM ptu_aviso_ret_guia_glosa rgg
where	rgg.nr_seq_ret_guia	in (SELECT	rg.nr_sequencia
					from	ptu_aviso_ret_guia rg,
						ptu_aviso_ret_protocolo rp,
						ptu_aviso_ret_arquivo ra
					where	ra.nr_sequencia	= rp.nr_seq_ret_arquivo
					and	rp.nr_sequencia	= rg.nr_seq_ret_protocolo
					and	ra.nr_seq_arquivo = nr_seq_arquivo_p);	

delete	FROM ptu_aviso_ret_guia rg
where	rg.nr_seq_ret_protocolo in (SELECT	rp.nr_sequencia
					from	ptu_aviso_ret_protocolo rp,
						ptu_aviso_ret_arquivo ra
					where	ra.nr_sequencia	= rp.nr_seq_ret_arquivo
					and	ra.nr_seq_arquivo = nr_seq_arquivo_p);

delete	FROM ptu_aviso_ret_prot_glosa rpg
where	rpg.nr_seq_ret_protocolo in (SELECT	rp.nr_sequencia
					from	ptu_aviso_ret_protocolo rp,
						ptu_aviso_ret_arquivo ra
					where	ra.nr_sequencia	= rp.nr_seq_ret_arquivo
					and	ra.nr_seq_arquivo = nr_seq_arquivo_p);

delete	FROM ptu_aviso_ret_protocolo rp
where	rp.nr_seq_ret_arquivo in (SELECT	ra.nr_sequencia
					from	ptu_aviso_ret_arquivo ra
					where	ra.nr_seq_arquivo	= nr_seq_arquivo_p);

delete	FROM ptu_aviso_ret_mens_erro me
where	me.nr_seq_ret_arquivo in (SELECT	ra.nr_sequencia
					from	ptu_aviso_ret_arquivo ra
					where	ra.nr_seq_arquivo	= nr_seq_arquivo_p);

delete	FROM ptu_aviso_ret_arquivo
where	nr_seq_arquivo	= nr_seq_arquivo_p;

commit;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_pck.desfazer_dados_env_a525 ( nr_seq_arquivo_p ptu_aviso_arquivo.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
