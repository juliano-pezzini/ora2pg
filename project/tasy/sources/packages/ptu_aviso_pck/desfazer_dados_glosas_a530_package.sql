-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';



-- Desfazer dados de glosas do A530



CREATE OR REPLACE PROCEDURE ptu_aviso_pck.desfazer_dados_glosas_a530 ( nr_seq_arquivo_p ptu_aviso_arquivo.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) AS $body$
DECLARE

					
c01 CURSOR( nr_seq_arquivo_pc	ptu_aviso_arquivo.nr_sequencia%type ) FOR
	SELECT	gb.nr_sequencia	nr_seq_glosa_baixa,
		bd.nr_sequencia nr_seq_gb_dados
	from	ptu_aviso_glosa_bx 		gb,
		ptu_aviso_glosa_bx_dados 	bd
	where	gb.nr_sequencia		= bd.nr_seq_glosa_baixa
	and	gb.nr_seq_arquivo	= nr_seq_arquivo_p
	and	gb.ie_status		in ('1','4') /* 1 - Pendente / 4 - Falha */

	and	bd.ie_tipo_glosa_baixa	= '1';

BEGIN
for r_c01_w in c01( nr_seq_arquivo_p ) loop
	delete	FROM ptu_aviso_glosa_bx_dados
	where	nr_sequencia	= r_c01_w.nr_seq_gb_dados;
	
	delete	FROM ptu_aviso_glosa_bx
	where	nr_sequencia	= r_c01_w.nr_seq_glosa_baixa;
end loop;

commit;
END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE ptu_aviso_pck.desfazer_dados_glosas_a530 ( nr_seq_arquivo_p ptu_aviso_arquivo.nr_sequencia%type, nm_usuario_p usuario.nm_usuario%type) FROM PUBLIC;
