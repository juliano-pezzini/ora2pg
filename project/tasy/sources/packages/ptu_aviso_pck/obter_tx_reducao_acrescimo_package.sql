-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION ptu_aviso_pck.obter_tx_reducao_acrescimo ( tx_item_p pls_conta_proc.tx_item%type, ie_via_acesso_p pls_conta_proc.ie_via_acesso%type, ie_via_acesso_mult_p pls_parametro_faturamento.ie_via_acesso_mult%type) RETURNS bigint AS $body$
DECLARE

/* +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Finalidade:	Calcula a taxa de reducao / acrescimo para cada item.

-------------------------------------------------------------------------------------------------------------------

Pontos de atencao:

			O calculo e baseado na pls_gerar_ptu_nota_servico, ao alterar esta rotina, verificar se nao 
			precisa alterar a pls_gerar_ptu_nota_servico

Alteracoes:
-------------------------------------------------------------------------------------------------------------------

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ */


ds_retorno_w	ptu_aviso_procedimento.tx_reducao_acrescimo%type;
tx_item_w	pls_conta_proc.tx_item%type;


BEGIN

-- comeca com 1

ds_retorno_w 	:= 1;
tx_item_w	:= coalesce(tx_item_p, 0);

if (tx_item_w > 0) and (tx_item_w < 100) then
	ds_retorno_w := (tx_item_w / 100);
else
	if (tx_item_w <= 0) then
		ds_retorno_w := 1;
	else		
		ds_retorno_w := tx_item_w;
	end if;
end if;

-- Se a via de acesso for diferente de "0" - Independe da via

if (ie_via_acesso_p != '0') and (ie_via_acesso_mult_p = 'S') then
	
	ds_retorno_w := 1;
end if;

-- Caso a taxa for igual ou maior a 100, entao divide por 100

if (ds_retorno_w >= 100) then

	ds_retorno_w := (ds_retorno_w / 100);
end if;




return ds_retorno_w;
	

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION ptu_aviso_pck.obter_tx_reducao_acrescimo ( tx_item_p pls_conta_proc.tx_item%type, ie_via_acesso_p pls_conta_proc.ie_via_acesso%type, ie_via_acesso_mult_p pls_parametro_faturamento.ie_via_acesso_mult%type) FROM PUBLIC;
