-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION pls_gerar_boletos_mens_fat_pck.obter_dados_endereco_pagador ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, cd_cgc_p pessoa_juridica.cd_cgc%type, ie_endereco_boleto_p pls_contrato_pagador.ie_endereco_boleto%type) RETURNS SETOF T_ENDERECO_PAGADOR_BOLETO_DATA AS $body$
DECLARE


	ie_tipo_complemento_w			bigint;
	endereco_pagador_boleto_w		endereco_pagador_boleto;

	
BEGIN
	begin
		if (cd_pessoa_fisica_p IS NOT NULL AND cd_pessoa_fisica_p::text <> '') then
			select	CASE WHEN ie_endereco_boleto_p='PFR' THEN 1 WHEN ie_endereco_boleto_p='PFC' THEN 2 WHEN ie_endereco_boleto_p='PFA' THEN 9 WHEN ie_endereco_boleto_p='PFV' THEN 3 WHEN ie_endereco_boleto_p='PFP' THEN 4 WHEN ie_endereco_boleto_p='PFM' THEN 5 WHEN ie_endereco_boleto_p='PFJ' THEN 6  ELSE null END
			into STRICT	ie_tipo_complemento_w
			;

			select	a.ds_endereco,
				a.nr_endereco,
				a.ds_bairro,
				a.ds_complemento,
				a.ds_municipio,
				a.cd_cep,
				a.sg_estado,
				b.ds_tipo_logradouro
			into STRICT	endereco_pagador_boleto_w.ds_endereco,
				endereco_pagador_boleto_w.nr_endereco,
				endereco_pagador_boleto_w.ds_bairro,
				endereco_pagador_boleto_w.ds_complemento,
				endereco_pagador_boleto_w.ds_municipio,
				endereco_pagador_boleto_w.cd_cep,
				endereco_pagador_boleto_w.sg_estado,
				endereco_pagador_boleto_w.ds_tipo_logradouro
			FROM compl_pessoa_fisica a
LEFT OUTER JOIN sus_tipo_logradouro b ON (a.cd_tipo_logradouro = b.cd_tipo_logradouro)
WHERE a.ie_tipo_complemento	= ie_tipo_complemento_w and a.cd_pessoa_fisica	= cd_pessoa_fisica_p   LIMIT 1;
		elsif (cd_cgc_p IS NOT NULL AND cd_cgc_p::text <> '') then
			select	CASE WHEN ie_endereco_boleto_p='PJC' THEN 1 WHEN ie_endereco_boleto_p='PJF' THEN 2 WHEN ie_endereco_boleto_p='PJ' THEN 3 END
			into STRICT	ie_tipo_complemento_w
			;

			if (ie_tipo_complemento_w <> 3) then
				select	ds_endereco,
					nr_endereco,
					ds_complemento,
					ds_bairro,
					ds_municipio,
					cd_cep,
					sg_estado
				into STRICT	endereco_pagador_boleto_w.ds_endereco,
					endereco_pagador_boleto_w.nr_endereco,
					endereco_pagador_boleto_w.ds_complemento,
					endereco_pagador_boleto_w.ds_bairro,
					endereco_pagador_boleto_w.ds_municipio,
					endereco_pagador_boleto_w.cd_cep,
					endereco_pagador_boleto_w.sg_estado
				from	pessoa_juridica_compl
				where	cd_cgc			= cd_cgc_p
				and	ie_tipo_complemento	= ie_tipo_complemento_w  LIMIT 1;

				select	nr_inscricao_estadual
				into STRICT	endereco_pagador_boleto_w.nr_inscricao_estadual
				from	pessoa_juridica
				where	cd_cgc	= cd_cgc_p;
			elsif (ie_tipo_complemento_w = 3) then
				select	a.ds_endereco,
					a.nr_endereco,
					a.ds_complemento,
					a.ds_bairro,
					a.ds_municipio,
					a.cd_cep,
					a.sg_estado,
					a.nr_inscricao_estadual,
					b.ds_tipo_logradouro
				into STRICT	endereco_pagador_boleto_w.ds_endereco,
					endereco_pagador_boleto_w.nr_endereco,
					endereco_pagador_boleto_w.ds_complemento,
					endereco_pagador_boleto_w.ds_bairro,
					endereco_pagador_boleto_w.ds_municipio,
					endereco_pagador_boleto_w.cd_cep,
					endereco_pagador_boleto_w.sg_estado,
					endereco_pagador_boleto_w.nr_inscricao_estadual,
					endereco_pagador_boleto_w.ds_tipo_logradouro
				FROM pessoa_juridica a
LEFT OUTER JOIN cns_tipo_logradouro b ON (a.nr_seq_tipo_logradouro = b.nr_sequencia)
WHERE a.cd_cgc	= cd_cgc_p;
			end if;
		end if;
	exception
	when others then
		endereco_pagador_boleto_w.ds_endereco		:= '';
		endereco_pagador_boleto_w.nr_endereco		:= '';
		endereco_pagador_boleto_w.ds_complemento	:= '';
		endereco_pagador_boleto_w.ds_bairro		:= '';
		endereco_pagador_boleto_w.ds_municipio		:= '';
		endereco_pagador_boleto_w.cd_cep		:= '';
		endereco_pagador_boleto_w.sg_estado		:= '';
		endereco_pagador_boleto_w.nr_inscricao_estadual := '';
		endereco_pagador_boleto_w.ds_tipo_logradouro	:= '';
	end;
	RETURN NEXT endereco_pagador_boleto_w;

	return;

	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION pls_gerar_boletos_mens_fat_pck.obter_dados_endereco_pagador ( cd_pessoa_fisica_p pessoa_fisica.cd_pessoa_fisica%type, cd_cgc_p pessoa_juridica.cd_cgc%type, ie_endereco_boleto_p pls_contrato_pagador.ie_endereco_boleto%type) FROM PUBLIC;
