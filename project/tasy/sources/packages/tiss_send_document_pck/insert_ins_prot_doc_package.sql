-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE tiss_send_document_pck.insert_ins_prot_doc (nr_seq_attach_p protocolo_conv_anexo.nr_sequencia%type, nm_user_p usuario.nm_usuario%type, ds_doc_format_p text, protocol_p tiss_envio_documento.nr_protocolo%type, batch_p tiss_envio_documento.nr_lote%type, result_seq_p INOUT tiss_envio_documento.nr_sequencia%type) AS $body$
DECLARE


result_seq_w 		tiss_envio_documento.nr_sequencia%type;
ie_doc_format_w		tiss_envio_documento.ie_formato_documento%type;
ie_tiss_doc_w		autorizacao_convenio_arq.ie_tipo_documento_tiss%type;
nr_seq_prot_w		protocolo_convenio.nr_seq_protocolo%type;


BEGIN

	select 	max(nr_sequencia)
	into STRICT	result_seq_w
	from	tiss_envio_documento
	where	nr_seq_protoc_conv_anexo = nr_seq_attach_p
	and	nr_protocolo = protocol_p
	and	nr_lote = batch_p;

	if coalesce(result_seq_w::text, '') = '' then

		select 	max(a.ie_tipo_documento_tiss),
			max(a.nr_seq_protocolo)
		into STRICT	ie_tiss_doc_w,
			nr_seq_prot_w
		from	protocolo_conv_anexo a
		where	a.nr_sequencia = nr_seq_attach_p;

		ie_doc_format_w := tiss_send_document_pck.get_doc_format(ds_doc_format_p);

		result_seq_w := tiss_send_document_pck.execute_insert(nm_user_p, protocol_p, batch_p, null, null, null, current_setting('tiss_send_document_pck.ie_prot_type_c')::tiss_envio_documento.ie_natureza_guia%type, ie_doc_format_w, null, ie_tiss_doc_w, null, null, nr_seq_attach_p, result_seq_w);

	end if;


	result_seq_p := result_seq_w;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE tiss_send_document_pck.insert_ins_prot_doc (nr_seq_attach_p protocolo_conv_anexo.nr_sequencia%type, nm_user_p usuario.nm_usuario%type, ds_doc_format_p text, protocol_p tiss_envio_documento.nr_protocolo%type, batch_p tiss_envio_documento.nr_lote%type, result_seq_p INOUT tiss_envio_documento.nr_sequencia%type) FROM PUBLIC;
