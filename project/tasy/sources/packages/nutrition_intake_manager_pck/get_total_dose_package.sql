-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION nutrition_intake_manager_pck.get_total_dose ( ds_special_dose_p text) RETURNS bigint AS $body$
DECLARE


	ds_dose_diferenciada_w	varchar(50) := '';
	ds_dose_diferenciada_ww	varchar(50) := '';
	qt_dose_diferenciada_w	double precision;
	qt_dose_total_w         double precision := 0;

	ie_loop_w smallint := 0;
	ie_position_w bigint;

	
BEGIN

		if (ds_special_dose_p IS NOT NULL AND ds_special_dose_p::text <> '') then

			ds_dose_diferenciada_ww	:= ds_special_dose_p;

			while(ds_dose_diferenciada_ww IS NOT NULL AND ds_dose_diferenciada_ww::text <> '') and (ie_loop_w < 101) loop
			begin

				ie_position_w	:= position('-' in ds_dose_diferenciada_ww);

				if (ie_position_w > 0) then
					qt_dose_diferenciada_w	:= replace(substr(ds_dose_diferenciada_ww, 1, ie_position_w - 1),'/',',');
					ds_dose_diferenciada_ww	:= substr(ds_dose_diferenciada_ww, ie_position_w + 1, 50);
				else
					qt_dose_diferenciada_w	:= replace(ds_dose_diferenciada_ww,'/',',');
					ds_dose_diferenciada_ww	:= null;
				end if;

				ie_loop_w	:=  ie_loop_w + 1;

				qt_dose_total_w := qt_dose_total_w + qt_dose_diferenciada_w;
			end;
			end loop;
		end if;

		return qt_dose_total_w;
	end;


$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION nutrition_intake_manager_pck.get_total_dose ( ds_special_dose_p text) FROM PUBLIC;
