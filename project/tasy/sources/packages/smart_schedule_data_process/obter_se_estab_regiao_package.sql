-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION smart_schedule_data_process.obter_se_estab_regiao (cd_estab_agenda_p bigint, nr_seq_regiao_p bigint, cd_estab_portal_p bigint) RETURNS varchar AS $body$
DECLARE

		retorno_w				varchar(1) := 'N';
		ie_possui_cadastro_w	varchar(1) := 'N';
	
BEGIN
		if (coalesce(nr_seq_regiao_p::text, '') = '') then
			
			select	CASE WHEN COUNT(*)=0 THEN  'N'  ELSE 'S' END
			into STRICT	ie_possui_cadastro_w
			from	WSUITE_GRUPO_LOCALIZACAO W
			where	coalesce(w.cd_estab_wsuite,cd_estab_portal_p) = cd_estab_portal_p
			and 	w.ie_situacao = 'A'
			and		w.IE_UTILIZACAO in ('A','P');
			
			if (ie_possui_cadastro_w = 'S') then
		
				select	CASE WHEN COUNT(*)=0 THEN  'N'  ELSE 'S' END
				into STRICT	retorno_w
				from	WSUITE_GRUPO_LOCALIZACAO W,
						WSUITE_GRUPO_LOC_ESTAB WE
				where 	W.nr_sequencia = WE.NR_GRUPO_LOCAL
				and		coalesce(w.cd_estab_wsuite,cd_estab_portal_p) = cd_estab_portal_p
				and		we.cd_estabelecimento = cd_estab_agenda_p
				and 	w.ie_situacao = 'A'
				and		we.ie_situacao = 'A'
				and		w.IE_UTILIZACAO in ('A','P');
			else
				retorno_w := 'S';
			end if;
		else
			select	CASE WHEN COUNT(*)=0 THEN  'N'  ELSE 'S' END 
			into STRICT	retorno_w
			from	WSUITE_GRUPO_LOCALIZACAO W,
					WSUITE_GRUPO_LOC_ESTAB WE
			where 	W.nr_sequencia = WE.NR_GRUPO_LOCAL
			and		w.nr_sequencia = nr_seq_regiao_p
			and		coalesce(w.cd_estab_wsuite,cd_estab_portal_p) = cd_estab_portal_p
			and		we.cd_estabelecimento = cd_estab_agenda_p
			and 	w.ie_situacao = 'A'
			and		we.ie_situacao = 'A'
			and		w.IE_UTILIZACAO in ('A','P');
		end if;
		
		return 	retorno_w;
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
 STABLE;
-- REVOKE ALL ON FUNCTION smart_schedule_data_process.obter_se_estab_regiao (cd_estab_agenda_p bigint, nr_seq_regiao_p bigint, cd_estab_portal_p bigint) FROM PUBLIC;
