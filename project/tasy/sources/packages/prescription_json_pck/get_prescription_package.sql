-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE FUNCTION prescription_json_pck.get_prescription ( nr_prescricao_p bigint) RETURNS PHILIPS_JSON AS $body$
DECLARE

	json_prescr_w		philips_json;
	
	C01 CURSOR FOR
		SELECT	*
		from	bft_order_v
		where	nr_prescricao	= nr_prescricao_p;
	
BEGIN
	json_prescr_w		:= philips_json();
	
	for r_c01 in c01 loop
		begin
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'prescriptionNumber', r_c01.prescription_number);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'orderingProviderIdNumber', r_c01.ordering_provider_id_number);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'procedureName', r_c01.procedure_name);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'encounterId', r_c01.encounter_id);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'orderingProviderGivenName', r_c01.ordering_provider_given_name);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'orderingProviderLastName', r_c01.ordering_provider_last_name);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'orderingProviderMiddleName', r_c01.ordering_provider_middle_name);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'requestedDateTime', r_c01.requested_date_time);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'releaseDateTime', r_c01.release_date_time);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'suspendedTime', r_c01.suspended_time);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'nrPrescricao', r_c01.nr_prescricao);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'notes', r_c01.notes);
		json_prescr_w := prescription_json_pck.add_json_value(json_prescr_w, 'clinicalNotes', r_c01.clinical_notes);
		end;
	end loop;
	
	return json_prescr_w;
	
	END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON FUNCTION prescription_json_pck.get_prescription ( nr_prescricao_p bigint) FROM PUBLIC;
