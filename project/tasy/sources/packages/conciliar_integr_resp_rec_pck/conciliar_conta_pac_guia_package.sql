-- Generated by Ora2Pg, the Oracle database Schema converter, version 23.1
-- Copyright 2000-2022 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=srv-dbora-03.whebdc.com.br;service_name=DEV_1815;port=1521

SET client_encoding TO 'UTF8';




CREATE OR REPLACE PROCEDURE conciliar_integr_resp_rec_pck.conciliar_conta_pac_guia () AS $body$
DECLARE

current_setting('conciliar_integr_resp_rec_pck.i')::integer 	integer := 0;
k 	integer := 0;
qt_guia_w integer := 0;

BEGIN

PERFORM set_config('conciliar_integr_resp_rec_pck.i', 0, false);
k := 0;

if (current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v.count > 0) then
	for current_setting('conciliar_integr_resp_rec_pck.i')::integer in current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v.first .. current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v.last loop

		if (current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status = 'P') then

		if (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v.count > 0) then
		    for k in current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v.first .. current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v.last loop		


			if (current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).nr_seq_protocolo = current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].nr_seq_protocolo) then

				if (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].nr_interno_conta = current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).nr_interno_conta) then



					if (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).nr_guia_operadora) then

						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].cd_autorizacao;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_guia		:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_guia;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_saldo   	:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_saldo;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status		:= 'C';

					elsif (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].cd_autorizacao = current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).nr_guia_prestador) then

						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).cd_autorizacao := current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].cd_autorizacao;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_guia		:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_guia;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_saldo   	:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_saldo;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status		:= 'C';

					elsif (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_guia = current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_informado) then	

						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).cd_autorizacao := coalesce(current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].cd_autorizacao,current_setting('conciliar_integr_resp_rec_pck.not_informed_w')::varchar(100));
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_guia		:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_guia;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).vl_saldo   	:= current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].vl_saldo;
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status		:= 'C';
					elsif (current_setting('conciliar_integr_resp_rec_pck.campos_conta_w')::campos_conta_v[k].seq_guia > 1) then
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status := 'M';--Localizada mais de uma guia
					else
						current_setting('conciliar_integr_resp_rec_pck.campos_guia_w')::campos_guia_v(current_setting('conciliar_integr_resp_rec_pck.i')::integer).ie_status := 'N';
					end if;

			    end if;
			end if;
		    end loop;
		end if;
		end if;

	end loop;
end if;

END;

$body$
LANGUAGE PLPGSQL
SECURITY DEFINER
;
-- REVOKE ALL ON PROCEDURE conciliar_integr_resp_rec_pck.conciliar_conta_pac_guia () FROM PUBLIC;
